!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=105)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return b})),n.d(t,"d",(function(){return M})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"i",(function(){return I})),n.d(t,"j",(function(){return D})),n.d(t,"k",(function(){return u})),n.d(t,"l",(function(){return d})),n.d(t,"m",(function(){return B})),n.d(t,"n",(function(){return R})),n.d(t,"o",(function(){return m})),n.d(t,"p",(function(){return N})),n.d(t,"q",(function(){return f})),n.d(t,"r",(function(){return g})),n.d(t,"s",(function(){return _})),n.d(t,"t",(function(){return y})),n.d(t,"u",(function(){return T})),n.d(t,"v",(function(){return E})),n.d(t,"w",(function(){return P})),n.d(t,"x",(function(){return A})),n.d(t,"y",(function(){return O})),n.d(t,"z",(function(){return z})),n.d(t,"A",(function(){return H})),n.d(t,"B",(function(){return k})),n.d(t,"C",(function(){return $})),n.d(t,"D",(function(){return L})),n.d(t,"E",(function(){return U}));var r=n(1),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var s=e[i],o=i+1<e.length,a=o?e[i+1]:0,c=i+2<e.length,l=c?e[i+2]:0,h=s>>2,u=(3&s)<<4|a>>4,d=(15&a)<<2|l>>6,p=63&l;c||(p=64,o||(d=64)),r.push(n[h],n[u],n[d],n[p])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){var o=((7&i)<<18|(63&(s=e[n++]))<<12|(63&(a=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{s=e[n++];var a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var s=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,c=++i<e.length?n[e.charAt(i)]:64;if(++i,null==s||null==o||null==a||null==c)throw Error();var l=s<<2|o>>4;if(r.push(l),64!==a){var h=o<<4&240|a>>2;if(r.push(h),64!==c){var u=a<<6&192|c;r.push(u)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},l=function(e){var t=a(e);return c.encodeByteArray(t,!0)},h=function(e){try{return c.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function u(e){return d(void 0,e)}function d(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&(e[n]=d(e[n],t[n]));return e}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var p=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function g(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function m(){return"object"==typeof self&&self.self===self}function y(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function _(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var v="FirebaseError",w=function(e){function t(n,r){var i=e.call(this,r)||this;return i.code=n,i.name=v,Object.setPrototypeOf(i,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,b.prototype.create),i}return Object(r.c)(t,e),t}(Error),b=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=t[0]||{},i=this.service+"/"+e,s=this.errors[e],o=s?S(s,r):"Error",a=this.serviceName+": "+o+" ("+i+").",c=new w(i,a),l=0,h=Object.keys(r);l<h.length;l++){var u=h[l];"_"!==u.slice(-1)&&(u in c&&console.warn('Overwriting FirebaseError base field "'+u+'" can cause unexpected behavior.'),c[u]=r[u])}return c},e}();function S(e,t){return e.replace(C,(function(e,n){var r=t[n];return null!=r?r.toString():"<"+n+"?>"}))}var C=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E(e){return JSON.parse(e)}function k(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var x=function(e){var t={},n={},r={},i="";try{var s=e.split(".");t=E(h(s[0])||""),n=E(h(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},T=function(e){var t=x(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},R=function(e){var t=x(e).claims;return"object"==typeof t&&!0===t.admin};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function N(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function P(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},r=0,i=Object.entries(e);r<i.length;r++){var s=i[r];n(s[0],s[1])}return t.length?"&"+t.join("&"):""}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var M=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var s,o,a=this.chain_[0],c=this.chain_[1],l=this.chain_[2],h=this.chain_[3],u=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(s=h^c&(l^h),o=1518500249):(s=c^l^h,o=1859775393):r<60?(s=c&l|h&(c|l),o=2400959708):(s=c^l^h,o=3395469782);i=(a<<5|a>>>27)+s+u+o+n[r]&4294967295;u=h,h=l,l=4294967295&(c<<30|c>>>2),c=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++r,++s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++r,++s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},e}();function D(e,t){var n=new F(e,t);return n.subscribe.bind(n)}var F=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((function(){e(n)})).catch((function(e){n.error(e)}))}return e.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))},e.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)},e.prototype.complete=function(){this.forEachObserver((function(e){e.complete()})),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=j),void 0===r.error&&(r.error=j),void 0===r.complete&&(r.complete=j);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}})),this.observers.push(r),s},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))},e}();function j(){}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $=function(e,t,n,r){var i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function B(e,t,n){var r="";switch(t){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";return i+=r+" argument "}function L(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(B(e,t,r)+"must be a valid function.")}function U(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(B(e,t,r)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var H=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;s(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},z=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t}},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"g",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return h}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,a)}c((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function c(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}},function(e,t,n){"use strict";var r=n(4),i=n(37),s=n(19),o=n(72),a=n(11);function c(e){return e}function l(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}t.newBlob=function(e,n){t.checkSupport("blob");try{return new Blob([e],{type:n})}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(e),r.getBlob(n)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(e,t,n){var r=[],i=0,s=e.length;if(s<=n)return String.fromCharCode.apply(null,e);for(;i<s;)"array"===t||"nodebuffer"===t?r.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,s)))):r.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,s)))),i+=n;return r.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var n=65536,r=t.getTypeOf(e),i=!0;if("uint8array"===r?i=h.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=h.applyCanBeUsed.nodebuffer),i)for(;n>1;)try{return h.stringifyByChunk(e,r,n)}catch(e){n=Math.floor(n/2)}return h.stringifyByChar(e)}function d(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}t.applyFromCharCode=u;var p={};p.string={string:c,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,s.allocBuffer(e.length))}},p.array={string:u,array:c,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},p.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:c,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},p.uint8array={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:c,nodebuffer:function(e){return s.newBufferFrom(e)}},p.nodebuffer={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:c},t.transformTo=function(e,n){if(n||(n=""),!e)return n;t.checkSupport(e);var r=t.getTypeOf(n);return p[r][e](n)},t.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":r.nodebuffer&&s.isBuffer(e)?"nodebuffer":r.uint8array&&e instanceof Uint8Array?"uint8array":r.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},t.checkSupport=function(e){if(!r[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)r+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return r},t.delay=function(e,t,n){o((function(){e.apply(n||null,t||[])}))},t.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},t.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},t.prepareContent=function(e,n,s,o,c){return a.Promise.resolve(n).then((function(e){return r.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.error)},r.readAsArrayBuffer(e)})):e})).then((function(n){var h,u=t.getTypeOf(n);return u?("arraybuffer"===u?n=t.transformTo("uint8array",n):"string"===u&&(c?n=i.decode(n):s&&!0!==o&&(n=l(h=n,r.uint8array?new Uint8Array(h.length):new Array(h.length)))),n):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},function(e,t,n){"use strict";function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},e.exports=r},function(e,t,n){"use strict";if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,t.nodebuffer="undefined"!=typeof Buffer,t.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)t.blob=!1;else{var r=new ArrayBuffer(0);try{t.blob=0===new Blob([r],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(r),t.blob=0===i.getBlob("application/zip").size}catch(e){t.blob=!1}}}try{t.nodestream=!!n(29).Readable}catch(e){t.nodestream=!1}},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){var t,n,r,i,s,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)s=e[t],o.set(s,i),i+=s.length;return o}},o={arraySet:function(e,t,n,r,i){for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t,n){"use strict";var r,i=n(1),s=n(0),o=n(14),a=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r),c=new s.c("app","Firebase",a),l="[DEFAULT]",h=[],u=function(){function e(e,t,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=Object(s.k)(e),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(e){h.push(e),setTimeout((function(){return e(null)}),0)},removeAuthTokenListener:function(e){h=h.filter((function(t){return t!==e}))}}}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_(),t()})).then((function(){e.firebase_.INTERNAL.removeApp(e.name_);for(var t=[],n=0,r=Object.keys(e.services_);n<r.length;n++)for(var i=r[n],s=0,o=Object.keys(e.services_[i]);s<o.length;s++){var a=o[s];t.push(e.services_[i][a])}return Promise.all(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})))})).then((function(){e.isDeleted_=!0,e.services_={}}))},e.prototype._getService=function(e,t){if(void 0===t&&(t=l),this.checkDestroyed_(),this.services_[e]||(this.services_[e]={}),!this.services_[e][t]){var n=t!==l?t:void 0,r=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),n);this.services_[e][t]=r}return this.services_[e][t]},e.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=l),this.services_[e]&&this.services_[e][t]&&delete this.services_[e][t]},e.prototype.extendApp=function(e){var t=this;Object(s.l)(this,e),e.INTERNAL&&e.INTERNAL.addAuthTokenListener&&(h.forEach((function(e){t.INTERNAL.addAuthTokenListener(e)})),h=[])},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw c.create("app-deleted",{appName:this.name_})},e}();u.prototype.name&&u.prototype.options||u.prototype.delete||console.log("dc");var d="6.6.2",p=new o.b("@firebase/app");
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if(Object(s.o)()&&void 0!==self.firebase){p.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var f=self.firebase.SDK_VERSION;f&&f.indexOf("LITE")>=0&&p.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var g=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function e(){var t=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){var t={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={});if("object"!=typeof r||null===r){r={name:r}}var o=r;void 0===o.name&&(o.name=l);var a=o.name;if("string"!=typeof a||!a)throw c.create("bad-app-name",{appName:String(a)});if(Object(s.i)(t,a))throw c.create("duplicate-app",{appName:a});var u=new e(n,o,i);return t[a]=u,h(u,"create"),u},app:o,apps:null,SDK_VERSION:d,INTERNAL:{registerService:function(t,l,h,u,d){void 0===d&&(d=!1);if(n[t])return p.debug("There were multiple attempts to register service "+t+"."),i[t];n[t]=l,u&&(r[t]=u,a().forEach((function(e){u("create",e)})));function f(e){if(void 0===e&&(e=o()),"function"!=typeof e[t])throw c.create("invalid-app-argument",{appName:t});return e[t]()}void 0!==h&&Object(s.l)(f,h);return i[t]=f,e.prototype[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=this._getService.bind(this,t);return r.apply(this,d?e:[])},f},removeApp:function(e){h(t[e],"delete"),delete t[e]},factories:n,useAsService:u}};function o(e){if(e=e||l,!Object(s.i)(t,e))throw c.create("no-app",{appName:e});return t[e]}function a(){return Object.keys(t).map((function(e){return t[e]}))}function h(e,t){for(var i=0,s=Object.keys(n);i<s.length;i++){var o=u(e,s[i]);if(null===o)return;r[o]&&r[o](t,e)}}function u(e,t){return"serverAuth"===t?null:t}return(i.default=i,Object.defineProperty(i,"apps",{get:a}),o.App=e,i)}(u);return t.INTERNAL=Object(i.a)({},t.INTERNAL,{createFirebaseNamespace:e,extendNamespace:function(e){Object(s.l)(t,e)},createSubscribe:s.j,ErrorFactory:s.c,deepExtend:s.l}),t}(),m=g.initializeApp;g.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(s.r)()&&p.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),m.apply(void 0,e)};var y=g;t.a=y},function(e,t,n){"use strict";for(var r=n(2),i=n(4),s=n(19),o=n(3),a=new Array(256),c=0;c<256;c++)a[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;a[254]=a[254]=1;function l(){o.call(this,"utf-8 decode"),this.leftOver=null}function h(){o.call(this,"utf-8 encode")}t.utf8encode=function(e){return i.nodebuffer?s.newBufferFrom(e,"utf-8"):function(e){var t,n,r,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=i.uint8array?new Uint8Array(c):new Array(c),o=0,s=0;o<c;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t}(e)},t.utf8decode=function(e){return i.nodebuffer?r.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,i,s,o=e.length,c=new Array(2*o);for(n=0,t=0;t<o;)if((i=e[t++])<128)c[n++]=i;else if((s=a[i])>4)c[n++]=65533,t+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&t<o;)i=i<<6|63&e[t++],s--;s>1?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return c.length!==n&&(c.subarray?c=c.subarray(0,n):c.length=n),r.applyFromCharCode(c)}(e=r.transformTo(i.uint8array?"uint8array":"array",e))},r.inherits(l,o),l.prototype.processChunk=function(e){var n=r.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var s=n;(n=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),n.set(s,this.leftOver.length)}else n=this.leftOver.concat(n);this.leftOver=null}var o=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+a[e[n]]>t?n:t}(n),c=n;o!==n.length&&(i.uint8array?(c=n.subarray(0,o),this.leftOver=n.subarray(o,n.length)):(c=n.slice(0,o),this.leftOver=n.slice(o,n.length))),this.push({data:t.utf8decode(c),meta:e.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=l,r.inherits(h,o),h.prototype.processChunk=function(e){this.push({data:t.utf8encode(e.data),meta:e.meta})},t.Utf8EncodeWorker=h},function(e,t,n){"use strict";var r=n(17),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=u;var s=n(9);s.inherits=n(10);var o=n(30),a=n(34);s.inherits(u,o);for(var c=i(a.prototype),l=0;l<c.length;l++){var h=c[l];u.prototype[h]||(u.prototype[h]=a.prototype[h])}function u(e){if(!(this instanceof u))return new u(e);o.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),u.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=Buffer.isBuffer},function(e,t,n){try{var r=n(18);if("function"!=typeof r.inherits)throw"";e.exports=r.inherits}catch(t){e.exports=n(67)}},function(e,t,n){"use strict";var r=null;r="undefined"!=typeof Promise?Promise:n(73),e.exports={Promise:r}},function(e,t,n){"use strict";e.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var r,i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));var s=r.INFO,o=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(t<e.logLevel)){var s=(new Date).toISOString();switch(t){case r.DEBUG:case r.VERBOSE:console.log.apply(console,["["+s+"]  "+e.name+":"].concat(n));break;case r.INFO:console.info.apply(console,["["+s+"]  "+e.name+":"].concat(n));break;case r.WARN:console.warn.apply(console,["["+s+"]  "+e.name+":"].concat(n));break;case r.ERROR:console.error.apply(console,["["+s+"]  "+e.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}}},a=function(){function e(e){this.name=e,this._logLevel=s,this._logHandler=o,i.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in r))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!0,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.DEBUG].concat(e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.VERBOSE].concat(e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.INFO].concat(e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.WARN].concat(e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.ERROR].concat(e))},e}()},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";"undefined"==typeof process||!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,s,o=arguments.length;switch(o){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick((function(){e.call(null,t)}));case 3:return process.nextTick((function(){e.call(null,t,n)}));case 4:return process.nextTick((function(){e.call(null,t,n,r)}));default:for(i=new Array(o-1),s=0;s<i.length;)i[s++]=arguments[s];return process.nextTick((function(){e.apply(null,i)}))}}}:e.exports=process},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},function(e,t,n){"use strict";const r=n(99),i=n(100),s=n(27),o=n(12),a=Buffer.from([0,0,255,255]),c=Buffer.from([0]),l=Symbol("permessage-deflate"),h=Symbol("write-in-progress"),u=Symbol("pending-close"),d=Symbol("total-length"),p=Symbol("callback"),f=Symbol("buffers"),g=Symbol("error");let m;function y(e){this[f].push(e),this[d]+=e.length}function _(e){this[d]+=e.length,this[l]._maxPayload<1||this[d]<=this[l]._maxPayload?this[f].push(e):(this[g]=new RangeError("Max payload size exceeded"),this[g][o.kStatusCode]=1009,this.removeListener("data",_),this.reset())}function v(e){this[l]._inflate=null,e[o.kStatusCode]=1007,this[p](e)}e.exports=class{constructor(e,t,n){if(this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!m){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;m=new r({concurrency:e})}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate[h]?this._inflate[u]=!0:(this._inflate.close(),this._inflate=null)),this._deflate&&(this._deflate[h]?this._deflate[u]=!0:(this._deflate.close(),this._deflate=null))}acceptAsServer(e){const t=this._options,n=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:!0!==n.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete n.client_max_window_bits,n}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{var n=e[t];if(n.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==n)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}e[t]=n})}),e}decompress(e,t,n){m.push(r=>{this._decompress(e,t,(e,t)=>{r(),n(e,t)})})}compress(e,t,n){m.push(r=>{this._compress(e,t,(e,t)=>{r(),n(e,t)})})}_decompress(e,t,n){const r=this._isServer?"client":"server";if(!this._inflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:t})),this._inflate[l]=this,this._inflate[d]=0,this._inflate[f]=[],this._inflate.on("error",v),this._inflate.on("data",_)}this._inflate[p]=n,this._inflate[h]=!0,this._inflate.write(e),t&&this._inflate.write(a),this._inflate.flush(()=>{const e=this._inflate[g];if(e)return this._inflate.close(),this._inflate=null,void n(e);const i=s.concat(this._inflate[f],this._inflate[d]);t&&this.params[`${r}_no_context_takeover`]||this._inflate[u]?(this._inflate.close(),this._inflate=null):(this._inflate[h]=!1,this._inflate[d]=0,this._inflate[f]=[]),n(null,i)})}_compress(e,t,n){if(!e||0===e.length)return void process.nextTick(n,null,c);const r=this._isServer?"server":"client";if(!this._deflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:t})),this._deflate[d]=0,this._deflate[f]=[],this._deflate.on("data",y)}this._deflate[h]=!0,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{var e=s.concat(this._deflate[f],this._deflate[d]);t&&(e=e.slice(0,e.length-4)),t&&this.params[`${r}_no_context_takeover`]||this._deflate[u]?(this._deflate.close(),this._deflate=null):(this._deflate[h]=!1,this._deflate[d]=0,this._deflate[f]=[]),n(null,e)})}}},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("events")},function(e,t,n){var r=n(32),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=o),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";var r=n(11),i=n(40),s=n(41),o=n(42);s=n(41);function a(e,t,n,r,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=r,this.compressedContent=i}a.prototype={getContentWorker:function(){var e=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,n){return e.pipe(new o).pipe(new s("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},e.exports=a},function(e,t,n){"use strict";var r=n(2);var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t){return void 0!==e&&e.length?"string"!==r.getTypeOf(e)?function(e,t,n,r){var s=i,o=r+n;e^=-1;for(var a=r;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,n,r){var s=i,o=r+n;e^=-1;for(var a=r;a<o;a++)e=e>>>8^s[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";function r(e,t){const n=Buffer.allocUnsafe(t);for(var r=0,i=0;i<e.length;i++){const t=e[i];t.copy(n,r),r+=t.length}return n}function i(e,t,n,r,i){for(var s=0;s<i;s++)n[r+s]=e[s]^t[3&s]}function s(e,t){const n=e.length;for(var r=0;r<n;r++)e[r]^=t[3&r]}try{const t=n(!function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}()),o=t.BufferUtil||t;e.exports={mask(e,t,n,r,s){s<48?i(e,t,n,r,s):o.mask(e,t,n,r,s)},unmask(e,t){e.length<32?s(e,t):o.unmask(e,t)},concat:r}}catch(t){e.exports={concat:r,mask:i,unmask:s}}},function(e,t){e.exports=require("os")},function(e,t,n){var r=n(21);"disable"===process.env.READABLE_STREAM&&r?(e.exports=r,(t=e.exports=r.Readable).Readable=r.Readable,t.Writable=r.Writable,t.Duplex=r.Duplex,t.Transform=r.Transform,t.PassThrough=r.PassThrough,t.Stream=r):((t=e.exports=n(30)).Stream=r||t,t.Readable=t,t.Writable=n(34),t.Duplex=n(8),t.Transform=n(36),t.PassThrough=n(71))},function(e,t,n){"use strict";var r=n(17);e.exports=_;var i,s=n(66);_.ReadableState=y;n(22).EventEmitter;var o=function(e,t){return e.listeners(t).length},a=n(31),c=n(23).Buffer,l=global.Uint8Array||function(){};var h=n(9);h.inherits=n(10);var u=n(18),d=void 0;d=u&&u.debuglog?u.debuglog("stream"):function(){};var p,f=n(68),g=n(33);h.inherits(_,a);var m=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var r=t instanceof(i=i||n(8));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var s=e.highWaterMark,o=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:r&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(35).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function _(e){if(i=i||n(8),!(this instanceof _))return new _(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function v(e,t,n,r,i){var s,o=e._readableState;null===t?(o.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,C(e)}(e,o)):(i||(s=function(e,t){var n;r=t,c.isBuffer(r)||r instanceof l||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(o,t)),s?e.emit("error",s):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?w(e,o,t,!1):k(e,o)):w(e,o,t,!1))):r||(o.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function w(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&C(e)),k(e,t)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=g.destroy,_.prototype._undestroy=g.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),n=!0),v(this,e,t,!1,n)},_.prototype.unshift=function(e){return v(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return p||(p=n(35).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var b=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=b?e=b:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function C(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(E,e):E(e))}function E(e){d("emit readable"),e.emit("readable"),I(e)}function k(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(x,e,t))}function x(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(d("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function T(e){d("readable nexttick read 0"),e.read(0)}function R(e,t){t.reading||(d("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function O(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;e-=i.length;for(;n=n.next;){var s=n.data,o=e>s.length?s.length:e;if(o===s.length?i+=s:i+=s.slice(0,e),0===(e-=o)){o===s.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=c.allocUnsafe(e),r=t.head,i=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var s=r.data,o=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,o),0===(e-=o)){o===s.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(o));break}++i}return t.length-=i,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function N(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(P,t,e))}function P(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function A(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}_.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?N(this):C(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&N(this),null;var r,i=t.needReadable;return d("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",i=!0),t.ended||t.reading?d("reading or ended",i=!1):i&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(n,t))),null===(r=e>0?O(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&N(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,d("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?l:_;function c(t,r){d("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,d("cleanup"),e.removeListener("close",m),e.removeListener("finish",y),e.removeListener("drain",h),e.removeListener("error",g),e.removeListener("unpipe",c),n.removeListener("end",l),n.removeListener("end",_),n.removeListener("data",f),u=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function l(){d("onend"),e.end()}i.endEmitted?r.nextTick(a):n.once("end",a),e.on("unpipe",c);var h=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,I(e))}}(n);e.on("drain",h);var u=!1;var p=!1;function f(t){d("ondata"),p=!1,!1!==e.write(t)||p||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==A(i.pipes,e))&&!u&&(d("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function g(t){d("onerror",t),_(),e.removeListener("error",g),0===o(e,"error")&&e.emit("error",t)}function m(){e.removeListener("finish",y),_()}function y(){d("onfinish"),e.removeListener("close",m),_()}function _(){d("unpipe"),n.unpipe(e)}return n.on("data",f),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",m),e.once("finish",y),e.emit("pipe",n),i.flowing||(d("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)r[s].emit("unpipe",this,n);return this}var o=A(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},_.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&C(this):r.nextTick(T,this))}return n},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(R,e,t))}(this,e)),this},_.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(d("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(d("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<m.length;s++)e.on(m[s],this.emit.bind(this,m[s]));return this._read=function(t){d("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=O},function(e,t,n){e.exports=n(21)},function(e,t){e.exports=require("buffer")},function(e,t,n){"use strict";var r=n(17);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";var r=n(17);function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=m;var s,o=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:r.nextTick;m.WritableState=g;var a=n(9);a.inherits=n(10);var c={deprecate:n(69)},l=n(31),h=n(23).Buffer,u=global.Uint8Array||function(){};var d,p=n(33);function f(){}function g(e,t){s=s||n(8),e=e||{};var a=t instanceof s;this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var c=e.highWaterMark,l=e.writableHighWaterMark,h=this.objectMode?16:16384;this.highWaterMark=c||0===c?c:a&&(l||0===l)?l:h,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,s=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,s){--t.pendingcb,n?(r.nextTick(s,i),r.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(s(i),e._writableState.errorEmitted=!0,e.emit("error",i),S(e,t))}(e,n,i,t,s);else{var a=w(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||v(e,n),i?o(_,e,n,a,s):_(e,n,a,s)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function m(e){if(s=s||n(8),!(d.call(m,this)||this instanceof s))return new m(e);this._writableState=new g(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function y(e,t,n,r,i,s,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function _(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),S(e,t)}function v(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,s=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)s[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;s.allBuffers=c,y(e,t,!0,t.length,s,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,h=n.encoding,u=n.callback;if(y(e,t,!1,t.objectMode?1:l.length,l,h,u),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function w(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)}))}function S(e,t){var n=w(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,r.nextTick(b,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}a.inherits(m,l),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(m,Symbol.hasInstance,{value:function(e){return!!d.call(this,e)||this===m&&(e&&e._writableState instanceof g)}})):d=function(e){return e instanceof this},m.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},m.prototype.write=function(e,t,n){var i,s=this._writableState,o=!1,a=!s.objectMode&&(i=e,h.isBuffer(i)||i instanceof u);return a&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof n&&(n=f),s.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),r.nextTick(t,n)}(this,n):(a||function(e,t,n,i){var s=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),r.nextTick(i,o),s=!1),s}(this,s,e,n))&&(s.pendingcb++,o=function(e,t,n,r,i,s){if(!n){var o=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,n));return t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:s,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else y(e,t,!1,a,r,i,s);return c}(this,s,a,e,t,n)),o},m.prototype.cork=function(){this._writableState.corked++},m.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||v(this,e))},m.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(m.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),m.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},m.prototype._writev=null,m.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n)},Object.defineProperty(m.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),m.prototype.destroy=p.destroy,m.prototype._undestroy=p.undestroy,m.prototype._destroy=function(e,t){this.end(),t(e)}},function(e,t,n){"use strict";var r=n(70).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=h,this.end=u,t=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function h(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},s.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=o(t[r]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if((i=o(t[r]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if((i=o(t[r]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=o;var r=n(8),i=n(9);function s(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){c(e,t,n)})):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(10),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";var r=n(2),i=n(4),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.encode=function(e){for(var t,n,i,o,a,c,l,h=[],u=0,d=e.length,p=d,f="string"!==r.getTypeOf(e);u<e.length;)p=d-u,f?(t=e[u++],n=u<d?e[u++]:0,i=u<d?e[u++]:0):(t=e.charCodeAt(u++),n=u<d?e.charCodeAt(u++):0,i=u<d?e.charCodeAt(u++):0),o=t>>2,a=(3&t)<<4|n>>4,c=p>1?(15&n)<<2|i>>6:64,l=p>2?63&i:64,h.push(s.charAt(o)+s.charAt(a)+s.charAt(c)+s.charAt(l));return h.join("")},t.decode=function(e){var t,n,r,o,a,c,l=0,h=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var u,d=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&d--,e.charAt(e.length-2)===s.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(u=i.uint8array?new Uint8Array(0|d):new Array(0|d);l<e.length;)t=s.indexOf(e.charAt(l++))<<2|(o=s.indexOf(e.charAt(l++)))>>4,n=(15&o)<<4|(a=s.indexOf(e.charAt(l++)))>>2,r=(3&a)<<6|(c=s.indexOf(e.charAt(l++))),u[h++]=t,64!==a&&(u[h++]=n),64!==c&&(u[h++]=r);return u}},function(e,t,n){"use strict";var r=n(2),i=n(75),s=n(3),o=n(37),a=n(4),c=n(11),l=null;if(a.nodestream)try{l=n(76)}catch(e){}function h(e,t){return new c.Promise((function(n,i){var s=[],a=e._internalType,c=e._outputType,l=e._mimeType;e.on("data",(function(e,n){s.push(e),t&&t(n)})).on("error",(function(e){s=[],i(e)})).on("end",(function(){try{var e=function(e,t,n){switch(e){case"blob":return r.newBlob(r.transformTo("arraybuffer",t),n);case"base64":return o.encode(t);default:return r.transformTo(e,t)}}(c,function(e,t){var n,r=0,i=null,s=0;for(n=0;n<t.length;n++)s+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(s),n=0;n<t.length;n++)i.set(t[n],r),r+=t[n].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(a,s),l);n(e)}catch(e){i(e)}s=[]})).resume()}))}function u(e,t,n){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=n,r.checkSupport(o),this._worker=e.pipe(new i(o)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return h(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,(function(e){t.call(n,e.data,e.meta)})):this._worker.on(e,(function(){r.delay(t,arguments,n)})),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(r.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},e)}},e.exports=u},function(e,t,n){"use strict";t.base64=!1,t.binary=!1,t.dir=!1,t.createFolders=!0,t.date=null,t.compression=null,t.compressionOptions=null,t.comment=null,t.unixPermissions=null,t.dosPermissions=null},function(e,t,n){"use strict";var r=n(2),i=n(3);function s(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}r.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},function(e,t,n){"use strict";var r=n(2),i=n(3);function s(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}r.inherits(s,i),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},e.exports=s},function(e,t,n){"use strict";var r=n(3),i=n(25);function s(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n(2).inherits(s,r),s.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},e.exports=s},function(e,t,n){"use strict";var r=n(3);t.STORE={magic:"\0\0",compressWorker:function(e){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},t.DEFLATE=n(79)},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,s=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{s=s+(i=i+t[r++]|0)|0}while(--o);i%=65521,s%=65521}return i|s<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var s=r,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},function(e,t,n){"use strict";var r=n(5),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var o=new r.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,t.string2buf=function(e){var t,n,i,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(c),o=0,s=0;o<c;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,s,a=t||e.length,l=new Array(2*a);for(r=0,n=0;n<a;)if((i=e[n++])<128)l[r++]=i;else if((s=o[i])>4)l[r++]=65533,n+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&n<a;)i=i<<6|63&e[n++],s--;s>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return c(l,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+o[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";t.LOCAL_FILE_HEADER="PK",t.CENTRAL_FILE_HEADER="PK",t.CENTRAL_DIRECTORY_END="PK",t.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",t.ZIP64_CENTRAL_DIRECTORY_END="PK",t.DATA_DESCRIPTOR="PK\b"},function(e,t,n){"use strict";var r=n(2),i=n(4),s=n(51),o=n(93),a=n(94),c=n(53);e.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new a(e):i.uint8array?new c(r.transformTo("uint8array",e)):new s(r.transformTo("array",e)):new o(e)}},function(e,t,n){"use strict";var r=n(52);function i(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}n(2).inherits(i,r),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;s>=0;--s)if(this.data[s]===t&&this.data[s+1]===n&&this.data[s+2]===r&&this.data[s+3]===i)return s-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&n===s[1]&&r===s[2]&&i===s[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(2);function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},e.exports=i},function(e,t,n){"use strict";var r=n(51);function i(e){r.call(this,e)}n(2).inherits(i,r),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t){e.exports=require("assert")},function(e,t,n){"use strict";const r=n(22),i=n(13),s=n(96),o=n(56),a=n(97),c=n(98),l=n(57),h=n(20),u=n(101),d=n(58),p=n(12),f=n(59),g=n(61),m=["CONNECTING","OPEN","CLOSING","CLOSED"],y=p.kWebSocket,_=[8,13],v=3e4;class w extends r{constructor(e,t,n){super(),this.readyState=w.CONNECTING,this.protocol="",this._binaryType=p.BINARY_TYPES[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._isServer=!0,this._receiver=null,this._sender=null,this._socket=null,null!==e&&(Array.isArray(t)?t=t.join(", "):"object"==typeof t&&null!==t&&(n=t,t=void 0),b.call(this,e,t,n))}get CONNECTING(){return w.CONNECTING}get CLOSING(){return w.CLOSING}get CLOSED(){return w.CLOSED}get OPEN(){return w.OPEN}get binaryType(){return this._binaryType}set binaryType(e){p.BINARY_TYPES.indexOf(e)<0||(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){const r=new f(this._binaryType,this._extensions,n);this._sender=new g(e,this._extensions),this._receiver=r,this._socket=e,r[y]=this,e[y]=this,r.on("conclude",k),r.on("drain",x),r.on("error",T),r.on("message",I),r.on("ping",O),r.on("pong",N),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",P),e.on("data",A),e.on("end",M),e.on("error",D),this.readyState=w.OPEN,this.emit("open")}emitClose(){this.readyState=w.CLOSED,this._socket?(this._extensions[h.extensionName]&&this._extensions[h.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)):this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==w.CLOSED){if(this.readyState===w.CONNECTING){const e="WebSocket was closed before the connection was established";return E(this,this._req,e)}this.readyState!==w.CLOSING?(this.readyState=w.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,this._socket.writable&&(this._closeFrameReceived&&this._socket.end(),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),v)))})):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}ping(e,t,n){if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),this.readyState!==w.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${m[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=e.toString()),void 0===t&&(t=!this._isServer),this._sender.ping(e||p.EMPTY_BUFFER,t,n)}pong(e,t,n){if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),this.readyState!==w.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${m[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=e.toString()),void 0===t&&(t=!this._isServer),this._sender.pong(e||p.EMPTY_BUFFER,t,n)}send(e,t,n){if("function"==typeof t&&(n=t,t={}),this.readyState!==w.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${m[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=e.toString());const r=Object.assign({binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[h.extensionName]||(r.compress=!1),this._sender.send(e||p.EMPTY_BUFFER,r,n)}terminate(){if(this.readyState!==w.CLOSED){if(this.readyState===w.CONNECTING){const e="WebSocket was closed before the connection was established";return E(this,this._req,e)}this._socket&&(this.readyState=w.CLOSING,this._socket.destroy())}}}function b(e,t,n){if(n=Object.assign({protocolVersion:_[1],perMessageDeflate:!0,maxPayload:104857600},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0}),-1===_.indexOf(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} `+`(supported versions: ${_.join(", ")})`);var r;this._isServer=!1,"object"==typeof e&&void 0!==e.href?(r=e,this.url=e.href):(r=l.parse(e),this.url=e);const a="ws+unix:"===r.protocol;if(!(r.host||a&&r.pathname))throw new Error(`Invalid URL: ${this.url}`);const c="wss:"===r.protocol||"https:"===r.protocol,u=i.randomBytes(16).toString("base64"),f=c?s:o,g=r.search?`${r.pathname||"/"}${r.search}`:r.pathname||"/";var m;if(n.createConnection=c?C:S,n.port=r.port||(c?443:80),n.host=r.hostname.startsWith("[")?r.hostname.slice(1,-1):r.hostname,n.headers=Object.assign({"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},n.headers),n.path=g,n.perMessageDeflate&&(m=new h(!0!==n.perMessageDeflate?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=d.format({[h.extensionName]:m.offer()})),t&&(n.headers["Sec-WebSocket-Protocol"]=t),n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),r.auth?n.auth=r.auth:(r.username||r.password)&&(n.auth=`${r.username}:${r.password}`),a){const e=g.split(":");n.socketPath=e[0],n.path=e[1]}var y=this._req=f.get(n);n.handshakeTimeout&&y.setTimeout(n.handshakeTimeout,()=>E(this,y,"Opening handshake has timed out")),y.on("error",e=>{this._req.aborted||(y=this._req=null,this.readyState=w.CLOSING,this.emit("error",e),this.emitClose())}),y.on("response",e=>{this.emit("unexpected-response",y,e)||E(this,y,`Unexpected server response: ${e.statusCode}`)}),y.on("upgrade",(e,r,s)=>{if(this.emit("upgrade",e),this.readyState!==w.CONNECTING)return;y=this._req=null;const o=i.createHash("sha1").update(u+p.GUID,"binary").digest("base64");if(e.headers["sec-websocket-accept"]!==o)return void E(this,r,"Invalid Sec-WebSocket-Accept header");const a=e.headers["sec-websocket-protocol"],c=(t||"").split(/, */);var l;if(!t&&a?l="Server sent a subprotocol but none was requested":t&&!a?l="Server sent no subprotocol":a&&-1===c.indexOf(a)&&(l="Server sent an invalid subprotocol"),l)E(this,r,l);else{if(a&&(this.protocol=a),m)try{const t=d.parse(e.headers["sec-websocket-extensions"]);t[h.extensionName]&&(m.accept(t[h.extensionName]),this._extensions[h.extensionName]=m)}catch(e){return void E(this,r,"Invalid Sec-WebSocket-Extensions header")}this.setSocket(r,s,n.maxPayload)}})}function S(e){return e.protocolVersion&&(e.path=e.socketPath),a.connect(e)}function C(e){return e.path=void 0,e.servername=e.servername||e.host,c.connect(e)}function E(e,t,n){e.readyState=w.CLOSING;const r=new Error(n);Error.captureStackTrace(r,E),t.setHeader?(t.abort(),t.once("abort",e.emitClose.bind(e)),e.emit("error",r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function k(e,t){const n=this[y];n._socket.removeListener("data",A),n._socket.resume(),n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,1005===e?n.close():n.close(e,t)}function x(){this[y]._socket.resume()}function T(e){const t=this[y];t._socket.removeListener("data",A),t.readyState=w.CLOSING,t._closeCode=e[p.kStatusCode],t.emit("error",e),t._socket.destroy()}function R(){this[y].emitClose()}function I(e){this[y].emit("message",e)}function O(e){const t=this[y];t.pong(e,!t._isServer,p.NOOP),t.emit("ping",e)}function N(e){this[y].emit("pong",e)}function P(){const e=this[y];this.removeListener("close",P),this.removeListener("end",M),e.readyState=w.CLOSING,e._socket.read(),e._receiver.end(),this.removeListener("data",A),this[y]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",R),e._receiver.on("finish",R))}function A(e){this[y]._receiver.write(e)||this.pause()}function M(){const e=this[y];e.readyState=w.CLOSING,e._receiver.end(),this.end()}function D(){const e=this[y];this.removeListener("error",D),this.on("error",p.NOOP),e&&(e.readyState=w.CLOSING,this.destroy())}m.forEach((e,t)=>{w[m[t]]=t}),["open","error","close","message"].forEach(e=>{Object.defineProperty(w.prototype,`on${e}`,{get(){const t=this.listeners(e);for(var n=0;n<t.length;n++)if(t[n]._listener)return t[n]._listener},set(t){const n=this.listeners(e);for(var r=0;r<n.length;r++)n[r]._listener&&this.removeListener(e,n[r]);this.addEventListener(e,t)}})}),w.prototype.addEventListener=u.addEventListener,w.prototype.removeEventListener=u.removeEventListener,e.exports=w},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("url")},function(e,t,n){"use strict";const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function i(e,t,n){Object.prototype.hasOwnProperty.call(e,t)?e[t].push(n):e[t]=[n]}e.exports={format:function(e){return Object.keys(e).map(t=>{var n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{var n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t={};if(void 0===e||""===e)return t;for(var n,s,o={},a=!1,c=!1,l=!1,h=-1,u=-1,d=0;d<e.length;d++){const f=e.charCodeAt(d);if(void 0===n)if(-1===u&&1===r[f])-1===h&&(h=d);else if(32===f||9===f)-1===u&&-1!==h&&(u=d);else{if(59!==f&&44!==f)throw new SyntaxError(`Unexpected character at index ${d}`);{if(-1===h)throw new SyntaxError(`Unexpected character at index ${d}`);-1===u&&(u=d);const r=e.slice(h,u);44===f?(i(t,r,o),o={}):n=r,h=u=-1}}else if(void 0===s)if(-1===u&&1===r[f])-1===h&&(h=d);else if(32===f||9===f)-1===u&&-1!==h&&(u=d);else if(59===f||44===f){if(-1===h)throw new SyntaxError(`Unexpected character at index ${d}`);-1===u&&(u=d),i(o,e.slice(h,u),!0),44===f&&(i(t,n,o),o={},n=void 0),h=u=-1}else{if(61!==f||-1===h||-1!==u)throw new SyntaxError(`Unexpected character at index ${d}`);s=e.slice(h,d),h=u=-1}else if(c){if(1!==r[f])throw new SyntaxError(`Unexpected character at index ${d}`);-1===h?h=d:a||(a=!0),c=!1}else if(l)if(1===r[f])-1===h&&(h=d);else if(34===f&&-1!==h)l=!1,u=d;else{if(92!==f)throw new SyntaxError(`Unexpected character at index ${d}`);c=!0}else if(34===f&&61===e.charCodeAt(d-1))l=!0;else if(-1===u&&1===r[f])-1===h&&(h=d);else if(-1===h||32!==f&&9!==f){if(59!==f&&44!==f)throw new SyntaxError(`Unexpected character at index ${d}`);if(-1===h)throw new SyntaxError(`Unexpected character at index ${d}`);-1===u&&(u=d);var p=e.slice(h,u);a&&(p=p.replace(/\\/g,""),a=!1),i(o,s,p),44===f&&(i(t,n,o),o={},n=void 0),s=void 0,h=u=-1}else-1===u&&(u=d)}if(-1===h||l)throw new SyntaxError("Unexpected end of input");-1===u&&(u=d);const f=e.slice(h,u);return void 0===n?i(t,f,{}):(void 0===s?i(o,f,!0):i(o,s,a?f.replace(/\\/g,""):f),i(t,n,o)),t}}},function(e,t,n){"use strict";const r=n(21),i=n(20),s=n(27),o=n(60),a=n(12),c=0,l=1,h=2,u=3,d=4,p=5;class f extends r.Writable{constructor(e,t,n){super(),this._binaryType=e||a.BINARY_TYPES[0],this[a.kWebSocket]=void 0,this._extensions=t||{},this._maxPayload=0|n,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=c,this._loop=!1}_write(e,t,n){if(8===this._opcode)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const n=this._buffers[0];e>=n.length?this._buffers.shift().copy(t,t.length-e):(n.copy(t,t.length-e,0,e),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do{switch(this._state){case c:t=this.getInfo();break;case l:t=this.getPayloadLength16();break;case h:t=this.getPayloadLength64();break;case u:this.getMask();break;case d:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,g(RangeError,"RSV2 and RSV3 must be clear",!0,1002);const t=64==(64&e[0]);if(t&&!this._extensions[i.extensionName])return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,g(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,g(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,g(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin)return this._loop=!1,g(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,g(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),126===this._payloadLength)this._state=l;else{if(127!==this._payloadLength)return this.haveLength();this._state=h}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,g(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,g(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=u:this._state=d}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=d)}getData(e){var t=a.EMPTY_BUFFER;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&s.unmask(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=p,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(g(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(n)}const r=this.dataMessage();if(r)return t(r);this.startLoop(t)})}dataMessage(){if(this._fin){const t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){var e;e="nodebuffer"===this._binaryType?m(n,t):"arraybuffer"===this._binaryType?function(e){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}(m(n,t)):n,this.emit("message",e)}else{const e=m(n,t);if(!o.isValidUTF8(e))return this._loop=!1,g(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",e.toString())}}this._state=c}controlMessage(e){if(8!==this._opcode)9===this._opcode?this.emit("ping",e):this.emit("pong",e),this._state=c;else if(this._loop=!1,0===e.length)this.emit("conclude",1005,""),this.end();else{if(1===e.length)return g(RangeError,"invalid payload length 1",!0,1002);{const t=e.readUInt16BE(0);if(!o.isValidStatusCode(t))return g(RangeError,`invalid status code ${t}`,!0,1002);const n=e.slice(2);if(!o.isValidUTF8(n))return g(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}}}function g(e,t,n,r){const i=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(i,g),i[a.kStatusCode]=r,i}function m(e,t){return 1===e.length?e[0]:e.length>1?s.concat(e,t):a.EMPTY_BUFFER}e.exports=f},function(e,t,n){"use strict";try{const e=n(!function(){var e=new Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e}());t.isValidUTF8="object"==typeof e?e.Validation.isValidUTF8:e}catch(e){t.isValidUTF8=()=>!0}t.isValidStatusCode=e=>e>=1e3&&e<=1013&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},function(e,t,n){"use strict";const r=n(13),i=n(20),s=n(27),o=n(60),a=n(12);class c{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const n=e.length<1024||t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);const a=Buffer.allocUnsafe(n?e.length+i:i);if(a[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(a[0]|=64),126===o?a.writeUInt16BE(e.length,2):127===o&&(a.writeUInt32BE(0,2),a.writeUInt32BE(e.length,6)),!t.mask)return a[1]=o,n?(e.copy(a,i),[a]):[a,e];const c=r.randomBytes(4);return a[1]=128|o,a[i-4]=c[0],a[i-3]=c[1],a[i-2]=c[2],a[i-1]=c[3],n?(s.mask(e,c,a,i,e.length),[a]):(s.mask(e,c,e,0,e.length),[a,e])}close(e,t,n,r){var i;if(void 0===e)i=a.EMPTY_BUFFER;else{if("number"!=typeof e||!o.isValidStatusCode(e))throw new TypeError("First argument must be a valid error code number");void 0===t||""===t?(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0):((i=Buffer.allocUnsafe(2+Buffer.byteLength(t))).writeUInt16BE(e,0),i.write(t,2))}this._deflating?this.enqueue([this.doClose,i,n,r]):this.doClose(i,n,r)}doClose(e,t,n){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){var r=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=l(e):(e=Buffer.from(e),r=!1)),this._deflating?this.enqueue([this.doPing,e,t,r,n]):this.doPing(e,t,r,n)}doPing(e,t,n,r){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),r)}pong(e,t,n){var r=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=l(e):(e=Buffer.from(e),r=!1)),this._deflating?this.enqueue([this.doPong,e,t,r,n]):this.doPong(e,t,r,n)}doPong(e,t,n,r){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),r)}send(e,t,n){var r=t.binary?2:1,s=t.compress,o=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=l(e):(e=Buffer.from(e),o=!1));const a=this._extensions[i.extensionName];if(this._firstFragment?(this._firstFragment=!1,s&&a&&(s=e.length>=a._threshold),this._compress=s):(s=!1,r=0),t.fin&&(this._firstFragment=!0),a){const i={fin:t.fin,rsv1:s,opcode:r,mask:t.mask,readOnly:o};this._deflating?this.enqueue([this.dispatch,e,this._compress,i,n]):this.dispatch(e,this._compress,i,n)}else this.sendFrame(c.frame(e,{fin:t.fin,rsv1:!1,opcode:r,mask:t.mask,readOnly:o}),n)}dispatch(e,t,n,r){if(!t)return void this.sendFrame(c.frame(e,n),r);const s=this._extensions[i.extensionName];this._deflating=!0,s.compress(e,n.fin,(e,t)=>{n.readOnly=!1,this.sendFrame(c.frame(t,n),r),this._deflating=!1,this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.write(e[0]),this._socket.write(e[1],t)):this._socket.write(e[0],t)}}function l(e){const t=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength?t.slice(e.byteOffset,e.byteOffset+e.byteLength):t}e.exports=c},function(e,t){function n(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}e.exports=function(e,t){t||(t={});var r={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(r.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?r.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach((function(e){r.bools[e]=!0}));var i={};Object.keys(t.alias||{}).forEach((function(e){i[e]=[].concat(t.alias[e]),i[e].forEach((function(t){i[t]=[e].concat(i[e].filter((function(e){return t!==e})))}))})),[].concat(t.string).filter(Boolean).forEach((function(e){r.strings[e]=!0,i[e]&&(r.strings[i[e]]=!0)}));var s=t.default||{},o={_:[]};Object.keys(r.bools).forEach((function(e){c(e,void 0!==s[e]&&s[e])}));var a=[];function c(e,t,s){if(!s||!r.unknownFn||function(e,t){return r.allBools&&/^--[^=]+$/.test(t)||r.strings[e]||r.bools[e]||i[e]}(e,s)||!1!==r.unknownFn(s)){var a=!r.strings[e]&&n(t)?Number(t):t;l(o,e.split("."),a),(i[e]||[]).forEach((function(e){l(o,e.split("."),a)}))}}function l(e,t,n){var i=e;t.slice(0,-1).forEach((function(e){void 0===i[e]&&(i[e]={}),i=i[e]}));var s=t[t.length-1];void 0===i[s]||r.bools[s]||"boolean"==typeof i[s]?i[s]=n:Array.isArray(i[s])?i[s].push(n):i[s]=[i[s],n]}function h(e){return i[e].some((function(e){return r.bools[e]}))}-1!==e.indexOf("--")&&(a=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var u=0;u<e.length;u++){var d=e[u];if(/^--.+=/.test(d)){var p=d.match(/^--([^=]+)=([\s\S]*)$/),f=p[1],g=p[2];r.bools[f]&&(g="false"!==g),c(f,g,d)}else if(/^--no-.+/.test(d)){c(f=d.match(/^--no-(.+)/)[1],!1,d)}else if(/^--.+/.test(d)){f=d.match(/^--(.+)/)[1];void 0===(v=e[u+1])||/^-/.test(v)||r.bools[f]||r.allBools||i[f]&&h(f)?/^(true|false)$/.test(v)?(c(f,"true"===v,d),u++):c(f,!r.strings[f]||"",d):(c(f,v,d),u++)}else if(/^-[^-]+/.test(d)){for(var m=d.slice(1,-1).split(""),y=!1,_=0;_<m.length;_++){var v;if("-"!==(v=d.slice(_+2))){if(/[A-Za-z]/.test(m[_])&&/=/.test(v)){c(m[_],v.split("=")[1],d),y=!0;break}if(/[A-Za-z]/.test(m[_])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(v)){c(m[_],v,d),y=!0;break}if(m[_+1]&&m[_+1].match(/\W/)){c(m[_],d.slice(_+2),d),y=!0;break}c(m[_],!r.strings[m[_]]||"",d)}else c(m[_],v,d)}f=d.slice(-1)[0];y||"-"===f||(!e[u+1]||/^(-|--)[^-]/.test(e[u+1])||r.bools[f]||i[f]&&h(f)?e[u+1]&&/true|false/.test(e[u+1])?(c(f,"true"===e[u+1],d),u++):c(f,!r.strings[f]||"",d):(c(f,e[u+1],d),u++))}else if(r.unknownFn&&!1===r.unknownFn(d)||o._.push(r.strings._||!n(d)?d:Number(d)),t.stopEarly){o._.push.apply(o._,e.slice(u+1));break}}return Object.keys(s).forEach((function(e){var t,n,r;t=o,n=e.split("."),r=t,n.slice(0,-1).forEach((function(e){r=r[e]||{}})),n[n.length-1]in r||(l(o,e.split("."),s[e]),(i[e]||[]).forEach((function(t){l(o,t.split("."),s[e])})))})),t["--"]?(o["--"]=new Array,a.forEach((function(e){o["--"].push(e)}))):a.forEach((function(e){o._.push(e)})),o}},function(e,t,n){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}r.prototype=n(65),r.prototype.loadAsync=n(91),r.support=n(4),r.defaults=n(39),r.version="3.2.0",r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=n(11),e.exports=r},function(e,t,n){"use strict";const r=n(55);r.Server=n(102),r.Receiver=n(59),r.Sender=n(61),e.exports=r},function(e,t,n){"use strict";var r=n(7),i=n(2),s=n(3),o=n(38),a=n(39),c=n(24),l=n(77),h=n(78),u=n(19),d=n(90),p=function(e,t,n){var r,o=i.getTypeOf(t),h=i.extend(n||{},a);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(e=g(e)),h.createFolders&&(r=f(e))&&m.call(this,r,!0);var p="string"===o&&!1===h.binary&&!1===h.base64;n&&void 0!==n.binary||(h.binary=!p),(t instanceof c&&0===t.uncompressedSize||h.dir||!t||0===t.length)&&(h.base64=!1,h.binary=!0,t="",h.compression="STORE",o="string");var y=null;y=t instanceof c||t instanceof s?t:u.isNode&&u.isStream(t)?new d(e,t):i.prepareContent(e,t,h.binary,h.optimizedBinaryString,h.base64);var _=new l(e,y,h);this.files[e]=_},f=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},m=function(e,t){return t=void 0!==t?t:a.createFolders,e=g(e),this.files[e]||p.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function y(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,r))},filter:function(e){var t=[];return this.forEach((function(n,r){e(n,r)&&t.push(r)})),t},file:function(e,t,n){if(1===arguments.length){if(y(e)){var r=e;return this.filter((function(e,t){return!t.dir&&r.test(e)}))}var i=this.files[this.root+e];return i&&!i.dir?i:null}return(e=this.root+e,p.call(this,e,t,n),this)},folder:function(e){if(!e)return this;if(y(e))return this.filter((function(t,n){return n.dir&&e.test(t)}));var t=this.root+e,n=m.call(this,t),r=this.clone();return r.root=n.name,r},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter((function(t,n){return n.name.slice(0,e.length)===e})),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=i.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var a=n.comment||this.comment||"";t=h.generateWorker(this,n,a)}catch(e){(t=new s("error")).error(e)}return new o(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};e.exports=_},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){"use strict";var r=n(23).Buffer,i=n(18);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i,s=r.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=s,i=a,t.copy(n,i),a+=o.data.length,o=o.next;return s},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t,n){e.exports=n(18).deprecate},function(e,t,n){var r=n(32),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=o),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";e.exports=s;var r=n(36),i=n(9);function s(e){if(!(this instanceof s))return new s(e);r.call(this,e)}i.inherits=n(10),i.inherits(s,r),s.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},function(e,t,n){"use strict";var r=n(74);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];if(!process.browser)var l=["UNHANDLED"];function h(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,process.browser||(this.handled=l),e!==i&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)}))}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}var o=g((function(){t(i,r)}));"error"===o.status&&r(o.value)}function g(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=h,h.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))}))},h.prototype.catch=function(e){return this.then(null,e)},h.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);(process.browser||this.handled===l&&(this.handled=null),this.state!==c)?d(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t));return n},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=g(p,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t,process.browser||e.handled===l&&r((function(){e.handled===l&&process.emit("unhandledRejection",t,e)}));for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},h.resolve=function(e){if(e instanceof this)return e;return s.resolve(new this(i),e)},h.reject=function(e){var t=new this(i);return s.reject(t,e)},h.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=new Array(n),a=0,c=-1,l=new this(i);for(;++c<n;)h(e[c],c);return l;function h(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(l,o))}),(function(e){r||(r=!0,s.reject(l,e))}))}},h.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=-1,a=new this(i);for(;++o<n;)c=e[o],t.resolve(c).then((function(e){r||(r=!0,s.resolve(a,e))}),(function(e){r||(r=!0,s.reject(a,e))}));var c;return a}},function(e,t,n){"use strict";var r,i,s=global.MutationObserver||global.WebKitMutationObserver;if(process.browser)if(s){var o=0,a=new s(u),c=global.document.createTextNode("");a.observe(c,{characterData:!0}),r=function(){c.data=o=++o%2}}else if(global.setImmediate||void 0===global.MessageChannel)r="document"in global&&"onreadystatechange"in global.document.createElement("script")?function(){var e=global.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},global.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new global.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}else r=function(){process.nextTick(u)};var h=[];function u(){var e,t;i=!0;for(var n=h.length;n;){for(t=h,h=[],e=-1;++e<n;)t[e]();n=h.length}i=!1}e.exports=function(e){1!==h.push(e)||i||r()}},function(e,t,n){"use strict";var r=n(3),i=n(2);function s(e){r.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(s,r),s.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},e.exports=s},function(e,t,n){"use strict";var r=n(29).Readable;function i(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),n&&n(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}n(2).inherits(i,r),i.prototype._read=function(){this._helper.resume()},e.exports=i},function(e,t,n){"use strict";var r=n(38),i=n(40),s=n(7),o=n(24),a=n(3),c=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};c.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!i&&(t=t.pipe(new s.Utf8EncodeWorker)),!o&&i&&(t=t.pipe(new s.Utf8DecodeWorker))}catch(e){(t=new a("error")).error(e)}return new r(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new s.Utf8EncodeWorker)),o.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof a?this._data:new i(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<l.length;u++)c.prototype[l[u]]=h;e.exports=c},function(e,t,n){"use strict";var r=n(43),i=n(89);t.generateWorker=function(e,t,n){var s=new i(t.streamFiles,n,t.platform,t.encodeFileName),o=0;try{e.forEach((function(e,n){o++;var i=function(e,t){var n=e||t,i=r[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(n.options.compression,t.compression),a=n.options.compressionOptions||t.compressionOptions||{},c=n.dir,l=n.date;n._compressWorker(i,a).withStreamInfo("file",{name:e,dir:c,date:l,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(s)})),s.entriesCount=o}catch(e){s.error(e)}return s}},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=n(80),s=n(2),o=n(3),a=r?"uint8array":"array";function c(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}t.magic="\b\0",s.inherits(c,o),c.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(a,e.data),!1)},c.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},t.compressWorker=function(e){return new c("Deflate",e)},t.uncompressWorker=function(){return new c("Inflate",{})}},function(e,t,n){"use strict";var r={};(0,n(5).assign)(r,n(81),n(84),n(48)),e.exports=r},function(e,t,n){"use strict";var r=n(82),i=n(5),s=n(46),o=n(26),a=n(47),c=Object.prototype.toString,l=0,h=-1,u=0,d=8;function p(e){if(!(this instanceof p))return new p(e);this.options=i.assign({level:h,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==l)throw new Error(o[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var f;if(f="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=r.deflateSetDictionary(this.strm,f))!==l)throw new Error(o[n]);this._dict_set=!0}}function f(e,t){var n=new p(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}p.prototype.push=function(e,t){var n,o,a=this.strm,h=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=s.string2buf(e):"[object ArrayBuffer]"===c.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(h),a.next_out=0,a.avail_out=h),1!==(n=r.deflate(a,o))&&n!==l)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(s.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===o?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l):2!==o||(this.onEnd(l),a.avail_out=0,!0)},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=p,t.deflate=f,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,f(e,t)}},function(e,t,n){"use strict";var r,i=n(5),s=n(83),o=n(44),a=n(45),c=n(26),l=0,h=1,u=3,d=4,p=5,f=0,g=1,m=-2,y=-3,_=-5,v=-1,w=1,b=2,S=3,C=4,E=0,k=2,x=8,T=9,R=15,I=8,O=286,N=30,P=19,A=2*O+1,M=15,D=3,F=258,j=F+D+1,$=32,B=42,L=69,U=73,H=91,z=103,q=113,W=666,V=1,K=2,Q=3,G=4,Z=3;function Y(e,t){return e.msg=c[t],t}function X(e){return(e<<1)-(e>4?9:0)}function J(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function re(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t){var n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-j?e.strstart-(e.w_size-j):0,l=e.window,h=e.w_mask,u=e.prev,d=e.strstart+F,p=l[s+o-1],f=l[s+o];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(l[(n=t)+o]===f&&l[n+o-1]===p&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<d);if(r=F-(d-s),s=d-F,r>o){if(e.match_start=t,o=r,r>=a)break;p=l[s+o-1],f=l[s+o]}}}while((t=u[t&h])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead}function se(e){var t,n,r,s,c,l,h,u,d,p,f=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-j)){i.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=f?r-f:0}while(--n);t=n=f;do{r=e.prev[--t],e.prev[t]=r>=f?r-f:0}while(--n);s+=f}if(0===e.strm.avail_in)break;if(l=e.strm,h=e.window,u=e.strstart+e.lookahead,d=s,p=void 0,(p=l.avail_in)>d&&(p=d),n=0===p?0:(l.avail_in-=p,i.arraySet(h,l.input,l.next_in,p,u),1===l.state.wrap?l.adler=o(l.adler,h,p,u):2===l.state.wrap&&(l.adler=a(l.adler,h,p,u)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=D)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+D-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<D)););}while(e.lookahead<j&&0!==e.strm.avail_in)}function oe(e,t){for(var n,r;;){if(e.lookahead<j){if(se(e),e.lookahead<j&&t===l)return V;if(0===e.lookahead)break}if(n=0,e.lookahead>=D&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+D-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-j&&(e.match_length=ie(e,n)),e.match_length>=D)if(r=s._tr_tally(e,e.strstart-e.match_start,e.match_length-D),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=D){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+D-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(te(e,!1),0===e.strm.avail_out))return V}return e.insert=e.strstart<D-1?e.strstart:D-1,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?V:K}function ae(e,t){for(var n,r,i;;){if(e.lookahead<j){if(se(e),e.lookahead<j&&t===l)return V;if(0===e.lookahead)break}if(n=0,e.lookahead>=D&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+D-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=D-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-j&&(e.match_length=ie(e,n),e.match_length<=5&&(e.strategy===w||e.match_length===D&&e.strstart-e.match_start>4096)&&(e.match_length=D-1)),e.prev_length>=D&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-D,r=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-D),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+D-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=D-1,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return V}else if(e.match_available){if((r=s._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return V}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<D-1?e.strstart:D-1,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?V:K}function ce(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*A),this.dyn_dtree=new i.Buf16(2*(2*N+1)),this.bl_tree=new i.Buf16(2*(2*P+1)),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(M+1),this.heap=new i.Buf16(2*O+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*O+1),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function he(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=k,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?B:q,e.adler=2===t.wrap?0:1,t.last_flush=l,s._tr_init(t),f):Y(e,m)}function ue(e){var t,n=he(e);return n===f&&((t=e.state).window_size=2*t.w_size,J(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=D-1,t.match_available=0,t.ins_h=0),n}function de(e,t,n,r,s,o){if(!e)return m;var a=1;if(t===v&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),s<1||s>T||n!==x||r<8||r>15||t<0||t>9||o<0||o>C)return Y(e,m);8===r&&(r=9);var c=new le;return e.state=c,c.strm=e,c.wrap=a,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+D-1)/D),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=o,c.method=n,ue(e)}r=[new ce(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(se(e),0===e.lookahead&&t===l)return V;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,te(e,!1),0===e.strm.avail_out))return V;if(e.strstart-e.block_start>=e.w_size-j&&(te(e,!1),0===e.strm.avail_out))return V}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),V)})),new ce(4,4,8,4,oe),new ce(4,5,16,8,oe),new ce(4,6,32,32,oe),new ce(4,4,16,16,ae),new ce(8,16,32,32,ae),new ce(8,16,128,128,ae),new ce(8,32,128,256,ae),new ce(32,128,258,1024,ae),new ce(32,258,258,4096,ae)],t.deflateInit=function(e,t){return de(e,t,x,R,I,E)},t.deflateInit2=de,t.deflateReset=ue,t.deflateResetKeep=he,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?m:(e.state.gzhead=t,f):m},t.deflate=function(e,t){var n,i,o,c;if(!e||!e.state||t>p||t<0)return e?Y(e,m):m;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===W&&t!==d)return Y(e,0===e.avail_out?_:m);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===B)if(2===i.wrap)e.adler=0,ne(i,31),ne(i,139),ne(i,8),i.gzhead?(ne(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ne(i,255&i.gzhead.time),ne(i,i.gzhead.time>>8&255),ne(i,i.gzhead.time>>16&255),ne(i,i.gzhead.time>>24&255),ne(i,9===i.level?2:i.strategy>=b||i.level<2?4:0),ne(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(ne(i,255&i.gzhead.extra.length),ne(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=a(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=L):(ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,9===i.level?2:i.strategy>=b||i.level<2?4:0),ne(i,Z),i.status=q);else{var y=x+(i.w_bits-8<<4)<<8;y|=(i.strategy>=b||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=$),y+=31-y%31,i.status=q,re(i,y),0!==i.strstart&&(re(i,e.adler>>>16),re(i,65535&e.adler)),e.adler=1}if(i.status===L)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending!==i.pending_buf_size));)ne(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,ne(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===c&&(i.gzindex=0,i.status=H)}else i.status=H;if(i.status===H)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,ne(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===c&&(i.status=z)}else i.status=z;if(i.status===z&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(ne(i,255&e.adler),ne(i,e.adler>>8&255),e.adler=0,i.status=q)):i.status=q),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,f}else if(0===e.avail_in&&X(t)<=X(n)&&t!==d)return Y(e,_);if(i.status===W&&0!==e.avail_in)return Y(e,_);if(0!==e.avail_in||0!==i.lookahead||t!==l&&i.status!==W){var v=i.strategy===b?function(e,t){for(var n;;){if(0===e.lookahead&&(se(e),0===e.lookahead)){if(t===l)return V;break}if(e.match_length=0,n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return V}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?V:K}(i,t):i.strategy===S?function(e,t){for(var n,r,i,o,a=e.window;;){if(e.lookahead<=F){if(se(e),e.lookahead<=F&&t===l)return V;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=D&&e.strstart>0&&(r=a[i=e.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){o=e.strstart+F;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);e.match_length=F-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=D?(n=s._tr_tally(e,1,e.match_length-D),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return V}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?V:K}(i,t):r[i.level].func(i,t);if(v!==Q&&v!==G||(i.status=W),v===V||v===Q)return 0===e.avail_out&&(i.last_flush=-1),f;if(v===K&&(t===h?s._tr_align(i):t!==p&&(s._tr_stored_block(i,0,0,!1),t===u&&(J(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,f}return t!==d?f:i.wrap<=0?g:(2===i.wrap?(ne(i,255&e.adler),ne(i,e.adler>>8&255),ne(i,e.adler>>16&255),ne(i,e.adler>>24&255),ne(i,255&e.total_in),ne(i,e.total_in>>8&255),ne(i,e.total_in>>16&255),ne(i,e.total_in>>24&255)):(re(i,e.adler>>>16),re(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?f:g)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==B&&t!==L&&t!==U&&t!==H&&t!==z&&t!==q&&t!==W?Y(e,m):(e.state=null,t===q?Y(e,y):f):m},t.deflateSetDictionary=function(e,t){var n,r,s,a,c,l,h,u,d=t.length;if(!e||!e.state)return m;if(2===(a=(n=e.state).wrap)||1===a&&n.status!==B||n.lookahead)return m;for(1===a&&(e.adler=o(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===a&&(J(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new i.Buf8(n.w_size),i.arraySet(u,t,d-n.w_size,n.w_size,0),t=u,d=n.w_size),c=e.avail_in,l=e.next_in,h=e.input,e.avail_in=d,e.next_in=0,e.input=t,se(n);n.lookahead>=D;){r=n.strstart,s=n.lookahead-(D-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+D-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--s);n.strstart=r,n.lookahead=D-1,se(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=D-1,n.match_available=0,e.next_in=l,e.input=h,e.avail_in=c,n.wrap=a,f},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(5),i=4,s=0,o=1,a=2;function c(e){for(var t=e.length;--t>=0;)e[t]=0}var l=0,h=1,u=2,d=29,p=256,f=p+1+d,g=30,m=19,y=2*f+1,_=15,v=16,w=7,b=256,S=16,C=17,E=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=new Array(2*(f+2));c(I);var O=new Array(2*g);c(O);var N=new Array(512);c(N);var P=new Array(256);c(P);var A=new Array(d);c(A);var M,D,F,j=new Array(g);function $(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function B(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function L(e){return e<256?N[e]:N[256+(e>>>7)]}function U(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function H(e,t,n){e.bi_valid>v-n?(e.bi_buf|=t<<e.bi_valid&65535,U(e,e.bi_buf),e.bi_buf=t>>v-e.bi_valid,e.bi_valid+=n-v):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function z(e,t,n){H(e,n[2*t],n[2*t+1])}function q(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function W(e,t,n){var r,i,s=new Array(_+1),o=0;for(r=1;r<=_;r++)s[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var a=e[2*i+1];0!==a&&(e[2*i]=q(s[a]++,a))}}function V(e){var t;for(t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<g;t++)e.dyn_dtree[2*t]=0;for(t=0;t<m;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*b]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function K(e){e.bi_valid>8?U(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Q(e,t,n,r){var i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]}function G(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&Q(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Q(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function Z(e,t,n){var r,i,s,o,a=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],i=e.pending_buf[e.l_buf+a],a++,0===r?z(e,i,t):(z(e,(s=P[i])+p+1,t),0!==(o=k[s])&&H(e,i-=A[s],o),z(e,s=L(--r),n),0!==(o=x[s])&&H(e,r-=j[s],o))}while(a<e.last_lit);z(e,b,t)}function Y(e,t){var n,r,i,s=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=y,n=0;n<c;n++)0!==s[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=o[2*i+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)G(e,s,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],G(e,s,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,s[2*i]=s[2*n]+s[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,s[2*n+1]=s[2*r+1]=i,e.heap[1]=i++,G(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,s,o,a,c=t.dyn_tree,l=t.max_code,h=t.stat_desc.static_tree,u=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(s=0;s<=_;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<y;n++)(s=c[2*c[2*(r=e.heap[n])+1]+1]+1)>f&&(s=f,g++),c[2*r+1]=s,r>l||(e.bl_count[s]++,o=0,r>=p&&(o=d[r-p]),a=c[2*r],e.opt_len+=a*(s+o),u&&(e.static_len+=a*(h[2*r+1]+o)));if(0!==g){do{for(s=f-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(s=f;0!==s;s--)for(r=e.bl_count[s];0!==r;)(i=e.heap[--n])>l||(c[2*i+1]!==s&&(e.opt_len+=(s-c[2*i+1])*c[2*i],c[2*i+1]=s),r--)}}(e,t),W(s,l,e.bl_count)}function X(e,t,n){var r,i,s=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++a<c&&i===o||(a<l?e.bl_tree[2*i]+=a:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[2*S]++):a<=10?e.bl_tree[2*C]++:e.bl_tree[2*E]++,a=0,s=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4))}function J(e,t,n){var r,i,s=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++a<c&&i===o)){if(a<l)do{z(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==s&&(z(e,i,e.bl_tree),a--),z(e,S,e.bl_tree),H(e,a-3,2)):a<=10?(z(e,C,e.bl_tree),H(e,a-3,3)):(z(e,E,e.bl_tree),H(e,a-11,7));a=0,s=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4)}}c(j);var ee=!1;function te(e,t,n,i){H(e,(l<<1)+(i?1:0),3),function(e,t,n,i){K(e),i&&(U(e,n),U(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(!function(){var e,t,n,r,i,s=new Array(_+1);for(n=0,r=0;r<d-1;r++)for(A[r]=n,e=0;e<1<<k[r];e++)P[n++]=r;for(P[n-1]=r,i=0,r=0;r<16;r++)for(j[r]=i,e=0;e<1<<x[r];e++)N[i++]=r;for(i>>=7;r<g;r++)for(j[r]=i<<7,e=0;e<1<<x[r]-7;e++)N[256+i++]=r;for(t=0;t<=_;t++)s[t]=0;for(e=0;e<=143;)I[2*e+1]=8,e++,s[8]++;for(;e<=255;)I[2*e+1]=9,e++,s[9]++;for(;e<=279;)I[2*e+1]=7,e++,s[7]++;for(;e<=287;)I[2*e+1]=8,e++,s[8]++;for(W(I,f+1,s),e=0;e<g;e++)O[2*e+1]=5,O[2*e]=q(e,5);M=new $(I,k,p+1,f,_),D=new $(O,x,0,g,_),F=new $(new Array(0),T,0,m,w)}(),ee=!0),e.l_desc=new B(e.dyn_ltree,M),e.d_desc=new B(e.dyn_dtree,D),e.bl_desc=new B(e.bl_tree,F),e.bi_buf=0,e.bi_valid=0,V(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,r){var c,l,d=0;e.level>0?(e.strm.data_type===a&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return s;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<p;t++)if(0!==e.dyn_ltree[2*t])return o;return s}(e)),Y(e,e.l_desc),Y(e,e.d_desc),d=function(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),Y(e,e.bl_desc),t=m-1;t>=3&&0===e.bl_tree[2*R[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),c=e.opt_len+3+7>>>3,(l=e.static_len+3+7>>>3)<=c&&(c=l)):c=l=n+5,n+4<=c&&-1!==t?te(e,t,n,r):e.strategy===i||l===c?(H(e,(h<<1)+(r?1:0),3),Z(e,I,O)):(H(e,(u<<1)+(r?1:0),3),function(e,t,n,r){var i;for(H(e,t-257,5),H(e,n-1,5),H(e,r-4,4),i=0;i<r;i++)H(e,e.bl_tree[2*R[i]+1],3);J(e,e.dyn_ltree,t-1),J(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),Z(e,e.dyn_ltree,e.dyn_dtree)),V(e),r&&K(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(P[n]+p+1)]++,e.dyn_dtree[2*L(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){H(e,h<<1,3),z(e,b,I),function(e){16===e.bi_valid?(U(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(85),i=n(5),s=n(46),o=n(48),a=n(26),c=n(47),l=n(88),h=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(a[n]);if(this.header=new l,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=s.string2buf(t.dictionary):"[object ArrayBuffer]"===h.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(a[n])}function d(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}u.prototype.push=function(e,t){var n,a,c,l,u,d=this.strm,p=this.options.chunkSize,f=this.options.dictionary,g=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=s.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(p),d.next_out=0,d.avail_out=p),(n=r.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&f&&(n=r.inflateSetDictionary(this.strm,f)),n===o.Z_BUF_ERROR&&!0===g&&(n=o.Z_OK,g=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==o.Z_STREAM_END&&(0!==d.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(c=s.utf8border(d.output,d.next_out),l=d.next_out-c,u=s.buf2string(d.output,c),d.next_out=l,d.avail_out=p-l,l&&i.arraySet(d.output,d.output,c,l,0),this.onData(u)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=u,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},function(e,t,n){"use strict";var r=n(5),i=n(44),s=n(45),o=n(86),a=n(87),c=0,l=1,h=2,u=4,d=5,p=6,f=0,g=1,m=2,y=-2,_=-3,v=-4,w=-5,b=8,S=1,C=2,E=3,k=4,x=5,T=6,R=7,I=8,O=9,N=10,P=11,A=12,M=13,D=14,F=15,j=16,$=17,B=18,L=19,U=20,H=21,z=22,q=23,W=24,V=25,K=26,Q=27,G=28,Z=29,Y=30,X=31,J=32,ee=852,te=592,ne=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function se(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,f):y}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,se(e)):y}function ae(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?y:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,oe(e))):y}function ce(e,t){var n,r;return e?(r=new ie,e.state=r,r.window=null,(n=ae(e,t))!==f&&(e.state=null),n):y}var le,he,ue=!0;function de(e){if(ue){var t;for(le=new r.Buf32(512),he=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(l,e.lens,0,288,le,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(h,e.lens,0,32,he,0,e.work,{bits:5}),ue=!1}e.lencode=le,e.lenbits=9,e.distcode=he,e.distbits=5}function pe(e,t,n,i){var s,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((s=o.wsize-o.wnext)>i&&(s=i),r.arraySet(o.window,t,n-i,s,o.wnext),(i-=s)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}t.inflateReset=oe,t.inflateReset2=ae,t.inflateResetKeep=se,t.inflateInit=function(e){return ce(e,ne)},t.inflateInit2=ce,t.inflate=function(e,t){var n,ee,te,ne,ie,se,oe,ae,ce,le,he,ue,fe,ge,me,ye,_e,ve,we,be,Se,Ce,Ee,ke,xe=0,Te=new r.Buf8(4),Re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return y;(n=e.state).mode===A&&(n.mode=M),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,se=e.avail_in,ae=n.hold,ce=n.bits,le=se,he=oe,Ce=f;e:for(;;)switch(n.mode){case S:if(0===n.wrap){n.mode=M;break}for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(2&n.wrap&&35615===ae){n.check=0,Te[0]=255&ae,Te[1]=ae>>>8&255,n.check=s(n.check,Te,2,0),ae=0,ce=0,n.mode=C;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&ae)<<8)+(ae>>8))%31){e.msg="incorrect header check",n.mode=Y;break}if((15&ae)!==b){e.msg="unknown compression method",n.mode=Y;break}if(ce-=4,Se=8+(15&(ae>>>=4)),0===n.wbits)n.wbits=Se;else if(Se>n.wbits){e.msg="invalid window size",n.mode=Y;break}n.dmax=1<<Se,e.adler=n.check=1,n.mode=512&ae?N:A,ae=0,ce=0;break;case C:for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(n.flags=ae,(255&n.flags)!==b){e.msg="unknown compression method",n.mode=Y;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Y;break}n.head&&(n.head.text=ae>>8&1),512&n.flags&&(Te[0]=255&ae,Te[1]=ae>>>8&255,n.check=s(n.check,Te,2,0)),ae=0,ce=0,n.mode=E;case E:for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.time=ae),512&n.flags&&(Te[0]=255&ae,Te[1]=ae>>>8&255,Te[2]=ae>>>16&255,Te[3]=ae>>>24&255,n.check=s(n.check,Te,4,0)),ae=0,ce=0,n.mode=k;case k:for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.xflags=255&ae,n.head.os=ae>>8),512&n.flags&&(Te[0]=255&ae,Te[1]=ae>>>8&255,n.check=s(n.check,Te,2,0)),ae=0,ce=0,n.mode=x;case x:if(1024&n.flags){for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.length=ae,n.head&&(n.head.extra_len=ae),512&n.flags&&(Te[0]=255&ae,Te[1]=ae>>>8&255,n.check=s(n.check,Te,2,0)),ae=0,ce=0}else n.head&&(n.head.extra=null);n.mode=T;case T:if(1024&n.flags&&((ue=n.length)>se&&(ue=se),ue&&(n.head&&(Se=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,ee,ne,ue,Se)),512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,n.length-=ue),n.length))break e;n.length=0,n.mode=R;case R:if(2048&n.flags){if(0===se)break e;ue=0;do{Se=ee[ne+ue++],n.head&&Se&&n.length<65536&&(n.head.name+=String.fromCharCode(Se))}while(Se&&ue<se);if(512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,Se)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=I;case I:if(4096&n.flags){if(0===se)break e;ue=0;do{Se=ee[ne+ue++],n.head&&Se&&n.length<65536&&(n.head.comment+=String.fromCharCode(Se))}while(Se&&ue<se);if(512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,Se)break e}else n.head&&(n.head.comment=null);n.mode=O;case O:if(512&n.flags){for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Y;break}ae=0,ce=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=A;break;case N:for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}e.adler=n.check=re(ae),ae=0,ce=0,n.mode=P;case P:if(0===n.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,m;e.adler=n.check=1,n.mode=A;case A:if(t===d||t===p)break e;case M:if(n.last){ae>>>=7&ce,ce-=7&ce,n.mode=Q;break}for(;ce<3;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}switch(n.last=1&ae,ce-=1,3&(ae>>>=1)){case 0:n.mode=D;break;case 1:if(de(n),n.mode=U,t===p){ae>>>=2,ce-=2;break e}break;case 2:n.mode=$;break;case 3:e.msg="invalid block type",n.mode=Y}ae>>>=2,ce-=2;break;case D:for(ae>>>=7&ce,ce-=7&ce;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if((65535&ae)!=(ae>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Y;break}if(n.length=65535&ae,ae=0,ce=0,n.mode=F,t===p)break e;case F:n.mode=j;case j:if(ue=n.length){if(ue>se&&(ue=se),ue>oe&&(ue=oe),0===ue)break e;r.arraySet(te,ee,ne,ue,ie),se-=ue,ne+=ue,oe-=ue,ie+=ue,n.length-=ue;break}n.mode=A;break;case $:for(;ce<14;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(n.nlen=257+(31&ae),ae>>>=5,ce-=5,n.ndist=1+(31&ae),ae>>>=5,ce-=5,n.ncode=4+(15&ae),ae>>>=4,ce-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Y;break}n.have=0,n.mode=B;case B:for(;n.have<n.ncode;){for(;ce<3;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.lens[Re[n.have++]]=7&ae,ae>>>=3,ce-=3}for(;n.have<19;)n.lens[Re[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ee={bits:n.lenbits},Ce=a(c,n.lens,0,19,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,Ce){e.msg="invalid code lengths set",n.mode=Y;break}n.have=0,n.mode=L;case L:for(;n.have<n.nlen+n.ndist;){for(;ye=(xe=n.lencode[ae&(1<<n.lenbits)-1])>>>16&255,_e=65535&xe,!((me=xe>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(_e<16)ae>>>=me,ce-=me,n.lens[n.have++]=_e;else{if(16===_e){for(ke=me+2;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae>>>=me,ce-=me,0===n.have){e.msg="invalid bit length repeat",n.mode=Y;break}Se=n.lens[n.have-1],ue=3+(3&ae),ae>>>=2,ce-=2}else if(17===_e){for(ke=me+3;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ce-=me,Se=0,ue=3+(7&(ae>>>=me)),ae>>>=3,ce-=3}else{for(ke=me+7;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ce-=me,Se=0,ue=11+(127&(ae>>>=me)),ae>>>=7,ce-=7}if(n.have+ue>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Y;break}for(;ue--;)n.lens[n.have++]=Se}}if(n.mode===Y)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Y;break}if(n.lenbits=9,Ee={bits:n.lenbits},Ce=a(l,n.lens,0,n.nlen,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,Ce){e.msg="invalid literal/lengths set",n.mode=Y;break}if(n.distbits=6,n.distcode=n.distdyn,Ee={bits:n.distbits},Ce=a(h,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ee),n.distbits=Ee.bits,Ce){e.msg="invalid distances set",n.mode=Y;break}if(n.mode=U,t===p)break e;case U:n.mode=H;case H:if(se>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,o(e,he),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,se=e.avail_in,ae=n.hold,ce=n.bits,n.mode===A&&(n.back=-1);break}for(n.back=0;ye=(xe=n.lencode[ae&(1<<n.lenbits)-1])>>>16&255,_e=65535&xe,!((me=xe>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ye&&0==(240&ye)){for(ve=me,we=ye,be=_e;ye=(xe=n.lencode[be+((ae&(1<<ve+we)-1)>>ve)])>>>16&255,_e=65535&xe,!(ve+(me=xe>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ae>>>=ve,ce-=ve,n.back+=ve}if(ae>>>=me,ce-=me,n.back+=me,n.length=_e,0===ye){n.mode=K;break}if(32&ye){n.back=-1,n.mode=A;break}if(64&ye){e.msg="invalid literal/length code",n.mode=Y;break}n.extra=15&ye,n.mode=z;case z:if(n.extra){for(ke=n.extra;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.length+=ae&(1<<n.extra)-1,ae>>>=n.extra,ce-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=q;case q:for(;ye=(xe=n.distcode[ae&(1<<n.distbits)-1])>>>16&255,_e=65535&xe,!((me=xe>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(0==(240&ye)){for(ve=me,we=ye,be=_e;ye=(xe=n.distcode[be+((ae&(1<<ve+we)-1)>>ve)])>>>16&255,_e=65535&xe,!(ve+(me=xe>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ae>>>=ve,ce-=ve,n.back+=ve}if(ae>>>=me,ce-=me,n.back+=me,64&ye){e.msg="invalid distance code",n.mode=Y;break}n.offset=_e,n.extra=15&ye,n.mode=W;case W:if(n.extra){for(ke=n.extra;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.offset+=ae&(1<<n.extra)-1,ae>>>=n.extra,ce-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Y;break}n.mode=V;case V:if(0===oe)break e;if(ue=he-oe,n.offset>ue){if((ue=n.offset-ue)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Y;break}ue>n.wnext?(ue-=n.wnext,fe=n.wsize-ue):fe=n.wnext-ue,ue>n.length&&(ue=n.length),ge=n.window}else ge=te,fe=ie-n.offset,ue=n.length;ue>oe&&(ue=oe),oe-=ue,n.length-=ue;do{te[ie++]=ge[fe++]}while(--ue);0===n.length&&(n.mode=H);break;case K:if(0===oe)break e;te[ie++]=n.length,oe--,n.mode=H;break;case Q:if(n.wrap){for(;ce<32;){if(0===se)break e;se--,ae|=ee[ne++]<<ce,ce+=8}if(he-=oe,e.total_out+=he,n.total+=he,he&&(e.adler=n.check=n.flags?s(n.check,te,he,ie-he):i(n.check,te,he,ie-he)),he=oe,(n.flags?ae:re(ae))!==n.check){e.msg="incorrect data check",n.mode=Y;break}ae=0,ce=0}n.mode=G;case G:if(n.wrap&&n.flags){for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Y;break}ae=0,ce=0}n.mode=Z;case Z:Ce=g;break e;case Y:Ce=_;break e;case X:return v;case J:default:return y}return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,(n.wsize||he!==e.avail_out&&n.mode<Y&&(n.mode<Q||t!==u))&&pe(e,e.output,e.next_out,he-e.avail_out)?(n.mode=X,v):(le-=e.avail_in,he-=e.avail_out,e.total_in+=le,e.total_out+=he,n.total+=he,n.wrap&&he&&(e.adler=n.check=n.flags?s(n.check,te,he,e.next_out-he):i(n.check,te,he,e.next_out-he)),e.data_type=n.bits+(n.last?64:0)+(n.mode===A?128:0)+(n.mode===U||n.mode===F?256:0),(0===le&&0===he||t===u)&&Ce===f&&(Ce=w),Ce)},t.inflateEnd=function(e){if(!e||!e.state)return y;var t=e.state;return t.window&&(t.window=null),e.state=null,f},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?y:(n.head=t,t.done=!1,f):y},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==P?y:n.mode===P&&i(1,t,r,0)!==n.check?_:pe(e,t,r,r)?(n.mode=X,v):(n.havedict=1,f):y},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,s,o,a,c,l,h,u,d,p,f,g,m,y,_,v,w,b,S,C,E,k,x;n=e.state,r=e.next_in,k=e.input,i=r+(e.avail_in-5),s=e.next_out,x=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),c=n.dmax,l=n.wsize,h=n.whave,u=n.wnext,d=n.window,p=n.hold,f=n.bits,g=n.lencode,m=n.distcode,y=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{f<15&&(p+=k[r++]<<f,f+=8,p+=k[r++]<<f,f+=8),v=g[p&y];t:for(;;){if(p>>>=w=v>>>24,f-=w,0===(w=v>>>16&255))x[s++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=g[(65535&v)+(p&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}b=65535&v,(w&=15)&&(f<w&&(p+=k[r++]<<f,f+=8),b+=p&(1<<w)-1,p>>>=w,f-=w),f<15&&(p+=k[r++]<<f,f+=8,p+=k[r++]<<f,f+=8),v=m[p&_];n:for(;;){if(p>>>=w=v>>>24,f-=w,!(16&(w=v>>>16&255))){if(0==(64&w)){v=m[(65535&v)+(p&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(S=65535&v,f<(w&=15)&&(p+=k[r++]<<f,(f+=8)<w&&(p+=k[r++]<<f,f+=8)),(S+=p&(1<<w)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=w,f-=w,S>(w=s-o)){if((w=S-w)>h&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,E=d,0===u){if(C+=l-w,w<b){b-=w;do{x[s++]=d[C++]}while(--w);C=s-S,E=x}}else if(u<w){if(C+=l+u-w,(w-=u)<b){b-=w;do{x[s++]=d[C++]}while(--w);if(C=0,u<b){b-=w=u;do{x[s++]=d[C++]}while(--w);C=s-S,E=x}}}else if(C+=u-w,w<b){b-=w;do{x[s++]=d[C++]}while(--w);C=s-S,E=x}for(;b>2;)x[s++]=E[C++],x[s++]=E[C++],x[s++]=E[C++],b-=3;b&&(x[s++]=E[C++],b>1&&(x[s++]=E[C++]))}else{C=s-S;do{x[s++]=x[C++],x[s++]=x[C++],x[s++]=x[C++],b-=3}while(b>2);b&&(x[s++]=x[C++],b>1&&(x[s++]=x[C++]))}break}}break}}while(r<i&&s<a);r-=b=f>>3,p&=(1<<(f-=b<<3))-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=s<a?a-s+257:257-(s-a),n.hold=p,n.bits=f}},function(e,t,n){"use strict";var r=n(5),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,h,u,d){var p,f,g,m,y,_,v,w,b,S=d.bits,C=0,E=0,k=0,x=0,T=0,R=0,I=0,O=0,N=0,P=0,A=null,M=0,D=new r.Buf16(16),F=new r.Buf16(16),j=null,$=0;for(C=0;C<=15;C++)D[C]=0;for(E=0;E<c;E++)D[t[n+E]]++;for(T=S,x=15;x>=1&&0===D[x];x--);if(T>x&&(T=x),0===x)return l[h++]=20971520,l[h++]=20971520,d.bits=1,0;for(k=1;k<x&&0===D[k];k++);for(T<k&&(T=k),O=1,C=1;C<=15;C++)if(O<<=1,(O-=D[C])<0)return-1;if(O>0&&(0===e||1!==x))return-1;for(F[1]=0,C=1;C<15;C++)F[C+1]=F[C]+D[C];for(E=0;E<c;E++)0!==t[n+E]&&(u[F[t[n+E]]++]=E);if(0===e?(A=j=u,_=19):1===e?(A=i,M-=257,j=s,$-=257,_=256):(A=o,j=a,_=-1),P=0,E=0,C=k,y=h,R=T,I=0,g=-1,m=(N=1<<T)-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){v=C-I,u[E]<_?(w=0,b=u[E]):u[E]>_?(w=j[$+u[E]],b=A[M+u[E]]):(w=96,b=0),p=1<<C-I,k=f=1<<R;do{l[y+(P>>I)+(f-=p)]=v<<24|w<<16|b|0}while(0!==f);for(p=1<<C-1;P&p;)p>>=1;if(0!==p?(P&=p-1,P+=p):P=0,E++,0==--D[C]){if(C===x)break;C=t[n+u[E]]}if(C>T&&(P&m)!==g){for(0===I&&(I=T),y+=k,O=1<<(R=C-I);R+I<x&&!((O-=D[R+I])<=0);)R++,O<<=1;if(N+=1<<R,1===e&&N>852||2===e&&N>592)return 1;l[g=P&m]=T<<24|R<<16|y-h|0}}return 0!==P&&(l[y+P]=C-I<<24|64<<16|0),d.bits=T,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";var r=n(2),i=n(3),s=n(7),o=n(25),a=n(49),c=function(e,t){var n,r="";for(n=0;n<t;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},l=function(e,t,n,i,l,h){var u,d,p=e.file,f=e.compression,g=h!==s.utf8encode,m=r.transformTo("string",h(p.name)),y=r.transformTo("string",s.utf8encode(p.name)),_=p.comment,v=r.transformTo("string",h(_)),w=r.transformTo("string",s.utf8encode(_)),b=y.length!==p.name.length,S=w.length!==_.length,C="",E="",k="",x=p.dir,T=p.date,R={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(R.crc32=e.crc32,R.compressedSize=e.compressedSize,R.uncompressedSize=e.uncompressedSize);var I=0;t&&(I|=8),g||!b&&!S||(I|=2048);var O,N,P,A=0,M=0;x&&(A|=16),"UNIX"===l?(M=798,A|=(O=p.unixPermissions,N=x,P=O,O||(P=N?16893:33204),(65535&P)<<16)):(M=20,A|=63&(p.dosPermissions||0)),u=T.getUTCHours(),u<<=6,u|=T.getUTCMinutes(),u<<=5,u|=T.getUTCSeconds()/2,d=T.getUTCFullYear()-1980,d<<=4,d|=T.getUTCMonth()+1,d<<=5,d|=T.getUTCDate(),b&&(E=c(1,1)+c(o(m),4)+y,C+="up"+c(E.length,2)+E),S&&(k=c(1,1)+c(o(v),4)+w,C+="uc"+c(k.length,2)+k);var D="";return D+="\n\0",D+=c(I,2),D+=f.magic,D+=c(u,2),D+=c(d,2),D+=c(R.crc32,4),D+=c(R.compressedSize,4),D+=c(R.uncompressedSize,4),D+=c(m.length,2),D+=c(C.length,2),{fileRecord:a.LOCAL_FILE_HEADER+D+m+C,dirRecord:a.CENTRAL_FILE_HEADER+c(M,2)+D+c(v.length,2)+"\0\0\0\0"+c(A,4)+c(i,4)+m+C+v}},h=function(e){return a.DATA_DESCRIPTOR+c(e.crc32,4)+c(e.compressedSize,4)+c(e.uncompressedSize,4)};function u(e,t,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(u,i),u.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-r-1))/n:100}}))},u.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=l(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=l(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:h(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,i=function(e,t,n,i,s){var o=r.transformTo("string",s(i));return a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(e,2)+c(e,2)+c(t,4)+c(n,4)+c(o.length,2)+o}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},u.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},u.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},e.exports=u},function(e,t,n){"use strict";var r=n(2),i=n(3);function s(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}r.inherits(s,i),s.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},function(e,t,n){"use strict";var r=n(2),i=n(11),s=n(7),o=(r=n(2),n(92)),a=n(42),c=n(19);function l(e){return new i.Promise((function(t,n){var r=e.decompressed.getContentWorker().pipe(new a);r.on("error",(function(e){n(e)})).on("end",(function(){r.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}e.exports=function(e,t){var n=this;return t=r.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),c.isNode&&c.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var n=new o(t);return n.load(e),n})).then((function(e){var n=[i.Promise.resolve(e)],r=e.files;if(t.checkCRC32)for(var s=0;s<r.length;s++)n.push(l(r[s]));return i.Promise.all(n)})).then((function(e){for(var r=e.shift(),i=r.files,s=0;s<i.length;s++){var o=i[s];n.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n}))}},function(e,t,n){"use strict";var r=n(50),i=n(2),s=n(49),o=n(95),a=(n(7),n(4));function c(e){this.files=[],this.loadOptions=e}c.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4)===t;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",n=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=t-n;if(r>0)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=c},function(e,t,n){"use strict";var r=n(52);function i(e){r.call(this,e)}n(2).inherits(i,r),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(53);function i(e){r.call(this,e)}n(2).inherits(i,r),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(50),i=n(2),s=n(24),o=n(25),a=n(7),c=n(43),l=n(4);function h(e,t){this.options=e,this.loadOptions=t}h.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in c)if(c.hasOwnProperty(t)&&c[t].magic===e)return c[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<i;)t=e.readInt(2),n=e.readInt(2),r=e.readData(n),this.extraFields[t]={id:t,length:n,value:r}},handleUTF8:function(){var e=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var s=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:o(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:o(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},e.exports=h},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("tls")},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);e=e||{},this.concurrency=e.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=i.bind(this)}function i(){this.pending--,this._run()}["push","unshift","splice"].forEach((function(e){r.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this._run(),t}})),Object.defineProperty(r.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),r.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var e=this.jobs.shift();this.pending++,e(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var t=this.cbs.pop();process.nextTick(t)}}},r.prototype.onDone=function(e){"function"==typeof e&&(this.cbs.push(e),this._run())},e.exports=r},function(e,t){e.exports=require("zlib")},function(e,t,n){"use strict";class r{constructor(e,t){this.target=t,this.type=e}}class i extends r{constructor(e,t){super("message",t),this.data=e}}class s extends r{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}}class o extends r{constructor(e){super("open",e)}}class a extends r{constructor(e,t){super("error",t),this.message=e.message,this.error=e}}const c={addEventListener(e,t){function n(e){t.call(this,new i(e,this))}function r(e,n){t.call(this,new s(e,n,this))}function c(e){t.call(this,new a(e,this))}function l(){t.call(this,new o(this))}"function"==typeof t&&("message"===e?(n._listener=t,this.on(e,n)):"close"===e?(r._listener=t,this.on(e,r)):"error"===e?(c._listener=t,this.on(e,c)):"open"===e?(l._listener=t,this.on(e,l)):this.on(e,t))},removeEventListener(e,t){const n=this.listeners(e);for(var r=0;r<n.length;r++)n[r]!==t&&n[r]._listener!==t||this.removeListener(e,n[r])}};e.exports=c},function(e,t,n){"use strict";const r=n(22),i=n(13),s=n(56),o=n(57),a=n(20),c=n(58),l=n(12),h=n(55);function u(){this.destroy()}function d(e,t,n,r){e.writable&&(n=n||s.STATUS_CODES[t],r=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(n)},r),e.write(`HTTP/1.1 ${t} ${s.STATUS_CODES[t]}\r\n`+Object.keys(r).map(e=>`${e}: ${r[e]}`).join("\r\n")+"\r\n\r\n"+n)),e.removeListener("error",u),e.destroy()}e.exports=class extends r{constructor(e,t){if(super(),null==(e=Object.assign({maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e)).port&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');null!=e.port?(this._server=s.createServer((e,t)=>{const n=s.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=function(e,t){for(const n of Object.keys(t))e.on(n,t[n]);return function(){for(const n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(e,t,n)=>{this.handleUpgrade(e,t,n,t=>{this.emit("connection",t,e)})}})),!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this.clients)for(const e of this.clients)e.terminate();const t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port))return t.close(e);e&&e()}shouldHandle(e){return!this.options.path||o.parse(e.url).pathname===this.options.path}handleUpgrade(e,t,n,r){t.on("error",u);const i=+e.headers["sec-websocket-version"],s={};if("GET"!==e.method||"websocket"!==e.headers.upgrade.toLowerCase()||!e.headers["sec-websocket-key"]||8!==i&&13!==i||!this.shouldHandle(e))return d(t,400);if(this.options.perMessageDeflate){const n=new a(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const t=c.parse(e.headers["sec-websocket-extensions"]);t[a.extensionName]&&(n.accept(t[a.extensionName]),s[a.extensionName]=n)}catch(e){return d(t,400)}}if(this.options.verifyClient){const o={origin:e.headers[`${8===i?"sec-websocket-origin":"origin"}`],secure:!(!e.connection.authorized&&!e.connection.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(i,o,a,c)=>{if(!i)return d(t,o||401,a,c);this.completeUpgrade(s,e,t,n,r)});if(!this.options.verifyClient(o))return d(t,401)}this.completeUpgrade(s,e,t,n,r)}completeUpgrade(e,t,n,r,s){if(!n.readable||!n.writable)return n.destroy();const o=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${i.createHash("sha1").update(t.headers["sec-websocket-key"]+l.GUID,"binary").digest("base64")}`],d=new h(null);var p=t.headers["sec-websocket-protocol"];if(p&&(p=p.trim().split(/ *, */),(p=this.options.handleProtocols?this.options.handleProtocols(p,t):p[0])&&(o.push(`Sec-WebSocket-Protocol: ${p}`),d.protocol=p)),e[a.extensionName]){const t=e[a.extensionName].params,n=c.format({[a.extensionName]:[t]});o.push(`Sec-WebSocket-Extensions: ${n}`),d._extensions=e}this.emit("headers",o,t),n.write(o.concat("\r\n").join("\r\n")),n.removeListener("error",u),d.setSocket(n,r,this.options.maxPayload),this.clients&&(this.clients.add(d),d.on("close",()=>this.clients.delete(d))),s(d)}}},function(e,t,n){"use strict";(function(e){var t,r=n(6),i=n(1),s=n(0),o=n(14),a=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(s.B)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(s.v)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),c=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return Object(s.i)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),l=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new a(t)}}catch(e){}return new c},h=l("localStorage"),u=l("sessionStorage"),d=new o.b("@firebase/database"),p="FIREBASE_DATABASE_EMULATOR_HOST",f=(t=1,function(){return t++}),g=function(e){var t=Object(s.A)(e),n=new s.d;n.update(t);var r=n.digest();return s.g.encodeByteArray(r)},m=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++)Array.isArray(e[r])||e[r]&&"object"==typeof e[r]&&"number"==typeof e[r].length?n+=m.apply(null,e[r]):"object"==typeof e[r]?n+=Object(s.B)(e[r]):n+=e[r],n+=" ";return n},y=null,_=!0,v=function(e,t){Object(s.e)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(d.logLevel=o.a.VERBOSE,y=d.log.bind(d),t&&u.set("logging_enabled",!0)):"function"==typeof e?y=e:(y=null,u.remove("logging_enabled"))},w=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===_&&(_=!1,null===y&&!0===u.get("logging_enabled")&&v(!0)),y){var n=m.apply(null,e);y(n)}},b=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];w.apply(void 0,Object(i.f)([e],t))}},S=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+m.apply(void 0,Object(i.f)(e));d.error(n)},C=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+m.apply(void 0,Object(i.f)(e));throw d.error(n),new Error(n)},E=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+m.apply(void 0,Object(i.f)(e));d.warn(n)},k=function(e){return"number"==typeof e&&(e!=e||e==Number.POSITIVE_INFINITY||e==Number.NEGATIVE_INFINITY)},x="[MIN_NAME]",T="[MAX_NAME]",R=function(e,t){if(e===t)return 0;if(e===x||t===T)return-1;if(t===x||e===T)return 1;var n=F(e),r=F(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},I=function(e,t){return e===t?0:e<t?-1:1},O=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(s.B)(t))},N=function(e){if("object"!=typeof e||null===e)return Object(s.B)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=Object(s.B)(t[i]),r+=":",r+=N(e[t[i]]);return r+="}"},P=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function A(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var M=function(e){Object(s.e)(!k(e),"Invalid JSON number");var t,n,r,i,o,a,c;for(0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse(),c=a.join("");var l="";for(o=0;o<64;o+=8){var h=parseInt(c.substr(o,8),2).toString(16);1===h.length&&(h="0"+h),l+=h}return l.toLowerCase()},D=new RegExp("^-?\\d{1,10}$"),F=function(e){if(D.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},j=function(e){try{e()}catch(e){setTimeout((function(){var t=e.stack||"";throw E("Exception was thrown by user callback.",t),e}),Math.floor(0))}},$=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},B=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},L=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:!0,configurable:!0}),e.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},e.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new e(this.pieces_,t)},e.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},e.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)t.push(this.pieces_[n]);return new e(t,0)},e.prototype.child=function(t){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(t instanceof e)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new e(n,0)},e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},e.relativePath=function(t,n){var r=t.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return e.relativePath(t.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+t+")")},e.comparePaths=function(e,t){for(var n=e.slice(),r=t.slice(),i=0;i<n.length&&i<r.length;i++){var s=R(n[i],r[i]);if(0!==s)return s}return n.length===r.length?0:n.length<r.length?-1:1},e.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,n=e.pieceNum_;t<=this.pieces_.length;t++,n++)if(this.pieces_[t]!==e.pieces_[n])return!1;return!0},e.prototype.contains=function(e){var t=this.pieceNum_,n=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0},e}(),U=function(){function e(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(s.z)(this.parts_[n]);this.checkValid_()}return Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=Object(s.z)(e),this.checkValid_()},e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=Object(s.z)(e),this.parts_.length>0&&(this.byteLength_-=1)},e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},e.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},e}(),H="long_polling",z=function(){function e(e,t,n,r,i,s){void 0===i&&(i=""),void 0===s&&(s=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=s,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=h.get("host:"+e)||this.host}return e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},e.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&h.set("host:"+this.host,this.internalHost))},e.prototype.connectionURL=function(e,t){var n;if(Object(s.e)("string"==typeof e,"typeof type must == string"),Object(s.e)("object"==typeof t,"typeof params must == object"),"websocket"===e)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==H)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return A(t,(function(e,t){r.push(e+"="+t)})),n+r.join("&")},e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},e}();var q,W,V,K,Q,G=function(e){var t=Z(e),n=t.namespace;"firebase"===t.domain&&C(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===t.domain||C("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&E("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===t.scheme||"wss"===t.scheme;return{repoInfo:new z(t.host,t.secure,n,r,"",n!=t.subdomain),path:new L(t.pathString)}},Z=function(e){var t="",n="",r="",s="",o="",a=!0,c="https",l=443;if("string"==typeof e){var h=e.indexOf("//");h>=0&&(c=e.substring(0,h-1),e=e.substring(h+2));var u=e.indexOf("/");-1===u&&(u=e.length);var d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(u,d)),u<d&&(s=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,d)));var p=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var s=Object(i.g)(e.split("&")),o=s.next();!o.done;o=s.next()){var a=o.value;if(0!==a.length){var c=a.split("=");2===c.length?r[decodeURIComponent(c[0])]=decodeURIComponent(c[1]):E("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,d)));(h=t.indexOf(":"))>=0?(a="https"===c||"wss"===c,l=parseInt(t.substring(h+1),10)):h=e.length;var f=t.split(".");3===f.length?(n=f[1],o=r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,h).toLowerCase()&&(n="localhost"),"ns"in p&&(o=p.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:a,scheme:c,pathString:s,namespace:o}},Y=/[\[\].#$\/\u0000-\u001F\u007F]/,X=/[\[\].#$\u0000-\u001F\u007F]/,J=function(e){return"string"==typeof e&&0!==e.length&&!Y.test(e)},ee=function(e){return"string"==typeof e&&0!==e.length&&!X.test(e)},te=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!k(e)||e&&"object"==typeof e&&Object(s.i)(e,".sv")},ne=function(e,t,n,r,i){i&&void 0===n||re(Object(s.m)(e,t,i),n,r)},re=function(e,t,n){var r=n instanceof L?new U(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(e+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(k(t))throw new Error(e+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>10485760/3&&Object(s.z)(t)>10485760)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(A(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!J(t)))throw new Error(e+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),re(e,n,r),r.pop()})),i&&o)throw new Error(e+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},ie=function(e,t,n,r,i){if(!i||void 0!==n){var o=Object(s.m)(e,t,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];A(n,(function(e,t){var n=new L(e);if(re(o,t,r.child(n)),".priority"===n.getBack()&&!te(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=(r=t[n]).slice(),s=0;s<i.length;s++)if(".priority"===i[s]&&s===i.length-1);else if(!J(i[s]))throw new Error(e+"contains an invalid key ("+i[s]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(L.comparePaths);var o=null;for(n=0;n<t.length;n++){if(r=t[n],null!==o&&o.contains(r))throw new Error(e+"contains a path "+o.toString()+" that is ancestor of another path "+r.toString());o=r}}(o,a)}},se=function(e,t,n,r){if(!r||void 0!==n){if(k(n))throw new Error(Object(s.m)(e,t,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!te(n))throw new Error(Object(s.m)(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},oe=function(e,t,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(s.m)(e,t,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ae=function(e,t,n,r){if(!(r&&void 0===n||J(n)))throw new Error(Object(s.m)(e,t,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ce=function(e,t,n,r){if(!(r&&void 0===n||ee(n)))throw new Error(Object(s.m)(e,t,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},le=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ce(e,t,n,r)},he=function(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")},ue=function(e,t,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!J(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),ee(e)}(r))throw new Error(Object(s.m)(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},de=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(s.m)(e,t,r)+"must be a boolean.")},pe=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){Object(s.C)("OnDisconnect.cancel",0,1,arguments.length),Object(s.D)("OnDisconnect.cancel",1,e,!0);var t=new s.b;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){Object(s.C)("OnDisconnect.remove",0,1,arguments.length),he("OnDisconnect.remove",this.path_),Object(s.D)("OnDisconnect.remove",1,e,!0);var t=new s.b;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){Object(s.C)("OnDisconnect.set",1,2,arguments.length),he("OnDisconnect.set",this.path_),ne("OnDisconnect.set",1,e,this.path_,!1),Object(s.D)("OnDisconnect.set",2,t,!0);var n=new s.b;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){Object(s.C)("OnDisconnect.setWithPriority",2,3,arguments.length),he("OnDisconnect.setWithPriority",this.path_),ne("OnDisconnect.setWithPriority",1,e,this.path_,!1),se("OnDisconnect.setWithPriority",2,t,!1),Object(s.D)("OnDisconnect.setWithPriority",3,n,!0);var r=new s.b;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,r.wrapCallback(n)),r.promise},e.prototype.update=function(e,t){if(Object(s.C)("OnDisconnect.update",1,2,arguments.length),he("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,E("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ie("OnDisconnect.update",1,e,this.path_,!1),Object(s.D)("OnDisconnect.update",2,t,!0);var i=new s.b;return this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t)),i.promise},e}(),fe=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return Object(s.C)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),ge=(q="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",W=0,V=[],function(e){var t,n=e===W;W=e;var r=new Array(8);for(t=7;t>=0;t--)r[t]=q.charAt(e%64),e=Math.floor(e/64);Object(s.e)(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;t>=0&&63===V[t];t--)V[t]=0;V[t]++}else for(t=0;t<12;t++)V[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=q.charAt(V[t]);return Object(s.e)(20===i.length,"nextPushId: Length should be 20."),i}),me=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),ye=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new me(x,e),r=new me(x,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return me.MIN},e}(),_e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return K},set:function(e){K=e},enumerable:!0,configurable:!0}),t.prototype.compare=function(e,t){return R(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw Object(s.f)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return me.MIN},t.prototype.maxPost=function(){return new me(T,K)},t.prototype.makePost=function(e,t){return Object(s.e)("string"==typeof e,"KeyIndex indexValue must always be a string."),new me(e,K)},t.prototype.toString=function(){return".key"},t}(ye),ve=new _e;var we,be,Se,Ce=function(e){return"number"==typeof e?"number:"+M(e):"string:"+e},Ee=function(e){if(e.isLeafNode()){var t=e.val();Object(s.e)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(s.i)(t,".sv"),"Priority must be a string or number.")}else Object(s.e)(e===Q||e.isEmpty(),"priority of unexpected type.");Object(s.e)(e===Q||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},ke=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Object(s.e)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ee(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return we},set:function(e){we=e},enumerable:!0,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=t.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(s.e)(".priority"!==r||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Ce(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?M(this.value_):this.value_,this.lazyHash_=g(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Object(s.e)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return Object(s.e)(i>=0,"Unknown leaf type: "+n),Object(s.e)(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var xe,Te,Re=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?R(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return me.MIN},t.prototype.maxPost=function(){return new me(T,new ke("[PRIORITY-POST]",Se))},t.prototype.makePost=function(e,t){var n=be(e);return new me(t,new ke("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(ye)),Ie=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var s=1;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Oe=function(){function e(t,n,r,i,s){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Pe.EMPTY_NODE,this.right=null!=s?s:Pe.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,s){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r,i;return(i=(r=n(e,(i=this).key))<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Pe.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Pe.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){var e;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((e=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Ne=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new Oe(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Pe=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Oe.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Oe.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Ie(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Ie(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Ie(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Ie(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Ne,e}(),Ae=Math.log(2),Me=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ae,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),De=function(e,t,n,r){e.sort(t);var i=function(t,r){var s,o,a=r-t;if(0==a)return null;if(1==a)return s=e[t],o=n?n(s):s,new Oe(o,s.node,Oe.BLACK,null,null);var c=parseInt(a/2,10)+t,l=i(t,c),h=i(c+1,r);return s=e[c],o=n?n(s):s,new Oe(o,s.node,Oe.BLACK,l,h)},s=function(t){for(var r=null,s=null,o=e.length,a=function(t,r){var s=o-t,a=o;o-=t;var l=i(s+1,a),h=e[s],u=n?n(h):h;c(new Oe(u,h.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(s=e,r=e)},l=0;l<t.count;++l){var h=t.nextBitIsOne(),u=Math.pow(2,t.count-(l+1));h?a(u,Oe.BLACK):(a(u,Oe.BLACK),a(u,Oe.RED))}return s}(new Me(e.length));return new Pe(r||t,s)},Fe={},je=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return Object(s.e)(Fe&&Re,"ChildrenNode.ts has not been loaded"),xe=xe||new e({".priority":Fe},{".priority":Re})},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var t=Object(s.y)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Pe?t:null},e.prototype.hasIndex=function(e){return Object(s.i)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){Object(s.e)(t!==ve,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,o=[],a=!1,c=n.getIterator(me.Wrap),l=c.getNext();l;)a=a||t.isDefinedOn(l.node),o.push(l),l=c.getNext();r=a?De(o,t.getCompare()):Fe;var h=t.toString(),u=Object(i.a)({},this.indexSet_);u[h]=t;var d=Object(i.a)({},this.indexes_);return d[h]=r,new e(d,u)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(Object(s.w)(this.indexes_,(function(e,i){var o=Object(s.y)(r.indexSet_,i);if(Object(s.e)(o,"Missing index implementation for "+i),e===Fe){if(o.isDefinedOn(t.node)){for(var a=[],c=n.getIterator(me.Wrap),l=c.getNext();l;)l.name!=t.name&&a.push(l),l=c.getNext();return a.push(t),De(a,o.getCompare())}return Fe}var h=n.get(t.name),u=e;return h&&(u=u.remove(new me(t.name,h))),u.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(Object(s.w)(this.indexes_,(function(e){if(e===Fe)return e;var r=n.get(t.name);return r?e.remove(new me(t.name,r)):e})),this.indexSet_)},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function $e(e,t){return R(e.name,t.name)}function Be(e,t){return R(e,t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ee(this.priorityNode_),this.children_.isEmpty()&&Object(s.e)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return Te||(Te=new e(new Pe(Be),null,je.Default))},enumerable:!0,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||Te},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Te:t},e.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(Object(s.e)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r,i=new me(t,n),o=void 0,a=void 0;return n.isEmpty()?(o=this.children_.remove(t),a=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,n),a=this.indexMap_.addToIndexes(i,this.children_)),r=o.isEmpty()?Te:this.priorityNode_,new e(o,r,a)},e.prototype.updateChild=function(e,t){var n=e.getFront();if(null===n)return t;Object(s.e)(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(e.popFront(),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,s=!0;if(this.forEachChild(Re,(function(o,a){n[o]=a.val(t),r++,s&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1})),!t&&s&&i<2*r){var o=[];for(var a in n)o[a]=n[a];return o}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Ce(this.getPriority().val())+":"),this.forEachChild(Re,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":g(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new me(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new me(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new me(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,me.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,me.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ue?-1:0},e.prototype.withIndex=function(t){if(t===ve||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===ve||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(Re),r=t.getIterator(Re),i=n.getNext(),s=r.getNext();i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=n.getNext(),s=r.getNext()}return null===i&&null===s}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===ve?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),Ue=new(function(e){function t(){return e.call(this,new Pe(Be),Le.EMPTY_NODE,je.Default)||this}return Object(i.c)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return Le.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(Le));Object.defineProperties(me,{MIN:{value:new me(x,Le.EMPTY_NODE)},MAX:{value:new me(T,Ue)}}),_e.__EMPTY_NODE=Le.EMPTY_NODE,ke.__childrenNodeConstructor=Le,Q=Ue,function(e){Se=e}(Ue);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var He=!0;function ze(e,t){if(void 0===t&&(t=null),null===e)return Le.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(s.e)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new ke(e,ze(t));if(e instanceof Array||!He){var n=Le.EMPTY_NODE;return A(e,(function(t,r){if(Object(s.i)(e,t)&&"."!==t.substring(0,1)){var i=ze(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(ze(t))}var r=[],i=!1;if(A(e,(function(e,t){if("."!==e.substring(0,1)){var n=ze(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new me(e,n)))}})),0==r.length)return Le.EMPTY_NODE;var o=De(r,$e,(function(e){return e.name}),Be);if(i){var a=De(r,Re.getCompare());return new Le(o,ze(t),new je({".priority":a},{".priority":Re}))}return new Le(o,ze(t),je.Default)}!function(e){be=e}(ze);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var qe,We,Ve=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?R(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return me.MIN},t.prototype.maxPost=function(){return me.MAX},t.prototype.makePost=function(e,t){var n=ze(e);return new me(t,n)},t.prototype.toString=function(){return".value"},t}(ye)),Ke=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,Object(s.e)(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Object(i.c)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?R(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=ze(e),r=Le.EMPTY_NODE.updateChild(this.indexPath_,n);return new me(t,r)},t.prototype.maxPost=function(){var e=Le.EMPTY_NODE.updateChild(this.indexPath_,Ue);return new me(T,e)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(ye),Qe=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return Object(s.C)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return Object(s.C)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return Object(s.C)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return Object(s.C)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){Object(s.C)("DataSnapshot.child",0,1,arguments.length),t=String(t),ce("DataSnapshot.child",1,t,!1);var n=new L(t),r=this.ref_.child(n);return new e(this.node_.getChild(n),r,Re)},e.prototype.hasChild=function(e){Object(s.C)("DataSnapshot.hasChild",1,1,arguments.length),ce("DataSnapshot.hasChild",1,e,!1);var t=new L(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return Object(s.C)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;if(Object(s.C)("DataSnapshot.forEach",1,1,arguments.length),Object(s.D)("DataSnapshot.forEach",1,t,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return t(new e(i,n.ref_.child(r),Re))}))},e.prototype.hasChildren=function(){return Object(s.C)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return Object(s.C)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return Object(s.C)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),e}(),Ge=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(s.B)(this.snapshot.exportVal())},e}(),Ze=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Ye=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new Ge("value",this,new Qe(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(s.e)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Ze(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),Xe=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,Object(s.i)(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Ze(this,e,t):null},e.prototype.createEvent=function(e,t){Object(s.e)(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),r=t.getQueryParams().getIndex();return new Ge(e.type,this,new Qe(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(s.e)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){var n=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var r=Object.keys(t.callbacks_),i=Object.keys(this.callbacks_),s=r.length;if(s===i.length){if(1===s){var o=r[0],a=i[0];return!(a!==o||t.callbacks_[o]&&this.callbacks_[a]&&t.callbacks_[o]!==this.callbacks_[a])}return i.every((function(e){return t.callbacks_[e]===n.callbacks_[e]}))}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}(),Je=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(s.e)(qe,"Reference.ts has not been loaded"),qe},set:function(e){qe=e},enumerable:!0,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===ve){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!=x)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!=T)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Re){if(null!=t&&!te(t)||null!=n&&!te(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(s.e)(e.getIndex()instanceof Ke||e.getIndex()===Ve,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return Object(s.C)("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,r,i){Object(s.C)("Query.on",2,4,arguments.length),oe("Query.on",1,t,!1),Object(s.D)("Query.on",2,n,!1);var o=e.getCancelAndContextArgs_("Query.on",r,i);if("value"===t)this.onValueEvent(n,o.cancel,o.context);else{var a={};a[t]=n,this.onChildEvent(a,o.cancel,o.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new Ye(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new Xe(e,t,n);this.repo.addEventCallbackForQuery(this,r)},e.prototype.off=function(e,t,n){Object(s.C)("Query.off",0,3,arguments.length),oe("Query.off",1,e,!0),Object(s.D)("Query.off",2,t,!0),Object(s.E)("Query.off",3,n,!0);var r=null,i=null;if("value"===e){var o=t||null;r=new Ye(o,null,n||null)}else e&&(t&&((i={})[e]=t),r=new Xe(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},e.prototype.once=function(t,n,r,i){var o=this;Object(s.C)("Query.once",1,4,arguments.length),oe("Query.once",1,t,!1),Object(s.D)("Query.once",2,n,!0);var a=e.getCancelAndContextArgs_("Query.once",r,i),c=!0,l=new s.b;l.promise.catch((function(){}));var h=function(e){c&&(c=!1,o.off(t,h),n&&n.bind(a.context)(e),l.resolve(e))};return this.on(t,h,(function(e){o.off(t,h),a.cancel&&a.cancel.bind(a.context)(e),l.reject(e)})),l.promise},e.prototype.limitToFirst=function(t){if(Object(s.C)("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if(Object(s.C)("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if(Object(s.C)("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ce("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new L(t);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Ke(n),i=this.queryParams_.orderBy(r);return e.validateQueryEndpoints_(i),new e(this.repo,this.path,i,!0)},e.prototype.orderByKey=function(){Object(s.C)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(ve);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){Object(s.C)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Re);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){Object(s.C)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Ve);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),Object(s.C)("Query.startAt",0,2,arguments.length),ne("Query.startAt",1,t,this.path,!0),ae("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),Object(s.C)("Query.endAt",0,2,arguments.length),ne("Query.endAt",1,t,this.path,!0),ae("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if(Object(s.C)("Query.equalTo",1,2,arguments.length),ne("Query.equalTo",1,e,this.path,!1),ae("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return Object(s.C)("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},e.prototype.toJSON=function(){return Object(s.C)("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=N(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if(Object(s.C)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var r=this.repo===t.repo,i=this.path.equals(t.path),o=this.queryIdentifier()===t.queryIdentifier();return r&&i&&o},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:null,context:null};if(t&&n)r.cancel=t,Object(s.D)(e,3,r.cancel,!0),r.context=n,Object(s.E)(e,4,r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(s.m)(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),e}(),et=function(){function e(){this.value=null,this.children=new Map}return e.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},e.prototype.remember=function(t,n){if(t.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,n);else{var r=t.getFront();this.children.has(r)||this.children.set(r,new e);var i=this.children.get(r);t=t.popFront(),i.remember(t,n)}},e.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var n=this;return t.forEachChild(Re,(function(e,t){n.remember(new L(e),t)})),this.forget(e)}if(this.children.size>0){var r=e.getFront();if(e=e.popFront(),this.children.has(r))this.children.get(r).forget(e)&&this.children.delete(r);return 0===this.children.size}return!0},e.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild((function(n,r){var i=new L(e.toString()+"/"+n);r.forEachTree(i,t)}))},e.prototype.forEachChild=function(e){this.children.forEach((function(t,n){e(n,t)}))},e}(),tt=function(e,t){return e&&"object"==typeof e?(Object(s.e)(".sv"in e,"Unexpected leaf node or priority contents"),t[e[".sv"]]):e},nt=function(e,t){var n,r=e.getPriority().val(),i=tt(r,t);if(e.isLeafNode()){var s=e,o=tt(s.getValue(),t);return o!==s.getValue()||i!==s.getPriority().val()?new ke(o,ze(i)):e}var a=e;return n=a,i!==a.getPriority().val()&&(n=n.updatePriority(new ke(i))),a.forEachChild(Re,(function(e,r){var i=nt(r,t);i!==r&&(n=n.updateImmediateChild(e,i))})),n};!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(We||(We={}));var rt,it,st=function(){function e(e,t,n,r){this.fromUser=e,this.fromServer=t,this.queryId=n,this.tagged=r,Object(s.e)(!r||t,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),ot=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=We.ACK_USER_WRITE,this.source=st.User}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Object(s.e)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new L(t));return new e(L.Empty,n,this.revert)}return Object(s.e)(this.path.getFront()===t,"operationForChild called for unrelated child."),new e(this.path.popFront(),this.affectedTree,this.revert)},e}(),at=function(){return rt||(rt=new Pe(I)),rt},ct=function(){function e(e,t){void 0===t&&(t=at()),this.value=e,this.children=t}return e.fromObject=function(t){var n=e.Empty;return A(t,(function(e,t){n=n.set(new L(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:L.Empty,value:this.value};if(e.isEmpty())return null;var n=e.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=i?{path:new L(n).child(i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(t.isEmpty())return this;var n=t.getFront(),r=this.children.get(n);return null!==r?r.subtree(t.popFront()):e.Empty},e.prototype.set=function(t,n){if(t.isEmpty())return new e(n,this.children);var r=t.getFront(),i=(this.children.get(r)||e.Empty).set(t.popFront(),n),s=this.children.insert(r,i);return new e(this.value,s)},e.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?e.Empty:new e(null,this.children);var n=t.getFront(),r=this.children.get(n);if(r){var i=r.remove(t.popFront()),s=void 0;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&s.isEmpty()?e.Empty:new e(this.value,s)}return this},e.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),n=this.children.get(t);return n?n.get(e.popFront()):null},e.prototype.setTree=function(t,n){if(t.isEmpty())return n;var r=t.getFront(),i=(this.children.get(r)||e.Empty).setTree(t.popFront(),n),s=void 0;return s=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,s)},e.prototype.fold=function(e){return this.fold_(L.Empty,e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(e.child(r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,L.Empty,t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(e.isEmpty())return null;var i=e.getFront(),s=this.children.get(i);return s?s.findOnPath_(e.popFront(),t.child(i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,L.Empty,t)},e.prototype.foreachOnPath_=function(t,n,r){if(t.isEmpty())return this;this.value&&r(n,this.value);var i=t.getFront(),s=this.children.get(i);return s?s.foreachOnPath_(t.popFront(),n.child(i),r):e.Empty},e.prototype.foreach=function(e){this.foreach_(L.Empty,e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(e.child(n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e.Empty=new e(null),e}(),lt=function(){function e(e,t){this.source=e,this.path=t,this.type=We.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,L.Empty):new e(this.source,this.path.popFront())},e}(),ht=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=We.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,L.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),ut=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=We.MERGE}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var n=this.children.subtree(new L(t));return n.isEmpty()?null:n.value?new ht(this.source,L.Empty,n.value):new e(this.source,L.Empty,n)}return Object(s.e)(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,this.path.popFront(),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),dt=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),pt=function(){function e(e,t){this.eventCache_=e,this.serverCache_=t}return e.prototype.updateEventSnap=function(t,n,r){return new e(new dt(t,n,r),this.serverCache_)},e.prototype.updateServerSnap=function(t,n,r){return new e(this.eventCache_,new dt(t,n,r))},e.prototype.getEventCache=function(){return this.eventCache_},e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},e.prototype.getServerCache=function(){return this.serverCache_},e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},e.Empty=new e(new dt(Le.EMPTY_NODE,!1,!1),new dt(Le.EMPTY_NODE,!1,!1)),e}(),ft=function(){function e(e,t,n,r,i){this.type=e,this.snapshotNode=t,this.childName=n,this.oldSnap=r,this.prevName=i}return e.valueChange=function(t){return new e(e.VALUE,t)},e.childAddedChange=function(t,n){return new e(e.CHILD_ADDED,n,t)},e.childRemovedChange=function(t,n){return new e(e.CHILD_REMOVED,n,t)},e.childChangedChange=function(t,n,r){return new e(e.CHILD_CHANGED,n,t,r)},e.childMovedChange=function(t,n){return new e(e.CHILD_MOVED,n,t)},e.CHILD_ADDED="child_added",e.CHILD_REMOVED="child_removed",e.CHILD_CHANGED="child_changed",e.CHILD_MOVED="child_moved",e.VALUE="value",e}(),gt=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){Object(s.e)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(ft.childRemovedChange(t,a)):Object(s.e)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ft.childAddedChange(t,n)):o.trackChildChange(ft.childChangedChange(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Re,(function(e,r){t.hasChild(e)||n.trackChildChange(ft.childRemovedChange(e,r))})),t.isLeafNode()||t.forEachChild(Re,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(ft.childChangedChange(t,r,i))}else n.trackChildChange(ft.childAddedChange(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?Le.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),mt=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;Object(s.e)(t==ft.CHILD_ADDED||t==ft.CHILD_CHANGED||t==ft.CHILD_REMOVED,"Only child changes supported for tracking"),Object(s.e)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(t==ft.CHILD_ADDED&&i==ft.CHILD_REMOVED)this.changeMap.set(n,ft.childChangedChange(n,e.snapshotNode,r.snapshotNode));else if(t==ft.CHILD_REMOVED&&i==ft.CHILD_ADDED)this.changeMap.delete(n);else if(t==ft.CHILD_REMOVED&&i==ft.CHILD_CHANGED)this.changeMap.set(n,ft.childRemovedChange(n,r.oldSnap));else if(t==ft.CHILD_CHANGED&&i==ft.CHILD_ADDED)this.changeMap.set(n,ft.childAddedChange(n,e.snapshotNode));else{if(t!=ft.CHILD_CHANGED||i!=ft.CHILD_CHANGED)throw Object(s.f)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,ft.childChangedChange(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),yt=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),_t=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new dt(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},e}(),vt=function(e,t){this.viewCache=e,this.changes=t},wt=function(){function e(e){this.filter_=e}return e.prototype.assertIndexed=function(e){Object(s.e)(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Object(s.e)(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},e.prototype.applyOperation=function(t,n,r,i){var o,a,c=new mt;if(n.type===We.OVERWRITE){var l=n;l.source.fromUser?o=this.applyUserOverwrite_(t,l.path,l.snap,r,i,c):(Object(s.e)(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.getServerCache().isFiltered()&&!l.path.isEmpty(),o=this.applyServerOverwrite_(t,l.path,l.snap,r,i,a,c))}else if(n.type===We.MERGE){var h=n;h.source.fromUser?o=this.applyUserMerge_(t,h.path,h.children,r,i,c):(Object(s.e)(h.source.fromServer,"Unknown source."),a=h.source.tagged||t.getServerCache().isFiltered(),o=this.applyServerMerge_(t,h.path,h.children,r,i,a,c))}else if(n.type===We.ACK_USER_WRITE){var u=n;o=u.revert?this.revertUserWrite_(t,u.path,r,i,c):this.ackUserWrite_(t,u.path,u.affectedTree,r,i,c)}else{if(n.type!==We.LISTEN_COMPLETE)throw Object(s.f)("Unknown operation type: "+n.type);o=this.listenComplete_(t,n.path,r,c)}var d=c.getChanges();return e.maybeAddValueEvent_(t,o,d),new vt(o,d)},e.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=e.getCompleteEventSnap();(n.length>0||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(ft.valueChange(t.getCompleteEventSnap()))}},e.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,r,i){var o=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var a=void 0,c=void 0;if(t.isEmpty())if(Object(s.e)(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var l=e.getCompleteServerSnap(),h=l instanceof Le?l:Le.EMPTY_NODE,u=n.calcCompleteEventChildren(h);a=this.filter_.updateFullNode(e.getEventCache().getNode(),u,i)}else{var d=n.calcCompleteEventCache(e.getCompleteServerSnap());a=this.filter_.updateFullNode(e.getEventCache().getNode(),d,i)}else{var p=t.getFront();if(".priority"==p){Object(s.e)(1==t.getLength(),"Can't have a priority with additional path components");var f=o.getNode();c=e.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(t,f,c);a=null!=g?this.filter_.updatePriority(f,g):o.getNode()}else{var m=t.popFront(),y=void 0;if(o.isCompleteForChild(p)){c=e.getServerCache().getNode();var _=n.calcEventCacheAfterServerOverwrite(t,o.getNode(),c);y=null!=_?o.getNode().getImmediateChild(p).updateChild(m,_):o.getNode().getImmediateChild(p)}else y=n.calcCompleteChild(p,e.getServerCache());a=null!=y?this.filter_.updateChild(o.getNode(),p,y,m,r,i):o.getNode()}}return e.updateEventSnap(a,o.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},e.prototype.applyServerOverwrite_=function(e,t,n,r,i,s,o){var a,c=e.getServerCache(),l=s?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())a=l.updateFullNode(c.getNode(),n,null);else if(l.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(t,n);a=l.updateFullNode(c.getNode(),h,null)}else{var u=t.getFront();if(!c.isCompleteForPath(t)&&t.getLength()>1)return e;var d=t.popFront(),p=c.getNode().getImmediateChild(u).updateChild(d,n);a=".priority"==u?l.updatePriority(c.getNode(),p):l.updateChild(c.getNode(),u,p,d,yt,null)}var f=e.updateServerSnap(a,c.isFullyInitialized()||t.isEmpty(),l.filtersNodes()),g=new _t(r,f,i);return this.generateEventCacheAfterServerEvent_(f,t,r,g,o)},e.prototype.applyUserOverwrite_=function(e,t,n,r,i,s){var o,a,c=e.getEventCache(),l=new _t(r,e,i);if(t.isEmpty())a=this.filter_.updateFullNode(e.getEventCache().getNode(),n,s),o=e.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var h=t.getFront();if(".priority"===h)a=this.filter_.updatePriority(e.getEventCache().getNode(),n),o=e.updateEventSnap(a,c.isFullyInitialized(),c.isFiltered());else{var u=t.popFront(),d=c.getNode().getImmediateChild(h),p=void 0;if(u.isEmpty())p=n;else{var f=l.getCompleteChild(h);p=null!=f?".priority"===u.getBack()&&f.getChild(u.parent()).isEmpty()?f:f.updateChild(u,n):Le.EMPTY_NODE}if(d.equals(p))o=e;else{var g=this.filter_.updateChild(c.getNode(),h,p,u,l,s);o=e.updateEventSnap(g,c.isFullyInitialized(),this.filter_.filtersNodes())}}}return o},e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},e.prototype.applyUserMerge_=function(t,n,r,i,s,o){var a=this,c=t;return r.foreach((function(r,l){var h=n.child(r);e.cacheHasChild_(t,h.getFront())&&(c=a.applyUserOverwrite_(c,h,l,i,s,o))})),r.foreach((function(r,l){var h=n.child(r);e.cacheHasChild_(t,h.getFront())||(c=a.applyUserOverwrite_(c,h,l,i,s,o))})),c},e.prototype.applyMerge_=function(e,t){return t.foreach((function(t,n){e=e.updateChild(t,n)})),e},e.prototype.applyServerMerge_=function(e,t,n,r,i,s,o){var a=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var c,l=e;c=t.isEmpty()?n:ct.Empty.setTree(t,n);var h=e.getServerCache().getNode();return c.children.inorderTraversal((function(t,n){if(h.hasChild(t)){var c=e.getServerCache().getNode().getImmediateChild(t),u=a.applyMerge_(c,n);l=a.applyServerOverwrite_(l,new L(t),u,r,i,s,o)}})),c.children.inorderTraversal((function(t,n){var c=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!h.hasChild(t)&&!c){var u=e.getServerCache().getNode().getImmediateChild(t),d=a.applyMerge_(u,n);l=a.applyServerOverwrite_(l,new L(t),d,r,i,s,o)}})),l},e.prototype.ackUserWrite_=function(e,t,n,r,i,s){if(null!=r.shadowingWrite(t))return e;var o=e.getServerCache().isFiltered(),a=e.getServerCache();if(null!=n.value){if(t.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,a.getNode().getChild(t),r,i,o,s);if(t.isEmpty()){var c=ct.Empty;return a.getNode().forEachChild(ve,(function(e,t){c=c.set(new L(e),t)})),this.applyServerMerge_(e,t,c,r,i,o,s)}return e}var l=ct.Empty;return n.foreach((function(e,n){var r=t.child(e);a.isCompleteForPath(r)&&(l=l.set(e,a.getNode().getChild(r)))})),this.applyServerMerge_(e,t,l,r,i,o,s)},e.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),s=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(s,t,n,yt,r)},e.prototype.revertUserWrite_=function(e,t,n,r,i){var o;if(null!=n.shadowingWrite(t))return e;var a=new _t(n,e,r),c=e.getEventCache().getNode(),l=void 0;if(t.isEmpty()||".priority"===t.getFront()){var h=void 0;if(e.getServerCache().isFullyInitialized())h=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var u=e.getServerCache().getNode();Object(s.e)(u instanceof Le,"serverChildren would be complete if leaf node"),h=n.calcCompleteEventChildren(u)}h=h,l=this.filter_.updateFullNode(c,h,i)}else{var d=t.getFront(),p=n.calcCompleteChild(d,e.getServerCache());null==p&&e.getServerCache().isCompleteForChild(d)&&(p=c.getImmediateChild(d)),(l=null!=p?this.filter_.updateChild(c,d,p,t.popFront(),a,i):e.getEventCache().getNode().hasChild(d)?this.filter_.updateChild(c,d,Le.EMPTY_NODE,t.popFront(),a,i):c).isEmpty()&&e.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(l=this.filter_.updateFullNode(l,o,i))}return o=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(L.Empty),e.updateEventSnap(l,o,this.filter_.filtersNodes())},e}(),bt=function(){function e(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return e.prototype.generateEventsForChanges=function(e,t,n){var r=this,i=[],s=[];return e.forEach((function(e){e.type===ft.CHILD_CHANGED&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push(ft.childMovedChange(e.childName,e.snapshotNode))})),this.generateEventsForType_(i,ft.CHILD_REMOVED,e,n,t),this.generateEventsForType_(i,ft.CHILD_ADDED,e,n,t),this.generateEventsForType_(i,ft.CHILD_MOVED,s,n,t),this.generateEventsForType_(i,ft.CHILD_CHANGED,e,n,t),this.generateEventsForType_(i,ft.VALUE,e,n,t),i},e.prototype.generateEventsForType_=function(e,t,n,r,i){var s=this,o=n.filter((function(e){return e.type===t}));o.sort(this.compareChanges_.bind(this)),o.forEach((function(t){var n=s.materializeSingleChange_(t,i);r.forEach((function(r){r.respondsTo(t.type)&&e.push(r.createEvent(n,s.query_))}))}))},e.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type?e:(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_),e)},e.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw Object(s.f)("Should only compare child_ events.");var n=new me(e.childName,e.snapshotNode),r=new me(t.childName,t.snapshotNode);return this.index_.compare(n,r)},e}(),St=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new gt(n.getIndex()),i=n.getNodeFilter();this.processor_=new wt(i);var s=t.getServerCache(),o=t.getEventCache(),a=r.updateFullNode(Le.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(Le.EMPTY_NODE,o.getNode(),null),l=new dt(a,s.isFullyInitialized(),r.filtersNodes()),h=new dt(c,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=new pt(h,l),this.eventGenerator_=new bt(this.query_)}return e.prototype.getQuery=function(){return this.query_},e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},e.prototype.removeEventRegistration=function(e,t){var n=[];if(t){Object(s.e)(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(e){t=t;var i=e.createCancelEvent(t,r);i&&n.push(i)}))}if(e){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(e)){if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},e.prototype.applyOperation=function(e,t,n){e.type===We.MERGE&&null!==e.source.queryId&&(Object(s.e)(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Object(s.e)(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,e,t,n);return this.processor_.assertIndexed(i.viewCache),Object(s.e)(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(Re,(function(e,t){n.push(ft.childAddedChange(e,t))}));return t.isFullyInitialized()&&n.push(ft.valueChange(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},e.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},e}(),Ct=function(){function e(){this.views=new Map}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(s.e)(it,"Reference.ts has not been loaded"),it},set:function(e){Object(s.e)(!it,"__referenceConstructor has already been defined"),it=e},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.views.size},e.prototype.applyOperation=function(e,t,n){var r,o,a=e.source.queryId;if(null!==a){var c=this.views.get(a);return Object(s.e)(null!=c,"SyncTree gave us an op for an invalid query."),c.applyOperation(e,t,n)}var l=[];try{for(var h=Object(i.g)(this.views.values()),u=h.next();!u.done;u=h.next()){c=u.value;l=l.concat(c.applyOperation(e,t,n))}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}return l},e.prototype.addEventRegistration=function(e,t,n,r,i){var s=e.queryIdentifier(),o=this.views.get(s);if(!o){var a=n.calcCompleteEventCache(i?r:null),c=!1;a?c=!0:r instanceof Le?(a=n.calcCompleteEventChildren(r),c=!1):(a=Le.EMPTY_NODE,c=!1);var l=new pt(new dt(a,c,!1),new dt(r,i,!1));o=new St(e,l),this.views.set(s,o)}return o.addEventRegistration(t),o.getInitialEvents(t)},e.prototype.removeEventRegistration=function(t,n,r){var s,o,a=t.queryIdentifier(),c=[],l=[],h=this.hasCompleteView();if("default"===a)try{for(var u=Object(i.g)(this.views.entries()),d=u.next();!d.done;d=u.next()){var p=Object(i.e)(d.value,2),f=p[0],g=p[1];l=l.concat(g.removeEventRegistration(n,r)),g.isEmpty()&&(this.views.delete(f),g.getQuery().getQueryParams().loadsAllData()||c.push(g.getQuery()))}}catch(e){s={error:e}}finally{try{d&&!d.done&&(o=u.return)&&o.call(u)}finally{if(s)throw s.error}}else(g=this.views.get(a))&&(l=l.concat(g.removeEventRegistration(n,r)),g.isEmpty()&&(this.views.delete(a),g.getQuery().getQueryParams().loadsAllData()||c.push(g.getQuery())));return h&&!this.hasCompleteView()&&c.push(new e.__referenceConstructor(t.repo,t.path)),{removed:c,events:l}},e.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=Object(i.g)(this.views.values()),s=r.next();!s.done;s=r.next()){var o=s.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},e.prototype.getCompleteServerCache=function(e){var t,n,r=null;try{for(var s=Object(i.g)(this.views.values()),o=s.next();!o.done;o=s.next()){var a=o.value;r=r||a.getCompleteServerCache(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return r},e.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return this.views.get(t)},e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},e.prototype.getCompleteView=function(){var e,t;try{for(var n=Object(i.g)(this.views.values()),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.getQuery().getQueryParams().loadsAllData())return s}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},e}(),Et=function(){function e(e){this.writeTree_=e}return e.prototype.addWrite=function(t,n){if(t.isEmpty())return new e(new ct(n));var r=this.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,s=r.value,o=L.relativePath(i,t);return s=s.updateChild(o,n),new e(this.writeTree_.set(i,s))}var a=new ct(n);return new e(this.writeTree_.setTree(t,a))},e.prototype.addWrites=function(e,t){var n=this;return A(t,(function(t,r){n=n.addWrite(e.child(t),r)})),n},e.prototype.removeWrite=function(t){return t.isEmpty()?e.Empty:new e(this.writeTree_.setTree(t,ct.Empty))},e.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(L.relativePath(t.path,e)):null},e.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Re,(function(t,n){e.push(new me(t,n))})):this.writeTree_.children.inorderTraversal((function(t,n){null!=n.value&&e.push(new me(t,n.value))})),e},e.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var n=this.getCompleteNode(t);return new e(null!=n?new ct(n):this.writeTree_.subtree(t))},e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},e.prototype.apply=function(e){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var i=null;return n.children.inorderTraversal((function(n,o){".priority"===n?(Object(s.e)(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=e(t.child(n),o,r)})),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(t.child(".priority"),i)),r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(L.Empty,this.writeTree_,e)},e.Empty=new e(new ct(null)),e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kt=function(){function e(){this.visibleWrites_=Et.Empty,this.allWrites_=[],this.lastWriteId_=-1}return e.prototype.childWrites=function(e){return new xt(e,this)},e.prototype.addOverwrite=function(e,t,n,r){Object(s.e)(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=n},e.prototype.addMerge=function(e,t,n){Object(s.e)(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=n},e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},e.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex((function(t){return t.writeId===e}));Object(s.e)(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&a>=0;){var c=this.allWrites_[a];c.visible&&(a>=n&&this.recordContainsPath_(c,r.path)?i=!1:r.path.contains(c.path)&&(o=!0)),a--}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):A(r.children,(function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(r.path.child(e))}));return!0}return!1},e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcCompleteEventCache=function(t,n,r,i){if(r||i){var s=this.visibleWrites_.childCompoundWrite(t);if(!i&&s.isEmpty())return n;if(i||null!=n||s.hasCompleteWrite(L.Empty)){var o=e.layerTree_(this.allWrites_,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))}),t);l=n||Le.EMPTY_NODE;return o.apply(l)}return null}var a=this.visibleWrites_.getCompleteNode(t);if(null!=a)return a;var c=this.visibleWrites_.childCompoundWrite(t);if(c.isEmpty())return n;if(null!=n||c.hasCompleteWrite(L.Empty)){var l=n||Le.EMPTY_NODE;return c.apply(l)}return null},e.prototype.calcCompleteEventChildren=function(e,t){var n=Le.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(Re,(function(e,t){n=n.updateImmediateChild(e,t)})),n;if(t){var i=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(Re,(function(e,t){var r=i.childCompoundWrite(new L(e)).apply(t);n=n.updateImmediateChild(e,r)})),i.getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,r){Object(s.e)(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=e.child(t);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(t):o.apply(r.getChild(t))},e.prototype.calcCompleteChild=function(e,t,n){var r=e.child(t),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(t)):null},e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcIndexedSlice=function(e,t,n,r,i,s){var o,a=this.visibleWrites_.childCompoundWrite(e),c=a.getCompleteNode(L.Empty);if(null!=c)o=c;else{if(null==t)return[];o=a.apply(t)}if((o=o.withIndex(s)).isEmpty()||o.isLeafNode())return[];for(var l=[],h=s.getCompare(),u=i?o.getReverseIteratorFrom(n,s):o.getIteratorFrom(n,s),d=u.getNext();d&&l.length<r;)0!==h(d,n)&&l.push(d),d=u.getNext();return l},e.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&e.path.child(n).contains(t))return!0;return!1},e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,L.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},e.DefaultFilter_=function(e){return e.visible},e.layerTree_=function(e,t,n){for(var r=Et.Empty,i=0;i<e.length;++i){var o=e[i];if(t(o)){var a=o.path,c=void 0;if(o.snap)n.contains(a)?(c=L.relativePath(n,a),r=r.addWrite(c,o.snap)):a.contains(n)&&(c=L.relativePath(a,n),r=r.addWrite(L.Empty,o.snap.getChild(c)));else{if(!o.children)throw Object(s.f)("WriteRecord should have .snap or .children");if(n.contains(a))c=L.relativePath(n,a),r=r.addWrites(c,o.children);else if(a.contains(n))if((c=L.relativePath(a,n)).isEmpty())r=r.addWrites(L.Empty,o.children);else{var l=Object(s.y)(o.children,c.getFront());if(l){var h=l.getChild(c.popFront());r=r.addWrite(L.Empty,h)}}}}}return r},e}(),xt=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},e.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),Tt=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=ct.Empty,this.pendingWriteTree_=new kt,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return e.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new ht(st.User,e,t)):[]},e.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=ct.fromObject(t);return this.applyOperationToSyncPoints_(new ut(st.User,e,r))},e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=ct.Empty;return null!=n.snap?r=r.set(L.Empty,!0):A(n.children,(function(e,t){r=r.set(new L(e),t)})),this.applyOperationToSyncPoints_(new ot(n.path,r,t))}return[]},e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new ht(st.Server,e,t))},e.prototype.applyServerMerge=function(e,t){var n=ct.fromObject(t);return this.applyOperationToSyncPoints_(new ut(st.Server,e,n))},e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new lt(st.Server,e))},e.prototype.applyTaggedQueryOverwrite=function(t,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var s=e.parseQueryKey_(i),o=s.path,a=s.queryId,c=L.relativePath(o,t),l=new ht(st.forServerTaggedQuery(a),c,n);return this.applyTaggedOperation_(o,l)}return[]},e.prototype.applyTaggedQueryMerge=function(t,n,r){var i=this.queryKeyForTag_(r);if(i){var s=e.parseQueryKey_(i),o=s.path,a=s.queryId,c=L.relativePath(o,t),l=ct.fromObject(n),h=new ut(st.forServerTaggedQuery(a),c,l);return this.applyTaggedOperation_(o,h)}return[]},e.prototype.applyTaggedListenComplete=function(t,n){var r=this.queryKeyForTag_(n);if(r){var i=e.parseQueryKey_(r),s=i.path,o=i.queryId,a=L.relativePath(s,t),c=new lt(st.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(s,c)}return[]},e.prototype.addEventRegistration=function(t,n){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,(function(e,t){var n=L.relativePath(e,r);i=i||t.getCompleteServerCache(n),o=o||t.hasCompleteView()}));var a,c=this.syncPointTree_.get(r);(c?(o=o||c.hasCompleteView(),i=i||c.getCompleteServerCache(L.Empty)):(c=new Ct,this.syncPointTree_=this.syncPointTree_.set(r,c)),null!=i)?a=!0:(a=!1,i=Le.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(e,t){var n=t.getCompleteServerCache(L.Empty);n&&(i=i.updateImmediateChild(e,n))})));var l=c.viewExistsForQuery(t);if(!l&&!t.getQueryParams().loadsAllData()){var h=e.makeQueryKey_(t);Object(s.e)(!this.queryToTagMap.has(h),"View does not exist, but we have a tag");var u=e.getNextQueryTag_();this.queryToTagMap.set(h,u),this.tagToQueryMap.set(u,h)}var d=this.pendingWriteTree_.childWrites(r),p=c.addEventRegistration(t,n,d,i,a);if(!l&&!o){var f=c.viewForQuery(t);p=p.concat(this.setupListener_(t,f))}return p},e.prototype.removeEventRegistration=function(t,n,r){var i=this,s=t.path,o=this.syncPointTree_.get(s),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var c=o.removeEventRegistration(t,n,r);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(s));var l=c.removed;a=c.events;var h=-1!==l.findIndex((function(e){return e.getQueryParams().loadsAllData()})),u=this.syncPointTree_.findOnPath(s,(function(e,t){return t.hasCompleteView()}));if(h&&!u){var d=this.syncPointTree_.subtree(s);if(!d.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(d),f=0;f<p.length;++f){var g=p[f],m=g.getQuery(),y=this.createListenerForView_(g);this.listenProvider_.startListening(e.queryForListening_(m),this.tagForQuery_(m),y.hashFn,y.onComplete)}}if(!u&&l.length>0&&!r)if(h){this.listenProvider_.stopListening(e.queryForListening_(t),null)}else l.forEach((function(t){var n=i.queryToTagMap.get(e.makeQueryKey_(t));i.listenProvider_.stopListening(e.queryForListening_(t),n)}));this.removeTags_(l)}return a},e.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,(function(t,n){var r=L.relativePath(t,e),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(e,r,t,!0)},e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold((function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),A(n,(function(e,t){r=r.concat(t)})),r}))},e.prototype.removeTags_=function(t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(r),s=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(s)}}},e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},e.prototype.setupListener_=function(t,n){var r=t.path,i=this.tagForQuery_(t),o=this.createListenerForView_(n),a=this.listenProvider_.startListening(e.queryForListening_(t),i,o.hashFn,o.onComplete),c=this.syncPointTree_.subtree(r);if(i)Object(s.e)(!c.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var l=c.fold((function(e,t,n){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map((function(e){return e.getQuery()})))),A(n,(function(e,t){r=r.concat(t)})),r})),h=0;h<l.length;++h){var u=l[h];this.listenProvider_.stopListening(e.queryForListening_(u),this.tagForQuery_(u))}return a},e.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||Le.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==e?n="Client doesn't have permission to access the desired data.":"unavailable"==e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,n);return t.removeEventRegistration(n,null,i)}}},e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},e.parseQueryKey_=function(e){var t=e.indexOf("$");return Object(s.e)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new L(e.substr(0,t))}},e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},e.prototype.tagForQuery_=function(t){var n=e.makeQueryKey_(t);return this.queryToTagMap.get(n)},e.getNextQueryTag_=function(){return e.nextQueryTag_++},e.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);Object(s.e)(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,r,null)},e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(L.Empty))},e.prototype.applyOperationHelper_=function(e,t,n,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get(L.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(L.Empty));var s=[],o=e.path.getFront(),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){var l=n?n.getImmediateChild(o):null,h=r.child(o);s=s.concat(this.applyOperationHelper_(a,c,l,h))}return i&&(s=s.concat(i.applyOperation(e,r,n))),s},e.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,s=t.get(L.Empty);null==n&&null!=s&&(n=s.getCompleteServerCache(L.Empty));var o=[];return t.children.inorderTraversal((function(t,s){var a=n?n.getImmediateChild(t):null,c=r.child(t),l=e.operationForChild(t);l&&(o=o.concat(i.applyOperationDescendantsHelper_(l,s,a,c)))})),s&&(o=o.concat(s.applyOperation(e,r,n))),o},e.nextQueryTag_=1,e}(),Rt=function(){function e(){this.rootNode_=Le.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),It=function(){function e(e){this.app_=e}return e.prototype.getToken=function(e){return this.app_.INTERNAL.getToken(e).then(null,(function(e){return e&&"auth/token-not-initialized"===e.code?(w("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)}))},e.prototype.addTokenChangeListener=function(e){this.app_.INTERNAL.addAuthTokenListener(e)},e.prototype.removeTokenChangeListener=function(e){this.app_.INTERNAL.removeAuthTokenListener(e)},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',E(e)},e}(),Ot=function(e){this.accessToken=e},Nt=function(){function e(e){this.app_=e}return e.prototype.getToken=function(e){return Promise.resolve(new Ot("owner"))},e.prototype.addTokenChangeListener=function(e){},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){E('Database emulator unexpectedly rejected fake "owner" credentials.')},e}(),Pt=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),Object(s.i)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return Object(s.k)(this.counters_)},e}(),At=function(){function e(){}return e.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new Pt),this.collections_[t]},e.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},e.collections_={},e.reporters_={},e}(),Mt=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=Object(i.a)({},e);return this.last_&&A(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),Dt=1e4,Ft=3e4,jt=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Mt(e);var n=Dt+(Ft-Dt)*Math.random();B(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.includeStat=function(e){this.statsToReport_[e]=!0},e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;A(t,(function(t,i){i>0&&Object(s.i)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),B(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}(),$t=function(){function e(){this.eventLists_=[],this.recursionDepth_=0}return e.prototype.queueEvents=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n],i=r.getPath();null===t||i.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new Bt(i)),t.add(r)}t&&this.eventLists_.push(t)},e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.equals(e)}))},e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.contains(e)||e.contains(t)}))},e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)e(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):t=!1}t&&(this.eventLists_=[]),this.recursionDepth_--},e}(),Bt=function(){function e(e){this.path_=e,this.events_=[]}return e.prototype.add=function(e){this.events_.push(e)},e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var n=t.getEventRunner();y&&w("event: "+t.toString()),j(n)}}},e.prototype.getPath=function(){return this.path_},e}(),Lt=function(){function e(e){this.allowedEvents_=e,this.listeners_={},Object(s.e)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=Object(i.f)(this.listeners_[e]),s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){Object(s.e)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),Ut=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return Object(i.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(s.e)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(Lt),Ht=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(s.q)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return Object(i.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(s.e)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(Lt),zt=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&j((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),qt="pLPCommand",Wt="pRTLPCB",Vt=function(){function e(e,t,n,r){this.connId=e,this.repoInfo=t,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=b(e),this.stats_=At.getCollection(t),this.urlFn=function(e){return t.connectionURL(H,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new zt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(s.s)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Kt((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(i.e)(e,5),s=r[0],o=r[1],a=r[2];r[3],r[4];if(n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==s)n.id=o,n.password=a;else{if("close"!==s)throw new Error("Unrecognized command received: "+s);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(i.e)(e,2),s=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(s,o)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!Object(s.s)()&&(!!e.forceAllow_||!(e.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=Object(s.B)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=Object(s.h)(t),r=P(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!Object(s.s)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=Object(s.B)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Kt=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(s.s)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=f(),window[qt+this.uniqueCallbackIdentifier]=t,window[Wt+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(e){w("frame writing exception"),e.stack&&w(e.stack),w(e)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||w("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},e.prototype.addTag=function(e,t){var n=this;Object(s.s)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){w("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}}),Math.floor(1))},e}(),Qt="";
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Gt=null;"undefined"!=typeof MozWebSocket?Gt=MozWebSocket:"undefined"!=typeof WebSocket&&(Gt=WebSocket);var Zt=function(){function e(t,n,r,i){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=b(this.connId),this.stats_=At.getCollection(n),this.connURL=e.connectionURL_(n,r,i)}return e.connectionURL_=function(e,t,n){var r={v:"5"};return!Object(s.s)()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),e.connectionURL("websocket",r)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,h.set("previous_websocket_failure",!0);try{if(Object(s.s)()){var r=s.a.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+Qt+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new Gt(this.connURL,[],i)}else this.mySock=new Gt(this.connURL)}catch(e){this.log_("Error instantiating WebSocket.");var c=e.message||e.data;return c&&this.log_(c),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==Gt&&!e.forceDisallow_},e.previouslyFailed=function(){return h.isInMemoryStorage||!0===h.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){h.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length==this.totalFrames){var t=this.frames.join("");this.frames=null;var n=Object(s.v)(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if(Object(s.e)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=Object(s.B)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=P(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),Yt=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Vt,Zt]},enumerable:!0,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,s=Zt&&Zt.isAvailable(),o=s&&!Zt.previouslyFailed();if(t.webSocketOnly&&(s||E("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[Zt];else{var a=this.transports_=[];try{for(var c=Object(i.g)(e.ALL_TRANSPORTS),l=c.next();!l.done;l=c.next()){var h=l.value;h&&h.isAvailable()&&a.push(h)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),Xt=function(){function e(e,t,n,r,i,s,o){this.id=e,this.repoInfo_=t,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=s,this.lastSessionId=o,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=b("c:"+this.id+":"),this.transportManager_=new Yt(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=B((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!=t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=O("t",e),n=O("d",e);if("c"==t)this.onSecondaryControl_(n);else{if("d"!=t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=O("t",e),n=O("d",e);"c"==t?this.onControl_(n):"d"==t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=O("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?S("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):S("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&E("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),B((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):B((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(h.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),Jt=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),en=1e3,tn=3e5,nn=function(e){function t(n,r,i,o,a,c){var l=e.call(this)||this;if(l.repoInfo_=n,l.onDataUpdate_=r,l.onConnectStatus_=i,l.onServerInfoUpdate_=o,l.authTokenProvider_=a,l.authOverride_=c,l.id=t.nextPersistentConnectionId_++,l.log_=b("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingPutCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=en,l.maxReconnectDelay_=tn,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,c&&!Object(s.s)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),Ut.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&Ht.getInstance().on("online",l.onOnline_,l),l}return Object(i.c)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Object(s.B)(i)),Object(s.e)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.listen=function(e,t,n,r){var i=e.queryIdentifier(),o=e.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Object(s.e)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Object(s.e)(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),s=r.queryIdentifier();this.log_("Listen on "+i+" for "+s);var o={p:i};e.tag&&(o.q=r.queryObject(),o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(function(o){var a=o.d,c=o.s;t.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(s))===e&&(n.log_("listen response",o),"ok"!==c&&n.removeListen_(i,s),e.onComplete&&e.onComplete(c,a))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&Object(s.i)(e,"w")){var n=Object(s.y)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',i=t.path.toString();E("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||Object(s.n)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=Object(s.u)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Object(s.e)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+Object(s.B)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):S("Unrecognized action received from server: "+Object(s.B)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;Object(s.e)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=en,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=en,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=en),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+t.nextConnectionId_++,o=this,a=this.lastSessionId,c=!1,l=null,h=function(){l?l.close():(c=!0,r())};this.realtime_={close:h,sendRequest:function(e){Object(s.e)(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)}};var u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(u).then((function(t){c?w("getToken() completed but was canceled"):(w("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,l=new Xt(i,o.repoInfo_,e,n,r,(function(e){E(e+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")}),a))})).then(null,(function(e){o.log_("Failed to get token: "+e),c||(s.a.NODE_ADMIN&&E(e),h())}))}},t.prototype.interrupt=function(e){w("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){w("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(s.p)(this.interruptReasons_)&&(this.reconnectDelay_=en,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return N(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new L(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){w("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var s=Object(i.g)(this.listens.values()),o=s.next();!o.done;o=s.next()){var a=o.value;try{for(var c=(n=void 0,Object(i.g)(a.values())),l=c.next();!l.done;l=c.next()){var h=l.value;this.sendListen_(h)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}for(var u=0;u<this.outstandingPuts_.length;u++)this.outstandingPuts_[u]&&this.sendPut_(u);for(;this.onDisconnectRequestQueue_.length;){var d=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(d.action,d.pathString,d.data,d.onComplete)}},t.prototype.sendConnectStats_=function(){var e={},t="js";s.a.NODE_ADMIN?t="admin_node":s.a.NODE_CLIENT&&(t="node"),e["sdk."+t+"."+Qt.replace(/\./g,"-")]=1,Object(s.q)()?e["framework.cordova"]=1:Object(s.t)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=Ht.getInstance().currentlyOnline();return Object(s.p)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(Jt),rn=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=b("p:rest:"),i.listens_={},i}return Object(i.c)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(Object(s.e)(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,r,i){var o=this,a=e.path.toString();this.log_("Listen called for "+a+" "+e.queryIdentifier());var c=t.getListenId_(e,r),l={};this.listens_[c]=l;var h=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",h,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(a,n,!1,r),Object(s.y)(o.listens_,c)===l)&&i(e?401==e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(t.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+Object(s.x)(t);r.log_("Sending REST request for "+a);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(n&&4===c.readyState){r.log_("REST Response for "+a+" received. status:",c.status,"response:",c.responseText);var e=null;if(c.status>=200&&c.status<300){try{e=Object(s.v)(c.responseText)}catch(e){E("Failed to parse JSON response for "+a+": "+c.responseText)}n(null,e)}else 401!==c.status&&404!==c.status&&E("Got unsuccessful REST response for "+a+" Status: "+c.status),n(c.status);n=null}},c.open("GET",a,!0),c.send()}))},t}(Jt),sn=function(){function e(e,t,n){var r,i=this;if(this.repoInfo_=e,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new $t,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new et,this.persistentConnection_=null,r="undefined"!=typeof process&&process.env[p]?new Nt(n):new It(n),this.stats_=At.getCollection(e),t||$())this.server_=new rn(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(null!=o){if("object"!=typeof o)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(s.B)(o)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}this.persistentConnection_=new nn(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,o),this.server_=this.persistentConnection_}r.addTokenChangeListener((function(e){i.server_.refreshAuthToken(e)})),this.statsReporter_=At.getOrCreateReporter(e,(function(){return new jt(i.stats_,i.server_)})),this.transactions_init_(),this.infoData_=new Rt,this.infoSyncTree_=new Tt({startListening:function(e,t,n,r){var s=[],o=i.infoData_.getNode(e.path);return o.isEmpty()||(s=i.infoSyncTree_.applyServerOverwrite(e.path,o),setTimeout((function(){r("ok")}),0)),s},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Tt({startListening:function(e,t,n,r){return i.server_.listen(e,n,t,(function(t,n){var s=r(t,n);i.eventQueue_.raiseEventsForChangedPath(e.path,s)})),[]},stopListening:function(e,t){i.server_.unlisten(e,t)}})}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e.prototype.name=function(){return this.repoInfo_.namespace},e.prototype.serverTime=function(){var e=this.infoData_.getNode(new L(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},e.prototype.generateServerValues=function(){return(e=(e={timestamp:this.serverTime()})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e},e.prototype.onDataUpdate_=function(e,t,n,r){this.dataUpdateCount++;var i=new L(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var o=[];if(r)if(n){var a=Object(s.w)(t,(function(e){return ze(e)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var c=ze(t);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,c,r)}else if(n){var l=Object(s.w)(t,(function(e){return ze(e)}));o=this.serverSyncTree_.applyServerMerge(i,l)}else{var h=ze(t);o=this.serverSyncTree_.applyServerOverwrite(i,h)}var u=i;o.length>0&&(u=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(u,o)},e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},e.prototype.onServerInfoUpdate_=function(e){var t=this;A(e,(function(e,n){t.updateInfo_(e,n)}))},e.prototype.updateInfo_=function(e,t){var n=new L("/.info/"+e),r=ze(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},e.prototype.getNextWriteId_=function(){return this.nextWriteId_++},e.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var s=this.generateServerValues(),o=ze(t,n),a=nt(o,s),c=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(e,a,c,!0);this.eventQueue_.queueEvents(l),this.server_.put(e.toString(),o.val(!0),(function(t,n){var s="ok"===t;s||E("set at "+e+" failed: "+t);var o=i.serverSyncTree_.ackUserWrite(c,!s);i.eventQueue_.raiseEventsForChangedPath(e,o),i.callOnCompleteCallback(r,t,n)}));var h=this.abortTransactions_(e);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},e.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,s=this.generateServerValues(),o={};if(A(t,(function(e,t){i=!1;var n=ze(t);o[e]=nt(n,s)})),i)w("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var a=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserMerge(e,o,a);this.eventQueue_.queueEvents(c),this.server_.merge(e.toString(),t,(function(t,i){var s="ok"===t;s||E("update at "+e+" failed: "+t);var o=r.serverSyncTree_.ackUserWrite(a,!s),c=o.length>0?r.rerunTransactions_(e):e;r.eventQueue_.raiseEventsForChangedPath(c,o),r.callOnCompleteCallback(n,t,i)})),A(t,(function(t){var n=r.abortTransactions_(e.child(t));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(e,[])}},e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=function(e,t){var n=new et;return e.forEachTree(new L(""),(function(e,r){n.remember(e,nt(r,t))})),n}(this.onDisconnect_,t),r=[];n.forEachTree(L.Empty,(function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)})),this.onDisconnect_=new et,this.eventQueue_.raiseEventsForChangedPath(L.Empty,r)},e.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)}))},e.prototype.onDisconnectSet=function(e,t,n){var r=this,i=ze(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),(function(t,s){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,s)}))},e.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,s=ze(t,n);this.server_.onDisconnectPut(e.toString(),s.val(!0),(function(t,n){"ok"===t&&i.onDisconnect_.remember(e,s),i.callOnCompleteCallback(r,t,n)}))},e.prototype.onDisconnectUpdate=function(e,t,n){var r=this;if(Object(s.p)(t))return w("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,(function(i,s){"ok"===i&&A(t,(function(t,n){var i=ze(n);r.onDisconnect_.remember(e.child(t),i)})),r.callOnCompleteCallback(n,i,s)}))},e.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},e.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new Mt(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var n=Object.keys(t).reduce((function(e,t){return Math.max(t.length,e)}),0);A(t,(function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)}))}},e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},e.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),w.apply(void 0,Object(i.f)([n],e))},e.prototype.callOnCompleteCallback=function(e,t,n){e&&j((function(){if("ok"==t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var s=new Error(i);s.code=r,e(s)}}))},Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new gn(this))},enumerable:!0,configurable:!0}),e}(),on=function(){function e(t){this.indexedFilter_=new gt(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,s){return this.matches(new me(t,n))||(n=Le.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=Le.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(Le.EMPTY_NODE);var i=this;return t.forEachChild(Re,(function(e,t){i.matches(new me(e,t))||(r=r.updateImmediateChild(e,Le.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),an=function(){function e(e){this.rangedFilter_=new on(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,s){return this.rangedFilter_.matches(new me(t,n))||(n=Le.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=Le.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=Le.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var s=0;i.hasNext()&&s<this.limit_;){var o=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),o)<=0:this.index_.compare(o,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(o.name,o.node),s++}}else{r=(r=t.withIndex(this.index_)).updatePriority(Le.EMPTY_NODE);var a=void 0,c=void 0,l=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();l=function(e,t){return h(t,e)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();s=0;for(var u=!1;i.hasNext();){o=i.getNext();!u&&l(a,o)<=0&&(u=!0),u&&s<this.limit_&&l(o,c)<=0?s++:r=r.updateImmediateChild(o.name,Le.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(e,t){return a(t,e)}}else o=this.index_.getCompare();var c=e;Object(s.e)(c.numChildren()==this.limit_,"");var l=new me(t,n),h=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(c.hasChild(t)){for(var d=c.getImmediateChild(t),p=r.getChildAfterChild(this.index_,h,this.reverse_);null!=p&&(p.name==t||c.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:o(p,l);if(u&&!n.isEmpty()&&f>=0)return null!=i&&i.trackChildChange(ft.childChangedChange(t,n,d)),c.updateImmediateChild(t,n);null!=i&&i.trackChildChange(ft.childRemovedChange(t,d));var g=c.updateImmediateChild(t,Le.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(ft.childAddedChange(p.name,p.node)),g.updateImmediateChild(p.name,p.node)):g}return n.isEmpty()?e:u&&o(h,l)>=0?(null!=i&&(i.trackChildChange(ft.childRemovedChange(h.name,h.node)),i.trackChildChange(ft.childAddedChange(t,n))),c.updateImmediateChild(t,n).updateImmediateChild(h.name,Le.EMPTY_NODE)):e},e}(),cn=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Re}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},e.prototype.getIndexStartValue=function(){return Object(s.e)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return Object(s.e)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:x},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return Object(s.e)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return Object(s.e)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:T},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return Object(s.e)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.copy_=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},e.prototype.limitToFirst=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},e.prototype.limitToLast=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},e.prototype.startAt=function(e,t){var n=this.copy_();return n.startSet_=!0,void 0===e&&(e=null),n.indexStartValue_=e,null!=t?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n},e.prototype.endAt=function(e,t){var n=this.copy_();return n.endSet_=!0,void 0===e&&(e=null),n.indexEndValue_=e,void 0!==t?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n},e.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[t.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),n[t.VIEW_FROM]=r}return this.index_!==Re&&(n[t.INDEX]=this.index_.toString()),n},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Re},e.prototype.getNodeFilter=function(){return this.loadsAllData()?new gt(this.getIndex()):this.hasLimit()?new an(this):new on(this)},e.prototype.toRestQueryStringParameters=function(){var t,n=e.REST_QUERY_CONSTANTS_,r={};return this.isDefault()?r:(this.index_===Re?t=n.PRIORITY_INDEX:this.index_===Ve?t=n.VALUE_INDEX:this.index_===ve?t=n.KEY_INDEX:(Object(s.e)(this.index_ instanceof Ke,"Unrecognized index type!"),t=this.index_.toString()),r[n.ORDER_BY]=Object(s.B)(t),this.startSet_&&(r[n.START_AT]=Object(s.B)(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+Object(s.B)(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=Object(s.B)(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+Object(s.B)(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_),r)},e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},e.DEFAULT=new e,e}(),ln=function(e){function t(t,n){if(!(t instanceof sn))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,cn.DEFAULT,!1)||this}return Object(i.c)(t,e),t.prototype.getKey=function(){return Object(s.C)("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},t.prototype.child=function(e){return Object(s.C)("Reference.child",1,1,arguments.length),"number"==typeof e?e=String(e):e instanceof L||(null===this.path.getFront()?le("Reference.child",1,e,!1):ce("Reference.child",1,e,!1)),new t(this.repo,this.path.child(e))},t.prototype.getParent=function(){Object(s.C)("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){Object(s.C)("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return this.repo.database},t.prototype.set=function(e,t){Object(s.C)("Reference.set",1,2,arguments.length),he("Reference.set",this.path),ne("Reference.set",1,e,this.path,!1),Object(s.D)("Reference.set",2,t,!0);var n=new s.b;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if(Object(s.C)("Reference.update",1,2,arguments.length),he("Reference.update",this.path),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,E("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ie("Reference.update",1,e,this.path,!1),Object(s.D)("Reference.update",2,t,!0);var i=new s.b;return this.repo.update(this.path,e,i.wrapCallback(t)),i.promise},t.prototype.setWithPriority=function(e,t,n){if(Object(s.C)("Reference.setWithPriority",2,3,arguments.length),he("Reference.setWithPriority",this.path),ne("Reference.setWithPriority",1,e,this.path,!1),se("Reference.setWithPriority",2,t,!1),Object(s.D)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new s.b;return this.repo.setWithPriority(this.path,e,t,r.wrapCallback(n)),r.promise},t.prototype.remove=function(e){return Object(s.C)("Reference.remove",0,1,arguments.length),he("Reference.remove",this.path),Object(s.D)("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if(Object(s.C)("Reference.transaction",1,3,arguments.length),he("Reference.transaction",this.path),Object(s.D)("Reference.transaction",1,e,!1),Object(s.D)("Reference.transaction",2,t,!0),de("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new s.b;"function"==typeof t&&r.promise.catch((function(){}));var i=function(e,n,i){e?r.reject(e):r.resolve(new fe(n,i)),"function"==typeof t&&t(e,n,i)};return this.repo.startTransaction(this.path,e,i,n),r.promise},t.prototype.setPriority=function(e,t){Object(s.C)("Reference.setPriority",1,2,arguments.length),he("Reference.setPriority",this.path),se("Reference.setPriority",1,e,!1),Object(s.D)("Reference.setPriority",2,t,!0);var n=new s.b;return this.repo.setWithPriority(this.path.child(".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){Object(s.C)("Reference.push",0,2,arguments.length),he("Reference.push",this.path),ne("Reference.push",1,e,this.path,!0),Object(s.D)("Reference.push",2,t,!0);var n,r=this.repo.serverTime(),i=ge(r),o=this.child(i),a=this.child(i);return n=null!=e?o.set(e,t).then((function(){return a})):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof t&&n.catch((function(){})),o},t.prototype.onDisconnect=function(){return he("Reference.onDisconnect",this.path),new pe(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),t}(Je);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Je.__referenceConstructor=ln,Ct.__referenceConstructor=ln;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var hn,un=function(){this.children={},this.childCount=0,this.value=null},dn=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new un),this.name_=e,this.parent_=t,this.node_=n}return e.prototype.subTree=function(t){for(var n,r=t instanceof L?t:new L(t),i=this;null!==(n=r.getFront());){i=new e(n,i,Object(s.y)(i.node_.children,n)||new un),r=r.popFront()}return i},e.prototype.getValue=function(){return this.node_.value},e.prototype.setValue=function(e){Object(s.e)(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},e.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},e.prototype.hasChildren=function(){return this.node_.childCount>0},e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},e.prototype.forEachChild=function(t){var n=this;A(this.node_.children,(function(r,i){t(new e(r,n,i))}))},e.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild((function(t){t.forEachDescendant(e,!0,n)})),t&&n&&e(this)},e.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild((function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)}))},e.prototype.path=function(){return new L(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},e.prototype.name=function(){return this.name_},e.prototype.parent=function(){return this.parent_},e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},e.prototype.updateChild_=function(e,t){var n=t.isEmpty(),r=Object(s.i)(this.node_.children,e);n&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},e}();!function(e){e[e.RUN=0]="RUN",e[e.SENT=1]="SENT",e[e.COMPLETED=2]="COMPLETED",e[e.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",e[e.NEEDS_ABORT=4]="NEEDS_ABORT"}(hn||(hn={})),sn.MAX_TRANSACTION_RETRIES_=25,sn.prototype.transactions_init_=function(){this.transactionQueueTree_=new dn},sn.prototype.startTransaction=function(e,t,n,r){this.log_("transaction on "+e);var i=function(){},o=new ln(this,e);o.on("value",i);var a={path:e,update:t,onComplete:n,status:null,order:f(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},c=this.getLatestState_(e);a.currentInputSnapshot=c;var l=a.update(c.val());if(void 0===l){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var h=new Qe(a.currentInputSnapshot,new ln(this,a.path),Re);a.onComplete(null,!1,h)}}else{re("transaction failed: Data returned ",l,a.path),a.status=hn.RUN;var u=this.transactionQueueTree_.subTree(e),d=u.getValue()||[];d.push(a),u.setValue(d);var p=void 0;if("object"==typeof l&&null!==l&&Object(s.i)(l,".priority"))p=Object(s.y)(l,".priority"),Object(s.e)(te(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else p=(this.serverSyncTree_.calcCompleteEventCache(e)||Le.EMPTY_NODE).getPriority().val();p=p;var g=this.generateServerValues(),m=ze(l,p),y=nt(m,g);a.currentOutputSnapshotRaw=m,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var _=this.serverSyncTree_.applyUserOverwrite(e,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,_),this.sendReadyTransactions_()}},sn.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||Le.EMPTY_NODE},sn.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);Object(s.e)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return e.status===hn.RUN}))&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild((function(e){t.sendReadyTransactions_(e)}))},sn.prototype.sendTransactionQueue_=function(e,t){for(var n=this,r=t.map((function(e){return e.currentWriteId})),i=this.getLatestState_(e,r),o=i,a=i.hash(),c=0;c<t.length;c++){var l=t[c];Object(s.e)(l.status===hn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=hn.SENT,l.retryCount++;var h=L.relativePath(e,l.path);o=o.updateChild(h,l.currentOutputSnapshotRaw)}var u=o.val(!0),d=e;this.server_.put(d.toString(),u,(function(r){n.log_("transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var s=[],o=0;o<t.length;o++){if(t[o].status=hn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[o].currentWriteId)),t[o].onComplete){var a=t[o].currentOutputSnapshotResolved,c=new ln(n,t[o].path),l=new Qe(a,c,Re);s.push(t[o].onComplete.bind(null,null,!0,l))}t[o].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(e,i);for(o=0;o<s.length;o++)j(s[o])}else{if("datastale"===r)for(o=0;o<t.length;o++)t[o].status===hn.SENT_NEEDS_ABORT?t[o].status=hn.NEEDS_ABORT:t[o].status=hn.RUN;else{E("transaction at "+d.toString()+" failed: "+r);for(o=0;o<t.length;o++)t[o].status=hn.NEEDS_ABORT,t[o].abortReason=r}n.rerunTransactions_(e)}}),a)},sn.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},sn.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,r=[],i=[],o=e.filter((function(e){return e.status===hn.RUN})).map((function(e){return e.currentWriteId})),a=0;a<e.length;a++){var c=e[a],l=L.relativePath(t,c.path),h=!1,u=void 0;if(Object(s.e)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===hn.NEEDS_ABORT)h=!0,u=c.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else if(c.status===hn.RUN)if(c.retryCount>=sn.MAX_TRANSACTION_RETRIES_)h=!0,u="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else{var d=this.getLatestState_(c.path,o);c.currentInputSnapshot=d;var p=e[a].update(d.val());if(void 0!==p){re("transaction failed: Data returned ",p,c.path);var f=ze(p);"object"==typeof p&&null!=p&&Object(s.i)(p,".priority")||(f=f.updatePriority(d.getPriority()));var g=c.currentWriteId,m=this.generateServerValues(),y=nt(f,m);c.currentOutputSnapshotRaw=f,c.currentOutputSnapshotResolved=y,c.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(g),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(c.path,y,c.currentWriteId,c.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(g,!0))}else h=!0,u="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,i),i=[],h&&(e[a].status=hn.COMPLETED,n=e[a].unwatcher,setTimeout(n,Math.floor(0)),e[a].onComplete))if("nodata"===u){var _=new ln(this,e[a].path),v=e[a].currentInputSnapshot,w=new Qe(v,_,Re);r.push(e[a].onComplete.bind(null,null,!1,w))}else r.push(e[a].onComplete.bind(null,new Error(u),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)j(r[a]);this.sendReadyTransactions_()}},sn.prototype.getAncestorTransactionNode_=function(e){for(var t,n=this.transactionQueueTree_;null!==(t=e.getFront())&&null===n.getValue();)n=n.subTree(t),e=e.popFront();return n},sn.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort((function(e,t){return e.order-t.order})),t},sn.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild((function(e){n.aggregateTransactionQueuesForNode_(e,t)}))},sn.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==hn.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(n.length>0?n:null)}e.forEachChild((function(e){t.pruneCompletedTransactionsBelowNode_(e)}))},sn.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor((function(e){t.abortTransactionsOnNode_(e)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(e){t.abortTransactionsOnNode_(e)})),n},sn.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],r=[],i=-1,o=0;o<t.length;o++)if(t[o].status===hn.SENT_NEEDS_ABORT);else if(t[o].status===hn.SENT)Object(s.e)(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=hn.SENT_NEEDS_ABORT,t[o].abortReason="set";else if(Object(s.e)(t[o].status===hn.RUN,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[o].currentWriteId,!0)),t[o].onComplete){n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?e.setValue(null):t.length=i+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r);for(o=0;o<n.length;o++)j(n[o])}};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var pn,fn=function(){function e(){this.repos_={},this.useRestClient_=!1}return e.getInstance=function(){return pn||(pn=new e),pn},e.prototype.interrupt=function(){for(var e in this.repos_)for(var t in this.repos_[e])this.repos_[e][t].interrupt()},e.prototype.resume=function(){for(var e in this.repos_)for(var t in this.repos_[e])this.repos_[e][t].resume()},e.prototype.databaseFromApp=function(e,t){var n=t||e.options.databaseURL;void 0===n&&C("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var r=G(n),i=r.repoInfo,s=void 0;return"undefined"!=typeof process&&(s=process.env[p]),s&&(n="http://"+s+"?ns="+i.namespace,i=(r=G(n)).repoInfo),ue("Invalid Firebase Database URL",1,r),r.path.isEmpty()||C("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,e).database},e.prototype.deleteRepo=function(e){var t=Object(s.y)(this.repos_,e.app.name);t&&Object(s.y)(t,e.repoInfo_.toURLString())===e||C("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.repoInfo_.toURLString()]},e.prototype.createRepo=function(e,t){var n=Object(s.y)(this.repos_,t.name);n||(n={},this.repos_[t.name]=n);var r=Object(s.y)(n,e.toURLString());return r&&C("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new sn(e,this.useRestClient_,t),n[e.toURLString()]=r,r},e.prototype.forceRestClient=function(e){this.useRestClient_=e},e}(),gn=function(){function e(e){this.repo_=e,e instanceof sn||C("Don't call new Database() directly - please use firebase.database()."),this.root_=new ln(e,L.Empty),this.INTERNAL=new mn(this)}return Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),e.prototype.ref=function(e){return this.checkDeleted_("ref"),Object(s.C)("database.ref",0,1,arguments.length),e instanceof ln?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),Object(s.C)(t,1,1,arguments.length);var n=G(e);ue(t,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&C(t+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repo_&&C("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){Object(s.C)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},e.prototype.goOnline=function(){Object(s.C)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},e.ServerValue={TIMESTAMP:{".sv":"timestamp"}},e}(),mn=function(){function e(e){this.database=e}return e.prototype.delete=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return this.database.checkDeleted_("delete"),fn.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},e}(),yn=Object.freeze({forceLongPolling:function(){Zt.forceDisallow(),Vt.forceAllow()},forceWebSockets:function(){Vt.forceDisallow()},isWebSocketsAvailable:function(){return Zt.isAvailable()},setSecurityDebugCallback:function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){e.repo.stats(t)},statsIncrementCounter:function(e,t){e.repo.statsIncrementCounter(t)},dataUpdateCount:function(e){return e.repo.dataUpdateCount},interceptServerData:function(e,t){return e.repo.interceptServerData_(t)}}),_n=nn;nn.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},nn.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var vn=Xt,wn=z,bn=Object.freeze({DataConnection:_n,RealTimeConnection:vn,hijackHash:function(e){var t=nn.prototype.put;return nn.prototype.put=function(n,r,i,s){void 0!==s&&(s=e()),t.call(this,n,r,i,s)},function(){nn.prototype.put=t}},ConnectionTarget:wn,queryIdentifier:function(e){return e.queryIdentifier()},forceRestClient:function(e){fn.getInstance().forceRestClient(e)}}),Sn=gn.ServerValue;!function(t){var n;n=t.SDK_VERSION,Qt=n;var r=t.INTERNAL.registerService("database",(function(e,t,n){return fn.getInstance().databaseFromApp(e,n)}),{Reference:ln,Query:Je,Database:gn,DataSnapshot:Qe,enableLogging:v,INTERNAL:yn,ServerValue:Sn,TEST_ACCESS:bn},null,!0);Object(s.s)()&&(e.exports=r)}(r.a)}).call(this,n(104)(e))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";n.r(t);var r=n(62),i=n.n(r),s=n(15),o=n.n(s),a=n(16),c=n.n(a),l=n(63),h=n.n(l);
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const u=()=>{const e=(()=>{if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")})();return"logLevel"in e?e.logLevel:0};
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */console.log(`log-factory: binding logFactory to level [${u()}]`);const d=()=>()=>{},p=(e,t="")=>{const n=u(),r={};return["log","warn","error","group","groupCollapsed","groupEnd"].forEach(i=>r[i]=n>0?((e,t,n="log")=>{const r=`background: ${t||"gray"}; color: white; padding: 1px 6px 2px 7px; border-radius: 6px;`;return console[n].bind(console,`%c${e}`,r)})(e,t,i):d),r};var f=n(54),g=n.n(f);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const m=fetch,y=["Text","URL","Number","Boolean"];
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class _{static convert(e,t){const n=JSON.parse(e),r={},i={};n["@graph"]||(n["@graph"]=[n]);for(const e of n["@graph"])"rdf:Property"===e["@type"]?i[e["@id"]]=e:"rdfs:Class"===e["@type"]&&(r[e["@id"]]=e,e.subclasses=[],e.superclass=null);for(const e of Object.values(r))if(void 0!==e["rdfs:subClassOf"]){null==e["rdfs:subClassOf"].length&&(e["rdfs:subClassOf"]=[e["rdfs:subClassOf"]]);for(const t of e["rdfs:subClassOf"]){const n=t["@id"];null==e.superclass&&(e.superclass=[]),r[n]?(r[n].subclasses.push(e),e.superclass.push(r[n])):e.superclass.push({"@id":n})}}for(const e of Object.values(r))0===e.subclasses.length&&null==t&&(t=e);const s=[];for(const e of Object.values(i)){let n=e["schema:domainIncludes"];if(n||(n={"@id":t["@id"]}),n.length||(n=[n]),(n=n.map(e=>e["@id"])).includes(t["@id"])){const t=e["@id"].split(":")[1];let n=e["schema:rangeIncludes"];n||console.log(e),n.length||(n=[n]),(n=(n=n.map(e=>e["@id"].split(":")[1])).filter(e=>y.includes(e))).length>0&&s.push({name:t,type:n})}}const o=t["@id"].split(":")[1],a=t&&t.superclass?t.superclass.map(e=>e["@id"].split(":")[1]):[];let c="";for(const e of a)c+=`import 'https://schema.org/${e}'\n\n`;if(c+=`schema ${o}`,a.length>0&&(c+=` extends ${a.join(", ")}`),s.length>0)for(const e of s){let t;c+=`\n  ${t=e.type.length>1?"("+e.type.join(" or ")+")":e.type[0]} ${e.name}`}return c+="\n"}}class v extends Error{constructor(e,t,n,r){super(),this.cause=e,this.method=t,this.particleId=n,this.particleName=r,this.stack+=`\nCaused by: ${this.cause.stack}`}toLiteral(){return{exceptionType:this.constructor.name,cause:{name:this.cause.name,message:this.cause.message,stack:this.cause.stack},method:this.method,particleId:this.particleId,particleName:this.particleName,stack:this.stack}}static fromLiteral(e){const t=e.cause;let n;switch(e.exceptionType){case w.name:n=new w(t,e.method,e.particleId,e.particleName);break;case b.name:n=new b(t,e.method,e.particleId,e.particleName);break;default:throw new Error(`Unknown exception type: ${e.exceptionType}`)}return n.stack=e.stack,n}}class w extends v{get message(){const e=this.particleName?this.particleName:this.particleId;return`SystemException: exception ${this.cause.name} raised when invoking system function ${this.method} on behalf of particle ${e}: ${this.cause.message}`}}class b extends v{get message(){const e=this.particleName?this.particleName:this.particleId;return`UserException: exception ${this.cause.name} raised when invoking function ${this.method} on particle ${e}: ${this.cause.message}`}}const S=[];var C,E;C=e=>{throw console.log(e.method,e.particleName),e},S.includes(C)||S.push(C),function(e){e.Dom="dom",e.DomTouch="domTouch",e.Vr="vr",e.Voice="voice"}(E||(E={}));class k{constructor(e,t=[]){this.all=e,this.names=t}static create(e){return g()(null!=e),new k(!1,e)}intersection(e){return this.all&&e.all?new k(!0,[]):this.all?new k(!1,e.names):new k(!1,this.names.filter(t=>e.all||e.names.includes(t)))}static intersection(e){return e.reduce((e,t)=>e.intersection(t),k.all)}union(e){return this.all||e.all?k.all:new k(!1,[...new Set(this.names.concat(e.names))])}static union(e){return 0===e.length?k.all:e.reduce((e,t)=>e.union(t),k.create([]))}isResolved(){return this.all||this.names.length>0}isCompatible(e){return this.intersection(k.create(e)).isResolved()}static get Name(){return E}}k.all=new k(!0,[]),k.dom=new k(!1,[k.Name.Dom]),k.domTouch=new k(!1,[k.Name.DomTouch]),k.voice=new k(!1,[k.Name.Voice]),k.vr=new k(!1,[k.Name.Vr]);function x(e,t=!1){const n=t?"?":"";switch(e){case"in":return`reads${n}`;case"out":return`writes${n}`;case"inout":return`reads${n} writes${n}`;case"`consume":return`\`consumes${n}`;case"`provide":return`\`provides${n}`;case"host":return`hosts${n}`;case"any":return`any${n}`;default:throw new Error(`Bad pre slandles direction ${e}`)}}function T(e){switch(e){case"->":return"out";case"<-":return"in";case"<->":return"inout";case"`consume":return"`consume";case"`provide":return"`provide";case"=":return"any";default:throw new Error(`Bad arrow ${e}`)}}function R(e){switch(e){case"in":return"<-";case"out":return"->";case"inout":return"<->";case"host":return"=";case"`consume":return"`consume";case"`provide":return"`provide";case"any":return"=";default:throw new Error(`Unexpected direction ${e}`)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class I{}I.useNewStorageStack=!1,I.parseBothSyntaxes=!0,I.defaultToPreSlandlesSyntax=!0;class O extends I{static reset(){Object.assign(O,I)}static withPreSlandlesSyntax(e){return O.withFlags({parseBothSyntaxes:!1,defaultToPreSlandlesSyntax:!0},e)}static withPostSlandlesSyntax(e){return O.withFlags({parseBothSyntaxes:!1,defaultToPreSlandlesSyntax:!1},e)}static withNewStorageStack(e){return O.withFlags({useNewStorageStack:!0},e)}static withFlags(e,t){return async(...n)=>{let r;Object.assign(O,e);try{r=await t(...n)}finally{O.reset()}return r}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function N(e){return nt.fromLiteral(e)}function P(e){return"object"==typeof e?N(e):e}function A({type:e,name:t,direction:n}){return{type:e?N(e):void 0,name:t?P(t):void 0,direction:n||"any"}}function M({name:e,direction:t,isRequired:n,isSet:r}){return{name:e?P(e):void 0,direction:t,isRequired:n,isSet:r}}function D(e){return e instanceof st?e.toLiteral():e}function F({type:e,name:t,direction:n}){return{type:e&&(r=e,r.toLiteral()),name:t&&D(t),direction:n};var r}function j({name:e,direction:t,isRequired:n,isSet:r}){return{name:e&&D(e),direction:t,isRequired:n,isSet:r}}O.reset();const $=["type","name","direction"],B=["name","direction","isRequired","isSet"];class L{constructor(e,t,n){g()(e),g()(void 0!==t),g()(void 0!==n),this.name=e,this.handleConnections=t,this.slots=n,this.typeVars=[];for(const e of t)for(const t of $)L.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t});for(const e of n)for(const t of B)L.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t})}toPrettyString(){return"InterfaceInfo"}mergeTypeVariablesByName(e){this.typeVars.forEach(({object:t,field:n})=>t[n]=t[n].mergeTypeVariablesByName(e))}get canReadSubset(){return this._cloneAndUpdate(e=>e.canReadSubset)}get canWriteSuperset(){return this._cloneAndUpdate(e=>e.canWriteSuperset)}isMoreSpecificThan(e){if(this.handleConnections.length!==e.handleConnections.length||this.slots.length!==e.slots.length)return!1;for(let t=0;t<this.typeVars.length;t++){const n=this.typeVars[t],r=e.typeVars[t];if(!n.object[n.field].isMoreSpecificThan(r.object[r.field]))return!1}return!0}_applyExistenceTypeTest(e){for(const t of this.typeVars)if(e(t.object[t.field]))return!0;return!1}_handleConnectionsToManifestString(){return this.handleConnections.map(e=>{if(O.defaultToPreSlandlesSyntax)return`  ${e.direction||"any"} ${e.type.toString()} ${e.name?e.name:"*"}`;{const t=[];return e.name&&t.push(`${e.name}:`),void 0!==e.direction&&"any"!==e.direction&&t.push(x(e.direction)),t.push(e.type.toString()),`  ${t.join(" ")}`}}).join("\n")}_slotsToManifestString(){return this.slots.map(e=>{if(O.defaultToPreSlandlesSyntax)return`  ${e.isRequired?"must ":""}${e.direction} ${e.isSet?"set of ":""}${e.name||""}`;return`  ${e.name?`${e.name}: `:""}${e.direction}s${e.isRequired?"":"?"} ${e.isSet?"[Slot]":"Slot"}`}).join("\n")}toString(){return`interface ${this.name}\n${this._handleConnectionsToManifestString()}\n${this._slotsToManifestString()}`}static fromLiteral(e){const t=e.handleConnections.map(A),n=e.slots.map(M);return new L(e.name,t,n)}toLiteral(){const e=this.handleConnections.map(F),t=this.slots.map(j);return{name:this.name,handleConnections:e,slots:t}}clone(e){const t=this.handleConnections.map(({name:t,direction:n,type:r})=>({name:t,direction:n,type:r?r.clone(e):void 0})),n=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new L(this.name,t,n)}cloneWithResolutions(e){return this._cloneWithResolutions(e)}_cloneWithResolutions(e){const t=this.handleConnections.map(({name:t,direction:n,type:r})=>({name:t,direction:n,type:r?r._cloneWithResolutions(e):void 0})),n=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new L(this.name,t,n)}canEnsureResolved(){for(const e of this.typeVars)if(!e.object[e.field].canEnsureResolved())return!1;return!0}maybeEnsureResolved(){for(const e of this.typeVars){let t=e.object[e.field];if(!(t=t.clone(new Map)).maybeEnsureResolved())return!1}for(const e of this.typeVars)e.object[e.field].maybeEnsureResolved();return!0}tryMergeTypeVariablesWith(e){if(!this._equalItems(e.slots,this.slots,this._equalSlot))return null;if(e.handleConnections.length!==this.handleConnections.length)return null;const t=new Set(this.handleConnections),n=new Set(e.handleConnections),r=new Map;let i=t.size;for(;t.size>0;){const e=[...t.values()].map(e=>({handleConnection:e,match:[...n.values()].filter(t=>this._equalHandleConnection(e,t))}));for(const i of e){if(0===i.match.length)return null;1===i.match.length&&(r.set(i.handleConnection,i.match[0]),n.delete(i.match[0]),t.delete(i.handleConnection))}if(t.size===i)return null;i=t.size}const s=[];for(const e of this.handleConnections){const t=r.get(e);let n;if(e.type.hasVariable||t.type.hasVariable){if(!(n=ft._tryMergeTypeVariable(e.type,t.type)))return null}else n=e.type||t.type;s.push({name:e.name||t.name,direction:e.direction||t.direction,type:n})}const o=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new L(this.name,s,o)}resolvedType(){return this._cloneAndUpdate(e=>e.resolvedType())}equals(e){return this.handleConnections.length===e.handleConnections.length&&(!!this._equalItems(e.handleConnections,this.handleConnections,this._equalHandleConnection)&&!!this._equalItems(e.slots,this.slots,this._equalSlot))}_equalHandleConnection(e,t){return e.name===t.name&&e.direction===t.direction&&ft.compareTypes({type:e.type},{type:t.type})}_equalSlot(e,t){return e.name===t.name&&e.direction===t.direction&&e.isRequired===t.isRequired&&e.isSet===t.isSet}_equalItems(e,t,n){for(const r of e){let e=!1;for(const i of t)if(n(i,r)){e=!0;break}if(!e)return!1}return!0}_cloneAndUpdate(e){const t=this.clone(new Map);return t.typeVars.forEach(t=>L._updateTypeVar(t,e)),t}static _updateTypeVar(e,t){e.object[e.field]=t(e.object[e.field])}static isTypeVar(e){return e instanceof st||e instanceof nt&&e.hasVariable}static mustMatch(e){return!(null==e||L.isTypeVar(e))}static handleConnectionsMatch(e,t){if(L.mustMatch(e.name)&&e.name!==t.name)return!1;if(L.mustMatch(e.direction)&&"any"!==e.direction&&"any"!==t.direction&&e.direction!==t.direction)return!1;if(null==e.type)return!0;const[n,r]=nt.unwrapPair(e.type,t.type);return n instanceof st?[{var:n,value:r,direction:e.direction}]:ft.compareTypes({type:n},{type:r})}static slotsMatch(e,t){return(!L.mustMatch(e.name)||e.name===t.name)&&((!L.mustMatch(e.direction)||e.direction===t.direction)&&((!L.mustMatch(e.isRequired)||e.isRequired===t.isRequired)&&(!L.mustMatch(e.isSet)||e.isSet===t.isSet)))}particleMatches(e){return!1!==this.cloneWithResolutions(new Map).restrictType(e)}restrictType(e){return this._restrictThis(e)}_restrictThis(e){const t=this.handleConnections.map(t=>e.handleConnections.map(e=>({match:e,result:L.handleConnectionsMatch(t,e)})).filter(e=>!1!==e.result)),n=[];e.slotConnections.forEach(e=>{n.push({name:e.name,direction:"consume",isRequired:e.isRequired,isSet:e.isSet}),e.provideSlotConnections.forEach(e=>{n.push({name:e.name,direction:"provide",isRequired:!1,isSet:e.isSet})})});const r=this.slots.map(e=>n.filter(t=>L.slotsMatch(e,t))).map(e=>e.map(e=>({match:e,result:!0})));function i(e,t){if(0===e.length)return[];const n=e.pop();for(const r of n){if(t.includes(r.match))continue;const n=t.slice();n.push(r.match);const s=i(e,n);if(!1!==s)return"boolean"==typeof r.result?s:s.concat(r.result)}return!1}const s=i(t,[]),o=i(r,[]);if(!1===s||!1===o)return!1;for(const e of s)if(e.var.variable.resolution){if(e.var.variable.resolution instanceof st){if(!ft.processTypeList(e.var,[{type:e.value,direction:e.direction}]))return!1}else if(!ft.compareTypes({type:e.var.variable.resolution},{type:e.value}))return!1}else e.var.variable.resolution=e.value;return!0}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class U{constructor(e,t){this.formFactor=e,this.handle=t}toLiteral(){return this}static fromLiteral({formFactor:e,handle:t}){return new U(e,t)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class H{constructor(e,t){this.id=e.toString(),this.serialization=t.replace(/\bimport .*\n/g,"")}static extractSerialization(e){return e.serialization.replace(/\bimport .*\n/g,"")}}class z{constructor(e,t,n,r){this.id=e,this.storageKey=t,this.type=n,this.tags=r}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const q=Symbol("internals");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class W{constructor(e,t,n,r,i){this.mutable=!0,this.entity=e,this.entityClass=t,this.schema=n,this.context=r,this.userIDComponent=i}getId(){if(void 0===this.id)throw new Error("no id");return this.id}getEntityClass(){return this.entityClass}isIdentified(){return void 0!==this.id}identify(e){g()(!this.isIdentified(),"identify() called on already identified entity"),this.id=e;const t=e.split(":"),n=t.lastIndexOf("uid");this.userIDComponent=n>0?t.slice(n+1).join(":"):""}createIdentity(e,t){let n;g()(!this.isIdentified(),"createIdentity() called on already identified entity"),n=this.userIDComponent?`${e.toString()}:uid:${this.userIDComponent}`:t.newChildId(e).toString(),this.id=n}isMutable(){return this.mutable}makeImmutable(){this.mutable=!1}mutate(e){if(!this.mutable)throw new Error("Entity is immutable.");let t;"function"==typeof e?e(t=this.dataClone()):t=e,Q(this.entity,t,this.schema,this.context)}toLiteral(){return JSON.parse(JSON.stringify(this.entity))}dataClone(){const e={},t=this.schema.fields;for(const n of Object.keys(t))void 0!==this.entity[n]&&(t[n]&&"schema-reference"===t[n].kind?this.entity[n]&&(e[n]=this.entity[n].dataClone()):t[n]&&"schema-collection"===t[n].kind?this.entity[n]&&(e[n]=[...this.entity[n]].map(e=>e.dataClone())):e[n]=this.entity[n]);return e}serialize(){return{id:this.id,rawData:this.dataClone()}}debugLog(){const e=this.entity,t=new W(null,this.entityClass,this.schema,this.context,this.userIDComponent);t.id=this.id,t.entity=t;const n=class extends V{constructor(){super(),Object.assign(this,e),this[q]=t}};Object.defineProperty(n,"name",{value:e.constructor.name}),console.dir(new n,{depth:null})}}class V{toString(){const e=Object.entries(this).map(([e,t])=>`${e}: ${JSON.stringify(t)}`);return`${this.constructor.name} { ${e.join(", ")} }`}static createEntityClass(e,t){const n=class extends V{constructor(r,i){return super(),g()(r,"can't construct entity with null data"),g()(!i||-1===i.indexOf(":"),"user IDs must not contain the ':' character"),Object.defineProperty(this,q,{value:new W(this,n,e,t,i),enumerable:!1}),Q(this,r,e,t),new Proxy(this,{set:(e,t,n)=>{throw new Error(`Tried to modify entity field '${t}'. Use the mutate method instead.`)}})}static get type(){return new it(e)}static get key(){return{tag:"entity",schema:e}}static get schema(){return e}};return Object.defineProperty(n,"name",{value:e.name}),n}static id(e){return K(e).getId()}static entityClass(e){return K(e).getEntityClass()}static isIdentified(e){return K(e).isIdentified()}static identify(e,t){return K(e).identify(t),e}static createIdentity(e,t,n){K(e).createIdentity(t,n)}static isMutable(e){return K(e).isMutable()}static makeImmutable(e){K(e).makeImmutable()}static mutate(e,t){K(e).mutate(t)}static toLiteral(e){return K(e).toLiteral()}static dataClone(e){return K(e).dataClone()}static serialize(e){return K(e).serialize()}static debugLog(e){K(e).debugLog()}}function K(e){const t=e[q];return g()(void 0!==t,"SYMBOL_INTERNALS lookup on non-entity"),t}function Q(e,t,n,r){for(const[i,s]of Object.entries(t)){const t=Y(n.fields[i],s,i,r);Z(i,t,n),e[i]=t}}function G(e,t){switch(e.type){case"Text":case"URL":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Bytes":return"Uint8Array";default:throw new Error(`Unknown field type ${e.type} in schema ${t}`)}}function Z(e,t,n,r){if(void 0===(r=r||n.fields[e]))throw new Error(`Can't set field ${e}; not in schema ${n.name}`);if(null!=t)switch(r.kind){case"schema-primitive":if(("Uint8Array"===t.constructor.name?"Uint8Array":typeof t)!==G(r,n.name))throw new TypeError(`Type mismatch setting field ${e} (type ${r.type}); `+`value '${t}' is type ${typeof t}`);break;case"schema-union":for(const e of r.types)if(typeof t===G(e,n.name))return;throw new TypeError(`Type mismatch setting field ${e} (union [${r.types}]); `+`value '${t}' is type ${typeof t}`);case"schema-tuple":if(!Array.isArray(t))throw new TypeError(`Cannot set tuple ${e} with non-array value '${t}'`);if(t.length!==r.types.length)throw new TypeError(`Length mismatch setting tuple ${e} `+`[${r.types}] with value '${t}'`);r.types.map((i,s)=>{if(void 0!==t[s]&&null!==t[s]&&typeof t[s]!==G(i,n.name))throw new TypeError(`Type mismatch setting field ${e} (tuple [${r.types}]); `+`value '${t}' has type ${typeof t[s]} at index ${s}`)});break;case"schema-reference":if(!(t instanceof Kt))throw new TypeError(`Cannot set reference ${e} with non-reference '${t}'`);if(!ft.compareTypes({type:t.type},{type:new ut(r.schema.model)}))throw new TypeError(`Cannot set reference ${e} with value '${t}' of mismatched type`);break;case"schema-collection":if("Set"!==t.constructor.name)throw new TypeError(`Cannot set collection ${e} with non-Set '${t}'`);for(const i of t)Z(e,i,n,r.schema);break;default:throw new Error(`Unknown kind '${r.kind}' for field ${e} in schema ${n.name}`)}}function Y(e,t,n,r){if(!e)return t;if("schema-reference"===e.kind&&t){if(t instanceof Kt)return t;if(t.id&&t.storageKey)return new Kt(t,new ut(e.schema.model),r);throw new TypeError(`Cannot set reference ${n} with non-reference '${t}'`)}if("schema-collection"===e.kind&&t){if("Set"===t.constructor.name)return t;if(t.length&&t instanceof Object)return new Set(t.map(t=>Y(e.schema,t,n,r)));throw new TypeError(`Cannot set collection ${n} with non-collection '${t}'`)}return t}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class X extends Error{}var J,ee,te,ne,re;function ie(e){return e.changeType===J.Operations&&0===e.operations.length}function se(){return{changeType:J.Operations,operations:[]}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Operations=0]="Operations",e[e.Model=1]="Model"}(J||(J={})),function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.FastForward=2]="FastForward"}(ee||(ee={}));class oe{constructor(){this.model={values:{},version:{}}}merge(e){if(ce(this.model.version,e.version)){let t=!0;const n=Object.keys(this.model.values),r=Object.keys(e.values);if(n.length===r.length){for(const n of Object.keys(this.model.values))if(!e.values[n]){t=!1;break}if(t)return{modelChange:se(),otherChange:se()}}}const t=ae(this.model.version,e.version),n={},r={type:ee.FastForward,added:[],removed:[],oldClock:e.version,newClock:t};for(const t of Object.values(e.values)){const e=t.value,i=e.id,s=this.model.values[i];if(s)if(ce(s.version,t.version))n[i]=s;else{const o=ae(s.version,t.version);n[i]={value:e,version:o},r.added.push([e,o])}else le(this.model.version,t.version)?r.removed.push(e):n[i]=t}for(const[t,i]of Object.entries(this.model.values))e.values[t]||le(e.version,i.version)||(n[t]=i,r.added.push([i.value,i.version]));const i=function(e){if(e.removed.length>0)return null;if(0===e.added.length)return null;const t=function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return null;const n=Object.entries(e).filter(([e,n])=>t[e]>n);return 1===n.length?n[0][0]:null}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(e.oldClock,e.newClock);if(null===t)return null;const n=[...e.added].sort(([e,n],[r,i])=>(n[t]||0)-(i[t]||0));let r=e.oldClock[t];for(const[e,i]of n)if(++r!==i[t])return null;const i={...e.oldClock};if(i[t]=r,!ce(i,e.newClock))return null;return n.map(([e,n])=>({type:ee.Add,added:e,actor:t,clock:n}))}(r)||[r];return this.model.values=n,this.model.version=t,{modelChange:{changeType:J.Model,modelPostChange:this.model},otherChange:{changeType:J.Operations,operations:i}}}applyOperation(e){switch(e.type){case ee.Add:return this.add(e.added,e.actor,e.clock);case ee.Remove:return this.remove(e.removed,e.actor,e.clock);case ee.FastForward:return this.fastForward(e);default:throw new X(`Op ${e} not supported`)}}getData(){return this.model}getParticleView(){return new Set(Object.values(this.model.values).map(e=>e.value))}add(e,t,n){if(this.checkValue(e),(this.model.version[t]||0)+1!==n[t])return!1;this.model.version[t]=n[t];const r=this.model.values[e.id]?this.model.values[e.id].version:{};return this.model.values[e.id]={value:e,version:ae(n,r)},!0}remove(e,t,n){if(this.checkValue(e),!this.model.values[e.id])return!1;const r=n[t]||0;return(this.model.version[t]||0)===r&&(!!le(n,this.model.values[e.id].version)&&(this.model.version[t]=r,delete this.model.values[e.id],!0))}fastForward(e){const t=this.model.version;if(!le(t,e.oldClock))return!1;if(le(t,e.newClock))return!0;for(const[n,r]of e.added){this.checkValue(n);const e=this.model.values[n.id];e?e.version=ae(e.version,r):le(t,r)||(this.model.values[n.id]={value:n,version:r})}for(const t of e.removed){this.checkValue(t);const n=this.model.values[t.id];n&&le(e.newClock,n.version)&&delete this.model.values[t.id]}return this.model.version=ae(t,e.newClock),!0}checkValue(e){g()(e.id&&e.id.length,"CRDT value must have an ID.")}}function ae(e,t){const n={};for(const[t,r]of Object.entries(e))n[t]=r;for(const[r,i]of Object.entries(t))n[r]=Math.max(i,e[r]||0);return n}function ce(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const[n,r]of Object.entries(e))if(r!==t[n])return!1;return!0}function le(e,t){for(const[n,r]of Object.entries(t))if((e[n]||0)<r)return!1;return!0}!function(e){e[e.Set=0]="Set",e[e.Clear=1]="Clear"}(te||(te={}));class he{constructor(){this.collection=new oe}merge(e){const{modelChange:t,otherChange:n}=this.collection.merge(e);let r={changeType:J.Model,modelPostChange:this.collection.getData()},i=r;return ie(t)&&(r=se()),ie(n)&&(i=se()),{modelChange:r,otherChange:i}}applyOperation(e){if(e.type===te.Clear)return this.clear(e.actor,e.clock);if(e.type===te.Set){const t={};for(const[n,r]of Object.entries(e.clock))t[n]=r;if(t[e.actor]=e.clock[e.actor]-1,!this.clear(e.actor,t))return!1;const n={type:ee.Add,added:e.value,actor:e.actor,clock:e.clock};if(!this.collection.applyOperation(n))return!1}return!0}getData(){return this.collection.getData()}getParticleView(){return[...this.collection.getParticleView()].sort()[0]||null}clear(e,t){for(const n of Object.values(this.collection.getData().values)){const r={type:ee.Remove,removed:n.value,actor:e,clock:t};this.collection.applyOperation(r)}return!0}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Set=0]="Set",e[e.Clear=1]="Clear",e[e.Add=2]="Add",e[e.Remove=3]="Remove"}(ne||(ne={}));class ue{constructor(e,t){this.model={singletons:e,collections:t,version:{}}}merge(e){const t={},n={};let r=!0;for(const n of Object.keys(this.model.singletons))t[n]=this.model.singletons[n].merge(e.singletons[n]),t[n].modelChange.changeType!==J.Model&&t[n].otherChange.changeType!==J.Model||(r=!1);for(const t of Object.keys(this.model.collections))n[t]=this.model.collections[t].merge(e.collections[t]),n[t].modelChange.changeType!==J.Model&&n[t].otherChange.changeType!==J.Model||(r=!1);for(const t of Object.keys(e.version))this.model.version[t]=Math.max(this.model.version[t]||0,e.version[t]);if(r){const e=[],r=[];for(const n of Object.keys(t)){for(const r of t[n].modelChange.operations){let t;t=r.type===te.Set?{...r,type:ne.Set,field:n}:{...r,type:ne.Clear,field:n},e.push(t)}for(const e of t[n].otherChange.operations){let t;t=e.type===te.Set?{...e,type:ne.Set,field:n}:{...e,type:ne.Clear,field:n},r.push(t)}}for(const t of Object.keys(n)){for(const r of n[t].modelChange.operations){let n;n=r.type===ee.Add?{...r,type:ne.Add,field:t}:{...r,type:ne.Remove,field:t},e.push(n)}for(const e of n[t].otherChange.operations){let n;n=e.type===ee.Add?{...e,type:ne.Add,field:t}:{...e,type:ne.Remove,field:t},r.push(n)}}return{modelChange:{changeType:J.Operations,operations:e},otherChange:{changeType:J.Operations,operations:r}}}{const e={changeType:J.Model,modelPostChange:this.getData()};return{modelChange:e,otherChange:e}}}applyOperation(e){if(e.type===ne.Set||e.type===ne.Clear){if(!this.model.singletons[e.field]){if(this.model.collections[e.field])throw new Error(`Can't apply ${e.type===ne.Set?"Set":"Clear"} operation to collection field ${e.field}`);throw new Error(`Invalid field: ${e.field} does not exist`)}}else if(!this.model.collections[e.field]){if(this.model.singletons[e.field])throw new Error(`Can't apply ${e.type===ne.Add?"Add":"Remove"} operation to singleton field ${e.field}`);throw new Error(`Invalid field: ${e.field} does not exist`)}if((()=>{switch(e.type){case ne.Set:return this.model.singletons[e.field].applyOperation({...e,type:te.Set});case ne.Clear:return this.model.singletons[e.field].applyOperation({...e,type:te.Clear});case ne.Add:return this.model.collections[e.field].applyOperation({...e,type:ee.Add});case ne.Remove:return this.model.collections[e.field].applyOperation({...e,type:ee.Remove});default:throw new Error(`Unexpected op ${e} for Entity CRDT`)}})()){for(const t of Object.keys(e.clock))this.model.version[t]=Math.max(this.model.version[t]||0,e.clock[t]);return!0}return!1}getData(){const e={},t={};return Object.keys(this.model.singletons).forEach(t=>{e[t]=this.model.singletons[t].getData()}),Object.keys(this.model.collections).forEach(e=>{t[e]=this.model.collections[e].getData()}),{singletons:e,collections:t,version:this.model.version}}getParticleView(){const e={singletons:{},collections:{}};for(const t of Object.keys(this.model.singletons))e.singletons[t]=this.model.singletons[t].getParticleView();for(const t of Object.keys(this.model.collections))e.collections[t]=this.model.collections[t].getParticleView();return e}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class de{constructor(e,t,n){this.description={},this.names=e,this.fields={};for(const[e,n]of Object.entries(t))this.fields[e]="string"==typeof n?{kind:"schema-primitive",type:n}:n;n&&n.description.forEach(e=>this.description[e.name]=e.pattern||e.patterns[0])}toLiteral(){const e={},t=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:t.model.toLiteral()}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:t(e.schema)}:e};for(const n of Object.keys(this.fields))e[n]=t(this.fields[n]);return{names:this.names,fields:e,description:this.description}}static fromLiteral(e={fields:{},names:[],description:{}}){const t={},n=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:nt.fromLiteral(t.model)}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:n(e.schema)}:e};for(const r of Object.keys(e.fields))t[r]=n(e.fields[r]);const r=new de(e.names,t);return r.description=e.description||{},r}get name(){return this.names[0]}static typesEqual(e,t){return de._typeString(e)===de._typeString(t)}static _typeString(e){switch(e.kind){case"schema-primitive":return e.type;case"schema-union":return`(${e.types.map(e=>e.type).join(" or ")})`;case"schema-tuple":return`(${e.types.map(e=>e.type).join(", ")})`;case"schema-reference":return`Reference<${de._typeString(e.schema)}>`;case"type-name":case"schema-inline":return e.model.entitySchema.toInlineSchemaString();case"schema-collection":return`[${de._typeString(e.schema)}]`;default:throw new Error(`Unknown type kind ${e.kind} in schema ${this.name}`)}}static union(e,t){const n=[...new Set([...e.names,...t.names])],r={};for(const[n,i]of[...Object.entries(e.fields),...Object.entries(t.fields)])if(r[n]){if(!de.typesEqual(r[n],i))return null}else r[n]=i;return new de(n,r)}static intersect(e,t){const n=[...e.names].filter(e=>t.names.includes(e)),r={};for(const[n,i]of Object.entries(e.fields)){const e=t.fields[n];e&&de.typesEqual(i,e)&&(r[n]=i)}return new de(n,r)}equals(e){return this===e||this.name===e.name&&this.isMoreSpecificThan(e)&&e.isMoreSpecificThan(this)}isMoreSpecificThan(e){const t=new Set(this.names);for(const n of e.names)if(!t.has(n))return!1;const n={};for(const[e,t]of Object.entries(this.fields))n[e]=t;for(const[t,r]of Object.entries(e.fields)){if(null==n[t])return!1;if(!de.typesEqual(n[t],r))return!1}return!0}get type(){return new it(this)}entityClass(e=null){return V.createEntityClass(this,e)}crdtConstructor(){const e={},t={};for(const[t,{type:n}]of Object.entries(this.fields))if("Text"===n)e[t]=new he;else{if("Number"!==n)throw new Error(`Big Scary Exception: entity field ${t} of type ${n} doesn't yet have a CRDT mapping implemented`);e[t]=new he}return class extends ue{constructor(){super(e,t)}}}static fieldToString([e,t]){const n=de._typeString(t);return O.defaultToPreSlandlesSyntax?`${n} ${e}`:`${e}: ${n}`}toInlineSchemaString(e){const t=this.names.join(" ")||"*",n=Object.entries(this.fields).map(de.fieldToString).join(", ");return`${t} {${n.length>0&&e&&e.hideFields?"...":n}}`}toManifestString(){const e=[];if(e.push(`schema ${this.names.join(" ")}`),e.push(...Object.entries(this.fields).map(e=>`  ${de.fieldToString(e)}`)),Object.keys(this.description).length>0){e.push(`  description \`${this.description.pattern}\``);for(const t of Object.keys(this.description))"pattern"!==t&&e.push(`    ${t} \`${this.description[t]}\``)}return e.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class pe{constructor(e,t,n){this.name=e,this._canWriteSuperset=t,this._canReadSubset=n,this._resolution=null}maybeMergeConstraints(e){return!!this.maybeMergeCanReadSubset(e.canReadSubset)&&this.maybeMergeCanWriteSuperset(e.canWriteSuperset)}maybeMergeCanReadSubset(e){if(null==e)return!0;if(null==this.canReadSubset)return this.canReadSubset=e,!0;if(this.canReadSubset instanceof ht&&e instanceof ht)return!0;if(this.canReadSubset instanceof it&&e instanceof it){const t=de.intersect(this.canReadSubset.entitySchema,e.entitySchema);return!!t&&(this.canReadSubset=new it(t),!0)}return!1}maybeMergeCanWriteSuperset(e){if(null==e)return!0;if(null==this.canWriteSuperset)return this.canWriteSuperset=e,!0;if(this.canWriteSuperset instanceof ht&&e instanceof ht)return!0;if(this.canWriteSuperset instanceof it&&e instanceof it){const t=de.union(this.canWriteSuperset.entitySchema,e.entitySchema);return!!t&&(this.canWriteSuperset=new it(t),!0)}return!1}isSatisfiedBy(e){const t=this._canWriteSuperset;if(!t)return!0;if(!(t instanceof it&&e instanceof it))throw new Error(`constraint checking not implemented for ${this} and ${e}`);return e.getEntitySchema().isMoreSpecificThan(t.getEntitySchema())}get resolution(){return this._resolution?this._resolution.resolvedType():null}isValidResolutionCandidate(e){const t=e.resolvedType().getContainedType();return t instanceof st&&t.variable===this?{result:!1,detail:"variable cannot resolve to collection of itself"}:{result:!0}}set resolution(e){g()(!this._resolution);const t=this.isValidResolutionCandidate(e);g()(t.result,t.detail);let n=e;for(;n&&n instanceof st;){if(n.variable===this)return;n=n.variable.resolution}this._resolution=e,this._canWriteSuperset=null,this._canReadSubset=null}get canWriteSuperset(){return this._resolution?(g()(!this._canWriteSuperset),this._resolution instanceof st?this._resolution.variable.canWriteSuperset:null):this._canWriteSuperset}set canWriteSuperset(e){g()(!this._resolution),this._canWriteSuperset=e}get canReadSubset(){return this._resolution?(g()(!this._canReadSubset),this._resolution instanceof st?this._resolution.variable.canReadSubset:null):this._canReadSubset}set canReadSubset(e){g()(!this._resolution),this._canReadSubset=e}get hasConstraint(){return null!==this._canReadSubset||null!==this._canWriteSuperset}canEnsureResolved(){return this._resolution?this._resolution.canEnsureResolved():!(!this._canWriteSuperset&&!this._canReadSubset)}maybeEnsureResolved(){return this._resolution?this._resolution.maybeEnsureResolved():this._canWriteSuperset?(this.resolution=this._canWriteSuperset,!0):!!this._canReadSubset&&(this.resolution=this._canReadSubset,!0)}toLiteral(){return g()(null==this.resolution),this.toLiteralIgnoringResolutions()}toLiteralIgnoringResolutions(){return{name:this.name,canWriteSuperset:this._canWriteSuperset&&this._canWriteSuperset.toLiteral(),canReadSubset:this._canReadSubset&&this._canReadSubset.toLiteral()}}static fromLiteral(e){return new pe(e.name,e.canWriteSuperset?nt.fromLiteral(e.canWriteSuperset):null,e.canReadSubset?nt.fromLiteral(e.canReadSubset):null)}isResolved(){return this._resolution&&this._resolution.isResolved()}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Increment=0]="Increment",e[e.MultiIncrement=1]="MultiIncrement"}(re||(re={}));
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class fe{}const ge=new class extends fe{next(){return Math.random()}};class me{static next(){return ge.next()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ye{constructor(e){this._nextComponentId=0,this._currentSessionId=e}static newSession(){const e=Math.floor(me.next()*Math.pow(2,50))+"";return new ye(e)}static createWithSessionIdForTesting(e){return new ye(e)}newArcId(e){return ve._newArcIdInternal(this._currentSessionId,e)}newChildId(e,t=""){return t+=this._nextComponentId++,_e._newIdInternal(this._currentSessionId,[...e.idTree,t])}get currentSessionIdForTesting(){return this._currentSessionId}}class _e{constructor(e,t=[]){this.idTree=[],this.root=e,this.idTree=t}static _newIdInternal(e,t=[]){return new _e(e,t)}static fromString(e){const t=e.split(":");if(t[0].startsWith("!")){const e=t[0].slice(1),n=t.slice(1).filter(e=>e.length>0);return new _e(e,n)}return new _e("",t)}toString(){return`!${this.root}:${this.idTree.join(":")}`}idTreeAsString(){return this.idTree.join(":")}equal(e){if(e.root!==this.root||e.idTree.length!==this.idTree.length)return!1;for(let t=0;t<e.idTree.length;t++)if(e.idTree[t]!==this.idTree[t])return!1;return!0}}class ve extends _e{static _newArcIdInternal(e,t){return new ve(e,[t])}static newForTest(e){return ye.newSession().newArcId(e)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const we=(e,t)=>t([e]);
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var be,Se,Ce,Ee,ke,xe,Te,Re,Ie,Oe;!function(e){e[e.ShouldExist=0]="ShouldExist",e[e.ShouldCreate=1]="ShouldCreate",e[e.MayExist=2]="MayExist"}(be||(be={}));class Ne{constructor(e,t){this.storageKey=e,this.exists=t}}class Pe{static clearRegistrationsForTesting(){this.providers=new Set}static async driverInstance(e,t){for(const n of this.providers)if(n.willSupport(e))return n.driver(e,t);return null}static register(e){this.providers.add(e)}static unregister(e){this.providers.delete(e)}static willSupport(e){for(const t of this.providers)if(t.willSupport(e))return!0;return!1}}Pe.providers=new Set,function(e){e[e.Direct=0]="Direct",e[e.Backing=1]="Backing",e[e.ReferenceMode=2]="ReferenceMode"}(Se||(Se={})),function(e){e[e.SyncRequest=0]="SyncRequest",e[e.ModelUpdate=1]="ModelUpdate",e[e.Operations=2]="Operations"}(Ce||(Ce={}));class Ae{constructor(e){this.storageKey=e.storageKey,this.exists=e.exists,this.type=e.type,this.mode=e.mode,this.baseStore=e.baseStore}async idle(){return Promise.resolve()}async cloneFrom(e){g()(e instanceof Ae);const t=e;g()(this.mode===t.mode),await this.onProxyMessage({type:Ce.ModelUpdate,model:await t.serializeContents()})}async modelForSynchronization(){return this.serializeContents()}getStorageEndpoint(){const e=this;let t;return{onProxyMessage:async n=>(n.id=t,e.onProxyMessage(n)),setCallback(n){t=e.on(n)},reportExceptionInHost(t){e.reportExceptionInHost(t)}}}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.Idle="Idle",e.AwaitingResponse="AwaitingResponse",e.AwaitingResponseDirty="AwaitingResponseDirty",e.AwaitingDriverModel="AwaitingDriverModel"}(Ee||(Ee={}));class Me extends Ae{constructor(e){super(e),this.callbacks=new Map,this.nextCallbackID=1,this.version=0,this.pendingException=null,this.pendingResolves=[],this.pendingRejects=[],this.pendingDriverModels=[],this.state=Ee.Idle}async serializeContents(){return await this.idle(),this.localModel.getData()}async idle(){return this.pendingException?Promise.reject(this.pendingException):this.state===Ee.Idle?Promise.resolve():new Promise((e,t)=>{this.pendingResolves.push(e),this.pendingRejects.push(t)})}get versionToken(){return this.driver.getToken()}setState(e){this.state=e,e===Ee.Idle&&this.notifyIdle()}notifyIdle(){this.pendingException?this.pendingRejects.forEach(e=>e(this.pendingException)):(this.pendingResolves.forEach(e=>e()),this.pendingResolves=[])}static async construct(e){const t=new Me(e);if(t.localModel=new(e.type.crdtInstanceConstructor()),t.driver=await Pe.driverInstance(e.storageKey,e.exists),null==t.driver)throw new X(`No driver exists to support storage key ${e.storageKey}`);return t.driver.registerReceiver(t.onReceive.bind(t),e.versionToken),t}async onReceive(e,t){this.pendingDriverModels.push({model:e,version:t}),this.state!==Ee.AwaitingResponse&&this.state!==Ee.AwaitingResponseDirty&&this.applyPendingDriverModels()}deliverCallbacks(e,t,n){e.changeType===J.Operations&&e.operations.length>0?this.callbacks.forEach((r,i)=>{(t||n!==i)&&r({type:Ce.Operations,operations:e.operations,id:i})}):e.changeType===J.Model&&this.callbacks.forEach((r,i)=>{(t||n!==i)&&r({type:Ce.ModelUpdate,model:e.modelPostChange,id:i})})}async processModelChange(e,t,n,r){this.deliverCallbacks(e,!1,r),await this.updateStateAndAct(this.noDriverSideChanges(e,t,!1),n,!1)}async updateStateAndAct(e,t,n){if(e)return this.setState(Ee.Idle),void(this.version=t);switch(this.state){case Ee.AwaitingDriverModel:if(!n)return;case Ee.Idle:for(;;){if(this.setState(Ee.AwaitingResponse),this.state=Ee.AwaitingResponse,this.version=++t,!await this.driver.send(this.localModel.getData(),t)){this.setState(Ee.AwaitingDriverModel),this.applyPendingDriverModels();break}if(this.state===Ee.AwaitingResponse){this.setState(Ee.Idle),this.applyPendingDriverModels();break}if(this.state!==Ee.AwaitingResponseDirty)throw new Error("reached impossible state in store state machine")}return;case Ee.AwaitingResponse:return void this.setState(Ee.AwaitingResponseDirty);case Ee.AwaitingResponseDirty:return;default:throw new Error("reached impossible default state in switch statement")}}applyPendingDriverModels(){if(this.pendingDriverModels.length>0){const e=this.pendingDriverModels;this.pendingDriverModels=[];let t=!0,n=0;for(const{model:r,version:i}of e)try{const{modelChange:e,otherChange:s}=this.localModel.merge(r);this.deliverCallbacks(e,!0,0),t=t&&this.noDriverSideChanges(e,s,!0),n=i}catch(e){return this.pendingException=e,void this.notifyIdle()}this.updateStateAndAct(t,n,!0)}}noDriverSideChanges(e,t,n){return n?t.changeType===J.Operations&&0===t.operations.length:e.changeType===J.Operations&&0===e.operations.length}async onProxyMessage(e){if(this.pendingException)throw this.pendingException;switch(e.type){case Ce.SyncRequest:return await this.callbacks.get(e.id)({type:Ce.ModelUpdate,model:this.localModel.getData(),id:e.id}),!0;case Ce.Operations:{for(const t of e.operations)if(!this.localModel.applyOperation(t))return await this.callbacks.get(e.id)({type:Ce.SyncRequest,id:e.id}),!1;const t={changeType:J.Operations,operations:e.operations};return this.processModelChange(t,null,this.version,e.id),!0}case Ce.ModelUpdate:{const{modelChange:t,otherChange:n}=this.localModel.merge(e.model);return this.processModelChange(t,n,this.version,e.id),!0}default:throw new X("Invalid operation provided to onProxyMessage")}}on(e){const t=this.nextCallbackID++;return this.callbacks.set(t,e),this.version>0&&e({type:Ce.ModelUpdate,model:this.localModel.getData(),id:t}),t}off(e){this.callbacks.delete(e)}reportExceptionInHost(e){this.pendingException=e,this.notifyIdle()}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class De{constructor(e){this.stores={},this.callbacks=new Map,this.nextCallbackId=1,this.storageKey=e.storageKey,this.options=e}on(e){return this.callbacks.set(this.nextCallbackId,e),this.nextCallbackId++}off(e){this.callbacks.delete(e)}getLocalModel(e){const t=this.stores[e];return null==t?(this.stores[e]={type:"pending",promise:this.setupStore(e)},null):"pending"===t.type?null:t.store.localModel}async setupStore(e){const t=await Me.construct({...this.options,storageKey:this.storageKey.childKeyForBackingElement(e)}),n={store:t,id:0,type:"record"};return this.stores[e]=n,n.id=t.on(t=>this.processStoreCallback(e,t)),n}async onProxyMessage(e,t){let n=this.stores[t];null==n&&(n=await this.setupStore(t)),"pending"===n.type&&(n=await n.promise);const{store:r,id:i}=n;return e.id=i,r.onProxyMessage(e)}static async construct(e){return new De(e)}async idle(){const e=[];for(const t of Object.values(this.stores))"record"===t.type&&e.push(t.store);await Promise.all(e.map(e=>e.idle()))}async processStoreCallback(e,t){return Promise.all([...this.callbacks.values()].map(n=>n(t,e))).then(e=>e.reduce((e,t)=>e&&t))}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Container=0]="Container",e[e.BackingStore=1]="BackingStore",e[e.StorageProxy=2]="StorageProxy"}(ke||(ke={}));class Fe extends Ae{constructor(){super(...arguments),this.callbacks=new Map,this.nextCallbackID=1,this.crdtKey=Math.random()*Math.pow(2,64)+"",this.versions={},this.receiveQueue=[],this.pendingSends=[],this.holdQueue=new $e,this.blockCounter=0}static async construct(e){const t=new Fe(e),{storageKey:n,type:r}=e;let i;return t.backingStore=await De.construct({storageKey:n.backingKey,type:r.getContainedType(),mode:Se.Backing,exists:e.exists,baseStore:e.baseStore,versionToken:null}),i=r.isCollectionType()?new ot(new ut(r.getContainedType())):new rt(new ut(r.getContainedType())),t.containerStore=await Me.construct({storageKey:n.storageKey,type:i,mode:Se.Direct,exists:e.exists,baseStore:e.baseStore,versionToken:e.versionToken}),t.registerStoreCallbacks(),t}async serializeContents(){const e=await this.containerStore.serializeContents(),{pendingIds:t,model:n}=this.constructPendingIdsAndModel(e);return 0===t.length?n():new Promise((e,r)=>{this.enqueueBlockingSend(t,()=>e(n()))})}reportExceptionInHost(e){}get versionToken(){return this.containerStore.versionToken}on(e){const t=this.nextCallbackID++;return this.callbacks.set(t,e),t}off(e){this.callbacks.delete(e)}registerStoreCallbacks(){this.backingStore.on(this.onBackingStore.bind(this)),this.containerStore.on(this.onContainerStore.bind(this))}async onContainerStore(e){return this.enqueue({from:ke.Container,message:e})}async onBackingStore(e,t){return this.enqueue({from:ke.BackingStore,message:e,muxId:t})}async onProxyMessage(e){return this.enqueue({from:ke.StorageProxy,message:e})}async enqueue(e){return new Promise((t,n)=>{const r=0===this.receiveQueue.length;this.receiveQueue.push({...e,promise:t}),r&&this.processQueue()})}async processQueue(){for(;this.receiveQueue.length>0;){const e=this.receiveQueue[0];switch(e.from){case ke.StorageProxy:e.promise(await this.handleProxyMessage(e.message));break;case ke.BackingStore:e.promise(await this.handleBackingStore(e.message,e.muxId));break;case ke.Container:e.promise(await this.handleContainerStore(e.message));break;default:throw new Error("invalid message type")}this.receiveQueue.shift()}}async handleContainerStore(e){switch(e.type){case Ce.Operations:for(const t of e.operations){const e=this.operationElement(t);let n;if(e){const r=this.backingStore.getLocalModel(e.id);if(!r){this.enqueueBlockingSend([e],()=>{const n=this.backingStore.getLocalModel(e.id),r=this.updateOp(t,()=>this.entityFromModel(n.getData(),e.id));this.send({type:Ce.Operations,operations:[r]})});break}n=()=>this.entityFromModel(r.getData(),e.id)}else n=()=>null;this.enqueueSend(()=>{const e=this.updateOp(t,n);this.send({type:Ce.Operations,operations:[e]})})}break;case Ce.ModelUpdate:{const t=e.model,{pendingIds:n,model:r}=this.constructPendingIdsAndModel(t),i=()=>void this.send({type:Ce.ModelUpdate,model:r()});0===n.length?this.enqueueSend(i):this.enqueueBlockingSend(n,i);break}case Ce.SyncRequest:this.enqueueSend(()=>{this.send({type:Ce.SyncRequest})});break;default:throw new Error("Unexpected ProxyMessageType")}return!0}async handleBackingStore(e,t){switch(e.type){case Ce.ModelUpdate:this.holdQueue.processID(t,e.model.version);break;case Ce.Operations:this.holdQueue.processID(t,e.operations[e.operations.length-1].clock);break;case Ce.SyncRequest:throw new Error("Unexpected SyncRequest from backing store");default:throw new Error("Unexpected ProxyMessageType")}return!0}async handleProxyMessage(e){switch(e.type){case Ce.Operations:{const t=e.operations;for(const n of t){const t=this.operationElement(n);let r=null;if(t){await this.updateBackingStore(t);const e=this.backingStore.getLocalModel(t.id).getData().version;r={id:t.id,storageKey:this.backingStore.storageKey,version:e}}const i=this.updateOp(n,()=>r);if(!await this.containerStore.onProxyMessage({type:Ce.Operations,operations:[i],id:1}))return!1;this.enqueueSend(()=>void this.sendExcept(e,e.id))}break}case Ce.ModelUpdate:{const{version:t,values:n}=e.model,r={},i=[];Object.entries(n).forEach(([e,{value:t,version:n}])=>{i.push(this.updateBackingStore(t).then(t=>{if(t){const t=this.backingStore.getLocalModel(e).getData().version;r[e]={value:{id:e,storageKey:this.backingStore.storageKey,version:t},version:n}}return t}))}),await Promise.all(i);const s={version:t,values:r};await this.containerStore.onProxyMessage({type:Ce.ModelUpdate,model:s,id:1}),this.enqueueSend(()=>this.sendExcept(e,e.id));break}case Ce.SyncRequest:{const{pendingIds:t,model:n}=this.constructPendingIdsAndModel(this.containerStore.localModel.getData()),r=()=>void this.callbacks.get(e.id)({type:Ce.ModelUpdate,model:n(),id:e.id});0===t.length?this.enqueueSend(r):this.enqueueBlockingSend(t,r);break}default:throw new Error("Unexpected ProxyMessageType")}return!0}enqueueSend(e){0===this.pendingSends.length?e():this.pendingSends.push({fn:e})}enqueueBlockingSend(e,t){const n=this.blockCounter+++"";this.pendingSends.push({fn:t,block:n}),this.holdQueue.enqueue(e,()=>this.processPendingSends(n))}processPendingSends(e){for(;this.pendingSends.length>0;){if(null!=this.pendingSends[0].block&&this.pendingSends[0].block!==e)return;this.pendingSends.shift().fn()}}addFieldToValueList(e,t,n){e[t.id]={value:t,version:n}}entityToModel(e){null==this.versions[e.id]&&(this.versions[e.id]={});const t=this.versions[e.id],n=this.newBackingInstance().getData();let r=0;for(const i of Object.keys(e.rawData)){null==t[i]&&(t[i]=0);const s={[this.crdtKey]:++t[i]};if(r=Math.max(r,t[i]),n.singletons[i])n.singletons[i].values={},this.addFieldToValueList(n.singletons[i].values,e.rawData[i],s),n.singletons[i].version=s;else{if(!n.collections[i])throw new Error(`key ${i} not found for model ${n}`);n.collections[i].values={};for(const t of e.rawData[i])this.addFieldToValueList(n.collections[i].values,t,s);n.collections[i].version=s}}return n.version={[this.crdtKey]:r},n}entityFromModel(e,t){const n={id:t,rawData:{}},r={};for(const t of Object.keys(e.singletons))r[t]=new he;const i={};for(const t of Object.keys(e.collections))i[t]=new oe;const s=new ue(r,i);s.merge(e);const o=s.getParticleView();for(const[e,t]of Object.entries(o.singletons))n.rawData[e]=t;for(const[e,t]of Object.entries(o.collections))n.rawData[e]=t;return n}cloneMap(e){const t={};return Object.entries(e).forEach(([e,n])=>t[e]=n),t}constructPendingIdsAndModel(e){const t=[];for(const n of Object.keys(e.values)){const r=e.values[n].value.version;if(0===Object.keys(r).length)continue;const i=this.backingStore.getLocalModel(n);null!=i&&je(i.getData().version,r)||t.push({id:n,version:r})}return{pendingIds:t,model:()=>{const t={values:{},version:this.cloneMap(e.version)};for(const n of Object.keys(e.values)){const r=e.values[n].value.version,i=0===Object.keys(r).length?this.newBackingInstance():this.backingStore.getLocalModel(n);t.values[n]={value:this.entityFromModel(i.getData(),n),version:e.values[n].version}}return t}}}async send(e){for(const t of this.callbacks.keys())this.callbacks.get(t)({...e,id:t})}async sendExcept(e,t){for(const n of this.callbacks.keys())n!==t&&this.callbacks.get(n)({...e,id:n})}async updateBackingStore(e){const t=this.entityToModel(e);return this.backingStore.onProxyMessage({type:Ce.ModelUpdate,model:t,id:1},e.id)}newBackingInstance(){return new(this.type.getContainedType().crdtInstanceConstructor())}processOp(e,t,n,r,i){if(Be(i))switch(i.type){case ee.Add:return e(i);case ee.Remove:return t(i);default:throw new Error("unexpected operation type")}else if(function(e){return!Be(e)}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(i))switch(i.type){case te.Set:return n(i);case te.Clear:return r(i);default:throw new Error("unexpected operation type")}throw new Error("unexpected operation type")}operationElement(e){return this.processOp(e=>e.added,e=>e.removed,e=>e.value,e=>null,e)}updateOp(e,t){return this.processOp(e=>({...e,added:t()}),e=>({...e,removed:t()}),e=>({...e,value:t()}),e=>e,e)}}function je(e,t){for(const n in Object.keys(t))if(e[n]<t[n])return!1;return!0}class $e{constructor(){this.queue={}}enqueue(e,t){const n={};for(const{id:t,version:r}of e)n[t]=r;const r={ids:n,onRelease:t};for(const t of e)this.queue[t.id]||(this.queue[t.id]=[]),this.queue[t.id].push(r)}processID(e,t){const n=this.queue[e];if(n){for(const r of n)je(t,r.ids[e])&&(delete r.ids[e],0===Object.keys(r.ids).length&&r.onRelease());this.queue[e]=[]}}}function Be(e){return Boolean(e.added||e.removed)}function Le(e,t){return e===t?0:null===e?-1:1}function Ue(e,t){return null==e||null==t?Le(e,t):e.localeCompare(t)}function He(e,t){return null==e||null==t?Le(e,t):e-t}function ze(e,t,n){if(g()(null!=e),g()(null!=t),e.length!==t.length)return He(e.length,t.length);for(let r=0;r<e.length;r++){let i;if(0!==(i=n(e[r],t[r])))return i}return 0}function qe(e,t){return null==e||null==t?Le(e,t):e._compareTo(t)}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class We{constructor(e){this.storeInfo=e}get id(){return this.storeInfo.id}get apiChannelMappingId(){return this.id}get name(){return this.storeInfo.name}get type(){return this.storeInfo.type}get originalId(){return this.storeInfo.originalId}get source(){return this.storeInfo.source}get description(){return this.storeInfo.description}get claims(){return this.storeInfo.claims}castToStorageStub(){return g()("StorageStub"===this.unifiedStoreType,"Not a StorageStub!"),this}reportExceptionInHost(e){throw e}_compareTo(e){let t;return 0!==(t=Ue(this.name,e.name))?t:0!==(t=Ue(this.versionToken,e.versionToken))?t:0!==(t=Ue(this.source,e.source))?t:0!==(t=Ue(this.id,e.id))?t:0}toManifestString(e){e=e||{};const t={...this.storeInfo,...e.overrides},n=[],r=[];return r.push("store"),t.name&&r.push(`${t.name}`),r.push(`of ${t.type.toString()}`),t.id&&r.push(`'${t.id}'`),t.originalId&&r.push(`!!${t.originalId}`),null!=this.versionToken&&r.push(`@${this.versionToken}`),e.handleTags&&e.handleTags.length&&r.push(`${e.handleTags.map(e=>`#${e}`).join(" ")}`),t.source?"file"===t.origin?r.push(`in '${t.source}'`):(r.push(`in ${t.source}`),t.includeKey&&r.push(`at '${t.includeKey}'`)):this.storageKey&&r.push(`at '${this.storageKey}'`),n.push(r.join(" ")),t.claims&&t.claims.length>0&&n.push(`  claim is ${t.claims.map(e=>e.tag).join(" and is ")}`),t.description&&n.push(`  description \`${t.description}\``),n.join("\n")}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ve{constructor(e){this.protocol=e}subKeyWithComponent(e){return this.childWithComponent(e)}childKeyForBackingElement(e){return this.childWithComponent(e)}childKeyForArcInfo(){return this.subKeyWithComponent("arc-info")}childKeyForHandle(e){return this.subKeyWithComponent(`handle/${e}`)}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ke extends Ve{constructor(e,t){super("reference-mode"),this.backingKey=e,this.storageKey=t}embedKey(e){return e.toString().replace(/\{/g,"{{").replace(/\}/g,"}}")}static unembedKey(e){return e.replace(/\}\}/g,"}").replace(/\{\{/g,"}")}toString(){return`${this.protocol}://{${this.embedKey(this.backingKey)}}{${this.embedKey(this.storageKey)}}`}childWithComponent(e){return new Ke(this.backingKey,this.storageKey.childWithComponent(e))}static fromString(e,t){const n=e.match(/^reference-mode:\/\/{((?:\}\}|[^}])+)}{((?:\}\}|[^}])+)}$/);if(!n)throw new Error(`Not a valid ReferenceModeStorageKey: ${e}.`);const[r,i,s]=n;return new Ke(t(Ke.unembedKey(i)),t(Ke.unembedKey(s)))}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Qe extends We{constructor(e){super(e),this.unifiedStoreType="Store",this.parsedVersionToken=null,this.storageKey=e.storageKey,this.exists=e.exists,this.mode=e.storageKey instanceof Ke?Se.ReferenceMode:Se.Direct,this.parsedVersionToken=e.versionToken,this.model=e.model}get versionToken(){return this.activeStore?this.activeStore.versionToken:this.parsedVersionToken}async activate(){if(this.activeStore)return this.activeStore;if(null==Qe.constructors.get(this.mode))throw new Error(`StorageMode ${this.mode} not yet implemented`);const e=Qe.constructors.get(this.mode);if(null==e)throw new Error(`No constructor registered for mode ${this.mode}`);const t=await e.construct({storageKey:this.storageKey,exists:this.exists,type:this.type,mode:this.mode,baseStore:this,versionToken:this.parsedVersionToken});return this.exists=be.ShouldExist,this.activeStore=t,t}get referenceMode(){return this.mode===Se.ReferenceMode}}Qe.constructors=new Map([[Se.Direct,Me],[Se.ReferenceMode,Fe]]);
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ge{constructor(e,t,n){this.handles=[],this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=!1,this.modelHasSynced=()=>void 0,this.apiChannelId=e,this.store=t.getStorageEndpoint(this),this.crdt=new(n.crdtInstanceConstructor()),this.type=n,this.scheduler=new Ye}get pec(){throw new Error("StorageProxyNG does not have a pec.")}async idle(){return this.scheduler.idle}reportExceptionInHost(e){we?we(e.cause.stack,t=>{e.cause.stack=t,this.store.reportExceptionInHost(e)}):this.store.reportExceptionInHost(e)}registerHandle(e){return e.canRead?(this.handles.push(e),this.listenerAttached||(this.store.setCallback(e=>this.onMessage(e)),this.listenerAttached=!0),e.options.keepSynced&&(this.keepSynced||(this.requestSynchronization().catch(t=>{this.reportExceptionInHost(new w(t,e.key,"StorageProxy::registerHandle"))}),this.keepSynced=!0),e.options.notifySync&&this.synchronized&&e.onSync()),this.versionCopy()):this.versionCopy()}deregisterHandle(e){this.handles=this.handles.filter(t=>t!==e)}versionCopy(){const e={};for(const[t,n]of Object.entries(this.crdt.getData().version))e[t]=n;return e}async applyOp(e){if(!this.crdt.applyOperation(e))return!1;const t={type:Ce.Operations,operations:[e]};return await this.store.onProxyMessage(t),this.notifyUpdate(e),!0}async getParticleView(){if(this.synchronized)return[this.crdt.getParticleView(),this.versionCopy()];{const e=new Promise(e=>{this.modelHasSynced=()=>{this.modelHasSynced=()=>void 0,e([this.crdt.getParticleView(),this.versionCopy()])}});return await this.requestSynchronization(),e}}async onMessage(e){switch(e.type){case Ce.ModelUpdate:this.crdt.merge(e.model),this.synchronized=!0,this.modelHasSynced(),this.notifySync();break;case Ce.Operations:if(!this.keepSynced)return!1;for(const t of e.operations){if(!this.crdt.applyOperation(t))return this.synchronized=!1,await this.notifyDesync(),this.requestSynchronization();this.notifyUpdate(t)}this.synchronized=!0;break;case Ce.SyncRequest:await this.store.onProxyMessage({type:Ce.ModelUpdate,model:this.crdt.getData()});break;default:throw new X(`Invalid operation provided to onMessage, message: ${e}`)}return!0}notifyUpdate(e){const t=this.versionCopy();for(const n of this.handles)n.options.notifyUpdate?this.scheduler.enqueue(n.particle,n,{type:xe.Update,op:e,version:t}):n.options.keepSynced&&this.scheduler.enqueue(n.particle,n,{type:xe.Sync})}notifySync(){for(const e of this.handles)e.options.notifySync&&this.scheduler.enqueue(e.particle,e,{type:xe.Sync})}notifyDesync(){for(const e of this.handles)e.options.notifyDesync&&this.scheduler.enqueue(e.particle,e,{type:xe.Desync})}async requestSynchronization(){return this.store.onProxyMessage({type:Ce.SyncRequest})}}class Ze extends Ge{constructor(){super(null,{getStorageEndpoint(){}},it.make([],{}))}async idle(){return new Promise(e=>{})}reportExceptionInHost(e){}registerHandle(e){return{}}deregisterHandle(e){}versionCopy(){return null}async applyOp(e){return new Promise(e=>{})}async getParticleView(){return new Promise(e=>{})}async getData(){return new Promise(e=>{})}async onMessage(e){return new Promise(e=>{})}notifyUpdate(e){}notifySync(){}notifyDesync(){}async requestSynchronization(){return new Promise(e=>{})}}!function(e){e[e.Sync=0]="Sync",e[e.Desync=1]="Desync",e[e.Update=2]="Update"}(xe||(xe={}));class Ye{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(e,t,n){this._queues.has(e)||this._queues.set(e,new Map);const r=this._queues.get(e);r.has(t)||r.set(t,[]),r.get(t).push(n),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(e=>this._idleResolver=e)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const e=[...this._queues.keys()][0],t=this._queues.get(e);this._queues.delete(e);for(const[e,n]of t.entries())for(const t of n)this._dispatchUpdate(e,t).catch(t=>e.storageProxy.reportExceptionInHost(new w(t,"StorageProxyScheduler::_dispatch",e.key)))}this._updateIdle()}async _dispatchUpdate(e,t){switch(t.type){case xe.Sync:e.onSync();break;case xe.Desync:await e.onDesync();break;case xe.Update:e.onUpdate(t.op,t.version);break;default:console.error("Ignoring unknown update",t)}}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Xe{constructor(e,t,n,r,i,s,o){this.key=e,this.name=o,this.storageProxy=t,this.idGenerator=n,this.particle=r,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1},this.canRead=i,this.canWrite=s,this.clock=this.storageProxy.registerHandle(this)}get storage(){return this.storageProxy}get type(){return this.storageProxy.type}get _id(){return this.storageProxy.apiChannelId}createIdentityFor(e){V.createIdentity(e,_e.fromString(this._id),this.idGenerator)}configure(e){g()(this.canRead,"configure can only be called on readable Handles"),this.options={...this.options,...e}}reportUserExceptionInHost(e,t,n){this.storageProxy.reportExceptionInHost(new b(e,n,this.key,t.spec.name))}async onDesync(){await this.particle.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,this.particle,"onHandleDesync"))}disable(e){this.storageProxy.deregisterHandle(this),this.storageProxy=new Ze}}class Je extends Xe{constructor(e,t,n,r,i,s,o){super(e,t,n,r,i,s,o);const a=this.storageProxy.type.getContainedType()||this.storageProxy.type;if(!(a instanceof it))throw new Error("can't construct handle for entity mutation if type is not an entity type");this.entityClass=a.entitySchema.entityClass()}serialize(e){return e[q].serialize()}ensureEntityHasId(e){V.isIdentified(e)||this.createIdentityFor(e)}deserialize(e){const{id:t,rawData:n}=e,r=new this.entityClass(n);return V.identify(r,t),r}}class et extends Je{async get(e){if(!this.canRead)throw new Error("Handle not readable");const t=await this.toCRDTList();return this.deserialize(t.find(t=>t.id===e))}async add(e){if(!this.canWrite)throw new Error("Handle not writeable");this.ensureEntityHasId(e),this.clock[this.key]=(this.clock[this.key]||0)+1;const t={type:ee.Add,added:this.serialize(e),actor:this.key,clock:this.clock};return this.storageProxy.applyOp(t)}async addMultiple(e){return Promise.all(e.map(e=>this.add(e))).then(e=>e.every(Boolean))}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t={type:ee.Remove,removed:this.serialize(e),actor:this.key,clock:this.clock};return this.storageProxy.applyOp(t)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");const e=await this.toCRDTList();for(const t of e){const e={type:ee.Remove,removed:t,actor:this.key,clock:this.clock};if(!this.storageProxy.applyOp(e))return!1}return!0}async toList(){if(!this.canRead)throw new Error("Handle not readable");return(await this.toCRDTList()).map(e=>this.deserialize(e))}async toCRDTList(){const[e,t]=await this.storageProxy.getParticleView();return this.clock=t,[...e]}async onUpdate(e,t){if(g()(this.canRead,"onUpdate should not be called for non-readable handles"),this.clock=t,e.type===ee.FastForward)return this.onSync();const n={originator:"actor"in e&&this.key===e.actor};e.type===ee.Add&&(n.added=this.deserialize(e.added)),e.type===ee.Remove&&(n.removed=this.deserialize(e.removed)),this.particle&&await this.particle.callOnHandleUpdate(this,n,e=>this.reportUserExceptionInHost(e,this.particle,"onHandleUpdate"))}async onSync(){g()(this.canRead,"onSync should not be called for non-readable handles"),this.particle&&await this.particle.callOnHandleSync(this,this.toList(),e=>this.reportUserExceptionInHost(e,this.particle,"onHandleSync"))}}class tt extends Je{async set(e){if(!this.canWrite)throw new Error("Handle not writeable");this.ensureEntityHasId(e),this.clock[this.key]=(this.clock[this.key]||0)+1;const t={type:te.Set,value:this.serialize(e),actor:this.key,clock:this.clock};return this.storageProxy.applyOp(t)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");const e={type:te.Clear,actor:this.key,clock:this.clock};return this.storageProxy.applyOp(e)}async get(){if(!this.canRead)throw new Error("Handle not readable");const[e,t]=await this.storageProxy.getParticleView();return this.clock=t,null==e?null:this.deserialize(e)}async onUpdate(e,t){g()(this.canRead,"onUpdate should not be called for non-readable handles"),this.clock=t;const n={originator:this.key===e.actor};e.type===te.Set&&(n.data=this.deserialize(e.value)),this.particle&&await this.particle.callOnHandleUpdate(this,n,e=>this.reportUserExceptionInHost(e,this.particle,"onHandleUpdate"))}async onSync(){g()(this.canRead,"onSync should not be called for non-readable handles"),this.particle&&await this.particle.callOnHandleSync(this,this.get(),e=>this.reportUserExceptionInHost(e,this.particle,"onHandleSync"))}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class nt{constructor(e){this.tag=e}static fromLiteral(e){switch(e.tag){case"Entity":return new it(de.fromLiteral(e.data));case"TypeVariable":return new st(pe.fromLiteral(e.data));case"Collection":return new ot(nt.fromLiteral(e.data));case"BigCollection":return new at(nt.fromLiteral(e.data));case"Relation":return new ct(e.data.map(e=>nt.fromLiteral(e)));case"Interface":return new lt(L.fromLiteral(e.data));case"Slot":return new ht(U.fromLiteral(e.data));case"Reference":return new ut(nt.fromLiteral(e.data));case"Arc":return new dt;case"Handle":return new pt;case"Singleton":return new rt(nt.fromLiteral(e.data));default:throw new Error(`fromLiteral: unknown type ${e}`)}}static unwrapPair(e,t){if(e.tag===t.tag){const n=e.getContainedType();if(null!==n)return nt.unwrapPair(n,t.getContainedType())}return[e,t]}static canMergeConstraints(e,t){return nt._canMergeCanReadSubset(e,t)&&nt._canMergeCanWriteSuperset(e,t)}static _canMergeCanReadSubset(e,t){if(e.canReadSubset&&t.canReadSubset){if(e.canReadSubset.tag!==t.canReadSubset.tag)return!1;if(e.canReadSubset instanceof it&&t.canReadSubset instanceof it)return null!==de.intersect(e.canReadSubset.entitySchema,t.canReadSubset.entitySchema);throw new Error(`_canMergeCanReadSubset not implemented for types tagged with ${e.canReadSubset.tag}`)}return!0}static _canMergeCanWriteSuperset(e,t){if(e.canWriteSuperset&&t.canWriteSuperset){if(e.canWriteSuperset.tag!==t.canWriteSuperset.tag)return!1;if(e.canWriteSuperset instanceof it&&t.canWriteSuperset instanceof it)return null!==de.union(e.canWriteSuperset.entitySchema,t.canWriteSuperset.entitySchema)}return!0}isSlot(){return this instanceof ht}slandleType(){return this.isSlot()?this:this.isCollectionType()&&this.collectionType.isSlot()?this.collectionType:void 0}isCollectionType(){return this instanceof ot}isBigCollectionType(){return this instanceof at}isResolved(){return!this.hasUnresolvedVariable}mergeTypeVariablesByName(e){return this}_applyExistenceTypeTest(e){return e(this)}get hasVariable(){return this._applyExistenceTypeTest(e=>e instanceof st)}get hasUnresolvedVariable(){return this._applyExistenceTypeTest(e=>e instanceof st&&!e.variable.isResolved())}getContainedType(){return null}isTypeContainer(){return!1}get isReference(){return!1}get isSingleton(){return!1}get isEntity(){return!1}collectionOf(){return new ot(this)}bigCollectionOf(){return new at(this)}resolvedType(){return this}canEnsureResolved(){return this.isResolved()||this._canEnsureResolved()}_canEnsureResolved(){return!0}maybeEnsureResolved(){return!0}get canWriteSuperset(){throw new Error(`canWriteSuperset not implemented for ${this}`)}get canReadSubset(){throw new Error(`canReadSubset not implemented for ${this}`)}isMoreSpecificThan(e){return this.tag===e.tag&&this._isMoreSpecificThan(e)}_isMoreSpecificThan(e){throw new Error(`isMoreSpecificThan not implemented for ${this}`)}clone(e){return this.resolvedType()._clone(e)}_clone(e){return nt.fromLiteral(this.toLiteral())}_cloneWithResolutions(e){return nt.fromLiteral(this.toLiteral())}hasProperty(e){return e(this)||this._hasProperty(e)}_hasProperty(e){return!1}toString(e){return this.tag}getEntitySchema(){return null}toPrettyString(){return null}crdtInstanceConstructor(){return null}handleConstructor(){return null}}class rt extends nt{constructor(e){super("Singleton"),this.innerType=e}toLiteral(){return{tag:"Singleton",data:this.innerType.toLiteral()}}getContainedType(){return this.innerType}crdtInstanceConstructor(){return he}handleConstructor(){return tt}get isSingleton(){return!0}getEntitySchema(){return this.innerType.getEntitySchema()}toString(e){return`![${this.innerType.toString(e)}]`}}class it extends nt{constructor(e){super("Entity"),this.entitySchema=e}static make(e,t,n){return new it(new de(e,t,n))}get isEntity(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return this.entitySchema.isMoreSpecificThan(e.entitySchema)}toLiteral(){return{tag:this.tag,data:this.entitySchema.toLiteral()}}toString(e){return this.entitySchema.toInlineSchemaString(e)}getEntitySchema(){return this.entitySchema}_cloneWithResolutions(e){if(e.has(this.entitySchema))return e.get(this.entitySchema);const t=new it(this.entitySchema);return e.set(this.entitySchema,t),t}toPrettyString(){return this.entitySchema.description.pattern?this.entitySchema.description.pattern:this.entitySchema.name?this.entitySchema.name.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim():JSON.stringify(this.entitySchema.toLiteral())}crdtInstanceConstructor(){return this.entitySchema.crdtConstructor()}handleConstructor(){throw new Error("Entity handle not yet implemented - you probably want to use a SingletonType")}}class st extends nt{constructor(e){super("TypeVariable"),this.variable=e}static make(e,t,n){return new st(new pe(e,t,n))}get isVariable(){return!0}mergeTypeVariablesByName(e){const t=this.variable.name;let n=e.get(t);if(n){if(n instanceof st&&(n.variable.hasConstraint||this.variable.hasConstraint)){if(!n.variable.maybeMergeConstraints(this.variable))throw new Error("could not merge type variables")}}else n=this,e.set(t,this);return n}resolvedType(){return this.variable.resolution||this}_canEnsureResolved(){return this.variable.canEnsureResolved()}maybeEnsureResolved(){return this.variable.maybeEnsureResolved()}get canWriteSuperset(){return this.variable.canWriteSuperset}get canReadSubset(){return this.variable.canReadSubset}_clone(e){const t=this.variable.name;if(e.has(t))return new st(e.get(t));{const n=pe.fromLiteral(this.variable.toLiteral());return e.set(t,n),new st(n)}}_cloneWithResolutions(e){if(e.has(this.variable))return new st(e.get(this.variable));{const t=pe.fromLiteral(this.variable.toLiteralIgnoringResolutions());return this.variable.resolution&&(t._resolution=this.variable._resolution._cloneWithResolutions(e)),this.variable._canReadSubset&&(t.canReadSubset=this.variable.canReadSubset._cloneWithResolutions(e)),this.variable._canWriteSuperset&&(t.canWriteSuperset=this.variable.canWriteSuperset._cloneWithResolutions(e)),e.set(this.variable,t),new st(t)}}toLiteral(){return this.variable.resolution?this.variable.resolution.toLiteral():{tag:this.tag,data:this.variable.toLiteral()}}toString(e){return`~${this.variable.name}`}getEntitySchema(){return this.variable.isResolved()?this.resolvedType().getEntitySchema():null}toPrettyString(){return this.variable.isResolved()?this.resolvedType().toPrettyString():`[~${this.variable.name}]`}}class ot extends nt{constructor(e){super("Collection"),this.collectionType=e}get isCollection(){return!0}mergeTypeVariablesByName(e){const t=this.collectionType,n=t.mergeTypeVariablesByName(e);return n===t?this:n.collectionOf()}_applyExistenceTypeTest(e){return this.collectionType._applyExistenceTypeTest(e)}getContainedType(){return this.collectionType}isTypeContainer(){return!0}resolvedType(){const e=this.collectionType,t=e.resolvedType();return e!==t?t.collectionOf():this}_canEnsureResolved(){return this.collectionType.canEnsureResolved()}maybeEnsureResolved(){return this.collectionType.maybeEnsureResolved()}get canWriteSuperset(){return lt.make(this.tag,[],[])}get canReadSubset(){return lt.make(this.tag,[],[])}_clone(e){const t=this.collectionType.clone(e).toLiteral();return nt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new ot(this.collectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.collectionType.toLiteral()}}_hasProperty(e){return this.collectionType.hasProperty(e)}toString(e){return`[${this.collectionType.toString(e)}]`}getEntitySchema(){return this.collectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`${this.collectionType.toPrettyString()} List`}crdtInstanceConstructor(){return oe}handleConstructor(){return et}}class at extends nt{constructor(e){super("BigCollection"),this.bigCollectionType=e}get isBigCollection(){return!0}mergeTypeVariablesByName(e){const t=this.bigCollectionType,n=t.mergeTypeVariablesByName(e);return n===t?this:n.bigCollectionOf()}_applyExistenceTypeTest(e){return this.bigCollectionType._applyExistenceTypeTest(e)}getContainedType(){return this.bigCollectionType}isTypeContainer(){return!0}resolvedType(){const e=this.bigCollectionType,t=e.resolvedType();return e!==t?t.bigCollectionOf():this}_canEnsureResolved(){return this.bigCollectionType.canEnsureResolved()}maybeEnsureResolved(){return this.bigCollectionType.maybeEnsureResolved()}get canWriteSuperset(){return lt.make(this.tag,[],[])}get canReadSubset(){return lt.make(this.tag,[],[])}_clone(e){const t=this.bigCollectionType.clone(e).toLiteral();return nt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new at(this.bigCollectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.bigCollectionType.toLiteral()}}_hasProperty(e){return this.bigCollectionType.hasProperty(e)}toString(e){return`BigCollection<${this.bigCollectionType.toString(e)}>`}getEntitySchema(){return this.bigCollectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`Collection of ${this.bigCollectionType.toPrettyString()}`}}class ct extends nt{constructor(e){super("Relation"),this.relationEntities=e}get isRelation(){return!0}toLiteral(){return{tag:this.tag,data:this.relationEntities.map(e=>e.toLiteral())}}toPrettyString(){return JSON.stringify(this.relationEntities)}}class lt extends nt{constructor(e){super("Interface"),this.interfaceInfo=e}static make(e,t,n){return new lt(new L(e,t,n))}get isInterface(){return!0}mergeTypeVariablesByName(e){const t=this.interfaceInfo.clone(new Map);return t.mergeTypeVariablesByName(e),new lt(t)}_applyExistenceTypeTest(e){return this.interfaceInfo._applyExistenceTypeTest(e)}resolvedType(){return new lt(this.interfaceInfo.resolvedType())}_canEnsureResolved(){return this.interfaceInfo.canEnsureResolved()}maybeEnsureResolved(){return this.interfaceInfo.maybeEnsureResolved()}get canWriteSuperset(){return new lt(this.interfaceInfo.canWriteSuperset)}get canReadSubset(){return new lt(this.interfaceInfo.canReadSubset)}_isMoreSpecificThan(e){return this.interfaceInfo.isMoreSpecificThan(e.interfaceInfo)}_clone(e){const t=this.interfaceInfo.clone(e).toLiteral();return nt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new lt(this.interfaceInfo._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.interfaceInfo.toLiteral()}}toString(e){return this.interfaceInfo.name}toPrettyString(){return this.interfaceInfo.toPrettyString()}}class ht extends nt{constructor(e){super("Slot"),this.slot=e}static make(e,t){return new ht(new U(e,t))}getSlot(){return this.slot}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return!0}toLiteral(){return{tag:this.tag,data:this.slot.toLiteral()}}toString(e){const t=[];for(const e of Object.keys(this.slot))void 0!==this.slot[e]&&t.push(`${e}:${this.slot[e]}`);let n="";return 0!==t.length&&(n=` {${t.join(", ")}}`),`Slot${n}`}toPrettyString(){const e=[];for(const t of Object.keys(this.slot))void 0!==this.slot[t]&&e.push(`${t}:${this.slot[t]}`);let t="";return 0!==e.length&&(t=` {${e.join(", ")}}`),`Slot${t}`}}class ut extends nt{constructor(e){if(super("Reference"),null==e)throw new Error("invalid type! Reference types must include a referenced type declaration");this.referredType=e}get isReference(){return!0}getContainedType(){return this.referredType}isTypeContainer(){return!0}resolvedType(){const e=this.referredType,t=e.resolvedType();return e!==t?new ut(t):this}_canEnsureResolved(){return this.referredType.canEnsureResolved()}maybeEnsureResolved(){return this.referredType.maybeEnsureResolved()}get canWriteSuperset(){return this.referredType.canWriteSuperset}get canReadSubset(){return this.referredType.canReadSubset}_clone(e){const t=this.referredType.clone(e).toLiteral();return nt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new ut(this.referredType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.referredType.toLiteral()}}toString(e){return"Reference<"+this.referredType.toString()+">"}toPrettyString(){return"Reference to "+this.referredType.toPrettyString()}getEntitySchema(){return this.referredType.getEntitySchema()}crdtInstanceConstructor(){return this.referredType.crdtInstanceConstructor()}}class dt extends nt{constructor(){super("Arc")}get isArc(){return!0}newInstance(e,t){return new H(e,t)}toLiteral(){return{tag:this.tag}}}class pt extends nt{constructor(){super("Handle")}get isHandle(){return!0}toLiteral(){return{tag:this.tag}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ft{static processTypeList(e,t){const n=st.make("",null,null);e&&(n.variable.resolution=e),e=n;const r=[];for(const n of t)if(n.type.resolvedType().hasVariable){if(null==(e=ft._tryMergeTypeVariable(e,n.type)))return null}else r.push(n);for(const t of r)if(!ft._tryMergeConstraints(e,t))return null;const i=e=>e instanceof st?null==e.canReadSubset||null==e.canWriteSuperset?e:e.canReadSubset.isMoreSpecificThan(e.canWriteSuperset)?(e.canWriteSuperset.isMoreSpecificThan(e.canReadSubset)&&(e.variable.resolution=e.canReadSubset),e):null:e,s=e.resolvedType();if(s.isCollectionType()){const e=i(s.collectionType);return null!==e?e.collectionOf():null}if(s.isBigCollectionType()){const e=i(s.bigCollectionType);return null!==e?e.bigCollectionOf():null}return i(s)}static _tryMergeTypeVariable(e,t){const[n,r]=nt.unwrapPair(e.resolvedType(),t.resolvedType());if(n instanceof st){if(r instanceof st){if(!1===n.variable.maybeMergeConstraints(r.variable))return null;r.variable.resolution=n}else{if(!n.variable.isValidResolutionCandidate(r).result)return null;n.variable.resolution=r}return e}if(r instanceof st)return r.variable.isValidResolutionCandidate(n).result?(r.variable.resolution=n,t):null;if(n instanceof lt&&r instanceof lt){const e=n.interfaceInfo.tryMergeTypeVariablesWith(r.interfaceInfo);return null==e?null:new lt(e)}if(n.isTypeContainer()&&n.hasVariable||r.isTypeContainer()&&r.hasVariable)return null;throw new Error("tryMergeTypeVariable shouldn't be called on two types without any type variables")}static _tryMergeConstraints(e,{type:t,direction:n}){let[r,i]=nt.unwrapPair(e.resolvedType(),t.resolvedType());if(r instanceof st){for(;i.isTypeContainer();){if(null!=r.variable.resolution||null!=r.variable.canReadSubset||null!=r.variable.canWriteSuperset)return!1;const e=st.make("a",null,null);r.variable.resolution=i instanceof ot?new ot(e):i instanceof at?new at(e):new ut(e);const t=nt.unwrapPair(r.resolvedType(),i);if([r,i]=t,!(r instanceof st))throw new TypeError("unwrapping a wrapped TypeVariable somehow didn't become a TypeVariable")}if(("out"===n||"inout"===n||"`provide"===n)&&!r.variable.maybeMergeCanReadSubset(i.canWriteSuperset))return!1;if(("in"===n||"inout"===n||"`consume"===n)&&!r.variable.maybeMergeCanWriteSuperset(i.canReadSubset))return!1}else{if(i.tag!==r.tag)return!1;if(("out"===n||"inout"===n)&&!ft._writeConstraintsApply(r,i))return!1;if(("in"===n||"inout"===n)&&!ft._readConstraintsApply(r,i))return!1}return!0}static _writeConstraintsApply(e,t){const n=t.canWriteSuperset;return null==n||null==e.canReadSubset||!!n.isMoreSpecificThan(e.canReadSubset)}static _readConstraintsApply(e,t){const n=t.canReadSubset;return null==n||null==e.canWriteSuperset||!!e.canWriteSuperset.isMoreSpecificThan(n)}static compareTypes(e,t){const n=e.type.resolvedType(),r=t.type.resolvedType(),[i,s]=nt.unwrapPair(n,r);if(i instanceof st&&s.isTypeContainer())return!(i.variable.canReadSubset||i.variable.canWriteSuperset);if(s instanceof st&&i.isTypeContainer())return!(s.variable.canReadSubset||s.variable.canWriteSuperset);if(i instanceof st||s instanceof st)return nt.canMergeConstraints(i,s);if(void 0===i!=(void 0===s))return!1;if(i===s)return!0;if(i.tag!==s.tag)return!1;if(i instanceof ht)return!0;if(i instanceof lt&&s instanceof lt&&i.interfaceInfo.equals(s.interfaceInfo))return!0;if(!(i instanceof it&&s instanceof it))return!1;const o=i.entitySchema.isMoreSpecificThan(s.entitySchema),a=s.entitySchema.isMoreSpecificThan(i.entitySchema);if(a&&o)return!0;if(!a&&!o)return!1;const[c,l]=a?[e,t]:[t,e],h=c.direction||(c.connection?c.connection.direction:"inout"),u=l.direction||(l.connection?l.connection.direction:"inout");return"in"===h||"out"===u}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.HasTag="has-tag",e.IsFromHandle="is-from-handle",e.IsFromOutput="is-from-output",e.IsFromStore="is-from-store"}(Te||(Te={}));class gt{constructor(e,t){this.target=e,this.expression=t}toManifestString(){let e;return`check ${e=this.target instanceof It?this.target.name:`${this.target.name} data`} ${this.expression.toManifestString()}`}}class mt{constructor(e,t){this.type=e,this.children=t}toManifestString(e=!1){const t=this.children.map(e=>e.toManifestString(!0)).join(` ${this.type} `);return e?`(${t})`:t}}class yt{constructor(e,t){this.tag=e,this.isNot=t,this.type=Te.HasTag}static fromASTNode(e){return new yt(e.tag,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}${this.tag}`}}class _t{constructor(e,t){this.parentHandle=e,this.isNot=t,this.type=Te.IsFromHandle}static fromASTNode(e,t){const n=t.get(e.parentHandle);if(!n)throw new Error(`Unknown "check is from handle" handle name: ${e.parentHandle}.`);return new _t(n,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}from handle ${this.parentHandle.name}`}}class vt{constructor(e,t){this.output=e,this.isNot=t,this.type=Te.IsFromOutput}static fromASTNode(e,t){const n=t.get(e.output);if(!n)throw new Error(`Unknown "check is from output" output name: ${e.output}.`);return new vt(n,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}from output ${this.output.name}`}}class wt{constructor(e,t){this.storeRef=e,this.isNot=t,this.type=Te.IsFromStore}static fromASTNode(e){return new wt({type:e.storeRef.type,store:e.storeRef.store},e.isNot)}toManifestString(){let e=this.storeRef.store;return"id"===this.storeRef.type&&(e=`'${e}'`),`is ${this.isNot?"not ":""}from store ${e}`}}function bt(e,t){return"particle-trust-check-boolean-expression"===e.kind?(g()(e.children.length>=2,"Boolean check expressions must have at least two children."),new mt(e.operator,e.children.map(e=>bt(e,t)))):function(e,t){switch(e.checkType){case Te.HasTag:return yt.fromASTNode(e);case Te.IsFromHandle:return _t.fromASTNode(e,t);case Te.IsFromStore:return wt.fromASTNode(e);case Te.IsFromOutput:return vt.fromASTNode(e,t);default:throw new Error("Unknown check type.")}}(e,t)}function St(e,t,n){const r=bt(t.expression,n);return new gt(e,r)}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.IsTag="is-tag",e.DerivesFrom="derives-from"}(Re||(Re={}));class Ct{constructor(e,t){this.handle=e,this.claims=t}toManifestString(){const e=this.claims.map(e=>e.toManifestString());return`claim ${this.handle.name} ${e.join(" and ")}`}}class Et{constructor(e,t){this.isNot=e,this.tag=t,this.type=Re.IsTag}static fromASTNode(e){return new Et(e.isNot,e.tag)}toManifestString(){return`is ${this.isNot?"not ":""}${this.tag}`}}class kt{constructor(e){this.parentHandle=e,this.type=Re.DerivesFrom}static fromASTNode(e,t){const n=t.get(e.parentHandle);if(!n)throw new Error(`Unknown "derives from" handle name: ${n}.`);return new kt(n)}toManifestString(){return`derives from ${this.parentHandle.name}`}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function xt(e){return e instanceof nt?e:nt.fromLiteral(e)}function Tt(e){return e instanceof nt?e.toLiteral():e}function Rt({name:e,tags:t,id:n,type:r,fate:i}){const s=["root","toproot","modal"];if(i&&"`slot"!==i||r&&!r.slandleType())return!1;if(n&&0===n.lastIndexOf("rootslotid-",0)){const e=n.substr("rootslotid-".length);if(s.includes(e))return!0}return s.includes(e)||t.some(e=>s.includes(e))}class It{constructor(e,t){this.parentConnection=null,this.rawData=e,this.direction=e.direction,this.name=e.name,this.type=xt(e.type).mergeTypeVariablesByName(t),this.isOptional=e.isOptional,this.tags=e.tags||[],this.dependentConnections=[]}instantiateDependentConnections(e,t){for(const n of this.rawData.dependentConnections){const r=e.createConnection(n,t);r.parentConnection=this,this.dependentConnections.push(r)}}toSlotConnectionSpec(){const e=this.type.slandleType();if(!e)return;const t=this.type.isCollectionType(),n=e.getSlot();return{name:this.name,isOptional:this.isOptional,direction:this.direction,tags:this.tags,dependentConnections:this.dependentConnections.map(e=>e.toSlotConnectionSpec()),isRequired:!this.isOptional,isSet:t,type:e,handles:n.handle?[n.handle]:[],formFactor:n.formFactor,provideSlotConnections:this.dependentConnections.map(e=>e.toSlotConnectionSpec())}}get isInput(){return"in"===this.direction||"inout"===this.direction||"host"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}isCompatibleType(e){return ft.compareTypes({type:e},{type:this.type,direction:this.direction})}}class Ot{constructor(e){this.name=e.name,this.isRequired=e.isRequired||!1,this.isSet=e.isSet||!1,this.tags=e.tags||[],this.formFactor=e.formFactor,this.handles=e.handles||[],this.provideSlotConnections=[],e.provideSlotConnections&&e.provideSlotConnections.forEach(e=>{this.provideSlotConnections.push(new Nt(e))})}get isOptional(){return!this.isRequired}get direction(){return"`consume"}get type(){const e=ht.make(this.formFactor,null);return this.isSet?e.collectionOf():e}get dependentConnections(){return this.provideSlotConnections}}class Nt extends Ot{constructor(e){super(e),this.check=e.check}}class Pt{constructor(e){this.model=e,this.name=e.name,this.verbs=e.verbs;const t=new Map;this.handleConnectionMap=new Map,e.args.forEach(e=>this.createConnection(e,t)),e.description=e.description||{},this.validateDescription(e.description),this.pattern=e.description.pattern,this.handleConnectionMap.forEach((t,n)=>{t.pattern=e.description[n]}),this.external=e.external,this.implFile=e.implFile,this.implBlobUrl=e.implBlobUrl,this.modality=e.modality?k.create(e.modality):k.all,this.slotConnections=new Map,e.slotConnections&&e.slotConnections.forEach(e=>this.slotConnections.set(e.name,new Ot(e))),this.slotConnections.forEach(e=>{e.provideSlotConnections.forEach(e=>{e.handles.forEach(e=>g()(this.handleConnectionMap.has(e),"Cannot provide slot for nonexistent handle constraint "+e))})}),this.trustClaims=this.validateTrustClaims(e.trustClaims),this.trustChecks=this.validateTrustChecks(e.trustChecks)}createConnection(e,t){const n=new It(e,t);if(this.handleConnectionMap.get(n.name))throw new Error(`Particle Spec ${this.name} already has a handle connection named "${n.name}".`);return this.handleConnectionMap.set(n.name,n),n.instantiateDependentConnections(this,t),n}get handleConnections(){return this.connections}get connections(){return[...this.handleConnectionMap.values()]}get inputs(){return this.connections.filter(e=>e.isInput)}get outputs(){return this.connections.filter(e=>e.isOutput)}isInput(e){const t=this.handleConnectionMap.get(e);return t&&t.isInput}isOutput(e){const t=this.handleConnectionMap.get(e);return t&&t.isOutput}getConnectionByName(e){return this.handleConnectionMap.get(e)}getSlotSpec(e){return this.slotConnections.get(e)}getSlandleSpec(e){const t=this.slotConnections.get(e);return t||this.handleConnectionMap.get(e).toSlotConnectionSpec()}slandleConnectionNames(){const e=this.handleConnections.filter(e=>e.toSlotConnectionSpec()).map(e=>e.name);return[...this.slotConnections.keys(),...e]}slotConnectionNames(){return[...this.slotConnections.keys()]}get primaryVerb(){return this.verbs.length>0?this.verbs[0]:void 0}isCompatible(e){return 0===this.slandleConnectionNames().length||this.modality.intersection(e).isResolved()}setImplBlobUrl(e){this.model.implBlobUrl=this.implBlobUrl=e}toLiteral(){const{args:e,name:t,verbs:n,description:r,external:i,implFile:s,implBlobUrl:o,modality:a,slotConnections:c,trustClaims:l,trustChecks:h}=this.model,u=({type:e,direction:t,name:n,isOptional:r,dependentConnections:i})=>({type:Tt(e),direction:t,name:n,isOptional:r,dependentConnections:i.map(u)});return{args:e.map(e=>u(e)),name:t,verbs:n,description:r,external:i,implFile:s,implBlobUrl:o,modality:a,slotConnections:c,trustClaims:l,trustChecks:h}}static fromLiteral(e){let{args:t,name:n,verbs:r,description:i,external:s,implFile:o,implBlobUrl:a,modality:c,slotConnections:l,trustClaims:h,trustChecks:u}=e;const d=({type:e,direction:t,name:n,isOptional:r,dependentConnections:i})=>({type:xt(e),direction:t,name:n,isOptional:r,dependentConnections:i?i.map(d):[]});return t=t.map(d),new Pt({args:t,name:n,verbs:r||[],description:i,external:s,implFile:o,implBlobUrl:a,modality:c,slotConnections:l,trustClaims:h,trustChecks:u})}clone(){return Pt.fromLiteral(this.toLiteral())}cloneWithResolutions(e){const t=this.clone();return this.handleConnectionMap.forEach((n,r)=>{t.handleConnectionMap.get(r).type=n.type._cloneWithResolutions(e)}),t}equals(e){return JSON.stringify(this.toLiteral())===JSON.stringify(e.toLiteral())}validateDescription(e){Object.keys(e||[]).forEach(e=>{g()(["kind","location","pattern"].includes(e)||this.handleConnectionMap.has(e),`Unexpected description for ${e}`)})}toInterface(){g()(!this.slotConnections.size,"please implement slots toInterface");const e=this.model.args.map(({type:e,name:t,direction:n})=>({type:xt(e),name:t,direction:n}));return lt.make(this.name,e,[])}toString(){const e=[];let t="";this.verbs.length>0&&(t=" "+this.verbs.map(e=>`&${e}`).join(" "));let n="";this.external&&(n+="external "),n+=`particle ${this.name}${t}`,this.implFile&&(n+=` in '${this.implFile}'`),e.push(n);const r=(t,n)=>{const i=t.tags.map(e=>` #${e}`).join("");if(O.defaultToPreSlandlesSyntax)e.push(`${n}${t.direction}${t.isOptional?"?":""} ${t.type.toString()} ${t.name}${i}`);else{const r="any"===t.direction?"":`${x(t.direction,t.isOptional)} `;e.push(`${n}${t.name}: ${r}${t.type.toString()}${i}`)}for(const e of t.dependentConnections)r(e,n+"  ")};for(const e of this.handleConnections)e.parentConnection||r(e,"  ");this.trustClaims.forEach(t=>e.push(`  ${t.toManifestString()}`)),this.trustChecks.forEach(t=>e.push(`  ${t.toManifestString()}`)),this.modality.names.forEach(t=>e.push(`  modality ${t}`));const i=(t,n,r)=>{const s=[];if(O.defaultToPreSlandlesSyntax){t.isRequired&&s.push("must"),s.push(n),t.isSet&&s.push("set of"),s.push(t.name),t.tags.length>0&&s.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`${r}${s.join(" ")}`),t.formFactor&&e.push(`${r}  formFactor ${t.formFactor}`);for(const n of t.handles)e.push(`${r}  handle ${n}`)}else{s.push(`${t.name}:`),s.push(`${n}s${t.isRequired?"":"?"}`);const i=[];t.formFactor&&i.push(`formFactor: ${t.formFactor}`);for(const e of t.handles)i.push(`handle: ${e}`);const o=0!==i.length?` {${i.join(", ")}}`:"";t.isSet?s.push(`[Slot${o}]`):s.push(`Slot${o}`),t.tags.length>0&&s.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`${r}${s.join(" ")}`)}t.provideSlotConnections&&t.provideSlotConnections.forEach(e=>i(e,"provide",r+"  "))};return this.slotConnections.forEach(e=>i(e,"consume","  ")),this.pattern&&(e.push(`  description \`${this.pattern}\``),this.handleConnectionMap.forEach(t=>{t.pattern&&e.push(`    ${t.name} \`${t.pattern}\``)})),e.join("\n")}toManifestString(){return this.toString()}validateTrustClaims(e){const t=[];return e&&e.forEach(e=>{const n=this.handleConnectionMap.get(e.handle);if(!n)throw new Error(`Can't make a claim on unknown handle ${e.handle}.`);if(!n.isOutput)throw new Error(`Can't make a claim on handle ${e.handle} (not an output handle).`);if(n.claims)throw new Error(`Can't make multiple claims on the same output (${e.handle}).`);const r=function(e,t,n){const r=t.expression.map(e=>{switch(e.claimType){case Re.IsTag:return Et.fromASTNode(e);case Re.DerivesFrom:return kt.fromASTNode(e,n);default:throw new Error("Unknown claim type.")}});return new Ct(e,r)}(n,e,this.handleConnectionMap);n.claims=r.claims,t.push(r)}),t}validateTrustChecks(e){const t=[];if(e){const n=this.getProvidedSlotsByName();e.forEach(e=>{switch(e.target.targetType){case"handle":{const n=e.target.name,r=this.handleConnectionMap.get(n);if(!r)throw new Error(`Can't make a check on unknown handle ${n}.`);if("`consume"===r.direction||"`provide"===r.direction){if("`consume"===r.direction)throw new Error(`Can't make a check on handle ${n}. Can only make checks on input and provided handles.`)}else if(!r.isInput)throw new Error(`Can't make a check on handle ${n} with direction ${r.direction} (not an input handle).`);if(r.check)throw new Error(`Can't make multiple checks on the same input (${n}).`);r.check=St(r,e,this.handleConnectionMap),t.push(r.check);break}case"slot":{const r=e.target.name,i=n.get(r);if(!i)throw this.slotConnectionNames().includes(r)?new Error(`Slot ${r} is a consumed slot. Can only make checks on provided slots.`):new Error(`Can't make a check on unknown slot ${r}.`);i.check=St(i,e,this.handleConnectionMap),t.push(i.check);break}default:throw new Error("Unknown check target type.")}})}return t}getProvidedSlotsByName(){const e=new Map;for(const t of this.slotConnections.values())for(const n of t.provideSlotConnections){const t=n.name;if(e.has(t))throw new Error(`Another slot with name '${t}' has already been provided by this particle.`);e.set(t,n)}return e}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class At{constructor(e){if(this.items=new Map,e)for(let{id:t,value:n,keys:r}of e)r||(r=[]),this.items.set(t,{value:n,keys:new Set(r)})}add(e,t,n){g()(n.length>0&&"object"==typeof n,"add requires a list of keys");let r=this.items.get(e),i=!1;if(r){let e=!1;for(const t of n)r.keys.has(t)||(e=!0),r.keys.add(t);this._equals(r.value,t)||(g()(e,"cannot add without new keys. incoming="+n.join(",")+" existing="+[...r.keys].join(",")),r.value=t,i=!0)}else r={value:t,keys:new Set(n)},this.items.set(e,r),i=!0;return i}_equals(e,t){if(Boolean(e)!==Boolean(t))return!1;if(!e)return!0;const n=typeof e;if(n!==typeof t)return!1;if("object"===n){const n=Object.keys(e);return n.length===Object.keys(t).length&&n.every(n=>this._equals(e[n],t[n]))}return JSON.stringify(e)===JSON.stringify(t)}remove(e,t){const n=this.items.get(e);if(!n)return!1;for(const e of t)n.keys.delete(e);const r=0===n.keys.size;return r&&this.items.delete(e),r}toLiteral(){const e=[];for(const[t,{value:n,keys:r}]of this.items.entries())e.push({id:t,value:n,keys:[...r]});return e}toList(){return[...this.items.values()].map(e=>e.value)}has(e){return this.items.has(e)}getKeys(e){const t=this.items.get(e);return t?[...t.keys]:[]}getValue(e){const t=this.items.get(e);return t?t.value:null}get size(){return this.items.size}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.none=0]="none",e[e.pending=1]="pending",e[e.full=2]="full"}(Ie||(Ie={}));class Mt{constructor(e,t,n,r,i,s){this.version=void 0,this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=Ie.none,this.observers=[],this.updates=[],this.barrier=null,this.id=e,this.type=t,this.port=n,this.scheduler=i,this.name=s,this.updates=[],this.pec=r}static newProxy(e,t,n,r,i,s){return t instanceof ot?new Dt(e,t,n,r,i,s):t instanceof at?new jt(e,t,n,r,i,s):new Ft(e,t,n,r,i,s)}static newNoOpProxy(e,t){return new $t(e,t,null,null,null,"NoOpStorage")}reportExceptionInHost(e){we?we(e.cause.stack,t=>{e.cause.stack=t,this.port.ReportExceptionInHost(e)}):this.port.ReportExceptionInHost(e)}register(e,t){if(t.canRead&&(g()(t instanceof Ut),this.observers.push({particle:e,handle:t}),this.listenerAttached||(this.port.InitializeProxy(this,e=>this._onUpdate(e)),this.listenerAttached=!0),t.options.keepSynced&&(this.keepSynced||(this.port.SynchronizeProxy(this,e=>this._onSynchronize(e)),this.keepSynced=!0),t.options.notifySync&&this.synchronized===Ie.full))){const n=this._getModelForSync();this.scheduler.enqueue(e,t,["sync",e,n])}}deregister(e,t){this.observers=this.observers.filter(({particle:n,handle:r})=>n!==e||r!==t)}_onSynchronize({version:e,model:t}){if(void 0!==this.version&&e<=this.version)return void console.warn(`StorageProxy '${this.id}' received stale model version ${e}; `+`current is ${this.version}`);if(!this._synchronizeModel(e,t))return;for(this.synchronized=Ie.full;this.updates.length>0&&this.updates[0].version<=e;)this.updates.shift();const n=this._getModelForSync();this._notify("sync",n,e=>e.keepSynced&&e.notifySync),this._processUpdates()}_onUpdate(e){if(this.observers.find(({handle:e})=>!e.options.keepSynced&&e.options.notifyUpdate)){const t=this._processUpdate(e,!1);this._notify("update",t,e=>!e.keepSynced&&e.notifyUpdate)}this.keepSynced&&(e.version<=this.version?console.warn(`StorageProxy '${this.id}' received stale update version ${e.version}; `+`current is ${this.version}`):(this.updates.push(e),this.updates.sort((e,t)=>e.version-t.version),this._processUpdates()))}_notify(e,t,n=(e=>!0)){for(const{handle:r,particle:i}of this.observers)n(r.options)&&this.scheduler.enqueue(i,r,[e,i,t])}_processUpdates(){const e=e=>e.version===this.version+1||!(!this.barrier||e.barrier!==this.barrier);for(;this.updates.length>0&&e(this.updates[0]);){const e=this.updates.shift(),t=this._processUpdate(e);this.version=e.version,t&&this._notify("update",t,e=>e.keepSynced&&e.notifyUpdate)}if(this.updates.length>0){if(this.synchronized!==Ie.none){this.synchronized=Ie.none,this.port.SynchronizeProxy(this,e=>this._onSynchronize(e));for(const{handle:e,particle:t}of this.observers)e.options.notifyDesync&&this.scheduler.enqueue(t,e,["desync",t,{}])}}else this.synchronized!==Ie.full&&(this.synchronized=Ie.full)}generateBarrier(){return this.pec.idGenerator.newChildId(_e.fromString(this.id),"barrier").toString()}}class Dt extends Mt{constructor(){super(...arguments),this.model=new At}_getModelForSync(){return this.model.toList()}_synchronizeModel(e,t){return this.version=e,this.model=new At(t),!0}_processUpdate(e,t=!0){if(this.synchronized===Ie.full)for(const{handle:t}of this.observers)if(e.originatorId===t._particleId)return null;const n=[],r=[];if("add"in e)for(const{value:r,keys:i,effective:s}of e.add)(t&&this.model.add(r.id,r,i)||!t&&s)&&n.push(r);else{if(!("remove"in e))throw new Error(`StorageProxy received invalid update event: ${JSON.stringify(e)}`);for(const{value:n,keys:i,effective:s}of e.remove){const e=this.model.getValue(n.id);(t&&this.model.remove(n.id,i)||!t&&s)&&r.push(e)}}if(n.length||r.length){const t={originatorId:e.originatorId};return n.length&&(t.add=n),r.length&&(t.remove=r),t}return null}async toList(){return this.synchronized===Ie.full?Promise.resolve(this.model.toList()):new Promise(e=>this.port.HandleToList(this,e))}async get(e){return this.synchronized===Ie.full?Promise.resolve(this.model.getValue(e)):new Promise((t,n)=>this.port.HandleToList(this,n=>t(n.find(t=>t.id===e))))}async store(e,t,n){const r=e.id,i={value:e,keys:t};if(this.port.HandleStore(this,()=>{},i,n),this.synchronized!==Ie.full)return Promise.resolve();if(!this.model.add(r,e,t))return Promise.resolve();const s={originatorId:n,add:[e]};return this._notify("update",s,e=>e.notifyUpdate),Promise.resolve()}async clear(e){this.synchronized!==Ie.full&&this.port.HandleRemoveMultiple(this,()=>{},[],e);let t=this.model.toList().map(e=>({id:e.id,keys:this.model.getKeys(e.id)}));return this.port.HandleRemoveMultiple(this,()=>{},t,e),(t=(t=t.map(({id:e,keys:t})=>({rawData:this.model.getValue(e).rawData,id:e,keys:t}))).filter(e=>this.model.remove(e.id,e.keys))).length>0&&this._notify("update",{originatorId:e,remove:t},e=>e.notifyUpdate),Promise.resolve()}async remove(e,t,n){if(this.synchronized!==Ie.full){const t={id:e,keys:[]};return this.port.HandleRemove(this,()=>{},t,n),Promise.resolve()}const r=this.model.getValue(e);if(!r)return Promise.resolve();0===t.length&&(t=this.model.getKeys(e));const i={id:e,keys:t};if(this.port.HandleRemove(this,()=>{},i,n),!this.model.remove(e,t))return Promise.resolve();const s={originatorId:n,remove:[r]};return this._notify("update",s,e=>e.notifyUpdate),Promise.resolve()}}class Ft extends Mt{constructor(){super(...arguments),this.model=null}_getModelForSync(){return this.model}_synchronizeModel(e,t){return null==this.barrier&&(this.version=e,this.model=0===t.length?null:t[0].value,g()(void 0!==this.model),!0)}_processUpdate(e,t=!0){if(g()("data"in e),!t)return e;if(null!=this.barrier){if(e.barrier===this.barrier&&(this.barrier=null,this.synchronized!==Ie.full)){this.synchronized=Ie.full;const e=this._getModelForSync();this._notify("sync",e,e=>e.keepSynced&&e.notifySync)}return null}return this.model=e.data,{...e}}async get(){return this.synchronized===Ie.full?Promise.resolve(this.model):new Promise(e=>this.port.HandleGet(this,e))}async set(e,t){if(g()(void 0!==e),JSON.stringify(this.model)===JSON.stringify(e))return Promise.resolve();let n;n=this.listenerAttached?this.generateBarrier():null,this.model=JSON.parse(JSON.stringify(e)),this.barrier=n,this.port.HandleSet(this,e,t,n);const r={originatorId:t,data:e};return this._notify("update",r,e=>e.notifyUpdate),Promise.resolve()}async clear(e){if(this.synchronized===Ie.full&&null==this.model)return Promise.resolve();const t=this.generateBarrier();this.model=null,this.barrier=t,this.port.HandleClear(this,e,t);const n={originatorId:e,data:null};return this._notify("update",n,e=>e.notifyUpdate),Promise.resolve()}}class jt extends Mt{register(e,t){t.canRead&&this.scheduler.enqueue(e,t,["sync",e,{}])}_getModelForSync(){throw new Error("_getModelForSync not implemented for BigCollectionProxy")}_processUpdate(){throw new Error("_processUpdate not implemented for BigCollectionProxy")}_synchronizeModel(){throw new Error("_synchronizeModel not implemented for BigCollectionProxy")}async get(e){throw new Error("unimplemented")}async store(e,t,n){return new Promise(r=>this.port.HandleStore(this,r,{value:e,keys:t},n))}async remove(e,t,n){return new Promise(t=>this.port.HandleRemove(this,t,{id:e,keys:[]},n))}async stream(e,t){return new Promise(n=>this.port.HandleStream(this,n,e,t))}async cursorNext(e){return new Promise(t=>this.port.StreamCursorNext(this,t,e))}async cursorClose(e){return this.port.StreamCursorClose(this,e),Promise.resolve()}}class $t extends Mt{_getModelForSync(){return null}_synchronizeModel(e,t){return!0}_processUpdate(e,t){return null}reportExceptionInHost(e){}deregister(){}register(){}_onSynchronize({version:e,model:t}){}_onUpdate(e){}_notify(e,t,n=(e=>!0)){}_processUpdates(){}generateBarrier(){return null}async get(e){return new Promise(e=>{})}async store(e,t,n){return new Promise(e=>{})}async clear(e){return new Promise(e=>{})}async remove(e,t,n){return new Promise(e=>{})}async toList(){return new Promise(e=>{})}async stream(e,t){return new Promise(e=>{})}async cursorNext(e){return new Promise(e=>{})}async cursorClose(e){return new Promise(e=>{})}async set(e,t){return new Promise(e=>{})}}class Bt{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(e,t,n){this._queues.has(e)||this._queues.set(e,new Map);const r=this._queues.get(e);r.has(t)||r.set(t,[]),r.get(t).push(n),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(e=>this._idleResolver=e)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const e=[...this._queues.keys()][0],t=this._queues.get(e);this._queues.delete(e);for(const[e,n]of t.entries())for(const t of n)try{e._notify(...t)}catch(t){console.error("Error dispatching to particle",t),e.storage.reportExceptionInHost(new w(t,e._particleId,"StorageProxyScheduler::_dispatch"))}}this._updateIdle()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Lt(e,t){g()(t,"Handles need entity classes for deserialization");const{id:n,rawData:r}=e,i=new t(r);return e.id&&V.identify(i,e.id),i}class Ut{constructor(e,t,n,r,i,s){g()(!(e instanceof Ut)),this._storage=e,this.idGenerator=t,this.name=n||this.storage.name,this.canRead=i,this.canWrite=s,this._particleId=r,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1}}reportUserExceptionInHost(e,t,n){this.storage.reportExceptionInHost(new b(e,n,this._particleId,t.spec.name))}reportSystemExceptionInHost(e,t){this.storage.reportExceptionInHost(new w(e,t,this._particleId))}configure(e){g()(this.canRead,"configure can only be called on readable Handles");try{const t=Object.keys(this.options),n=Object.keys(e).filter(e=>!t.includes(e));if(n.length>0)throw new Error(`Invalid option in Handle.configure(): ${n}`);Object.assign(this.options,e)}catch(e){throw this.reportSystemExceptionInHost(e,"Handle::configure"),e}}_serialize(e){return g()(e,"can't serialize a null entity"),e instanceof V&&(V.isIdentified(e)||this.createIdentityFor(e)),e[q].serialize()}createIdentityFor(e){V.createIdentity(e,_e.fromString(this._id),this.idGenerator)}get type(){return this.storage.type}get _id(){return this.storage.id}get storage(){return this._storage}toManifestString(){return`'${this._id}'`}generateKey(){return this.idGenerator.newChildId(_e.fromString(this._id),"key").toString()}disable(e){this.storage instanceof Mt&&this.storage.deregister(e,this),this._storage=Mt.newNoOpProxy(this.storage.id,this.storage.type)}}class Ht extends Ut{async _notify(e,t,n){switch(g()(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void await t.callOnHandleSync(this,this._restore(n),e=>this.reportUserExceptionInHost(e,t,"onHandleSync"));case"update":{const e={};return"add"in n&&(e.added=this._restore(n.add)),"remove"in n&&(e.removed=this._restore(n.remove)),e.originator=n.originatorId===this._particleId,void await t.callOnHandleUpdate(this,e,e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"))}case"desync":return void await t.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"));default:throw new Error("unsupported")}}async get(e){if(!this.canRead)throw new Error("Handle not readable");return this._restore([await this.storage.get(e)])[0]}async toList(){if(!this.canRead)throw new Error("Handle not readable");return this._restore(await this.storage.toList())}_restore(e){if(null==e)return null;const t=this.type.getContainedType();if(t instanceof it)return e.map(e=>Lt(e,this.entityClass));if(t instanceof ut)return e.map(e=>new Kt(e,t,this.storage.pec));throw new Error(`Don't know how to deliver handle data of type ${this.type}`)}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),n=[this.generateKey()];return this.storage.store(t,n,this._particleId)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");if(this.storage.clear)return this.storage.clear(this._particleId);throw new Error("clear not implemented by storage")}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);await this.storage.remove(t.id,[],this._particleId)}get storage(){return this._storage}}class zt extends Ut{async _notify(e,t,n){switch(g()(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void await t.callOnHandleSync(this,this._restore(n),e=>this.reportUserExceptionInHost(e,t,"onHandleSync"));case"update":{const e=this._restore(n.data);return void await t.callOnHandleUpdate(this,{data:e},e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"))}case"desync":return void await t.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,t,"onHandleDesync"));default:throw new Error("unsupported")}}async get(){if(!this.canRead)throw new Error("Handle not readable");const e=await this.storage.get();return this._restore(e)}_restore(e){if(null==e)return null;if(this.type instanceof it)return Lt(e,this.entityClass);if(this.type instanceof lt)return Pt.fromLiteral(e);if(this.type instanceof ut)return new Kt(e,this.type,this.storage.pec);throw new Error(`Don't know how to deliver handle data of type ${this.type}`)}async set(e){try{if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);return this.storage.set(t,this._particleId)}catch(e){throw this.reportSystemExceptionInHost(e,"Handle::set"),e}}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this.storage.clear(this._particleId)}get storage(){return this._storage}}class qt{constructor(e,t){this._parent=e,this._cursorId=t}async next(){const e=await this._parent.storage.cursorNext(this._cursorId);return e.done||(e.value=e.value.map(e=>Lt(e,this._parent.entityClass))),e}close(){this._parent.storage.cursorClose(this._cursorId)}}class Wt extends Ut{configure(e){throw new Error("BigCollections do not support sync/update configuration")}async _notify(e,t,n){g()(this.canRead,"_notify should not be called for non-readable handles"),g()("sync"===e,"BigCollection._notify only supports sync events"),await t.callOnHandleSync(this,[],e=>this.reportUserExceptionInHost(e,t,"onHandleSync"))}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),n=[this.generateKey()];return this.storage.store(t,n,this._particleId)}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);await this.storage.remove(t.id,[],this._particleId)}async stream({pageSize:e,forward:t=!0}){if(!this.canRead)throw new Error("Handle not readable");if(isNaN(e)||e<1)throw new Error("Streamed reads require a positive pageSize");const n=await this.storage.stream(e,t);return new qt(this,n)}get storage(){return this._storage}}function Vt(e){return(e={particleId:"",canRead:!0,canWrite:!0,...e}).proxy instanceof Ge?(g()(e.particleId.length,"NG Handles require a particle ID"),t=e.particleId,n=e.proxy,r=e.idGenerator,i=e.particle,s=e.canRead,o=e.canWrite,a=e.name,new(n.type.handleConstructor())(t,n,r,i,s,o,a)):function(e,t,n=null,r="",i=!0,s=!0){let o;o=e.type instanceof ot?new Ht(e,t,n,r,i,s):e.type instanceof at?new Wt(e,t,n,r,i,s):new zt(e,t,n,r,i,s);const a=e.type.getEntitySchema();return a&&(o.entityClass=a.entityClass(e.pec)),o}(e.proxy,e.idGenerator,e.name,e.particleId,e.canRead,e.canWrite);var t,n,r,i,s,o,a}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Unstored=0]="Unstored",e[e.Stored=1]="Stored"}(Oe||(Oe={}));class Kt{constructor(e,t,n){this.entity=null,this.storageProxy=null,this.handle=null,this.id=e.id,this.storageKey=e.storageKey,this.context=n,this.type=t,this[q]={serialize:()=>({id:this.id,rawData:this.dataClone()})}}async ensureStorageProxy(){null==this.storageProxy&&(this.storageProxy=await this.context.getStorageProxy(this.storageKey,this.type.referredType),this.handle=Vt({proxy:this.storageProxy,idGenerator:this.context.idGenerator}),this.storageKey?g()(this.storageKey===this.storageProxy.storageKey):this.storageKey=this.storageProxy.storageKey)}async dereference(){return g()(this.context,"Must have context to dereference"),this.entity?this.entity:(await this.ensureStorageProxy(),this.entity=await this.handle.get(this.id),this.entity)}dataClone(){return{storageKey:this.storageKey,id:this.id}}static async retrieve(e,t,n,r){const i=Vt({proxy:await e.getStorageProxy(n,r),idGenerator:e.idGenerator});return await i.get(t)}}class Qt extends Kt{constructor(e,t){super({id:V.id(e),storageKey:null},new ut(V.entityClass(e).type),t),this.mode=Oe.Unstored,this.entity=e,this.stored=this.storeReference(e)}async storeReference(e){await this.ensureStorageProxy(),this.handle instanceof et?await this.handle.add(e):await this.handle.store(e),this.mode=Oe.Stored}async dereference(){return this.mode===Oe.Unstored?null:super.dereference()}isIdentified(){return V.isIdentified(this.entity)}static newClientReference(e){return class extends Qt{constructor(t){super(t,e)}}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Gt{constructor(){this.relevances=[],this._idle=Promise.resolve(),this._busy=0,this.slotProxiesByName=new Map,this.spec=this.constructor.spec,0===this.spec.inputs.length&&(this.extraData=!0)}ready(){}setCapabilities(e){if(this.capabilities)throw new Error("capabilities should only be set once");this.capabilities=e||{}}async invokeSafely(e,t){try{return this.startBusy(),await e(this)}catch(e){t(e)}finally{this.doneBusy()}}async callSetHandles(e,t){this.handles=e,await this.invokeSafely(async t=>t.setHandles(e),t),this._handlesToSync=this._countInputHandles(e),this._handlesToSync||this.ready()}async setHandles(e){}_countInputHandles(e){let t=0;for(const[n,r]of e)r.canRead&&t++;return t}async callOnHandleSync(e,t,n){await this.invokeSafely(async n=>n.onHandleSync(e,t),n),0==--this._handlesToSync&&this.ready()}async onHandleSync(e,t){}async callOnHandleUpdate(e,t,n){await this.invokeSafely(async n=>n.onHandleUpdate(e,t),n)}async onHandleUpdate(e,t){}async callOnHandleDesync(e,t){await this.invokeSafely(async t=>t.onHandleDesync(e),t)}async onHandleDesync(e){}async constructInnerArc(){if(!this.capabilities.constructInnerArc)throw new Error("This particle is not allowed to construct inner arcs");return this.capabilities.constructInnerArc(this)}get busy(){return this._busy>0}get idle(){return this._idle}set relevance(e){this.relevances.push(e)}startBusy(){0===this._busy&&(this._idle=new Promise(e=>this._idleResolver=()=>e())),this._busy++}doneBusy(){this._busy--,0===this._busy&&this._idleResolver()}inputs(){return this.spec.inputs}outputs(){return this.spec.outputs}hasSlotProxy(e){return this.slotProxiesByName.has(e)}addSlotProxy(e){this.slotProxiesByName.set(e.slotName,e)}removeSlotProxy(e){this.slotProxiesByName.delete(e)}async service(e){return this.capabilities.serviceRequest?new Promise(t=>{this.capabilities.serviceRequest(this,e,e=>t(e))}):(console.warn(`${this.spec.name} has no service support.`),null)}getSlot(e){return this.slotProxiesByName.get(e)}getSlotNames(){return[...this.slotProxiesByName.keys()]}static buildManifest(e,...t){const n=[];for(let r=0;r<t.length;r++){const i=e[r],s=/ *$/.exec(i)[0];let o;o=(o="string"==typeof t[r]?t[r]:t[r].toManifestString()).replace(/(\n)/g,"$1"+s),n.push(i),n.push(o)}return e.length>t.length&&n.push(e[e.length-1]),n.join("")}async setParticleDescription(e){return this.setDescriptionPattern("pattern",e)}async setDescriptionPattern(e,t){const n=this.handles.get("descriptions");if(n){if(n instanceof Ht||n instanceof Wt){const r=n.entityClass;await n.store(new r({key:e,value:t},this.spec.name+"-"+e))}return!0}throw new Error("A particle needs a description handle to set a decription pattern")}idFor(e){return V.id(e)}dataClone(e){return V.dataClone(e)}mutate(e,t){V.mutate(e,t)}output(e){const{output:t}=this.capabilities;t&&t(this,e)}renderSlot(e,t){}renderHostedSlot(e,t,n){}fireEvent(e,t){}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Zt=()=>Object.create(null),Yt=e=>(class extends e{constructor(){super(),this._pendingProps=Zt(),this._props=this._getInitialProps()||Zt(),this._lastProps=Zt(),this._state=this._getInitialState()||Zt(),this._lastState=Zt()}_getInitialProps(){}_getInitialState(){}_getProperty(e){return this._pendingProps[e]||this._props[e]}_setProperty(e,t){(this._validator||this._wouldChangeProp(e,t))&&(this._pendingProps[e]=t,this._invalidateProps())}_wouldChangeValue(e,t,n){return e[t]!==n}_wouldChangeProp(e,t){return this._wouldChangeValue(this._props,e,t)}_wouldChangeState(e,t){return this._wouldChangeValue(this._state,e,t)}_setProps(e){Object.assign(this._pendingProps,e),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}_setState(e){let t=!1;const n=this._state;for(const r in e){const i=e[r];this._wouldChangeState(r,i)&&(t=!0,n[r]=i)}if(t)return this._invalidate(),!0}_async(e){return Promise.resolve().then(e.bind(this))}_invalidate(){this._validator||(this._validator=this._async(this._validate))}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const e=this._getStateArgs();try{Object.assign(this._props,this._pendingProps),this._propsInvalid&&(this._willReceiveProps(...e),this._propsInvalid=!1),this._shouldUpdate(...e)&&(this._ensureMount(),this._doUpdate(...e))}catch(e){console.error(e)}this._validator=null,this._lastProps=Object.assign(Zt(),this._props),this._lastState=Object.assign(Zt(),this._state)}_doUpdate(...e){this._update(...e),this._didUpdate(...e)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(e,t,n){e=`_debounce_${e}`,this._state[e]=((e,t,n)=>{if(e&&clearTimeout(e),t&&n)return setTimeout(t,n)})(this._state[e],t,null!=n?n:16)}});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Xt extends Gt{get template(){return""}getTemplate(e){return this.template}getTemplateName(e){return"default"}shouldRender(e){return!0}render(e){return{}}renderSlot(e,t){const n=this._getStateArgs(),r=this.getSlot(e);if(r){if(this.currentSlotName=e,t.forEach(e=>r.requestedContentTypes.add(e)),this.shouldRender(...n)){const e={};if(r.requestedContentTypes.has("template")&&(e.template=this.getTemplate(r.slotName)),r.requestedContentTypes.has("model")&&(e.model=this.render(...n)),e.templateName=this.getTemplateName(r.slotName),r.providedSlots.size>0&&(e.template&&("string"==typeof e.template?e.template=this.slotNamesToModelReferences(r,e.template):e.template=Object.entries(e.template).reduce((e,[t,n])=>(e[t]=this.slotNamesToModelReferences(r,n),e),{})),e.model)){const t={};r.providedSlots.forEach((e,n)=>t[`$${n}`]=e),e.model=this.enhanceModelWithSlotIDs(e.model,t)}r.render(e)}else r.isRendered&&r.render({});this.currentSlotName=void 0}}slotNamesToModelReferences(e,t){return e.providedSlots.forEach((e,n)=>{t=t.replace(new RegExp(`slotid="${n}"`,"gi"),`slotname="${n}" slotid$="{{$${n}}}"`)}),t}enhanceModelWithSlotIDs(e,t,n=!0){n&&(e={...t,...e}),e.hasOwnProperty("$template")&&e.hasOwnProperty("models")&&Array.isArray(e.models)&&(e.models=e.models.map(e=>this.enhanceModelWithSlotIDs(e,t)));for(const[n,r]of Object.entries(e))r&&"object"==typeof r&&(e[n]=this.enhanceModelWithSlotIDs(r,t,!1));return e}_getStateArgs(){return[]}forceRenderTemplate(e=""){this.slotProxiesByName.forEach((t,n)=>{e&&n!==e||t.requestedContentTypes.add("template")})}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n})}async setParticleDescription(e){if("string"==typeof e)return super.setParticleDescription(e);if(e.template&&e.model)return await super.setDescriptionPattern("_template_",e.template),void await super.setDescriptionPattern("_model_",JSON.stringify(e.model));throw new Error("Description pattern must either be string or have template and model")}async clearHandle(e){const t=this.handles.get(e);if(!(t instanceof zt||t instanceof Ht))throw new Error("Singleton/Collection required");await t.clear()}async mergeEntitiesToHandle(e,t){const n={},r=this.handles.get(e);if(!(r instanceof Ht))throw new Error("Collection required");(await r.toList()).forEach(e=>n[e.id]=e);for(const e of t)n[this.idFor(e)]||await r.store(e)}async appendEntitiesToHandle(e,t){const n=this.handles.get(e);if(n){if(!(n instanceof Ht||n instanceof Wt))throw new Error("Collection required");await Promise.all(t.map(e=>n.store(e)))}}async appendRawDataToHandle(e,t){const n=this.handles.get(e);if(!(n instanceof Ht||n instanceof Wt))throw new Error("Collection required");{const e=n.entityClass;await Promise.all(t.map(t=>n.store(new e(t))))}}async updateSingleton(e,t){const n=this.handles.get(e);if(n){if(n instanceof zt){const e=new n.entityClass(t);return await n.set(e),e}throw new Error("Singleton required")}throw new Error(`Handle ${e} does not exist`)}async updateCollection(e,t){const n=this.handles.get(e);if(n){if(!(n instanceof Ht||n instanceof Wt))throw new Error("Collection required");await n.remove(t),await n.store(t)}}async derefShares(e){let t=[];this.startBusy();try{const n=e.map(async e=>e.ref.dereference());t=await Promise.all(n)}finally{this.doneBusy()}return t}async boxQuery(e,t){if(e){const n=e.filter(e=>t===e.fromKey);return await this.derefShares(n)}return[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Jt extends(Yt(Xt)){willReceiveProps(...e){}update(...e){}shouldRender(...e){return!0}render(...e){return{}}setState(e){return this._setState(e)}get state(){return this._state}set state(e){this.setState(e)}get props(){return this._props}get config(){return{handleNames:this.spec.inputs.map(e=>e.name),slotNames:this.spec.slandleConnectionNames()}}_willReceiveProps(...e){this.willReceiveProps(...e)}_update(...e){this.update(...e),this.shouldRender(...e)&&(this.relevance=1),this.config.slotNames.forEach(e=>this.renderSlot(e,["model"]))}_async(e){this.startBusy();return setTimeout(()=>{try{e.call(this)}finally{this.doneBusy()}},10)}async setHandles(e){this.configureHandles(e),this.handles=e,this._invalidate()}configureHandles(e){}async onHandleSync(e,t){this._setProperty(e.name,t)}async onHandleUpdate({name:e},{data:t,added:n,removed:r}){if(void 0!==t&&this._setProps({[e]:t}),n){const t=(this.props[e]||[]).concat(n);this._props[e]=t,this._setProps({[e]:t})}if(r){const t=this.props[e];Array.isArray(t)&&(r.forEach(e=>{const n=t.findIndex(t=>this.idFor(t)===this.idFor(e));n>=0?t.splice(n,1):console.warn("dom-particle::onHandleUpdate: couldn't find item to remove")}),this._setProps({[e]:t}))}}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n},this._state)}debounce(e,t,n){const r=`_debounce_${e}`,i=this.state;i[r]||(i[r]=!0,this.startBusy());super._debounce(e,()=>{this.doneBusy(),t(),i[r]=null},n)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class en extends Jt{getTemplate(e){return this._state.template}getTemplateName(e){return this._state.templateName}render(e,t){return t.renderModel}shouldRender(e,t){return Boolean((t.template||t.templateName)&&t.renderModel)}renderHostedSlot(e,t,n){this.combineHostedTemplate(e,t,n),this.combineHostedModel(e,t,n)}combineHostedTemplate(e,t,n){}combineHostedModel(e,t,n){}static propsToItems(e){return e?e.map(e=>({subId:V.id(e),...e})):[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class tn extends en{constructor(){super(...arguments),this._itemSubIdByHostedSlotId=new Map,this._connByHostedConn=new Map}async _mapParticleConnections(e,t,n,r,i){const s=[],o=[];let a=2;const c=[e,t];for(const[e,t]of r){if(c.includes(e))continue;const r=t.storage;s.push(`use '${await i.mapHandle(r)}' as v${a}`);const l=n.handleConnections.find(e=>e.isCompatibleType(t.type));l&&(o.push(`${l.name} = v${a++}`),this._connByHostedConn.set(l.name,e))}return[s,o]}async setHandles(e){this.handleIds={};const t=await this.constructInnerArc(),n=e.get("hostedParticle");let r=null,i=[],s=[];n&&(r=await n.get())&&([i,s]=await this._mapParticleConnections("list","hostedParticle",r,e,t)),this.setState({arc:t,type:e.get("list").type,hostedParticle:r,otherMappedHandles:i,otherConnections:s}),await super.setHandles(e)}async update({list:e},{arc:t,type:n,hostedParticle:r,otherMappedHandles:i,otherConnections:s},o,a){if(e&&t&&(o.list!==e||a.arc!==t)){e.length>0&&(this.relevance=.1);for(const[o,a]of this.getListEntries(e)){let e=r;const c=V.id(a);if(this.handleIds[c]){(await this.handleIds[c]).set(a);continue}const l=t.createHandle(n.getContainedType(),`item${o}`);this.handleIds[c]=l;const h=await l;if(!e){if(!a.renderParticleSpec)continue;e=Pt.fromLiteral(JSON.parse(a.renderParticleSpec));const n="list",r="renderParticle";[i,s]=await this._mapParticleConnections(n,r,e,this.handles,t)}const u=e.slandleConnectionNames()[0],d=this.spec.slandleConnectionNames();g()(d.length>0,"there must be at least one slot");const p=d[0],f=await t.createSlot(this,p,h._id);if(f){this._itemSubIdByHostedSlotId.set(f,c);try{const n=this.constructInnerRecipe(e,a,h,{name:u,id:f},{connections:s,handles:i});await t.loadRecipe(n),h.set(a)}catch(e){console.log(e)}}}}}combineHostedModel(e,t,n){const r=this._itemSubIdByHostedSlotId.get(t);if(!r)return;const i=this._state.renderModel?this._state.renderModel.items:[],s=i.findIndex(e=>e.subId===r),o={...n.model,subId:r};s>=0&&s<i.length?i[s]=o:i.push(o),this.setState({renderModel:{items:i}})}combineHostedTemplate(e,t,n){const r=this._itemSubIdByHostedSlotId.get(t);if(!r)return;g()(n.templateName,`Template name is missing for slot '${e}' (hosted slot ID: '${t}')`);const i={...this._state.templateName,[r]:`${n.templateName}`};if(this.setState({templateName:i}),n.template){let e=n.template;e=e.replace(new RegExp('slotid="[a-z]+"',"gi"),'$& subid$="{{subId}}"'),this._connByHostedConn.forEach((t,n)=>{e=e.replace(new RegExp(`{{${n}.description}}`,"g"),`{{${t}.description}}`)}),this.setState({template:{...this._state.template,[n.templateName]:e}}),this.forceRenderTemplate()}}getListEntries(e){return e.entries()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class nn extends Gt{get config(){return{handleNames:this.spec.inputs.map(e=>e.name),slotNames:this.spec.slandleConnectionNames()}}get template(){return""}shouldRender(...e){return!0}renderOutput(...e){const t=this.render(...e);t&&this.renderModel(t)}renderModel(e){this.output({template:this.template,model:e})}render(...e){return{}}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n})}async setParticleDescription(e){if("string"==typeof e)return super.setParticleDescription(e);if(e.template&&e.model)return await super.setDescriptionPattern("_template_",e.template),void await super.setDescriptionPattern("_model_",JSON.stringify(e.model));throw new Error("Description pattern must either be string or have template and model")}async await(e){return await this.invokeSafely(e,e=>{throw e})}async set(e,t){const n=this._requireHandle(e);if(!(n instanceof zt))throw new Error(`Cannot set non-Singleton handle [${e}]`);if(Array.isArray(t))throw new Error(`Cannot set an Array to Singleton handle [${e}]`);return this.await(async e=>await n.set(this._requireEntity(t,n.entityClass)))}async add(e,t){const n=this._requireHandle(e);if(!(n instanceof Ht))throw new Error(`Cannot add to non-Collection handle [${e}]`);const r=n.entityClass,i=Array.isArray(t)?t:[t];return this.await(async e=>{await this._remove(n,i),await Promise.all(i.map(e=>n.store(this._requireEntity(e,r))))})}_requireEntity(e,t){return e instanceof V?e:new t(e)}async remove(e,t){const n=this._requireHandle(e);if(!(n instanceof Ht))throw new Error(`Cannot remove from a non-Collection handle [${e}]`);return this._remove(n,t)}async _remove(e,t){const n=Array.isArray(t)?t:[t];return this.await(async t=>Promise.all(n.map(async t=>{t instanceof V&&await e.remove(t)})))}async clear(e){const t=this._requireHandle(e);if(!(t instanceof zt||t instanceof Ht))throw new Error("Can only clear Singleton or Collection handles");return this.await(e=>t.clear())}_requireHandle(e){const t=this.handles.get(e);if(!t)throw new Error(`Could not find handle [${e}]`);return t}async derefShares(e){return this.await(async t=>{const n=e.map(async e=>e.ref.dereference());return await Promise.all(n)})}async boxQuery(e,t){if(!e)return[];const n=e.filter(e=>t===e.fromKey);return await this.derefShares(n)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class rn extends(Yt(nn)){willReceiveProps(...e){}_willReceiveProps(...e){this.willReceiveProps(...e)}update(...e){}setState(e){return this._setState(e)}get state(){return this._state}set state(e){this.setState(e)}get props(){return this._props}_shouldUpdate(){return this._handlesToSync<=0}_update(...e){this.update(...e),this.shouldRender(...e)&&(this.relevance=1,this.renderOutput(...e))}_async(e){this.startBusy();return setTimeout(()=>{try{e.call(this)}finally{this.doneBusy()}},10)}ready(){this._invalidate()}async onHandleSync(e,t){this._setProperty(e.name,t)}async onHandleUpdate({name:e},{data:t,added:n,removed:r}){if(void 0!==t&&this._setProps({[e]:t}),n){const t=(this.props[e]||[]).concat(n);this._props[e]=t,this._setProps({[e]:t})}if(r){const t=this.props[e];Array.isArray(t)&&(r.forEach(e=>{const n=t.findIndex(t=>this.idFor(t)===this.idFor(e));n>=0?t.splice(n,1):console.warn("dom-particle::onHandleUpdate: couldn't find item to remove")}),this._setProps({[e]:t}))}}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n},this._state)}debounce(e,t,n){const r=`_debounce_${e}`,i=this.state;i[r]||(i[r]=!0,this.startBusy());super._debounce(e,()=>{this.doneBusy(),t(),i[r]=null},n)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class sn extends rn{getTemplate(e){return this.state.template}getTemplateName(e){return this.state.templateName}render(e,t){return t.renderModel}shouldRender(e,t){return Boolean((t.template||t.templateName)&&t.renderModel)}static propsToItems(e){return e?e.map(e=>({subId:V.id(e),...e})):[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class on extends sn{async setHandles(e){this.plexeds=[];const t=await this.constructInnerArc(),n=e.get("hostedParticle");let r=null,i=[],s=[];n&&(r=await n.get())&&({otherMappedHandles:i,otherConnections:s}=await this._mapParticleConnections("list","hostedParticle",r,e,t)),this.setState({arc:t,type:e.get("list").type,hostedParticle:r,otherMappedHandles:i,otherConnections:s}),await super.setHandles(e)}async update({list:e},{arc:t,type:n,hostedParticle:r,otherMappedHandles:i,otherConnections:s},o,a){if(e&&t&&(o.list!==e||a.arc!==t)){e.length>0&&(this.relevance=.1);for(const[o,a]of this.getListEntries(e))await this.updateEntry(o,a,{arc:t,type:n,hostedParticle:r,otherConnections:s,otherMappedHandles:i});for(let t,n=e.length;t=this.plexeds[n];n++)t.then(e=>e.handle.clear())}}async updateEntry(e,t,{hostedParticle:n,arc:r,type:i,otherConnections:s,otherMappedHandles:o}){if(!n&&!t.renderParticleSpec)return;const a=await this.requirePlexed(e,t,{hostedParticle:n,arc:r,type:i,otherConnections:s,otherMappedHandles:o});return a.handle.set(t),a.slotId}async requirePlexed(e,t,{arc:n,type:r,hostedParticle:i,otherConnections:s,otherMappedHandles:o}){let a=this.plexeds[e];return a||(a=new Promise(async a=>{const c=await this.acquireItemHandle(e,{arc:n,item:t,type:r}),l=await this.resolveHosting(t,{arc:n,hostedParticle:i,otherConnections:s,otherMappedHandles:o}),h={arc:n,handle:c,hosting:l,slotId:null};h.slotId=await this.createInnards(t,h),a(h)}),this.plexeds[e]=a),await a}async resolveHosting(e,{arc:t,hostedParticle:n,otherConnections:r,otherMappedHandles:i}){return n?{hostedParticle:n,otherConnections:r,otherMappedHandles:i}:await this.resolveHostedParticle(e,t)}async acquireItemHandle(e,{arc:t,item:n,type:r}){const i=t.createHandle(r.getContainedType(),`item${e}`);return await i}async resolveHostedParticle(e,t){const n=Pt.fromLiteral(JSON.parse(e.renderParticleSpec)),{otherConnections:r,otherMappedHandles:i}=await this._mapParticleConnections("list","renderParticle",n,this.handles,t);return{otherConnections:r,otherMappedHandles:i,hostedParticle:n}}async _mapParticleConnections(e,t,n,r,i){const s=[],o=[];let a=2;const c=[e,t];for(const[e,t]of r)if(!c.includes(e)){const e=t.storage;s.push(`use '${await i.mapHandle(e)}' as v${a}`);const r=n.handleConnections.find(e=>e.isCompatibleType(t.type));r&&o.push(`${r.name} = v${a++}`)}return{otherMappedHandles:s,otherConnections:o}}async createInnards(e,{arc:t,handle:n,hosting:{hostedParticle:r,otherMappedHandles:i,otherConnections:s}}){const o=[...r.slotConnections.keys()][0],a=[...this.spec.slotConnections.values()][0].name,c=await t.createSlot(this,a,n._id);if(c)try{const a=this.constructInnerRecipe(r,e,n,{name:o,id:c},{connections:s,handles:i});await t.loadRecipe(a)}catch(e){console.warn(e)}return c}getListEntries(e){return e.entries()}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const an=(e,...t)=>(e[0]+t.map((t,n)=>t+e[n+1]).join("")).trim(),{warn:cn}=p("Loader","green"),ln=e=>"string"==typeof e,hn=e=>/\/\/schema.org\//.test(e),un=e=>/^https?:\/\//.test(e);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class dn{constructor(e={},t={}){this.urlMap=e,this.staticMap=t,this.compileRegExp(e)}setParticleExecutionContext(e){this.pec=e}flushCaches(){}async loadResource(e){const t=this.loadStatic(e);if(t)return t;const n=this.resolve(e);return un(n)?this.loadUrl(n):this.loadFile(n)}async loadBinaryResource(e){const t=this.loadStaticBinary(e);if(t)return t;const n=this.resolve(e);return un(n)?this.loadBinaryUrl(n):this.loadBinaryFile(n)}loadStatic(e){const t=this.staticMap[e];if(t&&!ln(t))throw new Error("Cannot load static binary content as string");return t}loadStaticBinary(e){const t=this.staticMap[e];if(t){if(t instanceof ArrayBuffer)return t;throw new Error("Cannot load static string content as binary")}return null}async loadUrl(e){return hn(e)?this.loadSchemaOrgUrl(e):this.fetchString(e)}async fetchString(e){const t=await m(e);return t.ok?t.text():Promise.reject(new Error(`HTTP ${t.status}: ${t.statusText}`))}async loadBinaryUrl(e){return this.fetchBuffer(e)}async fetchBuffer(e){const t=await m(e);return t.ok?t.arrayBuffer():Promise.reject(new Error(`HTTP ${t.status}: ${t.statusText} for ${e}`))}join(e,t){return un(t)?t:"/"===t[0]||":"===t[1]?t:(e=this.path(e),t=this.normalizeDots(`${e}${t}`))}path(e){return e.replace(/[/][^/]+$/,"/")}normalizeDots(e){const t=e=>e.replace(/(?:^|\/)[^./]*\/\.\./g,"");for(let n=t(e=(e=(e=e||"").replace(/\\/g,"/")).replace(/\/\.\//g,"/"));n!==e;n=t(e=n));return e=e.replace(/([^:])(\/\/)/g,"$1/")}resolve(e){const t=this.resolvePath(e);return this.normalizeDots(t)}resolvePath(e){let t=e;const n=this.findUrlMapMacro(e);if(n){const r=this.urlMap[n];t=ln(r)?`${r}${e.slice(n.length)}`:this.resolveConfiguredPath(e,n,r)}return t}findUrlMapMacro(e){return Object.keys(this.urlMap).sort((e,t)=>t.length-e.length).find(t=>ln(e)&&e.slice(0,t.length)===t)}resolveConfiguredPath(e,t,n){return[n.root,e.match(n.compiledRegex)?n.buildDir:"",n.path||"",e.slice(t.length)].join("")}mapParticleUrl(e){if(!e)return;const t=this.resolve(e).split("/");t.pop();const n=t.join("/");this.urlMap.$here=n,this.urlMap.$module=n}async loadSchemaOrgUrl(e){let t=`${e}.jsonld`,n=null;e.endsWith("/Thing")&&(t="https://schema.org/Product.jsonld",n={"@id":"schema:Thing"});const r=await this.fetchString(t);return _.convert(r,n)}async provisionObjectUrl(e){return null}async loadParticleClass(e){let t=null;const n=await this.requireParticle(e.implFile||"",e.implBlobUrl);return n?(t=n).spec=e:cn(`[${e.implFile}]::defineParticle() returned no particle.`),t}unwrapParticle(e,t){return g()(this.pec),e({Particle:Gt,DomParticle:Jt,MultiplexerDomParticle:tn,TransformationDomParticle:en,UiParticle:rn,UiMultiplexerParticle:on,ReactiveParticle:rn,SimpleParticle:rn,Reference:Qt.newClientReference(this.pec),resolver:this.resolve.bind(this),log:t||(()=>{}),html:an})}provisionLogger(e){return p(e.split("/").pop(),"#1faa00").log}compileRegExp(e){for(const t of Object.values(e))"string"!=typeof t&&(t.compiledRegex=RegExp(t.buildOutputRegex))}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const{warn:pn}=p("loader-web","green");class fn extends dn{clone(){return new fn(this.urlMap)}flushCaches(){}async loadFile(e){return this.loadUrl(e)}async loadBinaryFile(e){return this.loadBinaryUrl(e)}async provisionObjectUrl(e){if(!e||e.endsWith(".wasm"))return null;{const t=`${await this.loadResource(e)}\n//# sourceURL=${this.resolve(e)}`;return URL.createObjectURL(new Blob([t],{type:"application/javascript"}))}}async requireParticle(e,t){this.mapParticleUrl(e);const n=this.resolve(e),r=t||n,i=this.loadWrappedParticle(r,n);if(i)return this.unwrapParticle(i,this.provisionLogger(e))}loadWrappedParticle(e,t){let n;self.defineParticle=e=>{n&&pn("multiple particles not supported, last particle wins"),n=e};try{importScripts(e)}catch(e){throw new Error(`Error loading Particle from '${t}': ${e.message}`)}finally{delete self.defineParticle}return n}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class gn extends Error{constructor(e,t,n,r){super(),this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,gn)}static buildMessage(e,t){function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,e=>"\\x0"+n(e)).replace(/[\x10-\x1F\x7F-\x9F]/g,e=>"\\x"+n(e))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,e=>"\\x0"+n(e)).replace(/[\x10-\x1F\x7F-\x9F]/g,e=>"\\x"+n(e))}function s(e){switch(e.type){case"literal":return'"'+r(e.text)+'"';case"class":const t=e.parts.map(e=>Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e));return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){const t=e.map(s);let n,r;if(t.sort(),t.length>0){for(n=1,r=1;n<t.length;n++)t[n-1]!==t[n]&&(t[r]=t[n],r++);t.length=r}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+((o=t)?'"'+r(o)+'"':"end of input")+" found.";var o}}const mn=function(e,t){t=void 0!==t?t:{};const n={},r={Manifest:Do};let i=Do;const s=function(e){const t=e.map(e=>{const t=e[0],n=e[2];return n.triggers=t.triggerSet,n.annotation=t.simpleAnnotation,n});return function e(t,n=""){if(["string","number","boolean"].includes(typeof t)||null===t)return;void 0===t&&To(`Internal Parser Error: result was undefined at ${n}`);if(Array.isArray(t)){let r=0;for(const i of t)e(i,`${n}/${r}`),r++;return}t.model&&To(`Internal Parser Error: unexpected 'model' in ${JSON.stringify(t)} at ${n}`);t.location||To(`Internal Parser Error: no 'location' in ${JSON.stringify(t)} at ${n}`);t.kind||To(`Internal Parser Error: no 'kind' in ${JSON.stringify(t)} at ${n}`);for(const r of Object.keys(t))["location","kind"].includes(r)||e(t[r],`${n}/${r}`)}(t),ec.length>0&&!O.defaultToPreSlandlesSyntax&&("undefined"==typeof global||global.testFlags.quiet||(console.warn("WARNING: Pre-Slandles Syntax is deprecated. Contact jopra@google.com for more information."),console.warn(`WARNING: Used in \n  ${ec.map(e=>`line ${e.start.line} column ${e.start.column}`).join("\n  ")}`))),t},o=function(e,t){return ic({kind:"annotation",triggerSet:e.map(e=>e[1]),simpleAnnotation:rc(t,e=>e[1],null)})},a=Oo("a trigger for a recipe"),c="@trigger",l=Ro("@trigger",!1),h=function(e){return e.map(e=>[e[2],e[4]])},u=Oo("an annotation (e.g. @foo)"),d="@",p=Ro("@",!1),f=function(e){return e},g="resource",m=Ro("resource",!1),y=function(e,t){return ic({kind:"resource",name:e,data:t})},_="start",v=Ro("start",!1),w=function(){Xa=Ya},b=function(e){return e.map(e=>e[0].substring(Xa.length)+e[1]).join("")},S=/^[^\n]/,C=Io(["\n"],!0,!1),E=function(){return Eo()},k="store",x=Ro("store",!1),R="of",I=Ro("of",!1),N="!!",P=Ro("!!",!1),A=function(e,t,n,r,i,s,o,a){a=rc(a,nc,[]);let c=null,l=null;for(const e of a)"description"===e[0]?(c&&To("You cannot provide more than one description."),c=e[2]):"manifest-storage-claim"===e.kind?(l&&To("You cannot provide more than one claim."),l=e):To(`Unknown ManifestStorageItem: ${e}`);return ic({kind:"store",name:e,type:t,id:rc(n,e=>e[1],null),originalId:rc(r,e=>e[1],null),version:rc(i,e=>e[1],null),tags:rc(s,e=>e[1],null),source:o.source,origin:o.origin,storageKey:o.storageKey||null,description:c,claim:l})},M="in",D=Ro("in",!1),F=function(e){return ic({kind:"manifest-storage-source",origin:"file",source:e})},j="at",$=Ro("at",!1),B=function(e,t){return ic({kind:"manifest-storage-source",origin:"resource",source:e,storageKey:rc(t,e=>e[3],null)})},L=function(e){return ic({kind:"manifest-storage-source",origin:"storage",source:e})},U="description",H=Ro("description",!1),z="claim",q=Ro("claim",!1),W="is",V=Ro("is",!1),K="and",Q=Ro("and",!1),G=function(e,t){return ic({kind:"manifest-storage-claim",tags:[e,...t.map(e=>e[5])]})},Z="import",Y=Ro("import",!1),X=function(e){return ic({kind:"import",path:e})},J=Oo("an interface"),ee="interface",te=Ro("interface",!1),ne="<",re=Ro("<",!1),ie=">",se=Ro(">",!1),oe=function(e,t,n){return ic({kind:"interface",name:e,args:rc(n,nc,[]).filter(e=>"interface-argument"===e.kind),slots:rc(n,nc,[]).filter(e=>"interface-slot"===e.kind)})},ae="*",ce=Ro("*",!1),le=function(e,t,n){return sc(1),"host"===(e=rc(e,e=>e[0],"any"))&&To("Interface cannot have arguments with a 'host' direction."),ic({kind:"interface-argument",direction:e,type:rc(t,e=>e[0],null),name:n})},he=function(e,t,n){return ac(e,t||"any",rc(n,e=>e[1],null))},ue=function(e,t){return ac("*",e||"any",rc(t,e=>e[1],null))},de=function(e){return ac("*","any",e)},pe="must",fe=Ro("must",!1),ge="consume",me=Ro("consume",!1),ye="provide",_e=Ro("provide",!1),ve="set of",we=Ro("set of",!1),be=function(e,t,n,r){return sc(3),ic({kind:"interface-slot",name:rc(r,e=>r[1],null),isRequired:rc(e,e=>"must"===e[0],!1),direction:t,isSet:!!n})},Se="consumes",Ce=Ro("consumes",!1),Ee="provides",ke=Ro("provides",!1),xe="?",Ie=Ro("?",!1),Oe=function(e,t,n,r){oc(4);let i=!1;return r&&(i=(r=r[1]).isSet,r.fields.forEach(({name:e,value:t})=>{To("interface slots do not currently support fields")})),"consumes"===t&&(t="consume"),"provides"===t&&(t="provide"),ic({kind:"interface-slot",name:e,isRequired:!n,direction:t,isSet:i})},Ne="meta",Pe=Ro("meta",!1),Ae=function(e){return ic({kind:"meta",items:e=e?nc(e):[]})},Me="name",De=Ro("name",!1),Fe=":",je=Ro(":",!1),$e=function(e){return ic({key:"name",value:e,kind:"name"})},Be="storageKey",Le=Ro("storageKey",!1),Ue=function(e){return ic({key:"storageKey",value:e,kind:"storageKey"})},He="external",ze=Ro("external",!1),qe="particle",We=Ro("particle",!1),Ve=function(e,t,n,r,i){const s=[],o=[],a=[],c=[],l=[];let h=null,u=!1;return n=rc(n,e=>e[1],[]),e=!!e,r=rc(r,e=>e[3],null),e&&r&&To("Particles marked external cannot have an implementation file."),(i=rc(i,nc,[])).forEach(e=>{"particle-interface"===e.kind?(/[A-Z]/.test(e.verb[0])&&e.verb!==t&&To(`Verb ${e.verb} must start with a lower case character or be same as particle name.`),n.push(e.verb),s.push(...e.args),u=!0):"particle-argument"===e.kind?s.push(e):"particle-slot"===e.kind?a.push(e):"description"===e.kind?(h={kind:"description",location:ko()},e.description.forEach(e=>h[e.name]=e.pattern||e.patterns[0])):"particle-trust-claim"===e.kind?c.push(e):"particle-trust-check"===e.kind?l.push(e):e.modality?o.push(e.modality):To(`Particle ${t} contains an unknown element: ${e.name} / ${e.kind}`)}),0===o.length&&o.push("dom"),ic({kind:"particle",name:t,external:e,implFile:r,verbs:n,args:s,modality:o,slotConnections:a,description:h,hasParticleHandleConnection:u,trustClaims:c,trustChecks:l})},Ke=Oo("a particle item"),Qe=function(e,t){return ic({kind:"particle-trust-claim",handle:e,expression:t})},Ge=function(e,t){return[e,...t.map(e=>e[3])]},Ze="not",Ye=Ro("not",!1),Xe=function(e,t){return ic({kind:"particle-trust-claim-is-tag",claimType:Re.IsTag,isNot:null!=e,tag:t})},Je="derives from",et=Ro("derives from",!1),tt=function(e){return ic({kind:"particle-trust-claim-derives-from",claimType:Re.DerivesFrom,parentHandle:e})},nt="check",rt=Ro("check",!1),it=function(e,t){return ic({kind:"particle-trust-check",target:e,expression:t})},st="data",ot=Ro("data",!1),at=function(e,t){return ic({kind:"particle-check-target",targetType:t?"slot":"handle",name:e})},ct="or",lt=Ro("or",!1),ht=function(e,t){if(0===t.length)return e;return new Set(t.map(e=>e[1])).size>1&&xo("You cannot combine 'and' and 'or' operations in a single check expression. You must nest them inside parentheses."),ic({kind:"particle-trust-check-boolean-expression",operator:t[0][1],children:[e,...t.map(e=>e[3])]})},ut=function(e){return e},dt="(",pt=Ro("(",!1),ft=")",gt=Ro(")",!1),mt=function(e,t){return ic({kind:"particle-trust-check-has-tag",checkType:Te.HasTag,isNot:!!e,tag:t})},yt="from",_t=Ro("from",!1),vt="handle",wt=Ro("handle",!1),bt=function(e,t){return ic({kind:"particle-trust-check-is-from-handle",checkType:Te.IsFromHandle,isNot:!!e,parentHandle:t})},St="output",Ct=Ro("output",!1),Et=function(e,t){return ic({kind:"particle-trust-check-is-from-output",checkType:Te.IsFromOutput,isNot:!!e,output:t})},kt=function(e,t){return ic({kind:"particle-trust-check-is-from-store",checkType:Te.IsFromStore,isNot:!!e,storeRef:t})},xt=function(e){return ic({kind:"store-reference",type:"name",store:e})},Tt=function(e){return ic({kind:"store-reference",type:"id",store:e})},Rt=function(e,t){return e.dependentConnections=rc(t,nc,[]),e},It=function(e,t,n,r){return sc(5),ic({kind:"particle-argument",direction:e,type:n,isOptional:!!t,dependentConnections:[],name:r.name,tags:r.tags})},Ot=function(e){return e},Nt=function(e,t,n,r){return oc(6),ic({kind:"particle-argument",direction:rc(t,e=>e[0],"any"),type:n,isOptional:rc(t,e=>!!e[1],!1),dependentConnections:[],name:e||r&&r[0]||xo(`either a name or tags to be supplied ${e} ${r}`),tags:r||[]})},Pt=Oo("a direction (e.g. inout, in, out, host, `consume, `provide, any)"),At="inout",Mt=Ro("inout",!1),Dt="out",Ft=Ro("out",!1),jt="host",$t=Ro("host",!1),Bt="`consume",Lt=Ro("`consume",!1),Ut="`provide",Ht=Ro("`provide",!1),zt="any",qt=Ro("any",!1),Wt=/^[^a-zA-Z0-9]/,Vt=Io([["a","z"],["A","Z"],["0","9"]],!0,!1),Kt={type:"any"},Qt=function(){return sc(7),Eo()},Gt=Oo("a direction (e.g. reads writes, reads, writes, hosts, `consumes, `provides, any')"),Zt="reads",Yt=Ro("reads",!1),Xt=" writes",Jt=Ro(" writes",!1),en="writes",tn=Ro("writes",!1),nn="hosts",rn=Ro("hosts",!1),sn="`consumes",on=Ro("`consumes",!1),an="`provides",cn=Ro("`provides",!1),ln=function(){return oc(8),function(e){switch(e){case"reads":return"in";case"writes":return"out";case"reads writes":return"inout";case"`consumes":return"`consume";case"`provides":return"`provide";case"hosts":return"host";case"any":return"any";default:throw new Error(`Bad direction ${e}`)}}(Eo())},hn=Oo("a direction arrow (e.g. <-, ->, <->, =, `consume, `provide)"),un="<->",dn=Ro("<->",!1),pn="<-",fn=Ro("<-",!1),mn="->",yn=Ro("->",!1),_n="=",vn=Ro("=",!1),wn="![",bn=Ro("![",!1),Sn="]",Cn=Ro("]",!1),En=function(e){return ic({kind:"singleton-type",type:e})},kn="[",xn=Ro("[",!1),Tn=function(e){return ic({kind:"collection-type",type:e})},Rn="BigCollection<",In=Ro("BigCollection<",!1),On=function(e){return ic({kind:"big-collection-type",type:e})},Nn="Reference<",Pn=Ro("Reference<",!1),An=function(e){return ic({kind:"reference-type",type:e})},Mn=Oo("a type variable (e.g. ~foo)"),Dn="~",Fn=Ro("~",!1),jn="with",$n=Ro("with",!1),Bn=function(e,t){return ic({kind:"variable-type",name:e,constraint:rc(t,e=>e[3],null)})},Ln="Slot",Un=Ro("Slot",!1),Hn=/^[^a-z0-9_]/i,zn=Io([["a","z"],["0","9"],"_"],!0,!0),qn="{",Wn=Ro("{",!1),Vn=",",Kn=Ro(",",!1),Qn="}",Gn=Ro("}",!1),Zn=function(e){return ic({kind:"slot-type",fields:e=rc(e,e=>{const t=e[2];return t?[t[0]].concat(t[1].map(e=>e[2])):[]},[])})},Yn=function(e,t){return ic({kind:"slot-field",name:e,value:t})},Xn=function(e){return ic({kind:"type-name",name:e})},Jn=function(e,t){return[e,...t.map(e=>e[2])]},er="modality",tr=Ro("modality",!1),nr=function(e){return ic({kind:"particle-modality",modality:e})},rr=function(e,t,n,r,i){sc(9);let s=null;const o=[];return(i=rc(i,nc,[])).forEach(e=>{"provided-slot"===e.kind?o.push(e):"form-factor"===e.kind?(s&&To("duplicate form factor for a slot"),s=e.formFactor):To("Unsupported particle slot item ",e)}),ic({kind:"particle-slot",name:n,tags:rc(r,e=>e[1],[]),isRequired:rc(e,e=>"must"===e[0],!1),isSet:!!t,formFactor:s,provideSlotConnections:o})},ir=function(e){return e.isSet=!1,e},sr=function(e){return(e=e[1]).isSet=!0,e},or=function(e,t,n,r,i){oc(10);const s=[];(i=rc(i,nc,[])).forEach(e=>{"provided-slot"===e.kind?s.push(e):To("Unsupported particle slot item ",e)});let o=null,a=!1;return n&&(a=(n=n[1]).isSet,n.fields.forEach(({name:e,value:t})=>{"formFactor"===e?o?To("duplicate form factor for a slot"):o=t:To(`unknown slot field named ${e} with value ${t}`)})),ic({kind:"particle-slot",name:e,tags:r||[],isRequired:!t,isSet:a,formFactor:o,provideSlotConnections:s})},ar="formFactor",cr=Ro("formFactor",!1),lr="fullscreen",hr=Ro("fullscreen",!1),ur="big",dr=Ro("big",!1),pr="medium",fr=Ro("medium",!1),gr="small",mr=Ro("small",!1),yr=function(e){return ic({kind:"form-factor",formFactor:e})},_r=function(e,t,n,r,i){sc(11);let s=null;const o=[];return(i=i?nc(i):[]).forEach(e=>{"form-factor"===e.kind?(s&&To("duplicate form factor for a slot"),s=e.formFactor):o.push(e.handle)}),ic({kind:"provided-slot",name:n,tags:rc(r,e=>e[1],[]),isRequired:rc(e,e=>"must"===e[0],!1),isSet:!!t,formFactor:s,handles:o})},vr=function(e,t,n,r){oc(12);let i=null;const s=[];let o=!1;return n&&(o=(n=n[1]).isSet,n.fields.forEach(({name:e,value:t})=>{"formFactor"===e?i?To("duplicate form factor for a slot"):i=t:"handle"===e?s.push(t):To(`unknown slot field named ${e} with value ${t}`)})),ic({kind:"provided-slot",name:e,tags:r||[],isRequired:!t,isSet:o,formFactor:i,handles:s})},wr=function(e){return ic({kind:"particle-provided-slot-handle",handle:e})},br=function(e,t){t=rc(t,nc,[]);const n=[];return e&&n.push(e),t.filter(e=>"pattern"===e.name).forEach(e=>n.push(e)),t=t.filter(e=>"pattern"!==e.name),{kind:"description",location:ko(),description:[{kind:"default-description?",location:ko(),name:"pattern",patterns:n},...t]}},Sr=function(e,t){return ic({kind:"handle-description",name:e,pattern:t})},Cr="recipe",Er=Ro("recipe",!1),kr=function(e,t,n){return t=rc(t,e=>e[1],[]),ic({kind:"recipe",name:rc(e,e=>e[1],null),verbs:t,items:rc(n,nc,[])})},xr="as",Tr=Ro("as",!1),Rr=/^[a-zA-Z0-9]/,Ir=Io([["a","z"],["A","Z"],["0","9"]],!1,!1),Or=function(){xo("lower identifier")},Nr=function(e,t,n){const r=[],i=[];if(n){n=nc(n);for(const e of n)"handle-connection"===e.kind?r.push(e):i.push(e)}return ic({kind:"recipe-particle",name:rc(t,e=>e[1],null),ref:e,connections:r,slotConnections:i})},Pr=function(e,t,n,r){return oc(13),ic({kind:"handle-connection",param:e||"*",dir:t,target:rc(n,e=>e[1],null),dependentConnections:rc(r,nc,[])})},Ar=function(e,t,n){return oc(13),ic({kind:"handle-connection",param:e||"*",dir:"any",target:t,dependentConnections:rc(n,nc,[])})},Mr=function(e,t,n,r){return sc(14),ic({kind:"handle-connection",param:e,dir:T(t),target:rc(n,e=>e[1],null),dependentConnections:rc(r,nc,[])})},Dr=function(e,t){let n=null,r=null;return(e=rc(e,e=>e,null))&&(e[0].toUpperCase()===e[0]?r=e:n=e),ic({kind:"handle-connection-components",name:n,particle:r,tags:rc(t,e=>e[1],[])})},Fr=function(e){return ic({kind:"handle-connection-components",name:null,particle:null,tags:e})},jr=function(e,t,n,r){return sc(15),ic({kind:"slot-connection",direction:e,param:t.param,tags:t.tags,name:rc(n,e=>e[1],null),dependentSlotConnections:rc(r,nc,[])})},$r=function(e,t,n,r,i){return oc(16),ic({kind:"slot-connection",direction:t,param:e,tags:r||[],name:rc(n,e=>e[1],null),dependentSlotConnections:rc(i,nc,[])})},Br=function(e,t){return ic({kind:"slot-connection-ref",param:e,tags:t||[]})},Lr=function(){return"provide"},Ur=function(){return"consume"},Hr=function(e,t,n){const r=ic({kind:"connection-target",targetType:"localName",name:void 0,param:"*",tags:[]});return oc(17),ic({kind:"connection",direction:rc(t,e=>e[0],"any"),from:e||r,to:n})},zr=function(e){return e},qr=function(e,t,n){return sc(18),ic({kind:"connection",direction:T(t),from:e,to:n})},Wr="search",Vr=Ro("search",!1),Kr="tokens",Qr=Ro("tokens",!1),Gr=function(e,t){return ic({kind:"search",phrase:e,tokens:rc(t,e=>e[1][2].map(e=>e[1]),null)})},Zr=function(e,t){const{param:n,tags:r}=t||{param:null,tags:[]};return ic({kind:"connection-target",targetType:"verb",verbs:e,param:n,tags:r})},Yr=function(e){return ic({kind:"connection-target",targetType:"tag",tags:e})},Xr=function(e,t){const{param:n,tags:r}=t||{param:null,tags:[]};return ic({kind:"connection-target",targetType:"localName",name:e,param:n,tags:r})},Jr=function(e,t){const{param:n,tags:r}=t||{param:null,tags:[]};return ic({kind:"connection-target",targetType:"particle",particle:e,param:n,tags:r})},ei=".",ti=Ro(".",!1),ni=function(e,t){return ic({kind:"connection-target-handle-components",param:rc(e,e=>e,null),tags:rc(t,e=>e[1],[])})},ri="use",ii=Ro("use",!1),si="map",oi=Ro("map",!1),ai="create",ci=Ro("create",!1),li="copy",hi=Ro("copy",!1),ui="`slot",di=Ro("`slot",!1),pi=function(e,t,n,r){return e&&r&&To("cannot provide both name and localName for RecipeHandle."),e&&oc(19),r&&(sc(20),e=rc(r,e=>e[1],null)),ic({kind:"handle",name:e,ref:rc(n,e=>e[1],tc()),fate:t})},fi="require",gi=Ro("require",!1),mi=function(e){return ic({kind:"require",items:nc(e)})},yi=function(e,t){return ic({kind:"requireHandle",name:rc(e,e=>e[1],null),ref:rc(t,e=>e[1],tc())})},_i="#",vi=Ro("#",!1),wi=function(e){return e},bi=function(e,t){return[e,...t&&t[1]||[]]},Si=Oo("a verb (e.g. &Verb)"),Ci="&",Ei=Ro("&",!1),ki=function(e){return e},xi=function(e){return e},Ti=function(e,t){return ic({kind:"name-and-tag-list",name:e,tags:t=rc(t,e=>e[1],[])})},Ri=function(e){return ic({kind:"name-and-tag-list",name:e,tags:[]})},Ii=function(e){return ic({kind:"name-and-tag-list",name:e[0],tags:e})},Oi=function(e){return ic({kind:"particle-ref",name:e,verbs:[],tags:[]})},Ni=function(e){return ic({kind:"particle-ref",verbs:[e],tags:[]})},Pi=function(e,t){return ic({kind:"handle-ref",id:e,tags:t||[]})},Ai=function(e,t){return ic({kind:"handle-ref",name:e,tags:t||[]})},Mi=function(e){return ic({kind:"handle-ref",tags:e||[]})},Di=function(e){return ic({kind:"handle-ref",tags:e})},Fi="slot",ji=Ro("slot",!1),$i=function(e,t){return sc(21),ic({kind:"slot",ref:rc(e,e=>e[1],tc()),name:rc(t,e=>e[1],"")})},Bi=function(e,t){return oc(22),ic({kind:"slot",ref:rc(t,e=>e[1],tc()),name:e})},Li=function(e,t){return ic({kind:"schema-inline",names:rc(e,e=>e.map(e=>e[0]).filter(e=>"*"!==e),[]),fields:rc(t,e=>[e[0],...e[1].map(e=>e[2])],[])})},Ui=function(e,t,n){return n&&e&&To("cannot provide a type using both preslandles syntax and unification syntax for SchemaInlineField."),e?(sc(23),n=rc(e,e=>e[0],null)):n&&(oc(24),n=rc(n,e=>e[2],null)),ic({kind:"schema-inline-field",name:t,type:n})},Hi="schema",zi=Ro("schema",!1),qi=function(e,t){return ic({kind:"schema",names:e.map(e=>e[1]).filter(e=>"*"!==e),parents:rc(t,e=>e,[])})},Wi="alias",Vi=Ro("alias",!1),Ki=function(e,t,n){return ic({...e,kind:"schema",items:rc(n,nc,[]),alias:t})},Qi=function(e,t){return ic({...e,kind:"schema",items:rc(t,nc,[])})},Gi="extends",Zi=Ro("extends",!1),Yi=function(e,t){return[e,...t.map(e=>e[3])]},Xi=function(e){return e.type||xo("a type (required for schema fields)"),e.kind="schema-field",ic(e)},Ji=function(e){return ic({kind:"schema-collection",schema:e})},es=function(e){return ic({kind:"schema-reference",schema:e})},ts="Text",ns=Ro("Text",!1),rs="URL",is=Ro("URL",!1),ss="Number",os=Ro("Number",!1),as="Boolean",cs=Ro("Boolean",!1),ls="Bytes",hs=Ro("Bytes",!1),us=function(e){return ic({kind:"schema-primitive",type:e})},ds=function(e,t){const n=[e];for(const e of t)n.push(e[3]);return ic({kind:"schema-union",types:n})},ps=function(e,t){const n=[e];for(const e of t)n.push(e[3]);return ic({kind:"schema-tuple",types:n})},fs=Oo("a version number (e.g. @012)"),gs=/^[^ ]/,ms=Io([" "],!0,!1),ys=function(e){return e.join("")},_s=Oo("indentation"),vs=" ",ws=Ro(" ",!1),bs=function(e){return(e=e.join("")).length>Ya.length&&(Ja.push(Ya),Ya=e,!0)},Ss=Oo("same indentation"),Cs=function(e){return(e=e.join("")).length===Ya.length||e.length<Ya.length&&(Ya=Ja.pop(),!1)},Es=Oo("same or more indentation"),ks=function(e){return(e=e.join("")).length>=Ya.length||(e.length<Ya.length?(Ya=Ja.pop(),!1):void 0)},xs=/^[^a-zA-Z0-9_]/,Ts=Io([["a","z"],["A","Z"],["0","9"],"_"],!0,!1),Rs=function(e){xo("identifier")},Is=Oo("a `backquoted string`"),Os="`",Ns=Ro("`",!1),Ps=/^[^`]/,As=Io(["`"],!0,!1),Ms=function(e){return e.join("")},Ds=Oo("an identifier (e.g. 'id')"),Fs="'",js=Ro("'",!1),$s=/^[^'\n]/,Bs=Io(["'","\n"],!0,!1),Ls=function(e){xo("' at the end of an identifier")},Us=function(e){return e.join("")},Hs=Oo("an uppercase identifier (e.g. Foo)"),zs=/^[A-Z]/,qs=Io([["A","Z"]],!1,!1),Ws=/^[a-z0-9_]/i,Vs=Io([["a","z"],["0","9"],"_"],!1,!0),Ks=Oo("a lowercase identifier (e.g. foo)"),Qs=Oo("a lowercase identifier or keyword"),Gs=/^[a-z]/,Zs=Io([["a","z"]],!1,!1),Ys=Oo("a field name (e.g. foo9)"),Xs=Oo("a name conforming to the rules of an android app name, per https://developer.android.com/guide/topics/manifest/manifest-element.html#package"),Js=Oo("a name starting with a letter and containing letters, digits and underscores"),eo=/^[a-zA-Z]/,to=Io([["a","z"],["A","Z"]],!1,!1),no=/^[a-zA-Z0-9_]/,ro=Io([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),io=function(){return Eo()},so=Oo("one or more whitespace characters"),oo=Oo("a group of new lines (and optionally comments)"),ao=/^[ ]/,co=Io([" "],!1,!1),lo="//",ho=Ro("//",!1),uo=Oo("a new line"),po="\r",fo=Ro("\r",!1),go="\n",mo=Ro("\n",!1);let yo=0,_o=0;const vo=[{line:1,column:1}];let wo,bo=0,So=[],Co=0;if(void 0!==t.startRule){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=r[t.startRule]}function Eo(){return e.substring(_o,yo)}function ko(){return Po(_o,yo)}function xo(t,n){throw n=void 0!==n?n:Po(_o,yo),Mo([Oo(t)],e.substring(_o,yo),n)}function To(e,t){throw function(e,t){return new gn(e,[],"",t)}(e,t=void 0!==t?t:Po(_o,yo))}function Ro(e,t){return{type:"literal",text:e,ignoreCase:t}}function Io(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function Oo(e){return{type:"other",description:e}}function No(t){let n,r=vo[t];if(r)return r;for(n=t-1;!vo[n];)n--;for(r={line:(r=vo[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return vo[t]=r,r}function Po(e,t){const n=No(e),r=No(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function Ao(e){yo<bo||(yo>bo&&(bo=yo,So=[]),So.push(e))}function Mo(e,t,n){return new gn(gn.buildMessage(e,t),e,t,n)}function Do(){let e,t,r,i,o,a,c,l;if(e=yo,(t=Ga())===n&&(t=null),t!==n)if((r=ja())===n&&(r=null),r!==n){for(i=[],o=yo,(a=jo())!==n&&(c=$a())!==n&&(l=Fo())!==n?o=a=[a,c,l]:(yo=o,o=n);o!==n;)i.push(o),o=yo,(a=jo())!==n&&(c=$a())!==n&&(l=Fo())!==n?o=a=[a,c,l]:(yo=o,o=n);i!==n?(_o=e,e=t=s(i)):(yo=e,e=n)}else yo=e,e=n;else yo=e,e=n;return e}function Fo(){let t;return(t=function(){let t,r,i,s,o,a,c,l,h,u,d;t=yo,e.substr(yo,6)===Cr?(r=Cr,yo+=6):(r=n,0===Co&&Ao(Er));if(r!==n)if(i=yo,(s=Qa())!==n&&(o=Ha())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n)if(s=yo,(o=Qa())!==n&&(a=xa())!==n?s=o=[o,a]:(yo=s,s=n),s===n&&(s=null),s!==n)if((o=Ga())!==n){if(a=yo,(c=ja())!==n){for(l=[],h=yo,(u=$a())!==n&&(d=ua())!==n?h=u=[u,d]:(yo=h,h=n);h!==n;)l.push(h),h=yo,(u=$a())!==n&&(d=ua())!==n?h=u=[u,d]:(yo=h,h=n);l!==n?a=c=[c,l]:(yo=a,a=n)}else yo=a,a=n;a===n&&(a=null),a!==n?(_o=t,r=kr(i,s,a),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,g;t=yo,r=yo,e.substr(yo,8)===He?(i=He,yo+=8):(i=n,0===Co&&Ao(ze));i!==n&&(s=Qa())!==n?r=i=[i,s]:(yo=r,r=n);r===n&&(r=null);if(r!==n)if(e.substr(yo,8)===qe?(i=qe,yo+=8):(i=n,0===Co&&Ao(We)),i!==n)if((s=Qa())!==n)if((o=Ha())!==n)if(a=yo,(c=Qa())!==n&&(l=xa())!==n?a=c=[c,l]:(yo=a,a=n),a===n&&(a=null),a!==n)if(c=yo,(l=Qa())!==n?(e.substr(yo,2)===M?(h=M,yo+=2):(h=n,0===Co&&Ao(D)),h!==n&&(u=Qa())!==n&&(d=Ua())!==n?c=l=[l,h,u,d]:(yo=c,c=n)):(yo=c,c=n),c===n&&(c=null),c!==n)if((l=Ga())!==n){if(h=yo,(u=ja())!==n){for(d=[],p=yo,(f=$a())!==n&&(g=zo())!==n?p=f=[f,g]:(yo=p,p=n);p!==n;)d.push(p),p=yo,(f=$a())!==n&&(g=zo())!==n?p=f=[f,g]:(yo=p,p=n);d!==n?h=u=[u,d]:(yo=h,h=n)}else yo=h,h=n;h===n&&(h=null),h!==n?((u=Ga())===n&&(u=null),u!==n?(_o=t,r=Ve(r,o,a,c,h),t=r):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o;t=yo,e.substr(yo,6)===Z?(r=Z,yo+=6):(r=n,0===Co&&Ao(Y));r!==n&&(i=Qa())!==n&&(s=Ua())!==n&&(o=Ga())!==n?(_o=t,r=X(s),t=r):(yo=t,t=n);return t}())===n&&(t=function(){let e,t,r,i,s,o,a,c,l;if(e=yo,(t=Pa())!==n)if((r=Ga())!==n){if(i=yo,(s=ja())!==n){for(o=[],a=yo,(c=$a())!==n&&(l=Aa())!==n?a=c=[c,l]:(yo=a,a=n);a!==n;)o.push(a),a=yo,(c=$a())!==n&&(l=Aa())!==n?a=c=[c,l]:(yo=a,a=n);o!==n?i=s=[s,o]:(yo=i,i=n)}else yo=i,i=n;i===n&&(i=null),i!==n?(_o=e,t=Qi(t,i),e=t):(yo=e,e=n)}else yo=e,e=n;else yo=e,e=n;return e}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;t=yo,e.substr(yo,5)===Wi?(r=Wi,yo+=5):(r=n,0===Co&&Ao(Vi));if(r!==n)if((i=Qa())!==n)if((s=Pa())!==n)if((o=Qa())!==n)if((a=function(){let t,r,i,s;t=yo,e.substr(yo,2)===xr?(r=xr,yo+=2):(r=n,0===Co&&Ao(Tr));r!==n&&(i=Qa())!==n&&(s=Ha())!==n?(_o=t,r=Ot(s),t=r):(yo=t,t=n);return t}())!==n)if((c=Ga())!==n){if(l=yo,(h=ja())!==n){for(u=[],d=yo,(p=$a())!==n&&(f=Aa())!==n?d=p=[p,f]:(yo=d,d=n);d!==n;)u.push(d),d=yo,(p=$a())!==n&&(f=Aa())!==n?d=p=[p,f]:(yo=d,d=n);u!==n?l=h=[h,u]:(yo=l,l=n)}else yo=l,l=n;l===n&&(l=null),l!==n?(_o=t,r=Ki(s,a,l),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,f,g,m,y,_,v,w,b,S,C,E;t=yo,e.substr(yo,5)===k?(r=k,yo+=5):(r=n,0===Co&&Ao(x));if(r!==n)if((i=Qa())!==n)if((s=Ha())!==n)if((o=Qa())!==n)if(e.substr(yo,2)===R?(a=R,yo+=2):(a=n,0===Co&&Ao(I)),a!==n)if((c=Qa())!==n)if((l=function(){let e;(e=Oa())===n&&(e=Xo())===n&&(e=Jo())===n&&(e=ea())===n&&(e=ia());return e}())!==n)if(h=yo,(u=Qa())!==n&&(f=Ua())!==n?h=u=[u,f]:(yo=h,h=n),h===n&&(h=null),h!==n)if(u=yo,e.substr(yo,2)===N?(f=N,yo+=2):(f=n,0===Co&&Ao(P)),f!==n&&(g=Ua())!==n?u=f=[f,g]:(yo=u,u=n),u===n&&(u=null),u!==n)if(f=yo,(g=Qa())!==n&&(m=function(){let t,r,i,s;Co++,t=yo,64===e.charCodeAt(yo)?(r=d,yo++):(r=n,0===Co&&Ao(p));if(r!==n){if(i=[],gs.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(ms)),s!==n)for(;s!==n;)i.push(s),gs.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(ms));else i=n;i!==n?(_o=t,r=ys(i),t=r):(yo=t,t=n)}else yo=t,t=n;Co--,t===n&&(r=n,0===Co&&Ao(fs));return t}())!==n?f=g=[g,m]:(yo=f,f=n),f===n&&(f=null),f!==n)if(g=yo,(m=Qa())!==n&&(y=Ea())!==n?g=m=[m,y]:(yo=g,g=n),g===n&&(g=null),g!==n)if((m=Qa())!==n)if((y=function(){let t;(t=function(){let t,r,i,s;t=yo,e.substr(yo,2)===M?(r=M,yo+=2):(r=n,0===Co&&Ao(D));r!==n&&(i=Qa())!==n&&(s=Ua())!==n?(_o=t,r=F(s),t=r):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;t=yo,e.substr(yo,2)===M?(r=M,yo+=2):(r=n,0===Co&&Ao(D));r!==n&&(i=Qa())!==n&&(s=Ha())!==n?(o=yo,(a=Qa())!==n?(e.substr(yo,2)===j?(c=j,yo+=2):(c=n,0===Co&&Ao($)),c!==n&&(l=Qa())!==n&&(h=Ua())!==n?o=a=[a,c,l,h]:(yo=o,o=n)):(yo=o,o=n),o===n&&(o=null),o!==n?(_o=t,r=B(s,o),t=r):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s;t=yo,e.substr(yo,2)===j?(r=j,yo+=2):(r=n,0===Co&&Ao($));r!==n&&(i=Qa())!==n&&(s=Ua())!==n?(_o=t,r=L(s),t=r):(yo=t,t=n);return t}());return t}())!==n)if((_=Ga())!==n){if(v=yo,(w=ja())!==n){if(b=[],S=yo,(C=$a())!==n&&(E=Lo())!==n?S=C=[C,E]:(yo=S,S=n),S!==n)for(;S!==n;)b.push(S),S=yo,(C=$a())!==n&&(E=Lo())!==n?S=C=[C,E]:(yo=S,S=n);else b=n;b!==n?v=w=[w,b]:(yo=v,v=n)}else yo=v,v=n;v===n&&(v=null),v!==n?(_o=t,r=A(s,l,h,u,f,g,y,v),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p;Co++,t=yo,e.substr(yo,9)===ee?(r=ee,yo+=9):(r=n,0===Co&&Ao(te));if(r!==n)if((i=Qa())!==n)if((s=Ha())!==n)if(o=yo,(a=Qa())===n&&(a=null),a!==n?(60===e.charCodeAt(yo)?(c=ne,yo++):(c=n,0===Co&&Ao(re)),c!==n?((l=Qa())===n&&(l=null),l!==n&&(h=function(){let t,r,i,s,o,a,c;if(t=yo,(r=ta())!==n){for(i=[],s=yo,44===e.charCodeAt(yo)?(o=Vn,yo++):(o=n,0===Co&&Ao(Kn)),o!==n&&(a=Qa())!==n&&(c=ta())!==n?s=o=[o,a,c]:(yo=s,s=n);s!==n;)i.push(s),s=yo,44===e.charCodeAt(yo)?(o=Vn,yo++):(o=n,0===Co&&Ao(Kn)),o!==n&&(a=Qa())!==n&&(c=ta())!==n?s=o=[o,a,c]:(yo=s,s=n);i!==n?(_o=t,r=Jn(r,i),t=r):(yo=t,t=n)}else yo=t,t=n;return t}())!==n?((u=Qa())===n&&(u=null),u!==n?(62===e.charCodeAt(yo)?(d=ie,yo++):(d=n,0===Co&&Ao(se)),d!==n?o=a=[a,c,l,h,u,d]:(yo=o,o=n)):(yo=o,o=n)):(yo=o,o=n)):(yo=o,o=n)):(yo=o,o=n),o===n&&(o=null),o!==n)if((a=Ga())!==n){if(c=yo,(l=ja())!==n){for(h=[],u=yo,(d=$a())!==n&&(p=Uo())!==n?u=d=[d,p]:(yo=u,u=n);u!==n;)h.push(u),u=yo,(d=$a())!==n&&(p=Uo())!==n?u=d=[d,p]:(yo=u,u=n);h!==n?c=l=[l,h]:(yo=c,c=n)}else yo=c,c=n;c===n&&(c=null),c!==n?((l=Ga())===n&&(l=null),l!==n?(_o=t,r=oe(s,o,c),t=r):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;Co--,t===n&&(r=n,0===Co&&Ao(J));return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;t=yo,e.substr(yo,4)===Ne?(r=Ne,yo+=4):(r=n,0===Co&&Ao(Pe));if(r!==n)if((i=Ga())!==n){if(s=yo,(o=ja())!==n){for(a=[],c=yo,(l=$a())!==n&&(h=Ho())!==n?c=l=[l,h]:(yo=c,c=n);c!==n;)a.push(c),c=yo,(l=$a())!==n&&(h=Ho())!==n?c=l=[l,h]:(yo=c,c=n);a!==n?s=o=[o,a]:(yo=s,s=n)}else yo=s,s=n;s===n&&(s=null),s!==n?((o=Ga())===n&&(o=null),o!==n?(_o=t,r=Ae(s),t=r):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;t=yo,e.substr(yo,8)===g?(r=g,yo+=8):(r=n,0===Co&&Ao(m));r!==n&&(i=Qa())!==n&&(s=Ha())!==n&&(o=Ga())!==n&&(a=ja())!==n&&(c=$a())!==n&&(l=function(){let t,r,i;t=yo,e.substr(yo,5)===_?(r=_,yo+=5):(r=n,0===Co&&Ao(v));r!==n&&(i=Za())!==n?(_o=t,r=w(),t=r):(yo=t,t=n);return t}())!==n&&(h=function(){let e,t,r,i,s;e=yo,t=[],r=yo,(i=Ba())!==n&&(s=Bo())!==n?r=i=[i,s]:(yo=r,r=n);if(r!==n)for(;r!==n;)t.push(r),r=yo,(i=Ba())!==n&&(s=Bo())!==n?r=i=[i,s]:(yo=r,r=n);else t=n;t!==n&&(_o=e,t=b(t));return e=t}())!==n?((u=Ga())===n&&(u=null),u!==n?(_o=t,r=y(s,h),t=r):(yo=t,t=n)):(yo=t,t=n);return t}()),t}function jo(){let t,r,i,s,a,c;for(t=yo,r=[],i=yo,(s=$a())!==n&&(a=$o())!==n&&(c=Ga())!==n?i=s=[s,a,c]:(yo=i,i=n);i!==n;)r.push(i),i=yo,(s=$a())!==n&&(a=$o())!==n&&(c=Ga())!==n?i=s=[s,a,c]:(yo=i,i=n);return r!==n?(i=yo,(s=$a())!==n&&(a=function(){let t,r,i;Co++,t=yo,64===e.charCodeAt(yo)?(r=d,yo++):(r=n,0===Co&&Ao(p));r!==n&&(i=za())!==n?(_o=t,r=f(i),t=r):(yo=t,t=n);Co--,t===n&&(r=n,0===Co&&Ao(u));return t}())!==n&&(c=Ga())!==n?i=s=[s,a,c]:(yo=i,i=n),i===n&&(i=null),i!==n?(_o=t,t=r=o(r,i)):(yo=t,t=n)):(yo=t,t=n),t}function $o(){let t,r,i,s,o,u,d,p,f,g,m;if(Co++,t=yo,e.substr(yo,8)===c?(r=c,yo+=8):(r=n,0===Co&&Ao(l)),r!==n)if((i=Ga())!==n)if((s=ja())!==n){if(o=[],u=yo,(d=Ga())===n&&(d=null),d!==n&&(p=$a())!==n&&(f=Ka())!==n&&(g=Qa())!==n&&(m=Va())!==n?u=d=[d,p,f,g,m]:(yo=u,u=n),u!==n)for(;u!==n;)o.push(u),u=yo,(d=Ga())===n&&(d=null),d!==n&&(p=$a())!==n&&(f=Ka())!==n&&(g=Qa())!==n&&(m=Va())!==n?u=d=[d,p,f,g,m]:(yo=u,u=n);else o=n;o!==n?(_o=t,t=r=h(o)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(a)),t}function Bo(){let t,r,i;for(t=yo,r=[],S.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(C));i!==n;)r.push(i),S.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(C));return r!==n&&(i=Za())!==n?(_o=t,t=r=E()):(yo=t,t=n),t}function Lo(){let t;return(t=function(){let t,r,i,s,o;t=yo,e.substr(yo,11)===U?(r=U,yo+=11):(r=n,0===Co&&Ao(H));r!==n&&(i=Qa())!==n&&(s=La())!==n&&(o=Ga())!==n?t=r=[r,i,s,o]:(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,g;t=yo,e.substr(yo,5)===z?(r=z,yo+=5):(r=n,0===Co&&Ao(q));if(r!==n)if((i=Qa())!==n)if(e.substr(yo,2)===W?(s=W,yo+=2):(s=n,0===Co&&Ao(V)),s!==n)if((o=Qa())!==n)if((a=za())!==n){for(c=[],l=yo,(h=Qa())!==n?(e.substr(yo,3)===K?(u=K,yo+=3):(u=n,0===Co&&Ao(Q)),u!==n&&(d=Qa())!==n?(e.substr(yo,2)===W?(p=W,yo+=2):(p=n,0===Co&&Ao(V)),p!==n&&(f=Qa())!==n&&(g=za())!==n?l=h=[h,u,d,p,f,g]:(yo=l,l=n)):(yo=l,l=n)):(yo=l,l=n);l!==n;)c.push(l),l=yo,(h=Qa())!==n?(e.substr(yo,3)===K?(u=K,yo+=3):(u=n,0===Co&&Ao(Q)),u!==n&&(d=Qa())!==n?(e.substr(yo,2)===W?(p=W,yo+=2):(p=n,0===Co&&Ao(V)),p!==n&&(f=Qa())!==n&&(g=za())!==n?l=h=[h,u,d,p,f,g]:(yo=l,l=n)):(yo=l,l=n)):(yo=l,l=n);c!==n&&(l=Ga())!==n?(_o=t,r=G(a,c),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}()),t}function Uo(){let t;return(t=function(){let t;(t=function(){let t,r,i,s,o,a,c;t=yo,r=yo,e.substr(yo,4)===pe?(i=pe,yo+=4):(i=n,0===Co&&Ao(fe));i!==n&&(s=Qa())!==n?r=i=[i,s]:(yo=r,r=n);r===n&&(r=null);r!==n?(e.substr(yo,7)===ge?(i=ge,yo+=7):(i=n,0===Co&&Ao(me)),i===n&&(e.substr(yo,7)===ye?(i=ye,yo+=7):(i=n,0===Co&&Ao(_e))),i!==n?(s=yo,(o=Qa())!==n?(e.substr(yo,6)===ve?(a=ve,yo+=6):(a=n,0===Co&&Ao(we)),a!==n?s=o=[o,a]:(yo=s,s=n)):(yo=s,s=n),s===n&&(s=null),s!==n?(o=yo,(a=Qa())!==n&&(c=za())!==n?o=a=[a,c]:(yo=o,o=n),o===n&&(o=null),o!==n&&(a=Ga())!==n?(_o=t,r=be(r,i,s,o),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a,c;t=yo,(r=Ko())===n&&(r=null);r!==n?(e.substr(yo,8)===Se?(i=Se,yo+=8):(i=n,0===Co&&Ao(Ce)),i===n&&(e.substr(yo,8)===Ee?(i=Ee,yo+=8):(i=n,0===Co&&Ao(ke))),i!==n?(63===e.charCodeAt(yo)?(s=xe,yo++):(s=n,0===Co&&Ao(Ie)),s===n&&(s=null),s!==n?(o=yo,(a=Qa())!==n&&(c=sa())!==n?o=a=[a,c]:(yo=o,o=n),o===n&&(o=null),o!==n&&(a=Ga())!==n?(_o=t,r=Oe(r,i,s,o),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}());return t}())===n&&(t=function(){let t;(t=function(){let e,t,r,i,s,o;e=yo,(t=Ko())!==n?((r=Go())===n&&(r=null),r!==n?(i=yo,(s=Qa())===n&&(s=null),s!==n&&(o=Yo())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n&&(s=Ga())!==n?(_o=e,t=he(t,r,i),e=t):(yo=e,e=n)):(yo=e,e=n)):(yo=e,e=n);e===n&&(e=yo,(t=Go())!==n?(r=yo,(i=Qa())===n&&(i=null),i!==n&&(s=Yo())!==n?r=i=[i,s]:(yo=r,r=n),r===n&&(r=null),r!==n&&(i=Ga())!==n?(_o=e,t=ue(t,r),e=t):(yo=e,e=n)):(yo=e,e=n),e===n&&(e=yo,t=yo,(r=Qa())===n&&(r=null),r!==n&&(i=Yo())!==n?t=r=[r,i]:(yo=t,t=n),t!==n&&(r=Ga())!==n?(_o=e,t=de(t),e=t):(yo=e,e=n)));return e}())===n&&(t=function(){let t,r,i,s,o;t=yo,r=yo,(i=Qo())!==n&&(s=Qa())!==n?r=i=[i,s]:(yo=r,r=n);r===n&&(r=null);r!==n?(i=yo,(s=Yo())!==n&&(o=Qa())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n?((s=za())===n&&(42===e.charCodeAt(yo)?(s=ae,yo++):(s=n,0===Co&&Ao(ce))),s!==n&&(o=Ga())!==n?(_o=t,r=le(r,i,s),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}());return t}()),t}function Ho(){let t;return(t=function(){let t,r,i,s,o,a,c;t=yo,e.substr(yo,10)===Be?(r=Be,yo+=10):(r=n,0===Co&&Ao(Le));r!==n?((i=Qa())===n&&(i=null),i!==n?(58===e.charCodeAt(yo)?(s=Fe,yo++):(s=n,0===Co&&Ao(je)),s!==n?((o=Qa())===n&&(o=null),o!==n&&(a=Ua())!==n&&(c=Ga())!==n?(_o=t,r=Ue(a),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a,c;t=yo,e.substr(yo,4)===Me?(r=Me,yo+=4):(r=n,0===Co&&Ao(De));r!==n?((i=Qa())===n&&(i=null),i!==n?(58===e.charCodeAt(yo)?(s=Fe,yo++):(s=n,0===Co&&Ao(je)),s!==n?((o=Qa())===n&&(o=null),o!==n&&(a=Ua())!==n&&(c=Ga())!==n?(_o=t,r=$e(a),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}()),t}function zo(){let t,r;return Co++,(t=function(){let t,r,i,s,o;t=yo,e.substr(yo,8)===er?(r=er,yo+=8):(r=n,0===Co&&Ao(tr));r!==n&&(i=Qa())!==n&&(s=Wa())!==n&&(o=Ga())!==n?(_o=t,r=nr(s),t=r):(yo=t,t=n);return t}())===n&&(t=function(){let t;(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;t=yo,(r=Ko())===n&&(r=null);if(r!==n)if(e.substr(yo,8)===Se?(i=Se,yo+=8):(i=n,0===Co&&Ao(Ce)),i!==n)if(63===e.charCodeAt(yo)?(s=xe,yo++):(s=n,0===Co&&Ao(Ie)),s===n&&(s=null),s!==n)if(o=yo,(a=Qa())!==n&&(c=sa())!==n?o=a=[a,c]:(yo=o,o=n),o===n&&(o=null),o!==n)if((a=Ta())===n&&(a=null),a!==n)if((c=Ga())!==n){if(l=yo,(h=ja())!==n){for(u=[],d=yo,(p=$a())!==n&&(f=oa())!==n?d=p=[p,f]:(yo=d,d=n);d!==n;)u.push(d),d=yo,(p=$a())!==n&&(f=oa())!==n?d=p=[p,f]:(yo=d,d=n);u!==n?l=h=[h,u]:(yo=l,l=n)}else yo=l,l=n;l===n&&(l=null),l!==n?(_o=t,r=or(r,s,o,a,l),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,g;t=yo,r=yo,e.substr(yo,4)===pe?(i=pe,yo+=4):(i=n,0===Co&&Ao(fe));i!==n&&(s=Qa())!==n?r=i=[i,s]:(yo=r,r=n);r===n&&(r=null);if(r!==n)if(e.substr(yo,7)===ge?(i=ge,yo+=7):(i=n,0===Co&&Ao(me)),i!==n)if((s=Qa())!==n)if(o=yo,e.substr(yo,6)===ve?(a=ve,yo+=6):(a=n,0===Co&&Ao(we)),a!==n&&(c=Qa())!==n?o=a=[a,c]:(yo=o,o=n),o===n&&(o=null),o!==n)if((a=za())!==n)if(c=yo,(l=Qa())!==n&&(h=Ea())!==n?c=l=[l,h]:(yo=c,c=n),c===n&&(c=null),c!==n)if((l=Ga())!==n){if(h=yo,(u=ja())!==n){for(d=[],p=yo,(f=$a())!==n&&(g=oa())!==n?p=f=[f,g]:(yo=p,p=n);p!==n;)d.push(p),p=yo,(f=$a())!==n&&(g=oa())!==n?p=f=[f,g]:(yo=p,p=n);d!==n?h=u=[u,d]:(yo=h,h=n)}else yo=h,h=n;h===n&&(h=null),h!==n?(_o=t,r=rr(r,o,a,c,h),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}());return t}())===n&&(t=la())===n&&(t=function t(){let r,i,s,o,a,c,l,h,u;r=yo;i=function(){let t;(t=function(){let t,r,i,s,o,a,c;t=yo,(r=Qo())!==n?(63===e.charCodeAt(yo)?(i=xe,yo++):(i=n,0===Co&&Ao(Ie)),i===n&&(i=null),i!==n&&(s=Qa())!==n&&(o=Yo())!==n&&(a=Qa())!==n&&(c=function(){let e,t,r,i,s;e=yo,(t=za())!==n?(r=yo,(i=Qa())!==n&&(s=Ea())!==n?r=i=[i,s]:(yo=r,r=n),r===n&&(r=null),r!==n?(_o=e,t=Ti(t,r),e=t):(yo=e,e=n)):(yo=e,e=n);e===n&&(e=yo,(t=Qa())!==n&&(r=za())!==n?(_o=e,t=Ri(r),e=t):(yo=e,e=n),e===n&&(e=yo,(t=Qa())!==n&&(r=Ea())!==n?(_o=e,t=Ii(r),e=t):(yo=e,e=n)));return e}())!==n?(_o=t,r=It(r,i,o,c),t=r):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a;t=yo,(r=Ko())===n&&(r=null);r!==n?(i=yo,(s=Go())!==n?(63===e.charCodeAt(yo)?(o=xe,yo++):(o=n,0===Co&&Ao(Ie)),o===n&&(o=null),o!==n?i=s=[s,o]:(yo=i,i=n)):(yo=i,i=n),i===n&&(i=null),i!==n&&(s=Qa())!==n&&(o=Yo())!==n?((a=Ta())===n&&(a=null),a!==n?(_o=t,r=Nt(r,i,o,a),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}());return t}();if(i!==n)if((s=Ga())!==n){if(o=yo,(a=ja())!==n){for(c=[],l=yo,(h=$a())!==n&&(u=t())!==n?l=h=[h,u]:(yo=l,l=n);l!==n;)c.push(l),l=yo,(h=$a())!==n&&(u=t())!==n?l=h=[h,u]:(yo=l,l=n);c!==n?o=a=[a,c]:(yo=o,o=n)}else yo=o,o=n;o===n&&(o=null),o!==n?(_o=r,i=Rt(i,o),r=i):(yo=r,r=n)}else yo=r,r=n;else yo=r,r=n;return r}())===n&&(t=function(){let t,r,i,s,o,a,c;t=yo,e.substr(yo,5)===z?(r=z,yo+=5):(r=n,0===Co&&Ao(q));r!==n&&(i=Qa())!==n&&(s=za())!==n&&(o=Qa())!==n&&(a=function(){let t,r,i,s,o,a,c,l;if(t=yo,(r=qo())!==n){for(i=[],s=yo,(o=Qa())!==n?(e.substr(yo,3)===K?(a=K,yo+=3):(a=n,0===Co&&Ao(Q)),a!==n&&(c=Qa())!==n&&(l=qo())!==n?s=o=[o,a,c,l]:(yo=s,s=n)):(yo=s,s=n);s!==n;)i.push(s),s=yo,(o=Qa())!==n?(e.substr(yo,3)===K?(a=K,yo+=3):(a=n,0===Co&&Ao(Q)),a!==n&&(c=Qa())!==n&&(l=qo())!==n?s=o=[o,a,c,l]:(yo=s,s=n)):(yo=s,s=n);i!==n?(_o=t,r=Ge(r,i),t=r):(yo=t,t=n)}else yo=t,t=n;return t}())!==n&&(c=Ga())!==n?(_o=t,r=Qe(s,a),t=r):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a,c;t=yo,e.substr(yo,5)===nt?(r=nt,yo+=5):(r=n,0===Co&&Ao(rt));r!==n&&(i=Qa())!==n&&(s=function(){let t,r,i,s,o;t=yo,(r=za())!==n?(i=yo,(s=Qa())!==n?(e.substr(yo,4)===st?(o=st,yo+=4):(o=n,0===Co&&Ao(ot)),o!==n?i=s=[s,o]:(yo=i,i=n)):(yo=i,i=n),i===n&&(i=null),i!==n?(_o=t,r=at(r,i),t=r):(yo=t,t=n)):(yo=t,t=n);return t}())!==n&&(o=Qa())!==n&&(a=Wo())!==n&&(c=Ga())!==n?(_o=t,r=it(s,a),t=r):(yo=t,t=n);return t}()),Co--,t===n&&(r=n,0===Co&&Ao(Ke)),t}function qo(){let t;return(t=function(){let t,r,i,s,o,a;t=yo,e.substr(yo,2)===W?(r=W,yo+=2):(r=n,0===Co&&Ao(V));r!==n&&(i=Qa())!==n?(s=yo,e.substr(yo,3)===Ze?(o=Ze,yo+=3):(o=n,0===Co&&Ao(Ye)),o!==n&&(a=Qa())!==n?s=o=[o,a]:(yo=s,s=n),s===n&&(s=null),s!==n&&(o=za())!==n?(_o=t,r=Xe(s,o),t=r):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s;t=yo,e.substr(yo,12)===Je?(r=Je,yo+=12):(r=n,0===Co&&Ao(et));r!==n&&(i=Qa())!==n&&(s=za())!==n?(_o=t,r=tt(s),t=r):(yo=t,t=n);return t}()),t}function Wo(){let t,r,i,s,o,a,c,l;if(t=yo,(r=Vo())!==n){for(i=[],s=yo,(o=Qa())!==n?(e.substr(yo,2)===ct?(a=ct,yo+=2):(a=n,0===Co&&Ao(lt)),a===n&&(e.substr(yo,3)===K?(a=K,yo+=3):(a=n,0===Co&&Ao(Q))),a!==n&&(c=Qa())!==n&&(l=Vo())!==n?s=o=[o,a,c,l]:(yo=s,s=n)):(yo=s,s=n);s!==n;)i.push(s),s=yo,(o=Qa())!==n?(e.substr(yo,2)===ct?(a=ct,yo+=2):(a=n,0===Co&&Ao(lt)),a===n&&(e.substr(yo,3)===K?(a=K,yo+=3):(a=n,0===Co&&Ao(Q))),a!==n&&(c=Qa())!==n&&(l=Vo())!==n?s=o=[o,a,c,l]:(yo=s,s=n)):(yo=s,s=n);i!==n?(_o=t,t=r=ht(r,i)):(yo=t,t=n)}else yo=t,t=n;return t}function Vo(){let t,r,i,s,o,a;return t=yo,(r=function(){let t;(t=function(){let t,r,i,s,o,a,c,l,h;t=yo,e.substr(yo,2)===W?(r=W,yo+=2):(r=n,0===Co&&Ao(V));r!==n?(i=yo,(s=Qa())!==n?(e.substr(yo,3)===Ze?(o=Ze,yo+=3):(o=n,0===Co&&Ao(Ye)),o!==n?i=s=[s,o]:(yo=i,i=n)):(yo=i,i=n),i===n&&(i=null),i!==n&&(s=Qa())!==n?(e.substr(yo,4)===yt?(o=yt,yo+=4):(o=n,0===Co&&Ao(_t)),o!==n&&(a=Qa())!==n?(e.substr(yo,6)===vt?(c=vt,yo+=6):(c=n,0===Co&&Ao(wt)),c!==n&&(l=Qa())!==n&&(h=za())!==n?(_o=t,r=bt(i,h),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;t=yo,e.substr(yo,2)===W?(r=W,yo+=2):(r=n,0===Co&&Ao(V));r!==n?(i=yo,(s=Qa())!==n?(e.substr(yo,3)===Ze?(o=Ze,yo+=3):(o=n,0===Co&&Ao(Ye)),o!==n?i=s=[s,o]:(yo=i,i=n)):(yo=i,i=n),i===n&&(i=null),i!==n&&(s=Qa())!==n?(e.substr(yo,4)===yt?(o=yt,yo+=4):(o=n,0===Co&&Ao(_t)),o!==n&&(a=Qa())!==n?(e.substr(yo,5)===k?(c=k,yo+=5):(c=n,0===Co&&Ao(x)),c!==n&&(l=Qa())!==n&&(h=function(){let e,t;e=yo,(t=Ha())!==n&&(_o=e,t=xt(t));(e=t)===n&&(e=yo,(t=Ua())!==n&&(_o=e,t=Tt(t)),e=t);return e}())!==n?(_o=t,r=kt(i,h),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;t=yo,e.substr(yo,2)===W?(r=W,yo+=2):(r=n,0===Co&&Ao(V));r!==n?(i=yo,(s=Qa())!==n?(e.substr(yo,3)===Ze?(o=Ze,yo+=3):(o=n,0===Co&&Ao(Ye)),o!==n?i=s=[s,o]:(yo=i,i=n)):(yo=i,i=n),i===n&&(i=null),i!==n&&(s=Qa())!==n?(e.substr(yo,4)===yt?(o=yt,yo+=4):(o=n,0===Co&&Ao(_t)),o!==n&&(a=Qa())!==n?(e.substr(yo,6)===St?(c=St,yo+=6):(c=n,0===Co&&Ao(Ct)),c!==n&&(l=Qa())!==n&&(h=za())!==n?(_o=t,r=Et(i,h),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o;t=yo,e.substr(yo,2)===W?(r=W,yo+=2):(r=n,0===Co&&Ao(V));r!==n?(i=yo,(s=Qa())!==n?(e.substr(yo,3)===Ze?(o=Ze,yo+=3):(o=n,0===Co&&Ao(Ye)),o!==n?i=s=[s,o]:(yo=i,i=n)):(yo=i,i=n),i===n&&(i=null),i!==n&&(s=Qa())!==n&&(o=za())!==n?(_o=t,r=mt(i,o),t=r):(yo=t,t=n)):(yo=t,t=n);return t}());return t}())!==n&&(_o=t,r=ut(r)),(t=r)===n&&(t=yo,40===e.charCodeAt(yo)?(r=dt,yo++):(r=n,0===Co&&Ao(pt)),r!==n?((i=Qa())===n&&(i=null),i!==n&&(s=Wo())!==n?((o=Qa())===n&&(o=null),o!==n?(41===e.charCodeAt(yo)?(a=ft,yo++):(a=n,0===Co&&Ao(gt)),a!==n?(_o=t,t=r=ut(s)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)),t}function Ko(){let t,r,i,s,o,a;return t=yo,r=yo,Co++,i=yo,(s=qa())!==n?((o=Qa())===n&&(o=null),o!==n?(58===e.charCodeAt(yo)?(a=Fe,yo++):(a=n,0===Co&&Ao(je)),a!==n?i=s=[s,o,a]:(yo=i,i=n)):(yo=i,i=n)):(yo=i,i=n),Co--,i!==n?(yo=r,r=void 0):r=n,r!==n&&(i=za())!==n?((s=Qa())===n&&(s=null),s!==n?(58===e.charCodeAt(yo)?(o=Fe,yo++):(o=n,0===Co&&Ao(je)),o!==n?((a=Qa())===n&&(a=null),a!==n?(_o=t,t=r=Ot(i)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n),t}function Qo(){let t,r,i,s,o;return Co++,t=yo,e.substr(yo,5)===At?(r=At,yo+=5):(r=n,0===Co&&Ao(Mt)),r===n&&(e.substr(yo,2)===M?(r=M,yo+=2):(r=n,0===Co&&Ao(D)),r===n&&(e.substr(yo,3)===Dt?(r=Dt,yo+=3):(r=n,0===Co&&Ao(Ft)),r===n&&(e.substr(yo,4)===jt?(r=jt,yo+=4):(r=n,0===Co&&Ao($t)),r===n&&(e.substr(yo,8)===Bt?(r=Bt,yo+=8):(r=n,0===Co&&Ao(Lt)),r===n&&(e.substr(yo,8)===Ut?(r=Ut,yo+=8):(r=n,0===Co&&Ao(Ht)),r===n&&(e.substr(yo,3)===zt?(r=zt,yo+=3):(r=n,0===Co&&Ao(qt)))))))),r!==n?(i=yo,Co++,Wt.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Vt)),s===n&&(s=yo,Co++,e.length>yo?(o=e.charAt(yo),yo++):(o=n,0===Co&&Ao(Kt)),Co--,o===n?s=void 0:(yo=s,s=n)),Co--,s!==n?(yo=i,i=void 0):i=n,i!==n?(_o=t,t=r=Qt()):(yo=t,t=n)):(yo=t,t=n),Co--,t===n&&(r=n,0===Co&&Ao(Pt)),t}function Go(){let t,r,i,s,o;return Co++,t=yo,r=yo,e.substr(yo,5)===Zt?(i=Zt,yo+=5):(i=n,0===Co&&Ao(Yt)),i!==n?(63===e.charCodeAt(yo)?(s=xe,yo++):(s=n,0===Co&&Ao(Ie)),s===n&&(s=null),s!==n?(e.substr(yo,7)===Xt?(o=Xt,yo+=7):(o=n,0===Co&&Ao(Jt)),o!==n?r=i=[i,s,o]:(yo=r,r=n)):(yo=r,r=n)):(yo=r,r=n),r===n&&(e.substr(yo,5)===Zt?(r=Zt,yo+=5):(r=n,0===Co&&Ao(Yt)),r===n&&(e.substr(yo,6)===en?(r=en,yo+=6):(r=n,0===Co&&Ao(tn)),r===n&&(e.substr(yo,5)===nn?(r=nn,yo+=5):(r=n,0===Co&&Ao(rn)),r===n&&(e.substr(yo,9)===sn?(r=sn,yo+=9):(r=n,0===Co&&Ao(on)),r===n&&(e.substr(yo,9)===an?(r=an,yo+=9):(r=n,0===Co&&Ao(cn))))))),r!==n?(i=yo,Co++,Wt.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Vt)),s===n&&(s=yo,Co++,e.length>yo?(o=e.charAt(yo),yo++):(o=n,0===Co&&Ao(Kt)),Co--,o===n?s=void 0:(yo=s,s=n)),Co--,s!==n?(yo=i,i=void 0):i=n,i!==n?(_o=t,t=r=ln()):(yo=t,t=n)):(yo=t,t=n),Co--,t===n&&(r=n,0===Co&&Ao(Gt)),t}function Zo(){let t,r;return Co++,e.substr(yo,3)===un?(t=un,yo+=3):(t=n,0===Co&&Ao(dn)),t===n&&(e.substr(yo,2)===pn?(t=pn,yo+=2):(t=n,0===Co&&Ao(fn)),t===n&&(e.substr(yo,2)===mn?(t=mn,yo+=2):(t=n,0===Co&&Ao(yn)),t===n&&(61===e.charCodeAt(yo)?(t=_n,yo++):(t=n,0===Co&&Ao(vn)),t===n&&(e.substr(yo,8)===Bt?(t=Bt,yo+=8):(t=n,0===Co&&Ao(Lt)),t===n&&(e.substr(yo,8)===Ut?(t=Ut,yo+=8):(t=n,0===Co&&Ao(Ht))))))),Co--,t===n&&(r=n,0===Co&&Ao(hn)),t}function Yo(){let t;return(t=ta())===n&&(t=Xo())===n&&(t=Jo())===n&&(t=ea())===n&&(t=function(){let t,r,i,s;t=yo,e.substr(yo,10)===Nn?(r=Nn,yo+=10):(r=n,0===Co&&Ao(Pn));r!==n&&(i=Yo())!==n?(62===e.charCodeAt(yo)?(s=ie,yo++):(s=n,0===Co&&Ao(se)),s!==n?(_o=t,r=An(i),t=r):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=na())===n&&(t=Oa())===n&&(t=ia()),t}function Xo(){let t,r,i,s;return t=yo,e.substr(yo,2)===wn?(r=wn,yo+=2):(r=n,0===Co&&Ao(bn)),r!==n&&(i=Yo())!==n?(93===e.charCodeAt(yo)?(s=Sn,yo++):(s=n,0===Co&&Ao(Cn)),s!==n?(_o=t,t=r=En(i)):(yo=t,t=n)):(yo=t,t=n),t}function Jo(){let t,r,i,s;return t=yo,91===e.charCodeAt(yo)?(r=kn,yo++):(r=n,0===Co&&Ao(xn)),r!==n&&(i=Yo())!==n?(93===e.charCodeAt(yo)?(s=Sn,yo++):(s=n,0===Co&&Ao(Cn)),s!==n?(_o=t,t=r=Tn(i)):(yo=t,t=n)):(yo=t,t=n),t}function ea(){let t,r,i,s;return t=yo,e.substr(yo,14)===Rn?(r=Rn,yo+=14):(r=n,0===Co&&Ao(In)),r!==n&&(i=Yo())!==n?(62===e.charCodeAt(yo)?(s=ie,yo++):(s=n,0===Co&&Ao(se)),s!==n?(_o=t,t=r=On(i)):(yo=t,t=n)):(yo=t,t=n),t}function ta(){let t,r,i,s,o,a,c,l;return Co++,t=yo,126===e.charCodeAt(yo)?(r=Dn,yo++):(r=n,0===Co&&Ao(Fn)),r!==n&&(i=za())!==n?(s=yo,(o=Qa())!==n?(e.substr(yo,4)===jn?(a=jn,yo+=4):(a=n,0===Co&&Ao($n)),a!==n&&(c=Qa())!==n&&(l=Yo())!==n?s=o=[o,a,c,l]:(yo=s,s=n)):(yo=s,s=n),s===n&&(s=null),s!==n?(_o=t,t=r=Bn(i,s)):(yo=t,t=n)):(yo=t,t=n),Co--,t===n&&(r=n,0===Co&&Ao(Mn)),t}function na(){let t,r,i,s,o,a,c,l,h,u,d,p,f;if(t=yo,e.substr(yo,4)===Ln?(r=Ln,yo+=4):(r=n,0===Co&&Ao(Un)),r!==n)if(i=yo,Co++,s=yo,Co++,e.length>yo?(o=e.charAt(yo),yo++):(o=n,0===Co&&Ao(Kt)),Co--,o===n?s=void 0:(yo=s,s=n),s===n&&(Hn.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(zn))),Co--,s!==n?(yo=i,i=void 0):i=n,i!==n){if(s=yo,(o=Qa())===n&&(o=null),o!==n)if(123===e.charCodeAt(yo)?(a=qn,yo++):(a=n,0===Co&&Ao(Wn)),a!==n){if(c=yo,(l=ra())!==n){for(h=[],u=yo,44===e.charCodeAt(yo)?(d=Vn,yo++):(d=n,0===Co&&Ao(Kn)),d!==n&&(p=Qa())!==n&&(f=ra())!==n?u=d=[d,p,f]:(yo=u,u=n);u!==n;)h.push(u),u=yo,44===e.charCodeAt(yo)?(d=Vn,yo++):(d=n,0===Co&&Ao(Kn)),d!==n&&(p=Qa())!==n&&(f=ra())!==n?u=d=[d,p,f]:(yo=u,u=n);h!==n?c=l=[l,h]:(yo=c,c=n)}else yo=c,c=n;c===n&&(c=null),c!==n?(125===e.charCodeAt(yo)?(l=Qn,yo++):(l=n,0===Co&&Ao(Gn)),l!==n?s=o=[o,a,c,l]:(yo=s,s=n)):(yo=s,s=n)}else yo=s,s=n;else yo=s,s=n;s===n&&(s=null),s!==n?(_o=t,t=r=Zn(s)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;return t}function ra(){let t,r,i,s,o,a;return t=yo,(r=Wa())!==n?((i=Qa())===n&&(i=null),i!==n?(58===e.charCodeAt(yo)?(s=Fe,yo++):(s=n,0===Co&&Ao(je)),s!==n?((o=Qa())===n&&(o=null),o!==n&&(a=za())!==n?(_o=t,t=r=Yn(r,a)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n),t}function ia(){let e,t;return e=yo,(t=Ha())!==n&&(_o=e,t=Xn(t)),e=t}function sa(){let t,r,i,s,o;return t=yo,(r=na())!==n&&(_o=t,r=ir(r)),(t=r)===n&&(t=yo,r=yo,91===e.charCodeAt(yo)?(i=kn,yo++):(i=n,0===Co&&Ao(xn)),i!==n&&(s=na())!==n?(93===e.charCodeAt(yo)?(o=Sn,yo++):(o=n,0===Co&&Ao(Cn)),o!==n?r=i=[i,s,o]:(yo=r,r=n)):(yo=r,r=n),r!==n&&(_o=t,r=sr(r)),t=r),t}function oa(){let t;return(t=aa())===n&&(t=function(){let t;(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,g;t=yo,r=yo,e.substr(yo,4)===pe?(i=pe,yo+=4):(i=n,0===Co&&Ao(fe));i!==n&&(s=Qa())!==n?r=i=[i,s]:(yo=r,r=n);r===n&&(r=null);if(r!==n)if(e.substr(yo,7)===ye?(i=ye,yo+=7):(i=n,0===Co&&Ao(_e)),i!==n)if((s=Qa())===n&&(s=null),s!==n)if(o=yo,e.substr(yo,6)===ve?(a=ve,yo+=6):(a=n,0===Co&&Ao(we)),a!==n&&(c=Qa())!==n?o=a=[a,c]:(yo=o,o=n),o===n&&(o=null),o!==n)if((a=za())!==n)if(c=yo,(l=Qa())!==n&&(h=Ea())!==n?c=l=[l,h]:(yo=c,c=n),c===n&&(c=null),c!==n)if((l=Ga())!==n){if(h=yo,(u=ja())!==n){for(d=[],p=yo,(f=$a())!==n&&(g=ca())!==n?p=f=[f,g]:(yo=p,p=n);p!==n;)d.push(p),p=yo,(f=$a())!==n&&(g=ca())!==n?p=f=[f,g]:(yo=p,p=n);d!==n?h=u=[u,d]:(yo=h,h=n)}else yo=h,h=n;h===n&&(h=null),h!==n?(_o=t,r=_r(r,o,a,c,h),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c;t=yo,(r=Ko())===n&&(r=null);r!==n?(e.substr(yo,8)===Ee?(i=Ee,yo+=8):(i=n,0===Co&&Ao(ke)),i!==n?(63===e.charCodeAt(yo)?(s=xe,yo++):(s=n,0===Co&&Ao(Ie)),s===n&&(s=null),s!==n?(o=yo,(a=Qa())!==n&&(c=sa())!==n?o=a=[a,c]:(yo=o,o=n),o===n&&(o=null),o!==n?((a=Ta())===n&&(a=null),a!==n?((c=Ga())===n&&(c=null),c!==n?(_o=t,r=vr(r,s,o,a),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}());return t}()),t}function aa(){let t,r,i,s,o;return t=yo,e.substr(yo,10)===ar?(r=ar,yo+=10):(r=n,0===Co&&Ao(cr)),r!==n&&(i=Qa())!==n?(e.substr(yo,10)===lr?(s=lr,yo+=10):(s=n,0===Co&&Ao(hr)),s===n&&(e.substr(yo,3)===ur?(s=ur,yo+=3):(s=n,0===Co&&Ao(dr)),s===n&&(e.substr(yo,6)===pr?(s=pr,yo+=6):(s=n,0===Co&&Ao(fr)),s===n&&(e.substr(yo,5)===gr?(s=gr,yo+=5):(s=n,0===Co&&Ao(mr))))),s!==n&&(o=Ga())!==n?(_o=t,t=r=yr(s)):(yo=t,t=n)):(yo=t,t=n),t}function ca(){let t;return(t=aa())===n&&(t=function(){let t,r,i,s,o;t=yo,e.substr(yo,6)===vt?(r=vt,yo+=6):(r=n,0===Co&&Ao(wt));r!==n&&(i=Qa())!==n&&(s=za())!==n&&(o=Ga())!==n?(_o=t,r=wr(s),t=r):(yo=t,t=n);return t}()),t}function la(){let t,r,i,s,o,a,c,l,h,u,d;if(t=yo,e.substr(yo,11)===U?(r=U,yo+=11):(r=n,0===Co&&Ao(H)),r!==n)if((i=Qa())!==n)if((s=La())!==n)if((o=Ga())!==n){if(a=yo,(c=ja())!==n){if(l=[],h=yo,(u=$a())!==n&&(d=ha())!==n?h=u=[u,d]:(yo=h,h=n),h!==n)for(;h!==n;)l.push(h),h=yo,(u=$a())!==n&&(d=ha())!==n?h=u=[u,d]:(yo=h,h=n);else l=n;l!==n?a=c=[c,l]:(yo=a,a=n)}else yo=a,a=n;a===n&&(a=null),a!==n?(_o=t,t=r=br(s,a)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}function ha(){let e,t,r,i,s;return e=yo,(t=za())!==n&&(r=Qa())!==n&&(i=La())!==n&&(s=Ga())!==n?(_o=e,e=t=Sr(t,i)):(yo=e,e=n),e}function ua(){let t;return(t=pa())===n&&(t=function(){let e,t,r,i,s,o,a;e=yo,(t=Ko())===n&&(t=null);t!==n&&(r=Sa())!==n?(i=yo,(s=Qa())!==n&&(o=Ra())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n?(s=yo,(o=Qa())!==n&&(a=da())!==n?s=o=[o,a]:(yo=s,s=n),s===n&&(s=null),s!==n&&(o=Ga())!==n?(_o=e,t=pi(t,r,i,s),e=t):(yo=e,e=n)):(yo=e,e=n)):(yo=e,e=n);return e}())===n&&(t=Ca())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;t=yo,e.substr(yo,7)===fi?(r=fi,yo+=7):(r=n,0===Co&&Ao(gi));if(r!==n)if((i=Ga())!==n){if(s=yo,(o=ja())!==n){for(a=[],c=yo,(l=$a())!==n?((h=pa())===n&&(h=Ca())===n&&(h=Ia()),h!==n?c=l=[l,h]:(yo=c,c=n)):(yo=c,c=n);c!==n;)a.push(c),c=yo,(l=$a())!==n?((h=pa())===n&&(h=Ca())===n&&(h=Ia()),h!==n?c=l=[l,h]:(yo=c,c=n)):(yo=c,c=n);a!==n?s=o=[o,a]:(yo=s,s=n)}else yo=s,s=n;s===n&&(s=null),s!==n?(_o=t,r=mi(s),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=Ia())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,g;t=yo,e.substr(yo,6)===Wr?(r=Wr,yo+=6):(r=n,0===Co&&Ao(Vr));if(r!==n)if((i=Qa())!==n)if((s=La())!==n)if((o=Ga())!==n){if(a=yo,(c=ja())!==n){if(l=yo,(h=$a())!==n)if(e.substr(yo,6)===Kr?(u=Kr,yo+=6):(u=n,0===Co&&Ao(Qr)),u!==n){if(d=[],p=yo,(f=Qa())!==n&&(g=La())!==n?p=f=[f,g]:(yo=p,p=n),p!==n)for(;p!==n;)d.push(p),p=yo,(f=Qa())!==n&&(g=La())!==n?p=f=[f,g]:(yo=p,p=n);else d=n;d!==n&&(p=Ga())!==n?l=h=[h,u,d,p]:(yo=l,l=n)}else yo=l,l=n;else yo=l,l=n;l!==n?a=c=[c,l]:(yo=a,a=n)}else yo=a,a=n;a===n&&(a=null),a!==n?(_o=t,r=Gr(s,a),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t;(t=function(){let t,r,i,s,o;t=yo,(r=function(){let t,r,i,s;t=yo,(r=wa())!==n?(58===e.charCodeAt(yo)?(i=Fe,yo++):(i=n,0===Co&&Ao(je)),i!==n?((s=Qa())===n&&(s=null),s!==n?(_o=t,r=zr(r),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(r=null);r!==n?(i=yo,(s=Go())!==n&&(o=Qa())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n&&(s=wa())!==n&&(o=Ga())!==n?(_o=t,r=Hr(r,i,s),t=r):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let e,t,r,i,s,o,a;e=yo,(t=wa())!==n&&(r=Qa())!==n&&(i=Zo())!==n&&(s=Qa())!==n&&(o=wa())!==n&&(a=Ga())!==n?(_o=e,t=qr(t,i,o),e=t):(yo=e,e=n);return e}());return t}())===n&&(t=la()),t}function da(){let t,r,i,s,o,a;if(t=yo,e.substr(yo,2)===xr?(r=xr,yo+=2):(r=n,0===Co&&Ao(Tr)),r!==n)if((i=Qa())!==n){if((s=za())===n){for(s=yo,o=[],Rr.test(e.charAt(yo))?(a=e.charAt(yo),yo++):(a=n,0===Co&&Ao(Ir));a!==n;)o.push(a),Rr.test(e.charAt(yo))?(a=e.charAt(yo),yo++):(a=n,0===Co&&Ao(Ir));o!==n&&(_o=s,o=Or()),s=o}s!==n?(_o=t,t=r=Ot(s)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;return t}function pa(){let t,r,i,s,o,a,c,l,h,u;if(t=yo,(r=function(){let e,t;e=yo,(t=Ha())!==n&&(_o=e,t=Oi(t));(e=t)===n&&(e=yo,(t=ka())!==n&&(_o=e,t=Ni(t)),e=t);return e}())===n&&(42===e.charCodeAt(yo)?(r=ae,yo++):(r=n,0===Co&&Ao(ce))),r!==n)if(i=yo,(s=Qa())!==n&&(o=da())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n)if((s=Ga())!==n){if(o=yo,(a=ja())!==n){for(c=[],l=yo,(h=$a())!==n&&(u=fa())!==n?l=h=[h,u]:(yo=l,l=n);l!==n;)c.push(l),l=yo,(h=$a())!==n&&(u=fa())!==n?l=h=[h,u]:(yo=l,l=n);c!==n?o=a=[a,c]:(yo=o,o=n)}else yo=o,o=n;o===n&&(o=null),o!==n?(_o=t,t=r=Nr(r,i,o)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}function fa(){let e;return(e=ya())===n&&(e=ga()),e}function ga(){let t;return(t=function(){let e,t,r,i,s,o,a,c,l,h,u;e=yo,(t=Ko())===n&&(t=null);if(t!==n)if((r=Go())!==n)if(i=yo,(s=Qa())!==n&&(o=ma())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n)if((s=Ga())!==n){if(o=yo,(a=ja())!==n){for(c=[],l=yo,(h=$a())!==n&&(u=ga())!==n?l=h=[h,u]:(yo=l,l=n);l!==n;)c.push(l),l=yo,(h=$a())!==n&&(u=ga())!==n?l=h=[h,u]:(yo=l,l=n);c!==n?o=a=[a,c]:(yo=o,o=n)}else yo=o,o=n;o===n&&(o=null),o!==n?(_o=e,t=Pr(t,r,i,o),e=t):(yo=e,e=n)}else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;if(e===n)if(e=yo,(t=Ko())===n&&(t=null),t!==n)if((r=ma())!==n)if((i=Ga())!==n){if(s=yo,(o=ja())!==n){for(a=[],c=yo,(l=$a())!==n&&(h=ga())!==n?c=l=[l,h]:(yo=c,c=n);c!==n;)a.push(c),c=yo,(l=$a())!==n&&(h=ga())!==n?c=l=[l,h]:(yo=c,c=n);a!==n?s=o=[o,a]:(yo=s,s=n)}else yo=s,s=n;s===n&&(s=null),s!==n?(_o=e,t=Ar(t,r,s),e=t):(yo=e,e=n)}else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;return e}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p;t=yo,(r=za())===n&&(42===e.charCodeAt(yo)?(r=ae,yo++):(r=n,0===Co&&Ao(ce)));if(r!==n)if((i=Qa())!==n)if((s=Zo())!==n)if(o=yo,(a=Qa())!==n&&(c=ma())!==n?o=a=[a,c]:(yo=o,o=n),o===n&&(o=null),o!==n)if((a=Ga())!==n){if(c=yo,(l=ja())!==n){for(h=[],u=yo,(d=$a())!==n&&(p=ga())!==n?u=d=[d,p]:(yo=u,u=n);u!==n;)h.push(u),u=yo,(d=$a())!==n&&(p=ga())!==n?u=d=[d,p]:(yo=u,u=n);h!==n?c=l=[l,h]:(yo=c,c=n)}else yo=c,c=n;c===n&&(c=null),c!==n?(_o=t,r=Mr(r,s,o,c),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}()),t}function ma(){let e,t,r,i,s;return e=yo,(t=Ha())===n&&(t=za()),t!==n?(r=yo,(i=Qa())!==n&&(s=Ea())!==n?r=i=[i,s]:(yo=r,r=n),r===n&&(r=null),r!==n?(_o=e,e=t=Dr(t,r)):(yo=e,e=n)):(yo=e,e=n),e===n&&(e=yo,(t=Ea())!==n&&(_o=e,t=Fr(t)),e=t),e}function ya(){let e;return(e=function(){let e,t,r,i,s,o,a,c,l,h,u,d;e=yo,(t=Ko())===n&&(t=null);if(t!==n)if((r=va())!==n)if(i=yo,(s=Qa())!==n&&(o=za())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n)if((s=Ta())===n&&(s=null),s!==n)if((o=Ga())!==n){if(a=yo,(c=ja())!==n){for(l=[],h=yo,(u=$a())!==n&&(d=ya())!==n?h=u=[u,d]:(yo=h,h=n);h!==n;)l.push(h),h=yo,(u=$a())!==n&&(d=ya())!==n?h=u=[u,d]:(yo=h,h=n);l!==n?a=c=[c,l]:(yo=a,a=n)}else yo=a,a=n;a===n&&(a=null),a!==n?(_o=e,t=$r(t,r,i,s,a),e=t):(yo=e,e=n)}else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;return e}())===n&&(e=function(){let e,t,r,i,s,o,a,c,l,h,u,d;if(e=yo,(t=_a())!==n)if((r=Qa())!==n)if((i=function(){let e,t,r;e=yo,(t=za())!==n?((r=Ta())===n&&(r=null),r!==n?(_o=e,t=Br(t,r),e=t):(yo=e,e=n)):(yo=e,e=n);return e}())!==n)if(s=yo,(o=Qa())!==n&&(a=da())!==n?s=o=[o,a]:(yo=s,s=n),s===n&&(s=null),s!==n)if((o=Ga())!==n){if(a=yo,(c=ja())!==n){for(l=[],h=yo,(u=$a())!==n&&(d=ya())!==n?h=u=[u,d]:(yo=h,h=n);h!==n;)l.push(h),h=yo,(u=$a())!==n&&(d=ya())!==n?h=u=[u,d]:(yo=h,h=n);l!==n?a=c=[c,l]:(yo=a,a=n)}else yo=a,a=n;a===n&&(a=null),a!==n?(_o=e,t=jr(t,i,s,a),e=t):(yo=e,e=n)}else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;else yo=e,e=n;return e}()),e}function _a(){let t;return e.substr(yo,7)===ye?(t=ye,yo+=7):(t=n,0===Co&&Ao(_e)),t===n&&(e.substr(yo,7)===ge?(t=ge,yo+=7):(t=n,0===Co&&Ao(me))),t}function va(){let t,r;return t=yo,e.substr(yo,8)===Ee?(r=Ee,yo+=8):(r=n,0===Co&&Ao(ke)),r!==n&&(_o=t,r=Lr()),(t=r)===n&&(t=yo,e.substr(yo,8)===Se?(r=Se,yo+=8):(r=n,0===Co&&Ao(Ce)),r!==n&&(_o=t,r=Ur()),t=r),t}function wa(){let e;return(e=function(){let e,t,r;e=yo,(t=xa())!==n?((r=ba())===n&&(r=null),r!==n?(_o=e,t=Zr(t,r),e=t):(yo=e,e=n)):(yo=e,e=n);return e}())===n&&(e=function(){let e,t;e=yo,(t=Ea())!==n&&(_o=e,t=Yr(t));return e=t}())===n&&(e=function(){let e,t,r;e=yo,(t=Ha())!==n?((r=ba())===n&&(r=null),r!==n?(_o=e,t=Jr(t,r),e=t):(yo=e,e=n)):(yo=e,e=n);return e}())===n&&(e=function(){let e,t,r;e=yo,(t=za())!==n?((r=ba())===n&&(r=null),r!==n?(_o=e,t=Xr(t,r),e=t):(yo=e,e=n)):(yo=e,e=n);return e}()),e}function ba(){let t,r,i,s,o,a;return t=yo,46===e.charCodeAt(yo)?(r=ei,yo++):(r=n,0===Co&&Ao(ti)),r!==n?((i=za())===n&&(i=null),i!==n?(s=yo,(o=Qa())===n&&(o=null),o!==n&&(a=Ea())!==n?s=o=[o,a]:(yo=s,s=n),s===n&&(s=null),s!==n?(_o=t,t=r=ni(i,s)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n),t}function Sa(){let t;return 63===e.charCodeAt(yo)?(t=xe,yo++):(t=n,0===Co&&Ao(Ie)),t===n&&(e.substr(yo,3)===ri?(t=ri,yo+=3):(t=n,0===Co&&Ao(ii)),t===n&&(e.substr(yo,3)===si?(t=si,yo+=3):(t=n,0===Co&&Ao(oi)),t===n&&(e.substr(yo,6)===ai?(t=ai,yo+=6):(t=n,0===Co&&Ao(ci)),t===n&&(e.substr(yo,4)===li?(t=li,yo+=4):(t=n,0===Co&&Ao(hi)),t===n&&(e.substr(yo,5)===ui?(t=ui,yo+=5):(t=n,0===Co&&Ao(di))))))),t}function Ca(){let t,r,i,s,o,a;return t=yo,e.substr(yo,6)===vt?(r=vt,yo+=6):(r=n,0===Co&&Ao(wt)),r!==n?(i=yo,(s=Qa())!==n&&(o=da())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n?(s=yo,(o=Qa())!==n&&(a=Ra())!==n?s=o=[o,a]:(yo=s,s=n),s===n&&(s=null),s!==n&&(o=Ga())!==n?(_o=t,t=r=yi(i,s)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n),t}function Ea(){let t,r,i,s,o;return t=yo,(r=function(){let t,r,i;return t=yo,35===e.charCodeAt(yo)?(r=_i,yo++):(r=n,0===Co&&Ao(vi)),r!==n&&(i=Ka())!==n?(_o=t,t=r=wi(i)):(yo=t,t=n),t}())!==n?(i=yo,(s=Qa())!==n&&(o=Ea())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n?(_o=t,t=r=bi(r,i)):(yo=t,t=n)):(yo=t,t=n),t}function ka(){let t,r,i;return Co++,t=yo,38===e.charCodeAt(yo)?(r=Ci,yo++):(r=n,0===Co&&Ao(Ei)),r!==n&&(i=Ka())!==n?(_o=t,t=r=ki(i)):(yo=t,t=n),Co--,t===n&&(r=n,0===Co&&Ao(Si)),t}function xa(){let e,t,r,i,s;return e=yo,(t=ka())!==n?(r=yo,(i=Qa())!==n&&(s=xa())!==n?r=i=[i,s]:(yo=r,r=n),r===n&&(r=null),r!==n?(_o=e,e=t=bi(t,r)):(yo=e,e=n)):(yo=e,e=n),e}function Ta(){let e,t,r;return e=yo,(t=Qa())!==n&&(r=Ea())!==n?(_o=e,e=t=xi(r)):(yo=e,e=n),e}function Ra(){let t,r,i;return t=yo,(r=Ua())!==n?((i=Ta())===n&&(i=null),i!==n?(_o=t,t=r=Pi(r,i)):(yo=t,t=n)):(yo=t,t=n),t===n&&(t=yo,(r=Ha())!==n?((i=Ta())===n&&(i=null),i!==n?(_o=t,t=r=Ai(r,i)):(yo=t,t=n)):(yo=t,t=n),t===n&&(t=yo,42===e.charCodeAt(yo)?(r=ae,yo++):(r=n,0===Co&&Ao(ce)),r!==n?((i=Ta())===n&&(i=null),i!==n?(_o=t,t=r=Mi(i)):(yo=t,t=n)):(yo=t,t=n),t===n&&(t=yo,(r=Ea())!==n&&(_o=t,r=Di(r)),t=r))),t}function Ia(){let t;return(t=function(){let t,r,i,s,o,a;t=yo,e.substr(yo,4)===Fi?(r=Fi,yo+=4):(r=n,0===Co&&Ao(ji));r!==n?(i=yo,(s=Qa())!==n&&(o=Ra())!==n?i=s=[s,o]:(yo=i,i=n),i===n&&(i=null),i!==n?(s=yo,(o=Qa())!==n&&(a=da())!==n?s=o=[o,a]:(yo=s,s=n),s===n&&(s=null),s!==n&&(o=Ga())!==n?(_o=t,r=$i(i,s),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}())===n&&(t=function(){let t,r,i,s,o,a;t=yo,(r=Ko())===n&&(r=null);r!==n?(e.substr(yo,4)===Fi?(i=Fi,yo+=4):(i=n,0===Co&&Ao(ji)),i!==n?(s=yo,(o=Qa())!==n&&(a=Ra())!==n?s=o=[o,a]:(yo=s,s=n),s===n&&(s=null),s!==n&&(o=Ga())!==n?(_o=t,r=Bi(r,s),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n);return t}()),t}function Oa(){let t,r,i,s,o,a,c,l,h,u,d;if(t=yo,r=[],i=yo,(s=Ha())===n&&(42===e.charCodeAt(yo)?(s=ae,yo++):(s=n,0===Co&&Ao(ce))),s!==n&&(o=Qa())!==n?i=s=[s,o]:(yo=i,i=n),i!==n)for(;i!==n;)r.push(i),i=yo,(s=Ha())===n&&(42===e.charCodeAt(yo)?(s=ae,yo++):(s=n,0===Co&&Ao(ce))),s!==n&&(o=Qa())!==n?i=s=[s,o]:(yo=i,i=n);else r=n;if(r!==n)if(123===e.charCodeAt(yo)?(i=qn,yo++):(i=n,0===Co&&Ao(Wn)),i!==n)if((s=Qa())===n&&(s=null),s!==n){if(o=yo,(a=Na())!==n){for(c=[],l=yo,44===e.charCodeAt(yo)?(h=Vn,yo++):(h=n,0===Co&&Ao(Kn)),h!==n?((u=Qa())===n&&(u=null),u!==n&&(d=Na())!==n?l=h=[h,u,d]:(yo=l,l=n)):(yo=l,l=n);l!==n;)c.push(l),l=yo,44===e.charCodeAt(yo)?(h=Vn,yo++):(h=n,0===Co&&Ao(Kn)),h!==n?((u=Qa())===n&&(u=null),u!==n&&(d=Na())!==n?l=h=[h,u,d]:(yo=l,l=n)):(yo=l,l=n);c!==n?o=a=[a,c]:(yo=o,o=n)}else yo=o,o=n;o===n&&(o=null),o!==n?((a=Qa())===n&&(a=null),a!==n?(125===e.charCodeAt(yo)?(c=Qn,yo++):(c=n,0===Co&&Ao(Gn)),c!==n?(_o=t,t=r=Li(r,o)):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}function Na(){let t,r,i,s,o,a,c;return t=yo,r=yo,(i=Ma())!==n&&(s=Qa())!==n?r=i=[i,s]:(yo=r,r=n),r===n&&(r=null),r!==n&&(i=Wa())!==n?(s=yo,58===e.charCodeAt(yo)?(o=Fe,yo++):(o=n,0===Co&&Ao(je)),o!==n?((a=Qa())===n&&(a=null),a!==n&&(c=Ma())!==n?s=o=[o,a,c]:(yo=s,s=n)):(yo=s,s=n),s===n&&(s=null),s!==n?(_o=t,t=r=Ui(r,i,s)):(yo=t,t=n)):(yo=t,t=n),t}function Pa(){let t,r,i,s,o,a;if(t=yo,e.substr(yo,6)===Hi?(r=Hi,yo+=6):(r=n,0===Co&&Ao(zi)),r!==n){if(i=[],s=yo,(o=Qa())!==n?(42===e.charCodeAt(yo)?(a=ae,yo++):(a=n,0===Co&&Ao(ce)),a===n&&(a=Ha()),a!==n?s=o=[o,a]:(yo=s,s=n)):(yo=s,s=n),s!==n)for(;s!==n;)i.push(s),s=yo,(o=Qa())!==n?(42===e.charCodeAt(yo)?(a=ae,yo++):(a=n,0===Co&&Ao(ce)),a===n&&(a=Ha()),a!==n?s=o=[o,a]:(yo=s,s=n)):(yo=s,s=n);else i=n;i!==n?((s=function(){let t,r,i,s,o,a,c,l,h,u,d;if(t=yo,(r=Qa())!==n)if(e.substr(yo,7)===Gi?(i=Gi,yo+=7):(i=n,0===Co&&Ao(Zi)),i!==n)if((s=Qa())!==n)if((o=Ha())!==n){for(a=[],c=yo,(l=Qa())===n&&(l=null),l!==n?(44===e.charCodeAt(yo)?(h=Vn,yo++):(h=n,0===Co&&Ao(Kn)),h!==n&&(u=Qa())!==n&&(d=Ha())!==n?c=l=[l,h,u,d]:(yo=c,c=n)):(yo=c,c=n);c!==n;)a.push(c),c=yo,(l=Qa())===n&&(l=null),l!==n?(44===e.charCodeAt(yo)?(h=Vn,yo++):(h=n,0===Co&&Ao(Kn)),h!==n&&(u=Qa())!==n&&(d=Ha())!==n?c=l=[l,h,u,d]:(yo=c,c=n)):(yo=c,c=n);a!==n?(_o=t,r=Yi(o,a),t=r):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(s=null),s!==n?(_o=t,t=r=qi(i,s)):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;return t}function Aa(){let e;return(e=function(){let e,t,r;e=yo,(t=Na())!==n&&(r=Ga())!==n?(_o=e,t=Xi(t),e=t):(yo=e,e=n);return e}())===n&&(e=la()),e}function Ma(){let t;return(t=Da())===n&&(t=function(){let t,r,i,s,o,a;t=yo,91===e.charCodeAt(yo)?(r=kn,yo++):(r=n,0===Co&&Ao(xn));if(r!==n){for(i=[],s=Qa();s!==n;)i.push(s),s=Qa();if(i!==n)if((s=Da())!==n){for(o=[],a=Qa();a!==n;)o.push(a),a=Qa();o!==n?(93===e.charCodeAt(yo)?(a=Sn,yo++):(a=n,0===Co&&Ao(Cn)),a!==n?(_o=t,r=Ji(s),t=r):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n}else yo=t,t=n;return t}())===n&&(t=Fa())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;t=yo,40===e.charCodeAt(yo)?(r=dt,yo++):(r=n,0===Co&&Ao(pt));if(r!==n)if((i=Qa())===n&&(i=null),i!==n)if((s=Fa())!==n){if(o=[],a=yo,(c=Qa())!==n?(e.substr(yo,2)===ct?(l=ct,yo+=2):(l=n,0===Co&&Ao(lt)),l!==n&&(h=Qa())!==n&&(u=Fa())!==n?a=c=[c,l,h,u]:(yo=a,a=n)):(yo=a,a=n),a!==n)for(;a!==n;)o.push(a),a=yo,(c=Qa())!==n?(e.substr(yo,2)===ct?(l=ct,yo+=2):(l=n,0===Co&&Ao(lt)),l!==n&&(h=Qa())!==n&&(u=Fa())!==n?a=c=[c,l,h,u]:(yo=a,a=n)):(yo=a,a=n);else o=n;o!==n?((a=Qa())===n&&(a=null),a!==n?(41===e.charCodeAt(yo)?(c=ft,yo++):(c=n,0===Co&&Ao(gt)),c!==n?(_o=t,r=ds(s,o),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;t=yo,40===e.charCodeAt(yo)?(r=dt,yo++):(r=n,0===Co&&Ao(pt));if(r!==n)if((i=Qa())===n&&(i=null),i!==n)if((s=Fa())!==n){for(o=[],a=yo,(c=Qa())===n&&(c=null),c!==n?(44===e.charCodeAt(yo)?(l=Vn,yo++):(l=n,0===Co&&Ao(Kn)),l!==n?((h=Qa())===n&&(h=null),h!==n&&(u=Fa())!==n?a=c=[c,l,h,u]:(yo=a,a=n)):(yo=a,a=n)):(yo=a,a=n);a!==n;)o.push(a),a=yo,(c=Qa())===n&&(c=null),c!==n?(44===e.charCodeAt(yo)?(l=Vn,yo++):(l=n,0===Co&&Ao(Kn)),l!==n?((h=Qa())===n&&(h=null),h!==n&&(u=Fa())!==n?a=c=[c,l,h,u]:(yo=a,a=n)):(yo=a,a=n)):(yo=a,a=n);o!==n?((a=Qa())===n&&(a=null),a!==n?(41===e.charCodeAt(yo)?(c=ft,yo++):(c=n,0===Co&&Ao(gt)),c!==n?(_o=t,r=ps(s,o),t=r):(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;else yo=t,t=n;return t}()),t}function Da(){let t,r,i,s,o,a;if(t=yo,e.substr(yo,10)===Nn?(r=Nn,yo+=10):(r=n,0===Co&&Ao(Pn)),r!==n){for(i=[],s=Qa();s!==n;)i.push(s),s=Qa();if(i!==n)if((s=Oa())===n&&(s=ia()),s!==n){for(o=[],a=Qa();a!==n;)o.push(a),a=Qa();o!==n?(62===e.charCodeAt(yo)?(a=ie,yo++):(a=n,0===Co&&Ao(se)),a!==n?(_o=t,t=r=es(s)):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n}else yo=t,t=n;return t}function Fa(){let t,r;return t=yo,e.substr(yo,4)===ts?(r=ts,yo+=4):(r=n,0===Co&&Ao(ns)),r===n&&(e.substr(yo,3)===rs?(r=rs,yo+=3):(r=n,0===Co&&Ao(is)),r===n&&(e.substr(yo,6)===ss?(r=ss,yo+=6):(r=n,0===Co&&Ao(os)),r===n&&(e.substr(yo,7)===as?(r=as,yo+=7):(r=n,0===Co&&Ao(cs)),r===n&&(e.substr(yo,5)===ls?(r=ls,yo+=5):(r=n,0===Co&&Ao(hs)))))),r!==n&&(_o=t,r=us(r)),t=r}function ja(){let t,r,i,s;if(Co++,t=yo,Co++,r=yo,i=[],32===e.charCodeAt(yo)?(s=vs,yo++):(s=n,0===Co&&Ao(ws)),s!==n)for(;s!==n;)i.push(s),32===e.charCodeAt(yo)?(s=vs,yo++):(s=n,0===Co&&Ao(ws));else i=n;return i!==n?(_o=yo,(s=(s=bs(i))?void 0:n)!==n?r=i=[i,s]:(yo=r,r=n)):(yo=r,r=n),Co--,r!==n?(yo=t,t=void 0):t=n,Co--,t===n&&(r=n,0===Co&&Ao(_s)),t}function $a(){let t,r,i,s,o;for(Co++,t=yo,r=yo,Co++,i=yo,s=[],32===e.charCodeAt(yo)?(o=vs,yo++):(o=n,0===Co&&Ao(ws));o!==n;)s.push(o),32===e.charCodeAt(yo)?(o=vs,yo++):(o=n,0===Co&&Ao(ws));if(s!==n?(_o=yo,(o=(o=Cs(s))?void 0:n)!==n?i=s=[s,o]:(yo=i,i=n)):(yo=i,i=n),Co--,i!==n?(yo=r,r=void 0):r=n,r!==n){for(i=[],32===e.charCodeAt(yo)?(s=vs,yo++):(s=n,0===Co&&Ao(ws));s!==n;)i.push(s),32===e.charCodeAt(yo)?(s=vs,yo++):(s=n,0===Co&&Ao(ws));i!==n?t=r=[r,i]:(yo=t,t=n)}else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(Ss)),t}function Ba(){let t,r,i,s,o;for(Co++,t=yo,r=yo,Co++,i=yo,s=[],32===e.charCodeAt(yo)?(o=vs,yo++):(o=n,0===Co&&Ao(ws));o!==n;)s.push(o),32===e.charCodeAt(yo)?(o=vs,yo++):(o=n,0===Co&&Ao(ws));if(s!==n?(_o=yo,(o=(o=ks(s))?void 0:n)!==n?i=s=[s,o]:(yo=i,i=n)):(yo=i,i=n),Co--,i!==n?(yo=r,r=void 0):r=n,r!==n){for(i=[],32===e.charCodeAt(yo)?(s=vs,yo++):(s=n,0===Co&&Ao(ws));s!==n;)i.push(s),32===e.charCodeAt(yo)?(s=vs,yo++):(s=n,0===Co&&Ao(ws));i!==n?(_o=t,t=r=E()):(yo=t,t=n)}else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(Es)),t}function La(){let t,r,i,s;if(Co++,t=yo,96===e.charCodeAt(yo)?(r=Os,yo++):(r=n,0===Co&&Ao(Ns)),r!==n){if(i=[],Ps.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(As)),s!==n)for(;s!==n;)i.push(s),Ps.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(As));else i=n;i!==n?(96===e.charCodeAt(yo)?(s=Os,yo++):(s=n,0===Co&&Ao(Ns)),s!==n?(_o=t,t=r=Ms(i)):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(Is)),t}function Ua(){let t,r,i,s,o;if(Co++,t=yo,39===e.charCodeAt(yo)?(r=Fs,yo++):(r=n,0===Co&&Ao(js)),r!==n){if(i=[],$s.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Bs)),s!==n)for(;s!==n;)i.push(s),$s.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Bs));else i=n;i!==n?(39===e.charCodeAt(yo)?(s=Fs,yo++):(s=n,0===Co&&Ao(js)),s===n&&(s=yo,e.length>yo?(o=e.charAt(yo),yo++):(o=n,0===Co&&Ao(Kt)),o!==n&&(_o=s,o=Ls(i)),s=o),s!==n?(_o=t,t=r=Us(i)):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(Ds)),t}function Ha(){let t,r,i,s;if(Co++,t=yo,zs.test(e.charAt(yo))?(r=e.charAt(yo),yo++):(r=n,0===Co&&Ao(qs)),r!==n){for(i=[],Ws.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Vs));s!==n;)i.push(s),Ws.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Vs));i!==n?(_o=t,t=r=E()):(yo=t,t=n)}else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(Hs)),t}function za(){let t,r,i;return Co++,t=yo,r=yo,Co++,i=function(){let t,r,i,s;return t=yo,(r=Zo())===n&&(r=Qo())===n&&(r=Go())===n&&(r=va())===n&&(r=_a())===n&&(r=Sa())===n&&(e.substr(yo,8)===qe?(r=qe,yo+=8):(r=n,0===Co&&Ao(We)),r===n&&(e.substr(yo,6)===Cr?(r=Cr,yo+=6):(r=n,0===Co&&Ao(Er)),r===n&&(e.substr(yo,6)===Z?(r=Z,yo+=6):(r=n,0===Co&&Ao(Y)),r===n&&(e.substr(yo,2)===M?(r=M,yo+=2):(r=n,0===Co&&Ao(D)),r===n&&(e.substr(yo,9)===ee?(r=ee,yo+=9):(r=n,0===Co&&Ao(te)),r===n&&(e.substr(yo,6)===Hi?(r=Hi,yo+=6):(r=n,0===Co&&Ao(zi)),r===n&&(e.substr(yo,7)===fi?(r=fi,yo+=7):(r=n,0===Co&&Ao(gi)),r===n&&(e.substr(yo,6)===vt?(r=vt,yo+=6):(r=n,0===Co&&Ao(wt)),r===n&&(e.substr(yo,8)===He?(r=He,yo+=8):(r=n,0===Co&&Ao(ze))))))))))),r!==n?(xs.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(Ts)),i===n&&(i=yo,Co++,e.length>yo?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Kt)),Co--,s===n?i=void 0:(yo=i,i=n)),i!==n?(_o=t,t=r=Rs(r)):(yo=t,t=n)):(yo=t,t=n),t}(),Co--,i===n?r=void 0:(yo=r,r=n),r!==n&&(i=qa())!==n?(_o=t,t=r=E()):(yo=t,t=n),Co--,t===n&&(r=n,0===Co&&Ao(Ks)),t}function qa(){let t,r,i,s,o,a;if(Co++,t=yo,Gs.test(e.charAt(yo))?(r=e.charAt(yo),yo++):(r=n,0===Co&&Ao(Zs)),r!==n){for(i=[],Ws.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Vs));s!==n;)i.push(s),Ws.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Vs));i!==n?(s=yo,Co++,xs.test(e.charAt(yo))?(o=e.charAt(yo),yo++):(o=n,0===Co&&Ao(Ts)),o===n&&(o=yo,Co++,e.length>yo?(a=e.charAt(yo),yo++):(a=n,0===Co&&Ao(Kt)),Co--,a===n?o=void 0:(yo=o,o=n)),Co--,o!==n?(yo=s,s=void 0):s=n,s!==n?(_o=t,t=r=E()):(yo=t,t=n)):(yo=t,t=n)}else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(Qs)),t}function Wa(){let t,r,i,s;if(Co++,t=yo,Gs.test(e.charAt(yo))?(r=e.charAt(yo),yo++):(r=n,0===Co&&Ao(Zs)),r!==n){for(i=[],Ws.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Vs));s!==n;)i.push(s),Ws.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Vs));i!==n?(_o=t,t=r=E()):(yo=t,t=n)}else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(Ys)),t}function Va(){let t,r,i,s,o,a,c;if(Co++,t=yo,r=yo,(i=Ka())!==n){for(s=[],o=yo,46===e.charCodeAt(yo)?(a=ei,yo++):(a=n,0===Co&&Ao(ti)),a!==n&&(c=Ka())!==n?o=a=[a,c]:(yo=o,o=n);o!==n;)s.push(o),o=yo,46===e.charCodeAt(yo)?(a=ei,yo++):(a=n,0===Co&&Ao(ti)),a!==n&&(c=Ka())!==n?o=a=[a,c]:(yo=o,o=n);s!==n?r=i=[i,s]:(yo=r,r=n)}else yo=r,r=n;return t=r!==n?e.substring(t,yo):r,Co--,t===n&&(r=n,0===Co&&Ao(Xs)),t}function Ka(){let t,r,i,s;if(Co++,t=yo,eo.test(e.charAt(yo))?(r=e.charAt(yo),yo++):(r=n,0===Co&&Ao(to)),r!==n){for(i=[],no.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(ro));s!==n;)i.push(s),no.test(e.charAt(yo))?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(ro));i!==n?(_o=t,t=r=io()):(yo=t,t=n)}else yo=t,t=n;return Co--,t===n&&(r=n,0===Co&&Ao(Js)),t}function Qa(){let t,r;if(Co++,t=[],32===e.charCodeAt(yo)?(r=vs,yo++):(r=n,0===Co&&Ao(ws)),r!==n)for(;r!==n;)t.push(r),32===e.charCodeAt(yo)?(r=vs,yo++):(r=n,0===Co&&Ao(ws));else t=n;return Co--,t===n&&(r=n,0===Co&&Ao(so)),t}function Ga(){let t,r,i,s,o;for(Co++,t=yo,r=[],ao.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(co));i!==n;)r.push(i),ao.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(co));if(r!==n?(i=yo,Co++,e.length>yo?(s=e.charAt(yo),yo++):(s=n,0===Co&&Ao(Kt)),Co--,s===n?i=void 0:(yo=i,i=n),i!==n?t=r=[r,i]:(yo=t,t=n)):(yo=t,t=n),t===n){for(t=yo,r=[],ao.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(co));i!==n;)r.push(i),ao.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(co));if(r!==n)if(e.substr(yo,2)===lo?(i=lo,yo+=2):(i=n,0===Co&&Ao(ho)),i!==n){for(s=[],S.test(e.charAt(yo))?(o=e.charAt(yo),yo++):(o=n,0===Co&&Ao(C));o!==n;)s.push(o),S.test(e.charAt(yo))?(o=e.charAt(yo),yo++):(o=n,0===Co&&Ao(C));s!==n&&(o=Ga())!==n?t=r=[r,i,s,o]:(yo=t,t=n)}else yo=t,t=n;else yo=t,t=n;if(t===n){for(t=yo,r=[],ao.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(co));i!==n;)r.push(i),ao.test(e.charAt(yo))?(i=e.charAt(yo),yo++):(i=n,0===Co&&Ao(co));r!==n&&(i=Za())!==n?((s=Ga())===n&&(s=null),s!==n?t=r=[r,i,s]:(yo=t,t=n)):(yo=t,t=n)}}return Co--,t===n&&(r=n,0===Co&&Ao(oo)),t}function Za(){let t,r,i,s;return Co++,t=yo,13===e.charCodeAt(yo)?(r=po,yo++):(r=n,0===Co&&Ao(fo)),r===n&&(r=null),r!==n?(10===e.charCodeAt(yo)?(i=go,yo++):(i=n,0===Co&&Ao(mo)),i!==n?(13===e.charCodeAt(yo)?(s=po,yo++):(s=n,0===Co&&Ao(fo)),s===n&&(s=null),s!==n?t=r=[r,i,s]:(yo=t,t=n)):(yo=t,t=n)):(yo=t,t=n),Co--,t===n&&(r=n,0===Co&&Ao(uo)),t}let Ya="",Xa="";const Ja=[],ec=[],tc=()=>({kind:"handle-ref",id:null,name:null,tags:[],location:ko()});function nc(e){return e[1].map(e=>e[1])}function rc(e,t,n){if(null!==e){const n=t(e);if(null!==n)return n}return null===n?null:n}function ic(e){return{...e,location:ko()}}function sc(e){O.parseBothSyntaxes||O.defaultToPreSlandlesSyntax||To(`using pre slandles syntax (disabled by flag) #${e}`),ec.push(ko())}function oc(e){!O.parseBothSyntaxes&&O.defaultToPreSlandlesSyntax&&To(`using post slandles syntax (disabled by flag) #${e}`)}function ac(e,t,n){return oc(2),"host"===t&&To("Interface cannot have arguments with a 'host' direction."),ic({kind:"interface-argument",direction:t,type:n,name:e})}if((wo=i())!==n&&yo===e.length)return wo;throw wo!==n&&yo<e.length&&Ao({type:"end"}),Mo(So,bo<e.length?e.charAt(bo):null,bo<e.length?Po(bo,bo+1):Po(bo,bo))};var yn=n(13),_n=n.n(yn);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
async function vn(e){const t=_n.a.createHash("sha1");return t.update(e),Promise.resolve().then(()=>t.digest("hex"))}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class wn{constructor(){this.storageKey=null,this.name=null}apply(e){e.forEach(e=>{this[e.key]=e.value})}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class bn{}class Sn extends bn{constructor(e,t){super(),this.particle=e,this.connection=t}_clone(e){return new Sn(this.particle,this.connection)}_compareTo(e){let t;return 0!==(t=Ue(this.particle.name,e.particle.name))?t:0!==(t=Ue(this.connection,e.connection))?t:0}toString(e){return this.connection?`${this.particle.name}.${this.connection}`:`${this.particle.name}`}}class Cn extends bn{constructor(e,t){super(),g()(e),this.instance=e,this.connection=t}_clone(e){return new Cn(e.get(this.instance),this.connection)}_compareTo(e){let t;return 0!==(t=qe(this.instance,e.instance))?t:0!==(t=Ue(this.connection,e.connection))?t:0}toString(e){return this.connection?`${e.get(this.instance)}.${this.connection}`:`${e.get(this.instance)}`}}class En extends bn{constructor(e){super(),this.handle=e}_clone(e){return new En(this.handle)}_compareTo(e){let t;return 0!==(t=Ue(this.handle.localName,e.handle.localName))?t:0}toString(e){return`${this.handle.localName}`}}class kn extends bn{constructor(e){super(),this.tags=e}_clone(e){return new kn(this.tags)}_compareTo(e){let t;return 0!==(t=ze(this.tags,e.tags,Ue))?t:0}toString(e){return this.tags.map(e=>`#${e}`).join(" ")}}class xn{constructor(e,t,n,r){g()(n),g()(r),this.from=e,this.to=t,this.direction=n,this.type=r,Object.freeze(this)}_copyInto(e,t){if("constraint"===this.type){if(!(this.from instanceof Cn||this.to instanceof Cn))return e.newConnectionConstraint(this.from._clone(),this.to._clone(),this.direction);g()(!1,"Can't have connection constraints of type constraint with InstanceEndPoints")}return e.newObligation(this.from._clone(t),this.to._clone(t),this.direction)}_compareTo(e){let t;return 0!==(t=this.from._compareTo(e.from))?t:0!==(t=this.to._compareTo(e.to))?t:0!==(t=Ue(this.direction,e.direction))?t:0}toString(e,t){let n="";return t&&!0===t.showUnresolved&&"obligation"===this.type&&(n=" // unresolved obligation"),O.defaultToPreSlandlesSyntax?`${this.from.toString(e)} ${R(this.direction)} ${this.to.toString(e)}${n}`:`${this.from.toString(e)}: ${x(this.direction)} ${this.to.toString(e)}${n}`}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Tn(e){switch(e){case"in":return"out";case"out":return"in";case"inout":return"inout";case"`consume":return"`provide";case"`provide":return"`consume";case"any":return"any";default:throw new Error(`Bad direction ${e}`)}}function Rn(e,t){return In(e).includes(t)}function In(e){switch(e){case"any":return["any","in","out","inout","host","`consume","`provide"];case"in":return["any","in","inout","host","`consume"];case"out":return["any","out","inout","`provide"];case"inout":return["any","inout"];case"host":return["any","host"];case"`consume":return["any","`consume"];case"`provide":return["any","`provide"];default:throw new Error(`Bad direction ${e}`)}}class On{constructor(e,t,n,r){this.recipe=e,this.particles=t,this.handles=n,this.reverse=new Map;for(const e of Object.keys(t))this.reverse.set(t[e],e);for(const e of n.keys())this.reverse.set(n.get(e),e);for(const e of Object.keys(r))this.reverse.set(r[e],e)}}class Nn{static makeShape(e,t,n,r){r=r||new Dn;const i={},s=new Map,o={};return e.forEach(e=>i[e]=r.newParticle(e)),t.forEach(e=>s.set(e,r.newHandle())),Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(t=>{const r=n[e][t],a=r.tags||[];r.localName&&(s.get(r.handle).localName=r.localName);const c=i[e].addConnectionName(t);c.direction=r.direction||"any",s.get(r.handle).tags=a,c.connectToHandle(s.get(r.handle)),o[e+":"+t]=i[e].connections[t]})}),new On(r,i,s,o)}static recipeToShape(e){const t={};let n=0;e.particles.forEach(e=>t[e.name]=e);const r=new Map;e.handles.forEach(e=>r.set("h"+n++,e));const i={};return e.handleConnections.forEach(e=>i[e.particle.name+":"+e.name]=e),new On(e,t,r,i)}static _buildNewHCMatches(e,t,n,r){const{forward:i,reverse:s,score:o}=n;let a=!1;for(const n of e.particles)if(n.spec)for(const e of n.spec.handleConnections){if(s.has(e))continue;if(n.name!==t.particle.name)continue;if(t.name&&t.name!==e.name)continue;if(!Rn(t.direction,e.direction))continue;const c=n.connections[e.name];if(t.handle&&c&&c.handle&&t.handle.localName&&t.handle.localName!==c.handle.localName)continue;if(s.has(n)){if(s.get(n)!==t.particle)continue}else if(i.has(t.particle))continue;if(t.handle&&c&&c.handle){if(s.has(c.handle)){if(s.get(c.handle)!==t.handle)continue}else if(i.has(t.handle)&&null!==i.get(t.handle))continue;if("create"!==t.handle.fate||"create"!==c.handle.fate&&"create"!==c.handle.originalFate){if(Boolean(t.handle.immediateValue)!==Boolean(c.handle.immediateValue))continue;if(c.handle.immediateValue){if(!c.handle.immediateValue.equals(t.handle.immediateValue))continue}else if(t.handle.id!==c.handle.id&&t.handle.id!==c.handle.originalId)continue}}const l={forward:new Map(i),reverse:new Map(s),score:o};g()(!l.reverse.has(n)||l.reverse.get(n)===t.particle),g()(!l.forward.has(t.particle)||l.forward.get(t.particle)===n),l.forward.set(t.particle,n),l.reverse.set(n,t.particle),t.handle&&(c&&c.handle?(l.forward.set(t.handle,c.handle),l.reverse.set(c.handle,t.handle)):l.forward.has(t.handle)||(l.forward.set(t.handle,null),l.score-=2)),l.forward.set(t,e),l.reverse.set(e,t),r.push(l),a=!0}if(!1===a){if(n.forward.get(t.particle))return;const i=[];Nn._buildNewParticleMatches(e,t.particle,n,i),i.forEach(e=>{t.handle&&!e.forward.has(t.handle)&&(e.forward.set(t.handle,null),e.score-=2),e.forward.set(t,null),e.score-=1,r.push(e)})}}static _buildNewParticleMatches(e,t,n,r){const{forward:i,reverse:s,score:o}=n;let a=!1;for(const n of e.particles){if(s.has(n))continue;if(n.name!==t.name)continue;let e=!0;for(const r of Object.keys(n.connections)){const i=n.connections[r];if(!i.handle)continue;const s=t.connections[r];if(s&&s.handle&&s.handle.localName&&s.handle.localName!==i.handle.localName){e=!1;break}}if(!e)continue;const c={forward:new Map(i),reverse:new Map(s),score:o};g()(!c.forward.has(t)||c.forward.get(t)===n),g()(!c.reverse.has(n)||c.reverse.get(n)===t),c.forward.set(t,n),c.reverse.set(n,t),r.push(c),a=!0}if(!1===a){const e={forward:new Map,reverse:new Map,score:0};i.forEach((t,n)=>{g()(!e.forward.has(n)||e.forward.get(n)===t),e.forward.set(n,t)}),s.forEach((t,n)=>{g()(!e.reverse.has(n)||e.reverse.get(n)===t),e.reverse.set(n,t)}),e.forward.has(t)||(e.forward.set(t,null),e.score=n.score-1),r.push(e)}}static _assignHandlesToEmptyPosition(e,t,n,r){if(1===n.length){const e=[],{forward:i,reverse:s,score:o}=t;for(const t of r){let r=!0;for(const e of t.tags)if(!n[0].tags.includes(e)){r=!1;break}if(!r)continue;const a={forward:new Map(i),reverse:new Map(s),score:o+1};a.forward.set(t,n[0]),a.reverse.set(n[0],t),e.push(a)}return e}const i=n.pop(),s=Nn._assignHandlesToEmptyPosition(e,t,n,r);let o=[];for(const t of s){const n=[...e.handles.values()].filter(e=>null===t.forward.get(e));o=n.length>0?o.concat(Nn._assignHandlesToEmptyPosition(e,t,[i],n)):o.concat(t)}return o}static find(e,t){let n=[{forward:new Map,reverse:new Map,score:0}];for(const r of t.recipe.handleConnections){const t=[];for(const i of n)Nn._buildNewHCMatches(e,r,i,t);n=t}for(const r of t.recipe.particles){if(Object.keys(r.connections).length>0)continue;if(r.unnamedConnections.length>0)continue;const t=[];for(const i of n)Nn._buildNewParticleMatches(e,r,i,t);n=t}const r=e.handles.filter(e=>0===e.connections.length);if(r.length>0){let e=[];for(const i of n){const n=[...t.handles.values()].filter(e=>null===i.forward.get(e));e=n.length>0?e.concat(Nn._assignHandlesToEmptyPosition(t,i,r,n)):e.concat(i)}n=e}return n.map(e=>{const n={};return e.forward.forEach((e,r)=>n[t.reverse.get(r)]=e),{match:n,score:e.score}})}static constructImmediateValueHandle(e,t,n){if(g()(e.type instanceof lt),!(e.type instanceof lt&&e.type.interfaceInfo.restrictType(t)))return null;const r=e.type.clone(new Map);r.maybeEnsureResolved();const i=e.recipe.newHandle();return i.id=n.toString(),i.mappedType=r,i.fate="copy",i.immediateValue=t,i}static directionCounts(e){const t={in:0,out:0,inout:0,host:0,"`consume":0,"`provide":0,any:0};for(const n of e.connections)t[n.direction]++;return t.in+=t.inout,t.out+=t.inout,t}static matchesRecipe(e,t){const n=Nn.recipeToShape(t);return Nn.find(e,n).some(e=>0===e.score)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Pn{constructor(e,t){this._tags=[],this.resolvedType=void 0,this._direction="any",this._handle=void 0,g()(t),g()(t.recipe),this._recipe=t.recipe,this._name=e,this._particle=t}_clone(e,t){if(t.has(this))return t.get(this);const n=new Pn(this._name,e);return n._tags=[...this._tags],n.resolvedType=this.resolvedType,n._direction=this._direction,null!=this._handle&&(n._handle=t.get(this._handle),g()(void 0!==n._handle),n._handle.connections.push(n)),t.set(this,n),n}cloneTypeWithResolutions(e){this.resolvedType&&(this.resolvedType=this.resolvedType._cloneWithResolutions(e))}_normalize(){this._tags.sort(),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=qe(this._particle,e._particle))?t:0!==(t=Ue(this._name,e._name))?t:0!==(t=ze(this._tags,e._tags,Ue))?t:0!==(t=qe(this._handle,e._handle))?t:0!==(t=Ue(this._direction,e._direction))?t:0}get recipe(){return this._recipe}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get tags(){return this._tags}get type(){if(this.resolvedType)return this.resolvedType;const e=this.spec;return e?e.type:void 0}get direction(){if("any"!==this._direction)return this._direction;const e=this.spec;return e?e.direction:"any"}get isInput(){return"in"===this.direction||"inout"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}get handle(){return this._handle}get particle(){return this._particle}set tags(e){this._tags=e}set type(e){this.resolvedType=e,this._resetHandleType()}set direction(e){if(null===e)throw new Error(`Invalid direction '${e}' for handle connection '${this.getQualifiedName()}'`);this._direction=e,this._resetHandleType()}get spec(){return null==this.particle.spec?null:this.particle.spec.handleConnectionMap.get(this.name)}toSlotConnection(){if(!this.handle||"`slot"!==this.handle.fate)return;const e=new jn(this.name,this.particle);return e.tags=this.tags,e.targetSlot=this.handle&&this.handle.toSlot(),e.targetSlot.name=e.targetSlot.name||this.name,this.spec&&this.spec.dependentConnections.forEach(t=>{const n=this.particle.getConnectionByName(t.name);if(!n)return;const r=n.toSlotConnection();r&&(g()(!e.providedSlots[n.spec.name],`provided slot '${n.spec.name}' already exists`),e.providedSlots[n.spec.name]=r.targetSlot)}),e}get isOptional(){return null!=this.spec&&this.spec.isOptional}_isValid(e){if(null===this.direction||void 0===this.direction)return e&&e.errors&&e.errors.set(this,`Invalid direction '${this.direction}' for handle connection '${this.getQualifiedName()}'`),!1;if(this.particle.spec&&this.name){const t=this.spec;if(!t)return e&&e.errors&&e.errors.set(this,`Connection ${this.name} is not defined by ${this.particle.name}.`),!1;if(!In(this.direction).includes(t.direction))return e&&e.errors&&e.errors.set(this,`Direction '${this.direction}' for handle connection '${this.getQualifiedName()}' doesn't match particle spec's direction '${t.direction}'`),!1;if(this.resolvedType){if(!t.isCompatibleType(this.resolvedType))return e&&e.errors&&e.errors.set(this,`Type '${this.resolvedType.toString()} for handle connection '${this.getQualifiedName()}' doesn't match particle spec's type '${t.type.toString()}'`),!1}else this.resolvedType=t.type}return!0}isResolved(e){let t;if(g()(Object.isFrozen(this)),this.spec&&this.spec.parentConnection){if(!(t=this.particle.connections[this.spec.parentConnection.name]))return e&&(e.details=`parent connection '${this.spec.parentConnection.name}' missing`),!1;if(!t.handle)return e&&(e.details=`parent connection '${this.spec.parentConnection.name}' missing handle`),!1}return this.handle?this.direction?!!this.type||(e&&(e.details="missing type"),!1):(e&&(e.details="missing direction"),!1):!!this.isOptional||(e&&(e.details="missing handle"),!1)}_resetHandleType(){this._handle&&(this._handle._type=void 0)}connectToHandle(e){g()(e.recipe===this.recipe),this._handle=e,this._resetHandleType(),this._handle.connections.push(this)}disconnectHandle(){const e=this._handle.connections.indexOf(this);g()(e>=0),this._handle.connections.splice(e,1),this._handle=void 0}toString(e,t){const n=[];return O.defaultToPreSlandlesSyntax?(n.push(`${this.name||"*"}`),n.push(R(this.direction))):(n.push(`${this.name||"*"}:`),n.push(x(this.direction))),this.handle&&(this.handle.immediateValue?n.push(this.handle.immediateValue.name):n.push(`${e&&e.get(this.handle)||this.handle.localName}`)),n.push(...this.tags.map(e=>`#${e}`)),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved handle-connection: ${t.details}`)),n.join(" ")}findSpecsForUnnamedHandles(){return this.particle.spec.handleConnections.filter(e=>!e.isOptional&&ft.compareTypes({type:this.handle.type},{type:e.type})&&!this.particle.getConnectionByName(e.name))}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class An{constructor(e,t){this._id=void 0,this._localName=void 0,this.spec=void 0,this._verbs=[],this._tags=[],this._connections={},this._unnamedConnections=[],this._consumedSlotConnections={},g()(e),this._recipe=e,this._name=t}_copyInto(e,t,n){const r=e.newParticle(this._name);r._id=this._id,r._verbs=[...this._verbs],r._tags=[...this._tags],r.spec=this.spec?this.spec.cloneWithResolutions(n):void 0,Object.keys(this._connections).forEach(e=>{r._connections[e]=this._connections[e]._clone(r,t)}),r._unnamedConnections=this._unnamedConnections.map(e=>e._clone(r,t)),r._cloneConnectionRawTypes(n);for(const n of this.getSlotConnectionNames()){const i=this.getSlotConnectionByName(n);if(r._consumedSlotConnections[n]=i._clone(r,t),t.has(i.targetSlot)){g()(e instanceof Fn);const s=t.get(i.targetSlot);r.getSlotConnectionByName(n).connectToSlot(s),-1===r.recipe.slots.indexOf(s)&&r.recipe.slots.push(s)}for(const[s,o]of Object.entries(i.providedSlots))if(t.has(o)){g()(e instanceof Fn);const i=t.get(o);i.sourceConnection=r.getSlotConnectionByName(n),r.getSlotConnectionByName(n).providedSlots[s]=i,-1===r.recipe.slots.indexOf(i)&&r.recipe.slots.push(i)}}return r}_cloneConnectionRawTypes(e){for(const t of Object.values(this._connections))t.cloneTypeWithResolutions(e);for(const t of this._unnamedConnections)t.cloneTypeWithResolutions(e)}_startNormalize(){this._localName=null,this._verbs.sort(),this._tags.sort();const e={};for(const t of Object.keys(this._connections).sort())e[t]=this._connections[t];this._connections=e;const t={};for(const e of this.getSlotConnectionNames().sort())t[e]=this.getSlotConnectionByName(e);this._consumedSlotConnections=t}_finishNormalize(){this._unnamedConnections.sort(qe),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Ue(this._id?this._id.toString():"",e._id?e._id.toString():""))?t:0!==(t=Ue(this._name,e._name))?t:0!==(t=Ue(this._localName,e._localName))?t:0!==(t=ze(this._verbs,e._verbs,Ue))?t:0!==(t=ze(this._tags,e._tags,Ue))?t:0}matches(e){if(this.name&&e.name&&this.name!==e.name)return!1;for(const t of this.getSlotConnectionNames()){const n=this.getSlotConnectionByName(t);if(null==e.getSlotConnectionByName(t)||null==e.getSlotConnectionByName(t).targetSlot)return!1;if(n.targetSlot&&n.targetSlot.id&&n.targetSlot.id!==e.getSlotConnectionByName(t).targetSlot.id)return!1;for(const r of Object.keys(n.providedSlots)){const i=n.providedSlots[r],s=e.getSlotConnectionByName(t).providedSlots[r];if(null==s||i.id&&s.id&&i.id!==s.id)return!1}}return!0}_isValid(e){return!this.spec||(!(!this.name&&!this.primaryVerb)||(e&&e.errors&&e.errors.set(this,"Particle has no name and no verb"),!1))}isResolved(e){if(g()(Object.isFrozen(this)),!this.spec)return e&&e.showUnresolved&&(e.details="missing spec"),!1;if(0===Object.values(this.connections).filter(e=>Boolean(e.type.slandleType())).length&&this.spec.slotConnections.size>0){if(0===this.getSlotConnections().filter(e=>void 0!==e.targetSlot).length)return e&&e.showUnresolved&&(e.details=`unfulfilled slot connections ${JSON.stringify([...this.spec.slotConnections])}`),!1}if(!this.spec)return e&&e.showUnresolved&&(e.details="missing spec"),!1;const t=this.getUnboundConnections().filter(e=>{let t=e.parentConnection;for(;null!==t;){if(!this.connections[t.name])return!1;t=t.parentConnection}return!0});return t.length>0?(e&&e.showUnresolved&&(e.details=`unresolved connections: ${t.map(e=>e.name).join(", ")}`),!1):0===this.unnamedConnections.length||(e&&e.showUnresolved&&(e.details=`${this.unnamedConnections.length} unnamed connections`),!1)}get recipe(){return this._recipe}get localName(){return this._localName}set localName(e){this._localName=e}get id(){return this._id}set id(e){g()(!this._id,"Particle ID can only be set once."),this._id=e}get name(){return this._name}set name(e){this._name=e}get connections(){return this._connections}get unnamedConnections(){return this._unnamedConnections}get primaryVerb(){return this._verbs.length>0?this._verbs[0]:void 0}set verbs(e){this._verbs=e}set tags(e){this._tags=e}addUnnamedConnection(){const e=new Pn(void 0,this);return this._unnamedConnections.push(e),e}addConnectionName(e){return g()(e,"Cannot create connection with no name"),g()(null==this._connections[e]),this._connections[e]=new Pn(e,this),this._connections[e]}allConnections(){return Object.values(this._connections).concat(this._unnamedConnections)}ensureConnectionName(e){return this._connections[e]||this.addConnectionName(e)}getSlotConnectionNames(){return Object.keys(this._consumedSlotConnections)}getSlandleConnectionByName(e){if(e in this._connections){return this._connections[e].toSlotConnection()}return this._consumedSlotConnections[e]}getSlandleConnectionBySpec(e){return this.getSlandleConnections().find(t=>t.getSlotSpec()===e)}getSlotConnectionByName(e){return this._consumedSlotConnections[e]}getSlotConnectionBySpec(e){return this.getSlotConnections().find(t=>t.getSlotSpec()===e)}getSlandleConnections(){return[...Object.values(this._consumedSlotConnections),...this.allConnections().map(e=>"`consume"===e.direction&&e.toSlotConnection()).filter(e=>e)]}getSlotConnections(){return Object.values(this._consumedSlotConnections)}getSlotSpecByName(e){if(!this.spec)return;const t=this.spec.slotConnections.get(e);if(t)return t;for(const t of this.spec.slotConnections.values())for(const n of t.provideSlotConnections)if(n.name===e)return n}getProvidedSlotByName(e,t){const n=this.getSlotConnectionByName(e);return n&&n.providedSlots[t]}getSlotSpecs(){return this.spec?this.spec.slotConnections:new Map}getConnectionByName(e){return this._connections[e]}nameConnection(e,t){g()(!this._connections[t],`Connection "${t}" already has a handle`);const n=this._unnamedConnections.indexOf(e);g()(n>=0,`Cannot name '${t}' nonexistent unnamed connection.`),e._name=t;const r=this.spec.getConnectionByName(t);e.type=r.type,e.direction!==r.direction&&(g()("inout"===e.direction,`Unnamed connection cannot adjust direction ${e.direction} to ${t}'s direction ${r.direction}`),e.direction=r.direction),this._connections[t]=e,this._unnamedConnections.splice(n,1)}getUnboundConnections(e){return this.spec.handleConnections.filter(t=>!t.isOptional&&!this.getConnectionByName(t.name)&&(!e||ft.compareTypes({type:e},{type:t.type})))}addSlotConnection(e){g()(!this.getSlotConnectionByName(e),"slot connection already exists");const t=this.spec&&this.spec.connections.find(t=>t.name===e),n=t&&t.type.isSlot(),r=t&&t.type.isCollectionType()&&t.type.getContainedType().isSlot();g()(!this.spec||this.spec.slotConnections.has(e)||n||r,`slot connection '${e}' is not in particle spec`);const i=this.addSlotConnectionAsCopy(e),s=this.getSlotSpecByName(e);return s&&s.provideSlotConnections.forEach(e=>{const t=this.recipe.newSlot(e.name);t.sourceConnection=i,i.providedSlots[e.name]=t}),i}addSlotConnectionAsCopy(e){const t=new jn(e,this);return this._consumedSlotConnections[e]=t,t}removeSlotConnection(e){this._consumedSlotConnections[e.name]=null,e.disconnectFromSlot()}remove(){this.recipe.removeParticle(this)}isExternalParticle(){return this.spec&&this.spec.external}toString(e={},t){let n=[];this.name?(n.push(this.name),n.push(`as ${t&&t.get(this)||this.localName}`),this.primaryVerb&&this.primaryVerb!==this.name&&n.push(`// verb=${this.primaryVerb}`)):n.push(`&${this.primaryVerb}`),e.showUnresolved&&(this.isResolved(e)||n.push(`// unresolved particle: ${e.details}`)),n=[n.join(" ")];for(const r of this.unnamedConnections)n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const r of Object.values(this.connections))n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const r of this.getSlotConnections())n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));return n.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Mn{constructor(e,t){g()(e),this._phrase=e;const n=this.phrase.toLowerCase().split(/[^a-z0-9]/g);this._unresolvedTokens=[],(t||n).forEach(e=>this._unresolvedTokens.push(e)),this._resolvedTokens=n.slice();for(const e of this.unresolvedTokens){const t=this._resolvedTokens.indexOf(e);t>=0&&this._resolvedTokens.splice(t,1)}g()(n.length===this.unresolvedTokens.length+this.resolvedTokens.length)}_append(e,t,n){this._phrase.length>0&&(this._phrase=this.phrase.concat(" ")),this._phrase=this._phrase.concat(e),n.forEach(e=>this._resolvedTokens.push(e)),t.forEach(e=>this._unresolvedTokens.push(e))}get phrase(){return this._phrase}get unresolvedTokens(){return this._unresolvedTokens}get resolvedTokens(){return this._resolvedTokens}resolveToken(e){const t=this.unresolvedTokens.indexOf(e.toLowerCase());g()(t>=0,`Cannot resolved nonexistent token ${e}`),this._unresolvedTokens.splice(t,1),this._resolvedTokens.push(e.toLowerCase())}isValid(){return this._unresolvedTokens.length>0||this._resolvedTokens.length>0}isResolved(){return g()(Object.isFrozen(this)),this._resolvedTokens.length>0}_normalize(){this._unresolvedTokens.sort(),this._resolvedTokens.sort(),Object.freeze(this)}_copyInto(e){return e.search?e.search._append(this.phrase,this.unresolvedTokens,this.resolvedTokens):(e.search=new Mn(this.phrase,this.unresolvedTokens),g()(e.search.resolvedTokens.length===this.resolvedTokens.length,`${e.search.resolvedTokens} is not same as ${this.resolvedTokens}`)),g()(this.resolvedTokens.every(t=>e.search.resolvedTokens.indexOf(t)>=0)&&this.unresolvedTokens.every(t=>e.search.unresolvedTokens.indexOf(t)>=0)),e.search}toString(e){const t=[];t.push(`search \`${this.phrase}\``);const n=[];return n.push("  tokens"),this.unresolvedTokens.length>0&&n.push(this.unresolvedTokens.map(e=>`\`${e}\``).join(" ")),this.resolvedTokens.length>0&&n.push(`// ${this.resolvedTokens.map(e=>`\`${e}\``).join(" ")}`),e&&e.showUnresolved&&this.unresolvedTokens.length>0&&n.push("// unresolved search tokens"),t.push(n.join(" ")),t.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Dn{constructor(e){this._requires=[],this._particles=[],this._handles=[],this._slots=[],this._localName=void 0,this.annotation=void 0,this.triggers=[],this._connectionConstraints=[],this._obligations=[],this._verbs=[],this._search=null,this._patterns=[],this._name=e}newConnectionConstraint(e,t,n){const r=new xn(e,t,n,"constraint");return this._connectionConstraints.push(r),r}newObligation(e,t,n){const r=new xn(e,t,n,"obligation");return this._obligations.push(r),r}removeObligation(e){const t=this._obligations.indexOf(e);g()(t>-1),this._obligations.splice(t,1)}removeConstraint(e){const t=this._connectionConstraints.indexOf(e);g()(t>=0),this._connectionConstraints.splice(t,1)}clearConnectionConstraints(){this._connectionConstraints.length=0}newRequireSection(){const e=new Fn(this);return this._requires.push(e),e}newParticle(e){const t=new An(this,e);return this._particles.push(t),t}removeParticle(e){const t=this._particles.indexOf(e);g()(t>-1),this._particles.splice(t,1),e.getSlotConnections().forEach(e=>e.remove())}newHandle(){const e=new Bn(this);return this._handles.push(e),e}removeHandle(e){g()(0===e.connections.length);const t=this._handles.indexOf(e);g()(t>-1),this._handles.splice(t,1)}newSlot(e){const t=new $n(this,e);return this._slots.push(t),t}addSlot(e){-1===this.slots.indexOf(e)&&this.slots.push(e)}removeSlot(e){g()(0===e.consumeConnections.length);let t=this._slots.indexOf(e);g()(t>-1),this._slots.splice(t,1);for(const n of this.requires)-1!==(t=n.slots.indexOf(e))&&n.slots.splice(t,1)}isResolved(e){g()(Object.isFrozen(this),"Recipe must be normalized to be resolved.");const t=(t,n)=>(!t&&e&&e.errors&&e.errors.set(this.name,n),t);return t(0===this._obligations.length,"unresolved obligations")&&t(0===this._connectionConstraints.length,"unresolved constraints")&&t(this.requires.every(e=>e.isEmpty()),"unresolved require")&&t(null===this._search||this._search.isResolved(),"unresolved search")&&t(this._handles.every(e=>e.isResolved()),"unresolved handles")&&t(this._particles.every(t=>t.isResolved(e)),"unresolved particles")&&t(this.modality.isResolved(),"unresolved modality")&&t(this.allRequiredSlotsPresent(e),"unresolved required slot")&&t(this._slots.every(e=>e.isResolved()),"unresolved slots")&&t(this.handleConnections.every(t=>t.isResolved(e)),"unresolved handle connections")&&t(this.slotConnections.every(t=>t.isResolved(e)),"unresolved slot connections")}isCompatible(e){return this.particles.every(t=>!t.spec||t.spec.isCompatible(e))}get modality(){return k.intersection(this.particles.filter(e=>Boolean(e.spec&&e.spec.slandleConnectionNames().length>0)).map(e=>e.spec.modality))}allRequiredSlotsPresent(e){for(const t of this.particles){if(0===t.spec.slotConnections.size)continue;let n=!1,r=!1;for(const e of Object.values(t.spec.connections))e.type.slandleType()&&(r=!0);for(const[r,i]of t.spec.slotConnections){if(i.isRequired&&!t.getSlotConnectionByName(r))return e&&e.errors&&e.errors.set(r,`required slot ${r} has no matching connection`),!1;if(t.getSlotConnectionByName(r)){n=!0;for(const n of i.provideSlotConnections)if(n.isRequired&&!t.getProvidedSlotByName(r,n.name))return e&&e.errors&&e.errors.set(r,`required provided slot ${n.name} has no matching connection`),!1}}if(!r&&!n)return e&&e.errors&&e.errors.set("?","no slot connections"),!1}return!0}_findDuplicate(e,t){const n=new Set,r=e.find(e=>{if(e.id){if(n.has(e.id))return e;n.add(e.id)}});return r&&t&&t.errors&&t.errors.set(r,`Has Duplicate ${r instanceof Bn?"Handle":"Slot"} '${r.id}'`),r}_isValid(e){const t=t=>t.every(t=>t._isValid(e));return!this._findDuplicate(this._handles,e)&&!this._findDuplicate(this._slots,e)&&t(this._handles)&&t(this._particles)&&t(this._slots)&&t(this.handleConnections)&&t(this.slotConnections)&&(!this.search||this.search.isValid())}get requires(){return this._requires}get name(){return this._name}set name(e){this._name=e}get localName(){return this._localName}set localName(e){this._localName=e}get particles(){return this._particles}set particles(e){this._particles=e}get handles(){return this._handles}set handles(e){this._handles=e}get slots(){return this._slots}set slots(e){this._slots=e}get connectionConstraints(){return this._connectionConstraints}get obligations(){return this._obligations}get verbs(){return this._verbs}set verbs(e){this._verbs=e}get search(){return this._search}set search(e){this._search=e}setSearchPhrase(e){g()(!this._search,"Cannot override search phrase"),e&&(this._search=new Mn(e))}get slotConnections(){const e=[];return this._particles.forEach(t=>{e.push(...t.getSlotConnections())}),e}get handleConnections(){const e=[];return this._particles.forEach(t=>{e.push(...Object.values(t.connections)),e.push(...t._unnamedConnections)}),e}isEmpty(){return 0===this.particles.length&&0===this.handles.length&&0===this.slots.length&&0===this._connectionConstraints.length}findHandle(e){for(const t of this.handles)if(t.id===e)return t;return null}findSlot(e){for(const t of this.slots)if(t.id===e)return t;return null}findParticle(e){for(const t of this.particles)if(t.id.toString()===e)return t;return null}get patterns(){return this._patterns}set patterns(e){this._patterns=e}set description(e){const t=e.find(e=>"pattern"===e.name);t&&t.patterns.forEach(e=>this._patterns.push(e)),e.forEach(e=>{if("pattern"!==e.name){const t=this.handles.find(t=>t.localName===e.name);g()(t,`Cannot set description pattern for nonexistent handle ${e.name}.`),t.pattern=e.pattern}})}async digest(){return vn(this.toString())}normalize(e){if(Object.isFrozen(this))return e&&e.errors&&e.errors.set(this,"already normalized"),!1;if(!this._isValid()){this._findDuplicate(this._handles,e),this._findDuplicate(this._slots,e);const t=t=>t.forEach(t=>!t._isValid(e));return t(this._handles),t(this._particles),t(this._slots),t(this.handleConnections),t(this.slotConnections),!1}for(const e of this._particles)e._startNormalize();for(const e of this._handles)e._startNormalize();for(const e of this._slots)e._startNormalize();const t=this.handleConnections;for(const e of t)e._normalize();t.sort(qe);const n=this.slotConnections;for(const e of n)e._normalize();n.sort(qe),this.search&&this.search._normalize();for(const e of this.requires)e.normalize();for(const e of this._particles)e._finishNormalize();for(const e of this._handles)e._finishNormalize();for(const e of this._slots)e._finishNormalize();const r=new Set,i=new Set,s=new Set,o=[],a=[],c=[];let l=t.filter(e=>!(e.type&&e.type instanceof lt));l=l.concat(t.filter(e=>!!e.type&&!!(e.type instanceof lt)));for(const e of l)i.has(e.particle)||(o.push(e.particle),i.add(e.particle)),e.handle&&!r.has(e.handle)&&(a.push(e.handle),r.add(e.handle));for(const e of n)e.targetSlot&&!s.has(e.targetSlot)&&(c.push(e.targetSlot),s.add(e.targetSlot)),Object.values(e.providedSlots).forEach(e=>{s.has(e)||(c.push(e),s.add(e))});const h=this._handles.filter(e=>!r.has(e));h.sort(qe),a.push(...h);const u=this._particles.filter(e=>!i.has(e));u.sort(qe),o.push(...u);const d=this._slots.filter(e=>!s.has(e));return d.sort(qe),c.push(...d),this._particles=o,this._handles=a,this._slots=c,this._connectionConstraints.sort(qe),this._verbs.sort(),this._patterns.sort(),Object.freeze(this._particles),Object.freeze(this._handles),Object.freeze(this._slots),Object.freeze(this._connectionConstraints),Object.freeze(this),!0}clone(e){const t=new Dn(this.name);return null==e&&(e=new Map),this._copyInto(t,e),t._cloneMap=e,t}mergeInto(e){const t=new Map,n=e._handles.length,r=e._particles.length,i=e._slots.length;return this._copyInto(e,t),{handles:e._handles.slice(n),particles:e._particles.slice(r),slots:e._slots.slice(i),cloneMap:t}}_copyInto(e,t){const n=new Map,r=r=>{const i=r._copyInto(e,t,n);t.set(r,i)};e._name=this.name,e._verbs=e._verbs.concat(...this._verbs),this._handles.forEach(r),this._particles.forEach(r),this._slots.forEach(r),this._connectionConstraints.forEach(r),this._obligations.forEach(r),e.verbs=e.verbs.slice(),this.search&&this.search._copyInto(e);for(const n of this.requires){const r=e.newRequireSection();n._copyInto(r,t),r._cloneMap=t}e.patterns=e.patterns.concat(this.patterns)}updateToClone(e){const t={};return Object.keys(e).forEach(n=>t[n]=this._cloneMap.get(e[n])),t}_makeLocalNameMap(){const e=new Set([...this.particles,...this.handles,...this.slots].map(e=>e.localName));let t;const n=new Map,r=(r,i)=>{let s=r.localName;if(!s)do{s=`${i}${t++}`}while(e.has(s));n.set(r,s)};return t=0,this.particles.forEach(e=>r(e,"particle")),t=0,this.handles.forEach(e=>r(e,"handle")),t=0,this.slots.forEach(e=>r(e,"slot")),n}toString(e){const t=this._makeLocalNameMap(),n=[],r=this.verbs.length>0?` ${this.verbs.map(e=>`&${e}`).join(" ")}`:"";n.push(`recipe${this.name?` ${this.name}`:""}${r}`),e&&e.showUnresolved&&this.search&&n.push(this.search.toString(e).replace(/^|(\n)/g,"$1  "));for(const t of this._connectionConstraints){let r=t.toString().replace(/^|(\n)/g,"$1  ");e&&e.showUnresolved&&(r=r.concat(" // unresolved connection-constraint")),n.push(r)}n.push(...this.handles.map(n=>n.toString(e,t)).filter(e=>e).map(e=>e.replace(/^|(\n)/g,"$1  ")));for(const r of this.slots){const i=r.toString(e,t);i&&n.push(i.replace(/^|(\n)/g,"$1  "))}for(const r of this.requires)r.isEmpty()||n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));for(const r of this.particles)n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(e=>void 0!==e.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let e=1;e<this.patterns.length;++e)n.push(`    pattern \`${this.patterns[e]}\``);this.handles.forEach(e=>{e.pattern&&n.push(`    ${e.localName} \`${e.pattern}\``)})}if(this._obligations.length>0){n.push("  obligations");for(const e of this._obligations){const r=e.toString(t).replace(/^|(\n)/g,"$1    ");n.push(r)}}return n.join("\n")}getFreeHandles(){return this.handles.filter(e=>0===e.connections.length)}get allSpecifiedConnections(){return[].concat(...this.particles.filter(e=>e.spec&&e.spec.connections).map(e=>e.spec.connections.map(t=>({particle:e,connSpec:t}))))}getFreeConnections(e){return this.allSpecifiedConnections.filter(({particle:t,connSpec:n})=>!n.isOptional&&"descriptions"!==n.name&&"host"!==n.direction&&!t.connections[n.name]&&(!e||ft.compareTypes({type:e},{type:n.type})))}findHandleByID(e){return this.handles.find(t=>t.id===e)}getUnnamedUntypedConnections(){return this.handleConnections.find(e=>!e.type||!e.name||e.isOptional)}getParticlesByImplFile(e){return this.particles.filter(t=>t.spec&&e.has(t.spec.implFile))}findSlotByID(e){let t=this.slots.find(t=>t.id===e);if(void 0===t)for(const n of this.requires)if(void 0!==(t=n.slots.find(t=>t.id===e)))break;return t}}class Fn extends Dn{constructor(e,t){super(t),this.parent=e}findSlotByID(e){let t=this.slots.find(t=>t.id===e);return void 0===t&&(t=this.parent.slots.find(t=>t.id===e)),t}toString(e={},t){null==t&&(t=this._makeLocalNameMap());const n=[];n.push("require"),e.showUnresolved&&this.search&&n.push(this.search.toString(e).replace(/^|(\n)/g,"$1  "));for(const t of this.connectionConstraints){let r=t.toString().replace(/^|(\n)/g,"$1  ");e.showUnresolved&&(r=r.concat(" // unresolved connection-constraint")),n.push(r)}n.push(...this.handles.map(n=>n.toString(e,t)).filter(e=>e).map(e=>e.replace(/^|(\n)/g,"$1  ")));for(const r of this.slots){const i=r.toString(e,t);i&&n.push(i.replace(/^|(\n)/g,"$1  "))}for(const r of this.particles)n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(e=>void 0!==e.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let e=1;e<this.patterns.length;++e)n.push(`    pattern \`${this.patterns[e]}\``);this.handles.forEach(e=>{e.pattern&&n.push(`    ${e.localName} \`${e.pattern}\``)})}if(this.obligations.length>0){n.push("  obligations");for(const e of this.obligations){const r=e.toString(t).replace(/^|(\n)/g,"$1    ");n.push(r)}}return n.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class jn{constructor(e,t){this._targetSlot=void 0,this._providedSlots={},this._tags=[],g()(t),g()(t.recipe),g()(e),this._recipe=t.recipe,this._particle=t,this._name=e}remove(){this._particle.removeSlotConnection(this)}get recipe(){return this._recipe}get particle(){return this._particle}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get targetSlot(){return this._targetSlot}set targetSlot(e){this._targetSlot=e}get providedSlots(){return this._providedSlots}get tags(){return this._tags}set tags(e){this._tags=e}getSlotSpec(){return this.particle.spec&&this.particle.spec.getSlandleSpec(this.name)}connectToSlot(e){g()(e),g()(!this.targetSlot),g()(this.recipe instanceof Fn||this.recipe===e.recipe,"Cannot connect to slot from different recipe"),this._targetSlot=e,e.consumeConnections.push(this)}disconnectFromSlot(){this._targetSlot&&(this._targetSlot.removeConsumeConnection(this),this._targetSlot=void 0)}_clone(e,t){if(t.has(this))return t.get(this);const n=e.addSlotConnectionAsCopy(this.name);return n.tags=this.tags,t.set(this,n),n}_normalize(){const e={};for(const t of Object.keys(this._providedSlots).sort())e[t]=this._providedSlots[t];this._providedSlots=e,Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Ue(this.name,e.name))?t:0!==(t=qe(this._targetSlot,e._targetSlot))?t:0!==(t=qe(this._particle,e._particle))?t:0}_isValid(e){return!this._targetSlot||!this._targetSlot.sourceConnection||this._targetSlot===this._targetSlot.sourceConnection.providedSlots[this._targetSlot.name]||(e&&e.errors&&e.errors.set(this,`Invalid target slot '${this._targetSlot.name}' for slot connection '${this.name}' of particle ${this.particle.name}`),!1)}isResolved(e){const t=t=>{e&&e.errors&&e.errors.set(this.name,t),e&&e.details&&(e.details=t)};if(g()(Object.isFrozen(this),`slot connection ${this.name} must be frozen before it is resolved`),!this.name)return t("missing name"),!1;if(!this.particle)return t("missing particle"),!1;const n=this.getSlotSpec();if(void 0===n||n.isRequired){if(!this.targetSlot)return t("missing target-slot"),!1;if(!(this.targetSlot.id||this.targetSlot.sourceConnection&&this.targetSlot.sourceConnection.isConnected()))return t("unresolved target-slot"),!1}return!this.targetSlot||(void 0===n||this.getSlotSpec().provideSlotConnections.every(e=>!e||!e.isRequired||0!==this.providedSlots[e.name].consumeConnections.length||(t("missing consuming slot"),!1)))}isConnectedToInternalSlot(){return this.targetSlot&&!!this.targetSlot.sourceConnection}isConnectedToRemoteSlot(){return this.targetSlot&&!!this.targetSlot.id}isConnected(){return this.isConnectedToInternalSlot()||this.isConnectedToRemoteSlot()}toString(e,t){const n=[];O.defaultToPreSlandlesSyntax?(n.push("consume"),n.push(`${this.name}`),this.targetSlot&&n.push(`as ${e&&e.get(this.targetSlot)||this.targetSlot.localName}`)):(n.push(`${this.name}:`),n.push("consumes"),this.targetSlot&&n.push(`${e&&e.get(this.targetSlot)||this.targetSlot.localName}`)),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved slot-connection: ${t.details}`));const r=[];return r.push(n.join(" ")),Object.keys(this.providedSlots).forEach(t=>{const n=this.providedSlots[t],i=[];if(this.getSlotSpec()){const e=this.particle.getSlotSpecByName(t);g()(e,`Cannot find providedSlotSpec for ${t}`)}O.defaultToPreSlandlesSyntax?(i.push("  provide"),i.push(`${t}`),i.push(`as ${e&&e.get(n)||n}`)):(i.push(`  ${t}:`),i.push("provides"),i.push(`${e&&e.get(n)||n}`)),r.push(i.join(" "))}),r.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class $n{constructor(e,t){this._id=void 0,this._localName=void 0,this._tags=[],this._sourceConnection=void 0,this._formFactor=void 0,this._consumeConnections=[],g()(e),this._recipe=e,this._name=t}get recipe(){return this._recipe}get id(){return this._id}set id(e){this._id=e}get localName(){return this._localName}set localName(e){this._localName=e}get name(){return this._name}set name(e){this._name=e}get tags(){return this._tags}set tags(e){this._tags=e}get formFactor(){return this._formFactor}set formFactor(e){this._formFactor=e}get sourceConnection(){return this._sourceConnection}set sourceConnection(e){this._sourceConnection=e}get consumeConnections(){return this._consumeConnections}get spec(){return this.sourceConnection&&this.sourceConnection.getSlotSpec()?this.sourceConnection.particle.getSlotSpecByName(this.name):{isSet:!1,tags:[]}}get handles(){const e=[];if(this.sourceConnection&&this.sourceConnection.getSlotSpec())for(const t of this.sourceConnection.particle.getSlotSpecByName(this.name).handles){const n=this.sourceConnection.particle.connections[t];(n||n.handle)&&e.push(n.handle)}return e}_copyInto(e,t){let n=void 0;return t.has(this)?t.get(this):(!this.sourceConnection&&this.id&&(n=e.findSlot(this.id)),null==n&&((n=e.newSlot(this.name))._id=this.id,n._formFactor=this.formFactor,n._localName=this._localName,n._tags=[...this._tags],n._sourceConnection=t.get(this._sourceConnection),n.sourceConnection&&(n.sourceConnection.providedSlots[n.name]=n)),this._consumeConnections.forEach(e=>{const r=t.get(e);r&&r instanceof jn&&null==r.targetSlot&&r.connectToSlot(n)}),n)}_startNormalize(){this.localName=null,this._tags.sort()}_finishNormalize(){this._consumeConnections.forEach(e=>g()(Object.isFrozen(e))),this._consumeConnections.sort(qe),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Ue(this.id,e.id))?t:0!==(t=Ue(this.localName,e.localName))?t:0!==(t=Ue(this.formFactor,e.formFactor))?t:0!==(t=ze(this._tags,e._tags,Ue))?t:0}findHandleByID(e){return this.handles.find(t=>t.id===e)}removeConsumeConnection(e){const t=this._consumeConnections.indexOf(e);g()(t>-1),this._consumeConnections.splice(t,1),0===this._consumeConnections.length&&this.remove()}remove(){this._recipe.removeSlot(this)}isResolved(e){return g()(Object.isFrozen(this)),e&&e.showUnresolved&&(e.details=[],this._sourceConnection||e.details.push("missing source-connection"),this.id||e.details.push("missing id")),Boolean(this._sourceConnection||this.id)}_isValid(e){return!0}toString(e={},t){const n=[],r=t&&t.get(this)||this.localName;O.defaultToPreSlandlesSyntax?(n.push("slot"),this.id&&n.push(`'${this.id}'`),this.tags.length>0&&n.push(this.tags.map(e=>`#${e}`).join(" ")),n.push(`as ${r}`)):(n.push(`${r}:`),n.push("slot"),this.id&&n.push(`'${this.id}'`),this.tags.length>0&&n.push(this.tags.map(e=>`#${e}`).join(" ")));const i=e.showUnresolved&&!this.isResolved(e);return i&&n.push(`// unresolved slot: ${e.details}`),this.id||i?n.join(" "):""}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Bn{constructor(e){this._id=null,this._localName=void 0,this._tags=[],this._type=void 0,this._fate=null,this._originalFate=null,this._originalId=null,this._connections=[],this._mappedType=void 0,this._storageKey=void 0,this._pattern=void 0,this._immediateValue=void 0,this.claims=void 0,g()(e),this._recipe=e}toSlot(){if(!this.type)return;if("`slot"!==this.fate)return;const e=new $n(this.recipe,this.localName);e.tags=this.tags,e.id=this.id;const t=this.type.slandleType();if(t){const n=t.getSlot();if(n&&(e.formFactor=n.formFactor,n.handle)){const t=void 0;e.sourceConnection=new jn(n.handle,t)}}return e}_copyInto(e,t,n){let r=void 0;return null!==this._id&&["map","use","copy"].includes(this.fate)&&(r=e.findHandle(this._id)),null==r&&((r=e.newHandle())._id=this._id,r._tags=[...this._tags],r._type=this._type?this._type._cloneWithResolutions(n):void 0,r._fate=this._fate,r._originalFate=this._originalFate,r._originalId=this._originalId,r._mappedType=this._mappedType,r._storageKey=this._storageKey,r._immediateValue=this._immediateValue,r._connections=[],r._pattern=this._pattern),r}mergeInto(e){for(g()(this.recipe===e.recipe,"Cannot merge handles from different recipes.");this.connections.length>0;){const[t]=this.connections;t.disconnectHandle(),t.connectToHandle(e)}e._immediateValue=this._immediateValue,e.tags=e.tags.concat(this.tags),e.recipe.removeHandle(this),e.fate=this._mergedFate([this.fate,e.fate])}_mergedFate(e){return g()(e.length>0,"Cannot merge empty fates list"),g()(!e.includes("map")&&!e.includes("copy"),"Merging map/copy not supported yet"),e.every(e=>"use"===e)?"use":"create"}_startNormalize(){this._localName=null,this._tags.sort();const e=e=>{const t=e&&"?"===this._fate,n=e.canWriteSuperset&&e.canWriteSuperset.slandleType(),r=e.canReadSubset&&e.canReadSubset.slandleType();return t&&(n||r)},t=this.type.resolvedType(),n=t&&t.isCollectionType()&&t.collectionType;(e(t)||e(n))&&(this._fate="`slot")}_finishNormalize(){for(const e of this._connections)g()(Object.isFrozen(e),`Handle connection '${e.name}' is not frozen.`);this._connections.sort(qe),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Ue(this._id,e._id))?t:0!==(t=Ue(this._localName,e._localName))?t:0!==(t=ze(this._tags,e._tags,Ue))?t:0!==(t=Ue(this.fate,e.fate))?t:0!==(t=Ue(this._immediateValue&&this._immediateValue.toString()||"",e._immediateValue&&e._immediateValue.toString()||""))?t:0}get fate(){return this._fate||"?"}set fate(e){null==this._originalFate&&(this._originalFate=this._fate),this._fate=e}get originalFate(){return this._originalFate||"?"}get originalId(){return this._originalId}get recipe(){return this._recipe}get tags(){return this._tags}set tags(e){this._tags=e}get type(){return this._type}get id(){return this._id}set id(e){this._originalId||(this._originalId=this._id),this._id=e}mapToStorage(e){if(!e)throw new Error("Cannot map to undefined storage");this._id=e.id,this._originalId=e.originalId,this._type=void 0,this._mappedType=e.type,this._mappedType.isSingleton&&(this._mappedType=this._mappedType.getContainedType()),this._storageKey=e.storageKey,this.claims=e.claims}get localName(){return this._localName}set localName(e){this._localName=e}get connections(){return this._connections}get storageKey(){return this._storageKey}set storageKey(e){this._storageKey=e}get pattern(){return this._pattern}set pattern(e){this._pattern=e}get mappedType(){return this._mappedType}set mappedType(e){this._mappedType=e}get immediateValue(){return this._immediateValue}set immediateValue(e){this._immediateValue=e}static effectiveType(e,t){const n=new Map,r=t.filter(e=>null!=e.type).map(e=>({type:e.type._cloneWithResolutions(n),direction:e.direction}));return ft.processTypeList(e?e._cloneWithResolutions(n):null,r)}static resolveEffectiveType(e,t){const n=t.filter(e=>null!=e.type).map(e=>({type:e.type,direction:e.direction}));return ft.processTypeList(e,n)}_isValid(e){const t=new Set;for(const n of this._connections){if("map"===this.fate&&["out","inout"].includes(n.direction))return e&&e.errors&&e.errors.set(this,`Invalid fate '${this.fate}' for handle '${this}'; it is used for '${n.direction}' ${n.getQualifiedName()} connection`),!1;n.tags.forEach(e=>t.add(e))}this.mappedType||"`slot"!==this.fate||(this._mappedType=st.make(this.id,null,null));const n=Bn.resolveEffectiveType(this._mappedType,this._connections);return n?(this._type=n,this._tags.forEach(e=>t.add(e)),this._tags=[...t],!0):(e&&e.errors&&e.errors.set(this,`Type validations failed for handle '${this}' with type ${this._mappedType} and fate ${this.fate}`),!1)}isResolved(e){g()(Object.isFrozen(this));let t=!0;if(this.type){let n=!0;"create"!==this.fate&&"`slot"!==this.fate||(n=!1),this.type.canEnsureResolved()||(e&&e.details.push("unresolved type (cannot ensure resolved)"),t=!1),n&&!this.type.isResolved()&&(e&&e.details.push("unresolved type"),t=!1)}else e&&e.details.push("missing type"),t=!1;switch(this.fate){case"?":e&&e.details.push("missing fate"),t=!1;break;case"copy":case"map":case"use":e&&null===this.id&&e.details.push("missing id"),t=t&&null!==this.id;break;case"`slot":case"create":break;default:throw e&&e.details.push(`invalid fate ${this.fate}`),new Error(`Unexpected fate: ${this.fate}`)}return t}toString(e={},t){if(this._immediateValue)return;const n=[],r=t&&t.get(this)||this.localName;if(O.defaultToPreSlandlesSyntax?(n.push(this.fate),this.id&&n.push(`'${this.id}'`),n.push(...this.tags.map(e=>`#${e}`)),r&&n.push(`as ${r}`)):(r&&n.push(`${r}:`),n.push(this.fate),this.id&&n.push(`'${this.id}'`),n.push(...this.tags.map(e=>`#${e}`))),this.type)if(n.push("//"),this.type.isResolved())n.push(this.type.resolvedType().toString({hideFields:null==e.hideFields||e.hideFields}));else if(n.push(this.type.toString()),e.showUnresolved&&this.type.canEnsureResolved()){const t=nt.fromLiteral(this.type.toLiteral());t.maybeEnsureResolved(),n.push("//"),n.push(t.resolvedType().toString({hideFields:null==e.hideFields||e.hideFields}))}if(e.showUnresolved){const e={details:[]};this.isResolved(e)||n.push(` // unresolved handle: ${e.details.join(", ")}`)}return n.join(" ")}findConnectionByDirection(e){return this._connections.find(t=>t.direction===e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ln{}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Un{constructor(e){this.arcId=e,this._debug=!1,g()(void 0!==e,"Arcs with storage must have ids")}set debug(e){this._debug=e}async shutdown(){}}class Hn{constructor(e){Object.assign(this,e)}}class zn extends We{constructor(e,t,n,r){super({type:e,name:t,id:n}),this.unifiedStoreType="StorageProviderBase",this.legacyListeners=new Set,this.nextCallbackId=0,this.listeners=new Map,this.referenceMode=!1,g()(n,"id must be provided when constructing StorageProviders"),g()(!e.hasUnresolvedVariable,"Storage types must be concrete"),this._version=0,this._storageKey=r}getStorageEndpoint(e){throw new Error("storage endpoints should not be extracted from old storage stack")}get versionToken(){return null==this._version?null:this._version+""}enableReferenceMode(){this.referenceMode=!0}get baseStore(){return this}get storageKey(){return this._storageKey}reportExceptionInHost(e){throw e}on(e){const t=this.nextCallbackId++;return this.listeners.set(t,e),t}off(e){this.listeners.delete(e)}legacyOn(e){this.legacyListeners.add(e)}legacyOff(e){this.legacyListeners.delete(e)}async activate(){return this}async _fire(e){const t=[...this.listeners.values()],n=[...this.legacyListeners];await 0;for(const t of n)t(e);for(const e of t)await e(null)}get apiChannelMappingId(){return this.id}dispose(){}async modelForSynchronization(){return this.serializeContents()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class qn{constructor(e=[],t={}){this.particleDescriptions=e,this.storeDescById=t,this.seenHandles=new Set,this.seenParticles=new Set,this.excludeValues=!1}getDescription(e){if(e.patterns.length>0){let t=[];for(const n of e.patterns)t.push(this.patternToSuggestion(n,{_recipe:e}));if((t=t.filter(e=>Boolean(e))).length>0)return this._capitalizeAndPunctuate(this._joinDescriptions(t))}const t=new Set(e.particles);let n=this.particleDescriptions.filter(e=>t.has(e._particle)&&this._isSelectedDescription(e));if(n.find(e=>e._particle.spec.slotConnections.size>0)&&(n=n.filter(e=>e._particle.spec.slotConnections.size>0)),(n=n.sort(qn.sort)).length>0)return this._combineSelectedDescriptions(n)}_isSelectedDescription(e){return!!e.pattern}getHandleDescription(e){const t=this._selectHandleConnection(e)||e.connections[0];return this._formatDescription(t)}_combineSelectedDescriptions(e,t={}){const n=[];e.forEach(e=>{this.seenParticles.has(e._particle)||n.push(this.patternToSuggestion(e.pattern,e))});const r=this._joinDescriptions(n);if(r)return t.skipFormatting?r:this._capitalizeAndPunctuate(r)}_joinDescriptions(e){const t=e.filter(e=>e),n=t.length;if(n>0){const e=["",""," and ",", and "][Math.min(3,n)],r=t.pop();return`${t.join(", ")}${e}${r}`}}_joinTokens(e){return e.join("")}_capitalizeAndPunctuate(e){g()(e);const t=e.length-1;return`${e[0].toUpperCase()}${e.slice(1,t)}${e[t]}${e[t].match(/[a-z0-9()' >\]]/i)?".":""}`}patternToSuggestion(e,t){const n=this._initTokens(e,t).map(e=>this.tokenToString(e));if(0===n.filter(e=>null==e).length)return this._joinTokens(n)}_initTokens(e,t){e=e.replace(/</g,"&lt;");let n=[];for(;e.length>0;){const r=e.match(qn.tokensRegex);let i,s;r?(i=r[0],s=e.indexOf(i)):(i="",s=e.length),g()(s>=0);const o=e.substring(0,s);o.length>0&&n.push({text:o}),i.length>0&&(n=n.concat(this._initSubTokens(i,t))),e=e.substring(s+i.length)}return n}_initSubTokens(e,t){const n=e.match(qn.tokensInnerRegex),r=n[1].split("."),i=3===n.length?n[2]:void 0;if(!t._particle){const e=r.shift();if(e[0]!==e[0].toUpperCase())return console.warn(`Invalid particle name '${e}' - must start with a capital letter.`),[];const n=this.particleDescriptions.filter(n=>n._particle.name===e&&t._recipe.particles.find(e=>e===n._particle));if(0===n.length)return console.warn(`Cannot find particles with name ${e}.`),[];t=n[n.length-1]}const s=t._particle;if(0===r.length)return[{particleName:s.spec.name,particleDescription:t}];const o=s.connections[r[0]];if(o)return g()(o.handle,"Missing handle???"),[{fullName:n[0],handleName:o.name,storeId:o.handle.id,properties:r.splice(1),extra:i,_handleConn:o,value:t._connections[o.name].value}];if(2!==r.length)return 1===r.length?console.warn(`Unknown handle connection name '${r[0]}'`):console.warn(`Slot connections tokens must have exactly 2 names, found ${r.length} in '${r.join(".")}'`),[];const a=s.getSlotConnectionByName(r[0]).providedSlots[r[1]];return g()(a,`Could not find handle ${r.join(".")}`),[{fullName:n[0],consumeSlotName:r[0],provideSlotName:r[1],extra:i,_providedSlotConn:a}]}tokenToString(e){if(e.text)return e.text;if(e.particleName)return this._particleTokenToString(e);if(e.handleName)return this._handleTokenToString(e);if(e.consumeSlotName&&e.provideSlotName)return this._slotTokenToString(e);throw new Error("no handle or slot name")}_particleTokenToString(e){return this._combineSelectedDescriptions([e.particleDescription],{skipFormatting:!0})}_handleTokenToString(e){switch(e.extra){case"_type_":return e._handleConn.type.toPrettyString().toLowerCase();case"_values_":return this._formatStoreValue(e.handleName,e.value);case"_name_":return this._formatDescription(e._handleConn);default:{if(g()(!e.extra,`Unrecognized extra ${e.extra}`),e._handleConn.type instanceof lt){if(!e.value)return;return g()(e.value.interfaceValue,`Missing interface type value for '${e._handleConn.type}'.`),Pt.fromLiteral(e.value.interfaceValue).pattern}if(e.properties&&e.properties.length>0)return this._propertyTokenToString(e.handleName,e.value,e.properties);let t=this._formatDescriptionPattern(e._handleConn)||this._formatStoreDescription(e._handleConn);const n=this._formatStoreValue(e.handleName,e.value);if(!t){const t=e._handleConn.type;if(n&&!this.excludeValues&&!(t instanceof ot)&&!(t instanceof at))return n}return t=t||this._formatHandleType(e._handleConn),!n||this.excludeValues||this.seenHandles.has(e.storeId)?t:(this.seenHandles.add(e.storeId),this._combineDescriptionAndValue(e,t,n))}}}_combineDescriptionAndValue(e,t,n){return t===n?t:`${t} (${n})`}_slotTokenToString(e){switch(e.extra){case"_empty_":return 0===e._providedSlotConn.consumeConnections.length;default:g()(!e.extra,`Unrecognized slot extra ${e.extra}`)}const t=e._providedSlotConn.consumeConnections.map(e=>{const t=e.particle,n=this.particleDescriptions.find(e=>e._particle===t);return this.seenParticles.add(t),this.patternToSuggestion(t.spec.pattern,n)});return this._joinDescriptions(t)}_propertyTokenToString(e,t,n){if(!t)return"";g()(t.entityValue,`Cannot return property ${n.join(",")} for non EntityType.`);t.entityValue;if(t.entityValue){let r=t.entityValue;for(const e of n)r&&(r=r[e]);if(r)return this._formatEntityProperty(e,n,r)}}_formatEntityProperty(e,t,n){return n}_formatStoreValue(e,t){if(t){if(t.collectionValues)return this._formatCollection(e,t.collectionValues);if(t.bigCollectionValues)return this._formatBigCollection(e,t.bigCollectionValues);if(t.entityValue)return this._formatSingleton(e,t);throw new Error(`invalid store type for handle ${e}`)}}_formatCollection(e,t){return t[0].rawData.name?t.length>2?`${t[0].rawData.name} plus ${t.length-1} other items`:t.map(e=>e.rawData.name).join(", "):`${t.length} items`}_formatBigCollection(e,t){return`collection of items like ${t.rawData.name}`}_formatSingleton(e,t){const n=t.entityValue;if(t.valueDescription){let e,r=t.valueDescription;for(;e=r.match(/\${([a-zA-Z0-9.]+)}/);)r=r.replace(e[0],n[e[1]]);return r}if(n.name)return n.name}_formatDescription(e){return this._formatDescriptionPattern(e)||this._formatStoreDescription(e)||this._formatHandleType(e)}_formatDescriptionPattern(e){let t=e;if(!t.spec.isOutput){const n=this._selectHandleConnection(e.handle);n&&(t=n)}const n=this.particleDescriptions.find(e=>e._particle===t.particle),r=n?n._connections[t.name]:null;if(r&&r.pattern)return this.patternToSuggestion(r.pattern,n)}_formatStoreDescription(e){if(e.handle){if(!e.handle.id)return;const t=this.storeDescById[e.handle.id],n=this._formatHandleType(e);if(t&&t!==n)return t}}_formatHandleType(e){return(e.handle&&e.handle.type.isResolved()?e.handle.type:e.type).toPrettyString().toLowerCase()}_selectHandleConnection(e){const t=e.connections.filter(e=>{const t=e.spec,n=this.particleDescriptions.find(t=>t._particle===e.particle);return!!t.pattern||!!n&&!!n._connections[e.name].pattern});if(t.sort((e,t)=>{const n=e.spec.isOutput;if(n!==t.spec.isOutput)return n?-1:1;const r=this.particleDescriptions.find(t=>t._particle===e.particle);return this.particleDescriptions.find(e=>e._particle===t.particle)._rank-r._rank}),t.length>0)return t[0]}static sort(e,t){const n=[...e._particle.spec.slotConnections.values()].some(e=>Rt(e));if(n!==[...t._particle.spec.slotConnections.values()].some(e=>Rt(e)))return n?-1:1;if(e._rank!==t._rank)return t._rank-e._rank;let r=0,i=0;return e._particle.spec.slotConnections.forEach(e=>{e.isSet||++r}),t._particle.spec.slotConnections.forEach(e=>{e.isSet||++i}),i-r}}qn.tokensRegex=/\${[a-zA-Z0-9.]+}(?:\.[_a-zA-Z]+)?/g,qn.tokensInnerRegex=/\${([a-zA-Z0-9.]+)}(?:\.([_a-zA-Z]+))?/;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Wn{constructor(e={},t,n=[]){this.storeDescById=e,this.arcRecipes=t,this.particleDescriptions=n}static async XcreateForPlan(e){const t=await Wn.initDescriptionHandles(e.particles);return new Wn({},[{patterns:e.patterns,particles:e.particles}],t)}static async createForPlan(e,t){const n=t.particles,r=await Wn.initDescriptionHandles(n,e),i={};for(const{id:n}of t.handles){const t=e.findStoreById(n);t&&(i[n]=e.getStoreDescription(t))}return new Wn(i,[{patterns:t.patterns,particles:t.particles}],r)}static async create(e,t){const n=[].concat(...e.allDescendingArcs.map(e=>e.activeRecipe.particles)),r=await Wn.initDescriptionHandles(n,e,t),i={};for(const{id:t}of e.activeRecipe.handles){const n=e.findStoreById(t);n&&(i[t]=e.getStoreDescription(n))}return new Wn(i,e.recipeDeltas,r)}getArcDescription(e=qn){const t=[].concat(...this.arcRecipes.map(e=>e.patterns)),n=[].concat(...this.arcRecipes.map(e=>e.particles)),r=new e(this.particleDescriptions,this.storeDescById).getDescription({patterns:t,particles:n});if(r)return r}getRecipeSuggestion(e=qn){return new e(this.particleDescriptions,this.storeDescById).getDescription(this.arcRecipes[this.arcRecipes.length-1])}getHandleDescription(e){g()(e.connections.length>0,"handle has no connections?");const t=new qn(this.particleDescriptions,this.storeDescById);return t.excludeValues=!0,t.getHandleDescription(e)}static getAllTokens(e){const t=[],n=e.match(qn.tokensRegex);for(let e=0;e<n.length;++e)t[e]=n[e].match(qn.tokensInnerRegex)[1].split(".");return t}static async initDescriptionHandles(e,t,n){return await Promise.all(e.map(e=>Wn._createParticleDescription(e,t,n)))}static async _createParticleDescription(e,t,n){let r={_particle:e,_connections:{}};n&&(r._rank=n.calcParticleRelevance(e));const i=await Wn._getPatternByNameFromDescriptionHandle(e,t);(r={...r,...i}).pattern=r.pattern||e.spec.pattern;for(const n of Object.values(e.connections)){const s=e.spec.handleConnectionMap.get(n.name),o=i[n.name]||s.pattern,a=t?t.findStoreById(n.handle.id):null;r._connections[n.name]={pattern:o,_handleConn:n,value:await Wn._prepareStoreValue(a)}}return r}static async _getPatternByNameFromDescriptionHandle(e,t){const n=e.connections.descriptions;if(n&&n.handle&&n.handle.id){const e=t.findStoreById(n.handle.id);if(e){const t={};for(const n of await e.toList())t[n.rawData.key]=n.rawData.value;return t}}return{}}static async _prepareStoreValue(e){if(e)if(e.type instanceof ot){const t=e,n=await t.toList();if(n&&n.length>0)return{collectionValues:n}}else if(e.type instanceof at){const t=e,n=await t.stream(1),{value:r,done:i}=await t.cursorNext(n);if(t.cursorClose(n),!i&&r[0].rawData.name)return{bigCollectionValues:r[0]}}else if(e.type instanceof it){const t=e,n=await t.get();if(n&&n.rawData)return{entityValue:n.rawData,valueDescription:e.type.entitySchema.description.value}}else if(e.type instanceof lt){const t=e,n=await t.get();if(n)return{interfaceValue:n}}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Vn{constructor(e,t,n){this._channel=e,this._id=t,this._other=n,this._onmessage=void 0}async postMessage(e){await this._channel._post(this._other,e)}set onmessage(e){this._onmessage=e}close(){this.postMessage=async()=>{}}}class Kn{constructor(e){this.data=e}}class Qn{constructor(){this.port1=new Vn(this,0,1),this.port2=new Vn(this,1,0),this._ports=[this.port1,this.port2]}async _post(e,t){if(t=JSON.parse(JSON.stringify(t)),this._ports[e]._onmessage)try{await 0,await this._ports[e]._onmessage(new Kn(t))}catch(e){console.error("Exception in particle code\n",e)}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var Gn,Zn=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Yn=function(e,t){return function(n,r){t(n,r,e)}};!function(e){e[e.Mapped=0]="Mapped",e[e.LocalMapped=1]="LocalMapped",e[e.RemoteMapped=2]="RemoteMapped",e[e.Direct=3]="Direct",e[e.ObjectMap=4]="ObjectMap",e[e.List=5]="List",e[e.ByLiteral=6]="ByLiteral"}(Gn||(Gn={}));const Xn=new Map;function Jn(e,t){let n=Xn.get(e);null==n&&(n=new Map,Xn.set(e,n));let r=n.get(t);return null==r&&(r=[],n.set(t,r)),r}function er(e,t,n){const r=Xn.get(e);if(r){const e=r.get(t);if(e){const t=e[n];if(t)return t}}throw new Error(`the target ${e}, propertyKey ${t} and parameterIndex ${n} provided did not exist`)}function tr(e,t,n,r){Jn(e,t)[n]=r}function nr(e,t,n){tr(e.constructor,t,n,{type:Gn.Direct})}function rr(e,t,n){tr(e.constructor,t,n,{type:Gn.Mapped})}function ir(e){return(t,n,r)=>{const i={type:Gn.ByLiteral,converter:e};tr(t.constructor,n,r,i)}}function sr(e,t){return(n,r,i)=>{const s={type:Gn.ObjectMap,key:{type:e},value:{type:t}};tr(n.constructor,r,i,s)}}function or(e){return(t,n,r)=>{const i={type:Gn.List,value:{type:e}};tr(t.constructor,n,r,i)}}function ar(e,t,n){tr(e.constructor,t,n,{type:Gn.LocalMapped})}function cr(e,t,n){tr(e.constructor,t,n,{type:Gn.RemoteMapped})}function lr(e,t){Jn(e.constructor,t)}function hr(e,t,n){tr(e.constructor,t,n,{type:Gn.Direct,initializer:!0})}function ur(e,t,n){er(e.constructor,t,n).identifier=!0}function dr(e,t,n){er(e.constructor,t,n).ignore=!0}class pr{constructor(e){this._prefix=e,this._nextIdentifier=0,this._idMap=new Map,this._reverseIdMap=new Map}_newIdentifier(){return this._prefix+this._nextIdentifier++}createMappingForThing(e,t){let n;return g()(!this._reverseIdMap.has(e)),n=t||(e.apiChannelMappingId?e.apiChannelMappingId:this._newIdentifier()),g()(!this._idMap.has(n),`${t?"requestedId":e.apiChannelMappingId?"apiChannelMappingId":"newIdentifier()"} ${n} already in use`),this.establishThingMapping(n,e),n}recreateMappingForThing(e){const t=[];return e.forEach(e=>{g()(this._reverseIdMap.has(e));const n=this._reverseIdMap.get(e);this.establishThingMapping(n,e),t.push(n)}),t}maybeCreateMappingForThing(e){return this.hasMappingForThing(e)?this.identifierForThing(e):this.createMappingForThing(e)}async establishThingMapping(e,t){let n;if(Array.isArray(e)||(Array.isArray(t)&&([t,n]=t),this._idMap.set(e,t)),t instanceof Promise)g()(null==n),await this.establishThingMapping(e,await t);else if(Array.isArray(e)){g()(e.length===t.length);for(let n=0;n<e.length;n++)await this.establishThingMapping(e[n],t[n])}else this._reverseIdMap.set(t,e),n&&await n()}hasMappingForThing(e){return this._reverseIdMap.has(e)}identifierForThing(e){return g()(this._reverseIdMap.has(e),`Missing thing [${e}]`),this._reverseIdMap.get(e)}thingForIdentifier(e){return g()(this._idMap.has(e),`Missing id: ${e}`),this._idMap.get(e)}}class fr{constructor(e,t){this._port=e,this._mapper=new pr(t),this._port.onmessage=async e=>this._processMessage(e),this.inspector=null,this.attachStack=!1,this.messageCount=0,this._testingHook()}_testingHook(){}close(){this._port.close()}async _processMessage(e){g()(void 0!==this["before"+e.data.messageType]);const t=this.messageCount++;this.inspector&&this.inspector.pecMessage("on"+e.data.messageType,e.data.messageBody,t,this.supportsExternalParticle()?"a":"w",this._port.pecId,e.data.stack),this["before"+e.data.messageType](e.data.messageBody)}async send(e,t){const n={messageType:e,messageBody:t,stack:this.attachStack?(new Error).stack:void 0},r=this.messageCount++;this.inspector&&this.inspector.pecMessage(e,t,r,this.supportsExternalParticle()?"a":"w",this._port.pecId||"",(new Error).stack||""),await this._port.postMessage(n)}supportsExternalParticle(){return"MessagePort"===Object.getPrototypeOf(this._port.constructor).name}}function gr(e){return e.toString().match(/.*?\(([^)]*)\)/)[1].split(",").map(e=>e.replace(/\/\*.*\*\//,"").trim()).filter(e=>e)}function mr(e,t,n){if(void 0!==e)switch(e.type){case Gn.Mapped:return n.identifierForThing(t);case Gn.LocalMapped:return n.maybeCreateMappingForThing(t);case Gn.RemoteMapped:case Gn.Direct:return t;case Gn.ObjectMap:{const r={};return t.forEach((t,i)=>r[mr(e.key,i,n)]=mr(e.value,t,n)),r}case Gn.List:return t.map(t=>mr(e.value,t,n));case Gn.ByLiteral:return t.toLiteral();default:throw new Error(`Can't yet send MappingType ${e.type}`)}}function yr(e,t,n){if(void 0!==e)switch(e.type){case Gn.Mapped:return n.thingForIdentifier(t);case Gn.LocalMapped:return t;case Gn.RemoteMapped:return n.thingForIdentifier(t);case Gn.Direct:return t;case Gn.ObjectMap:{const r=new Map;for(const i of Object.keys(t))r.set(yr(e.key,i,n),yr(e.value,t[i],n));return r}case Gn.List:return t.map(t=>yr(e.value,t,n));case Gn.ByLiteral:if(!e.converter)throw new Error(`Expected ${e.type} to have a converter but it doesn't`);return e.converter.fromLiteral(t);default:throw new Error(`Can't yet recieve MappingType ${e.type}`)}}class _r extends fr{constructor(e,t){super(e,"o"),this.inspector=t.inspector,this.inspector&&this.inspector.onceActive.then(()=>this.DevToolsConnected(),e=>console.error(e))}async _processMessage(e){!function e(t){for(const n of Object.getOwnPropertyNames(t)){const r=t[n];r&&"object"==typeof r&&e(r)}Object.freeze(t)}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(e.data),await super._processMessage(e)}Stop(){}DefineHandle(e,t,n){}InstantiateParticle(e,t,n,r){}ReinstantiateParticle(e,t,n){}ReloadParticles(e,t){}UIEvent(e,t,n){}SimpleCallback(e,t){}AwaitIdle(e){}StartRender(e,t,n,r){}StopRender(e,t){}GetBackingStoreCallback(e,t,n,r,i,s){}ConstructArcCallback(e,t){}CreateHandleCallback(e,t,n,r,i){}MapHandleCallback(e,t,n){}CreateSlotCallback(e,t,n){}InnerArcRender(e,t,n,r){}DevToolsConnected(){}}Zn([lr],_r.prototype,"Stop",null),Zn([Yn(0,(function(e,t,n){tr(e.constructor,t,n,{type:Gn.Direct,initializer:!0,redundant:!0})})),Yn(1,ir(nt)),Yn(2,nr)],_r.prototype,"DefineHandle",null),Zn([Yn(0,hr),Yn(1,ur),Yn(1,nr),Yn(2,ir(Pt)),Yn(3,sr(Gn.Direct,Gn.Mapped))],_r.prototype,"InstantiateParticle",null),Zn([Yn(0,ur),Yn(0,nr),Yn(1,ir(Pt)),Yn(2,sr(Gn.Direct,Gn.Mapped))],_r.prototype,"ReinstantiateParticle",null),Zn([Yn(0,(function(e,t,n){tr(e.constructor,t,n,{type:Gn.Direct,initializer:!0,overriding:!0})})),Yn(1,or(Gn.Direct))],_r.prototype,"ReloadParticles",null),Zn([Yn(0,rr),Yn(1,nr),Yn(2,nr)],_r.prototype,"UIEvent",null),Zn([Yn(0,cr),Yn(1,nr)],_r.prototype,"SimpleCallback",null),Zn([Yn(0,nr)],_r.prototype,"AwaitIdle",null),Zn([Yn(0,rr),Yn(1,nr),Yn(2,sr(Gn.Direct,Gn.Direct)),Yn(3,or(Gn.Direct))],_r.prototype,"StartRender",null),Zn([Yn(0,rr),Yn(1,nr)],_r.prototype,"StopRender",null),Zn([Yn(0,hr),Yn(1,cr),Yn(2,ir(nt)),Yn(3,nr),Yn(4,ur),Yn(4,nr),Yn(5,nr)],_r.prototype,"GetBackingStoreCallback",null),Zn([Yn(0,cr),Yn(1,ar)],_r.prototype,"ConstructArcCallback",null),Zn([Yn(0,hr),Yn(1,cr),Yn(2,ir(nt)),Yn(3,nr),Yn(4,ur),Yn(4,nr)],_r.prototype,"CreateHandleCallback",null),Zn([Yn(0,dr),Yn(0,hr),Yn(1,cr),Yn(2,nr)],_r.prototype,"MapHandleCallback",null),Zn([Yn(0,dr),Yn(0,hr),Yn(1,cr),Yn(2,nr)],_r.prototype,"CreateSlotCallback",null),Zn([Yn(0,rr),Yn(1,nr),Yn(2,nr),Yn(3,nr)],_r.prototype,"InnerArcRender",null),Zn([lr],_r.prototype,"DevToolsConnected",null);let vr=class extends fr{constructor(e){super(e,"i")}Render(e,t,n){}Output(e,t){}InitializeProxy(e,t){}SynchronizeProxy(e,t){}HandleGet(e,t){}HandleToList(e,t){}HandleSet(e,t,n,r){}HandleClear(e,t,n){}HandleStore(e,t,n,r){}HandleRemove(e,t,n,r){}HandleRemoveMultiple(e,t,n,r){}HandleStream(e,t,n,r){}StreamCursorNext(e,t,n){}StreamCursorClose(e,t){}Register(e,t,n){}ProxyMessage(e,t,n){}Idle(e,t){}GetBackingStore(e,t,n){}ConstructInnerArc(e,t){}ArcCreateHandle(e,t,n,r){}ArcMapHandle(e,t,n){}ServiceRequest(e,t,n){}ArcCreateSlot(e,t,n,r,i){}ArcLoadRecipe(e,t,n){}ReportExceptionInHost(e){}onDevToolsConnected(){this.attachStack=!0}};var wr,br;Zn([Yn(0,rr),Yn(1,nr),Yn(2,nr)],vr.prototype,"Render",null),Zn([Yn(0,rr),Yn(1,nr)],vr.prototype,"Output",null),Zn([Yn(0,rr),Yn(1,ar)],vr.prototype,"InitializeProxy",null),Zn([Yn(0,rr),Yn(1,ar)],vr.prototype,"SynchronizeProxy",null),Zn([Yn(0,rr),Yn(1,ar)],vr.prototype,"HandleGet",null),Zn([Yn(0,rr),Yn(1,ar)],vr.prototype,"HandleToList",null),Zn([Yn(0,rr),Yn(1,nr),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleSet",null),Zn([Yn(0,rr),Yn(1,nr),Yn(2,nr)],vr.prototype,"HandleClear",null),Zn([Yn(0,rr),Yn(1,ar),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleStore",null),Zn([Yn(0,rr),Yn(1,ar),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleRemove",null),Zn([Yn(0,rr),Yn(1,ar),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleRemoveMultiple",null),Zn([Yn(0,rr),Yn(1,ar),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleStream",null),Zn([Yn(0,rr),Yn(1,ar),Yn(2,nr)],vr.prototype,"StreamCursorNext",null),Zn([Yn(0,rr),Yn(1,nr)],vr.prototype,"StreamCursorClose",null),Zn([Yn(0,rr),Yn(1,ar),Yn(2,ar)],vr.prototype,"Register",null),Zn([Yn(0,rr),Yn(1,nr),Yn(2,ar)],vr.prototype,"ProxyMessage",null),Zn([Yn(0,nr),Yn(1,sr(Gn.Mapped,Gn.Direct))],vr.prototype,"Idle",null),Zn([Yn(0,ar),Yn(1,nr),Yn(2,ir(nt))],vr.prototype,"GetBackingStore",null),Zn([Yn(0,ar),Yn(1,rr)],vr.prototype,"ConstructInnerArc",null),Zn([Yn(0,ar),Yn(1,cr),Yn(2,ir(nt)),Yn(3,nr)],vr.prototype,"ArcCreateHandle",null),Zn([Yn(0,ar),Yn(1,cr),Yn(2,rr)],vr.prototype,"ArcMapHandle",null),Zn([Yn(0,rr),Yn(1,nr),Yn(2,ar)],vr.prototype,"ServiceRequest",null),Zn([Yn(0,ar),Yn(1,cr),Yn(2,rr),Yn(3,nr),Yn(4,nr)],vr.prototype,"ArcCreateSlot",null),Zn([Yn(0,cr),Yn(1,nr),Yn(2,ar)],vr.prototype,"ArcLoadRecipe",null),Zn([Yn(0,ir(v))],vr.prototype,"ReportExceptionInHost",null),vr=Zn([(wr=_r,e=>{const t=(e,t)=>{const n=Xn.get(e)||new Map;for(const r of n.keys()){const i=gr(e.prototype[r]),s=n.get(r)||[],o=s.findIndex(e=>e.initializer||!1),a=s.findIndex(e=>e.identifier||!1),c=async function(...e){const t={};for(let n=0;n<s.length;n++)n!==o&&(t[i[n]]=mr(s[n],e[n],this._mapper));-1!==o&&(s[o].redundant?(g()(-1===a),t.identifier=this._mapper.maybeCreateMappingForThing(e[o])):s[o].overriding?t.identifier=this._mapper.recreateMappingForThing(e[o]):t.identifier=this._mapper.createMappingForThing(e[o],e[a])),await this.send(r,t)},l=async function(e){const t=[],n=[];for(let r=0;r<s.length;r++){if(r===o&&(-1!==a||s[r].ignore))continue;const c=r===o?"identifier":i[r],l=yr(s[r],e[c],this._mapper);l instanceof Promise?(n.push({promise:l,position:t.length}),t.push(()=>yr(s[r],e[c],this._mapper))):t.push(l)}n.length>0&&(await Promise.all(n.map(async e=>e.promise)),n.forEach(e=>{t[e.position]=t[e.position]()}));const c=this["on"+r](...t);o>-1&&(g()(e.identifier),await this._mapper.establishThingMapping(e.identifier,c))};Object.defineProperty(e.prototype,r,{get:()=>c}),Object.defineProperty(t.prototype,"before"+r,{get:()=>l})}};t(e,wr),t(wr,e)})],vr);class Sr{constructor(e,t,n,r){this.handlers=new Map,this.requestedContentTypes=new Set,this._isRendered=!1,this.apiPort=e,this.slotName=n,this.particle=t,this.providedSlots=r}get isRendered(){return this._isRendered}render(e){this.apiPort.Render(this.particle,this.slotName,e),Object.keys(e).forEach(e=>{this.requestedContentTypes.delete(e)}),this._isRendered=0===this.requestedContentTypes.size&&Object.keys(e).length>0}registerEventHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}clearEventHandlers(e){this.handlers.set(e,[])}fireEvent(e){for(const t of this.handlers.get(e.handler)||[])t(e)}rewire(e){this.particle.removeSlotProxy(this.slotName),this.particle=e,this._isRendered=!1,this.particle.addSlotProxy(this),this.particle.renderSlot(this.slotName,["model","template","templateName"])}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Cr{constructor(e){if(this.left2right=new Map,this.right2left=new Map,e)for(const[t,n]of e)this.set(t,n)}get size(){return this.left2right.size}set(e,t){return this.hasL(e)&&this.right2left.delete(this.getL(e)),this.hasR(t)&&this.left2right.delete(this.getR(t)),this.left2right.set(e,t),this.right2left.set(t,e),this}hasL(e){return this.left2right.has(e)}hasR(e){return this.right2left.has(e)}getL(e){return this.left2right.get(e)}getR(e){return this.right2left.get(e)}deleteL(e){return this.right2left.delete(this.getL(e)),this.left2right.delete(e)}deleteR(e){return this.left2right.delete(this.getR(e)),this.right2left.delete(e)}clear(){this.left2right.clear(),this.right2left.clear()}entries(){return this.left2right.entries()}lefts(){return this.left2right.keys()}rights(){return this.right2left.keys()}forEach(e){this.left2right.forEach((t,n)=>e(n,t,this))}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Er{constructor(e,t){this.schema=e,this.typeMap=t}static create(e,t){if(e instanceof ot&&(e=e.getContainedType()),e instanceof it)return new kr(e.getEntitySchema(),t);if(e instanceof ut)return new xr(e.getEntitySchema(),t);throw new Error(`Unsupported type for StringEncoder: ${e}`)}encodeCollection(e){let t=e.length+":";for(const n of e)t+=Er.encodeStr(this.encodeSingleton(n));return t}static encodeDictionary(e){const t=Object.entries(e);let n=t.length+":";for(const[e,r]of t)n+=Er.encodeStr(e)+Er.encodeStr(r);return n}encodeField(e,t,n){switch(e.kind){case"schema-primitive":return t+":"+e.type.substr(0,1)+this.encodeValue(e.type,n)+"|";case"schema-reference":return t+":R"+this.encodeReference(n)+"|";case"schema-collection":case"schema-union":case"schema-tuple":throw new Error(`'${e.kind}' not yet supported for entity packaging`);default:throw new Error(`Unknown field kind '${e.kind}' in schema`)}}encodeReference(e){const t=e.type.referredType;g()(t instanceof it);let n=this.typeMap.getR(t);n||(n=this.typeMap.size+1,this.typeMap.set(n,t));const{id:r,storageKey:i}=e.dataClone();return Er.encodeStr(r)+"|"+Er.encodeStr(i)+"|"+n+":"}encodeValue(e,t){switch(e){case"Text":case"URL":return Er.encodeStr(t);case"Number":return t+":";case"Boolean":return t?"1":"0";case"Bytes":case"Object":throw new Error(`'${e}' not yet supported for entity packaging`);default:throw new Error(`Unknown primitive value type '${e}' in schema`)}}static encodeStr(e){return e?e.length+":"+e:"0:"}}class kr extends Er{encodeSingleton(e){if(!(e instanceof V))throw new Error(`non-Entity passed to EntityEncoder: ${e}`);const t=V.id(e);let n=Er.encodeStr(t)+"|";for(const[t,r]of Object.entries(e))n+=this.encodeField(this.schema.fields[t],t,r);return n}}class xr extends Er{encodeSingleton(e){if(!(e instanceof Kt))throw new Error(`non-Reference passed to EntityEncoder: ${e}`);return this.encodeReference(e)+"|"}}class Tr{constructor(e,t,n){this.schema=e,this.typeMap=t,this.pec=n}static create(e,t,n){if(e instanceof ot&&(e=e.getContainedType()),e instanceof it)return new Rr(e.getEntitySchema(),t,n);if(e instanceof ut)return new Ir(e.getEntitySchema(),t,n);throw new Error(`Unsupported type for StringDecoder: ${e}`)}static decodeDictionary(e){const t=new Rr(null,null,null);t.str=e;const n={};let r=Number(t.upTo(":"));for(;r--;){const e=Number(t.upTo(":")),r=t.chomp(e),i=t.chomp(1);if(i>="0"&&i<="9"){const e=Number(`${i}${t.upTo(":")}`);n[r]=t.chomp(e)}else n[r]=t.decodeValue(i)}return n}static decodeArray(e){const t=new Rr(null,null,null);t.str=e;const n=[];let r=Number(t.upTo(":"));for(;r--;){const e=t.chomp(1);if(e>="0"&&e<="9"){const r=Number(`${e}${t.upTo(":")}`);n.push(t.chomp(r))}else n.push(t.decodeValue(e))}return n}upTo(e){const t=this.str.indexOf(e);if(t<0)throw new Error(`Packaged entity decoding fail: expected '${e}' separator in '${this.str}'`);const n=this.str.slice(0,t);return this.str=this.str.slice(t+1),n}chomp(e){if(e>this.str.length)throw new Error(`Packaged entity decoding fail: expected '${e}' chars to remain in '${this.str}'`);const t=this.str.slice(0,e);return this.str=this.str.slice(e),t}validate(e){if(this.chomp(e.length)!==e)throw new Error(`Packaged entity decoding fail: expected '${e}' at start of '${this.str}'`)}decodeValue(e){switch(e){case"T":case"U":{const e=Number(this.upTo(":"));return this.chomp(e)}case"N":return Number(this.upTo(":"));case"B":return Boolean("1"===this.chomp(1));case"R":return this.decodeReference();case"D":{const e=Number(this.upTo(":")),t=this.chomp(e);return Tr.decodeDictionary(t)}case"A":{const e=Number(this.upTo(":")),t=this.chomp(e);return Tr.decodeArray(t)}default:throw new Error(`Packaged entity decoding fail: unknown or unsupported primitive value type '${e}'`)}}decodeReference(){const e=Number(this.upTo(":")),t=this.chomp(e);this.validate("|");const n=Number(this.upTo(":")),r=this.chomp(n);this.validate("|");const i=Number(this.upTo(":")),s=this.typeMap.getL(i);if(!s)throw new Error(`Packaged entity decoding fail: invalid type index ${i} for reference '${t}|${r}'`);return new Kt({id:t,storageKey:r},new ut(s),this.pec)}}class Rr extends Tr{decodeSingleton(e){this.str=e;const t=Number(this.upTo(":")),n=this.chomp(t);this.validate("|");const r={};for(;this.str.length>0;){const e=this.upTo(":"),t=this.chomp(1);r[e]=this.decodeValue(t),this.validate("|")}const i=new(this.schema.entityClass())(r);return""!==n&&V.identify(i,n),i}}class Ir extends Tr{decodeSingleton(e){return this.decodeReference()}}class Or{constructor(e){this.logInfo=null;const t=new Uint8Array(e),n=[];let r=0;for(;r<t.byteLength;){let e=0,i=0;for(;;){const n=t[r++];if(e|=(127&n)<<i,!(128&n))break;i+=7}n.push(e)}if(n.length<4)throw new Error("emscripten metadata section should have at least 4 values; "+`got ${n.length}`);if(0!==n[0]||2!==n[1])throw new Error("emscripten metadata version should be 0.2; "+`got ${n[0]}.${n[1]}`);if(0!==n[2]||4!==n[3])throw new Error("emscripten ABI version should be 0.4; "+`got ${n[2]}.${n[3]}`);if(11!==n.length)throw new Error("emscripten metadata section should have 11 values; "+`got ${n.length}`);this.cfg={memSize:n[5],tableSize:n[6],globalBase:n[7],dynamicBase:n[8],dynamictopPtr:n[9]}}configureEnvironment(e,t,n){t.memory=new WebAssembly.Memory({initial:this.cfg.memSize,maximum:this.cfg.memSize}),t.heapU8=new Uint8Array(t.memory.buffer),t.heap32=new Int32Array(t.memory.buffer),t.heap32[this.cfg.dynamictopPtr>>2]=this.cfg.dynamicBase,Object.assign(n,{memory:t.memory,__memory_base:this.cfg.globalBase,table:new WebAssembly.Table({initial:this.cfg.tableSize,maximum:this.cfg.tableSize,element:"anyfunc"}),__table_base:0,DYNAMICTOP_PTR:this.cfg.dynamictopPtr,_emscripten_get_heap_size:()=>t.heapU8.length,_emscripten_resize_heap:e=>!1,_emscripten_memcpy_big:(e,n,r)=>t.heapU8.set(t.heapU8.subarray(n,n+r),e),_systemError:e=>{throw new Error(t.read(e))},abortOnCannotGrowMemory:e=>{throw new Error(`abortOnCannotGrowMemory(${e})`)},_setLogInfo:(e,n)=>this.logInfo=[t.read(e).split(/[/\\]/).pop(),n],___syscall146:(e,n)=>this.sysWritev(t,e,n)})}initializeInstance(e,t){}sysWritev(e,t,n){const r=()=>(n+=4,e.heap32[n-4>>2]),i=1===r()?console.log:console.error,s=r(),o=r();let a=this.logInfo?`[${this.logInfo[0]}:${this.logInfo[1]}] `:"",c=0;for(let t=0;t<o;t++){const n=e.heap32[s+8*t>>2],r=e.heap32[s+(8*t+4)>>2];for(let t=0;t<r;t++){const r=e.heapU8[n+t];0===r||10===r?(i(a),a=""):a+=String.fromCharCode(r)}c+=r}return this.logInfo=null,c}}class Nr{configureEnvironment(e,t,n){Object.assign(n,{Konan_js_arg_size:e=>1,Konan_js_fetch_arg:(e,t)=>"dummyArg",Konan_js_allocateArena:e=>{},Konan_js_freeArena:e=>{},write:e=>console.log(t.read(e)),flush:()=>{},Konan_notify_memory_grow:()=>this.updateMemoryViews(t),Konan_abort:e=>{throw new Error("Konan_abort("+t.read(e)+")")},Konan_exit:e=>{},Konan_date_now:e=>{const n=Date.now(),r=Math.floor(n/4294967295),i=Math.floor(n%4294967295);t.heap32[e]=i,t.heap32[e+1]=r}})}initializeInstance(e,t){this.updateMemoryViews(e),t.exports.Konan_js_main(1,0)}updateMemoryViews(e){e.memory=e.exports.memory,e.heapU8=new Uint8Array(e.memory.buffer),e.heap32=new Int32Array(e.memory.buffer)}}class Pr{constructor(e,t,n){this.particleMap=new Map,this.pec=e,this.loader=t,this.apiPort=n}async initialize(e){const t=await WebAssembly.compile(e),n=this.driverForModule(t),r={abort:()=>{throw new Error("Abort!")},_singletonSet:(e,t,n)=>this.getParticle(e).singletonSet(t,n),_singletonClear:(e,t)=>this.getParticle(e).singletonClear(t),_collectionStore:(e,t,n)=>this.getParticle(e).collectionStore(t,n),_collectionRemove:(e,t,n)=>this.getParticle(e).collectionRemove(t,n),_collectionClear:(e,t)=>this.getParticle(e).collectionClear(t),_onRenderOutput:(e,t,n)=>this.getParticle(e).onRenderOutput(t,n),_dereference:(e,t,n,r,i)=>this.getParticle(e).dereference(t,n,r,i),_render:(e,t,n,r)=>this.getParticle(e).renderImpl(t,n,r),_serviceRequest:(e,t,n,r)=>this.getParticle(e).serviceRequest(t,n,r),_resolveUrl:e=>this.resolve(e)};n.configureEnvironment(t,this,r);const i={NaN:NaN,Infinity:1/0};this.wasm=await WebAssembly.instantiate(t,{env:r,global:i}),this.exports=this.wasm.exports,n.initializeInstance(this,this.wasm)}driverForModule(e){const t=WebAssembly.Module.customSections(e,"emscripten_metadata");return 1===t.length?new Or(t[0]):new Nr}getParticle(e){return this.particleMap.get(e)}register(e,t){this.particleMap.set(t,e)}resolve(e){return this.store(this.loader.resolve(this.read(e)))}store(e){const t=this.exports._malloc(e.length+1);for(let n=0;n<e.length;n++)this.heapU8[t+n]=e.charCodeAt(n);return this.heapU8[t+e.length]=0,t}free(...e){e.forEach(e=>e&&this.exports._free(e))}read(e){let t="";for(;e<this.heapU8.length&&0!==this.heapU8[e];)t+=String.fromCharCode(this.heapU8[e++]);return t}}class Ar extends Gt{constructor(e,t){super(),this.handleMap=new Cr,this.encoders=new Map,this.decoders=new Map,this.typeMap=new Cr,this.id=e,this.container=t,this.exports=t.exports;const n=`_new${this.spec.name}`;if(!(n in this.exports))throw new Error(`wasm module does not export instantiator function '${n}' for particle '${this.spec.name}'`);this.innerParticle=this.exports[n](),this.container.register(this,this.innerParticle),setTimeout(()=>this.renderOutput(),100)}renderOutput(){this.exports._renderOutput&&this.exports._renderOutput(this.innerParticle)}async setHandles(e){for(const[t,n]of e){const e=this.container.store(t),r=this.exports._connectHandle(this.innerParticle,e,n.canRead,n.canWrite);if(this.container.free(e),0===r)throw new Error(`Wasm particle failed to connect handle '${t}'`);this.handleMap.set(n,r)}this.exports._init(this.innerParticle)}async onHandleSync(e,t){const n=this.handleMap.getL(e);if(!t)return void this.exports._syncHandle(this.innerParticle,n,0);const r=this.getEncoder(e.type);let i;i=e instanceof zt?this.container.store(r.encodeSingleton(t)):this.container.store(r.encodeCollection(t)),this.exports._syncHandle(this.innerParticle,n,i),this.container.free(i)}async onHandleUpdate(e,t){if(t.originator)return;const n=this.handleMap.getL(e),r=this.getEncoder(e.type);let i=0,s=0;e instanceof zt?t.data&&(i=this.container.store(r.encodeSingleton(t.data))):(i=this.container.store(r.encodeCollection(t.added||[])),s=this.container.store(r.encodeCollection(t.removed||[]))),this.exports._updateHandle(this.innerParticle,n,i,s),this.container.free(i,s)}async onHandleDesync(e){}singletonSet(e,t){const n=this.getHandle(e),r=this.getDecoder(n.type).decodeSingleton(this.container.read(t)),i=this.ensureIdentified(r,n);return n.set(r),i}singletonClear(e){this.getHandle(e).clear()}collectionStore(e,t){const n=this.getHandle(e),r=this.getDecoder(n.type).decodeSingleton(this.container.read(t)),i=this.ensureIdentified(r,n);return n.store(r),i}collectionRemove(e,t){const n=this.getHandle(e),r=this.getDecoder(n.type).decodeSingleton(this.container.read(t));n.remove(r)}collectionClear(e){this.getHandle(e).clear()}async dereference(e,t,n,r){const i=this.container.read(e),s=this.container.read(t),o=this.typeMap.getL(n),a=this.getEncoder(o),c=await Kt.retrieve(this.container.pec,i,s,o),l=this.container.store(a.encodeSingleton(c));this.exports._dereferenceResponse(this.innerParticle,r,l),this.container.free(l)}getEncoder(e){let t=this.encoders.get(e);return t||(t=Er.create(e,this.typeMap),this.encoders.set(e,t)),t}getDecoder(e){let t=this.decoders.get(e);return t||(t=Tr.create(e,this.typeMap,this.container.pec),this.decoders.set(e,t)),t}getHandle(e){const t=this.handleMap.getR(e);if(!t){const e=new Error(`wasm particle '${this.spec.name}' attempted to write to unconnected handle`),t=new b(e,"WasmParticle::getHandle",this.id,this.spec.name);throw this.container.apiPort.ReportExceptionInHost(t),e}return t}ensureIdentified(e,t){let n=0;return e instanceof V&&!V.isIdentified(e)&&(t.createIdentityFor(e),n=this.container.store(V.id(e))),n}output(e){this.container.apiPort.Output(this,e)}onRenderOutput(e,t){const n={};e&&(n.template=this.container.read(e)),t&&(n.model=Tr.decodeDictionary(this.container.read(t))),this.output(n)}renderSlot(e,t){const n=this.container.store(e),r=t.includes("template"),i=t.includes("model");this.exports._renderSlot(this.innerParticle,n,r,i),this.container.free(n)}renderHostedSlot(e,t,n){throw new Error("renderHostedSlot not implemented for wasm particles")}renderImpl(e,t,n){const r=this.slotProxiesByName.get(this.container.read(e));if(r){const e={templateName:"default"};t&&(e.template=this.container.read(t),r.requestedContentTypes.add("template")),n&&(e.model=Tr.decodeDictionary(this.container.read(n)),r.requestedContentTypes.add("model")),r.render(e)}}async serviceRequest(e,t,n){const r=this.container.read(e),i=Tr.decodeDictionary(this.container.read(t)),s=this.container.read(n),o=await this.service({call:r,...i}),a={};if("object"==typeof o)for(const e of Object.entries(o)){const[t,n]=e;a[t]="object"==typeof n?JSON.stringify(n):n+""}else a.value=o+"";const c=this.container.store(r),l=this.container.store(Er.encodeDictionary(a)),h=this.container.store(s);this.exports._serviceResponse(this.innerParticle,c,l,h),this.container.free(c,l,h)}fireEvent(e,t){const n=this.container.store(e),r=this.container.store(t.handler),i=this.container.store(Er.encodeDictionary(t.data||{}));this.exports._fireEvent(this.innerParticle,n,r,i),this.container.free(n,r,i)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Mr{constructor(e,t,n,r){this.particles=new Map,this.pendingLoads=[],this.scheduler=new Bt,this.keyedProxies={},this.wasmContainers={};const i=this;this.apiPort=new class extends vr{onDefineHandle(e,t,n){return O.useNewStorageStack?new Ge(e,i,t):Mt.newProxy(e,t,this,i,i.scheduler,n)}onGetBackingStoreCallback(e,t,n,r,s){let o;return O.useNewStorageStack?o=new Ge(r,i,t):(o=Mt.newProxy(r,t,this,i,i.scheduler,n)).storageKey=s,[o,()=>e(o,s)]}onCreateHandleCallback(e,t,n,r){let s;return[s=O.useNewStorageStack?new Ge(r,i,t):Mt.newProxy(r,t,this,i,i.scheduler,n),()=>e(s)]}onMapHandleCallback(e,t){return[t,()=>e(t)]}onCreateSlotCallback(e,t){return[t,()=>e(t)]}onInnerArcRender(e,t,n,r){e.renderHostedSlot(t,n,r)}onStop(){global.close&&global.close()}async onInstantiateParticle(e,t,n){return i.instantiateParticle(e,t,n)}async onReinstantiateParticle(e,t,n){g()(!1,"Not implemented")}async onReloadParticles(e){return i.reloadParticles(e)}onSimpleCallback(e,t){e(t)}onConstructArcCallback(e,t){e(t)}onAwaitIdle(e){i.idle.then(t=>{setTimeout(()=>this.Idle(e,i.relevance),0)})}onUIEvent(e,t,n){e.fireEvent(t,n)}onStartRender(e,t,n,r){e.addSlotProxy(new Sr(this,e,t,n)),e.renderSlot(t,r)}onStopRender(e,t){g()(e.hasSlotProxy(t),`Stop render called for particle ${e.spec.name} slot ${t} without start render being called.`),e.removeSlotProxy(t)}}(e),this.pecId=t,this.idGenerator=n,this.loader=r,r.setParticleExecutionContext(this)}generateID(){return this.idGenerator.newChildId(this.pecId).toString()}getStorageEndpoint(e){const t=this;let n;return{onProxyMessage:async r=>(r.id=await n,new Promise(n=>t.apiPort.ProxyMessage(e,r,e=>n(e)))),setCallback(r){n=new Promise(n=>t.apiPort.Register(e,t=>e.onMessage(t),e=>n(e)))},reportExceptionInHost(e){t.apiPort.ReportExceptionInHost(e)}}}innerArcHandle(e,t){const n=this;return{createHandle:async(r,i,s)=>new Promise((o,a)=>n.apiPort.ArcCreateHandle(e=>{const r=Vt({proxy:e,idGenerator:n.idGenerator,name:i,particleId:t});o(r),s&&e.register(s,r)},e,r,i)),mapHandle:async t=>new Promise((r,i)=>n.apiPort.ArcMapHandle(e=>{r(e)},e,t)),createSlot:async(t,r,i)=>new Promise((s,o)=>n.apiPort.ArcCreateSlot(e=>s(e),e,t,r,i)),loadRecipe:async t=>new Promise((r,i)=>n.apiPort.ArcLoadRecipe(e,t,e=>{e.error?i(e.error):r(e)}))}}getStorageProxy(e,t){return this.keyedProxies[e]||(this.keyedProxies[e]=new Promise((n,r)=>{this.apiPort.GetBackingStore((e,t)=>{this.keyedProxies[t]=e,n(e)},e,t)})),this.keyedProxies[e]}capabilities(e){const t={serviceRequest:(e,t,n)=>{this.apiPort.ServiceRequest(e,t,n)},output:(e,t)=>{this.apiPort.Output(e,t)}};return e&&(t.constructInnerArc=async e=>new Promise((t,n)=>this.apiPort.ConstructInnerArc(e=>t(this.innerArcHandle(e,void 0)),e))),t}async instantiateParticle(e,t,n){let r;const i=new Promise(e=>r=e);this.pendingLoads.push(i);const s=await this.createParticleFromSpec(e,t),o=new Map,a=[];return n.forEach((n,r)=>{this.createHandle(s,t,e,r,n,o,a)}),[s,async()=>{await this.assignHandle(s,t,e,o,a,i),r()}]}async reloadParticles(e){e.forEach(e=>{const t=this.particles.get(e);t.spec.implBlobUrl&&delete t.spec.implBlobUrl,t.spec.implFile.endsWith(".wasm")&&this.wasmContainers[t.spec.implFile]&&(this.wasmContainers[t.spec.implFile]=void 0)});const t=[];for(const n of e){let e;const r=new Promise(t=>e=t);this.pendingLoads.push(r);const i=this.particles.get(n),s=await this.createParticleFromSpec(n,i.spec),o=new Map,a=[];i.handles.forEach(e=>{this.createHandle(s,i.spec,n,e.name,e.storage,o,a),e.disable(i)}),t.push([s,async()=>{await this.assignHandle(s,i.spec,n,o,a,r),e();for(const e of i.getSlotNames())i.getSlot(e).rewire(s)}])}return t}createHandle(e,t,n,r,i,s,o){const a=t.handleConnectionMap.get(r),c=Vt({proxy:i,idGenerator:this.idGenerator,name:r,particleId:n,particle:e,canRead:a.isInput,canWrite:a.isOutput});s.set(r,c),o.push({proxy:i,particle:e,handle:c})}async assignHandle(e,t,n,r,i,s){await e.callSetHandles(r,e=>{const r=new b(e,"setHandles",n,t.name);this.apiPort.ReportExceptionInHost(r)}),i.forEach(({proxy:e,particle:t,handle:n})=>{if(e instanceof Mt)e.register(t,n);else{if(!(e instanceof Ge))throw new Error("Expecting a StorageProxy");e.registerHandle(n)}});const o=this.pendingLoads.indexOf(s);this.pendingLoads.splice(o,1)}async createParticleFromSpec(e,t){let n;if(t.implFile&&t.implFile.endsWith(".wasm"))(n=await this.loadWasmParticle(e,t)).setCapabilities(this.capabilities(!1));else{(n=new(await this.loader.loadParticleClass(t))).setCapabilities(this.capabilities(!0))}return this.particles.set(e,n),n}async loadWasmParticle(e,t){g()(t.name.length>0);let n=this.wasmContainers[t.implFile];if(!n){const e=await this.loader.loadBinaryResource(t.implFile);if(!e||0===e.byteLength)throw new Error(`Failed to load wasm binary '${t.implFile}'`);n=new Pr(this,this.loader,this.apiPort),await n.initialize(e),this.wasmContainers[t.implFile]=n}Ar.spec=t;const r=new Ar(e,n);return Ar.spec=null,r}get relevance(){const e=new Map;return this.particles.forEach(t=>{0!==t.relevances.length&&(e.set(t,t.relevances),t.relevances.length=0)}),e}get busy(){return!!(this.pendingLoads.length>0||this.scheduler.busy)||[...this.particles.values()].filter(e=>e.busy).length>0}get idle(){if(!this.busy)return Promise.resolve();const e=[...this.particles.values()].filter(e=>e.busy).map(async e=>e.idle);return Promise.all([this.scheduler.idle,...this.pendingLoads,...e]).then(()=>this.idle)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Dr(e){return(t,n)=>{const r=new Qn;new Mr(r.port1,t,n,e.clone());return r.port2}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Fr extends We{constructor(e,t,n,r,i,s,o,a,c,l,h,u=!1,d){super({type:e,id:t,name:n,originalId:s,claims:o,description:a,source:l,origin:h}),this.storageKey=r,this.storageProviderFactory=i,this.versionToken=c,this.referenceMode=u,this.model=d,this.unifiedStoreType="StorageStub"}on(e){return-1}off(e){}async activate(){return this.inflate()}async inflate(e){const t=e||this.storageProviderFactory,n=this.isBackedByManifest()?await t.construct(this.id,this.type,this.storageKey):await t.connect(this.id,this.type,this.storageKey);if(g()(null!=n,"inflating missing storageKey "+this.storageKey),this.isBackedByManifest()?n.referenceMode=this.referenceMode:this.referenceMode=n.referenceMode,n.storeInfo={...this.storeInfo},this.isBackedByManifest()){const e=null==this.versionToken?null:Number(this.versionToken);await n.fromLiteral({version:e,model:this.model})}return n}toLiteral(){}isBackedByManifest(){return void 0!==this.versionToken&&!!this.model}_compareTo(e){let t;return 0!==(t=Ue(this.name,e.name))?t:0!==(t=Ue(this.id,e.id))?t:0}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.Permuted="permuted",e.Independent="independent"}(br||(br={}));class jr{constructor(e,t){this._arc=e,this._args=t}get arc(){return this._arc}getResults({generated:e}){return e}async generateFrom(e){return this.generate({generated:e,population:[],terminal:[],generation:0})}}class $r{constructor(e){this.descendants=[],g()(e),this.tactic=e}onAction(e){this.currentAction=e}onResult(e){this.currentResult=e,this.updateList=[]}onResultDone(){this.runUpdateList(this.currentResult.result,this.updateList),this.currentResult=void 0,this.updateList=void 0}onActionDone(){this.currentAction=void 0}static walk(e,t,n){return t.onAction(n),e.forEach(e=>{t.onResult(e),t.onResultDone()}),t.onActionDone(),t.descendants}visit(e,...t){const n=e(this.currentResult.result,...t);this.isEmptyResult(n)||this.updateList.push({continuation:n,context:t})}runUpdateList(e,t){const n=[];if(t.length)switch(this.tactic){case br.Permuted:{let r=[[]];t.forEach(({continuation:e,context:t})=>{const n=[];"function"==typeof e&&(e=[e]),e.forEach(e=>{r.forEach(r=>{const i=r.slice();i.push({continuation:e,context:t}),n.push(i)})}),r=n});for(const t of r){const r=new Map,i=e.clone(r);let s=0;const o=t.filter(e=>null!==e.continuation);0!==o.length&&(o.forEach(({continuation:e,context:t})=>{s=e(i,...t.map(e=>r.get(e)||e))}),n.push({result:i,score:s}))}break}case br.Independent:t.forEach(({continuation:t,context:r})=>{"function"==typeof t&&(t=[t]),t.forEach(t=>{const i=new Map,s=e.clone(i);let o=0;o=null==t?0:t(s,...r.map(e=>i.get(e)||e)),n.push({result:s,score:o})})});break;default:throw new Error(`${this.tactic} not supported`)}for(const e of n)this.createDescendant(e.result,e.score)}createWalkerDescendant(e,t,n,r){g()(this.currentResult,"no current result"),g()(this.currentAction,"no current action"),this.currentResult.score&&(t+=this.currentResult.score),this.descendants.push({result:e,score:t,derivation:[{parent:this.currentResult,strategy:this.currentAction}],hash:n,valid:r})}isEmptyResult(e){return!e||(e.constructor===Array&&e.length<=0||(g()("function"==typeof e||e.length),!1))}}$r.Permuted=br.Permuted,$r.Independent=br.Independent;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Br extends $r{onResult(e){super.onResult(e);const t=e.result;if(this.onRecipe&&this.visit(this.onRecipe.bind(this)),this.onParticle)for(const e of t.particles)this.visit(this.onParticle.bind(this),e);if(this.onPotentialHandleConnection)for(const e of t.particles)if(e.spec)for(const t of e.spec.handleConnectionMap.values())e.connections[t.name]||this.visit(this.onPotentialHandleConnection.bind(this),e,t);if(this.onHandleConnection)for(const e of t.handleConnections)this.visit(this.onHandleConnection.bind(this),e);if(this.onHandle)for(const e of t.handles)this.visit(this.onHandle.bind(this),e);if(this.onPotentialSlotConnection)for(const e of t.particles)for(const[t,n]of e.getSlotSpecs())e.getSlotConnectionByName(t)||this.visit(this.onPotentialSlotConnection.bind(this),e,n);if(this.onSlotConnection)for(const e of t.slotConnections)this.visit(this.onSlotConnection.bind(this),e);if(this.onSlot)for(const e of t.slots)this.visit(this.onSlot.bind(this),e);if(this.onObligation)for(const e of t.obligations)this.visit(this.onObligation.bind(this),e);if(this.onRequiredParticle)for(const e of t.requires)for(const t of e.particles)this.visit(this.onRequiredParticle.bind(this),t)}createDescendant(e,t){const n=e.normalize(),r=n?e.digest():null;super.createWalkerDescendant(e,t,r,n)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Lr{static getClonedSlot(e,t){let n=e.updateToClone({selectedSlot:t}).selectedSlot;return n||(t.id&&(n=e.findSlotByID(t.id)),void 0===n?((n=e instanceof Fn?e.parent.newSlot(t.name):e.newSlot(t.name)).id=t.id,n):n)}static connectSlotConnection(e,t){const n=e.recipe;if(!e.targetSlot){const r=Lr.getClonedSlot(n,t);e.connectToSlot(r)}if(!e.targetSlot)throw new Error("missing targetSlot");g()(!t.id||!e.targetSlot.id||t.id===e.targetSlot.id,`Cannot override slot id '${e.targetSlot.id}' with '${t.id}'`),e.targetSlot.id=t.id||e.targetSlot.id,e.targetSlot.tags=[...t.tags]}static findAllSlotCandidates(e,t,n){const r=e.getSlandleConnectionByName(t.name);return{local:r&&r.targetSlot?[]:Lr._findSlotCandidates(e,t,e.recipe.slots),remote:Lr._findSlotCandidates(e,t,n.pec.slotComposer.getAvailableContexts())}}static _findSlotCandidates(e,t,n){const r=n.filter(n=>this.slotMatches(e,t,n));return r.sort((e,t)=>e.name<t.name),r}static slotMatches(e,t,n){if(!Lr.specMatch(t,n.spec))return!1;const r=e.getSlandleConnectionBySpec(t);return!!Lr.tagsOrNameMatch(t,n.spec,r,n)&&!!Lr.handlesMatch(e,n)}static specMatch(e,t){return e&&t&&e.isSet===t.isSet}static handlesMatch(e,t){return 0===t.handles.length||!!Object.values(e.connections).find(e=>t.handles.includes(e.handle)||e.handle&&e.handle.id&&t.handles.map(e=>e.id).includes(e.handle.id))}static tagsOrNameMatch(e,t,n,r){const i=[].concat(e.tags||[],n?n.tags:[],n&&n.targetSlot?n.targetSlot.tags:[]),s=[].concat(t.tags||[],r?r.tags:[],r?r.name:t.name?t.name:[]);return!!(i.length>0&&i.some(e=>s.includes(e)))||e.name===(r?r.name:t.name)}static replaceOldSlot(e,t,n){if(t&&(!t.id||t.id!==n.id)){if(void 0!==t.sourceConnection){if(void 0===n.sourceConnection)return!1;const e=Lr.getClonedSlot(t.sourceConnection.recipe,n);t.sourceConnection.providedSlots[t.name]=e}for(;t.consumeConnections.length>0;){const e=t.consumeConnections[0];e.disconnectFromSlot(),Lr.connectSlotConnection(e,n)}}return!0}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ur extends Br{constructor(e,t,n){super(e),this.arc=t,this.options=n}onHandle(e,t){const n=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]);if("`slot"===t.fate)return[];if(t.type.slandleType())return[];const r=this.arc;if(0===t.connections.length||t.id&&t.storageKey||!t.type||!t.fate)return n("No connections to handle or missing handle information");let i;if(t.id){if(!t.storageKey){let e;switch(t.fate){case"use":e=r.findStoreById(t.id);break;case"map":case"copy":e=r.context.findStoreById(t.id);break;case"create":case"?":break;default:throw new Error(`unexpected fate ${t.fate}`)}if(!e)return n("cannot find associated store");i=[e]}}else{Nn.directionCounts(t);switch(t.fate){case"use":i=r.findStoresByType(t.type,{tags:t.tags});break;case"map":case"copy":i=r.context.findStoresByType(t.type,{tags:t.tags,subtype:!0});break;case"create":case"?":i=[];break;default:throw new Error(`unexpected fate ${t.fate}`)}}return 0===i.length?n("Cannot find a handle matching requested type and tags."):0===(i=i.filter(n=>{for(const r of e.handles)if(n.id===r.id&&r!==t)return!1;return!0})).length?n("The only handles matching the requested type and tags are already present in this recipe"):i.map(e=>(t,n)=>(n.mapToStorage(e),0))}onSlotConnection(e,t){const n=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]),r=this.arc;if(t.isConnected())return n("Slot connection is already connected");const i=t.getSlotSpec(),s=t.particle,{local:o,remote:a}=Lr.findAllSlotCandidates(s,i,r),c=[...o,...a];if(1!==c.length)return n("There are multiple matching slots (match is ambiguous)");const l=c[0];return(e,t)=>(Lr.connectSlotConnection(t,l),1)}onPotentialSlotConnection(e,t,n){const r=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]),i=this.arc,{local:s,remote:o}=Lr.findAllSlotCandidates(t,n,i),a=[...s,...o];if(1!==a.length)return r("There are multiple matching slots for this slot spec (match is ambiguous)");const c=a[0];return(e,t,n)=>{const r=t.addSlotConnection(n.name);return Lr.connectSlotConnection(r,c),1}}onObligation(e,t){const n=t.from.instance,r=t.to.instance;for(const e of Object.values(n.connections))for(const t of Object.values(r.connections))if(e.handle&&e.handle===t.handle)return(e,t)=>(e.removeObligation(t),1);return[]}}class Hr extends jr{withOptions(e){this.options=e}async generate(e){return Ur.walk(this.getResults(e),new Ur(Ur.Permuted,this.arc,this.options),this)}}class zr{constructor(e){this.resolver=new Hr(e)}async resolve(e,t){if(!(e=e.clone()).normalize(t))return console.warn(`could not normalize a recipe: ${[...t.errors.values()].join("\n")}.\n${e.toString()}`),null;this.resolver.withOptions(t);const n=await this.resolver.generateFrom([{result:e,score:1}]);return 0===n.length?(t&&t.errors&&t.errors.set(e,"Resolver generated 0 recipes"),null):n[0].result}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class qr{static register(e,t){qr.registry[e]=t}static async request(e){let{service:t,invoke:n,call:r}=e;r&&([t,n]=r.split("."));const i=qr.registry[t];return i&&i[n]?await i[n](e):null}}qr.registry={},Object.freeze(qr),qr.register("test",{classify:async e=>({data:"it's a pig, that don't fly straight"})});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Wr{constructor(e,t,n){this._portByParticle=new Map,this.nextIdentifier=0,this.idleVersion=0,this.particles=[],this.close=()=>{n.forEach(e=>e.close()),this._apiPorts.forEach(e=>e.close())},this.arc=t,this.slotComposer=e;this._apiPorts=n.map(e=>new Vr(e,t))}choosePortForParticle(e){g()(!this._portByParticle.has(e),`port already found for particle '${e.spec.name}'`);const t=this._apiPorts.find(t=>e.isExternalParticle()===t.supportsExternalParticle());return g()(!!t,`No port found for '${e.spec.name}'`),this._portByParticle.set(e,t),this.getPort(e)}getPort(e){return g()(this._portByParticle.has(e),`Cannot get port for particle '${e.spec.name}'`),this._portByParticle.get(e)}stop(){this._apiPorts.forEach(e=>e.Stop())}get idle(){return null==this.idlePromise&&(this.idlePromise=new Promise((e,t)=>{this.idleResolve=e})),this.idleVersion=this.nextIdentifier,this._apiPorts.forEach(e=>e.AwaitIdle(this.nextIdentifier++)),this.idlePromise}get messageCount(){return[...this._apiPorts.values()].map(e=>e.messageCount).reduce((e,t)=>e+t,0)}sendEvent(e,t,n){this.getPort(e).UIEvent(e,t,n)}instantiate(e,t){this.particles.push(e);const n=this.choosePortForParticle(e);t.forEach((e,t)=>{n.DefineHandle(e,e.type.resolvedType(),t)}),n.InstantiateParticle(e,e.id.toString(),e.spec,t)}reinstantiate(e,t){g()(this.particles.find(t=>t===e),`Cannot reinstantiate nonexistent particle ${e.name}`);const n=this.getPort(e);t.forEach((e,t)=>{n.DefineHandle(e,e.type.resolvedType(),t)}),n.ReinstantiateParticle(e.id.toString(),e.spec,t)}reload(e){const t=new Map;e.forEach(e=>{const n=this.getPort(e);let r=t.get(n);r?r.push(e):(r=[e],t.set(n,r))}),t.forEach((e,t)=>{t.ReloadParticles(e,e.map(e=>e.id.toString()))})}startRender({particle:e,slotName:t,providedSlots:n,contentTypes:r}){this.getPort(e).StartRender(e,t,n,r)}stopRender({particle:e,slotName:t}){this.getPort(e).StopRender(e,t)}innerArcRender(e,t,n,r){this.getPort(e).InnerArcRender(e,t,n,r)}resolveIfIdle(e,t){e===this.idleVersion&&(this.idlePromise=void 0,this.idleResolve(t))}}class Vr extends _r{constructor(e,t){super(e,t),this.arc=t}onRender(e,t,n){this.arc.pec.slotComposer&&this.arc.pec.slotComposer.renderSlot(e,t,n)}onInitializeProxy(e,t){e.legacyOn(e=>this.SimpleCallback(t,e))}async onSynchronizeProxy(e,t){const n=await e.modelForSynchronization();this.SimpleCallback(t,n)}async onHandleGet(e,t){const n=await e.get();this.SimpleCallback(t,n)}async onHandleToList(e,t){const n=await e.toList();this.SimpleCallback(t,n)}onHandleSet(e,t,n,r){e.set(t,n,r)}onHandleClear(e,t,n){e.clear(t,n)}async onHandleStore(e,t,n,r){await e.store(n.value,n.keys,r),this.SimpleCallback(t,{})}async onHandleRemove(e,t,n,r){await e.remove(n.id,n.keys,r),this.SimpleCallback(t,{})}async onHandleRemoveMultiple(e,t,n,r){await e.removeMultiple(n,r),this.SimpleCallback(t,{})}async onHandleStream(e,t,n,r){this.SimpleCallback(t,await e.stream(n,r))}async onStreamCursorNext(e,t,n){this.SimpleCallback(t,await e.cursorNext(n))}onStreamCursorClose(e,t){e.cursorClose(t)}async onRegister(e,t,n){const r=(await e.activate()).on(async e=>(this.SimpleCallback(t,e),Promise.resolve(!0)));this.SimpleCallback(n,r)}async onProxyMessage(e,t,n){const r=await(await e.activate()).onProxyMessage(t);this.SimpleCallback(n,r)}onIdle(e,t){this.arc.pec.resolveIfIdle(e,t)}async onGetBackingStore(e,t,n){t||(t=this.arc.storageProviderFactory.baseStorageKey(n,this.arc.storageKey||"volatile"));const r=await this.arc.storageProviderFactory.baseStorageFor(n,t);this.GetBackingStoreCallback(r,e,n.collectionOf(),n.toString(),`${r.id}:${"String(Math.random())".slice(2,9)}`,t)}onConstructInnerArc(e,t){const n=this.arc.createInnerArc(t);this.ConstructArcCallback(e,n)}async onArcCreateHandle(e,t,n,r){const i=await t.createStore(n,r,null,[],"volatile");this.CreateHandleCallback(i,e,n,r,i.id)}onArcMapHandle(e,t,n){g()(this.arc.findStoreById(n.id),`Cannot map nonexistent handle ${n.id}`),this.MapHandleCallback({},e,n.id)}onArcCreateSlot(e,t,n,r,i){let s;this.arc.pec.slotComposer&&(s=this.arc.pec.slotComposer.createHostedSlot(t,n,r,i)),this.CreateSlotCallback({},e,s)}async onArcLoadRecipe(e,t,n){const r=await Yc.parse(t,{loader:e.loader,fileName:""}),i={providedSlotIds:{}};let s=void 0,o=r.recipes[0];if(o){for(const t of o.slots)if(t.id=t.id||e.generateID("slot").toString(),t.sourceConnection){const e=t.sourceConnection.particle.localName;e&&(i.providedSlotIds[`${e}.${t.name}`]=t.id)}const t=[];for(const e of o.handles){const n=this.arc.findStoreById(e.id)||r.findStoreById(e.id);n?e.mapToStorage(n):t.push(e)}if(t.length>0){let n=o;for(const t of[new zr(e),new zr(this.arc)])n=await t.resolve(n)||n;n===o?s=`Recipe couldn't load due to missing handles [recipe=${o}, missingHandles=${t.join("\n")}].`:o=n}if(!s){const n={errors:new Map};if(t.length>0||o.normalize(n))if(o.isResolved()){for(const e of r.stores)e instanceof Fr?await this.arc._registerStore(await e.inflate(),[]):await this.arc._registerStore(e,[]);e.instantiate(o)}else s=`Recipe is not resolvable:\n${o.toString({showUnresolved:!0})}`;else s=`Recipe ${o} could not be normalized:\n${[...n.errors.values()].join("\n")}`}}else s="No recipe defined";this.SimpleCallback(n,s?{error:s}:i)}onOutput(e,t){const n=this.arc.pec.slotComposer;n&&n.delegateOutput&&n.delegateOutput(this.arc,e,t)}onReportExceptionInHost(e){e.particleName||(e.particleName=this.arc.loadedParticleInfo.get(e.particleId).spec.name),function(e){for(const t of S)t(e)}(e)}async onServiceRequest(e,t,n){const r=await qr.request(t);this.SimpleCallback(n,r)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Kr{constructor(){this.next=Promise.resolve(),this.depth=0}get locked(){return 0!==this.depth}async acquire(){let e;const t=this.next.then(()=>(this.depth++,()=>{e(),this.depth--}));return this.next=new Promise(t=>{e=t}),t}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Qr extends Ve{constructor(e,t,n=""){super("volatile"),this.arcId=e,this.unique=t,this.path=n}toString(){return`${this.protocol}://${this.arcId}/${this.unique}@${this.path}`}childWithComponent(e){return new Qr(this.arcId,this.unique,`${this.path}/${e}`)}subKeyWithComponent(e){return new Qr(this.arcId,`${this.unique}/${e}`)}static fromString(e){const t=e.match(/^volatile:\/\/([^/]+)\/([^@]*)@(.*)$/);if(!t)throw new Error(`Not a valid VolatileStorageKey: ${e}.`);const[n,r,i,s]=t;return new Qr(ve.fromString(r),i,s)}}class Gr{constructor(){this.entries=new Map,this.token=Math.random()+""}deserialize(e,t){g()(!this.entries.has(t));const n={root:null,locations:{}};n.root={data:e.root,version:0,drivers:[]};for(const[t,r]of Object.entries(e.locations))n.locations[t]={data:r,version:0,drivers:[]};this.entries.set(t,n)}}let Zr=0;class Yr extends Ne{constructor(e,t,n){switch(super(e,t),this.pendingVersion=0,this.pendingModel=null,this.id=Zr++,this.memory=n,this.path=null,e instanceof Qr&&""!==e.path&&(this.path=e.path),t){case be.ShouldCreate:if(this.memory.entries.has(e.unique))throw new Error(`requested creation of memory location ${e} can't proceed as location already exists`);this.data={root:null,locations:{}},this.memory.entries.set(e.unique,this.data);break;case be.ShouldExist:if(!this.memory.entries.has(e.unique))throw new Error(`requested connection to memory location ${e} can't proceed as location doesn't exist`);case be.MayExist:{const t=this.memory.entries.get(e.unique);t?(this.data=t,this.pendingModel=this.localData(),this.pendingVersion=this.localVersion()):(this.data={locations:{},root:null},this.memory.entries.set(e.unique,this.data),this.memory.token=Math.random()+"");break}default:throw new Error(`unknown Exists code ${t}`)}this.pushLocalDriver(this)}getOrCreateEntry(){return this.path?(this.data.locations[this.path]||(this.data.locations[this.path]={data:null,version:0,drivers:[]}),this.data.locations[this.path]):(this.data.root||(this.data.root={data:null,version:0,drivers:[]}),this.data.root)}localData(){return this.getOrCreateEntry().data}localVersion(){return this.getOrCreateEntry().version}setLocalData(e){this.getOrCreateEntry().data=e}incrementLocalVersion(){this.getOrCreateEntry().version+=1}pushLocalDriver(e){this.getOrCreateEntry().drivers.push(e)}registerReceiver(e,t){this.receiver=e,this.pendingModel&&t!==this.memory.token&&e(this.pendingModel,this.pendingVersion),this.pendingModel=null}getToken(){return this.memory.token}async send(e,t){return await 0,this.localVersion()===t-1&&(this.setLocalData(e),this.incrementLocalVersion(),this.getOrCreateEntry().drivers.forEach(t=>{t!==this&&t.receiver&&t.receiver(e,this.localVersion())}),!0)}async write(e,t){throw new Error("Method not implemented.")}async read(e){throw new Error("Method not implemented.")}}class Xr{constructor(e){this.arc=e}willSupport(e){return"volatile"===e.protocol&&e.arcId.equal(this.arc.id)}async driver(e,t){if(!this.willSupport(e))throw new Error(`This provider does not support storageKey ${e.toString()}`);return new Yr(e,t,this.arc.volatileMemory)}static register(e){Pe.register(new Xr(e))}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Jr{constructor(e){this.handles="",this.resources="",this.interfaces="",this.dataResources=new Map,this.memoryResourceNames=new Map,this.arc=e}async serialize(){return`\nmeta\n  name: '${this.arc.id}'\n  ${this.serializeStorageKey()}\n\n${await this.serializeVolatileMemory()}\n\n${await this.serializeHandles()}\n\n${this.serializeParticles()}\n\n@active\n${this.arc.activeRecipe.toString()}`}async serializeVolatileMemory(){let e=0,t="";if(O.useNewStorageStack){for(const[n,r]of this.arc.volatileMemory.entries.entries()){this.memoryResourceNames.set(n,`VolatileMemoryResource${e}`);const i={root:r.root.data,locations:{}};for(const[e,t]of Object.entries(r.locations))i.locations[e]=t.data;t+=`resource VolatileMemoryResource${e++} // ${n}\n`+"  start\n"+JSON.stringify(i).split("\n").map(e=>"  "+e).join("\n")+"\n"}return t}return""}async _serializeStore(e,t){const n=e.type.getContainedType()||e.type;let r;n instanceof lt&&(this.interfaces+=n.interfaceInfo.toString()+"\n"),r="string"==typeof e.storageKey?this.arc.storageProviderFactory.parseStringAsKey(e.storageKey):e.storageKey;const i=[...this.arc.storeTags.get(e)||new Set],s=this.arc.activeRecipe.findHandle(e.id),o=s?s.originalId:null;let a=`'${e.id}'`;switch(o&&(a+=`!!'${o}'`),r.protocol){case"reference-mode":case"firebase":case"pouchdb":this.handles+=e.toManifestString({handleTags:i,overrides:{name:t}})+"\n";break;case"volatile":if(O.useNewStorageStack){const n=e.storageKey;this.handles+=e.toManifestString({handleTags:i,overrides:{name:t,source:this.memoryResourceNames.get(n.unique),origin:"resource",includeKey:n.toString()}})+"\n"}else{let n=[];if(!i.includes("volatile")){const t=await e.activate();n=(await t.serializeContents()).model.map(e=>{const{id:t,value:n}=e,r=e.index;if(null==n)return null;let i;if(n.rawData){i={$id:t};for(const e of Object.keys(n.rawData))i[e]=n.rawData[e]}else i=n;return void 0!==r&&(i.$index=r),i})}if(e.referenceMode&&n.length>0){const r=n[0].storageKey;if(!this.dataResources.has(r)){const n=`${t}_Data`;this.dataResources.set(r,n),e instanceof zn&&(await e.ensureBackingStore(),await this._serializeStore(e.backingStore,n))}const i=this.dataResources.get(r);n.forEach(e=>{e.storageKey=i})}const r="  ",s=JSON.stringify(n),o=`${t}Resource`;this.resources+=`resource ${o}\n`+r+"start\n"+s.split("\n").map(e=>r+e).join("\n")+"\n",this.handles+=e.toManifestString({handleTags:i,overrides:{name:t,source:o,origin:"resource"}})+"\n"}break;default:throw new Error(`unknown storageKey protocol ${r.protocol}`)}}async serializeHandles(){let e=0;const t=new Set,n=new Set,r=new Set(this.arc.context.stores.map(e=>e.id));for(const e of this.arc.activeRecipe.handles)if("map"===e.fate)t.add(this.arc.context.findManifestUrlForHandleId(e.id));else{if(e.immediateValue)continue;n.add(e.id)}for(const e of t.values())this.resources+=`import '${e}'\n`;for(const t of this.arc._stores)(O.useNewStorageStack||n.has(t.id)&&!r.has(t.id))&&await this._serializeStore(t,`Store${e++}`);return this.resources+this.interfaces+this.handles}serializeParticles(){const e=[];e.push(...this.arc.activeRecipe.particles.map(e=>e.spec)),e.push(...this.arc.activeRecipe.handles.filter(e=>e.immediateValue).map(e=>e.immediateValue));const t=[];return e.forEach(e=>{for(const n of e.handleConnections)n.type instanceof lt&&t.push(n.type.interfaceInfo.toString());t.push(e.toString())}),t.join("\n")}serializeStorageKey(){return this.arc.storageKey?`storageKey: '${this.arc.storageKey}'\n`:""}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ei{constructor({id:e,context:t,pecFactories:n,slotComposer:r,loader:i,storageKey:s,storageProviderFactory:o,speculative:a,innerArc:c,stub:l,inspectorFactory:h}){this._activeRecipe=new Dn,this._recipeDeltas=[],this.dataChangeCallbacks=new Map,this.storesById=new Map,this.storesByKey=new Map,this.storageKeys={},this.storeTags=new Map,this.storeDescriptions=new Map,this.innerArcsByParticle=new Map,this.instantiateMutex=new Kr,this.idGenerator=ye.newSession(),this.loadedParticleInfo=new Map,this.volatileMemory=new Gr,this._context=t||new Yc({id:e}),this.pecFactories=n&&n.length>0?n.slice():[Dr(i).bind(null)],r&&!r.arc&&(r.arc=this),"string"==typeof e?(console.error(`Arc created with string ID ${e}!!! This should be an object of type Id instead. This warning will turn into an `+"exception soon (end of April 2019)."),this.id=ve.fromString(e)):this.id=e,this.isSpeculative=!!a,this.isInnerArc=!!c,this.isStub=!!l,this._loader=i,this.inspectorFactory=h,this.inspector=h&&h.create(this),this.storageKey=s;const u=this.pecFactories.map(e=>e(this.generateID(),this.idGenerator));this.pec=new Wr(r,this,u),this.storageProviderFactory=o||new jo(this.id),this.volatileStorageDriverProvider=new Xr(this),Pe.register(this.volatileStorageDriverProvider)}get loader(){return this._loader}get modality(){return this.pec.slotComposer&&this.pec.slotComposer.modality?this.pec.slotComposer.modality:this.activeRecipe.isEmpty()?k.union(this.context.allRecipes.map(e=>e.modality)):this.activeRecipe.modality}dispose(){for(const e of this.innerArcs)e.dispose();if(this.pec.stop(),this.pec.close(),!this.isInnerArc&&this.pec.slotComposer){const e=this.allDescendingArcs;this.pec.slotComposer.consumers.forEach(t=>g()(e.includes(t.arc))),this.pec.slotComposer.dispose()}Pe.unregister(this.volatileStorageDriverProvider);for(const e of this._stores)Eo.getRuntime().unregisterStore(e.id,[...this.findStoreTags(e)])}async _waitForIdle(){for(;;){const e=this.pec.messageCount,t=this.innerArcs.length;if(await Promise.all([this.pec.idle,...this.innerArcs.map(async e=>e.idle)]),this.innerArcs.length===t&&this.pec.messageCount===e+2)break}}get idle(){if(this.waitForIdlePromise)return this.waitForIdlePromise;const e=this._waitForIdle().then(()=>this.waitForIdlePromise=null);return this.waitForIdlePromise=e,e}findInnerArcs(e){return this.innerArcsByParticle.get(e)||[]}get innerArcs(){return[].concat(...this.innerArcsByParticle.values())}get allDescendingArcs(){return[this].concat(...this.innerArcs.map(e=>e.allDescendingArcs))}createInnerArc(e){const t=this.generateID("inner"),n=new ei({id:t,pecFactories:this.pecFactories,slotComposer:this.pec.slotComposer,loader:this._loader,context:this.context,innerArc:!0,speculative:this.isSpeculative,inspectorFactory:this.inspectorFactory});let r=this.innerArcsByParticle.get(e);return r||(r=[],this.innerArcsByParticle.set(e,r)),r.push(n),n}async serialize(){return await this.idle,new Jr(this).serialize()}async persistSerialization(e){const t=this.storageProviderFactory;let n;n="string"==typeof this.storageKey?t.parseStringAsKey(this.storageKey).childKeyForArcInfo():this.storageKey.childKeyForArcInfo();const r=new dt,i=await t.connectOrConstruct("store",r,n.toString());i.referenceMode=!1,await i.set(r.newInstance(this.id,e))}static async deserialize({serialization:e,pecFactories:t,slotComposer:n,loader:r,fileName:i,context:s,inspectorFactory:o}){const a=await Yc.parse(e,{loader:r,fileName:i,context:s}),c=O.useNewStorageStack?null:a.storageProviderFactory,l=_e.fromString(a.meta.name),h=a.meta.storageKey,u=new ei({id:l,storageKey:h,slotComposer:n,pecFactories:t,loader:r,storageProviderFactory:c,context:s,inspectorFactory:o});await Promise.all(a.stores.map(async e=>{const t=a.storeTags.get(e);e.storageKey instanceof Qr&&u.volatileMemory.deserialize(e.storeInfo.model,e.storageKey.unique);const n=await e.activate();await u._registerStore(n.baseStore,t)}));const d=a.activeRecipe.clone(),p={errors:new Map};return g()(d.normalize(p),`Couldn't normalize recipe ${d.toString()}:\n${[...p.errors.values()].join("\n")}`),await u.instantiate(d),u}get context(){return this._context}get activeRecipe(){return this._activeRecipe}get allRecipes(){return[this.activeRecipe].concat(this.context.allRecipes)}get recipes(){return[this.activeRecipe]}get recipeDeltas(){return this._recipeDeltas}loadedParticleSpecs(){return[...this.loadedParticleInfo.values()].map(({spec:e})=>e)}async reinstantiateParticle(e){const t=await this._getParticleInstantiationInfo(e);this.pec.reinstantiate(e,t.stores)}async _instantiateParticle(e){e.id||(e.id=this.generateID("particle"));const t=await this._getParticleInstantiationInfo(e);this.pec.instantiate(e,t.stores)}async _getParticleInstantiationInfo(e){const t={spec:e.spec,stores:new Map};this.loadedParticleInfo.set(e.id.toString(),t),e.isExternalParticle()||await this._provisionSpecUrl(e.spec);for(const[n,r]of Object.entries(e.connections))if("`slot"!==r.handle.fate){const e=this.findStoreById(r.handle.id);g()(e,`can't find store of id ${r.handle.id}`),g()(void 0!==t.spec.handleConnectionMap.get(n),"can't connect handle to a connection that doesn't exist"),t.stores.set(n,e)}return t}async _provisionSpecUrl(e){if(e.implFile&&!e.implBlobUrl&&this.loader){const t=await this.loader.provisionObjectUrl(e.implFile);t&&e.setImplBlobUrl(t)}}generateID(e=""){return this.idGenerator.newChildId(this.id,e)}get _stores(){return[...this.storesById.values()]}async cloneForSpeculativeExecution(){const e=new ei({id:this.generateID(),pecFactories:this.pecFactories,context:this.context,loader:this._loader,speculative:!0,innerArc:this.isInnerArc,inspectorFactory:this.inspectorFactory}),t=new Map;for(const n of this._stores){const r=await e.storageProviderFactory.construct(n.id,n.type,"volatile");await r.cloneFrom(await n.activate()),t.set(n,r),this.storeDescriptions.has(n)&&e.storeDescriptions.set(r,this.storeDescriptions.get(n))}this.loadedParticleInfo.forEach((n,r)=>{const i=new Map;n.stores.forEach((e,n)=>i.set(n,t.get(e))),e.loadedParticleInfo.set(r,{spec:n.spec,stores:i})});const{cloneMap:n}=this._activeRecipe.mergeInto(e._activeRecipe);this._recipeDeltas.forEach(t=>e._recipeDeltas.push({particles:t.particles.map(e=>n.get(e)),handles:t.handles.map(e=>n.get(e)),slots:t.slots.map(e=>n.get(e)),patterns:t.patterns}));for(const[t,r]of this.innerArcsByParticle.entries())e.innerArcsByParticle.set(n.get(t),await Promise.all(r.map(async e=>e.cloneForSpeculativeExecution())));for(const n of t.values())await e._registerStore(n,[]);return e}async instantiate(e){g()(e.isResolved(),`Cannot instantiate an unresolved recipe: ${e.toString({showUnresolved:!0})}`),g()(e.isCompatible(this.modality),`Cannot instantiate recipe ${e.toString()} with [${e.modality.names}] modalities in '${this.modality.names}' arc`);const t=await this.instantiateMutex.acquire();try{await this._doInstantiate(e)}finally{t()}}async mergeIntoActiveRecipe(e){const{handles:t,particles:n,slots:r}=e.mergeInto(this._activeRecipe);this._recipeDeltas.push({particles:n,handles:t,slots:r,patterns:e.patterns}),r.forEach(e=>e.id=e.id||this.generateID("slot").toString()),t.forEach(e=>{e.toSlot()&&(e.id=e.id||this.generateID("slandle").toString())});for(const e of t){const t=this.context.findStoreById(e.id);if(["copy","create"].includes(e.fate)||"map"===e.fate&&t instanceof Fr&&t.isBackedByManifest()){let t=e.type;"create"===e.fate&&g()(t.maybeEnsureResolved(),`Can't assign resolved type to ${t}`),t=t.resolvedType(),g()(t.isResolved(),`Can't create handle for unresolved type ${t}`);const n=await this.createStore(t,null,this.generateID().toString(),e.tags,e.immediateValue?"volatile":null);if(e.immediateValue){const t=e.immediateValue,r=e.type;g()(r instanceof lt&&r.interfaceInfo.particleMatches(t));const i=t.clone().toLiteral();i.id=n.id,await n.set(i)}else if(["copy","map"].includes(e.fate)){const t=this.context.findStoreById(e.id),r=await t.activate();g()(r,`Cannot find store ${e.id}`);const i=await n.activate();await i.cloneFrom(r),this._tagStore(n,this.context.findStoreTags(t)),n.storeInfo.name=t.name&&`Copy of ${t.name}`;const s=this.getStoreDescription(t);s&&this.storeDescriptions.set(n,s)}e.id=n.id,e.fate="use",e.storageKey=n.storageKey}else if(!this.storesById.has(e.id)&&"`slot"!==e.fate){let t=e.storageKey;t||(t=this.keyForId(e.id)),g()(t,`couldn't find storage key for handle '${e}'`);const n=e.type.resolvedType();if(g()(n.isResolved()),"string"!=typeof t)throw new Error("Need to implement storageNG code path here!");{const r=await this.storageProviderFactory.connect(e.id,n,t);g()(r,`store '${e.id}' was not found (${t})`),await this._registerStore(r,e.tags)}}}return{handles:t,particles:n,slots:r}}async _doInstantiate(e){const{handles:t,particles:n,slots:r}=await this.mergeIntoActiveRecipe(e);await Promise.all(n.map(e=>this._instantiateParticle(e))),this.pec.slotComposer&&await this.pec.slotComposer.initializeRecipe(this,n),this.inspector&&await this.inspector.recipeInstantiated(n,this.activeRecipe.toString())}async createStore(e,t,n,r,i){if(g()(e instanceof nt,`can't createStore with type ${e} that isn't a Type`),O.useNewStorageStack&&this.storesByKey.has(i))return this.storesByKey.get(i);e instanceof ct&&(e=new ot(e)),null==n&&(n=this.generateID().toString()),null==i&&("string"==typeof this.storageKey?i=this.storageProviderFactory.parseStringAsKey(this.storageKey).childKeyForHandle(n).toString():this.storageKey&&(i=this.storageKey.childKeyForHandle(n)));let s;if((null==i||(e=>e&&e.includes("volatile"))(r))&&(i=O.useNewStorageStack?new Qr(this.id,n):"volatile"),O.useNewStorageStack){if("string"==typeof i)throw new Error("Can't use string storage keys with the new storage stack.");e.isEntity&&(e=new rt(e)),s=new Qe({storageKey:i,exists:be.MayExist,type:e,id:n,name:t})}else{if("string"!=typeof i)throw new Error("Can't use new-style storage keys with the old storage stack.");s=await this.storageProviderFactory.construct(n,e,i),g()(s,`failed to create store with id [${n}]`),s.storeInfo.name=t}if(await this._registerStore(s,r),i instanceof Ke&&O.useNewStorageStack){const n=new ut(e.getContainedType()),r=e.isSingleton?new rt(n):new ot(n);await this.createStore(r,t?t+"_referenceContainer":null,null,[],i.storageKey),await this.createStore(new ot(e.getContainedType()),t?t+"_backingStore":null,null,[],i.backingKey)}return s}async _registerStore(e,t){g()(!this.storesById.has(e.id),`Store already registered '${e.id}'`),t=t||[],t=Array.isArray(t)?t:[t],this.storesById.set(e.id,e),this.storesByKey.set(e.storageKey,e),this.storeTags.set(e,new Set(t)),this.storageKeys[e.id]=e.storageKey,(await e.activate()).on(async()=>this._onDataChange()),Eo.getRuntime().registerStore(e,t)}_tagStore(e,t){g()(this.storesById.has(e.id)&&this.storeTags.has(e),`Store not registered '${e.id}'`);const n=this.storeTags.get(e);(t=t||new Set).forEach(e=>n.add(e))}_onDataChange(){for(const e of this.dataChangeCallbacks.values())e();return!0}onDataChange(e,t){this.dataChangeCallbacks.set(t,e)}clearDataChange(e){this.dataChangeCallbacks.delete(e)}static _typeToKey(e){const t=e.getContainedType();if(t){const e=this._typeToKey(t);if(e)return`list:${e}`}else{if(e instanceof it)return e.entitySchema.name;if(e instanceof lt)return e.interfaceInfo;if(e instanceof st&&e.isResolved())return ei._typeToKey(e.resolvedType())}return null}findStoresByType(e,t){const n=ei._typeToKey(e);let r=[...this.storesById.values()].filter(t=>{if(n){const e=ei._typeToKey(t.type);if(n===e)return!0}else{if(e instanceof st&&!e.isResolved()&&t.type instanceof it)return!0;const n=e.getContainedType();if(n&&n instanceof st&&!n.isResolved()&&e.tag===t.type.tag)return!0}return!1});return t&&t.tags&&t.tags.length>0&&(r=r.filter(e=>0===t.tags.filter(t=>!this.storeTags.get(e).has(t)).length)),r.filter(t=>!!Bn.effectiveType(e,[{type:t.type,direction:t.type instanceof lt?"host":"inout"}]))}findStoreById(e){const t=this.storesById.get(e);return null==t?this._context.findStoreById(e):t}findStoreTags(e){return this.storeTags.has(e)?this.storeTags.get(e):this._context.findStoreTags(e)}getStoreDescription(e){return g()(e,"Cannot fetch description for nonexistent store"),this.storeDescriptions.get(e)||e.description}getVersionByStore({includeArc:e=!0,includeContext:t=!1}){const n={};return e&&this.storesById.forEach((e,t)=>n[t]=e.versionToken),t&&this._context.allStores.forEach(e=>n[e.id]=e.versionToken),n}keyForId(e){return this.storageKeys[e]}toContextString(){const e=[];return[...this.storesById.values()].sort(qe).forEach(t=>{e.push(t.toManifestString({handleTags:[...this.storeTags.get(t)]}))}),this._activeRecipe.isEmpty()||e.push(this._activeRecipe.toString()),e.join("\n")}get apiChannelMappingId(){return this.id.toString()}get idGeneratorForTesting(){return this.idGenerator}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ti{constructor(){this.map=new Map,this.nextID=0}getOrCreateCache(e){return this.map.has(e)||this.map.set(e,new Map),this.map.get(e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ni extends qn{constructor(){super(...arguments),this.nextID=0}_isSelectedDescription(e){return super._isSelectedDescription(e)||!!e.template&&!!e.model}_combineSelectedDescriptions(e,t){const n=new Map;for(const r of e){if(this.seenParticles.has(r._particle))continue;let{template:e,model:i}=this._retrieveTemplateAndModel(r,n.size,t||{});Object.keys(i).map(t=>{return this._initSubTokens(i[t],r).map(n=>{const r=this.tokenToString(n);if(null==r)return!1;if(r&&r.template&&r.model)e=e.replace(`{{${t}}}`,r.template),delete i[t],i={...i,...r.model};else{const n=`${t}${++this.nextID}`;e=e.replace(`{{${t}}}`,`{{${n}}}`),delete i[t],i[n]=r}return!0}).every(e=>!!e)}).every(e=>!!e)&&n.set(r,{template:e,model:i})}const r=[];if(e.forEach(e=>{n.has(e)&&r.push(n.get(e))}),r.length>0){const e=this._joinDescriptions(r);return t&&t.skipFormatting||(e.template+="."),e}}_retrieveTemplateAndModel(e,t,n){if(e._template_&&e._model_)return{template:e._template_,model:JSON.parse(e._model_)};g()(e.pattern,"Description must contain template and model, or pattern");let r="";const i={};return this._initTokens(e.pattern,e).forEach((e,s)=>{if(e.text)r=r.concat(`${0!==t||0!==s||n.skipFormatting?e.text:e.text[0].toUpperCase()+e.text.slice(1)}`);else{const t=e.fullName.replace(/[.{}_$]/g,"");let o="";0!==s||n.skipFormatting||(r=r.concat("<style>\n            [firstletter]::first-letter { text-transform: capitalize; }\n            [firstletter] {display: inline-block}\n            </style>"),o=" firstletter"),r=r.concat(`<span${o}>{{${t}}}</span>`),i[t]=e.fullName}}),{template:r,model:i}}_capitalizeAndPunctuate(e){if("string"==typeof e)return{template:super._capitalizeAndPunctuate(e),model:{}};const t=e.template.match(/<[a-zA-Z0-9]+>{{([a-zA-Z0-9]*)}}<\/[a-zA-Z0-9]+>/);if(t&&t.length>1&&e.model[t[1]]){const n=e.model[t[1]];n.length>0&&(e.model[t[1]]=`${n[0].toUpperCase()}${n.substr(1)}`)}return e.template+=".",e}_joinDescriptions(e){if(e.every(e=>"string"==typeof e))return super._joinDescriptions(e);const t={template:"",model:{}},n=e.length;return e.forEach((e,r)=>{let i;"string"==typeof e&&(e={template:e,model:{}}),t.template+=e.template,t.model={...t.model,...e.model},r<n-2?i=", ":r===n-2&&(i=["",""," and ",", and "][Math.min(3,n)]),i&&(t.template+=i)}),t}_joinTokens(e){if(e.every(e=>"string"==typeof e))return super._joinTokens(e);const t=(e=e.map(e=>"object"!=typeof e?{template:`<span>{{text${++this.nextID}}}</span>`,model:{[`text${this.nextID}`]:e}}:e)).filter(e=>e&&!!e.template&&!!e.model);return{template:t.map(e=>e.template).join(""),model:t.map(e=>e.model).reduce((e,t)=>({...e,...t}),{})}}_combineDescriptionAndValue(e,t,n){if(t.template&&t.model)return{template:`${t.template} (${n.template})`,model:{...t.model,...n.model}};const r=`${e.handleName}Description${++this.nextID}`;return{template:`<span>{{${r}}}</span> (${n.template})`,model:{[r]:t,...n.model}}}_formatEntityProperty(e,t,n){const r=`${e}${t.join("")}Value${++this.nextID}`;return{template:`<b>{{${r}}}</b>`,model:{[`${r}`]:n}}}_formatCollection(e,t){const n=`${e}${++this.nextID}`;return t[0].rawData.name?t.length>2?{template:`<b>{{${n}FirstName}}</b> plus <b>{{${n}OtherCount}}</b> other items`,model:{[`${n}FirstName`]:t[0].rawData.name,[`${n}OtherCount`]:t.length-1}}:{template:t.map((e,t)=>`<b>{{${n}${t}}}</b>`).join(", "),model:Object.assign({},...t.map((e,t)=>({[`${n}${t}`]:e.rawData.name})))}:{template:`<b>{{${n}Length}}</b> items`,model:{[`${n}Length`]:t.length}}}_formatBigCollection(e,t){return{template:`collection of items like {{${e}FirstName}}`,model:{[`${e}FirstName`]:t.rawData.name}}}_formatSingleton(e,t){const n=super._formatSingleton(e,t);if(n)return{template:`<b>{{${e}Var}}</b>`,model:{[`${e}Var`]:n}}}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var ri='\n  icon {\n    font-family: "Material Icons";\n    font-size: 24px;\n    font-style: normal;\n    -webkit-font-feature-settings: "liga";\n    -webkit-font-smoothing: antialiased;\n    cursor: pointer;\n    user-select: none;\n    flex-shrink: 0;\n    /* partial FOUC prevention */\n    display: inline-block;\n    width: 24px;\n    height: 24px;\n    overflow: hidden;\n  }\n  icon[hidden] {\n    /* required because of display rule above,\n    display rule required for overflow: hidden */\n    display: none;\n  }\n';
/**
 * @license
 * Copyright (c) 2016 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const ii=function(e,t,n){n=n||[];for(const r in t){const i=t[r];if(i){const t=e.childNodes[r];n[i.key]=t.nodeType===Node.TEXT_NODE?t.parentElement:t,i.sub&&ii(t,i.sub,n)}}return n},si=function(e,t,n){if(ai(e,t,n,"textContent",e.textContent))return e.textContent="",!0},oi=function(e,t,n){if(e.hasAttributes()){let r=!1;for(let i,s=e.attributes,o=s.length-1;o>=0&&(i=s[o]);o--)(ci(e,t,n,i.name,i.value)||ai(e,t,n,i.name,i.value)||li(e,t,n,i.name,i.value))&&(e.removeAttribute(i.name),r=!0);return r}},ai=function(e,t,n,r,i){if("{{"===i.slice(0,2)){"class"===r&&(r="className");let e=i.slice(2,-2);const s=e.split(":");return 2===s.length&&(r=s[0],e=s[1]),hi(n,t,"mustaches",r,e),"$"===e[0]&&hi(n,"xlate",e,!0),!0}},ci=function(e,t,n,r,i){if("on-"===r.slice(0,3))return"{{"===i.slice(0,2)&&(i=i.slice(2,-2),console.warn(`Xen: event handler for '${r}' expressed as a mustache, which is not supported. Using literal value '${i}' instead.`)),hi(n,t,"events",r.slice(3),i),!0},li=function(e,t,n,r,i){if("xen:forward"===r)return hi(n,t,"events","xen:forward",i),!0},hi=function(e,t,n,r,i){const s=e[t]||(e[t]=Object.create(null));(s[n]||(s[n]={}))[r]=i},ui=new class{constructor(e){this.cb=e}annotate(e,t,n){return this.notes=t,this.opts=n||0,this.key=this.opts.key||0,t.locator=this._annotateSubtree(e),t}_annotateSubtree(e){let t;for(let n,r=0,i=e.firstChild,s=null;i;r++){const o=this._annotateNode(i);o&&((t=t||{})[r]=o),(n=s?s.nextSibling:e.firstChild)===i?(s=i,i=i.nextSibling):(i=n,r--)}return t}_annotateNode(e){const t=this.key++,n=this.cb(e,t,this.notes,this.opts),r=this._annotateSubtree(e);if(n||r){const e=Object.create(null);return e.key=t,r&&(e.sub=r),e}}}((function(e,t,n,r){let i=!1;switch(r.annotator&&r.annotator(e,t,n,r)&&(i=!0),e.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:break;case Node.ELEMENT_NODE:return i||oi(e,t,n);case Node.TEXT_NODE:return i||si(e,t,n)}return i})),di=function(e,t,n){for(const r in e){const i=t[r],s=e[r]&&e[r].events;if(i&&s)for(const e in s)n(i,e,s[e])}},pi=function(e,t,n,r){t.addEventListener(n,(function(t){return e[r]?e[r](t,t.detail):e.defaultHandler?e.defaultHandler(r,t):void 0}))},fi=function(e,t,n,r){const i=t.slice(-1);if("style%"===t||"style"===t||"xen:style"===t)"string"==typeof n?e.style.cssText=n:Object.assign(e.style,n);else if("$"==i){const r=t.slice(0,-1);"boolean"==typeof n||void 0===n?gi(e,r,Boolean(n)):e.setAttribute(r,n)}else"textContent"===t?n&&(n.$template||n.template)?mi(e,n,r):e.textContent=n||"":"unsafe-html"===t?e.innerHTML=n||"":"value"===t?e.value!==n&&(e.value=n):e[t]=n},gi=function(e,t,n){e[(void 0===n?!e.hasAttribute(t):n)?"setAttribute":"removeAttribute"](t,"")},mi=function(e,t,n){let{template:r,models:i}=t;if(r)r=wi(r);else{r=e.getRootNode().querySelector(`template[${t.$template}]`)}yi(e,n,r,i)},yi=function(e,t,n,r){let i,s=e.firstElementChild;for(n&&r&&r&&r.forEach((r,o)=>{if(i=s&&s.nextElementSibling,!s){const r=_i(n).events(t);(s=r.root.firstElementChild)&&(s._subtreeDom=r,e.appendChild(s),!n._shapeWarning&&r.root.firstElementChild&&(n._shapeWarning=!0,console.warn("xen-template: subtemplate has multiple root nodes: only the first is used.",n)))}s&&(s._subtreeDom.set(r),s=i)});s;)i=s.nextElementSibling,s.remove(),s=i},_i=function(e,t){const n=function(e,t,n){return e._notes||(e._notes=ui.annotate(e.content,{},t,n))}(e=wi(e),t),r=document.importNode(e.content,!0),i=r.firstElementChild,s=ii(r,n.locator);return{root:r,notes:n,map:s,firstElement:i,$(e){return this.root.querySelector(e)},set:function(e){return e&&function(e,t,n,r){if(n)for(const i in e){const s=t[i];if(s){s.scope=n;const t=e[i].mustaches;for(const e in t){const i=t[e];i in n&&fi(s,e,n[i],r)}}}}(n,s,e,this.controller),this},events:function(e){return e&&"function"!=typeof e&&(e=pi.bind(this,e)),this.controller=e,e&&di(n,s,e),this},forward:function(){return di(n,s,(e,t,n)=>{e.addEventListener(t,r=>{const i={eventName:t,handlerName:n,detail:r.detail,target:r.target};vi(e,"xen:forward",i,{bubbles:!0})})}),this},appendTo:function(e){return this.root?e.appendChild(this.root):console.warn("Xen: cannot appendTo, template stamped no DOM"),this.root=e,this}}},vi=(e,t,n,r)=>{const i=r||{};i.detail=n;const s=new CustomEvent(t,i);return e.dispatchEvent(s),s.detail},wi=e=>"string"==typeof e?bi(e):e,bi=e=>Object.assign(document.createElement("template"),{innerHTML:e}),Si={createTemplate:bi,setBoolAttribute:gi,stamp:_i,takeNote:hi};
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ci{}Ci.alwaysTrue=()=>!0,Ci.alwaysFalse=()=>!1;
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ei{constructor(e,t=null){this.slotConsumers=[],this.id=e,this.sourceSlotConsumer=t}addSlotConsumer(e){this.slotConsumers.push(e),e.slotContext=this}clearSlotConsumers(){this.slotConsumers.forEach(e=>e.slotContext=null),this.slotConsumers.length=0}}class ki extends Ei{constructor(e,t,n){super(e,t),this._containerAvailable=!1,g()(t),this.storeId=n,t.addHostedSlotContexts(this)}onRenderSlot(e,t,n){this.sourceSlotConsumer.arc.pec.innerArcRender(this.sourceSlotConsumer.consumeConn.particle,this.sourceSlotConsumer.consumeConn.name,this.id,e.formatHostedContent(t))}addSlotConsumer(e){super.addSlotConsumer(e),this.containerAvailable&&e.startRender()}get containerAvailable(){return this._containerAvailable}set containerAvailable(e){if(this._containerAvailable!==e){this._containerAvailable=e;for(const t of this.slotConsumers)e?t.startRender():t.stopRender()}}}class xi extends Ei{constructor(e,t,n,r,i,s=null){super(e,s),this.tags=[],g()(Boolean(r)!==Boolean(i),"Exactly one of either container or slotSpec may be set"),g()(Boolean(i)==Boolean(i),"Spec and source slot can only be set together"),this.name=t,this.tags=n||[],this._container=r,this.spec=i||new Nt({name:t}),this.sourceSlotConsumer&&this.sourceSlotConsumer.directlyProvidedSlotContexts.push(this),this.handles=this.spec&&this.sourceSlotConsumer?this.spec.handles.map(e=>this.sourceSlotConsumer.consumeConn.particle.connections[e].handle).filter(e=>void 0!==e):[]}onRenderSlot(e,t,n){e.setContent(t,n)}get container(){return this._container}get containerAvailable(){return Boolean(this._container)}static createContextForContainer(e,t,n,r){return new xi(e,t,r,n,null)}isSameContainer(e){return this.spec.isSet?Boolean(this.container)===Boolean(e)&&(!this.container||Object.keys(this.container).length===Object.keys(e).length&&Object.keys(this.container).every(t=>Object.keys(e).some(e=>e===t))&&Object.values(this.container).every(t=>Object.values(e).some(e=>e===t))):!e&&!this.container||this.container===e}set container(e){if(this.isSameContainer(e))return;const t=this.container;this._container=e,this.slotConsumers.forEach(e=>e.onContainerUpdate(this.container,t))}addSlotConsumer(e){super.addSlotConsumer(e),this.container&&e.onContainerUpdate(this.container,null)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ti{constructor(e,t,n){this.directlyProvidedSlotContexts=[],this.hostedSlotContexts=[],this._renderingBySubId=new Map,this.innerContainerBySlotId={},this.arc=e,this.consumeConn=t,this.containerKind=n}getRendering(e){return this._renderingBySubId.get(e)}get renderings(){return[...this._renderingBySubId.entries()]}addRenderingBySubId(e,t){this._renderingBySubId.set(e,t)}addHostedSlotContexts(e){e.containerAvailable=Boolean(this.slotContext&&this.slotContext.containerAvailable),this.hostedSlotContexts.push(e)}get allProvidedSlotContexts(){return[...this.generateProvidedContexts()]}findProvidedContext(e){return this.generateProvidedContexts(e).next().value}*generateProvidedContexts(e=Ci.alwaysTrue){for(const t of this.directlyProvidedSlotContexts)e(t)&&(yield t);for(const t of this.hostedSlotContexts)for(const n of t.slotConsumers)yield*n.generateProvidedContexts(e)}onContainerUpdate(e,t){g()(this.slotContext instanceof xi,"Container can only be updated in non-hosted context");const n=this.slotContext;if(e!==t){const e=new Map;n&&n.spec.isSet?Object.keys(n.container||{}).forEach(t=>e.set(t,n.container[t])):e.set(void 0,n.container);for(const[t,n]of e){this._renderingBySubId.has(t)||this._renderingBySubId.set(t,{});const e=this.getRendering(t);e.container&&this.isSameContainer(e.container,n)||(e.container&&this.clearContainer(e),e.container=this.createNewContainer(n,t))}for(const[t,n]of this.renderings)e.has(t)||(this.deleteContainer(n.container),this._renderingBySubId.delete(t))}Boolean(e)!==Boolean(t)&&(e?this.startRender():this.stopRender()),this.hostedSlotContexts.forEach(t=>t.containerAvailable=Boolean(e))}createProvidedContexts(){return g()(this.consumeConn.getSlotSpec(),"Missing consume connection spec"),this.consumeConn.getSlotSpec().provideSlotConnections.map(e=>new xi(this.consumeConn.providedSlots[e.name].id,e.name,[],null,e,this))}updateProvidedContexts(){this.allProvidedSlotContexts.forEach(e=>{e.container=e.sourceSlotConsumer.getInnerContainer(e.id)})}startRender(){if(this.consumeConn&&this.startRenderCallback){const e=new Map(this.allProvidedSlotContexts.map(e=>[e.name,e.id]));this.startRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name,providedSlots:e,contentTypes:this.constructRenderRequest()})}}stopRender(){this.consumeConn&&this.stopRenderCallback&&this.stopRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name})}setContent(e,t){e&&Object.keys(e).length>0&&this.description&&(e.descriptions=this._populateHandleDescriptions()),this.eventHandler=t;for(const[t,n]of this.renderings)this.setContainerContent(n,this.formatContent(e,t),t)}_populateHandleDescriptions(){if(!this.consumeConn)return null;const e=new Map;return Object.values(this.consumeConn.particle.connections).forEach(t=>{t.handle&&(e[`${t.name}.description`]=this.description.getHandleDescription(t.handle).toString())}),e}getInnerContainer(e){return this.innerContainerBySlotId[e]}_initInnerSlotContainer(e,t,n){t?(this.innerContainerBySlotId[e]||(this.innerContainerBySlotId[e]={}),g()(!this.innerContainerBySlotId[e][t],`Multiple ${e}:${t} inner slots cannot be provided`),this.innerContainerBySlotId[e][t]=n):this.innerContainerBySlotId[e]=n}_clearInnerSlotContainers(e){e.forEach(e=>{e?Object.values(this.innerContainerBySlotId).forEach(t=>delete t[e]):this.innerContainerBySlotId={}})}isSameContainer(e,t){return!e&&!t||e===t}constructRenderRequest(){return[]}dispose(){}createNewContainer(e,t){return null}deleteContainer(e){}clearContainer(e){}setContainerContent(e,t,n){}formatContent(e,t){return null}formatHostedContent(e){return null}static clear(e){}static findRootContainers(e){return{}}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Ri=()=>Eo.getRuntime().getCacheService().getOrCreateCache("templateByName");let Ii;class Oi extends Ti{constructor(e,t,n){super(e,t,n),this._observer=this._initMutationObserver()}constructRenderRequest(){const e=["model"],t=[this.templatePrefix];return Oi.hasTemplate(t.join("::"))||e.push("template"),e}static hasTemplate(e){return[...Ri().keys()].find(t=>t.startsWith(e))}isSameContainer(e,t){return e.parentNode===t}createNewContainer(e,t){g()(e,"contextContainer cannot be null");const n=document.createElement(this.containerKind||"div");return this.consumeConn&&n.setAttribute("particle-host",this.consumeConn.getQualifiedName()),e.appendChild(n),n.attachShadow({mode:"open"}),n.shadowRoot}deleteContainer(e){(e=e.host||e).parentNode&&e.parentNode.removeChild(e)}formatContent(e,t){g()(this.slotContext instanceof xi,"Content formatting can only be done for provided SlotContext");const n=this.slotContext.spec,r={};if(Object.keys(e).indexOf("model")>=0)if(e.model){let i;if(!(i=n.isSet&&this.consumeConn.getSlotSpec().isSet?this._modelForSetSlotConsumedAsSetSlot(e.model,t):n.isSet&&!this.consumeConn.getSlotSpec().isSet?this._modelForSetSlotConsumedAsSingletonSlot(e.model,t):this._modelForSingletonSlot(e.model,t)))return;r.model={...i,...e.descriptions}}else r.model=void 0;return e.templateName&&(r.templateName="string"==typeof e.templateName?e.templateName:e.templateName[t],e.template&&(r.template="string"==typeof e.template?e.template:e.template[r.templateName])),r}_modelForSingletonSlot(e,t){return g()(!t,"subId should be absent for a Singleton Slot"),e}_modelForSetSlotConsumedAsSetSlot(e,t){return g()(e.items&&e.items.every(e=>e.subId),"model for a Set Slot consumed as a Set Slot needs to have items array, with every element having subId"),e.items.find(e=>e.subId===t)}_modelForSetSlotConsumedAsSingletonSlot(e,t){return g()(e.subId,"model for a Set Slot consumed as a Singleton Slot needs to have subId"),t===e.subId?e:null}setContainerContent(e,t,n){if(e.container){if(!t||0===Object.keys(t).length)return this.clearContainer(e),void(e.model=null);this._setTemplate(e,this.templatePrefix,t.templateName,t.template),e.model=t.model,this._onUpdate(e)}}clearContainer(e){e.liveDom&&(e.liveDom.root.textContent=""),e.liveDom=null}dispose(){this._observer&&this._observer.disconnect(),this.renderings.forEach(([e,{container:t}])=>this.deleteContainer(t))}static clear(e){e.textContent=""}static clearCache(){Ri().clear()}static findRootContainers(e){const t={};return Array.from(e.querySelectorAll("[slotid]")).forEach(e=>{const n=e.getAttribute("slotid");g()(!t[n],`Duplicate root slot ${n}`),t[n]=e}),t}createTemplateElement(e){return Object.assign(document.createElement("template"),{innerHTML:e})}get templatePrefix(){return this.consumeConn.getQualifiedName()}_setTemplate(e,t,n,r){n&&(e.templateName=[t,n].filter(e=>e).join("::"),r&&(Ri().has(e.templateName)&&this.clearContainer(e),Ri().set(e.templateName,this.createTemplateElement(r))))}_onUpdate(e){if(this._observe(e.container),e.templateName){const t=Ri().get(e.templateName);g()(t,`No template for ${e.templateName}`),this._stampTemplate(e,t)}this._updateModel(e)}_observe(e){g()(e,"Cannot observe without a container"),this._observer&&this._observer.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["subid"]})}_stampTemplate(e,t){if(!e.liveDom){Ii||(Ii=Si.createTemplate(`<style>${ri}</style>`)),Si.stamp(Ii).appendTo(e.container);const n=this._eventMapper.bind(this,this.eventHandler);e.liveDom=Si.stamp(t).events(n).appendTo(e.container)}}_eventMapper(e,t,n,r){t.addEventListener(n,i=>{i.stopPropagation(),"xen:forward"===n&&(t=i.detail.target,r=i.detail.handlerName);const{altKey:s,ctrlKey:o,metaKey:a,shiftKey:c,code:l,key:h,repeat:u}=i,d={key:t.key,value:t.value,keys:{altKey:s,ctrlKey:o,metaKey:a,shiftKey:c,code:l,key:h,repeat:u}};e({detail:d,handler:r,data:d})})}_updateModel(e){e.liveDom&&e.liveDom.set(e.model)}initInnerContainers(e){Array.from(e.querySelectorAll("[slotid]")).forEach(t=>{if(!this.isDirectInnerSlot(e,t))return;const n=this.getNodeValue(t,"slotid"),r=this.findProvidedContext(e=>e.id===n);if(!r)return void console.warn(`Slot ${this.consumeConn.getSlotSpec().name} has unexpected inner slot ${n}`);const i=this.getNodeValue(t,"subid");g()(Boolean(i)===r.spec.isSet,`Sub-id ${i} for slot ${r.name} doesn't match set spec: ${r.spec.isSet}`),r.sourceSlotConsumer._initInnerSlotContainer(n,i,t)})}getNodeValue(e,t){return e[t]||e.getAttribute(t)}isDirectInnerSlot(e,t){if(t===e)return!0;const n=e=>e.parentNode;let r=n(t);for(;r;){if(r===e)return!0;if(r.getAttribute&&r.getAttribute("slotid"))return!1;r=n(r)}return!1}_initMutationObserver(){return this.consumeConn?new MutationObserver(async e=>{this._observer.disconnect();const t=new Map;for(const[n,{container:r}]of this.renderings)e.some(e=>this.isDirectInnerSlot(r,e.target))&&t.set(n,r);const n=[...t.values()];n.length>0&&(this._clearInnerSlotContainers([...t.keys()]),n.forEach(e=>this.initInnerContainers(e)),this.updateProvidedContexts(),n.forEach(e=>this._observe(e)))}):null}formatHostedContent(e){if(e.templateName){if("string"!=typeof e.templateName)throw new Error("TODO: Implement this!");e.templateName=`${this.consumeConn.getQualifiedName()}::${e.templateName}`}return e}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ni extends Oi{constructor(e,t){super(e,t),this._content={},this.contentAvailable=new Promise(e=>this._contentAvailableResolve=e)}setContent(e,t){super.setContent(e,t),e?(this._content.templateName=e.templateName,e.template&&(this._content.template=e.template),this._content.model=e.model,this._contentAvailableResolve()):this._content={}}createNewContainer(e,t){return e}isSameContainer(e,t){return e===t}getInnerContainer(e){const t=Array.from(this.renderings,([e,{model:t}])=>t)[0],n=this.findProvidedContext(t=>t.id===e);if(n){if(n.spec.isSet&&t&&t.items&&t.items.models){const e={};for(const n of t.items.models)g()(n.id),e[n.id]=n.id;return e}return e}console.warn(`Cannot find provided spec for ${e} in ${this.consumeConn.getQualifiedName()}`)}createTemplateElement(e){return e}static findRootContainers(e){return e}static clear(e){}_onUpdate(e){}_stampTemplate(e){}_initMutationObserver(){return null}_observe(){}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Pi{constructor(e,t){this.slotConsumerClass=e,this.descriptionFormatter=t}static createHeadlessHandler(){return new Pi(Ni)}}Pi.headlessHandler=new Pi(Ni),Pi.basicHandler=new Pi(Ti,qn),Pi.domHandler=new Pi(Oi,ni);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const{log:Ai,warn:Mi}=p("UiSlotComposer","brown");class Di{constructor(e){this._consumers=[],this._contexts=[];const t={containers:{root:"root-context"},modalityHandler:Pi.basicHandler,...e};this.modalityHandler=t.modalityHandler;const n=t.containers;Object.keys(n).forEach(e=>{this._contexts.push(xi.createContextForContainer(`rootslotid-${e}`,e,n[e],[`${e}`]))})}get consumers(){return this._consumers}get containerKind(){return this._containerKind}getSlotConsumer(e,t){return this.consumers.find(n=>n.consumeConn.particle===e&&n.consumeConn.name===t)}findContainerByName(e){}findContextsByName(e){return this._contexts.filter(t=>t instanceof xi&&t.name===e)}findContextById(e){return this._contexts.find(({id:t})=>t===e)||{}}createHostedSlot(e,t,n,r){const i=this.getSlotConsumer(t,n);return g()(i,`Transformation particle ${t.name} with consumed ${n} not found`),`${i.slotContext.id}___${e.generateID("slot")}`}_addSlotConsumer(e){const t=e.arc.pec;e.startRenderCallback=t.startRender.bind(t),e.stopRenderCallback=t.stopRender.bind(t),this._consumers.push(e)}async initializeRecipe(e,t){const n=[];t.forEach(t=>{t.getSlandleConnections().forEach(r=>{if(!r.targetSlot)return void g()(!r.getSlotSpec().isRequired,`No target slot for particle's ${t.name} required consumed slot: ${r.name}.`);const i=new this.modalityHandler.slotConsumerClass(e,r,this._containerKind),s=i.createProvidedContexts();this._contexts=this._contexts.concat(s),n.push(i)})}),n.forEach(e=>{this._addSlotConsumer(e);const t=this.findContextById(e.consumeConn.targetSlot.id);t&&t.addSlotConsumer&&t.addSlotConsumer(e)});const r=this.consumers.map(e=>e.arc),i=[...new Set(r).values()],s=await Promise.all(i.map(e=>Wn.create(e))),o=new Map(s.map((e,t)=>[i[t],e]));for(const e of this.consumers)e.description=o.get(e.arc)}renderSlot(e,t,n){Mi("[unsupported] renderSlot",e.spec.name)}getAvailableContexts(){return this._contexts}dispose(){this.disposeConsumers(),this.disposeContexts(),this.disposeObserver()}disposeConsumers(){this._consumers.forEach(e=>e.dispose()),this._consumers.length=0}disposeContexts(){this._contexts.forEach(e=>{e.clearSlotConsumers(),e instanceof xi&&e.container&&this.modalityHandler.slotConsumerClass.clear(e.container)}),this._contexts=this._contexts.filter(e=>!e.sourceSlotConsumer)}observeSlots(e){this.slotObserver=e,e.dispatch=(e,t)=>{console.log("ui-slot-composer dispatch for pid",e,t),this.sendEvent(e,t)}}disposeObserver(){const e=this.slotObserver;e&&e.dispose()}sendEvent(e,t){Ai("sendEvent:",e,t);const n=this._findConsumer(e);if(n){const e=n.consumeConn.particle,r=n.arc;r&&(Ai("... found consumer, particle, and arc to delegate sendEvent"),r.pec.sendEvent(e,"",t))}else Mi("...found no consumer!")}_findConsumer(e){return this.consumers.find(t=>t.consumeConn.particle.id.toString()===e)}delegateOutput(e,t,n){const r=this.slotObserver;if(r&&n){const i=t.getSlandleConnections(),s={},o=i[0];o&&Object.assign(s,{containerSlotName:o.targetSlot.name,containerSlotId:o.targetSlot.id});const a=t.recipe.modality;a.all||Object.assign(s,{modality:a.names.join(",")});const c={};i.forEach(({providedSlots:e})=>{Object.values(e).forEach(({name:e,id:t})=>c[e]=t)});const l=t.id.toString();Object.assign(s,{particle:{name:t.name,id:l},slotMap:c,outputSlotId:l,content:n}),r.observe(s,e)}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Fi{constructor(e){if(this._consumers=[],this._contexts=[],g()(e.modalityHandler,`Missing or invalid modality handler: ${e.modalityHandler}`),e.rootContainer=e.rootContainer||e.rootContext||(e.containers||Object).root,g()(void 0!==e.rootContainer!=(!0===e.noRoot),"Root container is mandatory unless it is explicitly skipped"),this._containerKind=e.containerKind,e.modalityName&&(this.modality=k.create([e.modalityName])),this.modalityHandler=e.modalityHandler,e.noRoot)return;const t=e.containers||this.modalityHandler.slotConsumerClass.findRootContainers(e.rootContainer)||{};0===Object.keys(t).length&&(t.root=e.rootContainer),Object.keys(t).forEach(e=>{this._contexts.push(xi.createContextForContainer(`rootslotid-${e}`,e,t[e],[`${e}`]))})}get consumers(){return this._consumers}get containerKind(){return this._containerKind}getSlotConsumer(e,t){return this.consumers.find(n=>n.consumeConn.particle===e&&n.consumeConn.name===t)}findContainerByName(e){const t=this.findContextsByName(e);if(0===t.length)console.warn(`No containers for '${e}'`);else{if(1===t.length)return t[0].container;console.warn(`Ambiguous containers for '${e}'`)}}findContextsByName(e){return this._contexts.filter(e=>e instanceof xi).filter(t=>t.name===e)}findContextById(e){return this._contexts.find(({id:t})=>t===e)}createHostedSlot(e,t,n,r){const i=this.getSlotConsumer(t,n);g()(i,`Transformation particle ${t.name} with consumed ${n} not found`);const s=e.generateID("slot").toString();return this._contexts.push(new ki(s,i,r)),s}_addSlotConsumer(e){e.startRenderCallback=e.arc.pec.startRender.bind(e.arc.pec),e.stopRenderCallback=e.arc.pec.stopRender.bind(e.arc.pec),this._consumers.push(e)}async initializeRecipe(e,t){const n=[];t.forEach(t=>{t.getSlandleConnections().forEach(r=>{if(!r.targetSlot)return void g()(!r.getSlotSpec().isRequired,`No target slot for particle's ${t.name} required consumed slot: ${r.name}.`);const i=new this.modalityHandler.slotConsumerClass(e,r,this._containerKind),s=i.createProvidedContexts();this._contexts=this._contexts.concat(s),n.push(i)})}),n.forEach(e=>{this._addSlotConsumer(e);const t=this.findContextById(e.consumeConn.targetSlot.id);g()(t,`No context found for ${e.consumeConn.getQualifiedName()}`),t.addSlotConsumer(e)});const r=this.consumers.map(e=>e.arc),i=[...new Set(r).values()],s=await Promise.all(i.map(e=>Wn.create(e))),o=new Map(s.map((e,t)=>[i[t],e]));for(const e of this.consumers)e.description=o.get(e.arc)}renderSlot(e,t,n){const r=this.getSlotConsumer(e,t);g()(r,`Cannot find slot (or hosted slot) ${t} for particle ${e.name}`),n={...n},r.slotContext.onRenderSlot(r,n,async n=>{if(r.arc.pec.sendEvent(e,t,n),n.data&&n.data.key)for(const e of r.hostedSlotContexts)if(e.storeId)for(const t of e.slotConsumers){const r=t.arc.findStoreById(e.storeId);g()(r),r.get().then(e=>{e&&e.id===n.data.key&&t.arc.pec.sendEvent(t.consumeConn.particle,t.consumeConn.name,n)})}})}getAvailableContexts(){return this._contexts}dispose(){this.consumers.forEach(e=>e.dispose()),this._contexts.forEach(e=>{e.clearSlotConsumers(),e instanceof xi&&e.container&&this.modalityHandler.slotConsumerClass.clear(e.container)}),this._contexts=this._contexts.filter(e=>!e.sourceSlotConsumer),this._consumers.length=0}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ji extends Fi{constructor(e={}){void 0===e.modalityHandler&&(e.modalityHandler=Pi.createHeadlessHandler()),super({rootContainer:{root:"root-context"},...e})}renderSlot(e,t,n){super.renderSlot(e,t,n);const r=this.getSlotConsumer(e,t);r&&r.updateProvidedContexts()}get contexts(){return this._contexts}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const $i=e=>{const t=Bi(e.urlMap),n=e.resolve("https://$build/worker.js"),r="https:"===location.protocol&&new URLSearchParams(window.location.search).has("use-cache");let i;r||e.provisionObjectUrl(n).then(e=>i=e);return(e,s)=>{i||r||console.warn("workerBlob not available, falling back to network URL");const o=new Worker(i||n),a=new MessageChannel;return o.postMessage({id:`${e}:inner`,base:t,logLevel:window.logLevel},[a.port1]),a.port2}},Bi=e=>{const t={},{origin:n,pathname:r}=window.location,i=e=>("/"===e[0]?e=`${n}${e}`:e.indexOf("//")<0&&(e=`${n}${r.split("/").slice(0,-1).join("/")}/${e}`),e);return Object.keys(e).forEach(n=>{const r=e[n];t[n]="string"==typeof r?i(r):{...r,root:i(r.root)}}),t};
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Li{constructor(e,t){this.watchedHandles=new Set,this.arc=e,this.arcDevtoolsChannel=t,t.listen("fetch-stores",async()=>t.send({messageType:"fetch-stores-result",messageBody:await this.listStores()}))}async onRecipeInstantiated(){for(const e of this.arc._stores)this.watchedHandles.has(e.id)||(this.watchedHandles.add(e.id),(await e.activate()).on(async()=>(this.arcDevtoolsChannel.send({messageType:"store-value-changed",messageBody:{id:e.id.toString(),value:await this.dereference(e)}}),!0)))}async listStores(){const e=t=>{let n=[...t.storeTags];return t.imports&&t.imports.forEach(t=>n=n.concat(e(t))),n};return{arcStores:await this.digestStores([...this.arc.storeTags]),contextStores:await this.digestStores(e(this.arc.context))}}async digestStores(e){const t=[];for(const[n,r]of e)t.push({name:n.name,tags:r?[...r]:[],id:n.id,storage:n.storageKey,type:n.type,description:n.description,value:await this.dereference(n)});return t}async dereference(e){if(e.toList)return e.toList();if(e.get)return e.get();if(e instanceof Qe){const t=await(await e.activate()).serializeContents();return t.values&&1===Object.values(t.values).length?Object.values(t.values)[0].value:t}return"(don't know how to dereference)"}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Ui(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}var Hi=n(28),zi=n.n(Hi);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class qi{static hardwareConcurrency(){return zi.a.cpus().length}static deviceMemory(){return zi.a.totalmem()/Math.pow(1024,3)}}
/**
 * @license
 * Copyright 2015 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Wi=[];let Vi,Ki;"object"==typeof document?(Vi=42,Ki=()=>1e3*performance.now()):(Vi=process.pid,Ki=()=>{const e=process.hrtime();return 1e6*e[0]+e[1]/1e3});let Qi=0;function Gi(e){return e?"function"==typeof e?Gi(e()):e.toTraceInfo?Gi(e.toTraceInfo()):e:{}}const Zi=[];function Yi(e){e.pid=Vi,e.tid=0,e.args||delete e.args,e.ov||delete e.ov,e.cat||(e.cat=""),0===Zi.length&&Wi.push(e),Promise.resolve().then(()=>{for(const{callback:t,predicate:n}of Zi)n&&!n(e)||t(e)})}const Xi={exports:{}},Ji=Xi.exports;function es(){const e={wait:async e=>e,start(){return this},end(){return this},step(){return this},addArgs(){},endWith:async e=>e};function t(e){let t=(e=Gi(e)).args;const n=Ki();return{addArgs(e){t={...t||{},...e}},end(r={},i){(r=Gi(r)).args&&(t={...t||{},...r.args}),r={...e,...r},this.endTs=Ki(),Yi({ph:"X",ts:n,dur:this.endTs-n,cat:r.cat,name:r.name,ov:r.overview,args:t,flowId:i&&i.id(),seq:r.sequence})},beginTs:n}}Xi.exports.wrap=(e,t)=>t,Xi.exports.start=t=>e,Xi.exports.flow=t=>e,Xi.exports.enabled&&(Xi.exports.wrap=(e,t)=>(...n)=>{const r=Xi.exports.start(e);try{return t(...n)}finally{r.end()}},Xi.exports.start=e=>{let n,r=t(e);const i={cat:e.cat,name:e.name+" (async)",overview:e.overview,sequence:e.sequence};return{async wait(e,s){const o=!!n;o||(n=Xi.exports.flow(i)),r.end(s,n),o?n.step({ts:r.beginTs,...i}):n.start({ts:r.endTs}),r=null;try{return await e}finally{r=t(i)}},addArgs(e){r.addArgs(e)},end(e){r.end(e,n),n&&n.end({ts:r.beginTs})},async endWith(e,t){if(Promise.resolve(e)!==e)return this.end(t),e;e=this.wait(e,null);try{return await e}finally{this.end(t)}}}},Xi.exports.flow=e=>{e=Gi(e);const t=Qi++;let n=!1;return{start(r){const i=r&&r.ts||Ki();return n=!0,Yi({ph:"s",ts:i,cat:e.cat,name:e.name,ov:e.overview,args:e.args,id:t,seq:e.sequence}),this},end(r){if(!n)return this;const i=r&&r.ts||Ki();return r=Gi(r),Yi({ph:"f",bp:"e",ts:i,cat:e.cat,name:e.name,ov:e.overview,args:r&&r.args,id:t,seq:e.sequence}),this},step(r){if(!n)return this;const i=r&&r.ts||Ki();return r=Gi(r),Yi({ph:"t",ts:i,cat:e.cat,name:e.name,ov:e.overview,args:r&&r.args,id:t,seq:e.sequence}),this},id:()=>t}},Xi.exports.save=()=>({traceEvents:Wi}),Xi.exports.download=()=>{const e=document.createElement("a");e.download="trace.json",e.href="data:text/plain;base64,"+btoa(JSON.stringify(Xi.exports.save())),e.click()},Xi.exports.now=Ki,Xi.exports.stream=(e,t)=>{Wi.length=0,Zi.push({callback:e,predicate:t})},Xi.exports.__clearForTests=()=>{Wi.length=0,Zi.length=0})}Xi.exports.enabled=!1,Xi.exports.enable=()=>{Xi.exports.enabled||(Xi.exports.enabled=!0,es())},es();
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class ts{constructor(e,t,n,r){this.descriptionByModality={},this.versionByStore={},this.searchGroups=[],g()(e,"plan cannot be null"),g()(t,"hash cannot be null"),this.plan=e,this.planString=this.plan.toString(),this.hash=t,this.rank=n,this.versionByStore=r;for(const e in this.versionByStore)void 0===this.versionByStore[e]&&delete this.versionByStore[e]}static create(e,t,n){g()(e,"plan cannot be null"),g()(t,"hash cannot be null");const r=new ts(e,t,n?n.calcRelevanceScore():0,n?n.versionByStore:{});return r.setSearch(e.search),r}get descriptionText(){return this.getDescription("text")}getDescription(e){return this.descriptionByModality[e]}setDescription(e,t,n=qn){this.descriptionByModality.text=e.getRecipeSuggestion();for(const r of this.plan.modality.names||[])t.names.includes(r)&&(this.descriptionByModality[r]=e.getRecipeSuggestion(n))}isEquivalent(e){return this.hash===e.hash&&this.descriptionText===e.descriptionText}isEqual(e){return this.isEquivalent(e)&&this.rank===e.rank&&this._isSameSearch(e)&&this._isSameDescription(e)&&this._isSameVersions(e)}_isSameSearch(e){return this.searchGroups.length===e.searchGroups.length&&this.searchGroups.every(t=>e.hasSearchGroup(t))}_isSameDescription(e){return Object.keys(this.descriptionByModality).length===Object.keys(e.descriptionByModality).length&&Object.keys(this.descriptionByModality).every(t=>JSON.stringify(this.descriptionByModality[t])===JSON.stringify(e.descriptionByModality[t]))}_isSameVersions(e){const t=Object.keys(this.versionByStore);return t.length===Object.keys(e.versionByStore).length&&t.every(t=>this.versionByStore[t]===e.versionByStore[t])}static compare(e,t){return t.rank-e.rank}hasSearch(e){return this.hasSearchGroup(e.split(" "))}hasSearchGroup(e){return this.searchGroups.some(t=>e.every(e=>t.includes(e)))}setSearch(e){this.searchGroups=[],e&&this._addSearch(e.resolvedTokens)}mergeSearch(e){let t=!1;0===e.searchGroups.length&&this._addSearch([""]);for(const n of e.searchGroups)this._addSearch(n)&&(1===this.searchGroups.length&&this.searchGroups.push([""]),t=!0);return this.searchGroups.sort(),t}_addSearch(e){return!this.searchGroups.find(t=>((e,t)=>e.length===t.length&&e.every(e=>t.includes(e)))(t,e))&&(this.searchGroups.push(e),!0)}toLiteral(){return{plan:this.planString,hash:this.hash,rank:this.rank,versionByStore:JSON.stringify(this.versionByStore),searchGroups:this.searchGroups,descriptionByModality:this.descriptionByModality}}static async fromLiteral({plan:e,hash:t,rank:n,versionByStore:r,searchGroups:i,descriptionByModality:s},{context:o,loader:a}){const c=await Yc.parse(e,{loader:a,context:o,fileName:""});g()(1===c.recipes.length);const l=c.recipes[0],h={errors:new Map};g()(l.normalize(h),`can't normalize deserialized suggestion: ${e} ${JSON.stringify([...h.errors])}`);const u=new ts(l,t,n,JSON.parse(r||"{}"));return u.searchGroups=i||[],u.descriptionByModality=s,u}async instantiate(e){g()(e,"Cannot instantiate suggestion without and arc");const t=await this.getResolvedPlan(e);return g()(t&&t.isResolved(),`can't resolve plan: ${this.plan.toString({showUnresolved:!0})}`),e.instantiate(t)}async getResolvedPlan(e){if(this.plan.isResolved())return this.plan;return new zr(e).resolve(this.plan)}isUpToDate(e,t){const n=e.getVersionByStore({includeArc:!0,includeContext:!0});return t.handles.every(e=>n[e.id]===this.versionByStore[e.id])}isVisible(e,t,n){const r=e=>{n&&n.reasons&&n.reasons.push(e)};return this.plan.handles.filter(e=>"`slot"===e.fate).length+this.plan.slots.length===0?(r("No slots"),!1):this.descriptionText?e.modality.isCompatible(this.plan.modality.names)?!!t.showAll||(t.search?!(!this.descriptionText.toLowerCase().includes(t.search)&&!this.hasSearch(t.search))||(r(`Description doesn't match search filter: ${t.search}`),!1):!this.plan.slots.find(Rt)&&!(this.plan.slotConnections||[]).find(e=>"root"===e.name)||(this.plan.handles.some(t=>!!t.id&&!!e.activeRecipe.handles.find(e=>e.id===t.id))?!!this.plan.slots.some(t=>!Rt(t)&&Boolean(e.pec.slotComposer.findContextById(t.id)))||(r("No remote non-root slots."),!1):(r("No active recipe handles"),!1))):(r(`Incompatible modalities ${this.plan.modality.names.join(", ")} with Arc modalities: ${e.modality.names.join(", ")}`),!1):(r("No description"),!1)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const{error:ns}=p("PlanningResult","#ff0090");class rs{constructor(e,t){this.suggestions=[],this.lastUpdated=new Date,this.generations=[],this.contextual=!0,this.changeCallbacks=[],this.envOptions=e,g()(e.context,"context cannot be null"),g()(e.loader,"loader cannot be null"),this.store=t,this.store&&(this.storeCallbackId=this.store.on(()=>this.load()))}registerChangeCallback(e){this.changeCallbacks.push(e)}onChanged(){for(const e of this.changeCallbacks)e()}async load(){const e=await this.store.get()||{};return!(!e.suggestions||!await this.fromLiteral(e))}async flush(){try{await this.store.set(this.toLiteral())}catch(e){throw ns("Failed storing suggestions: ",e),e}}async clear(){return this.store.clear()}dispose(){this.changeCallbacks=[],this.store.off(this.storeCallbackId),this.store.dispose()}static formatSerializableGenerations(e){const t=new Map;let n=0;const r=e=>{t.set(e,n);const{result:r,score:i,derivation:s,description:o,hash:a,valid:c,active:l,irrelevant:h}=e;return{result:r.toString({showUnresolved:!0,showInvalid:!1,details:""}),resolved:r.isResolved(),score:i,derivation:s,description:o,hash:a,valid:c,active:l,irrelevant:h,id:n++}};return(e=e.map(e=>({record:e.record,generated:e.generated.map(r)}))).map(e=>{const n=e.generated,r=e.record;r.resolvedDerivations=0,r.resolvedDerivationsByStrategy={};for(const e of n){if(e.derivation=e.derivation.map(e=>{let n,r;return e.parent&&(n=t.get(e.parent)),e.strategy&&(r=e.strategy.constructor.name),{parent:n,strategy:r}}),e.resolved){r.resolvedDerivations++;const t=e.derivation[0].strategy;void 0===r.resolvedDerivationsByStrategy[t]&&(r.resolvedDerivationsByStrategy[t]=0),r.resolvedDerivationsByStrategy[t]++}}const i={};for(const e of n)null==i[e.derivation[0].strategy]&&(i[e.derivation[0].strategy]=[]),i[e.derivation[0].strategy].push(e);const s={population:[],record:r};for(const e of Object.keys(i))s.population.push({strategy:e,recipes:i[e]});return s})}_set({suggestions:e,lastUpdated:t=new Date,generations:n=[],contextual:r=!0}){this.suggestions=e,this.generations=n,this.lastUpdated=t,this.contextual=r,this.onChanged()}merge({suggestions:e,lastUpdated:t=new Date,generations:n=[],contextual:r=!0},i){const s=[],o=[],a=i.getVersionByStore({includeArc:!0,includeContext:!0});for(const t of e){const e=this.suggestions.findIndex(e=>e.isEquivalent(t));if(e>=0){if(this.suggestions[e].isEqual(t))continue;const n=Object.keys(t.versionByStore).filter(n=>{const r=this.suggestions[e].versionByStore[n];return void 0===r||t.versionByStore[n]<r});n.length>0&&console.warn(`New suggestions has older store versions:\n ${n.map(n=>`${n}: ${this.suggestions[e].versionByStore[n]} -> ${t.versionByStore[n]}`).join(";")}`),o.push(e),t.mergeSearch(this.suggestions[e])}this._isUpToDate(t,a)&&s.push(t)}const c=this.suggestions.filter((e,t)=>!o.some(e=>e===t)&&this._isUpToDate(e,a)&&!Nn.matchesRecipe(i.activeRecipe,e.plan));return(c.length!==this.suggestions.length||0!==s.length)&&(c.push(...s),this._set({suggestions:c,generations:this.generations.concat(...n),lastUpdated:t,contextual:r&&this.contextual}),!0)}_isUpToDate(e,t){for(const n of e.plan.handles){const r=t[n.id]||0;if((e.versionByStore[n.id]||0)<r)return!1}return!0}isEquivalent(e){return rs.isEquivalent(this.suggestions,e)}static isEquivalent(e,t){return g()(t,"New suggestions cannot be null."),e&&e.length===t.length&&e.every(e=>t.find(t=>e.isEquivalent(t)))}async fromLiteral({suggestions:e,generations:t,lastUpdated:n,contextual:r}){const i=[];for(const t of e)i.push(await ts.fromLiteral(t,this.envOptions));return!this.isEquivalent(i)&&(this._set({suggestions:i,generations:JSON.parse(t||"[]"),lastUpdated:new Date(n),contextual:r}),!0)}toLiteral(){return{suggestions:this.suggestions.map(e=>e.toLiteral()),generations:JSON.stringify(this.generations),lastUpdated:this.lastUpdated.toString(),contextual:this.contextual}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class is{constructor(e,t,n){this._generation=0,this._internalPopulation=[],this._population=[],this._generated=[],this._terminal=[],this._strategies=e,this._evaluators=t,this._ruleset=n,this.populationHash=new Map}get generation(){return this._generation}get population(){return this._population}get generated(){return this._generated}get terminal(){return g()(this._terminal),this._terminal}async generate(){const e=this.generation+1,t=await Promise.all(this._strategies.map(async e=>{const t=t=>this._ruleset.isAllowed(e,t);return e.generate({generation:this.generation,generated:this.generated.filter(t),terminal:this.terminal.filter(t),population:this.population.filter(t)})})),n={generation:e,sizeOfLastGeneration:this.generated.length,generatedDerivationsByStrategy:{}};for(let e=0;e<this._strategies.length;e++)n.generatedDerivationsByStrategy[this._strategies[e].constructor.name]=t[e].length;let r=[].concat(...t);r=await Promise.all(r.map(async e=>(e.hash&&(e.hash=await e.hash),e))),n.generatedDerivations=r.length,n.nullDerivations=0,n.invalidDerivations=0,n.duplicateDerivations=0,n.duplicateSameParentDerivations=0,n.nullDerivationsByStrategy={},n.invalidDerivationsByStrategy={},n.duplicateDerivationsByStrategy={},n.duplicateSameParentDerivationsByStrategy={},r=r.filter(e=>{const t=e.derivation[0].strategy.constructor.name;if(e.hash){const r=this.populationHash.get(e.hash);if(r)return e.derivation[0].parent===r?(n.nullDerivations+=1,null==n.nullDerivationsByStrategy[t]&&(n.nullDerivationsByStrategy[t]=0),n.nullDerivationsByStrategy[t]++):-1!==r.derivation.map(e=>e.parent).indexOf(e.derivation[0].parent)?(n.duplicateSameParentDerivations+=1,null==n.duplicateSameParentDerivationsByStrategy[t]&&(n.duplicateSameParentDerivationsByStrategy[t]=0),n.duplicateSameParentDerivationsByStrategy[t]++):(n.duplicateDerivations+=1,null==n.duplicateDerivationsByStrategy[t]&&(n.duplicateDerivationsByStrategy[t]=0),n.duplicateDerivationsByStrategy[t]++,this.populationHash.get(e.hash).derivation.push(e.derivation[0])),!1;this.populationHash.set(e.hash,e)}return!1!==e.valid||(n.invalidDerivations++,n.invalidDerivationsByStrategy[t]=(n.invalidDerivationsByStrategy[t]||0)+1,!1)});const i=new Map;for(const e of this.generated)i.set(e.result,e);for(const e of this.populationHash.values())for(const{parent:t}of e.derivation)t&&i.has(t.result)&&i.delete(t.result);const s=[...i.values()];n.survivingDerivations=r.length,r.sort((e,t)=>e.score>t.score?-1:e.score<t.score?1:0);const o=await Promise.all(this._evaluators.map(async e=>e.evaluate(this,r))),a=is._mergeEvaluations(o,r);g()(a.length===r.length);for(let e=0;e<a.length;e++)this._internalPopulation.push({fitness:a[e],individual:r[e]});return this._internalPopulation.sort((e,t)=>t.fitness-e.fitness),this._terminal=s,this._generation=e,this._generated=r,this._population=this._internalPopulation.map(e=>e.individual),n}static _mergeEvaluations(e,t){const n=t.length,r=[];for(let t=0;t<n;t++){let n=NaN;for(const r of e){const e=r[t];isNaN(e)||(n=isNaN(n)?e:(n*t+e)/(t+1))}isNaN(n)&&(n=.5),r.push(n)}return r}}class ss extends Br{constructor(e){super(e)}createDescendant(e,t){g()(this.currentAction instanceof os,"no current strategy"),super.createDescendant(e,t)}static over(e,t,n){return super.walk(e,t,n)}}class os extends jr{constructor(e,t){super(e,t)}async activate(e){return{generate:0,evaluate:0}}async evaluate(e,t){return t.map(()=>NaN)}}class as{constructor(e){this._orderingRules=e}isAllowed(e,t){const n=this._orderingRules.get(e.constructor);return!n||!t.derivation.some(e=>n.has(e.strategy.constructor))}}as.Builder=class{constructor(){this._orderingRules=new Map}order(...e){for(let t=0;t<e.length-1;t++){const n=e[t],r=e[t+1];for(const e of Array.isArray(n)?n:[n]){let t=this._orderingRules.get(e);t||this._orderingRules.set(e,t=new Set);for(const e of Array.isArray(r)?r:[r])t.add(e)}}return this}build(){const e=new Set,t=new Set;for(const n of this._orderingRules.keys())this._transitiveClosureFor(n,e,t);return new as(this._orderingRules)}_transitiveClosureFor(e,t,n){g()(!t.has(e),"Detected a loop in the ordering rules");const r=this._orderingRules.get(e);if(n.has(e))return r||new Set;if(r){t.add(e);for(const e of r)for(const i of this._transitiveClosureFor(e,t,n))r.add(i);t.delete(e)}return n.add(e),r||new Set}};
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class cs extends os{async generate(e){return ss.over(this.getResults(e),new class extends ss{onRecipe(e){if(e.connectionConstraints.length>0)return;if(e.getFreeHandles().length>0)return;const t=e.getFreeConnections();return 0!==t.length?e=>(t.forEach(({particle:t,connSpec:n})=>{const r=e.updateToClone({particle:t}).particle.addConnectionName(n.name),i=e.newHandle();i.fate="?",r.connectToHandle(i)}),0):void 0}}(ss.Permuted),this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ls extends os{async generate(e){const t=this;return ss.over(this.getResults(e),new class extends ss{onHandle(e,n){if(!["?","use","copy","map"].includes(n.fate))return;if(0===n.connections.length)return;if(n.id)return;if(!n.type)return;const r=Nn.directionCounts(n);if(r.any>0)return;const i=this._getScore(r,n.tags);if(r.out>0&&"map"===n.fate)return;const s=t.getMappableStores(n.fate,n.type,n.tags,r);return"?"!==n.fate&&s.size<2?void 0:[...s.keys()].map(e=>(t,n)=>(g()(e.id),t.findHandleByID(e.id)?0:(n.mapToStorage(e),"?"===n.fate?n.fate=s.get(e):g()(n.fate,s.get(e)),i)))}_getScore(e,t){let n=-1;return 0!==e.in&&0!==e.out||(n=0===e.out?1:0),t.length>0&&(n+=4),n}}(ss.Permuted),this)}getMappableStores(e,t,n,r){const i=new Map;return"use"!==e&&"?"!==e||this.arc.findStoresByType(t,{tags:n}).forEach(e=>i.set(e,"use")),"map"!==e&&"copy"!==e&&"?"!==e||this.arc.context.findStoresByType(t,{tags:n,subtype:!0}).forEach(t=>i.set(t,"?"===e?r.out>0?"copy":"map":e)),i}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class hs extends os{constructor(e,{recipeIndex:t}){super(e),this.recipeIndex=t}getResults(e){return e.terminal.filter(e=>!e.result.isResolved()||0===e.result.slots.length)}async generate(e){const t=this.arc,n=this.recipeIndex;return await n.ready,ss.over(this.getResults(e),new class extends ss{onPotentialSlotConnection(e,r,i){const s=[];for(const o of n.findProvidedSlot(r,i))e.particles.length+o.recipe.particles.length>10||Nn.matchesRecipe(t.activeRecipe,o.recipe)||s.push((e,t,r)=>{const i=n.findCoalescableHandles(e,o.recipe),{cloneMap:s}=o.recipe.mergeInto(e),a=s.get(o);return t.addSlotConnection(r.name).connectToSlot(a),this._connectOtherHandles(i,s,!1),e.verbs.splice(0),e.name=null,1});if(s.length>0)return s}onSlotConnection(e,r){if(r.isResolved())return;if(!r.name||!r.particle)return;if(r.targetSlot)return;const i=[];for(const s of n.findProvidedSlot(r.particle,r.spec))e.particles.length+s.recipe.particles.length>10||Nn.matchesRecipe(t.activeRecipe,s.recipe)||Nn.matchesRecipe(e,s.recipe)||i.push((e,t)=>{const r=n.findCoalescableHandles(e,s.recipe),{cloneMap:i}=s.recipe.mergeInto(t.recipe),o=i.get(s);return t.connectToSlot(o),this._connectOtherHandles(r,i,!1),e.verbs.splice(0),e.name=null,1});return i.length>0?i:void 0}onSlot(e,r){if(r.consumeConnections.length>0)return;if(!r.sourceConnection||!r.spec.isRequired)return;const i=[];for(const{recipeParticle:s,slotSpec:o,matchingHandles:a}of n.findConsumeSlotConnectionMatch(r.sourceConnection.particle,r.spec))e.particles.length+s.recipe.particles.length>10||Nn.matchesRecipe(t.activeRecipe,s.recipe)||Nn.matchesRecipe(e,s.recipe)||i.push((e,t)=>{const r=n.findCoalescableHandles(e,s.recipe,new Set(t.handles.concat(a.map(({handle:e,matchingConn:t})=>t.handle)))),{cloneMap:i}=s.recipe.mergeInto(t.recipe),c=s.getSlotConnectionByName(t.name);let l=i.get(c);if(!l){l=i.get(s).addSlotConnection(o.name)}l.connectToSlot(t);for(const{handle:n,matchingConn:r}of a){const s=i.get(r).handle,o=t.findHandleByID(n.id);if(s!==o){for(;s.connections.length>0;){const e=s.connections[0];e.disconnectHandle(),e.connectToHandle(o)}e.removeHandle(s)}}return this._connectOtherHandles(r,i,!1),e.verbs.splice(0),e.name=null,1});return i.length>0?i:void 0}onHandle(e,r){if(!n.coalescableFates.includes(r.fate)||r.id||0===r.connections.length||"descriptions"===r.name)return;const i=[];for(const s of n.findHandleMatch(r,n.coalescableFates))if(!(e.particles.length+s.recipe.particles.length>10||s.findConnectionByDirection("in"))){if(s.type.hasVariable){let e=s.type.resolvedType();if((e=e.getContainedType()||e)instanceof st&&!e.canReadSubset)continue}Nn.matchesRecipe(t.activeRecipe,s.recipe)||Nn.matchesRecipe(e,s.recipe)||i.push((e,t)=>{const r=n.findCoalescableHandles(e,s.recipe,new Set([t,s])),{cloneMap:i}=s.recipe.mergeInto(t.recipe);return i.get(s).mergeInto(t),this._connectOtherHandles(r,i,!0),e.verbs.splice(0),e.name=null,1})}return i}_connectOtherHandles(e,t,n){e.forEach((e,r)=>{const i=t.get(e);n&&!this._reverifyHandleTypes(r,i)||i.mergeInto(r)})}_reverifyHandleTypes(e,t){g()(e.recipe===t.recipe);const n=new Map;return e.recipe.clone(n).normalize(),Bn.effectiveType(n.get(e).type,[...n.get(e).connections,...n.get(t).connections])}}(ss.Independent),this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class us extends os{async generate(e){const t=this.arc.modality;return ss.over(this.getResults(e),new class extends ss{onRecipe(e){if(0===e.connectionConstraints.length)return;const n=t.intersection(e.modality),r=new Set,i=new Map,s=new Set,o={},a={};let c=0;function l(e,t){if(t.has(e))return t.get(e);if(e.localName&&!s.has(e.localName))return t.set(e,e.localName),e.localName;for(;!s.has("handle"+c);)c++;return t.set(e,"handle"+c),"handle"+c++}let h=0;const u=[];for(const t of e.connectionConstraints){const e=t.from,c=t.to;if(e instanceof Sn&&c instanceof Sn&&(!e.particle.isCompatible(n)||!c.particle.isCompatible(n)))return;let d,p=!1,f=!1;e instanceof Sn&&(r.add(e.particle.name),null==o[e.particle.name]&&(o[e.particle.name]={},a[e.particle.name]=e.particle),e.connection?(p=!0,d=o[e.particle.name][e.connection]):f=!0),e instanceof En&&(d={handle:l(e.handle,i),direction:Tn(t.direction),localName:e.handle.localName},s.add(d.handle)),c instanceof Sn&&(r.add(c.particle.name),null==o[c.particle.name]&&(o[c.particle.name]={},a[c.particle.name]=c.particle),c.connection?(p=!0,d||(d=o[c.particle.name][c.connection])):f=!0),c instanceof En&&(d={handle:l(c.handle,i),direction:t.direction,localName:c.handle.localName},s.add(d.handle)),null==d&&(d={handle:"v"+h++,direction:t.direction},p&&s.add(d.handle)),e instanceof kn?d.tags=e.tags:c instanceof kn&&(d.tags=c.tags),f&&u.push({from:e._clone(),to:c._clone(),direction:t.direction});const g=(e,t)=>"any"===e?"any":"any"===t?"any":e!==t?"any":e;let m=t.direction;if(e instanceof Sn){const t=e.connection;if(t){const n=o[e.particle.name][t];if(n&&null==(m=g(m,n.direction)))return;o[e.particle.name][t]={handle:d.handle,direction:m,tags:d.tags,localName:d.localName}}}if(m=Tn(t.direction),c instanceof Sn){const e=c.connection;if(e){const t=o[c.particle.name][e];if(t&&null==(m=g(m,t.direction)))return;o[c.particle.name][e]={handle:d.handle,direction:m,tags:d.tags,localName:d.localName}}}}const d=Nn.makeShape([...r.values()],[...s.values()],o);return Nn.find(e,d).filter(e=>{const t={};for(const n of Object.keys(o))for(const r of Object.keys(o[n])){const i=o[n][r].handle;if(!t[i])if(e.match[i])t[i]=!0;else{const e=a[n];t[i]=e.isOutput(r)}}return Object.values(t).every(e=>e)}).map(e=>t=>{const n=t.connectionConstraints.length+e.score,r=t.updateToClone(e.match);for(const e of Object.keys(o)){let n=r[e];n||((n=t.newParticle(e)).spec=a[e],r[e]=n);for(const i of Object.keys(o[e])){const s=o[e][i];let a=n.connections[i];null==a&&(a=n.addConnectionName(i));let c=r[s.handle];null==c&&null==a.handle&&((c=t.newHandle()).fate="create",c.tags=s.tags||[],r[s.handle]=c),null==a.handle&&a.connectToHandle(c)}}t.clearConnectionConstraints();for(const e of u){if(!(e.from instanceof Sn&&e.to instanceof Sn))throw new Error("constraints with a particle endpoint at one end but not at the other are not supported");{const n=new Cn(r[e.from.particle.name],e.from.connection),i=new Cn(r[e.to.particle.name],e.to.connection);t.newObligation(n,i,e.direction)}}return n})}}(ss.Independent),this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ds extends os{async generate(e){return ss.over(this.getResults(e),new class extends ss{onHandleConnection(e,t){if(!t.handle&&"descriptions"===t.name)return(e,t)=>this._createAndConnectHandle(t)}onPotentialHandleConnection(e,t,n){if("descriptions"===n.name)return(e,t,n)=>this._createAndConnectHandle(t.addConnectionName(n.name))}_createAndConnectHandle(e){const t=e.recipe.newHandle();return t.fate="create",e.connectToHandle(t),1}}(ss.Permuted),this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ps extends os{async generate(e){return ss.over(this.getResults(e),new class extends ss{onRecipe(e){if(e.connectionConstraints.length>0)return;const t=e.getFreeConnections();let n=null;for(const e of t.filter(({connSpec:e})=>e.isOutput)){const r=[e];let i=Bn.effectiveType(null,r.map(e=>e.connSpec)),s=null;const o=new Set([e.particle]);let a=!1;for(const e of t.filter(({connSpec:e})=>e.isInput))o.has(e.particle)||null===(s=Bn.effectiveType(i,[e.connSpec]))||(r.push(e),o.add(e.particle),i=s,a=!0);if(a){for(const e of t.filter(({connSpec:e})=>e.isOutput))o.has(e.particle)||null===(s=Bn.effectiveType(i,[e.connSpec]))||(r.push(e),o.add(e.particle),i=s);(!n||r.length>n.length)&&(n=r)}}return n?e=>{const t=e.newHandle();t.fate="create";for(const{particle:r,connSpec:i}of n){e.updateToClone({particle:r}).particle.addConnectionName(i.name).connectToHandle(t)}return 0}:void 0}}(ss.Independent),this)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class fs extends os{constructor(e,t){super(e,t),this._walker=new class extends ss{onRecipe(e){if(e.getUnnamedUntypedConnections())return;if(e.particles.some(e=>!e.spec))return;const t=new Set;e.getFreeConnections().forEach(({connSpec:e})=>{Array.from(t).find(t=>ft.compareTypes({type:t},{type:e.type}))||t.add(e.type)});const n=new Map;for(const r of t){const t=[...e.particles].sort((e,t)=>t.getUnboundConnections(r).length-e.getUnboundConnections(r).length).filter(e=>e.getUnboundConnections(r).length>0);g()(t.length>0);const i=t[0],s=[];let o=e.getFreeConnections(r).filter(e=>e.particle!==i),a=0;for(;o.length>0;){for(const e of i.spec.handleConnections){if(!ft.compareTypes({type:r},{type:e.type}))continue;s.find(t=>t.particle===i&&t.connSpec===e)||s.push({particle:i,connSpec:e,group:[]});const t=s.find(t=>t.particle===i&&t.connSpec===e).group,n=o.filter(e=>!t.find(t=>t.particle===e.particle));let c=n.find(({connSpec:e})=>e.isInput!=e.isInput||e.isOutput!=e.isOutput);if(!c){if(0===n.length||0===a)continue;c=n[0]}t.push(c),o=o.filter(({connSpec:e})=>e!==c.connSpec)}a++}for(let e=0;e<s.length;++e)0===s[e].group.length?s.splice(e,1):s[e].group.push({particle:s[e].particle,connSpec:s[e].connSpec});0!==s.length&&n.set(r,s)}return n.size>0?e=>(n.forEach((t,n)=>{t.forEach(({group:t})=>{const n=e.newHandle();for(const{particle:r,connSpec:i}of t){const t=e.updateToClone({particle:r}).particle;t.connections[i.name]||t.addConnectionName(i.name),t.connections[i.name].connectToHandle(n)}})}),0):void 0}}(ss.Permuted)}get walker(){return this._walker}async generate(e){return ss.over(this.getResults(e),this.walker,this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class gs extends os{constructor(e,{contextual:t=!1,recipeIndex:n}){super(e,{contextual:t}),this._contextual=t,this._recipeIndex=n,this._loadedParticles=new Set(this.arc.loadedParticleSpecs().map(e=>e.implFile))}async generate({generation:e}){if(0!==e)return[];return await this._recipeIndex.ready,(this._contextual?this._contextualResults():this._allResults()).map(({recipe:e,score:t=1})=>({result:e,score:t,derivation:[{strategy:this,parent:void 0}],hash:e.digest(),valid:Object.isFrozen(e)}))}_contextualResults(){const e=[];for(const t of this.arc.activeRecipe.particles)for(const[n,r]of t.spec.slotConnections)for(const n of r.provideSlotConnections)e.push(...this._recipeIndex.findConsumeSlotConnectionMatch(t,n).map(({recipeParticle:e})=>({recipe:e.recipe})));for(const t of[].concat(...this.arc.allDescendingArcs.map(e=>e.activeRecipe.handles)))e.push(...this._recipeIndex.findHandleMatch(t,["use","?"]).map(e=>({recipe:e.recipe})));return e}_allResults(){return this._recipeIndex.recipes.map(e=>({recipe:e,score:1-e.getParticlesByImplFile(this._loadedParticles).length}))}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ms extends os{constructor(e,{search:t}){super(e,{search:t}),this._search=t}async generate({generation:e}){if(null==this._search||0!==e)return[];const t=new Dn;return t.setSearchPhrase(this._search),g()(t.normalize()),g()(!t.isResolved()),[{result:t,score:0,derivation:[{strategy:this,parent:void 0}],hash:t.digest(),valid:!0}]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ys extends os{async generate(e){const t=this.arc;return ss.over(this.getResults(e),new class extends ss{onPotentialSlotConnection(e,n,r){const{local:i,remote:s}=Lr.findAllSlotCandidates(n,r,t);if(!(i.length+s.length<2))return(i.length>0?i:s).map(e=>(t,n,r)=>{const i=n.addSlotConnection(r.name);return Lr.connectSlotConnection(i,e),1})}onSlotConnection(e,n){if(null==n.getSlotSpec())return;if(n.isConnected())return;const r=n.getSlotSpec(),i=n.particle,{local:s,remote:o}=Lr.findAllSlotCandidates(i,r,t);return s.length+o.length<2?void 0:(s.length>0?s:o).map(e=>(t,n)=>(Lr.connectSlotConnection(n,e),1))}}(ss.Permuted),this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class _s extends os{async generate(e){return ss.over(this.getResults(e),new class extends ss{onHandle(e,t){if(t.connections.length>0)return;return e.getFreeConnections().map(({particle:e,connSpec:t})=>(n,r)=>{return n.updateToClone({particle:e}).particle.addConnectionName(t.name).connectToHandle(r),1})}}(ss.Permuted),this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class vs extends os{async generate(e){const t=this.arc;return ss.over(this.getResults(e),new class extends ss{onParticle(e,n){if(n.name)return;const r=t.modality.intersection(e.modality);return t.context.findParticlesByVerb(n.primaryVerb).filter(e=>e.isCompatible(r)).map(e=>(t,n)=>{return n.name=e.name,n.spec=e,1})}}(ss.Permuted),this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ws extends os{async generate(e){const t=this.arc;return ss.over(this.getResults(e),new class extends ss{onParticle(e,n){if(n.name)return;let r=t.context.findRecipesByVerb(n.primaryVerb);const i={};for(const e of n.getSlotConnections()){const t=e.targetSlot&&e.targetSlot.sourceConnection?e.targetSlot:null;i[e.name]={targetSlot:t,providedSlots:{}};for(const t of Object.keys(e.providedSlots)){const n=e.providedSlots[t].consumeConnections.length>0?e.providedSlots[t]:null;i[e.name].providedSlots[t]=n}}const s={named:{},unnamed:[]};for(const e of Object.values(n.connections))s.named[e.name]={direction:e.direction,handle:e.handle};for(const e of n.unnamedConnections)s.unnamed.push({direction:e.direction,handle:e.handle});return(r=r.filter(e=>ws.satisfiesSlotConstraints(e,i)).filter(e=>ws.satisfiesHandleConstraints(e,s))).map(e=>(t,n)=>{const{particles:r}=e.mergeInto(t);n.remove();for(const e of Object.keys(i)){const n=i[e];if(n.targetSlot||Object.values(n.providedSlots).filter(e=>e).length>0){let i=!1;for(const s of r)if(ws.slotsMatchConstraint(s,s.getSlotSpecs(),e,n.providedSlots)){if(n.targetSlot){const{mappedSlot:r}=t.updateToClone({mappedSlot:n.targetSlot}),i=s.getSlotConnectionByName(e)||s.addSlotConnection(e);i.targetSlot=r,r.consumeConnections.push(i)}for(const r of Object.keys(n.providedSlots)){const i=n.providedSlots[r];if(!i)continue;const{mappedSlot:o}=t.updateToClone({mappedSlot:i}),a=s.getSlotConnectionByName(e)||s.addSlotConnection(e);a.providedSlots[r].remove(),a.providedSlots[r]=o,o._sourceConnection=a}i=!0;break}g()(i)}}function o(e,t,r,i,s){let o=r.connections[e];if(o&&o.handle)return!1;if(!ws.connectionMatchesConstraint(o||t,i))return!1;o=o||r.addConnectionName(t.name);for(let t=0;t<s.connections.length;t++){const r=s.connections[t];if(r.particle===n&&r.name==e)return o._handle=s,s.connections[t]=o,!0}return!1}function a(e,n,i){const{mappedHandle:s}=t.updateToClone({mappedHandle:i});for(const t of r)if(e){if(o(e,t.spec.getConnectionByName(e),t,n,s))return!0}else for(const r of t.spec.handleConnections)if(o(e,r,t,n,s))return!0;return!1}for(const e in s.named)s.named[e].handle&&g()(a(e,s.named[e],s.named[e].handle));for(const e of s.unnamed)e.handle&&g()(a(null,e,e.handle));return 1})}}(ss.Permuted),this)}static satisfiesHandleConstraints(e,t){for(const n in t.named)if(!ws.satisfiesHandleConnection(e,n,t.named[n]))return!1;for(const n of t.unnamed)if(!ws.satisfiesUnnamedHandleConnection(e,n))return!1;return!0}static satisfiesUnnamedHandleConnection(e,t){if(!t.handle)return!1;for(const n of e.particles){for(const e of Object.values(n.connections))if(ws.connectionMatchesConstraint(e,t))return!0;if(n.spec)for(const e of n.spec.handleConnections)if(ws.connectionSpecMatchesConstraint(e,t))return!0}return!1}static satisfiesHandleConnection(e,t,n){for(const r of e.particles)if(r.connections[t]){if(ws.connectionMatchesConstraint(r.connections[t],n))return!0}else if(r.spec&&r.spec.getConnectionByName(t)&&ws.connectionSpecMatchesConstraint(r.spec.getConnectionByName(t),n))return!0;return!1}static connectionSpecMatchesConstraint(e,t){return e.direction===t.direction}static connectionMatchesConstraint(e,t){if(e.direction!==t.direction)return!1;if(!t.handle)return!0;const n=[...t.handle.connections,e];return Boolean(Bn.effectiveType(t.handle.mappedType,n))}static satisfiesSlotConstraints(e,t){for(const n in t)if(!ws.satisfiesSlotConnection(e,n,t[n]))return!1;return!0}static satisfiesSlotConnection(e,t,n){for(const r of e.particles)if(r.spec&&ws.slotsMatchConstraint(r,r.getSlotSpecs(),t,n))return!0;return!1}static slotsMatchConstraint(e,t,n,r){if(!t.get(n))return!1;const i=e.getSlotConnectionBySpec(t.get(n));if(i&&i.targetSlot&&r.targetSlot)return!1;for(const e in r.providedSlots)if(void 0===t.get(n).provideSlotConnections.find(t=>t.name===e))return!1;return!0}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class bs extends os{async generate(e){return ss.over(this.getResults(e),new Ur(Ur.Permuted,this.arc),this)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ss extends os{constructor(e,t){super(e,t);const n={},r={};e.context.allParticles.forEach(e=>{this._addThing(e.name,{spec:e},n,r),e.verbs.forEach(t=>this._addThing(t,{spec:e},n,r))}),e.context.allRecipes.forEach(e=>{const t={innerRecipe:e};this._addThing(e.name,t,n,r),e.verbs.forEach(e=>this._addThing(e,t,n,r))});this._walker=new class extends ss{constructor(e,t,n){super(e),this.recipeIndex=n}onRecipe(e){if(!e.search||!e.search.unresolvedTokens.length)return;const t={},i=new Set,s=(e,n)=>{n.forEach(n=>{t[e]=t[e]||[],t[e].push(n),e.split(" ").forEach(e=>i.add(e))})};for(const[t,n]of Object.entries(r)){t.split(" ").every(t=>e.search.unresolvedTokens.includes(t))&&e.search.phrase.includes(t)&&s(t,n)}for(const t of e.search.unresolvedTokens){if(i.has(t))continue;const e=n[t];e&&s(t,e)}if(0===i.size)return;const o=e=>[].concat(...e);return((...e)=>e.reduce((e,t)=>o(e.map(e=>t.map(t=>[...e,t]))),[[]]))(...Object.values(t).map(e=>o(e))).map(e=>t=>(i.forEach(e=>t.search.resolveToken(e)),e.forEach(({spec:e,innerRecipe:n})=>{if(e){t.newParticle(e.name).spec=e}else{const e=this.recipeIndex.findCoalescableHandles(t,n);g()(n);const{cloneMap:r}=n.mergeInto(t);e.forEach((e,t)=>r.get(e).mergeInto(t))}}),i.size))}}(ss.Permuted,e,t.recipeIndex)}get walker(){return this._walker}getResults(e){return g()(e),[...super.getResults(e).filter(e=>!e.result.isResolved()),...e.terminal]}_addThing(e,t,n,r){if(!e)return;this._addThingByToken(e.toLowerCase(),t,n);const i=e.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim();i!==e&&this._addThingByToken(i.toLowerCase(),t,r)}_addThingByToken(e,t,n){g()(e===e.toLowerCase()),n[e]=n[e]||[],n[e].find(e=>e===t)||n[e].push(t)}async generate(e){return await this.walker.recipeIndex.ready,ss.over(this.getResults(e),this.walker,this)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Cs=(new as.Builder).build();(new as.Builder).order([gs,ms],Ss,[ws,vs],us,fs,[cs,ls,_s],ys,ds,bs).build(),(new as.Builder).order(gs,ms,Ss,ws,vs,us,fs,_s,cs,ls,ys,ds,bs).build();class Es{constructor(){this.versionByStore={},this.relevanceMap=new Map}static create(e,t){const n=new Es,r=e.getVersionByStore({includeArc:!0,includeContext:!0});return t.handles.forEach(e=>{e.id&&void 0!==r[e.id]&&(n.versionByStore[e.id]=r[e.id])}),n}apply(e){for(const t of e.keys())this.relevanceMap.has(t)?this.relevanceMap.set(t,this.relevanceMap.get(t).concat(e.get(t))):this.relevanceMap.set(t,e.get(t))}calcRelevanceScore(){let e=1,t=!1;for(const n of this.relevanceMap.values()){const r=Es.particleRelevance(n);r<0&&(t=!0),e*=Math.abs(r)}return e*(t?-1:1)}isRelevant(e){const t=e.particles.some(e=>e.getSlotConnectionNames().length>0);let n=!1;for(const[e,t]of this.relevanceMap)if(!(t[t.length-1]<0)&&e.getSlotConnectionNames().length){n=!0;break}return t===n}static scaleRelevance(e){return null==e&&(e=5),(e=Math.max(-1,Math.min(e,10)))/5}static particleRelevance(e){let t=1,n=!1;return e.forEach(e=>{const r=Es.scaleRelevance(e);r<0&&(n=!0),t*=Math.abs(r)}),t*(n?-1:1)}calcParticleRelevance(e){return this.relevanceMap.has(e)?Es.particleRelevance(this.relevanceMap.get(e)):-1}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const{log:ks}=p("planner","olive"),xs=()=>Eo.getRuntime().getCacheService().getOrCreateCache("suggestionByHash");class Ts{init(e,{strategies:t=Ts.AllStrategies,ruleset:n=Cs,strategyArgs:r={},speculator:i,inspectorFactory:s,noSpecEx:o=!1}){r=Object.freeze({...r}),this.arc=e;const a=t.map(t=>new t(e,r));this.strategizer=new is(a,[],n),this.speculator=i,s&&(this.inspector=s.create(this)),this.noSpecEx=o}async plan(e,t=[]){const n=Ji.start({cat:"planning",name:"Planner::plan",overview:!0,args:{timeout:e}});e=e||-1;const r=[],i=Ui();do{const s=await n.wait(this.strategizer.generate()),o=this.strategizer.generated;n.addArgs({generated:o.length,generation:this.strategizer.generation}),t&&t.push({generated:o,record:s});const a=this.strategizer.generated.map(e=>e.result).filter(e=>e.isResolved());r.push(...a);const c=Ui()-i;if(e>=0&&c>e){console.warn(`Planner.plan timed out [elapsed=${Math.floor(c)}ms, timeout=${e}ms].`);break}}while(this.strategizer.generated.length+this.strategizer.terminal.length>0);return n.end(),t.length&&this.inspector&&this.inspector.strategizingRecord(rs.formatSerializableGenerations(t),{label:"Planner",keep:!0}),r}_speculativeThreadCount(){const e=qi.hardwareConcurrency(),t=qi.deviceMemory();if(!e||!t)return 2;const n=t/4/.125,r=e/2;return Math.max(2,Math.min(n,r))}_splitToGroups(e,t){const n=[];if(!e||0===e.length)return n;const r=Math.max(1,Math.floor(e.length/t));let i=0;for(let s=0;s<t&&i<e.length;s++)n.push(e.slice(i,i+r)),i+=r;return i<e.length&&n[n.length-1].push(...e.slice(i,e.length)),n}async suggest(e,t=[]){const n=Ji.start({cat:"planning",name:"Planner::suggest",overview:!0,args:{timeout:e}}),r=await n.wait(this.plan(e,t)),i=this._speculativeThreadCount(),s=this._splitToGroups(r,i),o=await n.wait(Promise.all(s.map(async(e,n)=>{const r=[];for(const i of e){const e=(e=>e.substring(e.length-4))(await i.digest());if(Nn.matchesRecipe(this.arc.activeRecipe,i)){this._updateGeneration(t,e,e=>e.active=!0);continue}const s=Ji.start({cat:"speculating",sequence:`speculator_${n}`,overview:!0,args:{groupIndex:n}}),o=await this.retriveOrCreateSuggestion(e,i,this.arc);o?(this._updateGeneration(t,e,e=>e.description=o.descriptionText),o.groupIndex=n,r.push(o),s.end({name:o.descriptionText,args:{rank:o.rank,hash:e,groupIndex:n}})):(this._updateGeneration(t,e,e=>e.irrelevant=!0),s.end({name:"[Irrelevant suggestion]",args:{hash:e,groupIndex:n}}))}return r}))),a=[].concat(...o);return n.endWith(a)}static clearCache(){xs().clear()}async retriveOrCreateSuggestion(e,t,n){const r=xs().get(e);if(r&&r.isUpToDate(n,t))return r;let i=void 0,s=null;if(this._shouldSpeculate(t)){const n=await this.speculator.speculate(this.arc,t,e);if(!n)return;const r=n.speculativeArc;i=n.relevance,s=await Wn.create(r,i)}else{const e=await n.cloneForSpeculativeExecution();await e.mergeIntoActiveRecipe(t),i=Es.create(n,t),s=await Wn.create(e,i)}const o=ts.create(t,e,i);return o.setDescription(s,this.arc.modality,this.arc.pec.slotComposer?this.arc.pec.slotComposer.modalityHandler.descriptionFormatter:void 0),xs().set(e,o),o}_shouldSpeculate(e){if(!this.speculator||this.noSpecEx)return!1;if(e.handleConnections.some(({type:e})=>"[Description {Text key, Text value}]"===e.toString()))return!0;const t=e.patterns.filter(e=>e.includes("${")),n=e.particles.filter(e=>!!e.spec.pattern&&e.spec.pattern.includes("${"));if(0===t.length&&0===n.length)return!1;for(const n of t){const t=Wn.getAllTokens(n);for(const n of t){const t=e.particles.find(e=>e.name===n[0]);g()(t);const r=t.getConnectionByName(n[1]);if(r&&r.handle&&Nn.directionCounts(r.handle).out>0)return!0}}for(const e of n){const t=Wn.getAllTokens(e.spec.pattern);for(const n of t){const t=e.getConnectionByName(n[0]);if(t&&t.handle&&Nn.directionCounts(t.handle).out>0)return!0}}return!1}_updateGeneration(e,t,n){e&&e.forEach(e=>{e.generated.forEach(e=>{g()("string"==typeof e.hash),"string"==typeof e.hash&&e.hash.endsWith(t)&&n(e)})})}}Ts.InitializationStrategies=[gs,ms],Ts.ResolutionStrategies=[Ss,
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class extends os{async generate(e){const t=this.arc,n=(e,n)=>{const r=Nn.directionCounts(n);let i;i=t.findStoresByType(n.type,{tags:[`${e}`]});let s="use";return 0===i.length&&(i=t.context.findStoresByType(n.type,{tags:[`${e}`],subtype:0===r.out}),s=0===r.out?"map":"copy"),(i=i.filter(e=>!n.recipe.handles.find(t=>t.id===e.id))).map(t=>({store:t,fate:s,token:e}))};return ss.over(this.getResults(e),new class extends ss{onHandle(e,t){if(!e.search||0===e.search.unresolvedTokens.length)return;if(t.isResolved()||0===t.connections.length)return;const r=[];for(const i of e.search.unresolvedTokens)r.push(...n(i,t));return 0!==r.length?r.map(e=>(t,n)=>(n.fate=e.fate,n.mapToStorage(e.store),t.search.resolveToken(e.token),0)):void 0}}(ss.Permuted),this)}},fs,ps,us,ys,ls,vs,ws,class extends os{async generate(e){return ss.over(this.getResults(e),new class extends ss{onHandleConnection(e,t){if(t.name)return;if(!t.particle.spec)return;return t.findSpecsForUnnamedHandles().map(e=>(t,n)=>(n.particle.nameConnection(n,e.name),1))}}(ss.Permuted),this)}},cs,ds,_s,bs,class extends os{async generate(e){const t=this.arc;return ss.over(this.getResults(e),new class extends ss{onPotentialHandleConnection(e,n,r){const i=this._findMatchingParticleSpecs(t,r,r.type);if(!i)return;const s=[];for(const e of i)s.push((n,r,i)=>{const s=r.addConnectionName(i.name),o=Nn.constructImmediateValueHandle(s,e,t.generateID());g()(o),s.connectToHandle(o)});return s}_findMatchingParticleSpecs(e,t,n){if(!t)return;if("host"!==t.direction)return;g()(n instanceof lt);const r=n,i=[];for(const t of e.context.allParticles){const e=r.interfaceInfo.cloneWithResolutions(new Map);!1!==e.restrictType(t)&&(e.canEnsureResolved()&&i.push(t))}return i}}(ss.Permuted),this)}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */,hs,class extends os{async generate(e){const t=this.arc;return ss.over(this.getResults(e),new class extends ss{onRequiredParticle(e,n){return t.activeRecipe.particles.filter(e=>n.matches(e)).map(e=>(t,n)=>{if(n.matches(e)){for(const r of n.getSlotConnections()){const i=r.targetSlot,s=e.getSlotConnectionByName(r.name),o=s.targetSlot;if(!Lr.replaceOldSlot(t,i,o))return;for(const[e,n]of Object.entries(r.providedSlots)){const r=s.providedSlots[e];if(!Lr.replaceOldSlot(t,n,r))return}for(const e of t.requires)-1!==e.particles.indexOf(n)&&e.removeParticle(n)}return 0}})}}(ss.Permuted),this)}}],Ts.AllStrategies=Ts.InitializationStrategies.concat(Ts.ResolutionStrategies);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Rs extends Oi{constructor(e,t,n,r){super(e,void 0,t),this._suggestion=n,this._suggestionContent=Rs._extractContent(this._suggestion),this._eventHandler=r}get suggestion(){return this._suggestion}get templatePrefix(){return"suggest"}formatContent(e){return{template:`<suggestion-element inline key="{{hash}}" on-click="">${e.template}</suggestion-element>`,templateName:"suggestion",model:{hash:this.suggestion.hash,...e.model}}}onContainerUpdate(e,t){super.onContainerUpdate(e,t),e&&this.setContent(this._suggestionContent,this._eventHandler)}static _extractContent(e){return e.getDescription(k.Name.Dom)||{template:e.descriptionText}}static render(e,t,n){const r=Rs._extractContent(n);if(!r)return;const i=Object.assign(document.createElement("suggestion-element"),{plan:n});t.appendChild(i,t.firstElementChild);const s={container:i,model:r.model},o=new Oi(e);return o.addRenderingBySubId(void 0,s),o.eventHandler=()=>{},o._stampTemplate(s,o.createTemplateElement(r.template)),o._onUpdate(s),o}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Is extends Rs{constructor(e,t,n,r){super(e,t,n,r),this._suggestionContent=this._suggestionContent.template?this._suggestionContent:{template:`<dummy-suggestion>${this._suggestionContent}</dummy-element>`,templateName:"dummy-suggestion",model:{}},this._setContentPromise=null,this._content={},this.contentAvailable=new Promise(e=>this._contentAvailableResolve=e)}get suggestion(){return this._suggestion}get templatePrefix(){return"suggest"}onContainerUpdate(e,t){super.onContainerUpdate(e,t),e&&this.setContent(this._suggestionContent,this._eventHandler)}static render(e,t,n){}setContent(e,t){super.setContent(e,t),e?(this._content.templateName=e.templateName,e.template&&(this._content.template=e.template),this._content.model=e.model,this._contentAvailableResolve()):this._content={}}createNewContainer(e,t){return e}isSameContainer(e,t){return e===t}getInnerContainer(e){const t=Array.from(this.renderings,([e,{model:t}])=>t)[0],n=this.findProvidedContext(t=>t.id===e);if(n){if(n.spec.isSet&&t&&t.items&&t.items.models){const e={};for(const n of t.items.models)g()(n.id),e[n.id]=n.id;return e}return e}console.warn(`Cannot find provided spec for ${e} in ${this.consumeConn.getQualifiedName()}`)}createTemplateElement(e){return e}static findRootContainers(e){return e}static clear(e){}_onUpdate(e){}_stampTemplate(e){}_initMutationObserver(){return null}_observe(){}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Os extends Pi{constructor(e,t,n){super(e,n),this.suggestionConsumerClass=t}static createHeadlessHandler(){return new Os(Ni,Is)}}Os.domHandler=new Os(Oi,Rs,ni);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ns extends os{constructor(e,t){super(),this._recipes=[];for(let n of e.allRecipes){if(!n.isCompatible(t))continue;n=n.clone();const e={errors:new Map};n.normalize(e)?this._recipes.push(n):console.warn(`could not normalize a context recipe: ${[...e.errors.values()].join("\n")}.\n${n.toString()}`)}}async generate({generation:e}){return 0!==e?[]:this._recipes.map(e=>({result:e,score:1,derivation:[{strategy:this,parent:void 0}],hash:e.digest(),valid:Object.isFrozen(e)}))}}const Ps=[us,cs,bs,_s,ps];class As{constructor(e){this._isReady=!1;const t=Ji.start({cat:"indexing",name:"RecipeIndex::constructor",overview:!0}),n=ye.newSession(),r=new ei({id:n.newArcId("index-stub"),context:new Yc({id:n.newArcId("empty-context")}),loader:e.loader,slotComposer:new Fi({modalityHandler:Os.createHeadlessHandler(),noRoot:!0}),stub:!0}),i=new is([new Ns(e.context,e.modality),...Ps.map(e=>new e(r,{recipeIndex:this}))],[],Cs);this.ready=t.endWith((async()=>{const e=[];do{const t=await i.generate();e.push({record:t,generated:i.generated})}while(i.generated.length+i.terminal.length>0);const t=i.population,n=new Set(t);for(const e of t)for(const t of e.derivation)t.parent&&n.delete(t.parent);this._recipes=[...n].map(e=>e.result),this._isReady=!0})())}static create(e){return new As(e)}get recipes(){if(!this._isReady)throw Error("await on recipeIndex.ready before accessing");return this._recipes}ensureReady(){g()(this._isReady,"await on recipeIndex.ready before accessing")}findHandleMatch(e,t){this.ensureReady();const n=e.connections.map(e=>e.particle.name),r=[];for(const i of this._recipes)if(!i.particles.some(e=>!e.name))for(const s of i.handles){if(t&&!t.includes(s.fate))continue;if(!this.doesHandleMatch(e,s))continue;const i=s.connections.map(e=>e.particle.name);new Set([...n,...i]).size===n.length&&n.length===i.length||r.push(s)}return r}doesHandleMatch(e,t){if(Boolean(e.id)&&Boolean(t.id)&&e.id!==t.id)return!1;if(0===t.connections.length||"descriptions"===t.localName)return!1;const n=[e.originalFate,e.fate,t.originalFate,t.fate];if(!n.includes("copy")&&!n.includes("map")){const n=Nn.directionCounts(e),r=Nn.directionCounts(t);if(r.in+n.in===0||r.out+n.out===0)return!1}return!(e.tags.length>0&&!e.tags.some(e=>t.tags.includes(e)))&&!!Bn.effectiveType(e.mappedType,[...e.connections,...t.connections])}findConsumeSlotConnectionMatch(e,t){this.ensureReady();const n=[];for(const r of this._recipes)if(!r.particles.some(e=>!e.name))for(const i of r.particles)if(i.spec)for(const[r,s]of i.spec.slotConnections){const o=i.getSlotConnectionByName(r);if((!o||!o.targetSlot)&&(Lr.specMatch(s,t)&&Lr.tagsOrNameMatch(s,t))){const r=e.getSlotConnectionByName(t.name);let o=[];if((0!==t.handles.length||r&&!Lr.handlesMatch(i,r))&&0===(o=this._getMatchingHandles(i,e,t.handles)).length)continue;n.push({recipeParticle:i,slotSpec:s,matchingHandles:o})}}return n}findProvidedSlot(e,t){this.ensureReady();const n=[];for(const r of this._recipes)if(!r.particles.some(e=>!e.name))for(const i of r.slotConnections)for(const r of Object.values(i.providedSlots))Lr.slotMatches(e,t,r)&&n.push(r);return n}_getMatchingHandles(e,t,n){const r=[];for(const i of n){const n=t.getConnectionByName(i);n&&Object.values(e.connections).filter(e=>"host"!==e.direction&&(!e.handle||!e.handle.id||e.handle.id===n.handle.id)&&Bn.effectiveType(n.handle.mappedType,[e])).forEach(e=>{this._fatesAndDirectionsMatch(n,e)&&r.push({handle:n.handle,matchingConn:e})})}return r}_fatesAndDirectionsMatch(e,t){const n=t.handle,r=(n?n.connections:[t]).find(e=>e.isOutput);if(!e.handle)throw new Error("Unexpected empty Handle");switch(e.handle.fate){case"create":case"use":return!n||["use","?"].includes(n.fate);case"copy":return!n||"create"!==n.fate;case"map":return!(r||n&&"copy"===n.fate);case"?":return!1;default:throw new Error(`Unexpected fate ${e.handle.fate}`)}}get coalescableFates(){return["create","use","?"]}findCoalescableHandles(e,t,n){g()(e!==t,"Cannot coalesce handles in the same recipe");const r=new Map;n=n||new Set;for(const i of e.handles)if(!n.has(i)&&this.coalescableFates.includes(i.fate))for(const e of t.handles)!n.has(e)&&this.coalescableFates.includes(e.fate)&&this.doesHandleMatch(i,e)&&(r.set(i,e),n.add(i),n.add(e));return r}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ms{constructor(...e){this.elementSet=new Set,this.stringSet=new Set,e.forEach(e=>this.add(e))}add(e){const t=e.toUniqueString();this.stringSet.has(t)||(this.stringSet.add(t),this.elementSet.add(e))}addAll(e){e.elementSet.forEach(e=>this.add(e))}map(e){const t=new Ms;for(const n of this)t.add(e(n));return t}[Symbol.iterator](){return this.elementSet[Symbol.iterator]()}asSet(){return this.elementSet}toArray(){return[...this.elementSet]}get size(){return this.elementSet.size}get isEmpty(){return 0===this.size}equals(e){return this.toUniqueString()===e.toUniqueString()}toUniqueString(){const e=[...this.stringSet];return e.sort(),"{"+e.join(", ")+"}"}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ds{constructor(){this.set=new Set,this.array=[]}add(e){this.set.add(e),this.array.push(e)}addAll(e){e.set.forEach(e=>this.set.add(e)),this.array.push(...e.array)}has(e){return this.set.has(e)}copy(){const e=new Ds;return e.addAll(this),e}get length(){return this.array.length}asSet(){return this.set}asArray(){return this.array}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Fs{constructor(e=new Set,t=new Ds,n=new Set){this.nodeIds=e,this.edgeIds=t,this.tags=n}modify(e){this.edgeIds.addAll(e.edgeIds),e.nodeIds.forEach(e=>this.nodeIds.add(e)),e.tagOperations.forEach((e,t)=>{"add"===e?this.tags.add(t):this.tags.delete(t)})}copy(){return new Fs(new Set(this.nodeIds),this.edgeIds.copy(),new Set(this.tags))}copyAndModify(e){const t=this.copy();return t.modify(e),t}evaluateCheck(e){return"operator"in e?"or"===e.operator?e.children.some(e=>this.evaluateCheck(e)):e.children.every(e=>this.evaluateCheck(e)):this.checkCondition(e)}checkCondition(e){let t;switch(e.type){case"node":t=this.nodeIds.has(e.value);break;case"edge":t=this.edgeIds.has(e.value);break;case"tag":t=this.tags.has(e.value);break;default:throw new Error("Unknown condition type.")}return e.negated?!t:t}toUniqueString(){const e=[];for(const t of this.nodeIds)e.push("node:"+t);for(const t of this.tags)e.push("tag:"+t);for(const t of this.edgeIds.asSet())e.push("edge:"+t);return e.sort(),"{"+e.join(", ")+"}"}}class js extends Ms{copyAndModify(e){return this.map(t=>t.copyAndModify(e))}}var $s;!function(e){e.Add="add",e.Remove="remove"}($s||($s={}));class Bs{constructor(e=new Set,t=new Ds,n=new Map){this.nodeIds=e,this.edgeIds=t,this.tagOperations=n}static parse(...e){const t=new Bs;for(const n of e){const e=n[0];if(!"+-".includes(e))throw new Error(`'${n}' must start with either + or -`);const r="+"===e?$s.Add:$s.Remove,[i,s]=n.slice(1).split(":",2);if(r===$s.Remove&&"tag"!==i)throw new Error(`The - operator can only be used with tags. Got '${n}'.`);switch(i){case"tag":t.tagOperations.set(s,r);break;case"node":t.nodeIds.add(s);break;case"edge":t.edgeIds.add(s);break;default:throw new Error(`Unknown type: '${n}'`)}}return t}static fromClaims(e,t){const n=new Bs;if(t)for(const e of t)e.type===Re.IsTag&&n.tagOperations.set(e.tag,e.isNot?$s.Remove:$s.Add);return n.edgeIds.add(e.edgeId),n.nodeIds.add(e.start.nodeId),n}copy(){return new Bs(new Set(this.nodeIds),this.edgeIds.copy(),new Map(this.tagOperations))}copyAndModify(e){const t=this.copy();return t.edgeIds.addAll(e.edgeIds),e.nodeIds.forEach(e=>t.nodeIds.add(e)),e.tagOperations.forEach((e,n)=>t.tagOperations.set(n,e)),t}toFlow(){const e=new Fs;return e.modify(this),e}toUniqueString(){const e=[];for(const t of this.edgeIds.asSet())e.push("+edge:"+t);for(const t of this.nodeIds)e.push("+node:"+t);for(const[t,n]of this.tagOperations){const r=n===$s.Add?"+":"-";e.push(r+"tag:"+t)}return e.sort(),"{"+e.join(", ")+"}"}}class Ls extends Ms{copyAndModify(e){return this.map(t=>t.copyAndModify(e))}}class Us{constructor(){this.ingress=!1}get inNodes(){return this.inEdges.map(e=>e.start)}get outNodes(){return this.outEdges.map(e=>e.end)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Hs extends Us{constructor(e,t){super(),this.inEdgesByName=new Map,this.outEdgesByName=new Map,this.nodeId=e,this.name=t.name}addInEdge(e){this.inEdgesByName.set(e.connectionName,e)}addOutEdge(e){this.outEdgesByName.set(e.connectionName,e)}get inEdges(){return[...this.inEdgesByName.values()]}get outEdges(){return[...this.outEdgesByName.values()]}inEdgesFromOutEdge(e){return g()(this.outEdges.includes(e),"Particle does not have the given out-edge."),e.derivesFrom&&e.derivesFrom.length?e.derivesFrom:this.inEdges}}class zs{constructor(e,t,n,r){this.edgeId=e,this.start=n,this.end=t,this.connectionName=r.name,this.label=`${t.name}.${this.connectionName}`,this.connectionSpec=r.spec,this.modifier=Bs.fromClaims(this,r.handle.claims)}get type(){return this.connectionSpec.type}}class qs{constructor(e,t,n,r){this.edgeId=e,this.start=t,this.end=n,this.connectionName=r.name,this.connectionSpec=r.spec,this.label=`${t.name}.${this.connectionName}`,this.modifier=Bs.fromClaims(this,r.spec.claims),this.derivesFrom=[]}get type(){return this.connectionSpec.type}computeDerivedFromEdges(){if(g()(0===this.derivesFrom.length,'"Derived from" edges have already been computed.'),this.connectionSpec.claims)for(const e of this.connectionSpec.claims)if(e.type===Re.DerivesFrom){const t=this.start.inEdgesByName.get(e.parentHandle.name);g()(t,`Handle '${e.parentHandle.name}' is not an in-edge.`),this.derivesFrom.push(t)}0===this.derivesFrom.length&&"Reference"===this.type.tag&&this.getEdgesCompatibleWithReference().forEach(e=>this.derivesFrom.push(e))}getEdgesCompatibleWithReference(){"Reference"!==this.type.tag&&g()(!1,"Must be a Reference.");const e=this.start,t=this.type,n=[];for(const r of e.inEdges)Ws(r.type,t,!0)&&n.push(r);for(const r of e.outEdges)r!==this&&r instanceof qs&&Ws(r.type,t,!1)&&n.push(r);return n}}function Ws(e,t,n){switch(e.tag){case"Entity":if(ft.compareTypes({type:e,direction:"in"},{type:t.getContainedType(),direction:"out"}))return!0;if(n)for(const n of Object.values(e.getEntitySchema().fields))if(Vs(n,t))return!0;return!1;case"Reference":return!!n&&Ws(e.getContainedType(),t,n);case"Collection":case"BigCollection":return Ws(e.getContainedType(),t,n);default:return!1}}function Vs(e,t){switch(e.kind){case"schema-reference":return!!Ws(e.schema.model,t,!0);case"schema-collection":return Vs(e.schema,t);case"schema-primitive":return!1;default:throw new Error(`Unsupported field: ${e}`)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ks extends Us{constructor(e,t){super(),this.inEdges=[],this.outEdges=[],this.nodeId=e,this.storeId=t.id,"create"!==t.fate&&(this.ingress=!0)}get connectionsAsStrings(){const e=[];return this.inEdges.forEach(t=>{this.outEdges.forEach(n=>{e.push(`${t.label} -> ${n.label}`)})}),e}addInEdge(e){this.inEdges.push(e)}addOutEdge(e){this.outEdges.push(e)}inEdgesFromOutEdge(e){return g()(this.outEdges.includes(e),"Handle does not have the given out-edge."),this.inEdges}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Qs extends Us{constructor(e,t){super(),this.inEdges=[],this.outEdges=[],this.nodeId=e}addInEdge(e){this.inEdges.push(e)}addOutEdge(e){throw new Error("Slots can't have out-edges (yet).")}inEdgesFromOutEdge(e){throw new Error("Slots can't have out-edges (yet).")}}class Gs{constructor(e,t,n,r){this.edgeId=e,this.start=t,this.end=n,this.connectionName=r.name,this.label=`${t.name}.${this.connectionName}`,this.modifier=Bs.fromClaims(this,[])}get check(){return this.end.check}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Zs{constructor(e,t){if(this.edgeMap=new Map,this.handleSpecMap=new Map,!e.isResolved())throw new Error("Recipe must be resolved.");const n=function(e){const t=new Map;return e.forEach((e,n)=>{const r="P"+n;t.set(e,new Hs(r,e))}),t}(e.particles),r=function(e){const t=new Map;return e.forEach((e,n)=>{const r="H"+n;t.set(e,new Ks(r,e))}),t}(e.handles),i=function(e){const t=new Map;return e.forEach((e,n)=>{const r="S"+n;t.set(e,new Qs(r,e))}),t}(e.slots);this.particles=[...n.values()],this.handles=[...r.values()],this.slots=[...i.values()],this.nodes=[...this.particles,...this.handles,...this.slots],this.particleMap=new Map(this.particles.map(e=>[e.name,e])),this.manifest=t;let s=0;e.handleConnections.forEach(e=>{const t=n.get(e.particle),i=r.get(e.handle);this.handleSpecMap.set(e.spec,i);const o=n=>{const r="E"+s++,o=function(e,t,n,r,i){if("in"===e){const e=new zs(i,t,n,r);return t.addInEdge(e),n.addOutEdge(e),e}{const e=new qs(i,t,n,r);return t.addOutEdge(e),n.addInEdge(e),e}}(n,t,i,e,r);this.edgeMap.set(r,o)};if("inout"===e.direction)o("in"),o("out");else{if("in"!==e.direction&&"out"!==e.direction)throw new Error(`Unsupported handle connection direction: ${e.direction}`);o(e.direction)}}),e.slotConnections.forEach(e=>{const t=n.get(e.particle),r=i.get(e.targetSlot),o="E"+s++,a=function(e,t,n,r){const i=new Gs(r,e,t,n);return e.addOutEdge(i),t.addInEdge(i),i}(t,r,e,o);this.edgeMap.set(o,a);for(const t of e.getSlotSpec().provideSlotConnections){const n=e.providedSlots[t.name];i.get(n).check=t.check?this.createFlowCheck(t.check):null}}),this.edges.forEach(e=>{e instanceof zs&&e.connectionSpec.check&&(e.check=this.createFlowCheck(e.connectionSpec.check)),e instanceof qs&&e.computeDerivedFromEdges()})}get edges(){return[...this.edgeMap.values()]}get connectionsAsStrings(){const e=[];for(const t of this.handles)t.connectionsAsStrings.forEach(t=>e.push(t));return e}edgeIdsToPath(e){return e.map(e=>this.edgeMap.get(e).label).join(" -> ")}handleCheckToNodeId(e){return this.handleSpecMap.get(e.parentHandle).nodeId}outputCheckToEdgeId(e){const t=this.edges.find(t=>t instanceof qs&&t.connectionSpec===e.output);return g()(t,`Output with id ${e.output.name} does not exist.`),t.edgeId}storeCheckToNodeId(e){const t=this.resolveStoreRefToID(e.storeRef),n=this.handles.find(e=>e.storeId===t);return g()(n,`Store with id ${t} is not connected by a handle.`),n.nodeId}resolveStoreRefToID(e){if("id"===e.type){const t=this.manifest.findStoreById(e.store);return g()(t,`Store with id '${e.store}' not found.`),t.id}{const t=this.manifest.findStoreByName(e.store);return g()(t,`Store with name ${e.store} not found.`),t.id}}createFlowCheck(e,t){return"and"===(t=t||e.expression).type||"or"===t.type?{originalCheck:e,operator:t.type,children:t.children.map(t=>this.createFlowCheck(e,t))}:{...this.createFlowCondition(t),originalCheck:e}}createFlowCondition(e){switch(e.type){case Te.HasTag:return{type:"tag",negated:e.isNot,value:e.tag};case Te.IsFromHandle:return{type:"node",negated:e.isNot,value:this.handleCheckToNodeId(e)};case Te.IsFromOutput:return{type:"edge",negated:e.isNot,value:this.outputCheckToEdgeId(e)};case Te.IsFromStore:return{type:"node",negated:e.isNot,value:this.storeCheckToNodeId(e)};default:throw new Error("Unknown CheckType")}}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ys{constructor(e,t){this.check=e,this.flow=t}getFailureMessage(e){return`'${this.check}' failed for path: ${e.edgeIdsToPath(this.flow.edgeIds.asArray())}`}}class Xs{constructor(e){this.check=e}getFailureMessage(e){return`'${this.check}' failed: no data ingress.`}}class Js{constructor(){this.checkFailures=[],this.ingressFailures=[]}addCheckFailure(e,t){this.checkFailures.push(new Ys(e,t))}addIngressFailure(e){this.ingressFailures.push(new Xs(e))}addAllFailures(e){e.checkFailures.forEach(e=>this.addCheckFailure(e.check,e.flow)),e.ingressFailures.forEach(e=>this.addIngressFailure(e.check))}get isValid(){return 0===this.checkFailures.length&&0===this.ingressFailures.length}getFailureMessages(e){return[...this.ingressFailures.map(t=>t.getFailureMessage(e)),...this.checkFailures.map(t=>t.getFailureMessage(e))]}}function eo(e){const t=new no(e.edges);return t.resolve(),t.validateAllChecks()}class to{constructor(e){this.resolvedFlows=new js,this.unresolvedFlows=new Map,this.edge=e;const t=e.modifier||new Bs,n=e.start.inEdgesFromOutEdge(e);n.length>0&&n.forEach(e=>this.inheritFromEdge(e,t)),e.start.ingress&&this.resolvedFlows.add(t.toFlow())}get isResolved(){return 0===this.unresolvedFlows.size}get parents(){return[...this.unresolvedFlows.keys()]}expandParent(e){g()(this.unresolvedFlows.has(e.edge),"Can't substitute parent edge, it's not an unresolved parent.");const t=this.unresolvedFlows.get(e.edge);this.unresolvedFlows.delete(e.edge);for(const n of t){const t=e.resolvedFlows.copyAndModify(n);this.resolvedFlows.addAll(t);for(const[t,r]of e.unresolvedFlows)for(const e of r){const r=e.copyAndModify(n);this.inheritFromEdge(t,r)}}this.removeSelfReference()}inheritFromEdge(e,t){this.unresolvedFlows.has(e)?this.unresolvedFlows.get(e).add(t):this.unresolvedFlows.set(e,new Ls(t))}removeSelfReference(){const e=this.unresolvedFlows.get(this.edge);if(!e)return;this.unresolvedFlows.delete(this.edge);for(const t of this.unresolvedFlows.values()){const n=new Ls;for(const r of e)n.addAll(t.copyAndModify(r));t.addAll(n)}const t=new js;for(const n of e)t.addAll(this.resolvedFlows.copyAndModify(n));this.resolvedFlows.addAll(t)}toString(){const e=[`EdgeExpression(${this.edge.edgeId}) {`];for(const t of this.resolvedFlows)e.push("  "+t.toUniqueString());for(const[t,n]of this.unresolvedFlows)for(const r of n)e.push(`  EdgeExpression(${t.edgeId}) + ${r.toUniqueString()}`);return e.push("}"),e.join("\n")}}class no{constructor(e){this.edgeExpressions=new Map,this._isResolved=!1,this.edges=e,this.dependentExpressions=new Map;for(const t of e)this.dependentExpressions.set(t,new Set)}get isResolved(){return this._isResolved}validateAllChecks(){g()(this._isResolved,"Graph must be resolved before checks can be validated.");const e=new Js;for(const t of this.edges)if(t.check){const n=this.validateCheckOnEdge(t);e.addAllFailures(n)}return e}validateCheckOnEdge(e){g()(this._isResolved,"Graph must be resolved before checks can be validated."),g()(e.check,"Edge does not have any check conditions.");const t=e.check,n=new Js,r=this.edgeExpressions.get(e).resolvedFlows;if(0===r.size)return n.addIngressFailure(t.originalCheck.toManifestString()),n;for(const e of r)e.evaluateCheck(t)||n.addCheckFailure(t.originalCheck.toManifestString(),e);return n}resolve(){if(this._isResolved)return;for(const e of this.edges)this.processEdge(e);const e=this.edges.length;g()(this.edgeExpressions.size===e),g()(this.dependentExpressions.size===e);for(const e of this.edgeExpressions.values())g()(e.isResolved,`Unresolved edge expression: ${e.toString()}`);this._isResolved=!0}processEdge(e){let t=this.edgeExpressions.get(e);if(t)return t;t=new to(e),this.edgeExpressions.set(e,t);for(const e of t.parents)this.dependentExpressions.get(e).add(t),this.tryExpandParent(t,e);for(const t of this.dependentExpressions.get(e))this.tryExpandParent(t,e);return t}tryExpandParent(e,t){if(!e.unresolvedFlows.has(t))return;const n=this.edgeExpressions.get(t);n&&(this.dependentExpressions.get(t).delete(e),e.expandParent(n),n.parents.forEach(t=>this.dependentExpressions.get(t).add(e)))}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ro extends os{constructor(e){super(),this.recipe=e}async generate({generation:e}){return 0!==e?[]:[{result:this.recipe,score:1,derivation:[{strategy:this,parent:void 0}],hash:this.recipe.digest(),valid:Object.isFrozen(this.recipe)}]}}class io{constructor(e,t){this.arc=e,t.listen("fetch-strategies",async()=>t.send({messageType:"fetch-strategies-result",messageBody:Ts.AllStrategies.map(e=>e.name)})),t.listen("invoke-planner",async e=>t.send({messageType:"invoke-planner-result",messageBody:await this.invokePlanner(e.messageBody.manifest,e.messageBody.method),requestId:e.requestId}))}async invokePlanner(e,t){let n;this.recipeIndex||(this.recipeIndex=As.create(this.arc),await this.recipeIndex.ready);try{n=await Yc.parse(e,{loader:this.arc._loader,fileName:"manifest.manifest"})}catch(e){return this.processManifestError(e)}if(0===n.recipes.length)return{results:[]};if(n.recipes.length>1)return{error:{message:`More than 1 recipe present, found ${n.recipes.length}.`}};const r=n.recipes[0];return r.normalize(),"arc"===t||"arc_coalesce"===t?this.multiStrategyRun(r,t):this.singleStrategyRun(r,t)}async multiStrategyRun(e,t){const n="arc_coalesce"===t?Ts.ResolutionStrategies:Ts.ResolutionStrategies.filter(e=>e!==hs),r=new is([new ro(e),...n.map(e=>this.instantiate(e))],[],Cs),i=[];do{await r.generate(),i.push(...r.terminal)}while(r.generated.length+r.terminal.length>0);return this.processStrategyOutput(i)}async singleStrategyRun(e,t){const n=Ts.AllStrategies.find(e=>e.name===t);return n?this.processStrategyOutput(await this.instantiate(n).generate({generation:0,generated:[{result:e,score:1}],population:[{result:e,score:1}],terminal:[{result:e,score:1}]})):{error:{message:`Strategy ${t} not found`}}}instantiate(e){return new e(this.arc,{recipeIndex:this.recipeIndex})}processStrategyOutput(e){return{results:e.map(e=>{const t=e.result,n=new Map;Object.isFrozen(t)||t.normalize({errors:n});let r,i="";try{i=t.toString({showUnresolved:!0})}catch(e){console.warn(e)}try{const e=this.arc.context,[n,i]=function(e,t){const n=new Zs(e,t);return[n,eo(n)]}(t,e);r=i.isValid?{success:!0,message:"Success!"}:{success:!1,message:"Failed: "+i.getFailureMessages(n).join("\n")}}catch(e){r={success:!1,message:e.toString()}}return{recipe:i,derivation:this.extractDerivation(e),dataflow:r,errors:[...n.values()].map(e=>({error:e}))}})}}extractDerivation(e){const t=[];for(const n of e.derivation||[])if(n.parent||n.strategy.constructor===ro){if(n.parent){const e=this.extractDerivation(n.parent);for(const r of e)t.push(r?`${r} -> ${n.strategy.constructor.name}`:n.strategy.constructor.name);0===e.length&&t.push(n.strategy.constructor.name)}}else t.push(n.strategy.constructor.name);return t}processManifestError(e){let t=null;const n=[{pattern:/could not find particle ([A-Z][A-Za-z0-9_]*)\n/,predicate:e=>t=>!!t.particles.find(t=>t.name===e)},{pattern:/Could not resolve type reference to type name '([A-Z][A-Za-z0-9_]*)'\n/,predicate:e=>t=>!!t.schemas[e]}];for(const{pattern:r,predicate:i}of n){const n=r.exec(e.message);if(n){const[e,r]=n,s=this.findManifestNames(this.arc.context,i(r));s.length>0&&(t={action:"import",fileNames:s})}}return{suggestion:t,error:(({location:e,message:t})=>({location:e,message:t}))(e)}}findManifestNames(e,t){const n=new Map;return this.findManifestNamesRecursive(e,t,n),[...n.entries()].sort(([e,t],[n,r])=>t-r).map(e=>e[0])}findManifestNamesRecursive(e,t,n){let r=t(e)?0:Number.MAX_SAFE_INTEGER;for(const i of e.imports)r=Math.min(r,this.findManifestNamesRecursive(i,t,n)+1);return r<Number.MAX_SAFE_INTEGER&&e.fileName.startsWith("http")&&n.set(e.fileName,r),r}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const so="object"==typeof window?window:global;so._arcDebugPromise||(so._arcDebugPromise=new Promise(e=>{so._arcDebugPromiseResolve=e}));class oo{static get onceConnected(){return so._arcDebugPromise}static markConnected(){so._arcDebugPromiseResolve()}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ao{constructor(){this.debouncedMessages=[],this.messageListeners=new Map,this.timer=null}send(e){this.ensureNoCycle(e),this.debouncedMessages.push(e),this.debouncedMessages.length>10?this._empty():this.timer||(this.timer=setTimeout(()=>this._empty(),100))}listen(e,t,n){g()(t),g()(e);const r=`${"string"==typeof e?e:e.id.toString()}/${t}`;let i=this.messageListeners.get(r);i||this.messageListeners.set(r,i=[]),i.push(n)}forArc(e){return new co(e,this)}async _handleMessage(e){const t=this.messageListeners.get(`${e.arcId}/${e.messageType}`);t?await Promise.all(t.map(t=>t(e))):console.warn(`No one is listening to ${e.messageType} message`)}_empty(){this._flush(this.debouncedMessages),this.debouncedMessages=[],clearTimeout(this.timer),this.timer=null}_flush(e){throw new Error("Not implemented in an abstract class")}ensureNoCycle(e,t=[]){e&&"object"==typeof e&&(g()(-1===t.indexOf(e),"Message cannot contain a cycle"),t.push(e),(Array.isArray(e)?e:Object.values(e)).forEach(e=>this.ensureNoCycle(e,t)),t.pop())}}class co{constructor(e,t){this.channel=t,this.arcId=e.id.toString()}send(e){this.channel.send({meta:{arcId:this.arcId},...e})}listen(e,t){this.channel.listen(this.arcId,e,t)}}var lo=n(64),ho=n.n(lo);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class uo extends ao{constructor(){super(),this.server=new ho.a.Server({port:8787}),this.server.on("connection",e=>{this.socket=e,this.socket.on("message",e=>{"init"===e?oo.markConnected():this._handleMessage(JSON.parse(e))})})}_flush(e){this.socket&&this.socket.send(JSON.stringify(e))}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
let po=null,fo=!1,go=null,mo=new Promise(e=>go=e);oo.onceConnected.then(()=>{yo.ensure(),go(po),fo=!0});class yo{static get isConnected(){return fo}static get onceConnected(){return mo}static get(){return po}static ensure(){po||(po=new uo)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
let _o=!1;
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class vo{constructor(e,t){this.arc=e,this.arcDevtoolsChannel=t,t.listen("particle-reload",e=>void this._reload(e.messageBody))}_reload(e){const t=[this.arc];t.push(...this.arc.innerArcs);for(const n of t){const t=[];for(const r of n.pec.particles)r.spec.implFile===e&&t.push(r);n.pec.reload(t)}}updateParticleSet(e){const t=[];e.forEach(e=>{t.push(e.spec.implFile)}),this.arcDevtoolsChannel.send({messageType:"watch-particle-sources",messageBody:t})}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */yo.onceConnected.then(e=>{!function(e){_o||(Ji.enable(),e.send({messageType:"trace-time-sync",messageBody:{traceTime:Ji.now(),localTime:Date.now()}}),Ji.stream(t=>e.send({messageType:"trace",messageBody:t}),e=>e.ov),_o=!0)}(e)});const wo={create:e=>new bo(e)};class bo{constructor(e){if(this.arcDevtoolsChannel=null,this.onceActiveResolve=null,this.onceActive=null,e.isStub)return;this.arc=e,this.onceActive=new Promise(e=>this.onceActiveResolve=e);const t=yo.isConnected;yo.onceConnected.then(n=>{t||n.send({messageType:"warning",messageBody:"pre-existing-arc"}),this.arcDevtoolsChannel=n.forArc(e),this.storesFetcher=new Li(e,this.arcDevtoolsChannel);new io(e,this.arcDevtoolsChannel);this.hotCodeReloader=new vo(e,this.arcDevtoolsChannel),this.arcDevtoolsChannel.send({messageType:"arc-available",messageBody:{speculative:e.isSpeculative,inner:e.isInnerArc}}),this.sendEnvironmentMessage(e),this.onceActiveResolve()})}async recipeInstantiated(e,t){if(!yo.isConnected)return;await this.storesFetcher.onRecipeInstantiated();const n=({id:e,name:t})=>({id:e,name:t}),r=[];e.forEach(e=>e.getSlotConnections().forEach(e=>{e.targetSlot&&r.push({particleId:e.particle.id.toString(),consumed:n(e.targetSlot),provided:Object.values(e.providedSlots).map(e=>n(e))})})),this.arcDevtoolsChannel.send({messageType:"recipe-instantiated",messageBody:{slotConnections:r,activeRecipe:t}}),this.arc.isSpeculative||this.hotCodeReloader.updateParticleSet(e)}pecMessage(e,t,n,r,i,s){if(!yo.isConnected)return;const o=this._extractStackFrames(s);this.arcDevtoolsChannel.send({messageType:"PecLog",messageBody:{name:e,pecMsgBody:t,pecMsgCount:n,pecType:r,pecId:i,timestamp:Date.now(),stack:o}})}_extractStackFrames(e){const t=[];if(!e)return t;if(e.includes("(file:///")){for(const n of e.split("\n    at ").slice(2)){const e=n.match(/^(.*) \((.*)\)$/),r=e?e[1]:"<unknown>";let i=e?e[2]:n;(i=i.replace(/:[0-9]+$/,"")).startsWith("file")&&(i=i.replace(/^.*\/arcs[^/]*\//,"")),t.push({method:r,location:i,target:null,targetClass:"noLink"})}return t}return we&&we(e,e=>e.slice(1).map(e=>{const n=e.match(/^ {4}at (.*) \((.*)\)$/),r=n?n[1]:"<unknown>";let i=n?n[2]:e.replace(/^ *at */,"");const s={method:r};(i=n[2].replace(/:[0-9]+$/,"")).startsWith("http")?(s.location=i.replace(/^.*\/arcs[^/]*\//,""),s.target=i,s.targetClass="link"):i.startsWith("webpack")?(s.location=i.slice(11),s.target=`webpack:///./${s.location}`,s.targetClass="link"):(s.location=i,s.target=null,s.targetClass="noLink"),t.push(s)}),{sync:!1,cacheGlobally:!0}),t}isActive(){return yo.isConnected}sendEnvironmentMessage(e){const t=[];!function e(n){t.push(n),n.imports.forEach(e)}(e.context),this.arcDevtoolsChannel.send({messageType:"arc-environment",messageBody:{recipes:e.context.allRecipes.map(e=>({name:e.name,text:e.toString(),file:t.find(t=>t.recipes.includes(e)).fileName})),particles:e.context.allParticles.map(e=>({name:e.name,spec:e.toString(),file:t.find(t=>t.particles.includes(e)).fileName}))}})}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const{warn:So}=p("Runtime","orange");let Co=null;class Eo{constructor(e,t,n,r){this.arcById=new Map,this.cacheService=new ti,this.loader=e,this.pecFactory=r,this.composerClass=t,this.context=n||new Yc({id:"manifest:default"}),this.ramDiskMemory=new Gr,Co=this}static getRuntime(){return Co||(Co=new Eo),Co}static clearRuntimeForTesting(){Co&&(Co.destroy(),Co=null)}static newForNodeTesting(e){return new Eo(new fn,ji,e)}static init(e,t){const n={...Eo.mapFromRootPath(e),...t},r=new fn(n),i=$i(r);return new Eo(r,Di,null,i)}static mapFromRootPath(e){return{"https://$build/":`${e}/shells/lib/build/`,"https://$arcs/":`${e}/`,"https://$particles/":{root:e,path:"/particles/",buildDir:"/bazel-bin",buildOutputRegex:/\.wasm$/.source}}}getCacheService(){return this.cacheService}getRamDiskMemory(){return this.ramDiskMemory}destroy(){}runArc(e,t,n){return this.arcById.has(e)||this.arcById.set(e,this.newArc(e,t,n)),this.arcById.get(e)}newArc(e,t,n){const{loader:r,context:i}=this,s=ye.newSession().newArcId(e),o=this.composerClass?new this.composerClass:null,a="string"==typeof t?`${t}${s.toString()}`:t(s);return new ei({id:s,storageKey:a,loader:r,slotComposer:o,context:i,...n})}stop(e){g()(this.arcById.has(e),`Cannot stop nonexistent arc ${e}`),this.arcById.get(e).dispose(),this.arcById.delete(e)}findArcByParticleId(e){return[...this.arcById.values()].find(t=>!!t.activeRecipe.findParticle(e))}registerStore(e,t){!this.context.findStoreById(e.id)&&t.includes("shared")&&this.context._addStore(e,t)}unregisterStore(e,t){if(!t.includes("shared"))return;const n=this.context.stores.findIndex(t=>t.id===e);if(n>=0){const e=this.context.stores[n];this.context.storeTags.delete(e),this.context.stores.splice(n,1)}}static async getArcDescription(e){return(await Wn.create(e)).getArcDescription()}static async parseManifest(e,t){return Yc.parse(e,t)}static async loadManifest(e,t,n){return Yc.load(e,t,n)}async parse(e,t){const{loader:n}=this,r=`in-memory-${Math.floor(1e6*(Math.random()+1))}.manifest`,i={id:r,fileName:`./${r}`,loader:n,...t};return Yc.parse(e,i)}async parseFile(e,t){const n=await this.loader.loadResource(e),r={id:e,fileName:e,loader:this.loader,...t};return this.parse(n,r)}async resolveRecipe(e,t){if(this.normalize(t)){if(t.isResolved())return t;const n=new zr(e),r=await n.resolve(t);if(r&&r.isResolved())return r;So("failed to resolve:\n",(r||t).toString({showUnresolved:!0}))}return null}normalize(e){if(Eo.isNormalized(e))return!0;const t=new Map;return!!e.normalize({errors:t})||(So("failed to normalize:\n",t,e.toString()),!1)}static isNormalized(e){return Object.isFrozen(e)}async spawnArc({id:e,serialization:t,context:n,composer:r,storage:i,portFactories:s}){const o={id:ye.newSession().newArcId(e),fileName:"./serialized.manifest",serialization:t,context:n,storageKey:i||"volatile",slotComposer:r,pecFactories:[this.pecFactory,...s||[]],loader:this.loader,inspectorFactory:wo};return t?ei.deserialize(o):new ei(o)}static async parse(e,t){return this.getRuntime().parse(e,t)}static async parseFile(e,t){return this.getRuntime().parseFile(e,t)}static async resolveRecipe(e,t){return this.getRuntime().resolveRecipe(e,t)}static async spawnArc(e){return this.getRuntime().spawnArc(e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ko extends Ln{constructor(e){super();let t=e.split("://");this.protocol=t[0],g()("volatile"===this.protocol,`can't construct volatile key for protocol ${this.protocol} (input key ${e})`),t=t[1]?t.slice(1).join("://").split("^^"):[],this.arcId=t[0],this.location=t[1],g()(this.toString()===e,`Expected ${e}, but got ${this.toString()} volatile key base.`)}base(){return"volatile"}get arcId(){return this._arcId}set arcId(e){this._arcId=e}childKeyForHandle(e){return new ko("volatile")}childKeyForArcInfo(){return new ko(`${this.protocol}://${this.arcId}^^arc-info`)}childKeyForSuggestions(e,t){return new ko(`${this.protocol}://${this.arcId}^^${e}/suggestions/${t}`)}childKeyForSearch(e){return new ko(`${this.protocol}://${this.arcId}^^${e}/search`)}toString(){return void 0!==this.location&&void 0!==this.arcId?`${this.protocol}://${this.arcId}^^${this.location}`:void 0!==this.arcId?`${this.protocol}://${this.arcId}`:`${this.protocol}`}}const xo=()=>Eo.getRuntime().getCacheService().getOrCreateCache("volatileStorageCache");class To extends zn{constructor(){super(...arguments),this.backingStore=null,this.pendingBackingStore=null}static newProvider(e,t,n,r,i){return e instanceof ot?new Ro(e,t,n,r,i):e instanceof at?new No(e,t,n,r,i):new Io(e,t,n,r,i)}async ensureBackingStore(){if(this.backingStore)return this.backingStore;if(!this.pendingBackingStore){const e=this.storageEngine.baseStorageKey(this.backingType());this.pendingBackingStore=this.storageEngine.baseStorageFor(this.backingType(),e),await this.pendingBackingStore.then(e=>this.backingStore=e)}return this.pendingBackingStore}fromLiteral({version:e,model:t}){}}class Ro extends To{constructor(e,t,n,r,i){super(e,n,r,i),this._model=new At,this.storageEngine=t,g()(null!==this._version)}backingType(){return this.type.getContainedType()}async clone(){const e=new Ro(this.type,this.storageEngine,this.name,this.id,null);return await e.cloneFrom(this),e}async cloneFrom(e){this.referenceMode=e.referenceMode;const t=await e.serializeContents();if(this.referenceMode&&t.model.length>0){await Promise.all([this.ensureBackingStore(),e.ensureBackingStore()]),t.model=t.model.map(({id:e,value:t})=>({id:e,value:{id:t.id,storageKey:this.backingStore.storageKey}}));const n=await e.backingStore.getMultiple(t.model.map(({id:e})=>e));await this.backingStore.storeMultiple(n,[this.storageKey])}this.fromLiteral(t)}async modelForSynchronization(){const e=await this._toList();return{version:this._version,model:e}}async serializeContents(){return{version:this._version,model:this._model.toLiteral()}}fromLiteral({version:e,model:t}){this._version=e,this._model=new At(t)}async _toList(){if(this.referenceMode){const e=(await this.serializeContents()).model;if(0===e.length)return[];const t=new Set;e.forEach(e=>t.add(e.value.storageKey)),g()(1===t.size,"multiple storageKeys in reference set of collection not yet supported.");t.values().next().value;await this.ensureBackingStore();const n=e.map(e=>e.value.id),r=await this.backingStore.getMultiple(n),i=[];for(let t=0;t<r.length;t++)i.push({id:n[t],value:r[t],keys:e[t].keys});return i}return(await this.serializeContents()).model}async toList(){return(await this._toList()).map(e=>e.value)}async getMultiple(e){return g()(!this.referenceMode,"getMultiple not implemented for referenceMode stores"),e.map(e=>this._model.getValue(e))}async storeMultiple(e,t,n=null){g()(!this.referenceMode,"storeMultiple not implemented for referenceMode stores"),e.map(e=>this._model.add(e.id,e,t)),this._version++}async get(e){if(this.referenceMode){const t=this._model.getValue(e);return null==t?null:(await this.ensureBackingStore(),await this.backingStore.get(t.id))}return this._model.getValue(e)}traceInfo(){return{items:this._model.size}}async store(e,t,n=null){g()(null!=t&&t.length>0,"keys required");const r={value:e,keys:t,effective:void 0};if(this.referenceMode){const n=this.type.getContainedType(),i=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(n);r.effective=this._model.add(e.id,{id:e.id,storageKey:i},t),await this.ensureBackingStore(),await this.backingStore.store(e,t)}else r.effective=this._model.add(e.id,e,t);this._version++,await this._fire(new Hn({add:[r],version:this._version,originatorId:n}))}async removeMultiple(e,t=null){0===e.length&&(e=this._model.toList().map(e=>({id:e.id,keys:[]})));const n=e.map(e=>{const t={id:e.id,keys:e.keys.length?e.keys:this._model.getKeys(e.id),value:this._model.getValue(e.id)};return null!==t.value&&(t.effective=this._model.remove(e.id,t.keys)),t});this._version++,await this._fire(new Hn({remove:n,version:this._version,originatorId:t}))}async remove(e,t=[],n=null){0===t.length&&(t=this._model.getKeys(e));const r=this._model.getValue(e);if(null!==r){const i=this._model.remove(e,t);this._version++,await this._fire(new Hn({remove:[{value:r,keys:t,effective:i}],version:this._version,originatorId:n}))}}clearItemsForTesting(){this._model=new At}}class Io extends To{constructor(e,t,n,r,i){super(e,n,r,i),this.localKeyId=0,this.storageEngine=t,this._stored=null,this.backingStore=null}backingType(){return this.type}async clone(){const e=new Io(this.type,this.storageEngine,this.name,this.id,null);return await e.cloneFrom(this),e}async cloneFrom(e){this.referenceMode=e.referenceMode,e.referenceMode&&e.localModified&&await e._persistChanges();const t=await e.serializeContents();if(this.referenceMode&&t.model.length>0){await Promise.all([this.ensureBackingStore(),e.ensureBackingStore()]),t.model=t.model.map(({id:e,value:t})=>({id:e,value:{id:t.id,storageKey:this.backingStore.storageKey}}));const n=await e.backingStore.getMultiple(t.model.map(({id:e})=>e));await this.backingStore.storeMultiple(n,[this.storageKey])}await this.fromLiteral(t)}async modelForSynchronization(){if(this.referenceMode&&null!==this._stored){const e=this._stored;await this.ensureBackingStore();const t=await this.backingStore.get(e.id);return{version:this._version,model:[{id:e.id,value:t}]}}return super.modelForSynchronization()}async serializeContents(){const e=this._stored,t=null!=e?[{id:e.id,value:e,keys:[]}]:[];return{version:this._version,model:t}}fromLiteral({version:e,model:t}){const n=0===t.length?null:t[0].value;this.referenceMode&&n&&n.rawData&&g()(!1,`shouldn't have rawData ${JSON.stringify(n.rawData)} here`),g()(void 0!==n),this._stored=n,this._version=e}traceInfo(){return{stored:null!==this._stored}}async get(){if(this.referenceMode&&this._stored){const e=this._stored;return await this.ensureBackingStore(),await this.backingStore.get(e.id)}return this._stored}async set(e,t=null,n=null){if(g()(void 0!==e),this.referenceMode&&e){const t=this.type,n=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(t);this._stored={id:e.id,storageKey:n},await this.ensureBackingStore(),await this.backingStore.store(e,[this.storageKey+this.localKeyId++])}else{if(JSON.stringify(this._stored)===JSON.stringify(e)&&null==n)return;this._stored=e}this._version++;const r=this.referenceMode?e:this._stored;await this._fire(new Hn({data:r,version:this._version,originatorId:t,barrier:n}))}async clear(e=null,t=null){await this.set(null,e,t)}}class Oo{constructor(e,t,n,r){this.version=e,this.pageSize=n;const i=[...t];i.sort((e,t)=>e.index-t.index),this.data=i.map(e=>e.value),r||this.data.reverse()}async next(){return 0===this.data.length?{done:!0}:{value:this.data.splice(0,this.pageSize),done:!1}}close(){this.data=[]}}class No extends To{constructor(e,t,n,r,i){super(e,n,r,i),this.items=new Map,this.cursors=new Map,this.cursorIndex=0}enableReferenceMode(){g()(!1,"referenceMode is not supported for BigCollection")}backingType(){return this.type.getContainedType()}async get(e){const t=this.items.get(e);return void 0!==t?t.value:null}async store(e,t,n){g()(null!=t&&t.length>0,"keys required"),this._version++,this.items.has(e.id)||this.items.set(e.id,{index:null,value:null,keys:{}});const r=this.items.get(e.id);r.index=this._version,r.value=e,t.forEach(e=>r.keys[e]=this._version)}async remove(e,t,n){this._version++,this.items.delete(e)}async stream(e,t=!0){g()(!isNaN(e)&&e>0),this.cursorIndex++;const n=new Oo(this._version,this.items.values(),e,t);return this.cursors.set(this.cursorIndex,n),this.cursorIndex}async cursorNext(e){const t=this.cursors.get(e);if(!t)return{done:!0};const n=await t.next();return n.done&&this.cursors.delete(e),n}async cursorClose(e){const t=this.cursors.get(e);t&&(this.cursors.delete(e),t.close())}cursorVersion(e){const t=this.cursors.get(e);return t?t.version:null}async cloneFrom(e){e.items&&this.fromLiteral(e.toLiteral())}async serializeContents(){const e=[];for(const[t,{index:n,value:r,keys:i}]of this.items.entries())e.push({id:t,index:n,value:r,keys:Object.keys(i)});return{version:this._version,model:e}}fromLiteral({version:e,model:t}){this._version=e,this.items.clear();for(const{id:e,index:n,value:r,keys:i}of t){const t={};for(const e of i)t[e]=n;this.items.set(e,{index:n,value:r,keys:t})}}clearItemsForTesting(){this.items.clear()}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var Po,Ao;!function(e){e[e.arc=1]="arc"}(Po||(Po={})),function(e){e[e.handles=1]="handles"}(Ao||(Ao={}));class Mo extends Ln{constructor(e,t){super();const n=e.match(/^synthetic:\/\/([^/]+)\/([^/]+)\/(.+)$/);if(null===n||4!==n.length)throw new Error(`invalid synthetic key: ${e}`);if(this.scope=Po[n[1]],this.category=Ao[n[2]],this.scope!==Po.arc)throw new Error(`invalid scope '${n[1]}' for synthetic key: ${e}`);{this.targetType=new dt;const e=t.parseStringAsKey(n[3]).childKeyForArcInfo();this.targetKey=e.toString()}if(this.category!==Ao.handles)throw new Error(`invalid category '${n[2]}' for synthetic key: ${e}`);this.syntheticType=new pt}get protocol(){return"synthetic"}base(){return g()(!1,"base not supported for synthetic keys"),null}get arcId(){return g()(!1,"arcId not supported for synthetic keys"),null}childKeyForHandle(e){return g()(!1,"childKeyForHandle not supported for synthetic keys"),null}childKeyForArcInfo(){return g()(!1,"childKeyForArcInfo not supported for synthetic keys"),null}childKeyForSuggestions(e,t){return g()(!1,"childKeyForSuggestions not supported for synthetic keys"),null}childKeyForSearch(e){return g()(!1,"childKeyForSearch not supported for synthetic keys"),null}toString(){return`${this.protocol}://${Po[this.scope]}/${Ao[this.category]}/${this.targetKey}`}}class Do extends zn{constructor(e,t,n,r,i){super(e,void 0,t,n),this.model=[],this.backingStore=void 0,this.targetStore=r,this.storageFactory=i}static async create(e,t,n,r,i){const s=new Do(e,t,n,r,i),o=await r.get();return await s.process(o,!1),r.legacyOn(e=>s.process(e.data,!0)),s}async process(e,t){let n;try{if(e){const t=await Yc.parse(H.extractSerialization(e),{});n=t.activeRecipe&&t.activeRecipe.handles}}catch(e){console.warn(`Error parsing manifest at ${this.storageKey}:\n${e.message}`)}const r=this.model;this.model=[];for(const e of n||[])if(this.storageFactory.isPersistent(e.storageKey)){if("string"!=typeof e.storageKey)throw new Error("Can't use old storage stack with NG StorageKey objects");this.model.push(new z(e.id,e.storageKey,e.mappedType,e.tags))}if(t){const e=function(e,t,n){const r={add:[],remove:[]},i=new Map,s=new Map,o=new Map;for(const t of e){const e=n(t);i.set(e,t),s.set(e,t)}for(const e of t){const t=n(e);i.set(t,e),o.set(t,e)}for(const[e,t]of i)if(s.has(e)){if(o.has(e))continue;r.remove.push(t)}else g()(o.has(e)),r.add.push(t);return r}(r,this.model,JSON.stringify),t=e.add.map(e=>({value:e})),n=e.remove.map(e=>({value:e}));await this._fire(new Hn({add:t,remove:n}))}}async toList(){return this.model}async serializeContents(){throw new Error("unimplemented")}async cloneFrom(){throw new Error("cloneFrom should never be called on SyntheticCollection!")}async ensureBackingStore(){throw new Error("ensureBackingStore should never be called on SyntheticCollection!")}async getMultiple(e){throw new Error("unimplemented")}async storeMultiple(e,t,n){throw new Error("unimplemented")}async removeMultiple(e,t){throw new Error("unimplemented")}async get(e){throw new Error("unimplemented")}remove(e,t,n){throw new Error("unimplemented")}store(e,t,n){throw new Error("unimplemented")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Fo={volatile:{storage:class extends Un{constructor(e){super(e),this._memoryMap={},this._typeMap={},this.localIDBase=0,this.typePromiseMap={},xo().set(this.arcId.toString(),this)}async construct(e,t,n){const r=await this._construct(e,t,n);return t instanceof ut||t instanceof at?r:t.isTypeContainer()&&t.getContainedType()instanceof ut?r:(r.enableReferenceMode(),r)}async _construct(e,t,n){const r=this.constructKey(n);let i=this._memoryMap[r];return i||(i=To.newProvider(t,this,void 0,e,r),this._memoryMap[r]=i),i}constructKey(e){const t=new ko(e);return void 0===t.arcId&&(t.arcId=this.arcId.toString()),void 0===t.location&&(t.location="volatile-"+this.localIDBase++),t.toString()}async connect(e,t,n){const r=new ko(n);return r.arcId!==this.arcId.toString()?null==xo().get(r.arcId)?null:xo().get(r.arcId).connect(e,t,n):void 0===this._memoryMap[n]?null:this._memoryMap[n]}baseStorageKey(e){const t=new ko("volatile");return t.arcId=this.arcId.toString(),t.location="volatile-"+e.toString(),t.toString()}async baseStorageFor(e,t){if(this._typeMap[t])return this._typeMap[t];if(this.typePromiseMap[t])return this.typePromiseMap[t];const n=this._construct(e.toString(),e.collectionOf(),t);this.typePromiseMap[t]=n;const r=await n;return g()(r,`could not construct baseStorage for key ${t}`),this._typeMap[t]=r,r}parseStringAsKey(e){const t=new ko(e);return void 0===t.arcId&&(t.arcId=this.arcId.toString()),t}},isPersistent:!1},synthetic:{storage:class extends Un{constructor(e,t){super(e),this.storageFactory=t}async construct(e,t,n){throw new Error("cannot construct SyntheticStorage providers; use connect")}async connect(e,t,n){g()(null===t,"SyntheticStorage does not accept a type parameter");const r=new Mo(n,this.storageFactory),i=await this.storageFactory.connect(e,r.targetType,r.targetKey);return null===i?null:Do.create(r.syntheticType,e,n,i,this.storageFactory)}async baseStorageFor(e,t){throw new Error("baseStorageFor not implemented for SyntheticStorage")}baseStorageKey(e,t){throw new Error("baseStorageKey not implemented for SyntheticStorage")}parseStringAsKey(e){return new Mo(e,this.storageFactory)}},isPersistent:!1}};class jo{constructor(e){this.arcId=e,this.mutexMap=new Map,this._storageInstances={},Object.keys(Fo).forEach(t=>{const{storage:n,isPersistent:r}=Fo[t];this._storageInstances[t]={storage:new n(e,this),isPersistent:r}})}static register(e,t){Fo[e]=t}getInstance(e){const t=this._storageInstances[e.split(":")[0]];if(!t)throw new Error(`unknown storage protocol: ${e}`);return t}_storageForKey(e){if(!e)throw new Error("key is required");return this.getInstance(e).storage}isPersistent(e){return e&&this.getInstance(e).isPersistent}async construct(e,t,n){return await this._storageForKey(n).construct(e,t,n)}async connect(e,t,n){return await this._storageForKey(n).connect(e,t,n)}async _acquireMutexForKey(e){return this.mutexMap.has(e)||this.mutexMap.set(e,new Kr),this.mutexMap.get(e).acquire()}async connectOrConstruct(e,t,n){const r=this._storageForKey(n),i=await this._acquireMutexForKey(n);try{let s=await r.connect(e,t,n);return null==s&&(s=await r.construct(e,t,n)),s}finally{i()}}async baseStorageFor(e,t){return await this._storageForKey(t).baseStorageFor(e,t)}baseStorageKey(e,t){return this._storageForKey(t).baseStorageKey(e,t)}parseStringAsKey(e){return this._storageForKey(e).parseStringAsKey(e)}newKey(e,t){}async shutdown(){for(const e of Object.values(this._storageInstances))await e.storage.shutdown()}}var $o=n(6),Bo=$o.a,Lo=(n(103),n(1)),Uo="firebasestorage.googleapis.com",Ho="storageBucket",zo=12e4,qo=6e4,Wo=-9007199254740991,Vo=function(){function e(e,t){this.code_=Qo(e),this.message_="Firebase Storage: "+t,this.serverResponse_=null,this.name_="FirebaseError"}return e.prototype.codeProp=function(){return this.code},e.prototype.codeEquals=function(e){return Qo(e)===this.codeProp()},e.prototype.serverResponseProp=function(){return this.serverResponse_},e.prototype.setServerResponseProp=function(e){this.serverResponse_=e},Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),e}(),Ko={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(e){return"storage/"+e}function Go(){return new Vo(Ko.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Zo(){return new Vo(Ko.CANCELED,"User canceled the upload/download.")}function Yo(){return new Vo(Ko.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Xo(){return new Vo(Ko.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Jo(e,t,n){return new Vo(Ko.INVALID_ARGUMENT,"Invalid argument in `"+t+"` at index "+e+": "+n)}function ea(){return new Vo(Ko.APP_DELETED,"The Firebase app was deleted.")}function ta(e,t){return new Vo(Ko.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function na(e){throw new Vo(Ko.INTERNAL_ERROR,"Internal error: "+e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ra={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function ia(e){switch(e){case ra.RAW:case ra.BASE64:case ra.BASE64URL:case ra.DATA_URL:return;default:throw"Expected one of the event types: ["+ra.RAW+", "+ra.BASE64+", "+ra.BASE64URL+", "+ra.DATA_URL+"]."}}var sa=function(e,t){this.data=e,this.contentType=t||null};function oa(e,t){switch(e){case ra.RAW:return new sa(aa(t));case ra.BASE64:case ra.BASE64URL:return new sa(ca(e,t));case ra.DATA_URL:return new sa((n=new la(t)).base64?ca(ra.BASE64,n.rest):function(e){var t;try{t=decodeURIComponent(e)}catch(e){throw ta(ra.DATA_URL,"Malformed data URL.")}return aa(t)}(n.rest),function(e){return new la(e).contentType}(t))}var n;throw Go()}function aa(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else t.push(239,191,189);else 56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function ca(e,t){switch(e){case ra.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw ta(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case ra.BASE64URL:var i=-1!==t.indexOf("+"),s=-1!==t.indexOf("/");if(i||s)throw ta(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var o;try{o=atob(t)}catch(t){throw ta(e,"Invalid character found")}for(var a=new Uint8Array(o.length),c=0;c<o.length;c++)a[c]=o.charCodeAt(c);return a}var la=function(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw ta(ra.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=t[1]||null;null!=n&&(this.base64=(r=n,i=";base64",r.length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1);var r,i;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */};var ha,ua={STATE_CHANGED:"state_changed"},da={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},pa={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function fa(e){switch(e){case da.RUNNING:case da.PAUSING:case da.CANCELING:return pa.RUNNING;case da.PAUSED:return pa.PAUSED;case da.SUCCESS:return pa.SUCCESS;case da.CANCELED:return pa.CANCELED;case da.ERROR:default:return pa.ERROR}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ga(e){return null!=e}function ma(e){return void 0!==e}function ya(e){return"function"==typeof e}function _a(e){return"object"==typeof e}function va(e){return _a(e)&&null!==e}function wa(e){return"string"==typeof e||e instanceof String}function ba(e){return Sa(e)&&Number.isInteger(e)}function Sa(e){return"number"==typeof e||e instanceof Number}function Ca(e){return Ea()&&e instanceof Blob}function Ea(){return"undefined"!=typeof Blob}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(ha||(ha={}));
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ka=function(){function e(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=ha.NO_ERROR,this.sendPromise_=new Promise((function(t){e.xhr_.addEventListener("abort",(function(){e.errorCode_=ha.ABORT,t(e)})),e.xhr_.addEventListener("error",(function(){e.errorCode_=ha.NETWORK_ERROR,t(e)})),e.xhr_.addEventListener("load",(function(){t(e)}))}))}return e.prototype.send=function(e,t,n,r){if(this.sent_)throw na("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),ga(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return ga(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},e.prototype.getErrorCode=function(){if(!this.sent_)throw na("cannot .getErrorCode() before sending");return this.errorCode_},e.prototype.getStatus=function(){if(!this.sent_)throw na("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}},e.prototype.getResponseText=function(){if(!this.sent_)throw na("cannot .getResponseText() before sending");return this.xhr_.responseText},e.prototype.abort=function(){this.xhr_.abort()},e.prototype.getResponseHeader=function(e){return this.xhr_.getResponseHeader(e)},e.prototype.addUploadProgressListener=function(e){ga(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",e)},e.prototype.removeUploadProgressListener=function(e){ga(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",e)},e}(),xa=function(){function e(){}return e.prototype.createXhrIo=function(){return new ka},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ta(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Ra(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Ta();if(void 0!==n){for(var r=new n,i=0;i<e.length;i++)r.append(e[i]);return r.getBlob()}if(Ea())return new Blob(e);throw Error("This browser doesn't seem to support creating Blobs")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ia=function(){function e(e,t){var n=0,r="";Ca(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}return e.prototype.size=function(){return this.size_},e.prototype.type=function(){return this.type_},e.prototype.slice=function(t,n){if(Ca(this.data_)){var r=this.data_,i=(o=t,a=n,(s=r).webkitSlice?s.webkitSlice(o,a):s.mozSlice?s.mozSlice(o,a):s.slice?s.slice(o,a):null);return null===i?null:new e(i)}var s,o,a;return new e(new Uint8Array(this.data_.buffer,t,n-t),!0)},e.getBlob=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(Ea()){var r=t.map((function(t){return t instanceof e?t.data_:t}));return new e(Ra.apply(null,r))}var i=t.map((function(e){return wa(e)?oa(ra.RAW,e).data:e.data_})),s=0;i.forEach((function(e){s+=e.byteLength}));var o=new Uint8Array(s),a=0;return i.forEach((function(e){for(var t=0;t<e.length;t++)o[a++]=e[t]})),new e(o,!0)},e.prototype.uploadData=function(){return this.data_},e}(),Oa=function(){function e(e,t){this.bucket=e,this.path_=t}return Object.defineProperty(e.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),e.prototype.fullServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)},e.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},e.makeFromBucketSpec=function(t){var n,r;try{n=e.makeFromUrl(t)}catch(n){return new e(t,"")}if(""===n.path)return n;throw r=t,new Vo(Ko.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")},e.makeFromUrl=function(t){var n=null;var r=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");for(var i=Uo.replace(/[.]/g,"\\."),s=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(e){e.path_=decodeURIComponent(e.path)}}],o=0;o<s.length;o++){var a=s[o],c=a.regex.exec(t);if(c){var l=c[a.indices.bucket],h=c[a.indices.path];h||(h=""),n=new e(l,h),a.postModify(n);break}}if(null==n)throw function(e){return new Vo(Ko.INVALID_URL,"Invalid URL '"+e+"'.")}(t);return n},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Na(e){var t,n;try{t=JSON.parse(e)}catch(e){return null}return _a(n=t)&&!Array.isArray(n)?t:null}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pa(e,t){var n=t.split("/").filter((function(e){return e.length>0})).join("/");return 0===e.length?n:e+"/"+n}function Aa(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ma(e){return"https://"+Uo+"/v0"+e}function Da(e){var t=encodeURIComponent,n="?";for(var r in e){if(e.hasOwnProperty(r))n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fa(e,t){return t}var ja=function(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Fa},$a=null;function Ba(){if($a)return $a;var e=[];e.push(new ja("bucket")),e.push(new ja("generation")),e.push(new ja("metageneration")),e.push(new ja("name","fullPath",!0));var t=new ja("name");t.xform=function(e,t){return function(e){return!wa(e)||e.length<2?e:Aa(e)}(t)},e.push(t);var n=new ja("size");return n.xform=function(e,t){return ga(t)?Number(t):t},e.push(n),e.push(new ja("timeCreated")),e.push(new ja("updated")),e.push(new ja("md5Hash",null,!0)),e.push(new ja("cacheControl",null,!0)),e.push(new ja("contentDisposition",null,!0)),e.push(new ja("contentEncoding",null,!0)),e.push(new ja("contentLanguage",null,!0)),e.push(new ja("contentType",null,!0)),e.push(new ja("metadata","customMetadata",!0)),$a=e}function La(e,t,n){for(var r={type:"file"},i=n.length,s=0;s<i;s++){var o=n[s];r[o.local]=o.xform(r,t[o.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){var n=e.bucket,r=e.fullPath,i=new Oa(n,r);return t.makeStorageReference(i)}})}(r,e),r}function Ua(e,t,n){var r=Na(t);return null===r?null:La(e,r,n)}function Ha(e,t){for(var n={},r=t.length,i=0;i<r;i++){var s=t[i];s.writable&&(n[s.server]=e[s.local])}return JSON.stringify(n)}function za(e){if(!_a(e)||!e)throw"Expected Metadata object.";for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if("customMetadata"===t){if(!_a(n))throw"Expected object for 'customMetadata' mapping."}else if(va(n))throw"Mapping for '"+t+"' cannot be an object."}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qa="maxResults",Wa=1e3,Va="pageToken",Ka="prefixes",Qa="items";function Ga(e,t){var n={prefixes:[],items:[],nextPageToken:t.nextPageToken},r=e.bucket();if(null===r)throw new Vo(Ko.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Ho+"' property when initializing the app?");if(t[Ka])for(var i=0,s=t[Ka];i<s.length;i++){var o=s[i].replace(/\/$/,""),a=e.makeStorageReference(new Oa(r,o));n.prefixes.push(a)}if(t[Qa])for(var c=0,l=t[Qa];c<l.length;c++){var h=l[c];a=e.makeStorageReference(new Oa(r,h.name));n.items.push(a)}return n}function Za(e){if(!_a(e)||!e)throw"Expected ListOptions object.";for(var t in e)if(t===qa){if(!ba(e[qa])||e[qa]<=0)throw"Expected maxResults to be a positive number.";if(e[qa]>1e3)throw"Expected maxResults to be less than or equal to "+Wa+"."}else{if(t!==Va)throw"Unknown option: "+t;if(e[Va]&&!wa(e[Va]))throw"Expected pageToken to be string."}}var Ya=function(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xa(e){if(!e)throw Go()}function Ja(e,t){return function(n,r){var i=Ua(e,r,t);return Xa(null!==i),i}}function ec(e){return function(t,n){var r=function(e,t){var n=Na(t);return null===n?null:Ga(e,n)}(e,n);return Xa(null!==r),r}}function tc(e,t){return function(n,r){var i=Ua(e,r,t);return Xa(null!==i),function(e,t){var n=Na(t);if(null===n)return null;if(!wa(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map((function(t){var n=e.bucket,r=e.fullPath;return Ma("/b/"+i(n)+"/o/"+i(r))+Da({alt:"media",token:t})}))[0]}(i,r)}}function nc(e){return function(t,n){var r,i,s;return 401===t.getStatus()?r=new Vo(Ko.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new Vo(Ko.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Vo(Ko.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.setServerResponseProp(n.serverResponseProp()),r}}function rc(e){var t=nc(e);return function(n,r){var i,s=t(n,r);return 404===n.getStatus()&&(i=e.path,s=new Vo(Ko.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),s.setServerResponseProp(r.serverResponseProp()),s}}function ic(e,t,n){var r=Ma(t.fullServerUrl()),i=e.maxOperationRetryTime(),s=new Ya(r,"GET",Ja(e,n),i);return s.errorHandler=rc(t),s}function sc(e,t,n,r,i){var s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&n.length>0&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);var o=Ma(t.bucketOnlyServerUrl()),a=e.maxOperationRetryTime(),c=new Ya(o,"GET",ec(e),a);return c.urlParams=s,c.errorHandler=nc(t),c}function oc(e,t,n){var r=Ma(t.fullServerUrl()),i=e.maxOperationRetryTime(),s=new Ya(r,"GET",tc(e,n),i);return s.errorHandler=rc(t),s}function ac(e,t,n,r){var i=Ma(t.fullServerUrl()),s=Ha(n,r),o=e.maxOperationRetryTime(),a=new Ya(i,"PATCH",Ja(e,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=s,a.errorHandler=rc(t),a}function cc(e,t){var n=Ma(t.fullServerUrl()),r=e.maxOperationRetryTime();var i=new Ya(n,"DELETE",(function(e,t){}),r);return i.successCodes=[200,204],i.errorHandler=rc(t),i}function lc(e,t,n){var r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}var hc=function(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null};function uc(e,t){var n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){Xa(!1)}return Xa(!!n&&-1!==(t||["active"]).indexOf(n)),n}function dc(e,t,n,r,i,s,o,a){var c=new hc(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Vo(Ko.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var l=c.total-c.current,h=l;i>0&&(h=Math.min(h,i));var u=c.current,d=u+h,p={"X-Goog-Upload-Command":h===l?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},f=r.slice(u,d);if(null===f)throw Yo();var g=t.maxUploadRetryTime(),m=new Ya(n,"POST",(function(e,n){var i,o=uc(e,["active","final"]),a=c.current+h,l=r.size();return i="final"===o?Ja(t,s)(e,n):null,new hc(a,l,"final"===o,i)}),g);return m.headers=p,m.body=f.uploadData(),m.progressCallback=a||null,m.errorHandler=nc(e),m}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pc=function(e,t,n){if(ya(e)||ga(t)||ga(n))this.next=e,this.error=t||null,this.complete=n||null;else{var r=e;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},fc=function(e,t,n,r,i,s){this.bytesTransferred=e,this.totalBytes=t,this.state=n,this.metadata=r,this.task=i,this.ref=s};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function gc(e,t,n){for(var r=t.length,i=t.length,s=0;s<t.length;s++)if(t[s].optional){r=s;break}var o,a,c,l,h,u;if(!(r<=n.length&&n.length<=i))throw o=r,a=i,c=e,l=n.length,o===a?(h=o,u=1===o?"argument":"arguments"):(h="between "+o+" and "+a,u="arguments"),new Vo(Ko.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+c+"`: Expected "+h+" "+u+", received "+l+".");for(s=0;s<n.length;s++)try{t[s].validator(n[s])}catch(t){throw t instanceof Error?Jo(s,e,t.message):Jo(s,e,t)}}var mc=function(e,t){var n=this;this.validator=function(t){n.optional&&!ma(t)||e(t)},this.optional=!!t};function yc(e,t){function n(e){if(!wa(e))throw"Expected string."}var r,i,s;return e?(i=n,s=e,r=function(e){i(e),s(e)}):r=n,new mc(r,t)}function _c(){return new mc((function(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Ea()&&e instanceof Blob))throw"Expected Blob or File."}))}function vc(e){return new mc(za,e)}function wc(e){return new mc(Za,e)}function bc(){return new mc((function(e){if(!(Sa(e)&&e>=0))throw"Expected a number 0 or greater."}))}function Sc(e,t){return new mc((function(t){if(!(null===t||ga(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)}),t)}function Cc(e){return new mc((function(e){if(!(null===e||ya(e)))throw"Expected a Function."}),e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Promise.resolve().then((function(){return e.apply(void 0,t)}))}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kc=function(){function e(e,t,n,r,i,s){var o=this;void 0===s&&(s=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=e,this.authWrapper_=t,this.location_=n,this.blob_=i,this.metadata_=s,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=da.RUNNING,this.errorHandler_=function(e){o.request_=null,o.chunkMultiplier_=1,e.codeEquals(Ko.CANCELED)?(o.needToFetchStatus_=!0,o.completeTransitions_()):(o.error_=e,o.transition_(da.ERROR))},this.metadataErrorHandler_=function(e){o.request_=null,e.codeEquals(Ko.CANCELED)?o.completeTransitions_():(o.error_=e,o.transition_(da.ERROR))},this.promise_=new Promise((function(e,t){o.resolve_=e,o.reject_=t,o.start_()})),this.promise_.then(null,(function(){}))}return e.prototype.makeProgressCallback_=function(){var e=this,t=this.transferred_;return function(n){return e.updateProgress_(t+n)}},e.prototype.shouldDoResumable_=function(e){return e.size()>262144},e.prototype.start_=function(){this.state_===da.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},e.prototype.resolveToken_=function(e){var t=this;this.authWrapper_.getAuthToken().then((function(n){switch(t.state_){case da.RUNNING:e(n);break;case da.CANCELING:t.transition_(da.CANCELED);break;case da.PAUSING:t.transition_(da.PAUSED)}}))},e.prototype.createResumable_=function(){var e=this;this.resolveToken_((function(t){var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o=lc(t,r,i),a={name:o.fullPath},c=Ma(s),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=Ha(o,n),u=e.maxUploadRetryTime(),d=new Ya(c,"POST",(function(e){var t;uc(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){Xa(!1)}return Xa(wa(t)),t}),u);return d.urlParams=a,d.headers=l,d.body=h,d.errorHandler=nc(t),d}(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_),r=e.authWrapper_.makeRequest(n,t);e.request_=r,r.getPromise().then((function(t){e.request_=null,e.uploadUrl_=t,e.needToFetchStatus_=!1,e.completeTransitions_()}),e.errorHandler_)}))},e.prototype.fetchStatus_=function(){var e=this,t=this.uploadUrl_;this.resolveToken_((function(n){var r=function(e,t,n,r){var i=e.maxUploadRetryTime(),s=new Ya(n,"POST",(function(e){var t=uc(e,["active","final"]),n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){Xa(!1)}n||Xa(!1);var i=Number(n);return Xa(!isNaN(i)),new hc(i,r.size(),"final"===t)}),i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=nc(t),s}(e.authWrapper_,e.location_,t,e.blob_),i=e.authWrapper_.makeRequest(r,n);e.request_=i,i.getPromise().then((function(t){t=t,e.request_=null,e.updateProgress_(t.current),e.needToFetchStatus_=!1,t.finalized&&(e.needToFetchMetadata_=!0),e.completeTransitions_()}),e.errorHandler_)}))},e.prototype.continueUpload_=function(){var e=this,t=262144*this.chunkMultiplier_,n=new hc(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_((function(i){var s;try{s=dc(e.location_,e.authWrapper_,r,e.blob_,t,e.mappings_,n,e.makeProgressCallback_())}catch(t){return e.error_=t,void e.transition_(da.ERROR)}var o=e.authWrapper_.makeRequest(s,i);e.request_=o,o.getPromise().then((function(t){e.increaseMultiplier_(),e.request_=null,e.updateProgress_(t.current),t.finalized?(e.metadata_=t.metadata,e.transition_(da.SUCCESS)):e.completeTransitions_()}),e.errorHandler_)}))},e.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},e.prototype.fetchMetadata_=function(){var e=this;this.resolveToken_((function(t){var n=ic(e.authWrapper_,e.location_,e.mappings_),r=e.authWrapper_.makeRequest(n,t);e.request_=r,r.getPromise().then((function(t){e.request_=null,e.metadata_=t,e.transition_(da.SUCCESS)}),e.metadataErrorHandler_)}))},e.prototype.oneShotUpload_=function(){var e=this;this.resolveToken_((function(t){var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var e="",t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;var c=lc(t,r,i),l="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Ha(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",u=Ia.getBlob(l,r,h);if(null===u)throw Yo();var d={name:c.fullPath},p=Ma(s),f=e.maxUploadRetryTime(),g=new Ya(p,"POST",Ja(e,n),f);return g.urlParams=d,g.headers=o,g.body=u.uploadData(),g.errorHandler=nc(t),g}(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_),r=e.authWrapper_.makeRequest(n,t);e.request_=r,r.getPromise().then((function(t){e.request_=null,e.metadata_=t,e.updateProgress_(e.blob_.size()),e.transition_(da.SUCCESS)}),e.errorHandler_)}))},e.prototype.updateProgress_=function(e){var t=this.transferred_;this.transferred_=e,this.transferred_!==t&&this.notifyObservers_()},e.prototype.transition_=function(e){if(this.state_!==e)switch(e){case da.CANCELING:case da.PAUSING:this.state_=e,null!==this.request_&&this.request_.cancel();break;case da.RUNNING:var t=this.state_===da.PAUSED;this.state_=e,t&&(this.notifyObservers_(),this.start_());break;case da.PAUSED:this.state_=e,this.notifyObservers_();break;case da.CANCELED:this.error_=Zo(),this.state_=e,this.notifyObservers_();break;case da.ERROR:case da.SUCCESS:this.state_=e,this.notifyObservers_()}},e.prototype.completeTransitions_=function(){switch(this.state_){case da.PAUSING:this.transition_(da.PAUSED);break;case da.CANCELING:this.transition_(da.CANCELED);break;case da.RUNNING:this.start_()}},Object.defineProperty(e.prototype,"snapshot",{get:function(){var e=fa(this.state_);return new fc(this.transferred_,this.blob_.size(),e,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),e.prototype.on=function(e,t,n,r){function i(){if(e!==ua.STATE_CHANGED)throw"Expected one of the event types: ["+ua.STATE_CHANGED+"]."}var s="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=Cc(!0).validator,a=Sc(null,!0).validator;function c(e){try{return void o(e)}catch(e){}try{if(a(e),!(ma(e.next)||ma(e.error)||ma(e.complete)))throw"";return}catch(e){throw s}}var l=[yc(i),Sc(c,!0),Cc(!0),Cc(!0)];gc("on",l,arguments);var h=this;function u(e){return function(t,n,i){null!==e&&gc("on",e,arguments);var s=new pc(t,n,r);return h.addObserver_(s),function(){h.removeObserver_(s)}}}function d(e){if(null===e)throw s;c(e)}var p=[Sc(d),Cc(!0),Cc(!0)],f=!(ma(t)||ma(n)||ma(r));return f?u(p):u(null)(t,n,r)},e.prototype.then=function(e,t){return this.promise_.then(e,t)},e.prototype.catch=function(e){return this.then(null,e)},e.prototype.addObserver_=function(e){this.observers_.push(e),this.notifyObserver_(e)},e.prototype.removeObserver_=function(e){var t=this.observers_.indexOf(e);-1!==t&&this.observers_.splice(t,1)},e.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach((function(t){e.notifyObserver_(t)}))},e.prototype.finishPromise_=function(){if(null!==this.resolve_){var e=!0;switch(fa(this.state_)){case pa.SUCCESS:Ec(this.resolve_.bind(null,this.snapshot))();break;case pa.CANCELED:case pa.ERROR:Ec(this.reject_.bind(null,this.error_))();break;default:e=!1}e&&(this.resolve_=null,this.reject_=null)}},e.prototype.notifyObserver_=function(e){switch(fa(this.state_)){case pa.RUNNING:case pa.PAUSED:e.next&&Ec(e.next.bind(e,this.snapshot))();break;case pa.SUCCESS:e.complete&&Ec(e.complete.bind(e))();break;case pa.CANCELED:case pa.ERROR:e.error&&Ec(e.error.bind(e,this.error_))();break;default:e.error&&Ec(e.error.bind(e,this.error_))()}},e.prototype.resume=function(){gc("resume",[],arguments);var e=this.state_===da.PAUSED||this.state_===da.PAUSING;return e&&this.transition_(da.RUNNING),e},e.prototype.pause=function(){gc("pause",[],arguments);var e=this.state_===da.RUNNING;return e&&this.transition_(da.PAUSING),e},e.prototype.cancel=function(){gc("cancel",[],arguments);var e=this.state_===da.RUNNING||this.state_===da.PAUSING;return e&&this.transition_(da.CANCELING),e},e}(),xc=function(){function e(e,t){this.authWrapper=e,this.location=t instanceof Oa?t:Oa.makeFromUrl(t)}return e.prototype.toString=function(){return gc("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},e.prototype.newRef=function(t,n){return new e(t,n)},e.prototype.mappings=function(){return Ba()},e.prototype.child=function(e){gc("child",[yc()],arguments);var t=Pa(this.location.path,e),n=new Oa(this.location.bucket,t);return this.newRef(this.authWrapper,n)},Object.defineProperty(e.prototype,"parent",{get:function(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this.location.path);if(null===e)return null;var t=new Oa(this.location.bucket,e);return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){var e=new Oa(this.location.bucket,"");return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return Aa(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),e.prototype.put=function(e,t){return void 0===t&&(t=null),gc("put",[_c(),vc(!0)],arguments),this.throwIfRoot_("put"),new kc(this,this.authWrapper,this.location,this.mappings(),new Ia(e),t)},e.prototype.putString=function(e,t,n){void 0===t&&(t=ra.RAW),gc("putString",[yc(),yc(ia,!0),vc(!0)],arguments),this.throwIfRoot_("putString");var r=oa(t,e),i=Object.assign({},n);return!ga(i.contentType)&&ga(r.contentType)&&(i.contentType=r.contentType),new kc(this,this.authWrapper,this.location,this.mappings(),new Ia(r.data,!0),i)},e.prototype.delete=function(){var e=this;return gc("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then((function(t){var n=cc(e.authWrapper,e.location);return e.authWrapper.makeRequest(n,t).getPromise()}))},e.prototype.listAll=function(){gc("listAll",[],arguments);var e={prefixes:[],items:[]};return this.listAllHelper(e).then((function(){return e}))},e.prototype.listAllHelper=function(e,t){return Object(Lo.b)(this,void 0,void 0,(function(){var n,r,i,s;return Object(Lo.d)(this,(function(o){switch(o.label){case 0:return n={pageToken:t},[4,this.list(n)];case 1:return r=o.sent(),(i=e.prefixes).push.apply(i,r.prefixes),(s=e.items).push.apply(s,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(e,r.nextPageToken)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},e.prototype.list=function(e){gc("list",[wc(!0)],arguments);var t=this;return this.authWrapper.getAuthToken().then((function(n){var r=e||{},i=sc(t.authWrapper,t.location,"/",r.pageToken,r.maxResults);return t.authWrapper.makeRequest(i,n).getPromise()}))},e.prototype.getMetadata=function(){var e=this;return gc("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then((function(t){var n=ic(e.authWrapper,e.location,e.mappings());return e.authWrapper.makeRequest(n,t).getPromise()}))},e.prototype.updateMetadata=function(e){var t=this;return gc("updateMetadata",[vc()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then((function(n){var r=ac(t.authWrapper,t.location,e,t.mappings());return t.authWrapper.makeRequest(r,n).getPromise()}))},e.prototype.getDownloadURL=function(){var e=this;return gc("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then((function(t){var n=oc(e.authWrapper,e.location,e.mappings());return e.authWrapper.makeRequest(n,t).getPromise().then((function(e){if(null===e)throw Xo();return e}))}))},e.prototype.throwIfRoot_=function(e){if(""===this.location.path)throw function(e){return new Vo(Ko.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)},e}(),Tc=function(){function e(e){this.promise_=Promise.reject(e)}return e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){},e}(),Rc=function(){function e(){this.map=new Map,this.id=Wo}return e.prototype.addRequest=function(e){var t=this,n=this.id;this.id++,this.map.set(n,e),e.getPromise().then((function(){return t.map.delete(n)}),(function(){return t.map.delete(n)}))},e.prototype.clear=function(){this.map.forEach((function(e){e&&e.cancel(!0)})),this.map.clear()},e}(),Ic=function(){function e(t,n,r,i,s){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;ga(o)&&(this.bucket_=e.extractBucket_(o))}this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=s,this.service_=i,this.maxOperationRetryTime_=zo,this.maxUploadRetryTime_=qo,this.requestMap_=new Rc}return e.extractBucket_=function(e){var t=e[Ho]||null;return null==t?null:Oa.makeFromBucketSpec(t).bucket},e.prototype.getAuthToken=function(){return null!==this.app_&&ga(this.app_.INTERNAL)&&ga(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then((function(e){return null!==e?e.accessToken:null}),(function(){return null})):Promise.resolve(null)},e.prototype.bucket=function(){if(this.deleted_)throw ea();return this.bucket_},e.prototype.service=function(){return this.service_},e.prototype.makeStorageReference=function(e){return this.storageRefMaker_(this,e)},e.prototype.makeRequest=function(e,t){if(this.deleted_)return new Tc(ea());var n=this.requestMaker_(e,t,this.pool_);return this.requestMap_.addRequest(n),n},e.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},e.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},e.prototype.setMaxUploadRetryTime=function(e){this.maxUploadRetryTime_=e},e.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},e.prototype.setMaxOperationRetryTime=function(e){this.maxOperationRetryTime_=e},e}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Oc=function(){function e(e,t,n,r,i,s,o,a,c,l,h){var u=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=s.slice(),this.callback_=o,this.errorCallback_=a,this.progressCallback_=l,this.timeout_=c,this.pool_=h,this.promise_=new Promise((function(e,t){u.resolve_=e,u.reject_=t,u.start_()}))}return e.prototype.start_=function(){var e=this;function t(t,n){var r,i=e.resolve_,s=e.reject_,o=n.xhr;if(n.wasSuccessCode)try{var a=e.callback_(o,o.getResponseText());ma(a)?i(a):i()}catch(e){s(e)}else null!==o?((r=Go()).setServerResponseProp(o.getResponseText()),e.errorCallback_?s(e.errorCallback_(o,r)):s(r)):n.canceled?s(r=e.appDelete_?ea():Zo()):s(r=new Vo(Ko.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new Nc(!1,null,!0)):this.backoffId_=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e,t,n){var r=1,i=null,s=!1,o=0;function a(){return 2===o}var c=!1;function l(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];c||(c=!0,t.apply(null,e))}function h(t){i=setTimeout((function(){i=null,e(u,a())}),t)}function u(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];c||(e?l.call.apply(l,[null,e].concat(n)):a()||s?l.call.apply(l,[null,e].concat(n)):(r<64&&(r*=2),1===o?(o=2,t=0):t=1e3*(r+Math.random()),h(t)))}var d=!1;function p(e){d||(d=!0,c||(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),setTimeout((function(){s=!0,p(!0)}),n),p}((function(t,n){if(n)t(!1,new Nc(!1,null,!0));else{var r=e.pool_.createXhrIo();e.pendingXhr_=r,null!==e.progressCallback_&&r.addUploadProgressListener(i),r.send(e.url_,e.method_,e.body_,e.headers_).then((function(n){null!==e.progressCallback_&&n.removeUploadProgressListener(i),e.pendingXhr_=null;var r=(n=n).getErrorCode()===ha.NO_ERROR,s=n.getStatus();if(r&&!e.isRetryStatusCode_(s)){var o=-1!==e.successCodes_.indexOf(s);t(!0,new Nc(o,n))}else{var a=n.getErrorCode()===ha.ABORT;t(!1,new Nc(!1,null,a))}}))}function i(t){var n=t.loaded,r=t.lengthComputable?t.total:-1;null!==e.progressCallback_&&e.progressCallback_(n,r)}}),t,this.timeout_)},e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},e.prototype.isRetryStatusCode_=function(e){var t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r},e}(),Nc=function(e,t,n){this.wasSuccessCode=e,this.xhr=t,this.canceled=!!n};function Pc(e,t,n){var r=Da(e.urlParams),i=e.url+r,s=Object.assign({},e.headers);return function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(s,t),function(e){var t=void 0!==$o.a?$o.a.SDK_VERSION:"AppManager";e["X-Firebase-Storage-Version"]="webjs/"+t}(s),new Oc(i,e.method,s,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,n)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ac,Mc,Dc,Fc=function(){function e(e,t,n){if(this.bucket_=null,this.authWrapper_=new Ic(e,(function(e,t){return new xc(e,t)}),Pc,this,t),this.app_=e,null!=n)this.bucket_=Oa.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new Oa(r,""))}this.internals_=new jc(this)}return e.prototype.ref=function(e){function t(e){if("string"!=typeof e)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(e))throw"Expected child path but got a URL, use refFromURL instead."}if(gc("ref",[yc(t,!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var n=new xc(this.authWrapper_,this.bucket_);return null!=e?n.child(e):n},e.prototype.refFromURL=function(e){function t(e){if("string"!=typeof e)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(e))throw"Expected full URL but got a child path, use ref instead.";try{Oa.makeFromUrl(e)}catch(e){throw"Expected valid full URL but got an invalid one."}}return gc("refFromURL",[yc(t,!1)],arguments),new xc(this.authWrapper_,e)},Object.defineProperty(e.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),e.prototype.setMaxUploadRetryTime=function(e){gc("setMaxUploadRetryTime",[bc()],arguments),this.authWrapper_.setMaxUploadRetryTime(e)},e.prototype.setMaxOperationRetryTime=function(e){gc("setMaxOperationRetryTime",[bc()],arguments),this.authWrapper_.setMaxOperationRetryTime(e)},Object.defineProperty(e.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),e}(),jc=function(){function e(e){this.service_=e}return e.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},e}(),$c="storage";function Bc(e,t,n){return new Fc(e,new xa,n)}Ac=$o.a,Mc={TaskState:pa,TaskEvent:ua,StringFormat:ra,Storage:Fc,Reference:xc},Ac.INTERNAL.registerService($c,Bc,Mc,void 0,!0);
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Lc extends Ve{constructor(e,t,n,r){super("firebase"),this.databaseURL=`${e}.${t}`,this.domain=t,this.projectId=e,this.apiKey=n,this.location=r}toString(){return`${this.protocol}://${this.databaseURL}:${this.apiKey}/${this.location}`}childWithComponent(e){return new Lc(this.projectId,this.domain,this.apiKey,`${this.location}/${e}`)}static fromString(e){const t=e.match(/^firebase:\/\/([^.]+)\.([^:]+):([^/]+)\/(.*)$/);if(!t)throw new Error(`Not a valid FirebaseStorageKey: ${e}.`);const[n,r,i,s,o]=t;return new Lc(r,i,s,o)}}class Uc{constructor(e){this.appCache=e.getCacheService().getOrCreateCache("firebase-driver")}getApp(e){const t=e.toString();return this.appCache.has(t)||this.appCache.set(t,Bo.initializeApp(e)),this.appCache.get(t)}async stopAllApps(){await Promise.all([...this.appCache.values()].map(e=>e.delete())),this.appCache.clear()}static async stop(){await new Uc(Eo.getRuntime()).stopAllApps()}}class Hc extends Ne{constructor(){super(...arguments),this.appCache=new Uc(Eo.getRuntime()),this.seenVersion=0,this.seenTag=0,this.nextTag=null,this.pendingModel=null}async init(){const e=this.appCache.getApp(this.storageKey).database().ref(this.storageKey.location),t=await e.once("value");if(this.exists===be.ShouldCreate&&t.exists())throw new Error(`requested creation of memory location ${this.storageKey} can't proceed as location already exists`);if(this.exists===be.ShouldExist&&!t.exists())throw new Error(`requested connection to memory location ${this.storageKey} can't proceed as location doesn't exist`);t.exists()?(this.pendingModel=t.val().model||null,this.pendingVersion=t.val().version):await e.transaction(e=>{if(null===e)return{version:0,tag:0}}),this.reference=e}registerReceiver(e,t){this.receiver=e,t&&(this.seenVersion=Number(t)),null!==this.pendingModel?(g()(this.pendingModel),this.pendingVersion>this.seenVersion&&(e(this.pendingModel,this.pendingVersion),this.seenVersion=this.pendingVersion),this.pendingModel=null):g()(0===this.seenVersion),this.reference.on("value",e=>this.remoteStateChanged(e))}async send(e,t){this.nextTag=Math.random();const n=this.nextTag,r=this.seenTag;return(await this.reference.transaction(i=>{if(i){if(i.version!==t-1)return;if(i.tag!==r)return}return{version:t,model:e,tag:n}},(e,t)=>{t&&(this.seenTag=n)},!1)).committed}remoteStateChanged(e){const{model:t,version:n,tag:r}=e.val();n>this.seenVersion&&(this.seenVersion=n,this.seenTag=r,r!==this.nextTag&&this.receiver(t,n))}async write(e,t){throw new Error("Method not implemented.")}async read(e){throw new Error("Method not implemented.")}getToken(){return this.seenVersion+""}}class zc{willSupport(e){return"firebase"===e.protocol}async driver(e,t){if(!this.willSupport(e))throw new Error(`This provider does not support storageKey ${e.toString()}`);const n=new Hc(e,t);return await n.init(),n}static register(){Pe.register(new zc)}}zc.register();
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class qc extends Ve{constructor(e){super("ramdisk"),this.unique=e}toString(){return`${this.protocol}://${this.unique}`}childWithComponent(e){return new qc(`${this.unique}/${e}`)}static fromString(e){const t=e.match(/^ramdisk:\/\/(.*)$/);if(!t)throw new Error(`Not a valid RamDiskStorageKey: ${e}.`);const n=t[1];return new qc(n)}}class Wc{willSupport(e){return"ramdisk"===e.protocol}async driver(e,t){if(!this.willSupport(e))throw new Error(`This provider does not support storageKey ${e.toString()}`);const n=Eo.getRuntime().getRamDiskMemory();return new Yr(e,t,n)}static register(){Pe.register(new Wc)}}Wc.register();class Vc{static getDefaultParsers(){return new Map([["volatile",Qr.fromString],["firebase",Lc.fromString],["ramdisk",qc.fromString],["reference-mode",Ke.fromString]])}static parse(e){const t=e.match(/^((?:\w|-)+):\/\/(.*)$/);if(!t)throw new Error("Failed to parse storage key: "+e);const n=t[1],r=Vc.parsers.get(n);if(!r)throw new Error(`Unknown storage key protocol ${n} in key ${e}.`);return r(e,Vc.parse)}static reset(){this.parsers=this.getDefaultParsers()}static addParser(e,t){if(this.parsers.has(e))throw new Error(`Parser for storage key protocol ${e} already exists.`);this.parsers.set(e,t)}}Vc.parsers=Vc.getDefaultParsers(),function(e){e.Error="error",e.Warning="warning"}(Dc||(Dc={}));class Kc extends Error{constructor(e,t){super(t),this.severity=Dc.Error,this.location=e}}class Qc extends Kc{constructor(e,t){super(e,t),this.severity=Dc.Warning}}class Gc{traverse(e){if(["string","number","boolean"].includes(typeof e)||null===e)return;if(e instanceof Array){for(const t of e)this.traverse(t);return}g()(e.location,"expected manifest node to have `location`"),g()(e.kind,"expected manifest node to have `kind`");let t=!1;const n=()=>{if(!t){t=!0;for(const t of Object.keys(e))["location","kind","model"].includes(t)||this.traverse(e[t])}};this.visit(e,n),n()}visit(e,t){}}const Zc=new Set;class Yc{constructor({id:e}){if(this._recipes=[],this._imports=[],this._particles={},this._schemas={},this._stores=[],this._interfaces=[],this.storeTags=new Map,this._fileName=null,this._idGenerator=ye.newSession(),this._storageProviderFactory=void 0,this._meta=new wn,this._resources={},this.storeManifestUrls=new Map,this.errors=[],g()(e instanceof _e||"string"==typeof e),e instanceof _e)this._id=e;else{const t=e.split(":");this._id=_e._newIdInternal(t[0],t.slice(1))}}get id(){return this._meta.name?_e.fromString(this._meta.name):this._id}get storageProviderFactory(){if(O.useNewStorageStack)throw new Error("Not present in the new storage stack.");return null==this._storageProviderFactory&&(this._storageProviderFactory=new jo(this.id)),this._storageProviderFactory}get recipes(){return this._recipes}get allRecipes(){return[...new Set(this._findAll(e=>e._recipes))]}get activeRecipe(){return this._recipes.find(e=>"active"===e.annotation)}get particles(){return Object.values(this._particles)}get allParticles(){return[...new Set(this._findAll(e=>Object.values(e._particles)))]}get imports(){return this._imports}get schemas(){return this._schemas}get allSchemas(){return[...new Set(this._findAll(e=>Object.values(e._schemas)))]}get fileName(){return this._fileName}get stores(){return this._stores}get allStores(){return[...this._findAll(e=>e._stores)]}get interfaces(){return this._interfaces}get meta(){return this._meta}get resources(){return this._resources}applyMeta(e){void 0!==this._storageProviderFactory&&g()(e.name===this._meta.name||null==e.name,"can't change manifest ID after storage is constructed"),this._meta.apply(e)}_addStore(e,t){return this._stores.push(e),this.storeTags.set(e,t||[]),e}newStore(e){let t;if(e.source&&this.storeManifestUrls.set(e.id,this.fileName),O.useNewStorageStack){let n=e.storageKey;"string"==typeof n&&(n=Vc.parse(n)),t=new Qe({...e,storageKey:n,exists:be.MayExist})}else{if(e.storageKey instanceof Ve)throw new Error("Can't use new-style storage keys with the old storage stack.");t=new Fr(e.type,e.id,e.name,e.storageKey,this.storageProviderFactory,e.originalId,e.claims,e.description,e.version,e.source,e.origin,e.referenceMode,e.model)}return this._addStore(t,e.tags)}_find(e){let t=e(this);if(!t)for(const n of this._imports)if(t=n._find(e))break;return t}*_findAll(e){yield*e(this);for(const t of this._imports)yield*t._findAll(e)}findSchemaByName(e){return this._find(t=>t._schemas[e])}findTypeByName(e){const t=this.findSchemaByName(e);if(t)return new it(t);const n=this.findInterfaceByName(e);return n?new lt(n):void 0}findParticleByName(e){return this._find(t=>t._particles[e])}findParticlesByVerb(e){return[...this._findAll(t=>Object.values(t._particles).filter(t=>t.primaryVerb===e))]}findStoreByName(e){return this._find(t=>t._stores.find(t=>t.name===e))}findStoreById(e){return this._find(t=>t._stores.find(t=>t.id===e))}findStoreTags(e){return new Set(this._find(t=>t.storeTags.get(e)))}findManifestUrlForHandleId(e){return this._find(t=>t.storeManifestUrls.get(e))}findStoresByType(e,t={tags:[],subtype:!1}){const n=t.tags||[],r=t.subtype||!1;return[...this._findAll(t=>t._stores.filter(i=>(function(t){const n=e.resolvedType();if(!n.isResolved())return e instanceof ot==t.type instanceof ot&&e instanceof at==t.type instanceof at;if(r){const[e,r]=nt.unwrapPair(t.type,n);return e instanceof it&&r instanceof it&&e.entitySchema.isMoreSpecificThan(r.entitySchema)}return ft.compareTypes({type:t.type},{type:e})})(i)&&function(e,t){return 0===n.filter(n=>!e.storeTags.get(t).includes(n)).length}(t,i)))].filter(t=>!!Bn.effectiveType(e,[{type:t.type,direction:t.type instanceof lt?"host":"inout"}]))}findInterfaceByName(e){return this._find(t=>t._interfaces.find(t=>t.name===e))}findRecipesByVerb(e){return[...this._findAll(t=>t._recipes.filter(t=>t.verbs.includes(e)))]}generateID(e){return this._idGenerator.newChildId(this.id,e)}static async load(e,t,n={}){let{registry:r}=n;return(r=r||{})&&r[e]?await r[e]:(r[e]=(async()=>{const n=await t.loadResource(e);return g()(void 0!==n,`${e} unable to be loaded by Manifest parser`),await Yc.parse(n,{fileName:e,loader:t,registry:r})})(),await r[e])}static getErrors(e){return e.errors}static async parse(e,t={}){let{fileName:n,loader:r,registry:i,context:s}=t;i=i||{};const o=`manifest:${n}:`;function a(e){for(const t of e.errors){if(t.key){if(Zc.has(t.key))continue;Zc.add(t.key)}console.warn(c(t).message)}}function c(t,r){return t instanceof Kc||t.location?function(t,r){const i=e.split("\n")[t.location.start.line-1];let s=t.message||"";if(i){let e=1;e=t.location.end.line===t.location.start.line?t.location.end.column-t.location.start.column:i.length-t.location.start.column,e=Math.max(1,e);let o,a="";for(let e=0;e<t.location.start.column-1;e++)a+=" ";for(let t=0;t<e;t++)a+="^";const c=t.severity||Dc.Error;s=`${o=r?`Parse ${c} in`:`Post-parse processing ${c} caused by`} '${n}' line ${t.location.start.line}.\n${t.message}\n  ${i}\n  ${a}`}const o=new Kc(t.location,s);r||(o.stack=t.stack);return o}(t,r):t}let l=[];try{l=mn(e)}catch(e){throw c(e,!0)}const h=new Yc({id:o});h._fileName=n,s&&h._imports.push(s);try{await Promise.all(l.map(async e=>{if("import"===e.kind){if(!r)throw new Error("loader required to parse import statements");const t=r.path(h.fileName),n=r.join(t,e.path);try{h._imports.push(await Yc.load(n,r,{registry:i}))}catch(t){h.errors.push(t),h.errors.push(new Kc(e.location,`Error importing '${n}'`))}}}));const e=async(e,t)=>{for(const n of l)n.kind===e&&(Yc._augmentAstWithTypes(h,n),await t(n))};await e("meta",e=>h.applyMeta(e.items)),await e("resource",e=>Yc._processResource(h,e)),await e("schema",e=>Yc._processSchema(h,e)),await e("interface",e=>Yc._processInterface(h,e)),await e("particle",e=>Yc._processParticle(h,e,r)),await e("store",e=>Yc._processStore(h,e,r)),await e("recipe",e=>Yc._processRecipe(h,e))}catch(e){throw a(h),c(e,!1)}if(a(h),t.throwImportErrors){const e=h.errors.find(e=>e.severity===Dc.Error);if(e)throw e}return h}static _augmentAstWithTypes(e,t){(new class extends Gc{constructor(){super()}visit(t,n){switch(n(),t.kind){case"schema-inline":{const n=[],r=[],i=[];for(const s of t.names){const t=e.resolveTypeName(s);t&&t.schema&&t.schema.isAlias?r.push(t.schema):i.push(s),t&&t.schema&&n.push(t.schema)}const s={};for(let{name:e,type:r}of t.fields){for(const i of n)if(r){const n=i.fields[e];if(n&&!de.typesEqual(n,r))throw new Kc(t.location,`Type of '${e}' does not match schema (${r} vs ${n})`)}else r=i.fields[e];if(!r)throw new Kc(t.location,`Could not infer type of '${e}' field`);s[e]=r}let o=new de(i,s);for(const e of r)if(!(o=de.union(e,o)))throw new Kc(t.location,"Could not merge schema aliases");return t.model=new it(o),void delete t.fields}case"variable-type":{const e=t.constraint&&t.constraint.model;return void(t.model=st.make(t.name,e,null))}case"slot-type":{const e={};for(const n of Object.keys(t.fields)){const r=t.fields[n];e[r.name]=r.value}return void(t.model=ht.make(e.formFactor,e.handle))}case"type-name":{const n=e.resolveTypeName(t.name);if(!n)throw new Kc(t.location,`Could not resolve type reference to type name '${t.name}'`);if(n.schema)t.model=new it(n.schema);else{if(!n.iface)throw new Kc(t.location,"Expected {iface} or {schema}");t.model=new lt(n.iface)}return}case"collection-type":return void(t.model=new ot(t.type.model));case"big-collection-type":return void(t.model=new at(t.type.model));case"reference-type":return void(t.model=new ut(t.type.model));case"singleton-type":return void(t.model=new rt(t.type.model));default:return}}}).traverse(t)}static _processSchema(e,t){let n;const r={};let i=[...t.names];for(const e of t.items)switch(e.kind){case"schema-field":{const t=e;if(r[t.name])throw new Kc(t.location,`Duplicate definition of field '${t.name}'`);r[t.name]=t.type;break}case"description":if(n)throw new Kc(e.location,"Duplicate schema description");n=e;break;default:throw new Kc(e.location,`unknown parser artifact ${e.kind} while processing schema`)}for(const n of t.parents){const s=e.findSchemaByName(n);if(!s)throw new Kc(t.location,`Could not find parent schema '${n}'`);for(const[e,i]of Object.entries(s.fields))if(r[e]&&!de.typesEqual(r[e],i))throw new Kc(t.location,`'${n}' defines incompatible type for field '${e}'`);Object.assign(r,s.fields),i.push(...s.names)}i=[...new Set(i)];const s=t.alias||i[0];if(!s)throw new Kc(t.location,"Schema defined without name or alias");const o=new de(i,r,n);t.alias&&(o.isAlias=!0),e._schemas[s]=o}static _processResource(e,t){e._resources[t.name]=t.data}static _processParticle(e,t,n){if(g()(null==t.implFile||null!==t.args,"no valid body defined for this particle"),t.args||(t.args=[]),t.hasParticleArgument){const n=new Qc(t.location,"Particle uses deprecated argument body");n.key="hasParticleArgument",e.errors.push(n)}t.implFile&&n&&(t.implFile=n.join(e.fileName,t.implFile));const r=t=>{for(const n of t){if(n.type&&"type-name"===n.type.kind&&n.type.model&&"Entity"===n.type.model.tag){const t=new Qc(n.location,"Particle uses deprecated external schema");t.key="externalSchemas",e.errors.push(t)}n.type=n.type.model,r(n.dependentConnections)}};r(t.args),e._particles[t.name]=new Pt(t)}static _processInterface(e,t){const n=[];for(const e of t.args){const t={name:void 0,type:void 0,direction:e.direction};"*"!==e.name&&(t.name=e.name),e.type&&(t.type=e.type.model),n.push(t)}const r=[];for(const e of t.slots)r.push({direction:e.direction,name:e.name,isRequired:e.isRequired,isSet:e.isSet});const i=new L(t.name,n,r);e._interfaces.push(i)}static _processRecipe(e,t){const n=e._newRecipe(t.name);t.annotation&&(n.annotation=t.annotation),t.triggers&&(n.triggers=t.triggers),t.verbs&&(n.verbs=t.verbs),Yc._buildRecipe(e,n,t.items)}static _buildRecipe(e,t,n){const r={require:n.filter(e=>"require"===e.kind),handles:n.filter(e=>"handle"===e.kind),byHandle:new Map,requireHandles:n.filter(e=>"requireHandle"===e.kind),particles:n.filter(e=>"recipe-particle"===e.kind),byParticle:new Map,slots:n.filter(e=>"slot"===e.kind),bySlot:new Map,byName:new Map,connections:n.filter(e=>"connection"===e.kind),search:n.find(e=>"search"===e.kind),description:n.find(e=>"description"===e.kind)};g()(!(r.handles.length>0&&r.requireHandles.length>0),"Inconsistent handle definitions");const i=r.handles.length>0?r.handles:r.requireHandles;for(const n of i){const i=t.newHandle(),s=n.ref;if(s.id){i.id=s.id;const t=e.findStoreById(i.id);t&&i.mapToStorage(t)}else if(s.name){const t=e.findStoreByName(s.name);g()(t,`Could not find handle ${s.name}`),i.mapToStorage(t)}i.tags=s.tags,n.name&&(g()(!r.byName.has(n.name),`duplicate handle name: ${n.name}`),i.localName=n.name,r.byName.set(n.name,{item:n,handle:i})),i.fate="handle"===n.kind&&n.fate?n.fate:null,r.byHandle.set(i,n)}const s=(t,n)=>{switch(n.targetType){case"particle":{const r=e.findParticleByName(n.particle);if(!r)throw new Kc(t.location,`could not find particle '${n.particle}'`);if(null!==n.param&&!r.handleConnectionMap.has(n.param))throw new Kc(t.location,`param '${n.param}' is not defined by '${n.particle}'`);return new Sn(r,n.param)}case"localName":if(!r.byName.has(n.name))throw new Kc(t.location,`local name '${n.name}' does not exist in recipe`);if(null==n.param&&0===n.tags.length&&r.byName.get(n.name).handle)return new En(r.byName.get(n.name).handle);throw new Kc(t.location,"references to particles by local name not yet supported");case"tag":return new kn(n.tags);default:throw new Kc(t.location,`endpoint ${n.targetType} not supported`)}};for(const e of r.connections){const n=s(e,e.from),r=s(e,e.to);t.newConnectionConstraint(n,r,e.direction)}r.search&&(t.search=new Mn(r.search.phrase,r.search.tokens));for(const e of r.slots){const n=t.newSlot(void 0);e.ref.id&&(n.id=e.ref.id),e.ref.tags&&(n.tags=e.ref.tags),e.name&&(g()(!r.byName.has(e.name),`Duplicate slot local name ${e.name}`),n.localName=e.name,r.byName.set(e.name,n)),r.bySlot.set(n,e)}for(const n of r.particles){const i=t.newParticle(n.ref.name);if(i.verbs=n.ref.verbs,!(t instanceof Fn)&&n.ref.name){const t=e.findParticleByName(n.ref.name);if(!t)throw new Kc(n.location,`could not find particle ${n.ref.name}`);i.spec=t.clone()}n.name&&(g()(!r.byName.has(n.name)),i.localName=n.name,r.byName.set(n.name,{item:n,particle:i})),r.byParticle.set(i,n);for(const e of n.slotConnections){if("provide"===e.direction)throw new Kc(n.location,"invalid slot connection: provide slot must be dependent");let s=i.getSlotConnectionByName(e.param);if(!s){if(void 0!==i.spec){if(!i.spec.slotConnections.has(e.param))throw new Kc(e.location,`Consumed slot '${e.param}' is not defined by '${i.name}'`);e.dependentSlotConnections.forEach(e=>{if(!i.getSlotSpecByName(e.param))throw new Kc(e.location,`Provided slot '${e.param}' is not defined by '${i.name}'`)})}s=i.addSlotConnection(e.param)}s.tags=e.tags||[],e.dependentSlotConnections.forEach(e=>{if("consume"===e.direction)throw new Kc(n.location,"invalid slot connection: consume slot must not be dependent");if(0!==e.dependentSlotConnections.length)throw new Kc(n.location,"invalid slot connection: provide slot must not have dependencies");if(t instanceof Fn){const n=t.parent.slots.find(t=>t.localName===e.name);void 0!==n&&(s.providedSlots[e.param]=n,n.sourceConnection=s,n.name=e.param)}let i=s.providedSlots[e.param];if(i){if(e.name)if(r.byName.has(e.name)){const n=r.byName.get(e.name);g()(n!==i),g()(!n.name&&i),g()(!n.sourceConnection&&i.sourceConnection),i.id=n.id,i.tags=n.tags,r.byName.set(e.name,i),t.removeSlot(n)}else r.byName.set(e.name,i);r.bySlot.set(i,e)}else i=r.byName.get(e.name);i||((i=t.newSlot(e.param)).localName=e.name,i.sourceConnection=s,e.name&&(g()(!r.byName.has(e.name)),r.byName.set(e.name,i)),r.bySlot.set(i,e)),s.providedSlots[e.param]||(s.providedSlots[e.param]=i),i.localName=e.name})}}const o=(n,i)=>{let s;"*"===i.param?s=n.addUnnamedConnection():(s=n.connections[i.param])||(s=n.addConnectionName(i.param)),s.tags=i.target?i.target.tags:[];const a=i.dir;if(!Rn(a,s.direction))throw new Kc(i.location,`'${a}' not compatible with '${s.direction}' param of '${n.name}'`);if("any"===s.direction){if("*"!==i.param&&void 0!==n.spec)throw new Kc(i.location,`param '${i.param}' is not defined by '${n.name}'`);s.direction=a}let c,l;if(i.target&&i.target.name){let e=r.byName.get(i.target.name);if(e){if(!e.item)throw new Kc(i.location,`did not expect '${e}' expected handle or particle`)}else{const n=t.newHandle();n.tags=[],n.localName=i.target.name,"`consume"===s.direction||"`provide"===s.direction?n.fate="`slot":n.fate="create",n.item={kind:"handle"},e={item:n.item,handle:n},r.byName.set(n.localName,e),r.byHandle.set(n,n.item)}if("handle"===e.item.kind||"requireHandle"===e.item.kind)c=e.handle;else{if("particle"!==e.item.kind)throw new Kc(i.location,`did not expect ${e.item.kind}`);l=e.particle}}if(i.target&&i.target.particle){const t=e.findParticleByName(i.target.particle);if(!t)throw new Kc(i.target.location,`Could not find hosted particle '${i.target.particle}'`);if(!(c=Nn.constructImmediateValueHandle(s,t,e.generateID())))throw new Kc(i.target.location,`Hosted particle '${t.name}' does not match interface '${s.name}'`)}if(l){let e;i.target.name?(e=l.connections[i.target.name])||(e=l.addConnectionName(i.target.name)):e=l.addUnnamedConnection(),(c=e.handle)||(c=t.newHandle(),e.connectToHandle(c))}c&&s.connectToHandle(c),i.dependentConnections.forEach(e=>o(n,e))};for(const[e,n]of r.byParticle){for(const t of n.connections)o(e,t);for(const i of n.slotConnections){let n=r.byName.get(i.name);n?(g()(r.bySlot.has(n)),n.name||(n.name=i.param),g()(n===r.byName.get(i.name),`Target slot ${n.name} doesn't match slot connection ${i.param}`)):i.name&&(t instanceof Fn&&void 0!==(n=t.parent.slots.find(e=>e.localName===i.name))&&(r.bySlot.set(n,i),i.name&&r.byName.set(i.name,n)),null==n&&((n=t.newSlot(i.param)).localName=i.name,r.byName.set(i.name,n),r.bySlot.set(n,i))),n&&e.getSlotConnectionByName(i.param).connectToSlot(n)}}if(r.description&&r.description.description&&(t.description=r.description.description),r.require)for(const n of r.require){const r=t.newRequireSection();Yc._buildRecipe(e,r,n.items)}}resolveTypeName(e){const t=this.findSchemaByName(e);if(t)return{schema:t};const n=this.findInterfaceByName(e);return n?{iface:n}:null}createLocalDataStorageKey(){return O.useNewStorageStack?new qc(this.generateID("local-data").toString()):this.storageProviderFactory._storageForKey("volatile").constructKey("volatile")}static async _processStore(e,t,n){const r=t.name;let i=t.id;const s=t.originalId,o=t.type.model;null==i&&(i=`${e._id}store${e._stores.length}`);let a=t.tags;null==a&&(a=[]);const c=[];if(t.claim&&t.claim.tags.forEach(e=>c.push(new Et(!1,e))),"storage"===t.origin)return e.newStore({type:o,name:r,id:i,storageKey:t.source,tags:a,originalId:s,claims:c,description:t.description,version:t.version,origin:t.origin});let l,h,u;if("file"===t.origin){if(!n)throw new Kc(t.location,"No loader available for file");t.source=n.join(e.fileName,t.source),l=await n.loadResource(t.source)}else if("resource"===t.origin&&(h=t.source,null==(l=e.resources[h])))throw new Kc(t.location,`Resource '${h}' referenced by store '${i}' is not defined in this manifest`);try{u=JSON.parse(l)}catch(e){throw new Kc(t.location,`Error parsing JSON from '${h}' (${e.message})'`)}if(O.useNewStorageStack){const n=t.storageKey||e.createLocalDataStorageKey();return e.newStore({type:o,name:r,id:i,storageKey:n,tags:a,originalId:s,claims:c,description:t.description,version:t.version||null,source:t.source,origin:t.origin,referenceMode:!1,model:u})}let d,p=null,f=!0;if(o instanceof ot?p=o.collectionType:o instanceof at?p=o.bigCollectionType:0===u.length?f=!1:(u=u.slice(u.length-1),p=o),p&&p instanceof it){let n=!1;if(u=u.map(t=>{if(null==t)return null;n=n||t.$id;const r=t.$id||e.generateID().toString();return delete t.$id,{id:r,rawData:t}}),!t.id&&!n){i=`${i}:${await vn(JSON.stringify(u.map(e=>e.rawData)))}`}}if(u.length>0&&u[0].rawData&&u[0].rawData.storageKey){let t=u[0].rawData.storageKey;t=e.findStoreByName(t).storageKey,u=u.map(({id:e,rawData:n})=>({id:e,storageKey:t}))}else u.length>0&&(f=!1);d=o instanceof ot?u.map(e=>({id:e.id,value:e,keys:new Set([e.id])})):o instanceof at?u.map(e=>{const t=e.rawData.$index;return delete e.rawData.$index,{id:e.id,index:t,value:e,keys:new Set([e.id])}}):u.map(e=>({id:e.id,value:e}));const g=t.version||null;return e.newStore({type:o,name:r,id:i,storageKey:e.createLocalDataStorageKey(),tags:a,originalId:s,claims:c,description:t.description,version:g,source:t.source,origin:t.origin,referenceMode:f,model:d})}_newRecipe(e){const t=new Dn(e);return this._recipes.push(t),t}toString(e={}){const t=[];return this._imports.forEach(n=>{if(e.recursive){t.push(`// import '${n.fileName}'`);n.toString(e);t.push(`${n.toString(e)}`)}else t.push(`import '${n.fileName}'`)}),Object.values(this._schemas).forEach(e=>{t.push(e.toManifestString())}),Object.values(this._particles).forEach(e=>{t.push(e.toString())}),this._recipes.forEach(n=>{t.push(n.toString(e))}),[...this.stores].sort(qe).forEach(e=>{t.push(e.toManifestString({handleTags:this.storeTags.get(e)}))}),t.join("\n")}get idGeneratorForTesting(){return this._idGenerator}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const Xc=i()(process.argv.slice(2),{string:["output"],boolean:["verbose","help"],alias:{o:"output",v:"verbose"},default:{output:"bundle.zip",verbose:!1}});(Xc.help||0===Xc._.length)&&(console.log("Usage\n  $ bundle [-options] [file ...]\n\nDescription\n  Creates a zip bundle containing all transitive dependencies of an Arcs manifest.\n\nOptions\n  --output, -o   name of the created bundle, bundle.zip by default\n  --verbose, -v  list bundled files\n  --help         usage info\n\nExamples\n  $ bundle Feature.arcs\n  $ bundle -v -o mybundle.zip recipes/Feature.arcs recipes/ExtraStuff.arcs"),process.exit()),Array.isArray(Xc.output)&&(console.error("Only one output path can be specified"),process.exit(1)),async function(e,t,n){const r=await async function(...e){e=e.map(e=>c.a.isAbsolute(e)?e:c.a.resolve(process.cwd(),e).split(c.a.sep).join("/"));const t=new fn,n=await Promise.all(e.map(e=>Yc.load(e,t))),r=new Set;n.forEach(e=>(function e(t,n){if(!t.fileName)throw new Error("Missing filename");n.add(t.fileName);for(const e of t.particles)n.add(e.implFile);for(const e of t.stores)e.source&&n.add(e.source);for(const r of t.imports)e(r,n)})(e,r));const i=[...r].sort(),s=function(e){const t=e[0],n=e[e.length-1];let r=0;for(let e=0;e<Math.min(t.length,n.length)&&t[e]===n[e];e++)"/"===t[e]&&(r=e+1);return r}(i),o=n.map(e=>e.fileName);return i.map(e=>({filePath:e,bundlePath:e.substr(s),entryPoint:o.includes(e)}))}(...e);if(r.some(e=>"__bundle_entry.arcs"===e.bundlePath))throw new Error("Error: Top-level '__bundle_entry.arcs' file found. Please remove it.");return n&&(console.log("Bundled files:"),r.forEach(e=>console.log(e.filePath))),new Promise(e=>{const n=c.a.dirname(t);o.a.existsSync(n)||o.a.mkdirSync(n,{recursive:!0});const i=new h.a;for(const e of r)i.file(e.bundlePath,o.a.readFileSync(e.filePath),{createFolders:!1});i.file("__bundle_entry.arcs",r.filter(e=>e.entryPoint).map(e=>`import '${e.bundlePath}'\n`).join("")),i.generateNodeStream().pipe(o.a.createWriteStream(t)).on("finish",()=>e())})}(Xc._,Xc.output,Xc.verbose).catch(e=>{console.error(e.message),process.exit(1)})}]);