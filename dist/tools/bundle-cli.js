!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=84)}([function(e,t,n){"use strict";var r=n(3),i=n(29),s=n(16),o=n(60),a=n(11);function c(e){return e}function l(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}t.newBlob=function(e,n){t.checkSupport("blob");try{return new Blob([e],{type:n})}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(e),r.getBlob(n)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(e,t,n){var r=[],i=0,s=e.length;if(s<=n)return String.fromCharCode.apply(null,e);for(;i<s;)"array"===t||"nodebuffer"===t?r.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,s)))):r.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,s)))),i+=n;return r.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var n=65536,r=t.getTypeOf(e),i=!0;if("uint8array"===r?i=h.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=h.applyCanBeUsed.nodebuffer),i)for(;n>1;)try{return h.stringifyByChunk(e,r,n)}catch(e){n=Math.floor(n/2)}return h.stringifyByChar(e)}function d(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}t.applyFromCharCode=u;var p={};p.string={string:c,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,s.allocBuffer(e.length))}},p.array={string:u,array:c,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},p.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:c,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},p.uint8array={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:c,nodebuffer:function(e){return s.newBufferFrom(e)}},p.nodebuffer={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:c},t.transformTo=function(e,n){if(n||(n=""),!e)return n;t.checkSupport(e);var r=t.getTypeOf(n);return p[r][e](n)},t.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":r.nodebuffer&&s.isBuffer(e)?"nodebuffer":r.uint8array&&e instanceof Uint8Array?"uint8array":r.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},t.checkSupport=function(e){if(!r[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)r+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return r},t.delay=function(e,t,n){o(function(){e.apply(n||null,t||[])})},t.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},t.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},t.prepareContent=function(e,n,s,o,c){return a.Promise.resolve(n).then(function(e){return r.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise(function(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.error)},r.readAsArrayBuffer(e)}):e}).then(function(n){var h,u=t.getTypeOf(n);return u?("arraybuffer"===u?n=t.transformTo("uint8array",n):"string"===u&&(c?n=i.decode(n):s&&!0!==o&&(n=l(h=n,r.uint8array?new Uint8Array(h.length):new Array(h.length)))),n):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},function(e,t,n){"use strict";function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},e.exports=r},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,t.nodebuffer="undefined"!=typeof Buffer,t.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)t.blob=!1;else{var r=new ArrayBuffer(0);try{t.blob=0===new Blob([r],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(r),t.blob=0===i.getBlob("application/zip").size}catch(e){t.blob=!1}}}try{t.nodestream=!!n(22).Readable}catch(e){t.nodestream=!1}},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){var t,n,r,i,s,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)s=e[t],o.set(s,i),i+=s.length;return o}},o={arraySet:function(e,t,n,r,i){for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";for(var r=n(0),i=n(3),s=n(16),o=n(1),a=new Array(256),c=0;c<256;c++)a[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;a[254]=a[254]=1;function l(){o.call(this,"utf-8 decode"),this.leftOver=null}function h(){o.call(this,"utf-8 encode")}t.utf8encode=function(e){return i.nodebuffer?s.newBufferFrom(e,"utf-8"):function(e){var t,n,r,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=i.uint8array?new Uint8Array(c):new Array(c),o=0,s=0;o<c;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t}(e)},t.utf8decode=function(e){return i.nodebuffer?r.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,i,s,o=e.length,c=new Array(2*o);for(n=0,t=0;t<o;)if((i=e[t++])<128)c[n++]=i;else if((s=a[i])>4)c[n++]=65533,t+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&t<o;)i=i<<6|63&e[t++],s--;s>1?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return c.length!==n&&(c.subarray?c=c.subarray(0,n):c.length=n),r.applyFromCharCode(c)}(e=r.transformTo(i.uint8array?"uint8array":"array",e))},r.inherits(l,o),l.prototype.processChunk=function(e){var n=r.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var s=n;(n=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),n.set(s,this.leftOver.length)}else n=this.leftOver.concat(n);this.leftOver=null}var o=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+a[e[n]]>t?n:t}(n),c=n;o!==n.length&&(i.uint8array?(c=n.subarray(0,o),this.leftOver=n.subarray(o,n.length)):(c=n.slice(0,o),this.leftOver=n.slice(o,n.length))),this.push({data:t.utf8decode(c),meta:e.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=l,r.inherits(h,o),h.prototype.processChunk=function(e){this.push({data:t.utf8encode(e.data),meta:e.meta})},t.Utf8EncodeWorker=h},function(e,t,n){"use strict";var r=n(13),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=u;var s=n(9);s.inherits=n(10);var o=n(23),a=n(26);s.inherits(u,o);for(var c=i(a.prototype),l=0;l<c.length;l++){var h=c[l];u.prototype[h]||(u.prototype[h]=a.prototype[h])}function u(e){if(!(this instanceof u))return new u(e);o.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),u.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){e.exports=require("zlib")},function(e,t){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=Buffer.isBuffer},function(e,t,n){try{var r=n(15);if("function"!=typeof r.inherits)throw"";e.exports=r.inherits}catch(t){e.exports=n(56)}},function(e,t,n){"use strict";var r=null;r="undefined"!=typeof Promise?Promise:n(61),e.exports={Promise:r}},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,s,o=arguments.length;switch(o){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,n)});case 4:return process.nextTick(function(){e.call(null,t,n,r)});default:for(i=new Array(o-1),s=0;s<i.length;)i[s++]=arguments[s];return process.nextTick(function(){e.apply(null,i)})}}}:e.exports=process},function(e,t,n){var r=n(55),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=o),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},function(e,t){e.exports=require("url")},function(e,t,n){"use strict";var r=n(11),i=n(32),s=n(33),o=n(34);s=n(33);function a(e,t,n,r,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=r,this.compressedContent=i}a.prototype={getContentWorker:function(){var e=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,n){return e.pipe(new o).pipe(new s("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},e.exports=a},function(e,t,n){"use strict";var r=n(0);var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t){return void 0!==e&&e.length?"string"!==r.getTypeOf(e)?function(e,t,n,r){var s=i,o=r+n;e^=-1;for(var a=r;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,n,r){var s=i,o=r+n;e^=-1;for(var a=r;a<o;a++)e=e>>>8^s[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t){e.exports=require("http")},function(e,t,n){var r=n(2);"disable"===process.env.READABLE_STREAM&&r?(e.exports=r,(t=e.exports=r.Readable).Readable=r.Readable,t.Writable=r.Writable,t.Duplex=r.Duplex,t.Transform=r.Transform,t.PassThrough=r.PassThrough,t.Stream=r):((t=e.exports=n(23)).Stream=r||t,t.Readable=t,t.Writable=n(26),t.Duplex=n(7),t.Transform=n(28),t.PassThrough=n(59))},function(e,t,n){"use strict";var r=n(13);e.exports=_;var i,s=n(53);_.ReadableState=y;n(54).EventEmitter;var o=function(e,t){return e.listeners(t).length},a=n(24),c=n(14).Buffer,l=global.Uint8Array||function(){};var h=n(9);h.inherits=n(10);var u=n(15),d=void 0;d=u&&u.debuglog?u.debuglog("stream"):function(){};var p,f=n(57),m=n(25);h.inherits(_,a);var g=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var r=t instanceof(i=i||n(7));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var s=e.highWaterMark,o=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:r&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(27).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function _(e){if(i=i||n(7),!(this instanceof _))return new _(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function v(e,t,n,r,i){var s,o=e._readableState;null===t?(o.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,C(e)}(e,o)):(i||(s=function(e,t){var n;r=t,c.isBuffer(r)||r instanceof l||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(o,t)),s?e.emit("error",s):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?w(e,o,t,!1):x(e,o)):w(e,o,t,!1))):r||(o.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function w(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&C(e)),x(e,t)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=m.destroy,_.prototype._undestroy=m.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),n=!0),v(this,e,t,!1,n)},_.prototype.unshift=function(e){return v(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return p||(p=n(27).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var b=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=b?e=b:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function C(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(k,e):k(e))}function k(e){d("emit readable"),e.emit("readable"),R(e)}function x(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(T,e,t))}function T(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(d("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function E(e){d("readable nexttick read 0"),e.read(0)}function I(e,t){t.reading||(d("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),R(e),t.flowing&&!t.reading&&e.read(0)}function R(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function A(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;e-=i.length;for(;n=n.next;){var s=n.data,o=e>s.length?s.length:e;if(o===s.length?i+=s:i+=s.slice(0,e),0===(e-=o)){o===s.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=c.allocUnsafe(e),r=t.head,i=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var s=r.data,o=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,o),0===(e-=o)){o===s.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(o));break}++i}return t.length-=i,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function $(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(P,t,e))}function P(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function M(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}_.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?$(this):C(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&$(this),null;var r,i=t.needReadable;return d("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",i=!0),t.ended||t.reading?d("reading or ended",i=!1):i&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(n,t))),null===(r=e>0?A(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&$(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,d("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?l:_;function c(t,r){d("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,d("cleanup"),e.removeListener("close",g),e.removeListener("finish",y),e.removeListener("drain",h),e.removeListener("error",m),e.removeListener("unpipe",c),n.removeListener("end",l),n.removeListener("end",_),n.removeListener("data",f),u=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function l(){d("onend"),e.end()}i.endEmitted?r.nextTick(a):n.once("end",a),e.on("unpipe",c);var h=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,R(e))}}(n);e.on("drain",h);var u=!1;var p=!1;function f(t){d("ondata"),p=!1,!1!==e.write(t)||p||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==M(i.pipes,e))&&!u&&(d("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function m(t){d("onerror",t),_(),e.removeListener("error",m),0===o(e,"error")&&e.emit("error",t)}function g(){e.removeListener("finish",y),_()}function y(){d("onfinish"),e.removeListener("close",g),_()}function _(){d("unpipe"),n.unpipe(e)}return n.on("data",f),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",m),e.once("close",g),e.once("finish",y),e.emit("pipe",n),i.flowing||(d("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)r[s].emit("unpipe",this,n);return this}var o=M(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},_.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&C(this):r.nextTick(E,this))}return n},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(I,e,t))}(this,e)),this},_.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(d("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){(d("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<g.length;s++)e.on(g[s],this.emit.bind(this,g[s]));return this._read=function(t){d("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=A},function(e,t,n){e.exports=n(2)},function(e,t,n){"use strict";var r=n(13);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";var r=n(13);function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=g;var s,o=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:r.nextTick;g.WritableState=m;var a=n(9);a.inherits=n(10);var c={deprecate:n(58)},l=n(24),h=n(14).Buffer,u=global.Uint8Array||function(){};var d,p=n(25);function f(){}function m(e,t){s=s||n(7),e=e||{};var a=t instanceof s;this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var c=e.highWaterMark,l=e.writableHighWaterMark,h=this.objectMode?16:16384;this.highWaterMark=c||0===c?c:a&&(l||0===l)?l:h,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,s=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,s){--t.pendingcb,n?(r.nextTick(s,i),r.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(s(i),e._writableState.errorEmitted=!0,e.emit("error",i),S(e,t))}(e,n,i,t,s);else{var a=w(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||v(e,n),i?o(_,e,n,a,s):_(e,n,a,s)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function g(e){if(s=s||n(7),!(d.call(g,this)||this instanceof s))return new g(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function y(e,t,n,r,i,s,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function _(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),S(e,t)}function v(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,s=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)s[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;s.allBuffers=c,y(e,t,!0,t.length,s,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,h=n.encoding,u=n.callback;if(y(e,t,!1,t.objectMode?1:l.length,l,h,u),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function w(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)})}function S(e,t){var n=w(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,r.nextTick(b,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}a.inherits(g,l),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:c.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(e){return!!d.call(this,e)||this===g&&(e&&e._writableState instanceof m)}})):d=function(e){return e instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(e,t,n){var i,s=this._writableState,o=!1,a=!s.objectMode&&(i=e,h.isBuffer(i)||i instanceof u);return a&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof n&&(n=f),s.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),r.nextTick(t,n)}(this,n):(a||function(e,t,n,i){var s=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),r.nextTick(i,o),s=!1),s}(this,s,e,n))&&(s.pendingcb++,o=function(e,t,n,r,i,s){if(!n){var o=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,n));return t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:s,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else y(e,t,!1,a,r,i,s);return c}(this,s,a,e,t,n)),o},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||v(this,e))},g.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n)},Object.defineProperty(g.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),g.prototype.destroy=p.destroy,g.prototype._undestroy=p.undestroy,g.prototype._destroy=function(e,t){this.end(),t(e)}},function(e,t,n){"use strict";var r=n(14).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=h,this.end=u,t=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function h(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},s.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=o(t[r]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if((i=o(t[r]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if((i=o(t[r]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=o;var r=n(7),i=n(9);function s(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){c(e,t,n)}):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(10),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){"use strict";var r=n(0),i=n(3),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.encode=function(e){for(var t,n,i,o,a,c,l,h=[],u=0,d=e.length,p=d,f="string"!==r.getTypeOf(e);u<e.length;)p=d-u,f?(t=e[u++],n=u<d?e[u++]:0,i=u<d?e[u++]:0):(t=e.charCodeAt(u++),n=u<d?e.charCodeAt(u++):0,i=u<d?e.charCodeAt(u++):0),o=t>>2,a=(3&t)<<4|n>>4,c=p>1?(15&n)<<2|i>>6:64,l=p>2?63&i:64,h.push(s.charAt(o)+s.charAt(a)+s.charAt(c)+s.charAt(l));return h.join("")},t.decode=function(e){var t,n,r,o,a,c,l=0,h=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var u,d=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&d--,e.charAt(e.length-2)===s.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(u=i.uint8array?new Uint8Array(0|d):new Array(0|d);l<e.length;)t=s.indexOf(e.charAt(l++))<<2|(o=s.indexOf(e.charAt(l++)))>>4,n=(15&o)<<4|(a=s.indexOf(e.charAt(l++)))>>2,r=(3&a)<<6|(c=s.indexOf(e.charAt(l++))),u[h++]=t,64!==a&&(u[h++]=n),64!==c&&(u[h++]=r);return u}},function(e,t,n){"use strict";var r=n(0),i=n(63),s=n(1),o=n(29),a=n(3),c=n(11),l=null;if(a.nodestream)try{l=n(64)}catch(e){}function h(e,t){return new c.Promise(function(n,i){var s=[],a=e._internalType,c=e._outputType,l=e._mimeType;e.on("data",function(e,n){s.push(e),t&&t(n)}).on("error",function(e){s=[],i(e)}).on("end",function(){try{var e=function(e,t,n){switch(e){case"blob":return r.newBlob(r.transformTo("arraybuffer",t),n);case"base64":return o.encode(t);default:return r.transformTo(e,t)}}(c,function(e,t){var n,r=0,i=null,s=0;for(n=0;n<t.length;n++)s+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(s),n=0;n<t.length;n++)i.set(t[n],r),r+=t[n].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(a,s),l);n(e)}catch(e){i(e)}s=[]}).resume()})}function u(e,t,n){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=n,r.checkSupport(o),this._worker=e.pipe(new i(o)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return h(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,function(e){t.call(n,e.data,e.meta)}):this._worker.on(e,function(){r.delay(t,arguments,n)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(r.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},e)}},e.exports=u},function(e,t,n){"use strict";t.base64=!1,t.binary=!1,t.dir=!1,t.createFolders=!0,t.date=null,t.compression=null,t.compressionOptions=null,t.comment=null,t.unixPermissions=null,t.dosPermissions=null},function(e,t,n){"use strict";var r=n(0),i=n(1);function s(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}r.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},function(e,t,n){"use strict";var r=n(0),i=n(1);function s(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}r.inherits(s,i),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},e.exports=s},function(e,t,n){"use strict";var r=n(1),i=n(19);function s(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n(0).inherits(s,r),s.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},e.exports=s},function(e,t,n){"use strict";var r=n(1);t.STORE={magic:"\0\0",compressWorker:function(e){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},t.DEFLATE=n(67)},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,s=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{s=s+(i=i+t[r++]|0)|0}while(--o);i%=65521,s%=65521}return i|s<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var s=r,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},function(e,t,n){"use strict";var r=n(4),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var o=new r.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,t.string2buf=function(e){var t,n,i,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(c),o=0,s=0;o<c;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,s,a=t||e.length,l=new Array(2*a);for(r=0,n=0;n<a;)if((i=e[n++])<128)l[r++]=i;else if((s=o[i])>4)l[r++]=65533,n+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&n<a;)i=i<<6|63&e[n++],s--;s>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return c(l,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+o[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";t.LOCAL_FILE_HEADER="PK",t.CENTRAL_FILE_HEADER="PK",t.CENTRAL_DIRECTORY_END="PK",t.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",t.ZIP64_CENTRAL_DIRECTORY_END="PK",t.DATA_DESCRIPTOR="PK\b"},function(e,t,n){"use strict";var r=n(0),i=n(3),s=n(43),o=n(81),a=n(82),c=n(45);e.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new a(e):i.uint8array?new c(r.transformTo("uint8array",e)):new s(r.transformTo("array",e)):new o(e)}},function(e,t,n){"use strict";var r=n(44);function i(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}n(0).inherits(i,r),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;s>=0;--s)if(this.data[s]===t&&this.data[s+1]===n&&this.data[s+2]===r&&this.data[s+3]===i)return s-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&n===s[1]&&r===s[2]&&i===s[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(0);function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},e.exports=i},function(e,t,n){"use strict";var r=n(43);function i(e){r.call(this,e)}n(0).inherits(i,r),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("vm")},function(e,t){function n(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}e.exports=function(e,t){t||(t={});var r={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(r.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?r.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(e){r.bools[e]=!0});var i={};Object.keys(t.alias||{}).forEach(function(e){i[e]=[].concat(t.alias[e]),i[e].forEach(function(t){i[t]=[e].concat(i[e].filter(function(e){return t!==e}))})}),[].concat(t.string).filter(Boolean).forEach(function(e){r.strings[e]=!0,i[e]&&(r.strings[i[e]]=!0)});var s=t.default||{},o={_:[]};Object.keys(r.bools).forEach(function(e){c(e,void 0!==s[e]&&s[e])});var a=[];function c(e,t,s){if(!s||!r.unknownFn||function(e,t){return r.allBools&&/^--[^=]+$/.test(t)||r.strings[e]||r.bools[e]||i[e]}(e,s)||!1!==r.unknownFn(s)){var a=!r.strings[e]&&n(t)?Number(t):t;l(o,e.split("."),a),(i[e]||[]).forEach(function(e){l(o,e.split("."),a)})}}function l(e,t,n){var i=e;t.slice(0,-1).forEach(function(e){void 0===i[e]&&(i[e]={}),i=i[e]});var s=t[t.length-1];void 0===i[s]||r.bools[s]||"boolean"==typeof i[s]?i[s]=n:Array.isArray(i[s])?i[s].push(n):i[s]=[i[s],n]}function h(e){return i[e].some(function(e){return r.bools[e]})}-1!==e.indexOf("--")&&(a=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var u=0;u<e.length;u++){var d=e[u];if(/^--.+=/.test(d)){var p=d.match(/^--([^=]+)=([\s\S]*)$/),f=p[1],m=p[2];r.bools[f]&&(m="false"!==m),c(f,m,d)}else if(/^--no-.+/.test(d)){c(f=d.match(/^--no-(.+)/)[1],!1,d)}else if(/^--.+/.test(d)){f=d.match(/^--(.+)/)[1];void 0===(v=e[u+1])||/^-/.test(v)||r.bools[f]||r.allBools||i[f]&&h(f)?/^(true|false)$/.test(v)?(c(f,"true"===v,d),u++):c(f,!r.strings[f]||"",d):(c(f,v,d),u++)}else if(/^-[^-]+/.test(d)){for(var g=d.slice(1,-1).split(""),y=!1,_=0;_<g.length;_++){var v;if("-"!==(v=d.slice(_+2))){if(/[A-Za-z]/.test(g[_])&&/=/.test(v)){c(g[_],v.split("=")[1],d),y=!0;break}if(/[A-Za-z]/.test(g[_])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(v)){c(g[_],v,d),y=!0;break}if(g[_+1]&&g[_+1].match(/\W/)){c(g[_],d.slice(_+2),d),y=!0;break}c(g[_],!r.strings[g[_]]||"",d)}else c(g[_],v,d)}f=d.slice(-1)[0];y||"-"===f||(!e[u+1]||/^(-|--)[^-]/.test(e[u+1])||r.bools[f]||i[f]&&h(f)?e[u+1]&&/true|false/.test(e[u+1])?(c(f,"true"===e[u+1],d),u++):c(f,!r.strings[f]||"",d):(c(f,e[u+1],d),u++))}else if(r.unknownFn&&!1===r.unknownFn(d)||o._.push(r.strings._||!n(d)?d:Number(d)),t.stopEarly){o._.push.apply(o._,e.slice(u+1));break}}return Object.keys(s).forEach(function(e){var t,n,r;t=o,n=e.split("."),r=t,n.slice(0,-1).forEach(function(e){r=r[e]||{}}),n[n.length-1]in r||(l(o,e.split("."),s[e]),(i[e]||[]).forEach(function(t){l(o,t.split("."),s[e])}))}),t["--"]?(o["--"]=new Array,a.forEach(function(e){o["--"].push(e)})):a.forEach(function(e){o._.push(e)}),o}},function(e,t,n){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}r.prototype=n(52),r.prototype.loadAsync=n(79),r.support=n(3),r.defaults=n(31),r.version="3.2.0",r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=n(11),e.exports=r},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var r=n(6),i=n(0),s=n(1),o=n(30),a=n(31),c=n(18),l=n(65),h=n(66),u=n(16),d=n(78),p=function(e,t,n){var r,o=i.getTypeOf(t),h=i.extend(n||{},a);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(e=m(e)),h.createFolders&&(r=f(e))&&g.call(this,r,!0);var p="string"===o&&!1===h.binary&&!1===h.base64;n&&void 0!==n.binary||(h.binary=!p),(t instanceof c&&0===t.uncompressedSize||h.dir||!t||0===t.length)&&(h.base64=!1,h.binary=!0,t="",h.compression="STORE",o="string");var y=null;y=t instanceof c||t instanceof s?t:u.isNode&&u.isStream(t)?new d(e,t):i.prepareContent(e,t,h.binary,h.optimizedBinaryString,h.base64);var _=new l(e,y,h);this.files[e]=_},f=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:a.createFolders,e=m(e),this.files[e]||p.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function y(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,r))},filter:function(e){var t=[];return this.forEach(function(n,r){e(n,r)&&t.push(r)}),t},file:function(e,t,n){if(1===arguments.length){if(y(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}var i=this.files[this.root+e];return i&&!i.dir?i:null}return e=this.root+e,p.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(y(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=g.call(this,t),r=this.clone();return r.root=n.name,r},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=i.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var a=n.comment||this.comment||"";t=h.generateWorker(this,n,a)}catch(e){(t=new s("error")).error(e)}return new o(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};e.exports=_},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("buffer")},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var r=n(14).Buffer,i=n(15);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i,s=r.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=s,i=a,t.copy(n,i),a+=o.data.length,o=o.next;return s},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t,n){e.exports=n(15).deprecate},function(e,t,n){"use strict";e.exports=s;var r=n(28),i=n(9);function s(e){if(!(this instanceof s))return new s(e);r.call(this,e)}i.inherits=n(10),i.inherits(s,r),s.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},function(e,t,n){"use strict";var r=n(62);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];if(!process.browser)var l=["UNHANDLED"];function h(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,process.browser||(this.handled=l),e!==i&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r(function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)})}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}var o=m(function(){t(i,r)});"error"===o.status&&r(o.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=h,h.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})},h.prototype.catch=function(e){return this.then(null,e)},h.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);(process.browser||this.handled===l&&(this.handled=null),this.state!==c)?d(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t));return n},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=m(p,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t,process.browser||e.handled===l&&r(function(){e.handled===l&&process.emit("unhandledRejection",t,e)});for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},h.resolve=function(e){if(e instanceof this)return e;return s.resolve(new this(i),e)},h.reject=function(e){var t=new this(i);return s.reject(t,e)},h.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=new Array(n),a=0,c=-1,l=new this(i);for(;++c<n;)h(e[c],c);return l;function h(e,i){t.resolve(e).then(function(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(l,o))},function(e){r||(r=!0,s.reject(l,e))})}},h.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=-1,a=new this(i);for(;++o<n;)c=e[o],t.resolve(c).then(function(e){r||(r=!0,s.resolve(a,e))},function(e){r||(r=!0,s.reject(a,e))});var c;return a}},function(e,t,n){"use strict";var r,i,s=global.MutationObserver||global.WebKitMutationObserver;if(process.browser)if(s){var o=0,a=new s(u),c=global.document.createTextNode("");a.observe(c,{characterData:!0}),r=function(){c.data=o=++o%2}}else if(global.setImmediate||void 0===global.MessageChannel)r="document"in global&&"onreadystatechange"in global.document.createElement("script")?function(){var e=global.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},global.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new global.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}else r=function(){process.nextTick(u)};var h=[];function u(){var e,t;i=!0;for(var n=h.length;n;){for(t=h,h=[],e=-1;++e<n;)t[e]();n=h.length}i=!1}e.exports=function(e){1!==h.push(e)||i||r()}},function(e,t,n){"use strict";var r=n(1),i=n(0);function s(e){r.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(s,r),s.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},e.exports=s},function(e,t,n){"use strict";var r=n(22).Readable;function i(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",function(e,t){i.push(e)||i._helper.pause(),n&&n(t)}).on("error",function(e){i.emit("error",e)}).on("end",function(){i.push(null)})}n(0).inherits(i,r),i.prototype._read=function(){this._helper.resume()},e.exports=i},function(e,t,n){"use strict";var r=n(30),i=n(32),s=n(6),o=n(18),a=n(1),c=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};c.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!i&&(t=t.pipe(new s.Utf8EncodeWorker)),!o&&i&&(t=t.pipe(new s.Utf8DecodeWorker))}catch(e){(t=new a("error")).error(e)}return new r(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new s.Utf8EncodeWorker)),o.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof a?this._data:new i(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<l.length;u++)c.prototype[l[u]]=h;e.exports=c},function(e,t,n){"use strict";var r=n(35),i=n(77);t.generateWorker=function(e,t,n){var s=new i(t.streamFiles,n,t.platform,t.encodeFileName),o=0;try{e.forEach(function(e,n){o++;var i=function(e,t){var n=e||t,i=r[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(n.options.compression,t.compression),a=n.options.compressionOptions||t.compressionOptions||{},c=n.dir,l=n.date;n._compressWorker(i,a).withStreamInfo("file",{name:e,dir:c,date:l,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(s)}),s.entriesCount=o}catch(e){s.error(e)}return s}},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=n(68),s=n(0),o=n(1),a=r?"uint8array":"array";function c(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}t.magic="\b\0",s.inherits(c,o),c.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(a,e.data),!1)},c.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},t.compressWorker=function(e){return new c("Deflate",e)},t.uncompressWorker=function(){return new c("Inflate",{})}},function(e,t,n){"use strict";var r={};(0,n(4).assign)(r,n(69),n(72),n(40)),e.exports=r},function(e,t,n){"use strict";var r=n(70),i=n(4),s=n(38),o=n(20),a=n(39),c=Object.prototype.toString,l=0,h=-1,u=0,d=8;function p(e){if(!(this instanceof p))return new p(e);this.options=i.assign({level:h,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==l)throw new Error(o[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var f;if(f="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=r.deflateSetDictionary(this.strm,f))!==l)throw new Error(o[n]);this._dict_set=!0}}function f(e,t){var n=new p(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}p.prototype.push=function(e,t){var n,o,a=this.strm,h=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=s.string2buf(e):"[object ArrayBuffer]"===c.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(h),a.next_out=0,a.avail_out=h),1!==(n=r.deflate(a,o))&&n!==l)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(s.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===o?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l):2!==o||(this.onEnd(l),a.avail_out=0,!0)},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=p,t.deflate=f,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,f(e,t)}},function(e,t,n){"use strict";var r,i=n(4),s=n(71),o=n(36),a=n(37),c=n(20),l=0,h=1,u=3,d=4,p=5,f=0,m=1,g=-2,y=-3,_=-5,v=-1,w=1,b=2,S=3,C=4,k=0,x=2,T=8,E=9,I=15,R=8,A=286,$=30,P=19,M=2*A+1,O=15,N=3,B=258,D=B+N+1,j=32,F=42,z=69,H=73,L=91,U=103,q=113,K=666,W=1,V=2,Z=3,J=4,G=3;function Y(e,t){return e.msg=c[t],t}function Q(e){return(e<<1)-(e>4?9:0)}function X(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function re(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t){var n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-D?e.strstart-(e.w_size-D):0,l=e.window,h=e.w_mask,u=e.prev,d=e.strstart+B,p=l[s+o-1],f=l[s+o];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(l[(n=t)+o]===f&&l[n+o-1]===p&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<d);if(r=B-(d-s),s=d-B,r>o){if(e.match_start=t,o=r,r>=a)break;p=l[s+o-1],f=l[s+o]}}}while((t=u[t&h])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead}function se(e){var t,n,r,s,c,l,h,u,d,p,f=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-D)){i.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=f?r-f:0}while(--n);t=n=f;do{r=e.prev[--t],e.prev[t]=r>=f?r-f:0}while(--n);s+=f}if(0===e.strm.avail_in)break;if(l=e.strm,h=e.window,u=e.strstart+e.lookahead,d=s,p=void 0,(p=l.avail_in)>d&&(p=d),n=0===p?0:(l.avail_in-=p,i.arraySet(h,l.input,l.next_in,p,u),1===l.state.wrap?l.adler=o(l.adler,h,p,u):2===l.state.wrap&&(l.adler=a(l.adler,h,p,u)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=N)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+N-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<N)););}while(e.lookahead<D&&0!==e.strm.avail_in)}function oe(e,t){for(var n,r;;){if(e.lookahead<D){if(se(e),e.lookahead<D&&t===l)return W;if(0===e.lookahead)break}if(n=0,e.lookahead>=N&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-D&&(e.match_length=ie(e,n)),e.match_length>=N)if(r=s._tr_tally(e,e.strstart-e.match_start,e.match_length-N),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=N){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(te(e,!1),0===e.strm.avail_out))return W}return e.insert=e.strstart<N-1?e.strstart:N-1,t===d?(te(e,!0),0===e.strm.avail_out?Z:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?W:V}function ae(e,t){for(var n,r,i;;){if(e.lookahead<D){if(se(e),e.lookahead<D&&t===l)return W;if(0===e.lookahead)break}if(n=0,e.lookahead>=N&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=N-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-D&&(e.match_length=ie(e,n),e.match_length<=5&&(e.strategy===w||e.match_length===N&&e.strstart-e.match_start>4096)&&(e.match_length=N-1)),e.prev_length>=N&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-N,r=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-N),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=N-1,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return W}else if(e.match_available){if((r=s._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return W}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<N-1?e.strstart:N-1,t===d?(te(e,!0),0===e.strm.avail_out?Z:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?W:V}function ce(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*M),this.dyn_dtree=new i.Buf16(2*(2*$+1)),this.bl_tree=new i.Buf16(2*(2*P+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(O+1),this.heap=new i.Buf16(2*A+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*A+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function he(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=x,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?F:q,e.adler=2===t.wrap?0:1,t.last_flush=l,s._tr_init(t),f):Y(e,g)}function ue(e){var t,n=he(e);return n===f&&((t=e.state).window_size=2*t.w_size,X(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=N-1,t.match_available=0,t.ins_h=0),n}function de(e,t,n,r,s,o){if(!e)return g;var a=1;if(t===v&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),s<1||s>E||n!==T||r<8||r>15||t<0||t>9||o<0||o>C)return Y(e,g);8===r&&(r=9);var c=new le;return e.state=c,c.strm=e,c.wrap=a,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+N-1)/N),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=o,c.method=n,ue(e)}r=[new ce(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(se(e),0===e.lookahead&&t===l)return W;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,te(e,!1),0===e.strm.avail_out))return W;if(e.strstart-e.block_start>=e.w_size-D&&(te(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Z:J):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),W)}),new ce(4,4,8,4,oe),new ce(4,5,16,8,oe),new ce(4,6,32,32,oe),new ce(4,4,16,16,ae),new ce(8,16,32,32,ae),new ce(8,16,128,128,ae),new ce(8,32,128,256,ae),new ce(32,128,258,1024,ae),new ce(32,258,258,4096,ae)],t.deflateInit=function(e,t){return de(e,t,T,I,R,k)},t.deflateInit2=de,t.deflateReset=ue,t.deflateResetKeep=he,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?g:(e.state.gzhead=t,f):g},t.deflate=function(e,t){var n,i,o,c;if(!e||!e.state||t>p||t<0)return e?Y(e,g):g;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===K&&t!==d)return Y(e,0===e.avail_out?_:g);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===F)if(2===i.wrap)e.adler=0,ne(i,31),ne(i,139),ne(i,8),i.gzhead?(ne(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ne(i,255&i.gzhead.time),ne(i,i.gzhead.time>>8&255),ne(i,i.gzhead.time>>16&255),ne(i,i.gzhead.time>>24&255),ne(i,9===i.level?2:i.strategy>=b||i.level<2?4:0),ne(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(ne(i,255&i.gzhead.extra.length),ne(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=a(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=z):(ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,9===i.level?2:i.strategy>=b||i.level<2?4:0),ne(i,G),i.status=q);else{var y=T+(i.w_bits-8<<4)<<8;y|=(i.strategy>=b||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=j),y+=31-y%31,i.status=q,re(i,y),0!==i.strstart&&(re(i,e.adler>>>16),re(i,65535&e.adler)),e.adler=1}if(i.status===z)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending!==i.pending_buf_size));)ne(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=H)}else i.status=H;if(i.status===H)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,ne(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===c&&(i.gzindex=0,i.status=L)}else i.status=L;if(i.status===L)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,ne(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===c&&(i.status=U)}else i.status=U;if(i.status===U&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(ne(i,255&e.adler),ne(i,e.adler>>8&255),e.adler=0,i.status=q)):i.status=q),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,f}else if(0===e.avail_in&&Q(t)<=Q(n)&&t!==d)return Y(e,_);if(i.status===K&&0!==e.avail_in)return Y(e,_);if(0!==e.avail_in||0!==i.lookahead||t!==l&&i.status!==K){var v=i.strategy===b?function(e,t){for(var n;;){if(0===e.lookahead&&(se(e),0===e.lookahead)){if(t===l)return W;break}if(e.match_length=0,n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Z:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?W:V}(i,t):i.strategy===S?function(e,t){for(var n,r,i,o,a=e.window;;){if(e.lookahead<=B){if(se(e),e.lookahead<=B&&t===l)return W;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=N&&e.strstart>0&&(r=a[i=e.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){o=e.strstart+B;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);e.match_length=B-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=N?(n=s._tr_tally(e,1,e.match_length-N),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Z:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?W:V}(i,t):r[i.level].func(i,t);if(v!==Z&&v!==J||(i.status=K),v===W||v===Z)return 0===e.avail_out&&(i.last_flush=-1),f;if(v===V&&(t===h?s._tr_align(i):t!==p&&(s._tr_stored_block(i,0,0,!1),t===u&&(X(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,f}return t!==d?f:i.wrap<=0?m:(2===i.wrap?(ne(i,255&e.adler),ne(i,e.adler>>8&255),ne(i,e.adler>>16&255),ne(i,e.adler>>24&255),ne(i,255&e.total_in),ne(i,e.total_in>>8&255),ne(i,e.total_in>>16&255),ne(i,e.total_in>>24&255)):(re(i,e.adler>>>16),re(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?f:m)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==F&&t!==z&&t!==H&&t!==L&&t!==U&&t!==q&&t!==K?Y(e,g):(e.state=null,t===q?Y(e,y):f):g},t.deflateSetDictionary=function(e,t){var n,r,s,a,c,l,h,u,d=t.length;if(!e||!e.state)return g;if(2===(a=(n=e.state).wrap)||1===a&&n.status!==F||n.lookahead)return g;for(1===a&&(e.adler=o(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===a&&(X(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new i.Buf8(n.w_size),i.arraySet(u,t,d-n.w_size,n.w_size,0),t=u,d=n.w_size),c=e.avail_in,l=e.next_in,h=e.input,e.avail_in=d,e.next_in=0,e.input=t,se(n);n.lookahead>=N;){r=n.strstart,s=n.lookahead-(N-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+N-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--s);n.strstart=r,n.lookahead=N-1,se(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=N-1,n.match_available=0,e.next_in=l,e.input=h,e.avail_in=c,n.wrap=a,f},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(4),i=4,s=0,o=1,a=2;function c(e){for(var t=e.length;--t>=0;)e[t]=0}var l=0,h=1,u=2,d=29,p=256,f=p+1+d,m=30,g=19,y=2*f+1,_=15,v=16,w=7,b=256,S=16,C=17,k=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],R=new Array(2*(f+2));c(R);var A=new Array(2*m);c(A);var $=new Array(512);c($);var P=new Array(256);c(P);var M=new Array(d);c(M);var O,N,B,D=new Array(m);function j(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function F(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function z(e){return e<256?$[e]:$[256+(e>>>7)]}function H(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function L(e,t,n){e.bi_valid>v-n?(e.bi_buf|=t<<e.bi_valid&65535,H(e,e.bi_buf),e.bi_buf=t>>v-e.bi_valid,e.bi_valid+=n-v):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function U(e,t,n){L(e,n[2*t],n[2*t+1])}function q(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function K(e,t,n){var r,i,s=new Array(_+1),o=0;for(r=1;r<=_;r++)s[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var a=e[2*i+1];0!==a&&(e[2*i]=q(s[a]++,a))}}function W(e){var t;for(t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<g;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*b]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function V(e){e.bi_valid>8?H(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Z(e,t,n,r){var i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]}function J(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&Z(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Z(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function G(e,t,n){var r,i,s,o,a=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],i=e.pending_buf[e.l_buf+a],a++,0===r?U(e,i,t):(U(e,(s=P[i])+p+1,t),0!==(o=x[s])&&L(e,i-=M[s],o),U(e,s=z(--r),n),0!==(o=T[s])&&L(e,r-=D[s],o))}while(a<e.last_lit);U(e,b,t)}function Y(e,t){var n,r,i,s=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=y,n=0;n<c;n++)0!==s[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=o[2*i+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)J(e,s,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],J(e,s,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,s[2*i]=s[2*n]+s[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,s[2*n+1]=s[2*r+1]=i,e.heap[1]=i++,J(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,s,o,a,c=t.dyn_tree,l=t.max_code,h=t.stat_desc.static_tree,u=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(s=0;s<=_;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<y;n++)(s=c[2*c[2*(r=e.heap[n])+1]+1]+1)>f&&(s=f,m++),c[2*r+1]=s,r>l||(e.bl_count[s]++,o=0,r>=p&&(o=d[r-p]),a=c[2*r],e.opt_len+=a*(s+o),u&&(e.static_len+=a*(h[2*r+1]+o)));if(0!==m){do{for(s=f-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(s=f;0!==s;s--)for(r=e.bl_count[s];0!==r;)(i=e.heap[--n])>l||(c[2*i+1]!==s&&(e.opt_len+=(s-c[2*i+1])*c[2*i],c[2*i+1]=s),r--)}}(e,t),K(s,l,e.bl_count)}function Q(e,t,n){var r,i,s=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++a<c&&i===o||(a<l?e.bl_tree[2*i]+=a:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[2*S]++):a<=10?e.bl_tree[2*C]++:e.bl_tree[2*k]++,a=0,s=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4))}function X(e,t,n){var r,i,s=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++a<c&&i===o)){if(a<l)do{U(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==s&&(U(e,i,e.bl_tree),a--),U(e,S,e.bl_tree),L(e,a-3,2)):a<=10?(U(e,C,e.bl_tree),L(e,a-3,3)):(U(e,k,e.bl_tree),L(e,a-11,7));a=0,s=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4)}}c(D);var ee=!1;function te(e,t,n,i){L(e,(l<<1)+(i?1:0),3),function(e,t,n,i){V(e),i&&(H(e,n),H(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(function(){var e,t,n,r,i,s=new Array(_+1);for(n=0,r=0;r<d-1;r++)for(M[r]=n,e=0;e<1<<x[r];e++)P[n++]=r;for(P[n-1]=r,i=0,r=0;r<16;r++)for(D[r]=i,e=0;e<1<<T[r];e++)$[i++]=r;for(i>>=7;r<m;r++)for(D[r]=i<<7,e=0;e<1<<T[r]-7;e++)$[256+i++]=r;for(t=0;t<=_;t++)s[t]=0;for(e=0;e<=143;)R[2*e+1]=8,e++,s[8]++;for(;e<=255;)R[2*e+1]=9,e++,s[9]++;for(;e<=279;)R[2*e+1]=7,e++,s[7]++;for(;e<=287;)R[2*e+1]=8,e++,s[8]++;for(K(R,f+1,s),e=0;e<m;e++)A[2*e+1]=5,A[2*e]=q(e,5);O=new j(R,x,p+1,f,_),N=new j(A,T,0,m,_),B=new j(new Array(0),E,0,g,w)}(),ee=!0),e.l_desc=new F(e.dyn_ltree,O),e.d_desc=new F(e.dyn_dtree,N),e.bl_desc=new F(e.bl_tree,B),e.bi_buf=0,e.bi_valid=0,W(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,r){var c,l,d=0;e.level>0?(e.strm.data_type===a&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return s;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<p;t++)if(0!==e.dyn_ltree[2*t])return o;return s}(e)),Y(e,e.l_desc),Y(e,e.d_desc),d=function(e){var t;for(Q(e,e.dyn_ltree,e.l_desc.max_code),Q(e,e.dyn_dtree,e.d_desc.max_code),Y(e,e.bl_desc),t=g-1;t>=3&&0===e.bl_tree[2*I[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),c=e.opt_len+3+7>>>3,(l=e.static_len+3+7>>>3)<=c&&(c=l)):c=l=n+5,n+4<=c&&-1!==t?te(e,t,n,r):e.strategy===i||l===c?(L(e,(h<<1)+(r?1:0),3),G(e,R,A)):(L(e,(u<<1)+(r?1:0),3),function(e,t,n,r){var i;for(L(e,t-257,5),L(e,n-1,5),L(e,r-4,4),i=0;i<r;i++)L(e,e.bl_tree[2*I[i]+1],3);X(e,e.dyn_ltree,t-1),X(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),G(e,e.dyn_ltree,e.dyn_dtree)),W(e),r&&V(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(P[n]+p+1)]++,e.dyn_dtree[2*z(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){L(e,h<<1,3),U(e,b,R),function(e){16===e.bi_valid?(H(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(73),i=n(4),s=n(38),o=n(40),a=n(20),c=n(39),l=n(76),h=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(a[n]);if(this.header=new l,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=s.string2buf(t.dictionary):"[object ArrayBuffer]"===h.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(a[n])}function d(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}u.prototype.push=function(e,t){var n,a,c,l,u,d=this.strm,p=this.options.chunkSize,f=this.options.dictionary,m=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=s.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(p),d.next_out=0,d.avail_out=p),(n=r.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&f&&(n=r.inflateSetDictionary(this.strm,f)),n===o.Z_BUF_ERROR&&!0===m&&(n=o.Z_OK,m=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==o.Z_STREAM_END&&(0!==d.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(c=s.utf8border(d.output,d.next_out),l=d.next_out-c,u=s.buf2string(d.output,c),d.next_out=l,d.avail_out=p-l,l&&i.arraySet(d.output,d.output,c,l,0),this.onData(u)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=u,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},function(e,t,n){"use strict";var r=n(4),i=n(36),s=n(37),o=n(74),a=n(75),c=0,l=1,h=2,u=4,d=5,p=6,f=0,m=1,g=2,y=-2,_=-3,v=-4,w=-5,b=8,S=1,C=2,k=3,x=4,T=5,E=6,I=7,R=8,A=9,$=10,P=11,M=12,O=13,N=14,B=15,D=16,j=17,F=18,z=19,H=20,L=21,U=22,q=23,K=24,W=25,V=26,Z=27,J=28,G=29,Y=30,Q=31,X=32,ee=852,te=592,ne=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function se(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,f):y}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,se(e)):y}function ae(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?y:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,oe(e))):y}function ce(e,t){var n,r;return e?(r=new ie,e.state=r,r.window=null,(n=ae(e,t))!==f&&(e.state=null),n):y}var le,he,ue=!0;function de(e){if(ue){var t;for(le=new r.Buf32(512),he=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(l,e.lens,0,288,le,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(h,e.lens,0,32,he,0,e.work,{bits:5}),ue=!1}e.lencode=le,e.lenbits=9,e.distcode=he,e.distbits=5}function pe(e,t,n,i){var s,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((s=o.wsize-o.wnext)>i&&(s=i),r.arraySet(o.window,t,n-i,s,o.wnext),(i-=s)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}t.inflateReset=oe,t.inflateReset2=ae,t.inflateResetKeep=se,t.inflateInit=function(e){return ce(e,ne)},t.inflateInit2=ce,t.inflate=function(e,t){var n,ee,te,ne,ie,se,oe,ae,ce,le,he,ue,fe,me,ge,ye,_e,ve,we,be,Se,Ce,ke,xe,Te=0,Ee=new r.Buf8(4),Ie=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return y;(n=e.state).mode===M&&(n.mode=O),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,se=e.avail_in,ae=n.hold,ce=n.bits,le=se,he=oe,Ce=f;e:for(;;)switch(n.mode){case S:if(0===n.wrap){n.mode=O;break}for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(2&n.wrap&&35615===ae){n.check=0,Ee[0]=255&ae,Ee[1]=ae>>>8&255,n.check=s(n.check,Ee,2,0),ae=0,ce=0,n.mode=C;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&ae)<<8)+(ae>>8))%31){e.msg="incorrect header check",n.mode=Y;break}if((15&ae)!==b){e.msg="unknown compression method",n.mode=Y;break}if(ce-=4,Se=8+(15&(ae>>>=4)),0===n.wbits)n.wbits=Se;else if(Se>n.wbits){e.msg="invalid window size",n.mode=Y;break}n.dmax=1<<Se,e.adler=n.check=1,n.mode=512&ae?$:M,ae=0,ce=0;break;case C:for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(n.flags=ae,(255&n.flags)!==b){e.msg="unknown compression method",n.mode=Y;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Y;break}n.head&&(n.head.text=ae>>8&1),512&n.flags&&(Ee[0]=255&ae,Ee[1]=ae>>>8&255,n.check=s(n.check,Ee,2,0)),ae=0,ce=0,n.mode=k;case k:for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.time=ae),512&n.flags&&(Ee[0]=255&ae,Ee[1]=ae>>>8&255,Ee[2]=ae>>>16&255,Ee[3]=ae>>>24&255,n.check=s(n.check,Ee,4,0)),ae=0,ce=0,n.mode=x;case x:for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.xflags=255&ae,n.head.os=ae>>8),512&n.flags&&(Ee[0]=255&ae,Ee[1]=ae>>>8&255,n.check=s(n.check,Ee,2,0)),ae=0,ce=0,n.mode=T;case T:if(1024&n.flags){for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.length=ae,n.head&&(n.head.extra_len=ae),512&n.flags&&(Ee[0]=255&ae,Ee[1]=ae>>>8&255,n.check=s(n.check,Ee,2,0)),ae=0,ce=0}else n.head&&(n.head.extra=null);n.mode=E;case E:if(1024&n.flags&&((ue=n.length)>se&&(ue=se),ue&&(n.head&&(Se=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,ee,ne,ue,Se)),512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,n.length-=ue),n.length))break e;n.length=0,n.mode=I;case I:if(2048&n.flags){if(0===se)break e;ue=0;do{Se=ee[ne+ue++],n.head&&Se&&n.length<65536&&(n.head.name+=String.fromCharCode(Se))}while(Se&&ue<se);if(512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,Se)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=R;case R:if(4096&n.flags){if(0===se)break e;ue=0;do{Se=ee[ne+ue++],n.head&&Se&&n.length<65536&&(n.head.comment+=String.fromCharCode(Se))}while(Se&&ue<se);if(512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,Se)break e}else n.head&&(n.head.comment=null);n.mode=A;case A:if(512&n.flags){for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Y;break}ae=0,ce=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=M;break;case $:for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}e.adler=n.check=re(ae),ae=0,ce=0,n.mode=P;case P:if(0===n.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,g;e.adler=n.check=1,n.mode=M;case M:if(t===d||t===p)break e;case O:if(n.last){ae>>>=7&ce,ce-=7&ce,n.mode=Z;break}for(;ce<3;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}switch(n.last=1&ae,ce-=1,3&(ae>>>=1)){case 0:n.mode=N;break;case 1:if(de(n),n.mode=H,t===p){ae>>>=2,ce-=2;break e}break;case 2:n.mode=j;break;case 3:e.msg="invalid block type",n.mode=Y}ae>>>=2,ce-=2;break;case N:for(ae>>>=7&ce,ce-=7&ce;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if((65535&ae)!=(ae>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Y;break}if(n.length=65535&ae,ae=0,ce=0,n.mode=B,t===p)break e;case B:n.mode=D;case D:if(ue=n.length){if(ue>se&&(ue=se),ue>oe&&(ue=oe),0===ue)break e;r.arraySet(te,ee,ne,ue,ie),se-=ue,ne+=ue,oe-=ue,ie+=ue,n.length-=ue;break}n.mode=M;break;case j:for(;ce<14;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(n.nlen=257+(31&ae),ae>>>=5,ce-=5,n.ndist=1+(31&ae),ae>>>=5,ce-=5,n.ncode=4+(15&ae),ae>>>=4,ce-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Y;break}n.have=0,n.mode=F;case F:for(;n.have<n.ncode;){for(;ce<3;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.lens[Ie[n.have++]]=7&ae,ae>>>=3,ce-=3}for(;n.have<19;)n.lens[Ie[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,ke={bits:n.lenbits},Ce=a(c,n.lens,0,19,n.lencode,0,n.work,ke),n.lenbits=ke.bits,Ce){e.msg="invalid code lengths set",n.mode=Y;break}n.have=0,n.mode=z;case z:for(;n.have<n.nlen+n.ndist;){for(;ye=(Te=n.lencode[ae&(1<<n.lenbits)-1])>>>16&255,_e=65535&Te,!((ge=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(_e<16)ae>>>=ge,ce-=ge,n.lens[n.have++]=_e;else{if(16===_e){for(xe=ge+2;ce<xe;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae>>>=ge,ce-=ge,0===n.have){e.msg="invalid bit length repeat",n.mode=Y;break}Se=n.lens[n.have-1],ue=3+(3&ae),ae>>>=2,ce-=2}else if(17===_e){for(xe=ge+3;ce<xe;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ce-=ge,Se=0,ue=3+(7&(ae>>>=ge)),ae>>>=3,ce-=3}else{for(xe=ge+7;ce<xe;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ce-=ge,Se=0,ue=11+(127&(ae>>>=ge)),ae>>>=7,ce-=7}if(n.have+ue>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Y;break}for(;ue--;)n.lens[n.have++]=Se}}if(n.mode===Y)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Y;break}if(n.lenbits=9,ke={bits:n.lenbits},Ce=a(l,n.lens,0,n.nlen,n.lencode,0,n.work,ke),n.lenbits=ke.bits,Ce){e.msg="invalid literal/lengths set",n.mode=Y;break}if(n.distbits=6,n.distcode=n.distdyn,ke={bits:n.distbits},Ce=a(h,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,ke),n.distbits=ke.bits,Ce){e.msg="invalid distances set",n.mode=Y;break}if(n.mode=H,t===p)break e;case H:n.mode=L;case L:if(se>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,o(e,he),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,se=e.avail_in,ae=n.hold,ce=n.bits,n.mode===M&&(n.back=-1);break}for(n.back=0;ye=(Te=n.lencode[ae&(1<<n.lenbits)-1])>>>16&255,_e=65535&Te,!((ge=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ye&&0==(240&ye)){for(ve=ge,we=ye,be=_e;ye=(Te=n.lencode[be+((ae&(1<<ve+we)-1)>>ve)])>>>16&255,_e=65535&Te,!(ve+(ge=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ae>>>=ve,ce-=ve,n.back+=ve}if(ae>>>=ge,ce-=ge,n.back+=ge,n.length=_e,0===ye){n.mode=V;break}if(32&ye){n.back=-1,n.mode=M;break}if(64&ye){e.msg="invalid literal/length code",n.mode=Y;break}n.extra=15&ye,n.mode=U;case U:if(n.extra){for(xe=n.extra;ce<xe;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.length+=ae&(1<<n.extra)-1,ae>>>=n.extra,ce-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=q;case q:for(;ye=(Te=n.distcode[ae&(1<<n.distbits)-1])>>>16&255,_e=65535&Te,!((ge=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(0==(240&ye)){for(ve=ge,we=ye,be=_e;ye=(Te=n.distcode[be+((ae&(1<<ve+we)-1)>>ve)])>>>16&255,_e=65535&Te,!(ve+(ge=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ae>>>=ve,ce-=ve,n.back+=ve}if(ae>>>=ge,ce-=ge,n.back+=ge,64&ye){e.msg="invalid distance code",n.mode=Y;break}n.offset=_e,n.extra=15&ye,n.mode=K;case K:if(n.extra){for(xe=n.extra;ce<xe;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.offset+=ae&(1<<n.extra)-1,ae>>>=n.extra,ce-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Y;break}n.mode=W;case W:if(0===oe)break e;if(ue=he-oe,n.offset>ue){if((ue=n.offset-ue)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Y;break}ue>n.wnext?(ue-=n.wnext,fe=n.wsize-ue):fe=n.wnext-ue,ue>n.length&&(ue=n.length),me=n.window}else me=te,fe=ie-n.offset,ue=n.length;ue>oe&&(ue=oe),oe-=ue,n.length-=ue;do{te[ie++]=me[fe++]}while(--ue);0===n.length&&(n.mode=L);break;case V:if(0===oe)break e;te[ie++]=n.length,oe--,n.mode=L;break;case Z:if(n.wrap){for(;ce<32;){if(0===se)break e;se--,ae|=ee[ne++]<<ce,ce+=8}if(he-=oe,e.total_out+=he,n.total+=he,he&&(e.adler=n.check=n.flags?s(n.check,te,he,ie-he):i(n.check,te,he,ie-he)),he=oe,(n.flags?ae:re(ae))!==n.check){e.msg="incorrect data check",n.mode=Y;break}ae=0,ce=0}n.mode=J;case J:if(n.wrap&&n.flags){for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Y;break}ae=0,ce=0}n.mode=G;case G:Ce=m;break e;case Y:Ce=_;break e;case Q:return v;case X:default:return y}return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,(n.wsize||he!==e.avail_out&&n.mode<Y&&(n.mode<Z||t!==u))&&pe(e,e.output,e.next_out,he-e.avail_out)?(n.mode=Q,v):(le-=e.avail_in,he-=e.avail_out,e.total_in+=le,e.total_out+=he,n.total+=he,n.wrap&&he&&(e.adler=n.check=n.flags?s(n.check,te,he,e.next_out-he):i(n.check,te,he,e.next_out-he)),e.data_type=n.bits+(n.last?64:0)+(n.mode===M?128:0)+(n.mode===H||n.mode===B?256:0),(0===le&&0===he||t===u)&&Ce===f&&(Ce=w),Ce)},t.inflateEnd=function(e){if(!e||!e.state)return y;var t=e.state;return t.window&&(t.window=null),e.state=null,f},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?y:(n.head=t,t.done=!1,f):y},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==P?y:n.mode===P&&i(1,t,r,0)!==n.check?_:pe(e,t,r,r)?(n.mode=Q,v):(n.havedict=1,f):y},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,s,o,a,c,l,h,u,d,p,f,m,g,y,_,v,w,b,S,C,k,x,T;n=e.state,r=e.next_in,x=e.input,i=r+(e.avail_in-5),s=e.next_out,T=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),c=n.dmax,l=n.wsize,h=n.whave,u=n.wnext,d=n.window,p=n.hold,f=n.bits,m=n.lencode,g=n.distcode,y=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{f<15&&(p+=x[r++]<<f,f+=8,p+=x[r++]<<f,f+=8),v=m[p&y];t:for(;;){if(p>>>=w=v>>>24,f-=w,0===(w=v>>>16&255))T[s++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=m[(65535&v)+(p&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}b=65535&v,(w&=15)&&(f<w&&(p+=x[r++]<<f,f+=8),b+=p&(1<<w)-1,p>>>=w,f-=w),f<15&&(p+=x[r++]<<f,f+=8,p+=x[r++]<<f,f+=8),v=g[p&_];n:for(;;){if(p>>>=w=v>>>24,f-=w,!(16&(w=v>>>16&255))){if(0==(64&w)){v=g[(65535&v)+(p&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(S=65535&v,f<(w&=15)&&(p+=x[r++]<<f,(f+=8)<w&&(p+=x[r++]<<f,f+=8)),(S+=p&(1<<w)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=w,f-=w,S>(w=s-o)){if((w=S-w)>h&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,k=d,0===u){if(C+=l-w,w<b){b-=w;do{T[s++]=d[C++]}while(--w);C=s-S,k=T}}else if(u<w){if(C+=l+u-w,(w-=u)<b){b-=w;do{T[s++]=d[C++]}while(--w);if(C=0,u<b){b-=w=u;do{T[s++]=d[C++]}while(--w);C=s-S,k=T}}}else if(C+=u-w,w<b){b-=w;do{T[s++]=d[C++]}while(--w);C=s-S,k=T}for(;b>2;)T[s++]=k[C++],T[s++]=k[C++],T[s++]=k[C++],b-=3;b&&(T[s++]=k[C++],b>1&&(T[s++]=k[C++]))}else{C=s-S;do{T[s++]=T[C++],T[s++]=T[C++],T[s++]=T[C++],b-=3}while(b>2);b&&(T[s++]=T[C++],b>1&&(T[s++]=T[C++]))}break}}break}}while(r<i&&s<a);r-=b=f>>3,p&=(1<<(f-=b<<3))-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=s<a?a-s+257:257-(s-a),n.hold=p,n.bits=f}},function(e,t,n){"use strict";var r=n(4),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,h,u,d){var p,f,m,g,y,_,v,w,b,S=d.bits,C=0,k=0,x=0,T=0,E=0,I=0,R=0,A=0,$=0,P=0,M=null,O=0,N=new r.Buf16(16),B=new r.Buf16(16),D=null,j=0;for(C=0;C<=15;C++)N[C]=0;for(k=0;k<c;k++)N[t[n+k]]++;for(E=S,T=15;T>=1&&0===N[T];T--);if(E>T&&(E=T),0===T)return l[h++]=20971520,l[h++]=20971520,d.bits=1,0;for(x=1;x<T&&0===N[x];x++);for(E<x&&(E=x),A=1,C=1;C<=15;C++)if(A<<=1,(A-=N[C])<0)return-1;if(A>0&&(0===e||1!==T))return-1;for(B[1]=0,C=1;C<15;C++)B[C+1]=B[C]+N[C];for(k=0;k<c;k++)0!==t[n+k]&&(u[B[t[n+k]]++]=k);if(0===e?(M=D=u,_=19):1===e?(M=i,O-=257,D=s,j-=257,_=256):(M=o,D=a,_=-1),P=0,k=0,C=x,y=h,I=E,R=0,m=-1,g=($=1<<E)-1,1===e&&$>852||2===e&&$>592)return 1;for(;;){v=C-R,u[k]<_?(w=0,b=u[k]):u[k]>_?(w=D[j+u[k]],b=M[O+u[k]]):(w=96,b=0),p=1<<C-R,x=f=1<<I;do{l[y+(P>>R)+(f-=p)]=v<<24|w<<16|b|0}while(0!==f);for(p=1<<C-1;P&p;)p>>=1;if(0!==p?(P&=p-1,P+=p):P=0,k++,0==--N[C]){if(C===T)break;C=t[n+u[k]]}if(C>E&&(P&g)!==m){for(0===R&&(R=E),y+=x,A=1<<(I=C-R);I+R<T&&!((A-=N[I+R])<=0);)I++,A<<=1;if($+=1<<I,1===e&&$>852||2===e&&$>592)return 1;l[m=P&g]=E<<24|I<<16|y-h|0}}return 0!==P&&(l[y+P]=C-R<<24|64<<16|0),d.bits=E,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";var r=n(0),i=n(1),s=n(6),o=n(19),a=n(41),c=function(e,t){var n,r="";for(n=0;n<t;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},l=function(e,t,n,i,l,h){var u,d,p=e.file,f=e.compression,m=h!==s.utf8encode,g=r.transformTo("string",h(p.name)),y=r.transformTo("string",s.utf8encode(p.name)),_=p.comment,v=r.transformTo("string",h(_)),w=r.transformTo("string",s.utf8encode(_)),b=y.length!==p.name.length,S=w.length!==_.length,C="",k="",x="",T=p.dir,E=p.date,I={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(I.crc32=e.crc32,I.compressedSize=e.compressedSize,I.uncompressedSize=e.uncompressedSize);var R=0;t&&(R|=8),m||!b&&!S||(R|=2048);var A,$,P,M=0,O=0;T&&(M|=16),"UNIX"===l?(O=798,M|=(A=p.unixPermissions,$=T,P=A,A||(P=$?16893:33204),(65535&P)<<16)):(O=20,M|=63&(p.dosPermissions||0)),u=E.getUTCHours(),u<<=6,u|=E.getUTCMinutes(),u<<=5,u|=E.getUTCSeconds()/2,d=E.getUTCFullYear()-1980,d<<=4,d|=E.getUTCMonth()+1,d<<=5,d|=E.getUTCDate(),b&&(k=c(1,1)+c(o(g),4)+y,C+="up"+c(k.length,2)+k),S&&(x=c(1,1)+c(o(v),4)+w,C+="uc"+c(x.length,2)+x);var N="";return N+="\n\0",N+=c(R,2),N+=f.magic,N+=c(u,2),N+=c(d,2),N+=c(I.crc32,4),N+=c(I.compressedSize,4),N+=c(I.uncompressedSize,4),N+=c(g.length,2),N+=c(C.length,2),{fileRecord:a.LOCAL_FILE_HEADER+N+g+C,dirRecord:a.CENTRAL_FILE_HEADER+c(O,2)+N+c(v.length,2)+"\0\0\0\0"+c(M,4)+c(i,4)+g+C+v}},h=function(e){return a.DATA_DESCRIPTOR+c(e.crc32,4)+c(e.compressedSize,4)+c(e.uncompressedSize,4)};function u(e,t,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(u,i),u.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-r-1))/n:100}}))},u.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=l(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=l(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:h(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,i=function(e,t,n,i,s){var o=r.transformTo("string",s(i));return a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(e,2)+c(e,2)+c(t,4)+c(n,4)+c(o.length,2)+o}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},u.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},u.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},e.exports=u},function(e,t,n){"use strict";var r=n(0),i=n(1);function s(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}r.inherits(s,i),s.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},function(e,t,n){"use strict";var r=n(0),i=n(11),s=n(6),o=(r=n(0),n(80)),a=n(34),c=n(16);function l(e){return new i.Promise(function(t,n){var r=e.decompressed.getContentWorker().pipe(new a);r.on("error",function(e){n(e)}).on("end",function(){r.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}e.exports=function(e,t){var n=this;return t=r.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),c.isNode&&c.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(e){var n=new o(t);return n.load(e),n}).then(function(e){var n=[i.Promise.resolve(e)],r=e.files;if(t.checkCRC32)for(var s=0;s<r.length;s++)n.push(l(r[s]));return i.Promise.all(n)}).then(function(e){for(var r=e.shift(),i=r.files,s=0;s<i.length;s++){var o=i[s];n.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n})}},function(e,t,n){"use strict";var r=n(42),i=n(0),s=n(41),o=n(83),a=(n(6),n(3));function c(e){this.files=[],this.loadOptions=e}c.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4)===t;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",n=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=t-n;if(r>0)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=c},function(e,t,n){"use strict";var r=n(44);function i(e){r.call(this,e)}n(0).inherits(i,r),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(45);function i(e){r.call(this,e)}n(0).inherits(i,r),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(42),i=n(0),s=n(18),o=n(19),a=n(6),c=n(35),l=n(3);function h(e,t){this.options=e,this.loadOptions=t}h.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in c)if(c.hasOwnProperty(t)&&c[t].magic===e)return c[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<i;)t=e.readInt(2),n=e.readInt(2),r=e.readData(n),this.extraFields[t]={id:t,length:n,value:r}},handleUTF8:function(){var e=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var s=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:o(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:o(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},e.exports=h},function(e,t,n){"use strict";n.r(t);var r=n(48),i=n.n(r),s=n(5),o=n.n(s),a=n(12),c=n.n(a),l=n(49),h=n.n(l),u=n(46),d=n.n(u),p=n(2),f=n(21),m=n(17),g=n(50),y=n(8);const _=Symbol("buffer"),v=Symbol("type");class w{constructor(){this[v]="";const e=arguments[0],t=arguments[1],n=[];if(e){const t=e,r=Number(t.length);for(let e=0;e<r;e++){const r=t[e];let i;i=r instanceof Buffer?r:ArrayBuffer.isView(r)?Buffer.from(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?Buffer.from(r):r instanceof w?r[_]:Buffer.from("string"==typeof r?r:String(r)),n.push(i)}}this[_]=Buffer.concat(n);let r=t&&void 0!==t.type&&String(t.type).toLowerCase();r&&!/[^\u0020-\u007E]/.test(r)&&(this[v]=r)}get size(){return this[_].length}get type(){return this[v]}slice(){const e=this.size,t=arguments[0],n=arguments[1];let r,i;r=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),i=void 0===n?e:n<0?Math.max(e+n,0):Math.min(n,e);const s=Math.max(i-r,0),o=this[_].slice(r,r+s),a=new w([],{type:arguments[2]});return a[_]=o,a}}function b(e,t,n){Error.call(this,e),this.message=e,this.type=t,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let S;Object.defineProperties(w.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(w.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),b.prototype=Object.create(Error.prototype),b.prototype.constructor=b,b.prototype.name="FetchError";try{S=require("encoding").convert}catch(e){}const C=Symbol("Body internals"),k=p.PassThrough;function x(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.size;let i=void 0===r?0:r;var s=n.timeout;let o=void 0===s?0:s;null==e?e=null:"string"==typeof e||E(e)||e instanceof w||Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)||e instanceof p||(e=String(e)),this[C]={body:e,disturbed:!1,error:null},this.size=i,this.timeout=o,e instanceof p&&e.on("error",function(e){const n="AbortError"===e.name?e:new b(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[C].error=n})}function T(){var e=this;if(this[C].disturbed)return x.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[C].disturbed=!0,this[C].error)return x.Promise.reject(this[C].error);if(null===this.body)return x.Promise.resolve(Buffer.alloc(0));if("string"==typeof this.body)return x.Promise.resolve(Buffer.from(this.body));if(this.body instanceof w)return x.Promise.resolve(this.body[_]);if(Buffer.isBuffer(this.body))return x.Promise.resolve(this.body);if("[object ArrayBuffer]"===Object.prototype.toString.call(this.body))return x.Promise.resolve(Buffer.from(this.body));if(ArrayBuffer.isView(this.body))return x.Promise.resolve(Buffer.from(this.body.buffer,this.body.byteOffset,this.body.byteLength));if(!(this.body instanceof p))return x.Promise.resolve(Buffer.alloc(0));let t=[],n=0,r=!1;return new x.Promise(function(i,s){let o;e.timeout&&(o=setTimeout(function(){r=!0,s(new b(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))},e.timeout)),e.body.on("error",function(t){"AbortError"===t.name?(r=!0,s(t)):s(new b(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))}),e.body.on("data",function(i){if(!r&&null!==i){if(e.size&&n+i.length>e.size)return r=!0,void s(new b(`content size at ${e.url} over limit: ${e.size}`,"max-size"));n+=i.length,t.push(i)}}),e.body.on("end",function(){if(!r){clearTimeout(o);try{i(Buffer.concat(t))}catch(t){s(new b(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}})})}function E(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function I(e){let t,n,r=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return r instanceof p&&"function"!=typeof r.getBoundary&&(t=new k,n=new k,r.pipe(t),r.pipe(n),e[C].body=t,r=n),r}function R(e){const t=e.body;return null===t?0:"string"==typeof t?Buffer.byteLength(t):E(t)?Buffer.byteLength(String(t)):t instanceof w?t.size:Buffer.isBuffer(t)?t.length:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?t.byteLength:ArrayBuffer.isView(t)?t.byteLength:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}x.prototype={get body(){return this[C].body},get bodyUsed(){return this[C].disturbed},arrayBuffer(){return T.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob(){let e=this.headers&&this.headers.get("content-type")||"";return T.call(this).then(function(t){return Object.assign(new w([],{type:e.toLowerCase()}),{[_]:t})})},json(){var e=this;return T.call(this).then(function(t){try{return JSON.parse(t.toString())}catch(t){return x.Promise.reject(new b(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}})},text(){return T.call(this).then(function(e){return e.toString()})},buffer(){return T.call(this)},textConverted(){var e=this;return T.call(this).then(function(t){return function(e,t){if("function"!=typeof S)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=t.get("content-type");let r,i,s="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));i=e.slice(0,1024).toString(),!r&&i&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(i));!r&&i&&(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(i))&&(r=/charset=(.*)/i.exec(r.pop()));!r&&i&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(i));r&&("gb2312"!==(s=r.pop())&&"gbk"!==s||(s="gb18030"));return S(e,"UTF-8",s).toString()}(t,e.headers)})}},Object.defineProperties(x.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),x.mixIn=function(e){for(const t of Object.getOwnPropertyNames(x.prototype))if(!(t in e)){const n=Object.getOwnPropertyDescriptor(x.prototype,t);Object.defineProperty(e,t,n)}},x.Promise=global.Promise;const A=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,$=/[^\t\x20-\x7e\x80-\xff]/;function P(e){if(e=`${e}`,A.test(e))throw new TypeError(`${e} is not a legal HTTP header name`)}function M(e){if(e=`${e}`,$.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}function O(e,t){t=t.toLowerCase();for(const n in e)if(n.toLowerCase()===t)return n}const N=Symbol("map");class B{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[N]=Object.create(null),e instanceof B){const t=e.raw(),n=Object.keys(t);for(const e of n)for(const n of t[e])this.append(e,n)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const n=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(t))}for(const e of n){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const n=e[t];this.append(t,n)}}}}get(e){P(e=`${e}`);const t=O(this[N],e);return void 0===t?null:this[N][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=D(this),r=0;for(;r<n.length;){var i=n[r];const s=i[0],o=i[1];e.call(t,o,s,this),n=D(this),r++}}set(e,t){t=`${t}`,P(e=`${e}`),M(t);const n=O(this[N],e);this[N][void 0!==n?n:e]=[t]}append(e,t){t=`${t}`,P(e=`${e}`),M(t);const n=O(this[N],e);void 0!==n?this[N][n].push(t):this[N][e]=[t]}has(e){return P(e=`${e}`),void 0!==O(this[N],e)}delete(e){P(e=`${e}`);const t=O(this[N],e);void 0!==t&&delete this[N][t]}raw(){return this[N]}keys(){return F(this,"key")}values(){return F(this,"value")}[Symbol.iterator](){return F(this,"key+value")}}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(e[N]).sort().map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[N][t].join(", ")}:function(t){return[t.toLowerCase(),e[N][t].join(", ")]})}B.prototype.entries=B.prototype[Symbol.iterator],Object.defineProperty(B.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(B.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const j=Symbol("internal");function F(e,t){const n=Object.create(z);return n[j]={target:e,kind:t,index:0},n}const z=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==z)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[j];const t=e.target,n=e.kind,r=e.index,i=D(t,n);return r>=i.length?{value:void 0,done:!0}:(this[j].index=r+1,{value:i[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function H(e){const t=Object.assign({__proto__:null},e[N]),n=O(e[N],"Host");return void 0!==n&&(t[n]=t[n][0]),t}Object.defineProperty(z,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const L=Symbol("Response internals"),U=f.STATUS_CODES;class q{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x.call(this,e,t);const n=t.status||200;this[L]={url:t.url,status:n,statusText:t.statusText||U[n],headers:new B(t.headers)}}get url(){return this[L].url}get status(){return this[L].status}get ok(){return this[L].status>=200&&this[L].status<300}get statusText(){return this[L].statusText}get headers(){return this[L].headers}clone(){return new q(I(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok})}}x.mixIn(q.prototype),Object.defineProperties(q.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(q.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const K=Symbol("Request internals"),W=m.parse,V=m.format,Z="destroy"in p.Readable.prototype;function J(e){return"object"==typeof e&&"object"==typeof e[K]}class G{constructor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};J(e)?t=W(e.url):(t=e&&e.href?W(e.href):W(`${e}`),e={});let r=n.method||e.method||"GET";if(r=r.toUpperCase(),(null!=n.body||J(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let i=null!=n.body?n.body:J(e)&&null!==e.body?I(e):null;x.call(this,i,{timeout:n.timeout||e.timeout||0,size:n.size||e.size||0});const s=new B(n.headers||e.headers||{});if(null!=n.body){const e=function(e){const t=e.body;return null===t?null:"string"==typeof t?"text/plain;charset=UTF-8":E(t)?"application/x-www-form-urlencoded;charset=UTF-8":t instanceof w?t.type||null:Buffer.isBuffer(t)?null:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?null:ArrayBuffer.isView(t)?null:"function"==typeof t.getBoundary?`multipart/form-data;boundary=${t.getBoundary()}`:null}(this);null===e||s.has("Content-Type")||s.append("Content-Type",e)}let o=J(e)?e.signal:null;if("signal"in n&&(o=n.signal),null!=o&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(o))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[K]={method:r,redirect:n.redirect||e.redirect||"follow",headers:s,parsedURL:t,signal:o},this.follow=void 0!==n.follow?n.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===e.compress||e.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent}get method(){return this[K].method}get url(){return V(this[K].parsedURL)}get headers(){return this[K].headers}get redirect(){return this[K].redirect}get signal(){return this[K].signal}clone(){return new G(this)}}function Y(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}x.mixIn(G.prototype),Object.defineProperty(G.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(G.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),Y.prototype=Object.create(Error.prototype),Y.prototype.constructor=Y,Y.prototype.name="AbortError";const Q=p.PassThrough,X=m.resolve;function ee(e,t){if(!ee.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return x.Promise=ee.Promise,new ee.Promise(function(n,r){const i=new G(e,t),s=function(e){const t=e[K].parsedURL,n=new B(e[K].headers);if(n.has("Accept")||n.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof p.Readable&&!Z)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let r=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(r="0"),null!=e.body){const t=R(e);"number"==typeof t&&(r=String(t))}return r&&n.set("Content-Length",r),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate"),n.has("Connection")||e.agent||n.set("Connection","close"),Object.assign({},t,{method:e.method,headers:H(n),agent:e.agent})}(i),o=("https:"===s.protocol?g:f).request,a=i.signal;let c=null;const l=function(){let e=new Y("The user aborted a request.");r(e),i.body&&i.body instanceof p.Readable&&i.body.destroy(e),c&&c.body&&c.body.emit("error",e)};if(a&&a.aborted)return void l();const h=function(){l(),m()},u=o(s);let d;function m(){u.abort(),a&&a.removeEventListener("abort",h),clearTimeout(d)}a&&a.addEventListener("abort",h),i.timeout&&u.once("socket",function(e){d=setTimeout(function(){r(new b(`network timeout at: ${i.url}`,"request-timeout")),m()},i.timeout)}),u.on("error",function(e){r(new b(`request to ${i.url} failed, reason: ${e.message}`,"system",e)),m()}),u.on("response",function(e){clearTimeout(d);const t=function(e){const t=new B;for(const n of Object.keys(e))if(!A.test(n))if(Array.isArray(e[n]))for(const r of e[n])$.test(r)||(void 0===t[N][n]?t[N][n]=[r]:t[N][n].push(r));else $.test(e[n])||(t[N][n]=[e[n]]);return t}(e.headers);if(ee.isRedirect(e.statusCode)){const s=t.get("Location"),o=null===s?null:X(i.url,s);switch(i.redirect){case"error":return r(new b(`redirect mode is set to error: ${i.url}`,"no-redirect")),void m();case"manual":if(null!==o)try{t.set("Location",o)}catch(e){r(e)}break;case"follow":if(null===o)break;if(i.counter>=i.follow)return r(new b(`maximum redirect reached at: ${i.url}`,"max-redirect")),void m();const s={headers:new B(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:i.body,signal:i.signal};return 303!==e.statusCode&&i.body&&null===R(i)?(r(new b("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void m()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==i.method)||(s.method="GET",s.body=void 0,s.headers.delete("content-length")),n(ee(new G(o,s))),void m())}}e.once("end",function(){a&&a.removeEventListener("abort",h)});let s=e.pipe(new Q);const o={url:i.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:i.size,timeout:i.timeout},l=t.get("Content-Encoding");if(!i.compress||"HEAD"===i.method||null===l||204===e.statusCode||304===e.statusCode)return c=new q(s,o),void n(c);const u={flush:y.Z_SYNC_FLUSH,finishFlush:y.Z_SYNC_FLUSH};if("gzip"==l||"x-gzip"==l)return s=s.pipe(y.createGunzip(u)),c=new q(s,o),void n(c);if("deflate"!=l&&"x-deflate"!=l)c=new q(s,o),n(c);else{e.pipe(new Q).once("data",function(e){s=8==(15&e[0])?s.pipe(y.createInflate()):s.pipe(y.createInflateRaw()),c=new q(s,o),n(c)})}}),function(e,t){const n=t.body;null===n?e.end():"string"==typeof n?(e.write(n),e.end()):E(n)?(e.write(Buffer.from(String(n))),e.end()):n instanceof w?(e.write(n[_]),e.end()):Buffer.isBuffer(n)?(e.write(n),e.end()):"[object ArrayBuffer]"===Object.prototype.toString.call(n)?(e.write(Buffer.from(n)),e.end()):ArrayBuffer.isView(n)?(e.write(Buffer.from(n.buffer,n.byteOffset,n.byteLength)),e.end()):n.pipe(e)}(u,i)})}ee.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},ee.Promise=global.Promise;var te=ee,ne=n(47),re=n.n(ne);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const ie=["Text","URL","Number","Boolean"];class se{static convert(e,t){const n=JSON.parse(e),r={},i={};n["@graph"]||(n["@graph"]=[n]);for(const e of n["@graph"])"rdf:Property"===e["@type"]?i[e["@id"]]=e:"rdfs:Class"===e["@type"]&&(r[e["@id"]]=e,e.subclasses=[],e.superclass=null);for(const e of Object.values(r))if(void 0!==e["rdfs:subClassOf"]){null==e["rdfs:subClassOf"].length&&(e["rdfs:subClassOf"]=[e["rdfs:subClassOf"]]);for(const t of e["rdfs:subClassOf"]){const n=t["@id"];null==e.superclass&&(e.superclass=[]),r[n]?(r[n].subclasses.push(e),e.superclass.push(r[n])):e.superclass.push({"@id":n})}}for(const e of Object.values(r))0===e.subclasses.length&&null==t&&(t=e);const s=[];for(const e of Object.values(i)){let n=e["schema:domainIncludes"];if(n||(n={"@id":t["@id"]}),n.length||(n=[n]),(n=n.map(e=>e["@id"])).includes(t["@id"])){const t=e["@id"].split(":")[1];let n=e["schema:rangeIncludes"];n||console.log(e),n.length||(n=[n]),(n=(n=n.map(e=>e["@id"].split(":")[1])).filter(e=>ie.includes(e))).length>0&&s.push({name:t,type:n})}}const o=t["@id"].split(":")[1],a=t&&t.superclass?t.superclass.map(e=>e["@id"].split(":")[1]):[];let c="";for(const e of a)c+=`import 'https://schema.org/${e}'\n\n`;if(c+=`schema ${o}`,a.length>0&&(c+=` extends ${a.join(", ")}`),s.length>0)for(const e of s){let t;c+=`\n  ${t=e.type.length>1?"("+e.type.join(" or ")+")":e.type[0]} ${e.name}`}return c+="\n"}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const oe=()=>Object.create(null),ae=e=>(class extends e{constructor(){super(),this._pendingProps=oe(),this._props=this._getInitialProps()||oe(),this._lastProps=oe(),this._state=this._getInitialState()||oe(),this._lastState=oe()}_getInitialProps(){}_getInitialState(){}_getProperty(e){return this._pendingProps[e]||this._props[e]}_setProperty(e,t){(this._validator||this._wouldChangeProp(e,t))&&(this._pendingProps[e]=t,this._invalidateProps())}_wouldChangeValue(e,t,n){return e[t]!==n}_wouldChangeProp(e,t){return this._wouldChangeValue(this._props,e,t)}_wouldChangeState(e,t){return this._wouldChangeValue(this._state,e,t)}_setProps(e){Object.assign(this._pendingProps,e),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}_setState(e){let t=!1;const n=this._state;for(const r in e){const i=e[r];this._wouldChangeState(r,i)&&(t=!0,n[r]=i)}if(t)return this._invalidate(),!0}_async(e){return Promise.resolve().then(e.bind(this))}_invalidate(){this._validator||(this._validator=this._async(this._validate))}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const e=this._getStateArgs();try{Object.assign(this._props,this._pendingProps),this._propsInvalid&&(this._willReceiveProps(...e),this._propsInvalid=!1),this._shouldUpdate(...e)&&(this._ensureMount(),this._doUpdate(...e))}catch(e){console.error(e)}this._validator=null,this._lastProps=Object.assign(oe(),this._props),this._lastState=Object.assign(oe(),this._state)}_doUpdate(...e){this._update(...e),this._didUpdate(...e)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(e,t,n){e=`_debounce_${e}`,this._state[e]=((e,t,n)=>{if(e&&clearTimeout(e),t&&n)return setTimeout(t,n)})(this._state[e],t,null!=n?n:16)}});class ce extends Error{constructor(e,t,n,r){super(),this.cause=e,this.method=t,this.particleId=n,this.particleName=r,this.stack+=`\nCaused by: ${this.cause.stack}`}toLiteral(){return{exceptionType:this.constructor.name,cause:{name:this.cause.name,message:this.cause.message,stack:this.cause.stack},method:this.method,particleId:this.particleId,particleName:this.particleName,stack:this.stack}}static fromLiteral(e){const t=e.cause;let n;switch(e.exceptionType){case le.name:n=new le(t,e.method,e.particleId,e.particleName);break;case he.name:n=new he(t,e.method,e.particleId,e.particleName);break;default:throw new Error(`Unknown exception type: ${e.exceptionType}`)}return n.stack=e.stack,n}}class le extends ce{get message(){const e=this.particleName?this.particleName:this.particleId;return`SystemException: exception ${this.cause.name} raised when invoking system function ${this.method} on behalf of particle ${e}: ${this.cause.message}`}}class he extends ce{get message(){const e=this.particleName?this.particleName:this.particleId;return`UserException: exception ${this.cause.name} raised when invoking function ${this.method} on particle ${e}: ${this.cause.message}`}}const ue=[];var de,pe;de=(e=>{throw console.log(e.method,e.particleName),e}),ue.includes(de)||ue.push(de),function(e){e.Dom="dom",e.DomTouch="domTouch",e.Vr="vr",e.Voice="voice"}(pe||(pe={}));class fe{constructor(e,t=[]){this.all=e,this.names=t}static create(e){return d()(null!=e),new fe(!1,e)}intersection(e){return this.all&&e.all?new fe(!0,[]):this.all?new fe(!1,e.names):new fe(!1,this.names.filter(t=>e.all||e.names.includes(t)))}static intersection(e){return e.reduce((e,t)=>e.intersection(t),fe.all)}union(e){return this.all||e.all?fe.all:new fe(!1,[...new Set(this.names.concat(e.names))])}static union(e){return 0===e.length?fe.all:e.reduce((e,t)=>e.union(t),fe.create([]))}isResolved(){return this.all||this.names.length>0}isCompatible(e){return this.intersection(fe.create(e)).isResolved()}static get Name(){return pe}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function me(e){return tt.fromLiteral(e)}function ge(e){return"object"==typeof e?me(e):e}function ye({type:e,name:t,direction:n}){return{type:e?me(e):void 0,name:t?ge(t):void 0,direction:n||"any"}}function _e({name:e,direction:t,isRequired:n,isSet:r}){return{name:e?ge(e):void 0,direction:t,isRequired:n,isSet:r}}function ve(e){return e instanceof rt?e.toLiteral():e}function we({type:e,name:t,direction:n}){return{type:e&&(r=e,r.toLiteral()),name:t&&ve(t),direction:n};var r}function be({name:e,direction:t,isRequired:n,isSet:r}){return{name:e&&ve(e),direction:t,isRequired:n,isSet:r}}fe.all=new fe(!0,[]),fe.dom=new fe(!1,[fe.Name.Dom]),fe.domTouch=new fe(!1,[fe.Name.DomTouch]),fe.voice=new fe(!1,[fe.Name.Voice]),fe.vr=new fe(!1,[fe.Name.Vr]);const Se=["type","name","direction"],Ce=["name","direction","isRequired","isSet"];class ke{constructor(e,t,n){d()(e),d()(void 0!==t),d()(void 0!==n),this.name=e,this.handleConnections=t,this.slots=n,this.typeVars=[];for(const e of t)for(const t of Se)ke.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t});for(const e of n)for(const t of Ce)ke.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t})}toPrettyString(){return"InterfaceInfo"}mergeTypeVariablesByName(e){this.typeVars.forEach(({object:t,field:n})=>t[n]=t[n].mergeTypeVariablesByName(e))}get canReadSubset(){return this._cloneAndUpdate(e=>e.canReadSubset)}get canWriteSuperset(){return this._cloneAndUpdate(e=>e.canWriteSuperset)}isMoreSpecificThan(e){if(this.handleConnections.length!==e.handleConnections.length||this.slots.length!==e.slots.length)return!1;for(let t=0;t<this.typeVars.length;t++){const n=this.typeVars[t],r=e.typeVars[t];if(!n.object[n.field].isMoreSpecificThan(r.object[r.field]))return!1}return!0}_applyExistenceTypeTest(e){for(const t of this.typeVars)if(e(t.object[t.field]))return!0;return!1}_handleConnectionsToManifestString(){return this.handleConnections.map(e=>`  ${e.direction||"any"} ${e.type.toString()} ${e.name?e.name:"*"}`).join("\n")}_slotsToManifestString(){return this.slots.map(e=>`  ${e.direction} ${e.isSet?"set of ":""}${e.name?e.name+" ":""}`).join("\n")}toString(){return`interface ${this.name}\n${this._handleConnectionsToManifestString()}\n${this._slotsToManifestString()}`}static fromLiteral(e){const t=e.handleConnections.map(ye),n=e.slots.map(_e);return new ke(e.name,t,n)}toLiteral(){const e=this.handleConnections.map(we),t=this.slots.map(be);return{name:this.name,handleConnections:e,slots:t}}clone(e){const t=this.handleConnections.map(({name:t,direction:n,type:r})=>({name:t,direction:n,type:r?r.clone(e):void 0})),n=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new ke(this.name,t,n)}cloneWithResolutions(e){return this._cloneWithResolutions(e)}_cloneWithResolutions(e){const t=this.handleConnections.map(({name:t,direction:n,type:r})=>({name:t,direction:n,type:r?r._cloneWithResolutions(e):void 0})),n=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new ke(this.name,t,n)}canEnsureResolved(){for(const e of this.typeVars)if(!e.object[e.field].canEnsureResolved())return!1;return!0}maybeEnsureResolved(){for(const e of this.typeVars){let t=e.object[e.field];if(!(t=t.clone(new Map)).maybeEnsureResolved())return!1}for(const e of this.typeVars)e.object[e.field].maybeEnsureResolved();return!0}tryMergeTypeVariablesWith(e){if(!this._equalItems(e.slots,this.slots,this._equalSlot))return null;if(e.handleConnections.length!==this.handleConnections.length)return null;const t=new Set(this.handleConnections),n=new Set(e.handleConnections),r=new Map;let i=t.size;for(;t.size>0;){const e=[...t.values()].map(e=>({handleConnection:e,match:[...n.values()].filter(t=>this._equalHandleConnection(e,t))}));for(const i of e){if(0===i.match.length)return null;1===i.match.length&&(r.set(i.handleConnection,i.match[0]),n.delete(i.match[0]),t.delete(i.handleConnection))}if(t.size===i)return null;i=t.size}const s=[];for(const e of this.handleConnections){const t=r.get(e);let n;if(e.type.hasVariable||t.type.hasVariable){if(!(n=dt._tryMergeTypeVariable(e.type,t.type)))return null}else n=e.type||t.type;s.push({name:e.name||t.name,direction:e.direction||t.direction,type:n})}const o=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new ke(this.name,s,o)}resolvedType(){return this._cloneAndUpdate(e=>e.resolvedType())}equals(e){return this.handleConnections.length===e.handleConnections.length&&(!!this._equalItems(e.handleConnections,this.handleConnections,this._equalHandleConnection)&&!!this._equalItems(e.slots,this.slots,this._equalSlot))}_equalHandleConnection(e,t){return e.name===t.name&&e.direction===t.direction&&dt.compareTypes({type:e.type},{type:t.type})}_equalSlot(e,t){return e.name===t.name&&e.direction===t.direction&&e.isRequired===t.isRequired&&e.isSet===t.isSet}_equalItems(e,t,n){for(const r of e){let e=!1;for(const i of t)if(n(i,r)){e=!0;break}if(!e)return!1}return!0}_cloneAndUpdate(e){const t=this.clone(new Map);return t.typeVars.forEach(t=>ke._updateTypeVar(t,e)),t}static _updateTypeVar(e,t){e.object[e.field]=t(e.object[e.field])}static isTypeVar(e){return e instanceof rt||e instanceof tt&&e.hasVariable}static mustMatch(e){return!(null==e||ke.isTypeVar(e))}static handleConnectionsMatch(e,t){if(ke.mustMatch(e.name)&&e.name!==t.name)return!1;if(ke.mustMatch(e.direction)&&"any"!==e.direction&&"any"!==t.direction&&e.direction!==t.direction)return!1;if(null==e.type)return!0;const[n,r]=tt.unwrapPair(e.type,t.type);return n instanceof rt?[{var:n,value:r,direction:e.direction}]:dt.compareTypes({type:n},{type:r})}static slotsMatch(e,t){return(!ke.mustMatch(e.name)||e.name===t.name)&&((!ke.mustMatch(e.direction)||e.direction===t.direction)&&((!ke.mustMatch(e.isRequired)||e.isRequired===t.isRequired)&&(!ke.mustMatch(e.isSet)||e.isSet===t.isSet)))}particleMatches(e){return!1!==this.cloneWithResolutions(new Map).restrictType(e)}restrictType(e){return this._restrictThis(e)}_restrictThis(e){const t=this.handleConnections.map(t=>e.handleConnections.map(e=>({match:e,result:ke.handleConnectionsMatch(t,e)})).filter(e=>!1!==e.result)),n=[];e.slotConnections.forEach(e=>{n.push({name:e.name,direction:"consume",isRequired:e.isRequired,isSet:e.isSet}),e.provideSlotConnections.forEach(e=>{n.push({name:e.name,direction:"provide",isRequired:!1,isSet:e.isSet})})});const r=this.slots.map(e=>n.filter(t=>ke.slotsMatch(e,t))).map(e=>e.map(e=>({match:e,result:!0})));function i(e,t){if(0===e.length)return[];const n=e.pop();for(const r of n){if(t.includes(r.match))continue;const n=t.slice();n.push(r.match);const s=i(e,n);if(!1!==s)return"boolean"==typeof r.result?s:s.concat(r.result)}return!1}const s=i(t,[]),o=i(r,[]);if(!1===s||!1===o)return!1;for(const e of s)if(e.var.variable.resolution){if(e.var.variable.resolution instanceof rt){if(!dt.processTypeList(e.var,[{type:e.value,direction:e.direction}]))return!1}else if(!dt.compareTypes({type:e.var.variable.resolution},{type:e.value}))return!1}else e.var.variable.resolution=e.value;return!0}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const xe=Symbol("internals");
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var Te,Ee,Ie,Re,Ae,$e,Pe,Me;!function(e){e[e.Unstored=0]="Unstored",e[e.Stored=1]="Stored"}(Te||(Te={}));class Oe{constructor(e,t,n){this.entity=null,this.storageProxy=null,this.handle=null,this.id=e.id,this.storageKey=e.storageKey,this.context=n,this.type=t,this[xe]={serialize:()=>({id:this.id,rawData:this.dataClone()})}}async ensureStorageProxy(){null==this.storageProxy&&(this.storageProxy=await this.context.getStorageProxy(this.storageKey,this.type.referredType),this.handle=Qt(this.storageProxy,this.context.idGenerator),this.storageKey?d()(this.storageKey===this.storageProxy.storageKey):this.storageKey=this.storageProxy.storageKey)}async dereference(){return d()(this.context,"Must have context to dereference"),this.entity?this.entity:(await this.ensureStorageProxy(),this.entity=await this.handle.get(this.id),this.entity)}dataClone(){return{storageKey:this.storageKey,id:this.id}}}class Ne extends Oe{constructor(e,t){super({id:De.id(e),storageKey:null},new lt(De.entityClass(e).type),t),this.mode=Te.Unstored,this.entity=e,this.stored=this.storeReference(e)}async storeReference(e){await this.ensureStorageProxy(),await this.handle.store(e),this.mode=Te.Stored}async dereference(){return this.mode===Te.Unstored?null:super.dereference()}isIdentified(){return De.isIdentified(this.entity)}static newClientReference(e){return class extends Ne{constructor(t){super(t,e)}}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Be{constructor(e,t,n,r,i){this.mutable=!0,this.entity=e,this.entityClass=t,this.schema=n,this.context=r,this.userIDComponent=i}getId(){if(void 0===this.id)throw new Error("no id");return this.id}getEntityClass(){return this.entityClass}isIdentified(){return void 0!==this.id}identify(e){d()(!this.isIdentified(),"identify() called on already identified entity"),this.id=e;const t=e.split(":"),n=t.lastIndexOf("uid");this.userIDComponent=n>0?t.slice(n+1).join(":"):""}createIdentity(e,t){let n;d()(!this.isIdentified(),"createIdentity() called on already identified entity"),n=this.userIDComponent?`${e.toString()}:uid:${this.userIDComponent}`:t.newChildId(e).toString(),this.id=n}isMutable(){return this.mutable}makeImmutable(){this.mutable=!1}mutate(e){if(!this.mutable)throw new Error("Entity is immutable.");let t;"function"==typeof e?e(t=this.dataClone()):t=e,Fe(this.entity,t,this.schema,this.context)}toLiteral(){return JSON.parse(JSON.stringify(this.entity))}dataClone(){const e={},t=this.schema.fields;for(const n of Object.keys(t))void 0!==this.entity[n]&&(t[n]&&"schema-reference"===t[n].kind?this.entity[n]&&(e[n]=this.entity[n].dataClone()):t[n]&&"schema-collection"===t[n].kind?this.entity[n]&&(e[n]=[...this.entity[n]].map(e=>e.dataClone())):e[n]=this.entity[n]);return e}serialize(){return{id:this.id,rawData:this.dataClone()}}debugLog(){const e=this.entity,t=new Be(null,this.entityClass,this.schema,this.context,this.userIDComponent);t.id=this.id,t.entity=t;const n=class extends De{constructor(){super(),Object.assign(this,e),this[xe]=t}};Object.defineProperty(n,"name",{value:e.constructor.name}),console.dir(new n,{depth:null})}}class De{toString(){const e=Object.entries(this).map(([e,t])=>`${e}: ${JSON.stringify(t)}`);return`${this.constructor.name} { ${e.join(", ")} }`}static createEntityClass(e,t){const n=class extends De{constructor(r,i){return super(),d()(r,"can't construct entity with null data"),d()(!i||-1===i.indexOf(":"),"user IDs must not contain the ':' character"),Object.defineProperty(this,xe,{value:new Be(this,n,e,t,i),enumerable:!1}),Fe(this,r,e,t),new Proxy(this,{set:(e,t,n)=>{throw new Error(`Tried to modify entity field '${t}'. Use the mutate method instead.`)}})}static get type(){return new nt(e)}static get key(){return{tag:"entity",schema:e}}static get schema(){return e}};return Object.defineProperty(n,"name",{value:e.name}),n}static id(e){return je(e).getId()}static entityClass(e){return je(e).getEntityClass()}static isIdentified(e){return je(e).isIdentified()}static identify(e,t){je(e).identify(t)}static createIdentity(e,t,n){je(e).createIdentity(t,n)}static isMutable(e){return je(e).isMutable()}static makeImmutable(e){je(e).makeImmutable()}static mutate(e,t){je(e).mutate(t)}static toLiteral(e){return je(e).toLiteral()}static dataClone(e){return je(e).dataClone()}static serialize(e){return je(e).serialize()}static debugLog(e){je(e).debugLog()}}function je(e){const t=e[xe];return d()(void 0!==t,"SYMBOL_INTERNALS lookup on non-entity"),t}function Fe(e,t,n,r){for(const[i,s]of Object.entries(t)){const t=Le(n.fields[i],s,i,r);He(i,t,n),e[i]=t}}function ze(e,t){switch(e.type){case"Text":case"URL":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Bytes":return"Uint8Array";default:throw new Error(`Unknown field type ${e.type} in schema ${t}`)}}function He(e,t,n,r){if(void 0===(r=r||n.fields[e]))throw new Error(`Can't set field ${e}; not in schema ${n.name}`);if(null!=t)switch(r.kind){case"schema-primitive":if(("Uint8Array"===t.constructor.name?"Uint8Array":typeof t)!==ze(r,n.name))throw new TypeError(`Type mismatch setting field ${e} (type ${r.type}); `+`value '${t}' is type ${typeof t}`);break;case"schema-union":for(const e of r.types)if(typeof t===ze(e,n.name))return;throw new TypeError(`Type mismatch setting field ${e} (union [${r.types}]); `+`value '${t}' is type ${typeof t}`);case"schema-tuple":if(!Array.isArray(t))throw new TypeError(`Cannot set tuple ${e} with non-array value '${t}'`);if(t.length!==r.types.length)throw new TypeError(`Length mismatch setting tuple ${e} `+`[${r.types}] with value '${t}'`);r.types.map((i,s)=>{if(void 0!==t[s]&&null!==t[s]&&typeof t[s]!==ze(i,n.name))throw new TypeError(`Type mismatch setting field ${e} (tuple [${r.types}]); `+`value '${t}' has type ${typeof t[s]} at index ${s}`)});break;case"schema-reference":if(!(t instanceof Oe))throw new TypeError(`Cannot set reference ${e} with non-reference '${t}'`);if(!dt.compareTypes({type:t.type},{type:new lt(r.schema.model)}))throw new TypeError(`Cannot set reference ${e} with value '${t}' of mismatched type`);break;case"schema-collection":if("Set"!==t.constructor.name)throw new TypeError(`Cannot set collection ${e} with non-Set '${t}'`);for(const i of t)He(e,i,n,r.schema);break;default:throw new Error(`Unknown kind '${r.kind}' for field ${e} in schema ${n.name}`)}}function Le(e,t,n,r){if(!e)return t;if("schema-reference"===e.kind&&t){if(t instanceof Oe)return t;if(t.id&&t.storageKey)return new Oe(t,new lt(e.schema.model),r);throw new TypeError(`Cannot set reference ${n} with non-reference '${t}'`)}if("schema-collection"===e.kind&&t){if("Set"===t.constructor.name)return t;if(t.length&&t instanceof Object)return new Set(t.map(t=>Le(e.schema,t,n,r)));throw new TypeError(`Cannot set collection ${n} with non-collection '${t}'`)}return t}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ue extends Error{}!function(e){e[e.Operations=0]="Operations",e[e.Model=1]="Model"}(Ee||(Ee={})),function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.FastForward=2]="FastForward"}(Ie||(Ie={}));class qe{constructor(){this.model={values:{},version:{}}}merge(e){const t=Ke(this.model.version,e.version),n={},r={type:Ie.FastForward,added:[],removed:[],oldClock:e.version,newClock:t};for(const t of Object.values(e.values)){const e=t.value,i=e.id,s=this.model.values[i];if(s)if(We(s.version,t.version))n[i]=s;else{const o=Ke(s.version,t.version);n[i]={value:e,version:o},r.added.push([e,o])}else Ve(this.model.version,t.version)?r.removed.push(e):n[i]=t}for(const[t,i]of Object.entries(this.model.values))e.values[t]||Ve(e.version,i.version)||(n[t]=i,r.added.push([i.value,i.version]));const i=function(e){if(e.removed.length>0)return null;if(0===e.added.length)return null;const t=function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return null;const n=Object.entries(e).filter(([e,n])=>t[e]>n);return 1===n.length?n[0][0]:null}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(e.oldClock,e.newClock);if(null===t)return null;const n=[...e.added].sort(([e,n],[r,i])=>(n[t]||0)-(i[t]||0));let r=e.oldClock[t];for(const[e,i]of n)if(++r!==i[t])return null;const i={...e.oldClock};if(i[t]=r,!We(i,e.newClock))return null;return n.map(([e,n])=>({type:Ie.Add,added:e,actor:t,clock:n}))}(r)||[r];return this.model.values=n,this.model.version=t,{modelChange:{changeType:Ee.Model,modelPostChange:this.model},otherChange:{changeType:Ee.Operations,operations:i}}}applyOperation(e){switch(e.type){case Ie.Add:return this.add(e.added,e.actor,e.clock);case Ie.Remove:return this.remove(e.removed,e.actor,e.clock);case Ie.FastForward:return this.fastForward(e);default:throw new Ue(`Op ${e} not supported`)}}getData(){return this.model}getParticleView(){return new Set(Object.values(this.model.values).map(e=>e.value))}add(e,t,n){if((this.model.version[t]||0)+1!==n[t])return!1;this.model.version[t]=n[t];const r=this.model.values[e.id]?this.model.values[e.id].version:{};return this.model.values[e.id]={value:e,version:Ke(n,r)},!0}remove(e,t,n){if(!this.model.values[e.id])return!1;const r=n[t]||0;return(this.model.version[t]||0)===r&&(!!Ve(n,this.model.values[e.id].version)&&(this.model.version[t]=r,delete this.model.values[e.id],!0))}fastForward(e){const t=this.model.version;if(!Ve(t,e.oldClock))return!1;if(Ve(t,e.newClock))return!0;for(const[n,r]of e.added){const e=this.model.values[n.id];e?e.version=Ke(e.version,r):Ve(t,r)||(this.model.values[n.id]={value:n,version:r})}for(const t of e.removed){const n=this.model.values[t.id];n&&Ve(e.newClock,n.version)&&delete this.model.values[t.id]}return this.model.version=Ke(t,e.newClock),!0}}function Ke(e,t){const n={};for(const[t,r]of Object.entries(e))n[t]=r;for(const[r,i]of Object.entries(t))n[r]=Math.max(i,e[r]||0);return n}function We(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const[n,r]of Object.entries(e))if(r!==t[n])return!1;return!0}function Ve(e,t){for(const[n,r]of Object.entries(t))if((e[n]||0)<r)return!1;return!0}!function(e){e[e.Set=0]="Set",e[e.Clear=1]="Clear"}(Re||(Re={}));class Ze{constructor(){this.collection=new qe}merge(e){this.collection.merge(e);const t={changeType:Ee.Model,modelPostChange:this.collection.getData()};return{modelChange:t,otherChange:t}}applyOperation(e){if(e.type===Re.Clear)return this.clear(e.actor,e.clock);if(e.type===Re.Set){const t={};for(const[n,r]of Object.entries(e.clock))t[n]=r;if(t[e.actor]=e.clock[e.actor]-1,!this.clear(e.actor,t))return!1;const n={type:Ie.Add,added:e.value,actor:e.actor,clock:e.clock};if(!this.collection.applyOperation(n))return!1}return!0}getData(){return this.collection.getData()}getParticleView(){return[...this.collection.getParticleView()].sort()[0]||null}clear(e,t){for(const n of Object.values(this.collection.getData().values)){const r={type:Ie.Remove,removed:n.value,actor:e,clock:t};this.collection.applyOperation(r)}return!0}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Set=0]="Set",e[e.Clear=1]="Clear",e[e.Add=2]="Add",e[e.Remove=3]="Remove"}(Ae||(Ae={}));class Je{constructor(e,t){this.model={singletons:e,collections:t,version:{}}}merge(e){const t={},n={};let r=!0;for(const n of Object.keys(this.model.singletons))t[n]=this.model.singletons[n].merge(e.singletons[n]),t[n].modelChange.changeType!==Ee.Model&&t[n].otherChange.changeType!==Ee.Model||(r=!1);for(const t of Object.keys(this.model.collections))n[t]=this.model.collections[t].merge(e.collections[t]),n[t].modelChange.changeType!==Ee.Model&&n[t].otherChange.changeType!==Ee.Model||(r=!1);for(const t of Object.keys(e.version))this.model.version[t]=Math.max(this.model.version[t]||0,e.version[t]);if(r){const e=[],r=[];for(const n of Object.keys(t)){for(const r of t[n].modelChange.operations){let t;t=r.type===Re.Set?{...r,type:Ae.Set,field:n}:{...r,type:Ae.Clear,field:n},e.push(t)}for(const e of t[n].otherChange.operations){let t;t=e.type===Re.Set?{...e,type:Ae.Set,field:n}:{...e,type:Ae.Clear,field:n},r.push(t)}}for(const t of Object.keys(n)){for(const r of n[t].modelChange.operations){let n;n=r.type===Ie.Add?{...r,type:Ae.Add,field:t}:{...r,type:Ae.Remove,field:t},e.push(n)}for(const e of n[t].otherChange.operations){let n;n=e.type===Ie.Add?{...e,type:Ae.Add,field:t}:{...e,type:Ae.Remove,field:t},r.push(n)}}return{modelChange:{changeType:Ee.Operations,operations:e},otherChange:{changeType:Ee.Operations,operations:r}}}{const e={changeType:Ee.Model,modelPostChange:this.getData()};return{modelChange:e,otherChange:e}}}applyOperation(e){if(e.type===Ae.Set||e.type===Ae.Clear){if(!this.model.singletons[e.field]){if(this.model.collections[e.field])throw new Error(`Can't apply ${e.type===Ae.Set?"Set":"Clear"} operation to collection field ${e.field}`);throw new Error(`Invalid field: ${e.field} does not exist`)}}else if(!this.model.collections[e.field]){if(this.model.singletons[e.field])throw new Error(`Can't apply ${e.type===Ae.Add?"Add":"Remove"} operation to singleton field ${e.field}`);throw new Error(`Invalid field: ${e.field} does not exist`)}if((()=>{switch(e.type){case Ae.Set:return this.model.singletons[e.field].applyOperation({...e,type:Re.Set});case Ae.Clear:return this.model.singletons[e.field].applyOperation({...e,type:Re.Clear});case Ae.Add:return this.model.collections[e.field].applyOperation({...e,type:Ie.Add});case Ae.Remove:return this.model.collections[e.field].applyOperation({...e,type:Ie.Remove});default:throw new Error(`Unexpected op ${e} for Entity CRDT`)}})()){for(const t of Object.keys(e.clock))this.model.version[t]=Math.max(this.model.version[t]||0,e.clock[t]);return!0}return!1}getData(){const e={},t={};return Object.keys(this.model.singletons).forEach(t=>{e[t]=this.model.singletons[t].getData()}),Object.keys(this.model.collections).forEach(e=>{t[e]=this.model.collections[e].getData()}),{singletons:e,collections:t,version:this.model.version}}getParticleView(){const e={singletons:{},collections:{}};for(const t of Object.keys(this.model.singletons))e.singletons[t]=this.model.singletons[t].getParticleView();for(const t of Object.keys(this.model.collections))e.collections[t]=this.model.collections[t].getParticleView();return e}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ge{constructor(e,t,n){this.description={},this.names=e,this.fields={};for(const[e,n]of Object.entries(t))this.fields[e]="string"==typeof n?{kind:"schema-primitive",type:n}:n;n&&n.description.forEach(e=>this.description[e.name]=e.pattern||e.patterns[0])}toLiteral(){const e={},t=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:t.model.toLiteral()}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:t(e.schema)}:e};for(const n of Object.keys(this.fields))e[n]=t(this.fields[n]);return{names:this.names,fields:e,description:this.description}}static fromLiteral(e={fields:{},names:[],description:{}}){const t={},n=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:tt.fromLiteral(t.model)}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:n(e.schema)}:e};for(const r of Object.keys(e.fields))t[r]=n(e.fields[r]);const r=new Ge(e.names,t);return r.description=e.description||{},r}get name(){return this.names[0]}static typesEqual(e,t){return Ge._typeString(e)===Ge._typeString(t)}static _typeString(e){switch(e.kind){case"schema-primitive":return e.type;case"schema-union":return`(${e.types.map(e=>e.type).join(" or ")})`;case"schema-tuple":return`(${e.types.map(e=>e.type).join(", ")})`;case"schema-reference":return`Reference<${Ge._typeString(e.schema)}>`;case"type-name":case"schema-inline":return e.model.entitySchema.toInlineSchemaString();case"schema-collection":return`[${Ge._typeString(e.schema)}]`;default:throw new Error(`Unknown type kind ${e.kind} in schema ${this.name}`)}}static union(e,t){const n=[...new Set([...e.names,...t.names])],r={};for(const[n,i]of[...Object.entries(e.fields),...Object.entries(t.fields)])if(r[n]){if(!Ge.typesEqual(r[n],i))return null}else r[n]=i;return new Ge(n,r)}static intersect(e,t){const n=[...e.names].filter(e=>t.names.includes(e)),r={};for(const[n,i]of Object.entries(e.fields)){const e=t.fields[n];e&&Ge.typesEqual(i,e)&&(r[n]=i)}return new Ge(n,r)}equals(e){return this===e||this.name===e.name&&this.isMoreSpecificThan(e)&&e.isMoreSpecificThan(this)}isMoreSpecificThan(e){const t=new Set(this.names);for(const n of e.names)if(!t.has(n))return!1;const n={};for(const[e,t]of Object.entries(this.fields))n[e]=t;for(const[t,r]of Object.entries(e.fields)){if(null==n[t])return!1;if(!Ge.typesEqual(n[t],r))return!1}return!0}get type(){return new nt(this)}entityClass(e=null){return De.createEntityClass(this,e)}crdtConstructor(){const e={},t={};for(const[t,{type:n}]of Object.entries(this.fields))if("Text"===n)e[t]=new Ze;else{if("Number"!==n)throw new Error(`Big Scary Exception: entity field ${t} of type ${n} doesn't yet have a CRDT mapping implemented`);e[t]=new Ze}return class extends Je{constructor(){super(e,t)}}}toInlineSchemaString(e){const t=this.names.join(" ")||"*",n=Object.entries(this.fields).map(([e,t])=>`${Ge._typeString(t)} ${e}`).join(", ");return`${t} {${n.length>0&&e&&e.hideFields?"...":n}}`}toManifestString(){const e=[];if(e.push(`schema ${this.names.join(" ")}`),e.push(...Object.entries(this.fields).map(([e,t])=>`  ${Ge._typeString(t)} ${e}`)),Object.keys(this.description).length>0){e.push(`  description \`${this.description.pattern}\``);for(const t of Object.keys(this.description))"pattern"!==t&&e.push(`    ${t} \`${this.description[t]}\``)}return e.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ye{constructor(e,t){this.formFactor=e,this.handle=t}toLiteral(){return this}static fromLiteral({formFactor:e,handle:t}){return new Ye(e,t)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Qe{constructor(e,t){this.id=e.toString(),this.serialization=t.replace(/\bimport .*\n/g,"")}static extractSerialization(e){return e.serialization.replace(/\bimport .*\n/g,"")}}class Xe{constructor(e,t,n,r){this.id=e,this.storageKey=t,this.type=n,this.tags=r}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class et{constructor(e,t,n){this.name=e,this._canWriteSuperset=t,this._canReadSubset=n,this._resolution=null}maybeMergeConstraints(e){return!!this.maybeMergeCanReadSubset(e.canReadSubset)&&this.maybeMergeCanWriteSuperset(e.canWriteSuperset)}maybeMergeCanReadSubset(e){if(null==e)return!0;if(null==this.canReadSubset)return this.canReadSubset=e,!0;if(this.canReadSubset instanceof ct&&e instanceof ct)return!0;if(this.canReadSubset instanceof nt&&e instanceof nt){const t=Ge.intersect(this.canReadSubset.entitySchema,e.entitySchema);return!!t&&(this.canReadSubset=new nt(t),!0)}return!1}maybeMergeCanWriteSuperset(e){if(null==e)return!0;if(null==this.canWriteSuperset)return this.canWriteSuperset=e,!0;if(this.canWriteSuperset instanceof ct&&e instanceof ct)return!0;if(this.canWriteSuperset instanceof nt&&e instanceof nt){const t=Ge.union(this.canWriteSuperset.entitySchema,e.entitySchema);return!!t&&(this.canWriteSuperset=new nt(t),!0)}return!1}isSatisfiedBy(e){const t=this._canWriteSuperset;if(!t)return!0;if(!(t instanceof nt&&e instanceof nt))throw new Error(`constraint checking not implemented for ${this} and ${e}`);return e.getEntitySchema().isMoreSpecificThan(t.getEntitySchema())}get resolution(){return this._resolution?this._resolution.resolvedType():null}isValidResolutionCandidate(e){const t=e.resolvedType().getContainedType();return t instanceof rt&&t.variable===this?{result:!1,detail:"variable cannot resolve to collection of itself"}:{result:!0}}set resolution(e){d()(!this._resolution);const t=this.isValidResolutionCandidate(e);d()(t.result,t.detail);let n=e;for(;n&&n instanceof rt;){if(n.variable===this)return;n=n.variable.resolution}this._resolution=e,this._canWriteSuperset=null,this._canReadSubset=null}get canWriteSuperset(){return this._resolution?(d()(!this._canWriteSuperset),this._resolution instanceof rt?this._resolution.variable.canWriteSuperset:null):this._canWriteSuperset}set canWriteSuperset(e){d()(!this._resolution),this._canWriteSuperset=e}get canReadSubset(){return this._resolution?(d()(!this._canReadSubset),this._resolution instanceof rt?this._resolution.variable.canReadSubset:null):this._canReadSubset}set canReadSubset(e){d()(!this._resolution),this._canReadSubset=e}get hasConstraint(){return null!==this._canReadSubset||null!==this._canWriteSuperset}canEnsureResolved(){return this._resolution?this._resolution.canEnsureResolved():!(!this._canWriteSuperset&&!this._canReadSubset)}maybeEnsureResolved(){return this._resolution?this._resolution.maybeEnsureResolved():this._canWriteSuperset?(this.resolution=this._canWriteSuperset,!0):!!this._canReadSubset&&(this.resolution=this._canReadSubset,!0)}toLiteral(){return d()(null==this.resolution),this.toLiteralIgnoringResolutions()}toLiteralIgnoringResolutions(){return{name:this.name,canWriteSuperset:this._canWriteSuperset&&this._canWriteSuperset.toLiteral(),canReadSubset:this._canReadSubset&&this._canReadSubset.toLiteral()}}static fromLiteral(e){return new et(e.name,e.canWriteSuperset?tt.fromLiteral(e.canWriteSuperset):null,e.canReadSubset?tt.fromLiteral(e.canReadSubset):null)}isResolved(){return this._resolution&&this._resolution.isResolved()}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Increment=0]="Increment",e[e.MultiIncrement=1]="MultiIncrement"}($e||($e={}));
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class tt{constructor(e){this.tag=e}static fromLiteral(e){switch(e.tag){case"Entity":return new nt(Ge.fromLiteral(e.data));case"TypeVariable":return new rt(et.fromLiteral(e.data));case"Collection":return new it(tt.fromLiteral(e.data));case"BigCollection":return new st(tt.fromLiteral(e.data));case"Relation":return new ot(e.data.map(e=>tt.fromLiteral(e)));case"Interface":return new at(ke.fromLiteral(e.data));case"Slot":return new ct(Ye.fromLiteral(e.data));case"Reference":return new lt(tt.fromLiteral(e.data));case"Arc":return new ht;case"Handle":return new ut;default:throw new Error(`fromLiteral: unknown type ${e}`)}}static unwrapPair(e,t){if(e.tag===t.tag){const n=e.getContainedType();if(null!==n)return tt.unwrapPair(n,t.getContainedType())}return[e,t]}static canMergeConstraints(e,t){return tt._canMergeCanReadSubset(e,t)&&tt._canMergeCanWriteSuperset(e,t)}static _canMergeCanReadSubset(e,t){if(e.canReadSubset&&t.canReadSubset){if(e.canReadSubset.tag!==t.canReadSubset.tag)return!1;if(e.canReadSubset instanceof nt&&t.canReadSubset instanceof nt)return null!==Ge.intersect(e.canReadSubset.entitySchema,t.canReadSubset.entitySchema);throw new Error(`_canMergeCanReadSubset not implemented for types tagged with ${e.canReadSubset.tag}`)}return!0}static _canMergeCanWriteSuperset(e,t){if(e.canWriteSuperset&&t.canWriteSuperset){if(e.canWriteSuperset.tag!==t.canWriteSuperset.tag)return!1;if(e.canWriteSuperset instanceof nt&&t.canWriteSuperset instanceof nt)return null!==Ge.union(e.canWriteSuperset.entitySchema,t.canWriteSuperset.entitySchema)}return!0}isSlot(){return this instanceof ct}slandleType(){return this.isSlot()?this:this.isCollectionType()&&this.collectionType.isSlot()?this.collectionType:void 0}isCollectionType(){return this instanceof it}isBigCollectionType(){return this instanceof st}isResolved(){return!this.hasUnresolvedVariable}mergeTypeVariablesByName(e){return this}_applyExistenceTypeTest(e){return e(this)}get hasVariable(){return this._applyExistenceTypeTest(e=>e instanceof rt)}get hasUnresolvedVariable(){return this._applyExistenceTypeTest(e=>e instanceof rt&&!e.variable.isResolved())}getContainedType(){return null}isTypeContainer(){return!1}get isReference(){return!1}collectionOf(){return new it(this)}bigCollectionOf(){return new st(this)}resolvedType(){return this}canEnsureResolved(){return this.isResolved()||this._canEnsureResolved()}_canEnsureResolved(){return!0}maybeEnsureResolved(){return!0}get canWriteSuperset(){throw new Error(`canWriteSuperset not implemented for ${this}`)}get canReadSubset(){throw new Error(`canReadSubset not implemented for ${this}`)}isMoreSpecificThan(e){return this.tag===e.tag&&this._isMoreSpecificThan(e)}_isMoreSpecificThan(e){throw new Error(`isMoreSpecificThan not implemented for ${this}`)}clone(e){return this.resolvedType()._clone(e)}_clone(e){return tt.fromLiteral(this.toLiteral())}_cloneWithResolutions(e){return tt.fromLiteral(this.toLiteral())}hasProperty(e){return e(this)||this._hasProperty(e)}_hasProperty(e){return!1}toString(e){return this.tag}getEntitySchema(){return null}toPrettyString(){return null}crdtInstanceConstructor(){return null}}class nt extends tt{constructor(e){super("Entity"),this.entitySchema=e}static make(e,t,n){return new nt(new Ge(e,t,n))}get isEntity(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return this.entitySchema.isMoreSpecificThan(e.entitySchema)}toLiteral(){return{tag:this.tag,data:this.entitySchema.toLiteral()}}toString(e){return this.entitySchema.toInlineSchemaString(e)}getEntitySchema(){return this.entitySchema}_cloneWithResolutions(e){if(e.has(this.entitySchema))return e.get(this.entitySchema);const t=new nt(this.entitySchema);return e.set(this.entitySchema,t),t}toPrettyString(){return this.entitySchema.description.pattern?this.entitySchema.description.pattern:this.entitySchema.name?this.entitySchema.name.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim():JSON.stringify(this.entitySchema.toLiteral())}crdtInstanceConstructor(){return this.entitySchema.crdtConstructor()}}class rt extends tt{constructor(e){super("TypeVariable"),this.variable=e}static make(e,t,n){return new rt(new et(e,t,n))}get isVariable(){return!0}mergeTypeVariablesByName(e){const t=this.variable.name;let n=e.get(t);if(n){if(n instanceof rt&&(n.variable.hasConstraint||this.variable.hasConstraint)){if(!n.variable.maybeMergeConstraints(this.variable))throw new Error("could not merge type variables")}}else n=this,e.set(t,this);return n}resolvedType(){return this.variable.resolution||this}_canEnsureResolved(){return this.variable.canEnsureResolved()}maybeEnsureResolved(){return this.variable.maybeEnsureResolved()}get canWriteSuperset(){return this.variable.canWriteSuperset}get canReadSubset(){return this.variable.canReadSubset}_clone(e){const t=this.variable.name;if(e.has(t))return new rt(e.get(t));{const n=et.fromLiteral(this.variable.toLiteral());return e.set(t,n),new rt(n)}}_cloneWithResolutions(e){if(e.has(this.variable))return new rt(e.get(this.variable));{const t=et.fromLiteral(this.variable.toLiteralIgnoringResolutions());return this.variable.resolution&&(t._resolution=this.variable._resolution._cloneWithResolutions(e)),this.variable._canReadSubset&&(t.canReadSubset=this.variable.canReadSubset._cloneWithResolutions(e)),this.variable._canWriteSuperset&&(t.canWriteSuperset=this.variable.canWriteSuperset._cloneWithResolutions(e)),e.set(this.variable,t),new rt(t)}}toLiteral(){return this.variable.resolution?this.variable.resolution.toLiteral():{tag:this.tag,data:this.variable.toLiteral()}}toString(e){return`~${this.variable.name}`}getEntitySchema(){return this.variable.isResolved()?this.resolvedType().getEntitySchema():null}toPrettyString(){return this.variable.isResolved()?this.resolvedType().toPrettyString():`[~${this.variable.name}]`}}class it extends tt{constructor(e){super("Collection"),this.collectionType=e}get isCollection(){return!0}mergeTypeVariablesByName(e){const t=this.collectionType,n=t.mergeTypeVariablesByName(e);return n===t?this:n.collectionOf()}_applyExistenceTypeTest(e){return this.collectionType._applyExistenceTypeTest(e)}getContainedType(){return this.collectionType}isTypeContainer(){return!0}resolvedType(){const e=this.collectionType,t=e.resolvedType();return e!==t?t.collectionOf():this}_canEnsureResolved(){return this.collectionType.canEnsureResolved()}maybeEnsureResolved(){return this.collectionType.maybeEnsureResolved()}get canWriteSuperset(){return at.make(this.tag,[],[])}get canReadSubset(){return at.make(this.tag,[],[])}_clone(e){const t=this.collectionType.clone(e).toLiteral();return tt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new it(this.collectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.collectionType.toLiteral()}}_hasProperty(e){return this.collectionType.hasProperty(e)}toString(e){return`[${this.collectionType.toString(e)}]`}getEntitySchema(){return this.collectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`${this.collectionType.toPrettyString()} List`}crdtInstanceConstructor(){return qe}}class st extends tt{constructor(e){super("BigCollection"),this.bigCollectionType=e}get isBigCollection(){return!0}mergeTypeVariablesByName(e){const t=this.bigCollectionType,n=t.mergeTypeVariablesByName(e);return n===t?this:n.bigCollectionOf()}_applyExistenceTypeTest(e){return this.bigCollectionType._applyExistenceTypeTest(e)}getContainedType(){return this.bigCollectionType}isTypeContainer(){return!0}resolvedType(){const e=this.bigCollectionType,t=e.resolvedType();return e!==t?t.bigCollectionOf():this}_canEnsureResolved(){return this.bigCollectionType.canEnsureResolved()}maybeEnsureResolved(){return this.bigCollectionType.maybeEnsureResolved()}get canWriteSuperset(){return at.make(this.tag,[],[])}get canReadSubset(){return at.make(this.tag,[],[])}_clone(e){const t=this.bigCollectionType.clone(e).toLiteral();return tt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new st(this.bigCollectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.bigCollectionType.toLiteral()}}_hasProperty(e){return this.bigCollectionType.hasProperty(e)}toString(e){return`BigCollection<${this.bigCollectionType.toString(e)}>`}getEntitySchema(){return this.bigCollectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`Collection of ${this.bigCollectionType.toPrettyString()}`}}class ot extends tt{constructor(e){super("Relation"),this.relationEntities=e}get isRelation(){return!0}toLiteral(){return{tag:this.tag,data:this.relationEntities.map(e=>e.toLiteral())}}toPrettyString(){return JSON.stringify(this.relationEntities)}}class at extends tt{constructor(e){super("Interface"),this.interfaceInfo=e}static make(e,t,n){return new at(new ke(e,t,n))}get isInterface(){return!0}mergeTypeVariablesByName(e){const t=this.interfaceInfo.clone(new Map);return t.mergeTypeVariablesByName(e),new at(t)}_applyExistenceTypeTest(e){return this.interfaceInfo._applyExistenceTypeTest(e)}resolvedType(){return new at(this.interfaceInfo.resolvedType())}_canEnsureResolved(){return this.interfaceInfo.canEnsureResolved()}maybeEnsureResolved(){return this.interfaceInfo.maybeEnsureResolved()}get canWriteSuperset(){return new at(this.interfaceInfo.canWriteSuperset)}get canReadSubset(){return new at(this.interfaceInfo.canReadSubset)}_isMoreSpecificThan(e){return this.interfaceInfo.isMoreSpecificThan(e.interfaceInfo)}_clone(e){const t=this.interfaceInfo.clone(e).toLiteral();return tt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new at(this.interfaceInfo._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.interfaceInfo.toLiteral()}}toString(e){return this.interfaceInfo.name}toPrettyString(){return this.interfaceInfo.toPrettyString()}}class ct extends tt{constructor(e){super("Slot"),this.slot=e}static make(e,t){return new ct(new Ye(e,t))}getSlot(){return this.slot}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return!0}toLiteral(){return{tag:this.tag,data:this.slot.toLiteral()}}toString(e){const t=[];for(const e of Object.keys(this.slot))void 0!==this.slot[e]&&t.push(`${e}:${this.slot[e]}`);let n="";return 0!==t.length&&(n=` {${t.join(", ")}}`),`Slot${n}`}toPrettyString(){const e=[];for(const t of Object.keys(this.slot))void 0!==this.slot[t]&&e.push(`${t}:${this.slot[t]}`);let t="";return 0!==e.length&&(t=` {${e.join(", ")}}`),`Slot${t}`}}class lt extends tt{constructor(e){super("Reference"),this.referredType=e}get isReference(){return!0}getContainedType(){return this.referredType}isTypeContainer(){return!0}resolvedType(){const e=this.referredType,t=e.resolvedType();return e!==t?new lt(t):this}_canEnsureResolved(){return this.referredType.canEnsureResolved()}maybeEnsureResolved(){return this.referredType.maybeEnsureResolved()}get canWriteSuperset(){return this.referredType.canWriteSuperset}get canReadSubset(){return this.referredType.canReadSubset}_clone(e){const t=this.referredType.clone(e).toLiteral();return tt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new lt(this.referredType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.referredType.toLiteral()}}toString(e){return"Reference<"+this.referredType.toString()+">"}getEntitySchema(){return this.referredType.getEntitySchema()}}class ht extends tt{constructor(){super("Arc")}get isArc(){return!0}newInstance(e,t){return new Qe(e,t)}toLiteral(){return{tag:this.tag}}}class ut extends tt{constructor(){super("Handle")}get isHandle(){return!0}toLiteral(){return{tag:this.tag}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class dt{static processTypeList(e,t){const n=rt.make("",null,null);e&&(n.variable.resolution=e),e=n;const r=[];for(const n of t)if(n.type.resolvedType().hasVariable){if(null==(e=dt._tryMergeTypeVariable(e,n.type)))return null}else r.push(n);for(const t of r)if(!dt._tryMergeConstraints(e,t))return null;const i=e=>e instanceof rt?null==e.canReadSubset||null==e.canWriteSuperset?e:e.canReadSubset.isMoreSpecificThan(e.canWriteSuperset)?(e.canWriteSuperset.isMoreSpecificThan(e.canReadSubset)&&(e.variable.resolution=e.canReadSubset),e):null:e,s=e.resolvedType();if(s.isCollectionType()){const e=i(s.collectionType);return null!==e?e.collectionOf():null}if(s.isBigCollectionType()){const e=i(s.bigCollectionType);return null!==e?e.bigCollectionOf():null}return i(s)}static _tryMergeTypeVariable(e,t){const[n,r]=tt.unwrapPair(e.resolvedType(),t.resolvedType());if(n instanceof rt){if(r instanceof rt){if(!1===n.variable.maybeMergeConstraints(r.variable))return null;r.variable.resolution=n}else{if(!n.variable.isValidResolutionCandidate(r).result)return null;n.variable.resolution=r}return e}if(r instanceof rt)return r.variable.isValidResolutionCandidate(n).result?(r.variable.resolution=n,t):null;if(n instanceof at&&r instanceof at){const e=n.interfaceInfo.tryMergeTypeVariablesWith(r.interfaceInfo);return null==e?null:new at(e)}if(n.isTypeContainer()&&n.hasVariable||r.isTypeContainer()&&r.hasVariable)return null;throw new Error("tryMergeTypeVariable shouldn't be called on two types without any type variables")}static _tryMergeConstraints(e,{type:t,direction:n}){let[r,i]=tt.unwrapPair(e.resolvedType(),t.resolvedType());if(r instanceof rt){for(;i.isTypeContainer();){if(null!=r.variable.resolution||null!=r.variable.canReadSubset||null!=r.variable.canWriteSuperset)return!1;const e=rt.make("a",null,null);r.variable.resolution=i instanceof it?new it(e):i instanceof st?new st(e):new lt(e);const t=tt.unwrapPair(r.resolvedType(),i);if([r,i]=t,!(r instanceof rt))throw new TypeError("unwrapping a wrapped TypeVariable somehow didn't become a TypeVariable")}if(("out"===n||"inout"===n||"`provide"===n)&&!r.variable.maybeMergeCanReadSubset(i.canWriteSuperset))return!1;if(("in"===n||"inout"===n||"`consume"===n)&&!r.variable.maybeMergeCanWriteSuperset(i.canReadSubset))return!1}else{if(i.tag!==r.tag)return!1;if(("out"===n||"inout"===n)&&!dt._writeConstraintsApply(r,i))return!1;if(("in"===n||"inout"===n)&&!dt._readConstraintsApply(r,i))return!1}return!0}static _writeConstraintsApply(e,t){const n=t.canWriteSuperset;return null==n||null==e.canReadSubset||!!n.isMoreSpecificThan(e.canReadSubset)}static _readConstraintsApply(e,t){const n=t.canReadSubset;return null==n||null==e.canWriteSuperset||!!e.canWriteSuperset.isMoreSpecificThan(n)}static compareTypes(e,t){const n=e.type.resolvedType(),r=t.type.resolvedType(),[i,s]=tt.unwrapPair(n,r);if(i instanceof rt&&s.isTypeContainer())return!(i.variable.canReadSubset||i.variable.canWriteSuperset);if(s instanceof rt&&i.isTypeContainer())return!(s.variable.canReadSubset||s.variable.canWriteSuperset);if(i instanceof rt||s instanceof rt)return tt.canMergeConstraints(i,s);if(void 0===i!=(void 0===s))return!1;if(i===s)return!0;if(i.tag!==s.tag)return!1;if(i instanceof ct)return!0;if(i instanceof at&&s instanceof at&&i.interfaceInfo.equals(s.interfaceInfo))return!0;if(!(i instanceof nt&&s instanceof nt))return!1;const o=i.entitySchema.isMoreSpecificThan(s.entitySchema),a=s.entitySchema.isMoreSpecificThan(i.entitySchema);if(a&&o)return!0;if(!a&&!o)return!1;const[c,l]=a?[e,t]:[t,e],h=c.direction||(c.connection?c.connection.direction:"inout"),u=l.direction||(l.connection?l.connection.direction:"inout");return"in"===h||"out"===u}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.HasTag="has-tag",e.IsFromHandle="is-from-handle",e.IsFromOutput="is-from-output",e.IsFromStore="is-from-store"}(Pe||(Pe={}));class pt{constructor(e,t){this.target=e,this.expression=t}toManifestString(){let e;return`check ${e=this.target instanceof Et?this.target.name:`${this.target.name} data`} ${this.expression.toManifestString()}`}}class ft{constructor(e,t){this.type=e,this.children=t}toManifestString(e=!1){const t=this.children.map(e=>e.toManifestString(!0)).join(` ${this.type} `);return e?`(${t})`:t}}class mt{constructor(e,t){this.tag=e,this.isNot=t,this.type=Pe.HasTag}static fromASTNode(e){return new mt(e.tag,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}${this.tag}`}}class gt{constructor(e,t){this.parentHandle=e,this.isNot=t,this.type=Pe.IsFromHandle}static fromASTNode(e,t){const n=t.get(e.parentHandle);if(!n)throw new Error(`Unknown "check is from handle" handle name: ${e.parentHandle}.`);return new gt(n,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}from handle ${this.parentHandle.name}`}}class yt{constructor(e,t){this.output=e,this.isNot=t,this.type=Pe.IsFromOutput}static fromASTNode(e,t){const n=t.get(e.output);if(!n)throw new Error(`Unknown "check is from output" output name: ${e.output}.`);return new yt(n,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}from output ${this.output.name}`}}class _t{constructor(e,t){this.storeRef=e,this.isNot=t,this.type=Pe.IsFromStore}static fromASTNode(e){return new _t({type:e.storeRef.type,store:e.storeRef.store},e.isNot)}toManifestString(){let e=this.storeRef.store;return"id"===this.storeRef.type&&(e=`'${e}'`),`is ${this.isNot?"not ":""}from store ${e}`}}function vt(e,t){return"particle-trust-check-boolean-expression"===e.kind?(d()(e.children.length>=2,"Boolean check expressions must have at least two children."),new ft(e.operator,e.children.map(e=>vt(e,t)))):function(e,t){switch(e.checkType){case Pe.HasTag:return mt.fromASTNode(e);case Pe.IsFromHandle:return gt.fromASTNode(e,t);case Pe.IsFromStore:return _t.fromASTNode(e);case Pe.IsFromOutput:return yt.fromASTNode(e,t);default:throw new Error("Unknown check type.")}}(e,t)}function wt(e,t,n){const r=vt(t.expression,n);return new pt(e,r)}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.IsTag="is-tag",e.DerivesFrom="derives-from"}(Me||(Me={}));class bt{constructor(e,t){this.handle=e,this.claims=t}toManifestString(){const e=this.claims.map(e=>e.toManifestString());return`claim ${this.handle.name} ${e.join(" and ")}`}}class St{constructor(e,t){this.isNot=e,this.tag=t,this.type=Me.IsTag}static fromASTNode(e){return new St(e.isNot,e.tag)}toManifestString(){return`is ${this.isNot?"not ":""}${this.tag}`}}class Ct{constructor(e){this.parentHandle=e,this.type=Me.DerivesFrom}static fromASTNode(e,t){const n=t.get(e.parentHandle);if(!n)throw new Error(`Unknown "derives from" handle name: ${n}.`);return new Ct(n)}toManifestString(){return`derives from ${this.parentHandle.name}`}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function kt(e){return e instanceof tt?e:tt.fromLiteral(e)}function xt(e){return e instanceof tt?e.toLiteral():e}function Tt({name:e,tags:t,id:n,type:r,fate:i}){const s=["root","toproot","modal"];if(i&&"`slot"!==i||r&&!r.slandleType())return!1;if(n&&0===n.lastIndexOf("rootslotid-",0)){const e=n.substr("rootslotid-".length);if(s.includes(e))return!0}return s.includes(e)||t.some(e=>s.includes(e))}class Et{constructor(e,t){this.parentConnection=null,this.rawData=e,this.direction=e.direction,this.name=e.name,this.type=kt(e.type).mergeTypeVariablesByName(t),this.isOptional=e.isOptional,this.tags=e.tags||[],this.dependentConnections=[]}instantiateDependentConnections(e,t){for(const n of this.rawData.dependentConnections){const r=e.createConnection(n,t);r.parentConnection=this,this.dependentConnections.push(r)}}toSlotConnectionSpec(){const e=this.type.slandleType();if(!e)return;const t=this.type.isCollectionType(),n=e.getSlot();return{name:this.name,isOptional:this.isOptional,direction:this.direction,tags:this.tags,dependentConnections:this.dependentConnections.map(e=>e.toSlotConnectionSpec()),isRequired:!this.isOptional,isSet:t,type:e,handles:n.handle?[n.handle]:[],formFactor:n.formFactor,provideSlotConnections:this.dependentConnections.map(e=>e.toSlotConnectionSpec())}}get isInput(){return"in"===this.direction||"inout"===this.direction||"host"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}isCompatibleType(e){return dt.compareTypes({type:e},{type:this.type,direction:this.direction})}}class It{constructor(e){this.name=e.name,this.isRequired=e.isRequired||!1,this.isSet=e.isSet||!1,this.tags=e.tags||[],this.formFactor=e.formFactor,this.handles=e.handles||[],this.provideSlotConnections=[],e.provideSlotConnections&&e.provideSlotConnections.forEach(e=>{this.provideSlotConnections.push(new Rt(e))})}get isOptional(){return!this.isRequired}get direction(){return"`consume"}get type(){const e=ct.make(this.formFactor,null);return this.isSet?e.collectionOf():e}get dependentConnections(){return this.provideSlotConnections}}class Rt extends It{constructor(e){super(e),this.check=e.check}}class At{constructor(e){this.model=e,this.name=e.name,this.verbs=e.verbs;const t=new Map;this.handleConnectionMap=new Map,e.args.forEach(e=>this.createConnection(e,t)),e.description=e.description||{},this.validateDescription(e.description),this.pattern=e.description.pattern,this.handleConnectionMap.forEach((t,n)=>{t.pattern=e.description[n]}),this.implFile=e.implFile,this.implBlobUrl=e.implBlobUrl,this.modality=e.modality?fe.create(e.modality):fe.all,this.slotConnections=new Map,e.slotConnections&&e.slotConnections.forEach(e=>this.slotConnections.set(e.name,new It(e))),this.slotConnections.forEach(e=>{e.provideSlotConnections.forEach(e=>{e.handles.forEach(e=>d()(this.handleConnectionMap.has(e),"Cannot provide slot for nonexistent handle constraint "+e))})}),this.trustClaims=this.validateTrustClaims(e.trustClaims),this.trustChecks=this.validateTrustChecks(e.trustChecks)}createConnection(e,t){const n=new Et(e,t);if(this.handleConnectionMap.get(n.name))throw new Error(`Particle Spec ${this.name} already has a handle connection named "${n.name}".`);return this.handleConnectionMap.set(n.name,n),n.instantiateDependentConnections(this,t),n}get handleConnections(){return this.connections}get connections(){return[...this.handleConnectionMap.values()]}get inputs(){return this.connections.filter(e=>e.isInput)}get outputs(){return this.connections.filter(e=>e.isOutput)}isInput(e){const t=this.handleConnectionMap.get(e);return t&&t.isInput}isOutput(e){const t=this.handleConnectionMap.get(e);return t&&t.isOutput}getConnectionByName(e){return this.handleConnectionMap.get(e)}getSlotSpec(e){return this.slotConnections.get(e)}getSlandleSpec(e){const t=this.slotConnections.get(e);return t||this.handleConnectionMap.get(e).toSlotConnectionSpec()}slandleConnectionNames(){const e=this.handleConnections.filter(e=>e.toSlotConnectionSpec()).map(e=>e.name);return[...this.slotConnections.keys(),...e]}slotConnectionNames(){return[...this.slotConnections.keys()]}get primaryVerb(){return this.verbs.length>0?this.verbs[0]:void 0}isCompatible(e){return 0===this.slandleConnectionNames().length||this.modality.intersection(e).isResolved()}setImplBlobUrl(e){this.model.implBlobUrl=this.implBlobUrl=e}toLiteral(){const{args:e,name:t,verbs:n,description:r,implFile:i,implBlobUrl:s,modality:o,slotConnections:a,trustClaims:c,trustChecks:l}=this.model,h=({type:e,direction:t,name:n,isOptional:r,dependentConnections:i})=>({type:xt(e),direction:t,name:n,isOptional:r,dependentConnections:i.map(h)});return{args:e.map(e=>h(e)),name:t,verbs:n,description:r,implFile:i,implBlobUrl:s,modality:o,slotConnections:a,trustClaims:c,trustChecks:l}}static fromLiteral(e){let{args:t,name:n,verbs:r,description:i,implFile:s,implBlobUrl:o,modality:a,slotConnections:c,trustClaims:l,trustChecks:h}=e;const u=({type:e,direction:t,name:n,isOptional:r,dependentConnections:i})=>({type:kt(e),direction:t,name:n,isOptional:r,dependentConnections:i?i.map(u):[]});return t=t.map(u),new At({args:t,name:n,verbs:r||[],description:i,implFile:s,implBlobUrl:o,modality:a,slotConnections:c,trustClaims:l,trustChecks:h})}clone(){return At.fromLiteral(this.toLiteral())}cloneWithResolutions(e){const t=this.clone();return this.handleConnectionMap.forEach((n,r)=>{t.handleConnectionMap.get(r).type=n.type._cloneWithResolutions(e)}),t}equals(e){return JSON.stringify(this.toLiteral())===JSON.stringify(e.toLiteral())}validateDescription(e){Object.keys(e||[]).forEach(e=>{d()(["kind","location","pattern"].includes(e)||this.handleConnectionMap.has(e),`Unexpected description for ${e}`)})}toInterface(){d()(!this.slotConnections.size,"please implement slots toInterface");const e=this.model.args.map(({type:e,name:t,direction:n})=>({type:kt(e),name:t,direction:n}));return at.make(this.name,e,[])}toString(){const e=[];let t="";this.verbs.length>0&&(t=" "+this.verbs.map(e=>`&${e}`).join(" ")),e.push(`particle ${this.name}${t} in '${this.implFile}'`.trim());const n=(t,r)=>{const i=t.tags.map(e=>` #${e}`).join("");e.push(`${r}${t.direction}${t.isOptional?"?":""} ${t.type.toString()} ${t.name}${i}`);for(const e of t.dependentConnections)n(e,r+"  ")};for(const e of this.handleConnections)e.parentConnection||n(e,"  ");this.trustClaims.forEach(t=>e.push(`  ${t.toManifestString()}`)),this.trustChecks.forEach(t=>e.push(`  ${t.toManifestString()}`)),this.modality.names.forEach(t=>e.push(`  modality ${t}`));const r=(t,n,i)=>{const s=[];t.isRequired&&s.push("must"),s.push(n),t.isSet&&s.push("set of"),s.push(t.name),t.tags.length>0&&s.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`${i}${s.join(" ")}`),t.formFactor&&e.push(`${i}  formFactor ${t.formFactor}`);for(const n of t.handles)e.push(`${i}  handle ${n}`);t.provideSlotConnections&&t.provideSlotConnections.forEach(e=>r(e,"provide",i+"  "))};return this.slotConnections.forEach(e=>r(e,"consume","  ")),this.pattern&&(e.push(`  description \`${this.pattern}\``),this.handleConnectionMap.forEach(t=>{t.pattern&&e.push(`    ${t.name} \`${t.pattern}\``)})),e.join("\n")}toManifestString(){return this.toString()}validateTrustClaims(e){const t=[];return e&&e.forEach(e=>{const n=this.handleConnectionMap.get(e.handle);if(!n)throw new Error(`Can't make a claim on unknown handle ${e.handle}.`);if(!n.isOutput)throw new Error(`Can't make a claim on handle ${e.handle} (not an output handle).`);if(n.claims)throw new Error(`Can't make multiple claims on the same output (${e.handle}).`);const r=function(e,t,n){const r=t.expression.map(e=>{switch(e.claimType){case Me.IsTag:return St.fromASTNode(e);case Me.DerivesFrom:return Ct.fromASTNode(e,n);default:throw new Error("Unknown claim type.")}});return new bt(e,r)}(n,e,this.handleConnectionMap);n.claims=r.claims,t.push(r)}),t}validateTrustChecks(e){const t=[];if(e){const n=this.getProvidedSlotsByName();e.forEach(e=>{switch(e.target.targetType){case"handle":{const n=e.target.name,r=this.handleConnectionMap.get(n);if(!r)throw new Error(`Can't make a check on unknown handle ${n}.`);if(!r.isInput)throw new Error(`Can't make a check on handle ${n} (not an input handle).`);if(r.check)throw new Error(`Can't make multiple checks on the same input (${n}).`);r.check=wt(r,e,this.handleConnectionMap),t.push(r.check);break}case"slot":{const r=e.target.name,i=n.get(r);if(!i)throw this.slotConnectionNames().includes(r)?new Error(`Slot ${r} is a consumed slot. Can only make checks on provided slots.`):new Error(`Can't make a check on unknown slot ${r}.`);i.check=wt(i,e,this.handleConnectionMap),t.push(i.check);break}default:throw new Error("Unknown check target type.")}})}return t}getProvidedSlotsByName(){const e=new Map;for(const t of this.slotConnections.values())for(const n of t.provideSlotConnections){const t=n.name;if(e.has(t))throw new Error(`Another slot with name '${t}' has already been provided by this particle.`);e.set(t,n)}return e}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const $t=(e,t)=>t([e]);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Pt{constructor(e){if(this.items=new Map,e)for(let{id:t,value:n,keys:r}of e)r||(r=[]),this.items.set(t,{value:n,keys:new Set(r)})}add(e,t,n){d()(n.length>0&&"object"==typeof n,"add requires a list of keys");let r=this.items.get(e),i=!1;if(r){let e=!1;for(const t of n)r.keys.has(t)||(e=!0),r.keys.add(t);this._equals(r.value,t)||(d()(e,"cannot add without new keys. incoming="+n.join(",")+" existing="+[...r.keys].join(",")),r.value=t,i=!0)}else r={value:t,keys:new Set(n)},this.items.set(e,r),i=!0;return i}_equals(e,t){if(Boolean(e)!==Boolean(t))return!1;if(!e)return!0;const n=typeof e;if(n!==typeof t)return!1;if("object"===n){const n=Object.keys(e);return n.length===Object.keys(t).length&&n.every(n=>this._equals(e[n],t[n]))}return JSON.stringify(e)===JSON.stringify(t)}remove(e,t){const n=this.items.get(e);if(!n)return!1;for(const e of t)n.keys.delete(e);const r=0===n.keys.size;return r&&this.items.delete(e),r}toLiteral(){const e=[];for(const[t,{value:n,keys:r}]of this.items.entries())e.push({id:t,value:n,keys:[...r]});return e}toList(){return[...this.items.values()].map(e=>e.value)}has(e){return this.items.has(e)}getKeys(e){const t=this.items.get(e);return t?[...t.keys]:[]}getValue(e){const t=this.items.get(e);return t?t.value:null}get size(){return this.items.size}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Mt{}const Ot=new class extends Mt{next(){return Math.random()}};class Nt{static next(){return Ot.next()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Bt{constructor(e){this._nextComponentId=0,this._currentSessionId=e}static newSession(){const e=Math.floor(Nt.next()*Math.pow(2,50))+"";return new Bt(e)}static createWithSessionIdForTesting(e){return new Bt(e)}newArcId(e){return jt._newArcIdInternal(this._currentSessionId,e)}newChildId(e,t=""){return t+=this._nextComponentId++,Dt._newIdInternal(this._currentSessionId,[...e.idTree,t])}get currentSessionIdForTesting(){return this._currentSessionId}}class Dt{constructor(e,t=[]){this.idTree=[],this.root=e,this.idTree=t}static _newIdInternal(e,t=[]){return new Dt(e,t)}static fromString(e){const t=e.split(":");if(t[0].startsWith("!")){const e=t[0].slice(1),n=t.slice(1).filter(e=>e.length>0);return new Dt(e,n)}return new Dt("",t)}toString(){return`!${this.root}:${this.idTree.join(":")}`}idTreeAsString(){return this.idTree.join(":")}equal(e){if(e.root!==this.root||e.idTree.length!==this.idTree.length)return!1;for(let t=0;t<e.idTree.length;t++)if(e.idTree[t]!==this.idTree[t])return!1;return!0}}class jt extends Dt{static _newArcIdInternal(e,t){return new jt(e,[t])}static newForTest(e){return Bt.newSession().newArcId(e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var Ft;!function(e){e[e.none=0]="none",e[e.pending=1]="pending",e[e.full=2]="full"}(Ft||(Ft={}));class zt{constructor(e,t,n,r,i,s){this.version=void 0,this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=Ft.none,this.observers=[],this.updates=[],this.barrier=null,this.id=e,this.type=t,this.port=n,this.scheduler=i,this.name=s,this.updates=[],this.pec=r}static newProxy(e,t,n,r,i,s){return t instanceof it?new Ht(e,t,n,r,i,s):t instanceof st?new Ut(e,t,n,r,i,s):new Lt(e,t,n,r,i,s)}static newNoOpProxy(e,t){return new qt(e,t,null,null,null,"NoOpStorage")}reportExceptionInHost(e){$t?$t(e.cause.stack,t=>{e.cause.stack=t,this.port.ReportExceptionInHost(e)}):this.port.ReportExceptionInHost(e)}register(e,t){if(t.canRead&&(d()(t instanceof Vt),this.observers.push({particle:e,handle:t}),this.listenerAttached||(this.port.InitializeProxy(this,e=>this._onUpdate(e)),this.listenerAttached=!0),t.options.keepSynced&&(this.keepSynced||(this.port.SynchronizeProxy(this,e=>this._onSynchronize(e)),this.keepSynced=!0),t.options.notifySync&&this.synchronized===Ft.full))){const n=this._getModelForSync();this.scheduler.enqueue(e,t,["sync",e,n])}}deregister(e,t){this.observers=this.observers.filter(({particle:n,handle:r})=>n!==e||r!==t)}_onSynchronize({version:e,model:t}){if(void 0!==this.version&&e<=this.version)return void console.warn(`StorageProxy '${this.id}' received stale model version ${e}; `+`current is ${this.version}`);if(!this._synchronizeModel(e,t))return;for(this.synchronized=Ft.full;this.updates.length>0&&this.updates[0].version<=e;)this.updates.shift();const n=this._getModelForSync();this._notify("sync",n,e=>e.keepSynced&&e.notifySync),this._processUpdates()}_onUpdate(e){if(this.observers.find(({handle:e})=>!e.options.keepSynced&&e.options.notifyUpdate)){const t=this._processUpdate(e,!1);this._notify("update",t,e=>!e.keepSynced&&e.notifyUpdate)}this.keepSynced&&(e.version<=this.version?console.warn(`StorageProxy '${this.id}' received stale update version ${e.version}; `+`current is ${this.version}`):(this.updates.push(e),this.updates.sort((e,t)=>e.version-t.version),this._processUpdates()))}_notify(e,t,n=(e=>!0)){for(const{handle:r,particle:i}of this.observers)n(r.options)&&this.scheduler.enqueue(i,r,[e,i,t])}_processUpdates(){const e=e=>e.version===this.version+1||!(!this.barrier||e.barrier!==this.barrier);for(;this.updates.length>0&&e(this.updates[0]);){const e=this.updates.shift(),t=this._processUpdate(e);this.version=e.version,t&&this._notify("update",t,e=>e.keepSynced&&e.notifyUpdate)}if(this.updates.length>0){if(this.synchronized!==Ft.none){this.synchronized=Ft.none,this.port.SynchronizeProxy(this,e=>this._onSynchronize(e));for(const{handle:e,particle:t}of this.observers)e.options.notifyDesync&&this.scheduler.enqueue(t,e,["desync",t,{}])}}else this.synchronized!==Ft.full&&(this.synchronized=Ft.full)}generateBarrier(){return this.pec.idGenerator.newChildId(Dt.fromString(this.id),"barrier").toString()}}class Ht extends zt{constructor(){super(...arguments),this.model=new Pt}_getModelForSync(){return this.model.toList()}_synchronizeModel(e,t){return this.version=e,this.model=new Pt(t),!0}_processUpdate(e,t=!0){if(this.synchronized===Ft.full)for(const{handle:t}of this.observers)if(e.originatorId===t._particleId)return null;const n=[],r=[];if("add"in e)for(const{value:r,keys:i,effective:s}of e.add)(t&&this.model.add(r.id,r,i)||!t&&s)&&n.push(r);else{if(!("remove"in e))throw new Error(`StorageProxy received invalid update event: ${JSON.stringify(e)}`);for(const{value:n,keys:i,effective:s}of e.remove){const e=this.model.getValue(n.id);(t&&this.model.remove(n.id,i)||!t&&s)&&r.push(e)}}if(n.length||r.length){const t={originatorId:e.originatorId};return n.length&&(t.add=n),r.length&&(t.remove=r),t}return null}async toList(){return this.synchronized===Ft.full?Promise.resolve(this.model.toList()):new Promise(e=>this.port.HandleToList(this,e))}async get(e){return this.synchronized===Ft.full?Promise.resolve(this.model.getValue(e)):new Promise((t,n)=>this.port.HandleToList(this,n=>t(n.find(t=>t.id===e))))}async store(e,t,n){const r=e.id,i={value:e,keys:t};if(this.port.HandleStore(this,()=>{},i,n),this.synchronized!==Ft.full)return Promise.resolve();if(!this.model.add(r,e,t))return Promise.resolve();const s={originatorId:n,add:[e]};return this._notify("update",s,e=>e.notifyUpdate),Promise.resolve()}async clear(e){this.synchronized!==Ft.full&&this.port.HandleRemoveMultiple(this,()=>{},[],e);let t=this.model.toList().map(e=>({id:e.id,keys:this.model.getKeys(e.id)}));return this.port.HandleRemoveMultiple(this,()=>{},t,e),(t=(t=t.map(({id:e,keys:t})=>({rawData:this.model.getValue(e).rawData,id:e,keys:t}))).filter(e=>this.model.remove(e.id,e.keys))).length>0&&this._notify("update",{originatorId:e,remove:t},e=>e.notifyUpdate),Promise.resolve()}async remove(e,t,n){if(this.synchronized!==Ft.full){const t={id:e,keys:[]};return this.port.HandleRemove(this,()=>{},t,n),Promise.resolve()}const r=this.model.getValue(e);if(!r)return Promise.resolve();0===t.length&&(t=this.model.getKeys(e));const i={id:e,keys:t};if(this.port.HandleRemove(this,()=>{},i,n),!this.model.remove(e,t))return Promise.resolve();const s={originatorId:n,remove:[r]};return this._notify("update",s,e=>e.notifyUpdate),Promise.resolve()}}class Lt extends zt{constructor(){super(...arguments),this.model=null}_getModelForSync(){return this.model}_synchronizeModel(e,t){return null==this.barrier&&(this.version=e,this.model=0===t.length?null:t[0].value,d()(void 0!==this.model),!0)}_processUpdate(e,t=!0){if(d()("data"in e),!t)return e;if(null!=this.barrier){if(e.barrier===this.barrier&&(this.barrier=null,this.synchronized!==Ft.full)){this.synchronized=Ft.full;const e=this._getModelForSync();this._notify("sync",e,e=>e.keepSynced&&e.notifySync)}return null}const n=this.model;return this.model=e.data,{...e,oldData:n}}async get(){return this.synchronized===Ft.full?Promise.resolve(this.model):new Promise(e=>this.port.HandleGet(this,e))}async set(e,t){if(d()(void 0!==e),JSON.stringify(this.model)===JSON.stringify(e))return Promise.resolve();let n;n=this.listenerAttached?this.generateBarrier():null;const r=this.model;this.model=JSON.parse(JSON.stringify(e)),this.barrier=n,this.port.HandleSet(this,e,t,n);const i={originatorId:t,data:e,oldData:r};return this._notify("update",i,e=>e.notifyUpdate),Promise.resolve()}async clear(e){if(null==this.model)return Promise.resolve();const t=this.generateBarrier(),n=this.model;this.model=null,this.barrier=t,this.port.HandleClear(this,e,t);const r={originatorId:e,data:null,oldData:n};return this._notify("update",r,e=>e.notifyUpdate),Promise.resolve()}}class Ut extends zt{register(e,t){t.canRead&&this.scheduler.enqueue(e,t,["sync",e,{}])}_getModelForSync(){throw new Error("_getModelForSync not implemented for BigCollectionProxy")}_processUpdate(){throw new Error("_processUpdate not implemented for BigCollectionProxy")}_synchronizeModel(){throw new Error("_synchronizeModel not implemented for BigCollectionProxy")}async get(e){throw new Error("unimplemented")}async store(e,t,n){return new Promise(r=>this.port.HandleStore(this,r,{value:e,keys:t},n))}async remove(e,t,n){return new Promise(t=>this.port.HandleRemove(this,t,{id:e,keys:[]},n))}async stream(e,t){return new Promise(n=>this.port.HandleStream(this,n,e,t))}async cursorNext(e){return new Promise(t=>this.port.StreamCursorNext(this,t,e))}async cursorClose(e){return this.port.StreamCursorClose(this,e),Promise.resolve()}}class qt extends zt{_getModelForSync(){return null}_synchronizeModel(e,t){return!0}_processUpdate(e,t){return null}reportExceptionInHost(e){}deregister(){}register(){}_onSynchronize({version:e,model:t}){}_onUpdate(e){}_notify(e,t,n=(e=>!0)){}_processUpdates(){}generateBarrier(){return null}async get(e){return new Promise(e=>{})}async store(e,t,n){return new Promise(e=>{})}async clear(e){return new Promise(e=>{})}async remove(e,t,n){return new Promise(e=>{})}async toList(){return new Promise(e=>{})}async stream(e,t){return new Promise(e=>{})}async cursorNext(e){return new Promise(e=>{})}async cursorClose(e){return new Promise(e=>{})}async set(e,t){return new Promise(e=>{})}}class Kt{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(e,t,n){this._queues.has(e)||this._queues.set(e,new Map);const r=this._queues.get(e);r.has(t)||r.set(t,[]),r.get(t).push(n),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(e=>this._idleResolver=e)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const e=[...this._queues.keys()][0],t=this._queues.get(e);this._queues.delete(e);for(const[e,n]of t.entries())for(const t of n)try{e._notify(...t)}catch(t){console.error("Error dispatching to particle",t),e.storage.reportExceptionInHost(new le(t,e._particleId,"StorageProxyScheduler::_dispatch"))}}this._updateIdle()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Wt(e,t){d()(t,"Handles need entity classes for deserialization");const{id:n,rawData:r}=e,i=new t(r);return e.id&&De.identify(i,e.id),i}class Vt{constructor(e,t,n,r,i,s){d()(!(e instanceof Vt)),this._storage=e,this.idGenerator=t,this.name=n||this.storage.name,this.canRead=i,this.canWrite=s,this._particleId=r,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1}}reportUserExceptionInHost(e,t,n){this.storage.reportExceptionInHost(new he(e,n,this._particleId,t.spec.name))}reportSystemExceptionInHost(e,t){this.storage.reportExceptionInHost(new le(e,t,this._particleId))}configure(e){d()(this.canRead,"configure can only be called on readable Handles");try{const t=Object.keys(this.options),n=Object.keys(e).filter(e=>!t.includes(e));if(n.length>0)throw new Error(`Invalid option in Handle.configure(): ${n}`);Object.assign(this.options,e)}catch(e){throw this.reportSystemExceptionInHost(e,"Handle::configure"),e}}_serialize(e){return d()(e,"can't serialize a null entity"),e instanceof De&&(De.isIdentified(e)||this.createIdentityFor(e)),e[xe].serialize()}createIdentityFor(e){De.createIdentity(e,Dt.fromString(this._id),this.idGenerator)}get type(){return this.storage.type}get _id(){return this.storage.id}get storage(){return this._storage}toManifestString(){return`'${this._id}'`}generateKey(){return this.idGenerator.newChildId(Dt.fromString(this._id),"key").toString()}disable(e){this.storage instanceof zt&&this.storage.deregister(e,this),this._storage=zt.newNoOpProxy(this.storage.id,this.storage.type)}}class Zt extends Vt{async _notify(e,t,n){switch(d()(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void await t.callOnHandleSync(this,this._restore(n),e=>this.reportUserExceptionInHost(e,t,"onHandleSync"));case"update":{const e={};return"add"in n&&(e.added=this._restore(n.add)),"remove"in n&&(e.removed=this._restore(n.remove)),e.originator=n.originatorId===this._particleId,void await t.callOnHandleUpdate(this,e,e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"))}case"desync":return void await t.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"));default:throw new Error("unsupported")}}async get(e){if(!this.canRead)throw new Error("Handle not readable");return this._restore([await this.storage.get(e)])[0]}async toList(){if(!this.canRead)throw new Error("Handle not readable");return this._restore(await this.storage.toList())}_restore(e){if(null==e)return null;const t=this.type.getContainedType();if(t instanceof nt)return e.map(e=>Wt(e,this.entityClass));if(t instanceof lt)return e.map(e=>new Oe(e,t,this.storage.pec));throw new Error(`Don't know how to deliver handle data of type ${this.type}`)}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),n=[this.generateKey()];return this.storage.store(t,n,this._particleId)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");if(this.storage.clear)return this.storage.clear(this._particleId);throw new Error("clear not implemented by storage")}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);await this.storage.remove(t.id,[],this._particleId)}get storage(){return this._storage}}class Jt extends Vt{async _notify(e,t,n){switch(d()(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void await t.callOnHandleSync(this,this._restore(n),e=>this.reportUserExceptionInHost(e,t,"onHandleSync"));case"update":{const e=this._restore(n.data),r=this._restore(n.oldData);return void await t.callOnHandleUpdate(this,{data:e,oldData:r},e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"))}case"desync":return void await t.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,t,"onHandleDesync"));default:throw new Error("unsupported")}}async get(){if(!this.canRead)throw new Error("Handle not readable");const e=await this.storage.get();return this._restore(e)}_restore(e){if(null==e)return null;if(this.type instanceof nt)return Wt(e,this.entityClass);if(this.type instanceof at)return At.fromLiteral(e);if(this.type instanceof lt)return new Oe(e,this.type,this.storage.pec);throw new Error(`Don't know how to deliver handle data of type ${this.type}`)}async set(e){try{if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);return this.storage.set(t,this._particleId)}catch(e){throw this.reportSystemExceptionInHost(e,"Handle::set"),e}}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this.storage.clear(this._particleId)}get storage(){return this._storage}}class Gt{constructor(e,t){this._parent=e,this._cursorId=t}async next(){const e=await this._parent.storage.cursorNext(this._cursorId);return e.done||(e.value=e.value.map(e=>Wt(e,this._parent.entityClass))),e}close(){this._parent.storage.cursorClose(this._cursorId)}}class Yt extends Vt{configure(e){throw new Error("BigCollections do not support sync/update configuration")}async _notify(e,t,n){d()(this.canRead,"_notify should not be called for non-readable handles"),d()("sync"===e,"BigCollection._notify only supports sync events"),await t.callOnHandleSync(this,[],e=>this.reportUserExceptionInHost(e,t,"onHandleSync"))}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),n=[this.generateKey()];return this.storage.store(t,n,this._particleId)}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);await this.storage.remove(t.id,[],this._particleId)}async stream({pageSize:e,forward:t=!0}){if(!this.canRead)throw new Error("Handle not readable");if(isNaN(e)||e<1)throw new Error("Streamed reads require a positive pageSize");const n=await this.storage.stream(e,t);return new Gt(this,n)}get storage(){return this._storage}}function Qt(e,t,n=null,r="",i=!0,s=!0){let o;o=e.type instanceof it?new Zt(e,t,n,r,i,s):e.type instanceof st?new Yt(e,t,n,r,i,s):new Jt(e,t,n,r,i,s);const a=e.type.getEntitySchema();return a&&(o.entityClass=a.entityClass(e.pec)),o}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Xt{constructor(){this.relevances=[],this._idle=Promise.resolve(),this._busy=0,this.slotProxiesByName=new Map,this.spec=this.constructor.spec,0===this.spec.inputs.length&&(this.extraData=!0)}setCapabilities(e){if(this.capabilities)throw new Error("capabilities should only be set once");this.capabilities=e||{}}async invokeSafely(e,t){try{this.startBusy(),await e(this)}catch(e){t(e)}finally{this.doneBusy()}}async callSetHandles(e,t){this.handles=e,await this.invokeSafely(async t=>t.setHandles(e),t)}async setHandles(e){}async callOnHandleSync(e,t,n){await this.invokeSafely(async n=>n.onHandleSync(e,t),n)}async onHandleSync(e,t){}async callOnHandleUpdate(e,t,n){await this.invokeSafely(async n=>n.onHandleUpdate(e,t),n)}async onHandleUpdate(e,t){}async callOnHandleDesync(e,t){await this.invokeSafely(async t=>t.onHandleDesync(e),t)}async onHandleDesync(e){}async constructInnerArc(){if(!this.capabilities.constructInnerArc)throw new Error("This particle is not allowed to construct inner arcs");return this.capabilities.constructInnerArc(this)}get busy(){return this._busy>0}get idle(){return this._idle}set relevance(e){this.relevances.push(e)}startBusy(){0===this._busy&&(this._idle=new Promise(e=>this._idleResolver=(()=>e()))),this._busy++}doneBusy(){this._busy--,0===this._busy&&this._idleResolver()}inputs(){return this.spec.inputs}outputs(){return this.spec.outputs}hasSlotProxy(e){return this.slotProxiesByName.has(e)}addSlotProxy(e){this.slotProxiesByName.set(e.slotName,e)}removeSlotProxy(e){this.slotProxiesByName.delete(e)}async service(e){return this.capabilities.serviceRequest?new Promise(t=>{this.capabilities.serviceRequest(this,e,e=>t(e))}):(console.warn(`${this.spec.name} has no service support.`),null)}getSlot(e){return this.slotProxiesByName.get(e)}getSlotNames(){return[...this.slotProxiesByName.keys()]}static buildManifest(e,...t){const n=[];for(let r=0;r<t.length;r++){const i=e[r],s=/ *$/.exec(i)[0];let o;o=(o="string"==typeof t[r]?t[r]:t[r].toManifestString()).replace(/(\n)/g,"$1"+s),n.push(i),n.push(o)}return e.length>t.length&&n.push(e[e.length-1]),n.join("")}async setParticleDescription(e){return this.setDescriptionPattern("pattern",e)}async setDescriptionPattern(e,t){const n=this.handles.get("descriptions");if(n){const r=n.entityClass;return(n instanceof Zt||n instanceof Yt)&&await n.store(new r({key:e,value:t},this.spec.name+"-"+e)),!0}throw new Error("A particle needs a description handle to set a decription pattern")}idFor(e){return De.id(e)}dataClone(e){return De.dataClone(e)}mutate(e,t){De.mutate(e,t)}output(e){const{output:t}=this.capabilities;t&&t(this,e)}renderSlot(e,t){}renderHostedSlot(e,t,n){}fireEvent(e,t){}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class en extends Xt{get template(){return""}getTemplate(e){return this.template}getTemplateName(e){return"default"}shouldRender(e){return!0}render(e){return{}}renderSlot(e,t){const n=this._getStateArgs(),r=this.getSlot(e);if(r){if(this.currentSlotName=e,t.forEach(e=>r.requestedContentTypes.add(e)),this.shouldRender(...n)){const e={};if(r.requestedContentTypes.has("template")&&(e.template=this.getTemplate(r.slotName)),r.requestedContentTypes.has("model")&&(e.model=this.render(...n)),e.templateName=this.getTemplateName(r.slotName),r.providedSlots.size>0&&(e.template&&("string"==typeof e.template?e.template=this.slotNamesToModelReferences(r,e.template):e.template=Object.entries(e.template).reduce((e,[t,n])=>(e[t]=this.slotNamesToModelReferences(r,n),e),{})),e.model)){const t={};r.providedSlots.forEach((e,n)=>t[`$${n}`]=e),e.model=this.enhanceModelWithSlotIDs(e.model,t)}r.render(e)}else r.isRendered&&r.render({});this.currentSlotName=void 0}}slotNamesToModelReferences(e,t){return e.providedSlots.forEach((e,n)=>{t=t.replace(new RegExp(`slotid="${n}"`,"gi"),`slotname="${n}" slotid$="{{$${n}}}"`)}),t}enhanceModelWithSlotIDs(e,t,n=!0){n&&(e={...t,...e}),e.hasOwnProperty("$template")&&e.hasOwnProperty("models")&&Array.isArray(e.models)&&(e.models=e.models.map(e=>this.enhanceModelWithSlotIDs(e,t)));for(const[n,r]of Object.entries(e))r&&"object"==typeof r&&(e[n]=this.enhanceModelWithSlotIDs(r,t,!1));return e}_getStateArgs(){return[]}forceRenderTemplate(e=""){this.slotProxiesByName.forEach((t,n)=>{e&&n!==e||t.requestedContentTypes.add("template")})}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n})}async setParticleDescription(e){if("string"==typeof e)return super.setParticleDescription(e);if(e.template&&e.model)return await super.setDescriptionPattern("_template_",e.template),void await super.setDescriptionPattern("_model_",JSON.stringify(e.model));throw new Error("Description pattern must either be string or have template and model")}async clearHandle(e){const t=this.handles.get(e);if(!(t instanceof Jt||t instanceof Zt))throw new Error("Singleton/Collection required");await t.clear()}async mergeEntitiesToHandle(e,t){const n={},r=this.handles.get(e);if(!(r instanceof Zt))throw new Error("Collection required");(await r.toList()).forEach(e=>n[e.id]=e);for(const e of t)n[this.idFor(e)]||await r.store(e)}async appendEntitiesToHandle(e,t){const n=this.handles.get(e);if(n){if(!(n instanceof Zt||n instanceof Yt))throw new Error("Collection required");await Promise.all(t.map(e=>n.store(e)))}}async appendRawDataToHandle(e,t){const n=this.handles.get(e);if(n&&n.entityClass){if(!(n instanceof Zt||n instanceof Yt))throw new Error("Collection required");{const e=n.entityClass;await Promise.all(t.map(t=>n.store(new e(t))))}}}async updateSingleton(e,t){const n=this.handles.get(e);if(n&&n.entityClass){if(n instanceof Jt){const e=new n.entityClass(t);return await n.set(e),e}throw new Error("Singleton required")}throw new Error(`Handle ${e} does not exist`)}async updateCollection(e,t){const n=this.handles.get(e);if(n){if(!(n instanceof Zt||n instanceof Yt))throw new Error("Collection required");await n.remove(t),await n.store(t)}}async derefShares(e){let t=[];this.startBusy();try{const n=e.map(async e=>e.ref.dereference());t=await Promise.all(n)}finally{this.doneBusy()}return t}async boxQuery(e,t){if(e){const n=e.filter(e=>t===e.fromKey);return await this.derefShares(n)}return[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class tn extends(ae(en)){willReceiveProps(...e){}update(...e){}shouldRender(...e){return!0}render(...e){return{}}setState(e){return this._setState(e)}get state(){return this._state}set state(e){this.setState(e)}get props(){return this._props}get config(){return{handleNames:this.spec.inputs.map(e=>e.name),slotNames:this.spec.slandleConnectionNames()}}_willReceiveProps(...e){this.willReceiveProps(...e)}_update(...e){this.update(...e),this.shouldRender(...e)&&(this.relevance=1),this.config.slotNames.forEach(e=>this.renderSlot(e,["model"]))}_async(e){this.startBusy();return setTimeout(()=>{try{e.call(this)}finally{this.doneBusy()}},10)}async setHandles(e){this.configureHandles(e),this.handles=e,this._invalidate()}configureHandles(e){}async onHandleSync(e,t){this._setProperty(e.name,t)}async onHandleUpdate({name:e},{data:t,added:n,removed:r}){if(void 0!==t&&this._setProps({[e]:t}),n){const t=(this.props[e]||[]).concat(n);this._props[e]=t,this._setProps({[e]:t})}if(r){const t=this.props[e];Array.isArray(t)&&(r.forEach(e=>{const n=t.findIndex(t=>this.idFor(t)===this.idFor(e));n>=0?t.splice(n,1):console.warn("dom-particle::onHandleUpdate: couldn't find item to remove")}),this._setProps({[e]:t}))}}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n},this._state)}debounce(e,t,n){const r=`_debounce_${e}`,i=this.state;i[r]||(i[r]=!0,this.startBusy());super._debounce(e,()=>{this.doneBusy(),t(),i[r]=null},n)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class nn extends tn{getTemplate(e){return this._state.template}getTemplateName(e){return this._state.templateName}render(e,t){return t.renderModel}shouldRender(e,t){return Boolean((t.template||t.templateName)&&t.renderModel)}renderHostedSlot(e,t,n){this.combineHostedTemplate(e,t,n),this.combineHostedModel(e,t,n)}combineHostedTemplate(e,t,n){}combineHostedModel(e,t,n){}static propsToItems(e){return e?e.map(e=>({subId:De.id(e),...e})):[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class rn extends nn{constructor(){super(...arguments),this._itemSubIdByHostedSlotId=new Map,this._connByHostedConn=new Map}async _mapParticleConnections(e,t,n,r,i){const s=[],o=[];let a=2;const c=[e,t];for(const[e,t]of r){if(c.includes(e))continue;const r=t.storage;s.push(`use '${await i.mapHandle(r)}' as v${a}`);const l=n.handleConnections.find(e=>e.isCompatibleType(t.type));l&&(o.push(`${l.name} = v${a++}`),this._connByHostedConn.set(l.name,e))}return[s,o]}async setHandles(e){this.handleIds={};const t=await this.constructInnerArc(),n=e.get("hostedParticle");let r=null,i=[],s=[];n&&(r=await n.get())&&([i,s]=await this._mapParticleConnections("list","hostedParticle",r,e,t)),this.setState({arc:t,type:e.get("list").type,hostedParticle:r,otherMappedHandles:i,otherConnections:s}),await super.setHandles(e)}async update({list:e},{arc:t,type:n,hostedParticle:r,otherMappedHandles:i,otherConnections:s},o,a){if(e&&t&&(o.list!==e||a.arc!==t)){e.length>0&&(this.relevance=.1);for(const[o,a]of this.getListEntries(e)){let e=r;const c=De.id(a);if(this.handleIds[c]){(await this.handleIds[c]).set(a);continue}const l=t.createHandle(n.getContainedType(),`item${o}`);this.handleIds[c]=l;const h=await l;if(!e){if(!a.renderParticleSpec)continue;e=At.fromLiteral(JSON.parse(a.renderParticleSpec));const n="list",r="renderParticle";[i,s]=await this._mapParticleConnections(n,r,e,this.handles,t)}const u=e.slandleConnectionNames()[0],p=this.spec.slandleConnectionNames();d()(p.length>0,"there must be at least one slot");const f=p[0],m=await t.createSlot(this,f,h._id);if(m){this._itemSubIdByHostedSlotId.set(m,c);try{const n=this.constructInnerRecipe(e,a,h,{name:u,id:m},{connections:s,handles:i});await t.loadRecipe(n),h.set(a)}catch(e){console.log(e)}}}}}combineHostedModel(e,t,n){const r=this._itemSubIdByHostedSlotId.get(t);if(!r)return;const i=this._state.renderModel?this._state.renderModel.items:[],s=i.findIndex(e=>e.subId===r),o={...n.model,subId:r};s>=0&&s<i.length?i[s]=o:i.push(o),this.setState({renderModel:{items:i}})}combineHostedTemplate(e,t,n){const r=this._itemSubIdByHostedSlotId.get(t);if(!r)return;d()(n.templateName,`Template name is missing for slot '${e}' (hosted slot ID: '${t}')`);const i={...this._state.templateName,[r]:`${n.templateName}`};if(this.setState({templateName:i}),n.template){let e=n.template;e=e.replace(new RegExp('slotid="[a-z]+"',"gi"),'$& subid$="{{subId}}"'),this._connByHostedConn.forEach((t,n)=>{e=e.replace(new RegExp(`{{${n}.description}}`,"g"),`{{${t}.description}}`)}),this.setState({template:{...this._state.template,[n.templateName]:e}}),this.forceRenderTemplate()}}getListEntries(e){return e.entries()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const sn=(e,...t)=>(e[0]+t.map((t,n)=>t+e[n+1]).join("")).trim();class on{path(e){return e.replace(/[\/][^\/]+$/,"/")}join(e,t){return/^https?:\/\//.test(t)?t:"/"===t[0]||":"===t[1]?t:(e=this.path(e),t=this.normalizeDots(`${e}${t}`))}normalizeDots(e){const t=e=>e.replace(/(?:^|\/)[^.\/]*\/\.\./g,"");for(let n=t(e=(e=e.replace(/\\/g,"/")).replace(/\/\.\//g,"/"));n!==e;n=t(e=n));return e=e.replace(/([^:])(\/\/)/g,"$1/")}async loadResource(e){return/^https?:\/\//.test(e)?this._loadURL(e):this.loadFile(e,"utf-8")}async loadWasmBinary(e){this.mapParticleUrl(e.implFile);const t=this.resolve(e.implFile);return/^https?:\/\//.test(t)?te(t).then(e=>e.arrayBuffer()):this.loadFile(t)}mapParticleUrl(e){}resolve(e){return e}async loadFile(e,t){return new Promise((n,r)=>{o.a.readFile(e,{encoding:t},(e,i)=>{e?r(e):n(t?i:i.buffer)})})}async _loadURL(e){const t=e=>te(e).then(async e=>e.ok?e.text():Promise.reject(new Error(`HTTP ${e.status}: ${e.statusText}`)));return/\/\/schema.org\//.test(e)?e.endsWith("/Thing")?t("https://schema.org/Product.jsonld").then(e=>se.convert(e,{"@id":"schema:Thing"})):t(e+".jsonld").then(e=>se.convert(e)):t(e)}async loadParticleClass(e){const t=await this.requireParticle(e.implFile);return t.spec=e,t}async requireParticle(e){null===e&&(e="");const t=await this.loadResource(e),n=new re.a.Script(t,{filename:e,displayErrors:!0}),r=[],i={defineParticle(e){r.push(e)},console:console,fetch:te,setTimeout:setTimeout,importScripts:e=>null};return n.runInNewContext(i,{filename:e,displayErrors:!0}),d()(r.length>0&&"function"==typeof r[0],`Error while instantiating particle implementation from ${e}`),this.unwrapParticle(r[0])}setParticleExecutionContext(e){this.pec=e}unwrapParticle(e){return d()(this.pec),e({Particle:Xt,DomParticle:tn,TransformationDomParticle:nn,MultiplexerDomParticle:rn,Reference:Ne.newClientReference(this.pec),html:sn})}clone(){return new on}}class an extends Error{constructor(e,t,n,r){super(),this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,an)}static buildMessage(e,t){function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,e=>"\\x0"+n(e)).replace(/[\x10-\x1F\x7F-\x9F]/g,e=>"\\x"+n(e))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,e=>"\\x0"+n(e)).replace(/[\x10-\x1F\x7F-\x9F]/g,e=>"\\x"+n(e))}function s(e){switch(e.type){case"literal":return'"'+r(e.text)+'"';case"class":const t=e.parts.map(e=>Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e));return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){const t=e.map(s);let n,r;if(t.sort(),t.length>0){for(n=1,r=1;n<t.length;n++)t[n-1]!==t[n]&&(t[r]=t[n],r++);t.length=r}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+((o=t)?'"'+r(o)+'"':"end of input")+" found.";var o}}const cn=function(e,t){t=void 0!==t?t:{};const n={},r={Manifest:zs};let i=zs;const s=function(e){const t=e.map(e=>{const t=e[2],n=e[0];return t.triggers=n.triggerSet,t.annotation=n.simpleAnnotation,t});return function e(t){if(!["string","number","boolean"].includes(typeof t)&&null!==t)if(void 0===t&&Ps("result was undefined"),Array.isArray(t))for(const n of t)e(n);else{t.model&&Ps(`unexpected 'model' in ${JSON.stringify(t)}`),t.location||Ps(`no 'location' in ${JSON.stringify(t)}`),t.kind||Ps(`no 'kind' in ${JSON.stringify(t)}`);for(const n of Object.keys(t))["location","kind"].includes(n)||e(t[n])}}(t),t},o=function(e,t){return{triggerSet:e.map(e=>e[1]),simpleAnnotation:Yo(t,e=>e[1],null)}},a=Ns("a trigger for a recipe"),c="@trigger",l=Ms("@trigger",!1),h=function(e){return e.map(e=>[e[2],e[4]])},u=Ns("an annotation (e.g. @foo)"),d="@",p=Ms("@",!1),f=function(e){return e},m="resource",g=Ms("resource",!1),y=function(e,t){return{kind:"resource",name:e,data:t,location:As()}},_="start",v=Ms("start",!1),w=function(){Vo=Wo},b=function(e){return e.map(e=>e[0].substring(Vo.length)+e[1]).join("")},S=/^[^\n]/,C=Os(["\n"],!0,!1),k=function(){return Rs()},x="store",T=Ms("store",!1),E="of",I=Ms("of",!1),R="!!",A=Ms("!!",!1),$=function(e,t,n,r,i,s,o,a){a=Yo(a,Go,[]);let c=null,l=null;for(const e of a)"description"===e[0]?(c&&Ps("You cannot provide more than one description."),c=e[2]):"manifest-storage-claim"===e.kind?(l&&Ps("You cannot provide more than one claim."),l=e):Ps(`Unknown ManifestStorageItem: ${e}`);return{kind:"store",location:As(),name:e,type:t,id:Yo(n,e=>e[1],null),originalId:Yo(r,e=>e[1],null),version:Yo(i,e=>e[1],null),tags:Yo(s,e=>e[1],null),source:o.source,origin:o.origin,description:c,claim:l}},P="in",M=Ms("in",!1),O=function(e){return{origin:"file",source:e}},N=function(e){return{origin:"resource",source:e}},B="at",D=Ms("at",!1),j=function(e){return{origin:"storage",source:e}},F="description",z=Ms("description",!1),H="claim",L=Ms("claim",!1),U="is",q=Ms("is",!1),K="and",W=Ms("and",!1),V=function(e,t){return{kind:"manifest-storage-claim",location:As(),tags:[e,...t.map(e=>e[5])]}},Z="import",J=Ms("import",!1),G=function(e){return{kind:"import",location:As(),path:e}},Y=Ns("an interface"),Q="interface",X=Ms("interface",!1),ee="<",te=Ms("<",!1),ne=">",re=Ms(">",!1),ie=function(e,t,n){return{kind:"interface",location:As(),name:e,args:Yo(n,Go,[]).filter(e=>"interface-argument"===e.kind),slots:Yo(n,Go,[]).filter(e=>"interface-slot"===e.kind)}},se="*",oe=Ms("*",!1),ae=function(e,t,n){return"host"===(e=Yo(e,e=>e[0],"any"))&&Ps("Interface cannot have arguments with a 'host' direction."),{kind:"interface-argument",location:As(),direction:e,type:Yo(t,e=>e[0],null),name:n}},ce="must",le=Ms("must",!1),he="consume",ue=Ms("consume",!1),de="provide",pe=Ms("provide",!1),fe="set of",me=Ms("set of",!1),ge=function(e,t,n,r){return{kind:"interface-slot",location:As(),name:Yo(r,e=>r[1],null),isRequired:Yo(e,e=>"must"===e[0],!1),direction:t,isSet:!!n}},ye="meta",_e=Ms("meta",!1),ve=function(e){return{kind:"meta",items:e=e?Go(e):[],location:As()}},we="name",be=Ms("name",!1),Se=":",Ce=Ms(":",!1),ke=function(e){return{key:"name",value:e,location:As(),kind:"name"}},xe="storageKey",Te=Ms("storageKey",!1),Ee=function(e){return{key:"storageKey",value:e,location:As(),kind:"storageKey"}},Ie="particle",Re=Ms("particle",!1),Ae=function(e,t,n,r){let i=[];const s=[],o=[],a=[],c=[];let l=null,h=!1;return t=Yo(t,e=>e[1],[]),(r=Yo(r,Go,[])).forEach(n=>{"particle-interface"===n.kind?(/[A-Z]/.test(n.verb[0])&&n.verb!==e&&Ps(`Verb ${n.verb} must start with a lower case character or be same as particle name.`),t.push(n.verb),i=n.args,h=!0):"particle-argument"===n.kind?i.push(n):"particle-slot"===n.kind?o.push(n):"description"===n.kind?(l={kind:"description",location:As()},n.description.forEach(e=>l[e.name]=e.pattern||e.patterns[0])):"particle-trust-claim"===n.kind?a.push(n):"particle-trust-check"===n.kind?c.push(n):n.modality?s.push(n.modality):Ps(`Particle ${e} contains an unknown element: ${n.name} / ${n.kind}`)}),0===s.length&&s.push("dom"),{kind:"particle",location:As(),name:e,implFile:Yo(n,e=>e[3],null),verbs:t,args:i,modality:s,slotConnections:o,description:l,hasParticleHandleConnection:h,trustClaims:a,trustChecks:c}},$e=Ns("a particle item"),Pe=function(e,t){return{kind:"particle-trust-claim",location:As(),handle:e,expression:t}},Me=function(e,t){return[e,...t.map(e=>e[3])]},Oe="not",Ne=Ms("not",!1),Be=function(e,t){return{kind:"particle-trust-claim-is-tag",claimType:"is-tag",location:As(),isNot:null!=e,tag:t}},De="derives from",je=Ms("derives from",!1),Fe=function(e){return{kind:"particle-trust-claim-derives-from",claimType:"derives-from",location:As(),parentHandle:e}},ze="check",He=Ms("check",!1),Le=function(e,t){return{kind:"particle-trust-check",location:As(),target:e,expression:t}},Ue="data",qe=Ms("data",!1),Ke=function(e,t){return{kind:"particle-check-target",location:As(),targetType:t?"slot":"handle",name:e}},We="or",Ve=Ms("or",!1),Ze=function(e,t){if(0===t.length)return e;new Set(t.map(e=>e[1])).size>1&&$s("You cannot combine 'and' and 'or' operations in a single check expression. You must nest them inside parentheses.");const n=t[0][1];return{kind:"particle-trust-check-boolean-expression",location:As(),operator:n,children:[e,...t.map(e=>e[3])]}},Je=function(e){return e},Ge="(",Ye=Ms("(",!1),Qe=")",Xe=Ms(")",!1),et=function(e,t){return{kind:"particle-trust-check-has-tag",checkType:"has-tag",location:As(),isNot:!!e,tag:t}},tt="from",nt=Ms("from",!1),rt="handle",it=Ms("handle",!1),st=function(e,t){return{kind:"particle-trust-check-is-from-handle",checkType:"is-from-handle",location:As(),isNot:!!e,parentHandle:t}},ot="output",at=Ms("output",!1),ct=function(e,t){return{kind:"particle-trust-check-is-from-output",checkType:"is-from-output",location:As(),isNot:!!e,output:t}},lt=function(e,t){return{kind:"particle-trust-check-is-from-store",checkType:"is-from-store",location:As(),isNot:!!e,storeRef:t}},ht=function(e){return{kind:"store-reference",location:As(),type:"name",store:e}},ut=function(e){return{kind:"store-reference",location:As(),type:"id",store:e}},dt=function(e,t){return e.dependentConnections=Yo(t,Go,[]),e},pt="?",ft=Ms("?",!1),mt=function(e,t,n,r){return{kind:"particle-argument",location:As(),direction:e,type:n,isOptional:!!t,dependentConnections:[],name:r.name,tags:r.tags}},gt=Ns("a direction (e.g. inout, in, out, host, `consume, `provide, any)"),yt="inout",_t=Ms("inout",!1),vt="out",wt=Ms("out",!1),bt="host",St=Ms("host",!1),Ct="`consume",kt=Ms("`consume",!1),xt="`provide",Tt=Ms("`provide",!1),Et="any",It=Ms("any",!1),Rt=function(){const e=Rs();return null===e&&$s("a direction"),e},At=Ns("a direction arrow (e.g. <-, ->, <->, =, consume, provide)"),$t="<->",Pt=Ms("<->",!1),Mt="<-",Ot=Ms("<-",!1),Nt="->",Bt=Ms("->",!1),Dt="=",jt=Ms("=",!1),Ft=function(){const e=Rs();return null===e&&$s("a direction arrow"),e},zt="[",Ht=Ms("[",!1),Lt="]",Ut=Ms("]",!1),qt=function(e){return{kind:"collection-type",location:As(),type:e}},Kt="BigCollection<",Wt=Ms("BigCollection<",!1),Vt=function(e){return{kind:"big-collection-type",location:As(),type:e}},Zt="Reference<",Jt=Ms("Reference<",!1),Gt=function(e){return{kind:"reference-type",location:As(),type:e}},Yt=Ns("a type variable (e.g. ~foo)"),Qt="~",Xt=Ms("~",!1),en="with",tn=Ms("with",!1),nn=function(e,t){return{kind:"variable-type",location:As(),name:e,constraint:Yo(t,e=>e[3],null)}},rn="Slot",sn=Ms("Slot",!1),on=/^[^a-z0-9_]/i,cn=Os([["a","z"],["0","9"],"_"],!0,!0),ln="{",hn=Ms("{",!1),un=",",dn=Ms(",",!1),pn="}",fn=Ms("}",!1),mn=function(e){return e=Yo(e,e=>{const t=e[2];return[t[0]].concat(t[1].map(e=>e[2]))},[]),{kind:"slot-type",location:As(),fields:e}},gn=function(e,t){return{kind:"slot-field",location:As(),name:e,value:t}},yn=function(e){return{kind:"type-name",location:As(),name:e}},_n=function(e,t){return[e,...t.map(e=>e[2])]},vn="modality",wn=Ms("modality",!1),bn=function(e){return{kind:"particle-modality",location:As(),modality:e}},Sn=function(e,t,n,r,i){let s=null;const o=[];return(i=Yo(i,Go,[])).forEach(e=>{"provided-slot"===e.kind?o.push(e):"form-factor"===e.kind?(s&&Ps("duplicate form factor for a slot"),s=e.formFactor):Ps("Unsupported particle slot item ",e)}),{kind:"particle-slot",location:As(),name:n,tags:Yo(r,e=>e[1],[]),isRequired:Yo(e,e=>"must"===e[0],!1),isSet:!!t,formFactor:s,provideSlotConnections:o}},Cn="formFactor",kn=Ms("formFactor",!1),xn="fullscreen",Tn=Ms("fullscreen",!1),En="big",In=Ms("big",!1),Rn="medium",An=Ms("medium",!1),$n="small",Pn=Ms("small",!1),Mn=function(e){return{kind:"form-factor",location:As(),formFactor:e}},On=function(e,t,n,r,i){let s=null;const o=[];return(i=i?Go(i):[]).forEach(e=>{"form-factor"===e.kind?(s&&Ps("duplicate form factor for a slot"),s=e.formFactor):o.push(e.handle)}),{kind:"provided-slot",location:As(),name:n,tags:Yo(r,e=>e[1],[]),isRequired:Yo(e,e=>"must"===e[0],!1),isSet:!!t,formFactor:s,handles:o}},Nn=function(e){return{kind:"particle-provided-slot-handle",location:As(),handle:e}},Bn=function(e,t){t=Yo(t,Go,[]);const n=[];return e&&n.push(e),t.filter(e=>"pattern"===e.name).forEach(e=>n.push(e)),t=t.filter(e=>"pattern"!==e.name),{kind:"description",location:As(),description:[{kind:"default-description?",location:As(),name:"pattern",patterns:n},...t]}},Dn=function(e,t){return{kind:"handle-description",location:As(),name:e,pattern:t}},jn="recipe",Fn=Ms("recipe",!1),zn=function(e,t,n){return t=Yo(t,e=>e[1],[]),{kind:"recipe",location:As(),name:Yo(e,e=>e[1],null),verbs:t,items:Yo(n,Go,[])}},Hn="as",Ln=Ms("as",!1),Un=/^[a-zA-Z0-9]/,qn=Os([["a","z"],["A","Z"],["0","9"]],!1,!1),Kn=function(){$s("lower identifier")},Wn=function(e){return e},Vn=function(e,t,n){const r=[],i=[];if(n){n=Go(n);for(const e of n)"handle-connection"===e.kind?r.push(e):i.push(e)}return{kind:"particle",location:As(),name:Yo(t,e=>e[1],null),ref:e,connections:r,slotConnections:i}},Zn=function(e,t,n,r){return{kind:"handle-connection",location:As(),param:e,dir:t,target:Yo(n,e=>e[1],null),dependentConnections:Yo(r,Go,[])}},Jn=function(e,t){let n=null,r=null;return(e=Yo(e,e=>e,null))&&(e[0].toUpperCase()===e[0]?r=e:n=e),{kind:"handle-connection-components",location:As(),name:n,particle:r,tags:Yo(t,e=>e,[])}},Gn=function(e,t,n,r){return{kind:"slot-connection",location:As(),direction:e,param:t.param,tags:t.tags,name:Yo(n,e=>e[1],null),dependentSlotConnections:Yo(r,Go,[])}},Yn=function(e,t){return{kind:"slot-connection-ref",location:As(),param:e,tags:t||[]}},Qn=function(e,t,n){return{kind:"connection",location:As(),direction:t,from:e,to:n}},Xn="search",er=Ms("search",!1),tr="tokens",nr=Ms("tokens",!1),rr=function(e,t){return{kind:"search",location:As(),phrase:e,tokens:Yo(t,e=>e[1][2].map(e=>e[1]),null)}},ir=function(e,t){const{param:n,tags:r}=Yo(t,e=>e,{param:null,tags:[]});return{kind:"connection-target",location:As(),targetType:"verb",verbs:e,param:n,tags:r}},sr=function(e){return{kind:"connection-target",location:As(),targetType:"tag",tags:e}},or=function(e,t){const{param:n,tags:r}=Yo(t,e=>e,{param:null,tags:[]});return{kind:"connection-target",targetType:"localName",location:As(),name:e,param:n,tags:r}},ar=function(e,t){const{param:n,tags:r}=Yo(t,e=>e,{param:null,tags:[]});return{kind:"connection-target",targetType:"particle",location:As(),particle:e,param:n,tags:r}},cr=".",lr=Ms(".",!1),hr=function(e,t){return{param:Yo(e,e=>e,null),tags:Yo(t,e=>e[1],[])}},ur="use",dr=Ms("use",!1),pr="map",fr=Ms("map",!1),mr="create",gr=Ms("create",!1),yr="copy",_r=Ms("copy",!1),vr="`slot",wr=Ms("`slot",!1),br=function(e,t,n){return{kind:"handle",location:As(),name:Yo(n,e=>e[1],null),ref:Yo(t,e=>e[1],Jo()),fate:e}},Sr="require",Cr=Ms("require",!1),kr=function(e){return{kind:"require",location:As(),items:Go(e)}},xr=function(e,t){return{kind:"requireHandle",location:As(),name:Yo(e,e=>e[1],null),ref:Yo(t,e=>e[1],Jo())}},Tr="#",Er=Ms("#",!1),Ir=function(e){return e},Rr=function(e,t){return[e,...t&&t[1]||[]]},Ar=Ns("a verb (e.g. &Verb)"),$r="&",Pr=Ms("&",!1),Mr=function(e){return e},Or=function(e){return e},Nr=function(e,t){return{location:As(),name:e,tags:t=Yo(t,e=>e[1],[])}},Br=function(e){return{location:As(),name:e,tags:[]}},Dr=function(e){return{location:As(),name:e[0],tags:e}},jr=function(e){return{kind:"particle-ref",location:As(),name:e,verbs:[],tags:[]}},Fr=function(e){return{kind:"particle-ref",location:As(),verbs:[e],tags:[]}},zr=function(e,t){return{kind:"handle-ref",location:As(),id:e,tags:t||[]}},Hr=function(e,t){return{kind:"handle-ref",location:As(),name:e,tags:t||[]}},Lr=function(e){return{kind:"handle-ref",location:As(),tags:e}},Ur="slot",qr=Ms("slot",!1),Kr=function(e,t){return{kind:"slot",location:As(),ref:Yo(e,e=>e[1],Jo()),name:Yo(t,e=>e[1],"")}},Wr=function(e,t){return{kind:"schema-inline",location:As(),names:Yo(e,e=>e.map(e=>e[0]).filter(e=>"*"!==e),[]),fields:Yo(t,e=>[e[0],...e[1].map(e=>e[2])],[])}},Vr=function(e,t){return{kind:"schema-inline-field",location:As(),name:t,type:Yo(e,e=>e[0],null)}},Zr="schema",Jr=Ms("schema",!1),Gr=function(e,t){return{names:e.map(e=>e[1]).filter(e=>"*"!==e),parents:Yo(t,e=>e,[])}},Yr="alias",Qr=Ms("alias",!1),Xr=function(e,t,n){return{kind:"schema",location:As(),items:Yo(n,Go,[]),alias:t,...e}},ei=function(e,t){return{kind:"schema",location:As(),items:Yo(t,Go,[]),...e}},ti="extends",ni=Ms("extends",!1),ri=function(e,t){return[e,...t.map(e=>e[3])]},ii=function(e,t){return{kind:"schema-field",location:As(),type:e,name:t}},si=function(e){return{kind:"schema-collection",location:As(),schema:e}},oi=function(e){return{kind:"schema-reference",location:As(),schema:e}},ai="Text",ci=Ms("Text",!1),li="URL",hi=Ms("URL",!1),ui="Number",di=Ms("Number",!1),pi="Boolean",fi=Ms("Boolean",!1),mi="Bytes",gi=Ms("Bytes",!1),yi=function(e){return{kind:"schema-primitive",location:As(),type:e}},_i=function(e,t){const n=[e];for(const e of t)n.push(e[3]);return{kind:"schema-union",location:As(),types:n}},vi=function(e,t){const n=[e];for(const e of t)n.push(e[3]);return{kind:"schema-tuple",location:As(),types:n}},wi=Ns("a version number (e.g. @012)"),bi=/^[0-9]/,Si=Os([["0","9"]],!1,!1),Ci=function(e){return Number(e.join(""))},ki=Ns("indentation"),xi=" ",Ti=Ms(" ",!1),Ei=function(e){return(e=e.join("")).length>Wo.length&&(Zo.push(Wo),Wo=e,!0)},Ii=Ns("same indentation"),Ri=function(e){return(e=e.join("")).length===Wo.length||e.length<Wo.length&&(Wo=Zo.pop(),!1)},Ai=Ns("same or more indentation"),$i=function(e){return(e=e.join("")).length>=Wo.length||(e.length<Wo.length?(Wo=Zo.pop(),!1):void 0)},Pi=/^[^a-zA-Z0-9_]/,Mi=Os([["a","z"],["A","Z"],["0","9"],"_"],!0,!1),Oi={type:"any"},Ni=function(e){$s("identifier")},Bi=Ns("a `backquoted string`"),Di="`",ji=Ms("`",!1),Fi=/^[^`]/,zi=Os(["`"],!0,!1),Hi=function(e){return e.join("")},Li=Ns("an identifier (e.g. 'id')"),Ui="'",qi=Ms("'",!1),Ki=/^[^'\n]/,Wi=Os(["'","\n"],!0,!1),Vi=function(e){$s("' at the end of an identifier")},Zi=function(e){return e.join("")},Ji=Ns("an uppercase identifier (e.g. Foo)"),Gi=/^[A-Z]/,Yi=Os([["A","Z"]],!1,!1),Qi=/^[a-z0-9_]/i,Xi=Os([["a","z"],["0","9"],"_"],!1,!0),es=Ns("a lowercase identifier (e.g. foo)"),ts=/^[a-z]/,ns=Os([["a","z"]],!1,!1),rs=Ns("a field name (e.g. foo9)"),is=Ns("a name conforming to the rules of an android app name, per https://developer.android.com/guide/topics/manifest/manifest-element.html#package"),ss=Ns("a name starting with a letter and containing letters, digits and underscores"),os=/^[a-zA-Z]/,as=Os([["a","z"],["A","Z"]],!1,!1),cs=/^[a-zA-Z0-9_]/,ls=Os([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),hs=function(){return Rs()},us=Ns("one or more whitespace characters"),ds=Ns("a group of new lines (and optionally comments)"),ps=/^[ ]/,fs=Os([" "],!1,!1),ms="//",gs=Ms("//",!1),ys=Ns("a new line"),_s="\r",vs=Ms("\r",!1),ws="\n",bs=Ms("\n",!1);let Ss=0,Cs=0;const ks=[{line:1,column:1}];let xs,Ts=0,Es=[],Is=0;if(void 0!==t.startRule){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=r[t.startRule]}function Rs(){return e.substring(Cs,Ss)}function As(){return Ds(Cs,Ss)}function $s(t,n){throw n=void 0!==n?n:Ds(Cs,Ss),Fs([Ns(t)],e.substring(Cs,Ss),n)}function Ps(e,t){throw function(e,t){return new an(e,[],"",t)}(e,t=void 0!==t?t:Ds(Cs,Ss))}function Ms(e,t){return{type:"literal",text:e,ignoreCase:t}}function Os(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function Ns(e){return{type:"other",description:e}}function Bs(t){let n,r=ks[t];if(r)return r;for(n=t-1;!ks[n];)n--;for(r={line:(r=ks[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return ks[t]=r,r}function Ds(e,t){const n=Bs(e),r=Bs(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function js(e){Ss<Ts||(Ss>Ts&&(Ts=Ss,Es=[]),Es.push(e))}function Fs(e,t,n){return new an(an.buildMessage(e,t),e,t,n)}function zs(){let e,t,r,i,o,a,c,l;if(e=Ss,(t=qo())===n&&(t=null),t!==n)if((r=Mo())===n&&(r=null),r!==n){for(i=[],o=Ss,(a=Ls())!==n&&(c=Oo())!==n&&(l=Hs())!==n?o=a=[a,c,l]:(Ss=o,o=n);o!==n;)i.push(o),o=Ss,(a=Ls())!==n&&(c=Oo())!==n&&(l=Hs())!==n?o=a=[a,c,l]:(Ss=o,o=n);i!==n?(Cs=e,e=t=s(i)):(Ss=e,e=n)}else Ss=e,e=n;else Ss=e,e=n;return e}function Hs(){let t;return(t=function(){let t,r,i,s,o,a,c,l,h,u,d;if(t=Ss,e.substr(Ss,6)===jn?(r=jn,Ss+=6):(r=n,0===Is&&js(Fn)),r!==n)if(i=Ss,(s=Uo())!==n&&(o=jo())!==n?i=s=[s,o]:(Ss=i,i=n),i===n&&(i=null),i!==n)if(s=Ss,(o=Uo())!==n&&(a=So())!==n?s=o=[o,a]:(Ss=s,s=n),s===n&&(s=null),s!==n)if((o=qo())!==n){if(a=Ss,(c=Mo())!==n){for(l=[],h=Ss,(u=Oo())!==n&&(d=uo())!==n?h=u=[u,d]:(Ss=h,h=n);h!==n;)l.push(h),h=Ss,(u=Oo())!==n&&(d=uo())!==n?h=u=[u,d]:(Ss=h,h=n);l!==n?a=c=[c,l]:(Ss=a,a=n)}else Ss=a,a=n;a===n&&(a=null),a!==n?(Cs=t,r=zn(i,s,a),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;if(t=Ss,e.substr(Ss,8)===Ie?(r=Ie,Ss+=8):(r=n,0===Is&&js(Re)),r!==n)if((i=Uo())!==n)if((s=jo())!==n)if(o=Ss,(a=Uo())!==n&&(c=So())!==n?o=a=[a,c]:(Ss=o,o=n),o===n&&(o=null),o!==n)if(a=Ss,(c=Uo())!==n?(e.substr(Ss,2)===P?(l=P,Ss+=2):(l=n,0===Is&&js(M)),l!==n&&(h=Uo())!==n&&(u=Do())!==n?a=c=[c,l,h,u]:(Ss=a,a=n)):(Ss=a,a=n),a===n&&(a=null),a!==n)if((c=qo())!==n){if(l=Ss,(h=Mo())!==n){for(u=[],d=Ss,(p=Oo())!==n&&(f=Zs())!==n?d=p=[p,f]:(Ss=d,d=n);d!==n;)u.push(d),d=Ss,(p=Oo())!==n&&(f=Zs())!==n?d=p=[p,f]:(Ss=d,d=n);u!==n?l=h=[h,u]:(Ss=l,l=n)}else Ss=l,l=n;l===n&&(l=null),l!==n?((h=qo())===n&&(h=null),h!==n?(Cs=t,r=Ae(s,o,a,l),t=r):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o;return t=Ss,e.substr(Ss,6)===Z?(r=Z,Ss+=6):(r=n,0===Is&&js(J)),r!==n&&(i=Uo())!==n&&(s=Do())!==n&&(o=qo())!==n?(Cs=t,r=G(s),t=r):(Ss=t,t=n),t}())===n&&(t=function(){let e,t,r,i,s,o,a,c,l;if(e=Ss,(t=Io())!==n)if((r=qo())!==n){if(i=Ss,(s=Mo())!==n){for(o=[],a=Ss,(c=Oo())!==n&&(l=Ro())!==n?a=c=[c,l]:(Ss=a,a=n);a!==n;)o.push(a),a=Ss,(c=Oo())!==n&&(l=Ro())!==n?a=c=[c,l]:(Ss=a,a=n);o!==n?i=s=[s,o]:(Ss=i,i=n)}else Ss=i,i=n;i===n&&(i=null),i!==n?(Cs=e,t=ei(t,i),e=t):(Ss=e,e=n)}else Ss=e,e=n;else Ss=e,e=n;return e}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;if(t=Ss,e.substr(Ss,5)===Yr?(r=Yr,Ss+=5):(r=n,0===Is&&js(Qr)),r!==n)if((i=Uo())!==n)if((s=Io())!==n)if((o=Uo())!==n)if((a=function(){let t,r,i,s;return t=Ss,e.substr(Ss,2)===Hn?(r=Hn,Ss+=2):(r=n,0===Is&&js(Ln)),r!==n&&(i=Uo())!==n&&(s=jo())!==n?(Cs=t,r=Wn(s),t=r):(Ss=t,t=n),t}())!==n)if((c=qo())!==n){if(l=Ss,(h=Mo())!==n){for(u=[],d=Ss,(p=Oo())!==n&&(f=Ro())!==n?d=p=[p,f]:(Ss=d,d=n);d!==n;)u.push(d),d=Ss,(p=Oo())!==n&&(f=Ro())!==n?d=p=[p,f]:(Ss=d,d=n);u!==n?l=h=[h,u]:(Ss=l,l=n)}else Ss=l,l=n;l===n&&(l=null),l!==n?(Cs=t,r=Xr(s,a,l),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,f,m,g,y,_,v,w,b,S,C,k;if(t=Ss,e.substr(Ss,5)===x?(r=x,Ss+=5):(r=n,0===Is&&js(T)),r!==n)if((i=Uo())!==n)if((s=jo())!==n)if((o=Uo())!==n)if(e.substr(Ss,2)===E?(a=E,Ss+=2):(a=n,0===Is&&js(I)),a!==n)if((c=Uo())!==n)if((l=function(){let e;return(e=To())===n&&(e=to())===n&&(e=no())===n&&(e=so()),e}())!==n)if(h=Ss,(u=Uo())!==n&&(f=Do())!==n?h=u=[u,f]:(Ss=h,h=n),h===n&&(h=null),h!==n)if(u=Ss,e.substr(Ss,2)===R?(f=R,Ss+=2):(f=n,0===Is&&js(A)),f!==n&&(m=Do())!==n?u=f=[f,m]:(Ss=u,u=n),u===n&&(u=null),u!==n)if(f=Ss,(m=Uo())!==n&&(g=function(){let t,r,i,s;if(Is++,t=Ss,64===e.charCodeAt(Ss)?(r=d,Ss++):(r=n,0===Is&&js(p)),r!==n){if(i=[],bi.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Si)),s!==n)for(;s!==n;)i.push(s),bi.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Si));else i=n;i!==n?(Cs=t,r=Ci(i),t=r):(Ss=t,t=n)}else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(wi)),t}())!==n?f=m=[m,g]:(Ss=f,f=n),f===n&&(f=null),f!==n)if(m=Ss,(g=Uo())!==n&&(y=wo())!==n?m=g=[g,y]:(Ss=m,m=n),m===n&&(m=null),m!==n)if((g=Uo())!==n)if((y=function(){let t;return(t=function(){let t,r,i,s;return t=Ss,e.substr(Ss,2)===P?(r=P,Ss+=2):(r=n,0===Is&&js(M)),r!==n&&(i=Uo())!==n&&(s=Do())!==n?(Cs=t,r=O(s),t=r):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s;return t=Ss,e.substr(Ss,2)===P?(r=P,Ss+=2):(r=n,0===Is&&js(M)),r!==n&&(i=Uo())!==n&&(s=jo())!==n?(Cs=t,r=N(s),t=r):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s;return t=Ss,e.substr(Ss,2)===B?(r=B,Ss+=2):(r=n,0===Is&&js(D)),r!==n&&(i=Uo())!==n&&(s=Do())!==n?(Cs=t,r=j(s),t=r):(Ss=t,t=n),t}()),t}())!==n)if((_=qo())!==n){if(v=Ss,(w=Mo())!==n){if(b=[],S=Ss,(C=Oo())!==n&&(k=Ks())!==n?S=C=[C,k]:(Ss=S,S=n),S!==n)for(;S!==n;)b.push(S),S=Ss,(C=Oo())!==n&&(k=Ks())!==n?S=C=[C,k]:(Ss=S,S=n);else b=n;b!==n?v=w=[w,b]:(Ss=v,v=n)}else Ss=v,v=n;v===n&&(v=null),v!==n?(Cs=t,r=$(s,l,h,u,f,m,y,v),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p;if(Is++,t=Ss,e.substr(Ss,9)===Q?(r=Q,Ss+=9):(r=n,0===Is&&js(X)),r!==n)if((i=Uo())!==n)if((s=jo())!==n)if(o=Ss,(a=Uo())===n&&(a=null),a!==n?(60===e.charCodeAt(Ss)?(c=ee,Ss++):(c=n,0===Is&&js(te)),c!==n?((l=Uo())===n&&(l=null),l!==n&&(h=function(){let t,r,i,s,o,a,c;if(t=Ss,(r=ro())!==n){for(i=[],s=Ss,44===e.charCodeAt(Ss)?(o=un,Ss++):(o=n,0===Is&&js(dn)),o!==n&&(a=Uo())!==n&&(c=ro())!==n?s=o=[o,a,c]:(Ss=s,s=n);s!==n;)i.push(s),s=Ss,44===e.charCodeAt(Ss)?(o=un,Ss++):(o=n,0===Is&&js(dn)),o!==n&&(a=Uo())!==n&&(c=ro())!==n?s=o=[o,a,c]:(Ss=s,s=n);i!==n?(Cs=t,r=_n(r,i),t=r):(Ss=t,t=n)}else Ss=t,t=n;return t}())!==n?((u=Uo())===n&&(u=null),u!==n?(62===e.charCodeAt(Ss)?(d=ne,Ss++):(d=n,0===Is&&js(re)),d!==n?o=a=[a,c,l,h,u,d]:(Ss=o,o=n)):(Ss=o,o=n)):(Ss=o,o=n)):(Ss=o,o=n)):(Ss=o,o=n),o===n&&(o=null),o!==n)if((a=qo())!==n){if(c=Ss,(l=Mo())!==n){for(h=[],u=Ss,(d=Oo())!==n&&(p=Ws())!==n?u=d=[d,p]:(Ss=u,u=n);u!==n;)h.push(u),u=Ss,(d=Oo())!==n&&(p=Ws())!==n?u=d=[d,p]:(Ss=u,u=n);h!==n?c=l=[l,h]:(Ss=c,c=n)}else Ss=c,c=n;c===n&&(c=null),c!==n?((l=qo())===n&&(l=null),l!==n?(Cs=t,r=ie(s,o,c),t=r):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(Y)),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;if(t=Ss,e.substr(Ss,4)===ye?(r=ye,Ss+=4):(r=n,0===Is&&js(_e)),r!==n)if((i=qo())!==n){if(s=Ss,(o=Mo())!==n){for(a=[],c=Ss,(l=Oo())!==n&&(h=Vs())!==n?c=l=[l,h]:(Ss=c,c=n);c!==n;)a.push(c),c=Ss,(l=Oo())!==n&&(h=Vs())!==n?c=l=[l,h]:(Ss=c,c=n);a!==n?s=o=[o,a]:(Ss=s,s=n)}else Ss=s,s=n;s===n&&(s=null),s!==n?((o=qo())===n&&(o=null),o!==n?(Cs=t,r=ve(s),t=r):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;return t=Ss,e.substr(Ss,8)===m?(r=m,Ss+=8):(r=n,0===Is&&js(g)),r!==n&&(i=Uo())!==n&&(s=jo())!==n&&(o=qo())!==n&&(a=Mo())!==n&&(c=Oo())!==n&&(l=function(){let t,r,i;return t=Ss,e.substr(Ss,5)===_?(r=_,Ss+=5):(r=n,0===Is&&js(v)),r!==n&&(i=Ko())!==n?(Cs=t,r=w(),t=r):(Ss=t,t=n),t}())!==n&&(h=function(){let e,t,r,i,s;if(e=Ss,t=[],r=Ss,(i=No())!==n&&(s=qs())!==n?r=i=[i,s]:(Ss=r,r=n),r!==n)for(;r!==n;)t.push(r),r=Ss,(i=No())!==n&&(s=qs())!==n?r=i=[i,s]:(Ss=r,r=n);else t=n;return t!==n&&(Cs=e,t=b(t)),e=t}())!==n?((u=qo())===n&&(u=null),u!==n?(Cs=t,r=y(s,h),t=r):(Ss=t,t=n)):(Ss=t,t=n),t}()),t}function Ls(){let t,r,i,s,a,c;for(t=Ss,r=[],i=Ss,(s=Oo())!==n&&(a=Us())!==n&&(c=qo())!==n?i=s=[s,a,c]:(Ss=i,i=n);i!==n;)r.push(i),i=Ss,(s=Oo())!==n&&(a=Us())!==n&&(c=qo())!==n?i=s=[s,a,c]:(Ss=i,i=n);return r!==n?(i=Ss,(s=Oo())!==n&&(a=function(){let t,r,i;return Is++,t=Ss,64===e.charCodeAt(Ss)?(r=d,Ss++):(r=n,0===Is&&js(p)),r!==n&&(i=Fo())!==n?(Cs=t,r=f(i),t=r):(Ss=t,t=n),Is--,t===n&&(r=n,0===Is&&js(u)),t}())!==n&&(c=qo())!==n?i=s=[s,a,c]:(Ss=i,i=n),i===n&&(i=null),i!==n?(Cs=t,t=r=o(r,i)):(Ss=t,t=n)):(Ss=t,t=n),t}function Us(){let t,r,i,s,o,u,d,p,f,m,g;if(Is++,t=Ss,e.substr(Ss,8)===c?(r=c,Ss+=8):(r=n,0===Is&&js(l)),r!==n)if((i=qo())!==n)if((s=Mo())!==n){if(o=[],u=Ss,(d=qo())===n&&(d=null),d!==n&&(p=Oo())!==n&&(f=Lo())!==n&&(m=Uo())!==n&&(g=Ho())!==n?u=d=[d,p,f,m,g]:(Ss=u,u=n),u!==n)for(;u!==n;)o.push(u),u=Ss,(d=qo())===n&&(d=null),d!==n&&(p=Oo())!==n&&(f=Lo())!==n&&(m=Uo())!==n&&(g=Ho())!==n?u=d=[d,p,f,m,g]:(Ss=u,u=n);else o=n;o!==n?(Cs=t,t=r=h(o)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(a)),t}function qs(){let t,r,i;for(t=Ss,r=[],S.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(C));i!==n;)r.push(i),S.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(C));return r!==n&&(i=Ko())!==n?(Cs=t,t=r=k()):(Ss=t,t=n),t}function Ks(){let t;return(t=function(){let t,r,i,s,o;return t=Ss,e.substr(Ss,11)===F?(r=F,Ss+=11):(r=n,0===Is&&js(z)),r!==n&&(i=Uo())!==n&&(s=Bo())!==n&&(o=qo())!==n?t=r=[r,i,s,o]:(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,m;if(t=Ss,e.substr(Ss,5)===H?(r=H,Ss+=5):(r=n,0===Is&&js(L)),r!==n)if((i=Uo())!==n)if(e.substr(Ss,2)===U?(s=U,Ss+=2):(s=n,0===Is&&js(q)),s!==n)if((o=Uo())!==n)if((a=Fo())!==n){for(c=[],l=Ss,(h=Uo())!==n?(e.substr(Ss,3)===K?(u=K,Ss+=3):(u=n,0===Is&&js(W)),u!==n&&(d=Uo())!==n?(e.substr(Ss,2)===U?(p=U,Ss+=2):(p=n,0===Is&&js(q)),p!==n&&(f=Uo())!==n&&(m=Fo())!==n?l=h=[h,u,d,p,f,m]:(Ss=l,l=n)):(Ss=l,l=n)):(Ss=l,l=n);l!==n;)c.push(l),l=Ss,(h=Uo())!==n?(e.substr(Ss,3)===K?(u=K,Ss+=3):(u=n,0===Is&&js(W)),u!==n&&(d=Uo())!==n?(e.substr(Ss,2)===U?(p=U,Ss+=2):(p=n,0===Is&&js(q)),p!==n&&(f=Uo())!==n&&(m=Fo())!==n?l=h=[h,u,d,p,f,m]:(Ss=l,l=n)):(Ss=l,l=n)):(Ss=l,l=n);c!==n&&(l=qo())!==n?(Cs=t,r=V(a,c),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}()),t}function Ws(){let t;return(t=function(){let t,r,i,s,o,a,c;return t=Ss,r=Ss,e.substr(Ss,4)===ce?(i=ce,Ss+=4):(i=n,0===Is&&js(le)),i!==n&&(s=Uo())!==n?r=i=[i,s]:(Ss=r,r=n),r===n&&(r=null),r!==n?(e.substr(Ss,7)===he?(i=he,Ss+=7):(i=n,0===Is&&js(ue)),i===n&&(e.substr(Ss,7)===de?(i=de,Ss+=7):(i=n,0===Is&&js(pe))),i!==n?(s=Ss,(o=Uo())!==n?(e.substr(Ss,6)===fe?(a=fe,Ss+=6):(a=n,0===Is&&js(me)),a!==n?s=o=[o,a]:(Ss=s,s=n)):(Ss=s,s=n),s===n&&(s=null),s!==n?(o=Ss,(a=Uo())!==n&&(c=Fo())!==n?o=a=[a,c]:(Ss=o,o=n),o===n&&(o=null),o!==n&&(a=qo())!==n?(Cs=t,r=ge(r,i,s,o),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o;return t=Ss,r=Ss,(i=Qs())!==n&&(s=Uo())!==n?r=i=[i,s]:(Ss=r,r=n),r===n&&(r=null),r!==n?(i=Ss,(s=eo())!==n&&(o=Uo())!==n?i=s=[s,o]:(Ss=i,i=n),i===n&&(i=null),i!==n?((s=Fo())===n&&(42===e.charCodeAt(Ss)?(s=se,Ss++):(s=n,0===Is&&js(oe))),s!==n&&(o=qo())!==n?(Cs=t,r=ae(r,i,s),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}()),t}function Vs(){let t;return(t=function(){let t,r,i,s,o,a,c;return t=Ss,e.substr(Ss,10)===xe?(r=xe,Ss+=10):(r=n,0===Is&&js(Te)),r!==n?((i=Uo())===n&&(i=null),i!==n?(58===e.charCodeAt(Ss)?(s=Se,Ss++):(s=n,0===Is&&js(Ce)),s!==n?((o=Uo())===n&&(o=null),o!==n&&(a=Do())!==n&&(c=qo())!==n?(Cs=t,r=Ee(a),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c;return t=Ss,e.substr(Ss,4)===we?(r=we,Ss+=4):(r=n,0===Is&&js(be)),r!==n?((i=Uo())===n&&(i=null),i!==n?(58===e.charCodeAt(Ss)?(s=Se,Ss++):(s=n,0===Is&&js(Ce)),s!==n?((o=Uo())===n&&(o=null),o!==n&&(a=Do())!==n&&(c=qo())!==n?(Cs=t,r=ke(a),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}()),t}function Zs(){let t,r;return Is++,(t=function(){let t,r,i,s,o;return t=Ss,e.substr(Ss,8)===vn?(r=vn,Ss+=8):(r=n,0===Is&&js(wn)),r!==n&&(i=Uo())!==n&&(s=zo())!==n&&(o=qo())!==n?(Cs=t,r=bn(s),t=r):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,m;if(t=Ss,r=Ss,e.substr(Ss,4)===ce?(i=ce,Ss+=4):(i=n,0===Is&&js(le)),i!==n&&(s=Uo())!==n?r=i=[i,s]:(Ss=r,r=n),r===n&&(r=null),r!==n)if(e.substr(Ss,7)===he?(i=he,Ss+=7):(i=n,0===Is&&js(ue)),i!==n)if((s=Uo())!==n)if(o=Ss,e.substr(Ss,6)===fe?(a=fe,Ss+=6):(a=n,0===Is&&js(me)),a!==n&&(c=Uo())!==n?o=a=[a,c]:(Ss=o,o=n),o===n&&(o=null),o!==n)if((a=Fo())!==n)if(c=Ss,(l=Uo())!==n&&(h=wo())!==n?c=l=[l,h]:(Ss=c,c=n),c===n&&(c=null),c!==n)if((l=qo())!==n){if(h=Ss,(u=Mo())!==n){for(d=[],p=Ss,(f=Oo())!==n&&(m=oo())!==n?p=f=[f,m]:(Ss=p,p=n);p!==n;)d.push(p),p=Ss,(f=Oo())!==n&&(m=oo())!==n?p=f=[f,m]:(Ss=p,p=n);d!==n?h=u=[u,d]:(Ss=h,h=n)}else Ss=h,h=n;h===n&&(h=null),h!==n?(Cs=t,r=Sn(r,o,a,c,h),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=lo())===n&&(t=function t(){let r,i,s,o,a,c,l,h,u;if(r=Ss,(i=function(){let t,r,i,s,o,a,c;return t=Ss,(r=Qs())!==n?(63===e.charCodeAt(Ss)?(i=pt,Ss++):(i=n,0===Is&&js(ft)),i===n&&(i=null),i!==n&&(s=Uo())!==n&&(o=eo())!==n&&(a=Uo())!==n&&(c=function(){let e,t,r,i,s;return e=Ss,(t=Fo())!==n?(r=Ss,(i=Uo())!==n&&(s=wo())!==n?r=i=[i,s]:(Ss=r,r=n),r===n&&(r=null),r!==n?(Cs=e,t=Nr(t,r),e=t):(Ss=e,e=n)):(Ss=e,e=n),e===n&&(e=Ss,(t=Uo())!==n&&(r=Fo())!==n?(Cs=e,t=Br(r),e=t):(Ss=e,e=n),e===n&&(e=Ss,(t=Uo())!==n&&(r=wo())!==n?(Cs=e,t=Dr(r),e=t):(Ss=e,e=n))),e}())!==n?(Cs=t,r=mt(r,i,o,c),t=r):(Ss=t,t=n)):(Ss=t,t=n),t}())!==n)if((s=qo())!==n){if(o=Ss,(a=Mo())!==n){for(c=[],l=Ss,(h=Oo())!==n&&(u=t())!==n?l=h=[h,u]:(Ss=l,l=n);l!==n;)c.push(l),l=Ss,(h=Oo())!==n&&(u=t())!==n?l=h=[h,u]:(Ss=l,l=n);c!==n?o=a=[a,c]:(Ss=o,o=n)}else Ss=o,o=n;o===n&&(o=null),o!==n?(Cs=r,i=dt(i,o),r=i):(Ss=r,r=n)}else Ss=r,r=n;else Ss=r,r=n;return r}())===n&&(t=function(){let t,r,i,s,o,a,c;return t=Ss,e.substr(Ss,5)===H?(r=H,Ss+=5):(r=n,0===Is&&js(L)),r!==n&&(i=Uo())!==n&&(s=Fo())!==n&&(o=Uo())!==n&&(a=function(){let t,r,i,s,o,a,c,l;if(t=Ss,(r=Js())!==n){for(i=[],s=Ss,(o=Uo())!==n?(e.substr(Ss,3)===K?(a=K,Ss+=3):(a=n,0===Is&&js(W)),a!==n&&(c=Uo())!==n&&(l=Js())!==n?s=o=[o,a,c,l]:(Ss=s,s=n)):(Ss=s,s=n);s!==n;)i.push(s),s=Ss,(o=Uo())!==n?(e.substr(Ss,3)===K?(a=K,Ss+=3):(a=n,0===Is&&js(W)),a!==n&&(c=Uo())!==n&&(l=Js())!==n?s=o=[o,a,c,l]:(Ss=s,s=n)):(Ss=s,s=n);i!==n?(Cs=t,r=Me(r,i),t=r):(Ss=t,t=n)}else Ss=t,t=n;return t}())!==n&&(c=qo())!==n?(Cs=t,r=Pe(s,a),t=r):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c;return t=Ss,e.substr(Ss,5)===ze?(r=ze,Ss+=5):(r=n,0===Is&&js(He)),r!==n&&(i=Uo())!==n&&(s=function(){let t,r,i,s,o;return t=Ss,(r=Fo())!==n?(i=Ss,(s=Uo())!==n?(e.substr(Ss,4)===Ue?(o=Ue,Ss+=4):(o=n,0===Is&&js(qe)),o!==n?i=s=[s,o]:(Ss=i,i=n)):(Ss=i,i=n),i===n&&(i=null),i!==n?(Cs=t,r=Ke(r,i),t=r):(Ss=t,t=n)):(Ss=t,t=n),t}())!==n&&(o=Uo())!==n&&(a=Gs())!==n&&(c=qo())!==n?(Cs=t,r=Le(s,a),t=r):(Ss=t,t=n),t}()),Is--,t===n&&(r=n,0===Is&&js($e)),t}function Js(){let t;return(t=function(){let t,r,i,s,o,a;return t=Ss,e.substr(Ss,2)===U?(r=U,Ss+=2):(r=n,0===Is&&js(q)),r!==n&&(i=Uo())!==n?(s=Ss,e.substr(Ss,3)===Oe?(o=Oe,Ss+=3):(o=n,0===Is&&js(Ne)),o!==n&&(a=Uo())!==n?s=o=[o,a]:(Ss=s,s=n),s===n&&(s=null),s!==n&&(o=Fo())!==n?(Cs=t,r=Be(s,o),t=r):(Ss=t,t=n)):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s;return t=Ss,e.substr(Ss,12)===De?(r=De,Ss+=12):(r=n,0===Is&&js(je)),r!==n&&(i=Uo())!==n&&(s=Fo())!==n?(Cs=t,r=Fe(s),t=r):(Ss=t,t=n),t}()),t}function Gs(){let t,r,i,s,o,a,c,l;if(t=Ss,(r=Ys())!==n){for(i=[],s=Ss,(o=Uo())!==n?(e.substr(Ss,2)===We?(a=We,Ss+=2):(a=n,0===Is&&js(Ve)),a===n&&(e.substr(Ss,3)===K?(a=K,Ss+=3):(a=n,0===Is&&js(W))),a!==n&&(c=Uo())!==n&&(l=Ys())!==n?s=o=[o,a,c,l]:(Ss=s,s=n)):(Ss=s,s=n);s!==n;)i.push(s),s=Ss,(o=Uo())!==n?(e.substr(Ss,2)===We?(a=We,Ss+=2):(a=n,0===Is&&js(Ve)),a===n&&(e.substr(Ss,3)===K?(a=K,Ss+=3):(a=n,0===Is&&js(W))),a!==n&&(c=Uo())!==n&&(l=Ys())!==n?s=o=[o,a,c,l]:(Ss=s,s=n)):(Ss=s,s=n);i!==n?(Cs=t,t=r=Ze(r,i)):(Ss=t,t=n)}else Ss=t,t=n;return t}function Ys(){let t,r,i,s,o,a;return t=Ss,(r=function(){let t;return(t=function(){let t,r,i,s,o,a,c,l,h;return t=Ss,e.substr(Ss,2)===U?(r=U,Ss+=2):(r=n,0===Is&&js(q)),r!==n?(i=Ss,(s=Uo())!==n?(e.substr(Ss,3)===Oe?(o=Oe,Ss+=3):(o=n,0===Is&&js(Ne)),o!==n?i=s=[s,o]:(Ss=i,i=n)):(Ss=i,i=n),i===n&&(i=null),i!==n&&(s=Uo())!==n?(e.substr(Ss,4)===tt?(o=tt,Ss+=4):(o=n,0===Is&&js(nt)),o!==n&&(a=Uo())!==n?(e.substr(Ss,6)===rt?(c=rt,Ss+=6):(c=n,0===Is&&js(it)),c!==n&&(l=Uo())!==n&&(h=Fo())!==n?(Cs=t,r=st(i,h),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;return t=Ss,e.substr(Ss,2)===U?(r=U,Ss+=2):(r=n,0===Is&&js(q)),r!==n?(i=Ss,(s=Uo())!==n?(e.substr(Ss,3)===Oe?(o=Oe,Ss+=3):(o=n,0===Is&&js(Ne)),o!==n?i=s=[s,o]:(Ss=i,i=n)):(Ss=i,i=n),i===n&&(i=null),i!==n&&(s=Uo())!==n?(e.substr(Ss,4)===tt?(o=tt,Ss+=4):(o=n,0===Is&&js(nt)),o!==n&&(a=Uo())!==n?(e.substr(Ss,5)===x?(c=x,Ss+=5):(c=n,0===Is&&js(T)),c!==n&&(l=Uo())!==n&&(h=function(){let e,t;return e=Ss,(t=jo())!==n&&(Cs=e,t=ht(t)),(e=t)===n&&(e=Ss,(t=Do())!==n&&(Cs=e,t=ut(t)),e=t),e}())!==n?(Cs=t,r=lt(i,h),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;return t=Ss,e.substr(Ss,2)===U?(r=U,Ss+=2):(r=n,0===Is&&js(q)),r!==n?(i=Ss,(s=Uo())!==n?(e.substr(Ss,3)===Oe?(o=Oe,Ss+=3):(o=n,0===Is&&js(Ne)),o!==n?i=s=[s,o]:(Ss=i,i=n)):(Ss=i,i=n),i===n&&(i=null),i!==n&&(s=Uo())!==n?(e.substr(Ss,4)===tt?(o=tt,Ss+=4):(o=n,0===Is&&js(nt)),o!==n&&(a=Uo())!==n?(e.substr(Ss,6)===ot?(c=ot,Ss+=6):(c=n,0===Is&&js(at)),c!==n&&(l=Uo())!==n&&(h=Fo())!==n?(Cs=t,r=ct(i,h),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o;return t=Ss,e.substr(Ss,2)===U?(r=U,Ss+=2):(r=n,0===Is&&js(q)),r!==n?(i=Ss,(s=Uo())!==n?(e.substr(Ss,3)===Oe?(o=Oe,Ss+=3):(o=n,0===Is&&js(Ne)),o!==n?i=s=[s,o]:(Ss=i,i=n)):(Ss=i,i=n),i===n&&(i=null),i!==n&&(s=Uo())!==n&&(o=Fo())!==n?(Cs=t,r=et(i,o),t=r):(Ss=t,t=n)):(Ss=t,t=n),t}()),t}())!==n&&(Cs=t,r=Je(r)),(t=r)===n&&(t=Ss,40===e.charCodeAt(Ss)?(r=Ge,Ss++):(r=n,0===Is&&js(Ye)),r!==n?((i=Uo())===n&&(i=null),i!==n&&(s=Gs())!==n?((o=Uo())===n&&(o=null),o!==n?(41===e.charCodeAt(Ss)?(a=Qe,Ss++):(a=n,0===Is&&js(Xe)),a!==n?(Cs=t,t=r=Je(s)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)),t}function Qs(){let t,r;return Is++,e.substr(Ss,5)===yt?(t=yt,Ss+=5):(t=n,0===Is&&js(_t)),t===n&&(e.substr(Ss,2)===P?(t=P,Ss+=2):(t=n,0===Is&&js(M)),t===n&&(e.substr(Ss,3)===vt?(t=vt,Ss+=3):(t=n,0===Is&&js(wt)),t===n&&(e.substr(Ss,4)===bt?(t=bt,Ss+=4):(t=n,0===Is&&js(St)),t===n&&(e.substr(Ss,8)===Ct?(t=Ct,Ss+=8):(t=n,0===Is&&js(kt)),t===n&&(e.substr(Ss,8)===xt?(t=xt,Ss+=8):(t=n,0===Is&&js(Tt)),t===n&&(t=Ss,e.substr(Ss,3)===Et?(r=Et,Ss+=3):(r=n,0===Is&&js(It)),r!==n&&(Cs=t,r=Rt()),t=r)))))),Is--,t===n&&(r=n,0===Is&&js(gt)),t}function Xs(){let t,r;return Is++,e.substr(Ss,3)===$t?(t=$t,Ss+=3):(t=n,0===Is&&js(Pt)),t===n&&(e.substr(Ss,2)===Mt?(t=Mt,Ss+=2):(t=n,0===Is&&js(Ot)),t===n&&(e.substr(Ss,2)===Nt?(t=Nt,Ss+=2):(t=n,0===Is&&js(Bt)),t===n&&(61===e.charCodeAt(Ss)?(t=Dt,Ss++):(t=n,0===Is&&js(jt)),t===n&&(e.substr(Ss,7)===he?(t=he,Ss+=7):(t=n,0===Is&&js(ue)),t===n&&(t=Ss,e.substr(Ss,7)===de?(r=de,Ss+=7):(r=n,0===Is&&js(pe)),r!==n&&(Cs=t,r=Ft()),t=r))))),Is--,t===n&&(r=n,0===Is&&js(At)),t}function eo(){let t;return(t=ro())===n&&(t=to())===n&&(t=no())===n&&(t=function(){let t,r,i,s;return t=Ss,e.substr(Ss,10)===Zt?(r=Zt,Ss+=10):(r=n,0===Is&&js(Jt)),r!==n&&(i=eo())!==n?(62===e.charCodeAt(Ss)?(s=ne,Ss++):(s=n,0===Is&&js(re)),s!==n?(Cs=t,r=Gt(i),t=r):(Ss=t,t=n)):(Ss=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;if(t=Ss,e.substr(Ss,4)===rn?(r=rn,Ss+=4):(r=n,0===Is&&js(sn)),r!==n)if(i=Ss,Is++,on.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(cn)),Is--,s!==n?(Ss=i,i=void 0):i=n,i!==n){if(s=Ss,(o=Uo())===n&&(o=null),o!==n)if(123===e.charCodeAt(Ss)?(a=ln,Ss++):(a=n,0===Is&&js(hn)),a!==n){if(c=Ss,(l=io())!==n){for(h=[],u=Ss,44===e.charCodeAt(Ss)?(d=un,Ss++):(d=n,0===Is&&js(dn)),d!==n&&(p=Uo())!==n&&(f=io())!==n?u=d=[d,p,f]:(Ss=u,u=n);u!==n;)h.push(u),u=Ss,44===e.charCodeAt(Ss)?(d=un,Ss++):(d=n,0===Is&&js(dn)),d!==n&&(p=Uo())!==n&&(f=io())!==n?u=d=[d,p,f]:(Ss=u,u=n);h!==n?c=l=[l,h]:(Ss=c,c=n)}else Ss=c,c=n;c===n&&(c=null),c!==n?(125===e.charCodeAt(Ss)?(l=pn,Ss++):(l=n,0===Is&&js(fn)),l!==n?s=o=[o,a,c,l]:(Ss=s,s=n)):(Ss=s,s=n)}else Ss=s,s=n;else Ss=s,s=n;s===n&&(s=null),s!==n?(Cs=t,r=mn(s),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=To())===n&&(t=so()),t}function to(){let t,r,i,s;return t=Ss,91===e.charCodeAt(Ss)?(r=zt,Ss++):(r=n,0===Is&&js(Ht)),r!==n&&(i=eo())!==n?(93===e.charCodeAt(Ss)?(s=Lt,Ss++):(s=n,0===Is&&js(Ut)),s!==n?(Cs=t,t=r=qt(i)):(Ss=t,t=n)):(Ss=t,t=n),t}function no(){let t,r,i,s;return t=Ss,e.substr(Ss,14)===Kt?(r=Kt,Ss+=14):(r=n,0===Is&&js(Wt)),r!==n&&(i=eo())!==n?(62===e.charCodeAt(Ss)?(s=ne,Ss++):(s=n,0===Is&&js(re)),s!==n?(Cs=t,t=r=Vt(i)):(Ss=t,t=n)):(Ss=t,t=n),t}function ro(){let t,r,i,s,o,a,c,l;return Is++,t=Ss,126===e.charCodeAt(Ss)?(r=Qt,Ss++):(r=n,0===Is&&js(Xt)),r!==n&&(i=Fo())!==n?(s=Ss,(o=Uo())!==n?(e.substr(Ss,4)===en?(a=en,Ss+=4):(a=n,0===Is&&js(tn)),a!==n&&(c=Uo())!==n&&(l=eo())!==n?s=o=[o,a,c,l]:(Ss=s,s=n)):(Ss=s,s=n),s===n&&(s=null),s!==n?(Cs=t,t=r=nn(i,s)):(Ss=t,t=n)):(Ss=t,t=n),Is--,t===n&&(r=n,0===Is&&js(Yt)),t}function io(){let t,r,i,s,o,a;return t=Ss,(r=zo())!==n?((i=Uo())===n&&(i=null),i!==n?(58===e.charCodeAt(Ss)?(s=Se,Ss++):(s=n,0===Is&&js(Ce)),s!==n?((o=Uo())===n&&(o=null),o!==n&&(a=Fo())!==n?(Cs=t,t=r=gn(r,a)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}function so(){let e,t;return e=Ss,(t=jo())!==n&&(Cs=e,t=yn(t)),e=t}function oo(){let t;return(t=ao())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,m;if(t=Ss,r=Ss,e.substr(Ss,4)===ce?(i=ce,Ss+=4):(i=n,0===Is&&js(le)),i!==n&&(s=Uo())!==n?r=i=[i,s]:(Ss=r,r=n),r===n&&(r=null),r!==n)if(e.substr(Ss,7)===de?(i=de,Ss+=7):(i=n,0===Is&&js(pe)),i!==n)if((s=Uo())!==n)if(o=Ss,e.substr(Ss,6)===fe?(a=fe,Ss+=6):(a=n,0===Is&&js(me)),a!==n&&(c=Uo())!==n?o=a=[a,c]:(Ss=o,o=n),o===n&&(o=null),o!==n)if((a=Fo())!==n)if(c=Ss,(l=Uo())!==n&&(h=wo())!==n?c=l=[l,h]:(Ss=c,c=n),c===n&&(c=null),c!==n)if((l=qo())!==n){if(h=Ss,(u=Mo())!==n){for(d=[],p=Ss,(f=Oo())!==n&&(m=co())!==n?p=f=[f,m]:(Ss=p,p=n);p!==n;)d.push(p),p=Ss,(f=Oo())!==n&&(m=co())!==n?p=f=[f,m]:(Ss=p,p=n);d!==n?h=u=[u,d]:(Ss=h,h=n)}else Ss=h,h=n;h===n&&(h=null),h!==n?(Cs=t,r=On(r,o,a,c,h),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}()),t}function ao(){let t,r,i,s,o;return t=Ss,e.substr(Ss,10)===Cn?(r=Cn,Ss+=10):(r=n,0===Is&&js(kn)),r!==n&&(i=Uo())!==n?(e.substr(Ss,10)===xn?(s=xn,Ss+=10):(s=n,0===Is&&js(Tn)),s===n&&(e.substr(Ss,3)===En?(s=En,Ss+=3):(s=n,0===Is&&js(In)),s===n&&(e.substr(Ss,6)===Rn?(s=Rn,Ss+=6):(s=n,0===Is&&js(An)),s===n&&(e.substr(Ss,5)===$n?(s=$n,Ss+=5):(s=n,0===Is&&js(Pn))))),s!==n&&(o=qo())!==n?(Cs=t,t=r=Mn(s)):(Ss=t,t=n)):(Ss=t,t=n),t}function co(){let t;return(t=ao())===n&&(t=function(){let t,r,i,s,o;return t=Ss,e.substr(Ss,6)===rt?(r=rt,Ss+=6):(r=n,0===Is&&js(it)),r!==n&&(i=Uo())!==n&&(s=Fo())!==n&&(o=qo())!==n?(Cs=t,r=Nn(s),t=r):(Ss=t,t=n),t}()),t}function lo(){let t,r,i,s,o,a,c,l,h,u,d;if(t=Ss,e.substr(Ss,11)===F?(r=F,Ss+=11):(r=n,0===Is&&js(z)),r!==n)if((i=Uo())!==n)if((s=Bo())!==n)if((o=qo())!==n){if(a=Ss,(c=Mo())!==n){if(l=[],h=Ss,(u=Oo())!==n&&(d=ho())!==n?h=u=[u,d]:(Ss=h,h=n),h!==n)for(;h!==n;)l.push(h),h=Ss,(u=Oo())!==n&&(d=ho())!==n?h=u=[u,d]:(Ss=h,h=n);else l=n;l!==n?a=c=[c,l]:(Ss=a,a=n)}else Ss=a,a=n;a===n&&(a=null),a!==n?(Cs=t,t=r=Bn(s,a)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}function ho(){let e,t,r,i,s;return e=Ss,(t=Fo())!==n&&(r=Uo())!==n&&(i=Bo())!==n&&(s=qo())!==n?(Cs=e,e=t=Dn(t,i)):(Ss=e,e=n),e}function uo(){let t;return(t=fo())===n&&(t=function(){let e,t,r,i,s,o;return e=Ss,(t=_o())!==n?(r=Ss,(i=Uo())!==n&&(s=ko())!==n?r=i=[i,s]:(Ss=r,r=n),r===n&&(r=null),r!==n?(i=Ss,(s=Uo())!==n&&(o=po())!==n?i=s=[s,o]:(Ss=i,i=n),i===n&&(i=null),i!==n&&(s=qo())!==n?(Cs=e,t=br(t,r,i),e=t):(Ss=e,e=n)):(Ss=e,e=n)):(Ss=e,e=n),e}())===n&&(t=vo())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;if(t=Ss,e.substr(Ss,7)===Sr?(r=Sr,Ss+=7):(r=n,0===Is&&js(Cr)),r!==n)if((i=qo())!==n){if(s=Ss,(o=Mo())!==n){for(a=[],c=Ss,(l=Oo())!==n?((h=fo())===n&&(h=vo())===n&&(h=xo()),h!==n?c=l=[l,h]:(Ss=c,c=n)):(Ss=c,c=n);c!==n;)a.push(c),c=Ss,(l=Oo())!==n?((h=fo())===n&&(h=vo())===n&&(h=xo()),h!==n?c=l=[l,h]:(Ss=c,c=n)):(Ss=c,c=n);a!==n?s=o=[o,a]:(Ss=s,s=n)}else Ss=s,s=n;s===n&&(s=null),s!==n?(Cs=t,r=kr(s),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=xo())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,m;if(t=Ss,e.substr(Ss,6)===Xn?(r=Xn,Ss+=6):(r=n,0===Is&&js(er)),r!==n)if((i=Uo())!==n)if((s=Bo())!==n)if((o=qo())!==n){if(a=Ss,(c=Mo())!==n){if(l=Ss,(h=Oo())!==n)if(e.substr(Ss,6)===tr?(u=tr,Ss+=6):(u=n,0===Is&&js(nr)),u!==n){if(d=[],p=Ss,(f=Uo())!==n&&(m=Bo())!==n?p=f=[f,m]:(Ss=p,p=n),p!==n)for(;p!==n;)d.push(p),p=Ss,(f=Uo())!==n&&(m=Bo())!==n?p=f=[f,m]:(Ss=p,p=n);else d=n;d!==n&&(p=qo())!==n?l=h=[h,u,d,p]:(Ss=l,l=n)}else Ss=l,l=n;else Ss=l,l=n;l!==n?a=c=[c,l]:(Ss=a,a=n)}else Ss=a,a=n;a===n&&(a=null),a!==n?(Cs=t,r=rr(s,a),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=function(){let e,t,r,i,s,o,a;return e=Ss,(t=go())!==n&&(r=Uo())!==n&&(i=Xs())!==n&&(s=Uo())!==n&&(o=go())!==n&&(a=qo())!==n?(Cs=e,t=Qn(t,i,o),e=t):(Ss=e,e=n),e}())===n&&(t=lo()),t}function po(){let t,r,i,s,o,a;if(t=Ss,e.substr(Ss,2)===Hn?(r=Hn,Ss+=2):(r=n,0===Is&&js(Ln)),r!==n)if((i=Uo())!==n){if((s=Fo())===n){for(s=Ss,o=[],Un.test(e.charAt(Ss))?(a=e.charAt(Ss),Ss++):(a=n,0===Is&&js(qn));a!==n;)o.push(a),Un.test(e.charAt(Ss))?(a=e.charAt(Ss),Ss++):(a=n,0===Is&&js(qn));o!==n&&(Cs=s,o=Kn()),s=o}s!==n?(Cs=t,t=r=Wn(s)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;return t}function fo(){let t,r,i,s,o,a,c,l,h,u;if(t=Ss,(r=function(){let e,t;return e=Ss,(t=jo())!==n&&(Cs=e,t=jr(t)),(e=t)===n&&(e=Ss,(t=bo())!==n&&(Cs=e,t=Fr(t)),e=t),e}())===n&&(42===e.charCodeAt(Ss)?(r=se,Ss++):(r=n,0===Is&&js(oe))),r!==n)if(i=Ss,(s=Uo())!==n&&(o=po())!==n?i=s=[s,o]:(Ss=i,i=n),i===n&&(i=null),i!==n)if((s=qo())!==n){if(o=Ss,(a=Mo())!==n){for(c=[],l=Ss,(h=Oo())!==n&&(u=mo())!==n?l=h=[h,u]:(Ss=l,l=n);l!==n;)c.push(l),l=Ss,(h=Oo())!==n&&(u=mo())!==n?l=h=[h,u]:(Ss=l,l=n);c!==n?o=a=[a,c]:(Ss=o,o=n)}else Ss=o,o=n;o===n&&(o=null),o!==n?(Cs=t,t=r=Vn(r,i,o)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}function mo(){let t;return(t=function t(){let r,i,s,o,a,c,l,h,u,d,p,f;if(r=Ss,(i=function(){let t;return e.substr(Ss,7)===de?(t=de,Ss+=7):(t=n,0===Is&&js(pe)),t===n&&(e.substr(Ss,7)===he?(t=he,Ss+=7):(t=n,0===Is&&js(ue))),t}())!==n)if((s=Uo())!==n)if((o=function(){let e,t,r;return e=Ss,(t=Fo())!==n?((r=Co())===n&&(r=null),r!==n?(Cs=e,t=Yn(t,r),e=t):(Ss=e,e=n)):(Ss=e,e=n),e}())!==n)if(a=Ss,(c=Uo())!==n&&(l=po())!==n?a=c=[c,l]:(Ss=a,a=n),a===n&&(a=null),a!==n)if((c=qo())!==n){if(l=Ss,(h=Mo())!==n){for(u=[],d=Ss,(p=Oo())!==n&&(f=t())!==n?d=p=[p,f]:(Ss=d,d=n);d!==n;)u.push(d),d=Ss,(p=Oo())!==n&&(f=t())!==n?d=p=[p,f]:(Ss=d,d=n);u!==n?l=h=[h,u]:(Ss=l,l=n)}else Ss=l,l=n;l===n&&(l=null),l!==n?(Cs=r,i=Gn(i,o,a,l),r=i):(Ss=r,r=n)}else Ss=r,r=n;else Ss=r,r=n;else Ss=r,r=n;else Ss=r,r=n;else Ss=r,r=n;return r}())===n&&(t=function t(){let r,i,s,o,a,c,l,h,u,d,p,f;if(r=Ss,(i=Fo())===n&&(42===e.charCodeAt(Ss)?(i=se,Ss++):(i=n,0===Is&&js(oe))),i!==n)if((s=Uo())!==n)if((o=Xs())!==n)if(a=Ss,(c=Uo())!==n&&(l=function(){let e,t,r,i;return e=Ss,(t=jo())===n&&(t=Fo()),t===n&&(t=null),t!==n?((r=Uo())===n&&(r=null),r!==n?((i=wo())===n&&(i=null),i!==n?(Cs=e,t=Jn(t,i),e=t):(Ss=e,e=n)):(Ss=e,e=n)):(Ss=e,e=n),e}())!==n?a=c=[c,l]:(Ss=a,a=n),a===n&&(a=null),a!==n)if((c=qo())!==n){if(l=Ss,(h=Mo())!==n){for(u=[],d=Ss,(p=Oo())!==n&&(f=t())!==n?d=p=[p,f]:(Ss=d,d=n);d!==n;)u.push(d),d=Ss,(p=Oo())!==n&&(f=t())!==n?d=p=[p,f]:(Ss=d,d=n);u!==n?l=h=[h,u]:(Ss=l,l=n)}else Ss=l,l=n;l===n&&(l=null),l!==n?(Cs=r,i=Zn(i,o,a,l),r=i):(Ss=r,r=n)}else Ss=r,r=n;else Ss=r,r=n;else Ss=r,r=n;else Ss=r,r=n;else Ss=r,r=n;return r}()),t}function go(){let e;return(e=function(){let e,t,r;return e=Ss,(t=So())!==n?((r=yo())===n&&(r=null),r!==n?(Cs=e,t=ir(t,r),e=t):(Ss=e,e=n)):(Ss=e,e=n),e}())===n&&(e=function(){let e,t;return e=Ss,(t=wo())!==n&&(Cs=e,t=sr(t)),e=t}())===n&&(e=function(){let e,t,r;return e=Ss,(t=jo())!==n?((r=yo())===n&&(r=null),r!==n?(Cs=e,t=ar(t,r),e=t):(Ss=e,e=n)):(Ss=e,e=n),e}())===n&&(e=function(){let e,t,r;return e=Ss,(t=Fo())!==n?((r=yo())===n&&(r=null),r!==n?(Cs=e,t=or(t,r),e=t):(Ss=e,e=n)):(Ss=e,e=n),e}()),e}function yo(){let t,r,i,s,o,a;return t=Ss,46===e.charCodeAt(Ss)?(r=cr,Ss++):(r=n,0===Is&&js(lr)),r!==n?((i=Fo())===n&&(i=null),i!==n?(s=Ss,(o=Uo())===n&&(o=null),o!==n&&(a=wo())!==n?s=o=[o,a]:(Ss=s,s=n),s===n&&(s=null),s!==n?(Cs=t,t=r=hr(i,s)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}function _o(){let t;return 63===e.charCodeAt(Ss)?(t=pt,Ss++):(t=n,0===Is&&js(ft)),t===n&&(e.substr(Ss,3)===ur?(t=ur,Ss+=3):(t=n,0===Is&&js(dr)),t===n&&(e.substr(Ss,3)===pr?(t=pr,Ss+=3):(t=n,0===Is&&js(fr)),t===n&&(e.substr(Ss,6)===mr?(t=mr,Ss+=6):(t=n,0===Is&&js(gr)),t===n&&(e.substr(Ss,4)===yr?(t=yr,Ss+=4):(t=n,0===Is&&js(_r)),t===n&&(e.substr(Ss,5)===vr?(t=vr,Ss+=5):(t=n,0===Is&&js(wr))))))),t}function vo(){let t,r,i,s,o,a;return t=Ss,e.substr(Ss,6)===rt?(r=rt,Ss+=6):(r=n,0===Is&&js(it)),r!==n?(i=Ss,(s=Uo())!==n&&(o=po())!==n?i=s=[s,o]:(Ss=i,i=n),i===n&&(i=null),i!==n?(s=Ss,(o=Uo())!==n&&(a=ko())!==n?s=o=[o,a]:(Ss=s,s=n),s===n&&(s=null),s!==n&&(o=qo())!==n?(Cs=t,t=r=xr(i,s)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}function wo(){let t,r,i,s,o;return t=Ss,(r=function(){let t,r,i;return t=Ss,35===e.charCodeAt(Ss)?(r=Tr,Ss++):(r=n,0===Is&&js(Er)),r!==n&&(i=Lo())!==n?(Cs=t,t=r=Ir(i)):(Ss=t,t=n),t}())!==n?(i=Ss,(s=Uo())!==n&&(o=wo())!==n?i=s=[s,o]:(Ss=i,i=n),i===n&&(i=null),i!==n?(Cs=t,t=r=Rr(r,i)):(Ss=t,t=n)):(Ss=t,t=n),t}function bo(){let t,r,i;return Is++,t=Ss,38===e.charCodeAt(Ss)?(r=$r,Ss++):(r=n,0===Is&&js(Pr)),r!==n&&(i=Lo())!==n?(Cs=t,t=r=Mr(i)):(Ss=t,t=n),Is--,t===n&&(r=n,0===Is&&js(Ar)),t}function So(){let e,t,r,i,s;return e=Ss,(t=bo())!==n?(r=Ss,(i=Uo())!==n&&(s=So())!==n?r=i=[i,s]:(Ss=r,r=n),r===n&&(r=null),r!==n?(Cs=e,e=t=Rr(t,r)):(Ss=e,e=n)):(Ss=e,e=n),e}function Co(){let e,t,r;return e=Ss,(t=Uo())!==n&&(r=wo())!==n?(Cs=e,e=t=Or(r)):(Ss=e,e=n),e}function ko(){let e,t,r;return e=Ss,(t=Do())!==n?((r=Co())===n&&(r=null),r!==n?(Cs=e,e=t=zr(t,r)):(Ss=e,e=n)):(Ss=e,e=n),e===n&&(e=Ss,(t=jo())!==n?((r=Co())===n&&(r=null),r!==n?(Cs=e,e=t=Hr(t,r)):(Ss=e,e=n)):(Ss=e,e=n),e===n&&(e=Ss,(t=wo())!==n&&(Cs=e,t=Lr(t)),e=t)),e}function xo(){let t,r,i,s,o,a;return t=Ss,e.substr(Ss,4)===Ur?(r=Ur,Ss+=4):(r=n,0===Is&&js(qr)),r!==n?(i=Ss,(s=Uo())!==n&&(o=ko())!==n?i=s=[s,o]:(Ss=i,i=n),i===n&&(i=null),i!==n?(s=Ss,(o=Uo())!==n&&(a=po())!==n?s=o=[o,a]:(Ss=s,s=n),s===n&&(s=null),s!==n&&(o=qo())!==n?(Cs=t,t=r=Kr(i,s)):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),t}function To(){let t,r,i,s,o,a,c,l,h,u;if(t=Ss,r=[],i=Ss,(s=jo())===n&&(42===e.charCodeAt(Ss)?(s=se,Ss++):(s=n,0===Is&&js(oe))),s!==n&&(o=Uo())!==n?i=s=[s,o]:(Ss=i,i=n),i!==n)for(;i!==n;)r.push(i),i=Ss,(s=jo())===n&&(42===e.charCodeAt(Ss)?(s=se,Ss++):(s=n,0===Is&&js(oe))),s!==n&&(o=Uo())!==n?i=s=[s,o]:(Ss=i,i=n);else r=n;if(r!==n)if(123===e.charCodeAt(Ss)?(i=ln,Ss++):(i=n,0===Is&&js(hn)),i!==n){if(s=Ss,(o=Eo())!==n){for(a=[],c=Ss,44===e.charCodeAt(Ss)?(l=un,Ss++):(l=n,0===Is&&js(dn)),l!==n&&(h=Uo())!==n&&(u=Eo())!==n?c=l=[l,h,u]:(Ss=c,c=n);c!==n;)a.push(c),c=Ss,44===e.charCodeAt(Ss)?(l=un,Ss++):(l=n,0===Is&&js(dn)),l!==n&&(h=Uo())!==n&&(u=Eo())!==n?c=l=[l,h,u]:(Ss=c,c=n);a!==n?s=o=[o,a]:(Ss=s,s=n)}else Ss=s,s=n;s===n&&(s=null),s!==n?(125===e.charCodeAt(Ss)?(o=pn,Ss++):(o=n,0===Is&&js(fn)),o!==n?(Cs=t,t=r=Wr(r,s)):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;return t}function Eo(){let e,t,r,i;return e=Ss,t=Ss,(r=Ao())!==n&&(i=Uo())!==n?t=r=[r,i]:(Ss=t,t=n),t===n&&(t=null),t!==n&&(r=zo())!==n?(Cs=e,e=t=Vr(t,r)):(Ss=e,e=n),e}function Io(){let t,r,i,s,o,a;if(t=Ss,e.substr(Ss,6)===Zr?(r=Zr,Ss+=6):(r=n,0===Is&&js(Jr)),r!==n){if(i=[],s=Ss,(o=Uo())!==n?(42===e.charCodeAt(Ss)?(a=se,Ss++):(a=n,0===Is&&js(oe)),a===n&&(a=jo()),a!==n?s=o=[o,a]:(Ss=s,s=n)):(Ss=s,s=n),s!==n)for(;s!==n;)i.push(s),s=Ss,(o=Uo())!==n?(42===e.charCodeAt(Ss)?(a=se,Ss++):(a=n,0===Is&&js(oe)),a===n&&(a=jo()),a!==n?s=o=[o,a]:(Ss=s,s=n)):(Ss=s,s=n);else i=n;i!==n?((s=function(){let t,r,i,s,o,a,c,l,h,u,d;if(t=Ss,(r=Uo())!==n)if(e.substr(Ss,7)===ti?(i=ti,Ss+=7):(i=n,0===Is&&js(ni)),i!==n)if((s=Uo())!==n)if((o=jo())!==n){for(a=[],c=Ss,(l=Uo())===n&&(l=null),l!==n?(44===e.charCodeAt(Ss)?(h=un,Ss++):(h=n,0===Is&&js(dn)),h!==n&&(u=Uo())!==n&&(d=jo())!==n?c=l=[l,h,u,d]:(Ss=c,c=n)):(Ss=c,c=n);c!==n;)a.push(c),c=Ss,(l=Uo())===n&&(l=null),l!==n?(44===e.charCodeAt(Ss)?(h=un,Ss++):(h=n,0===Is&&js(dn)),h!==n&&(u=Uo())!==n&&(d=jo())!==n?c=l=[l,h,u,d]:(Ss=c,c=n)):(Ss=c,c=n);a!==n?(Cs=t,r=ri(o,a),t=r):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(s=null),s!==n?(Cs=t,t=r=Gr(i,s)):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;return t}function Ro(){let e;return(e=function(){let e,t,r,i,s;return e=Ss,(t=Ao())!==n&&(r=Uo())!==n&&(i=zo())!==n&&(s=qo())!==n?(Cs=e,t=ii(t,i),e=t):(Ss=e,e=n),e}())===n&&(e=lo()),e}function Ao(){let t;return(t=$o())===n&&(t=function(){let t,r,i,s,o,a;if(t=Ss,91===e.charCodeAt(Ss)?(r=zt,Ss++):(r=n,0===Is&&js(Ht)),r!==n){for(i=[],s=Uo();s!==n;)i.push(s),s=Uo();if(i!==n)if((s=$o())!==n){for(o=[],a=Uo();a!==n;)o.push(a),a=Uo();o!==n?(93===e.charCodeAt(Ss)?(a=Lt,Ss++):(a=n,0===Is&&js(Ut)),a!==n?(Cs=t,r=si(s),t=r):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n}else Ss=t,t=n;return t}())===n&&(t=Po())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;if(t=Ss,40===e.charCodeAt(Ss)?(r=Ge,Ss++):(r=n,0===Is&&js(Ye)),r!==n)if((i=Uo())===n&&(i=null),i!==n)if((s=Po())!==n){if(o=[],a=Ss,(c=Uo())!==n?(e.substr(Ss,2)===We?(l=We,Ss+=2):(l=n,0===Is&&js(Ve)),l!==n&&(h=Uo())!==n&&(u=Po())!==n?a=c=[c,l,h,u]:(Ss=a,a=n)):(Ss=a,a=n),a!==n)for(;a!==n;)o.push(a),a=Ss,(c=Uo())!==n?(e.substr(Ss,2)===We?(l=We,Ss+=2):(l=n,0===Is&&js(Ve)),l!==n&&(h=Uo())!==n&&(u=Po())!==n?a=c=[c,l,h,u]:(Ss=a,a=n)):(Ss=a,a=n);else o=n;o!==n?((a=Uo())===n&&(a=null),a!==n?(41===e.charCodeAt(Ss)?(c=Qe,Ss++):(c=n,0===Is&&js(Xe)),c!==n?(Cs=t,r=_i(s,o),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;if(t=Ss,40===e.charCodeAt(Ss)?(r=Ge,Ss++):(r=n,0===Is&&js(Ye)),r!==n)if((i=Uo())===n&&(i=null),i!==n)if((s=Po())!==n){for(o=[],a=Ss,(c=Uo())===n&&(c=null),c!==n?(44===e.charCodeAt(Ss)?(l=un,Ss++):(l=n,0===Is&&js(dn)),l!==n?((h=Uo())===n&&(h=null),h!==n&&(u=Po())!==n?a=c=[c,l,h,u]:(Ss=a,a=n)):(Ss=a,a=n)):(Ss=a,a=n);a!==n;)o.push(a),a=Ss,(c=Uo())===n&&(c=null),c!==n?(44===e.charCodeAt(Ss)?(l=un,Ss++):(l=n,0===Is&&js(dn)),l!==n?((h=Uo())===n&&(h=null),h!==n&&(u=Po())!==n?a=c=[c,l,h,u]:(Ss=a,a=n)):(Ss=a,a=n)):(Ss=a,a=n);o!==n?((a=Uo())===n&&(a=null),a!==n?(41===e.charCodeAt(Ss)?(c=Qe,Ss++):(c=n,0===Is&&js(Xe)),c!==n?(Cs=t,r=vi(s,o),t=r):(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;else Ss=t,t=n;return t}()),t}function $o(){let t,r,i,s,o,a;if(t=Ss,e.substr(Ss,10)===Zt?(r=Zt,Ss+=10):(r=n,0===Is&&js(Jt)),r!==n){for(i=[],s=Uo();s!==n;)i.push(s),s=Uo();if(i!==n)if((s=To())===n&&(s=so()),s!==n){for(o=[],a=Uo();a!==n;)o.push(a),a=Uo();o!==n?(62===e.charCodeAt(Ss)?(a=ne,Ss++):(a=n,0===Is&&js(re)),a!==n?(Cs=t,t=r=oi(s)):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n}else Ss=t,t=n;return t}function Po(){let t,r;return t=Ss,e.substr(Ss,4)===ai?(r=ai,Ss+=4):(r=n,0===Is&&js(ci)),r===n&&(e.substr(Ss,3)===li?(r=li,Ss+=3):(r=n,0===Is&&js(hi)),r===n&&(e.substr(Ss,6)===ui?(r=ui,Ss+=6):(r=n,0===Is&&js(di)),r===n&&(e.substr(Ss,7)===pi?(r=pi,Ss+=7):(r=n,0===Is&&js(fi)),r===n&&(e.substr(Ss,5)===mi?(r=mi,Ss+=5):(r=n,0===Is&&js(gi)))))),r!==n&&(Cs=t,r=yi(r)),t=r}function Mo(){let t,r,i,s;if(Is++,t=Ss,Is++,r=Ss,i=[],32===e.charCodeAt(Ss)?(s=xi,Ss++):(s=n,0===Is&&js(Ti)),s!==n)for(;s!==n;)i.push(s),32===e.charCodeAt(Ss)?(s=xi,Ss++):(s=n,0===Is&&js(Ti));else i=n;return i!==n?(Cs=Ss,(s=(s=Ei(i))?void 0:n)!==n?r=i=[i,s]:(Ss=r,r=n)):(Ss=r,r=n),Is--,r!==n?(Ss=t,t=void 0):t=n,Is--,t===n&&(r=n,0===Is&&js(ki)),t}function Oo(){let t,r,i,s,o;for(Is++,t=Ss,r=Ss,Is++,i=Ss,s=[],32===e.charCodeAt(Ss)?(o=xi,Ss++):(o=n,0===Is&&js(Ti));o!==n;)s.push(o),32===e.charCodeAt(Ss)?(o=xi,Ss++):(o=n,0===Is&&js(Ti));if(s!==n?(Cs=Ss,(o=(o=Ri(s))?void 0:n)!==n?i=s=[s,o]:(Ss=i,i=n)):(Ss=i,i=n),Is--,i!==n?(Ss=r,r=void 0):r=n,r!==n){for(i=[],32===e.charCodeAt(Ss)?(s=xi,Ss++):(s=n,0===Is&&js(Ti));s!==n;)i.push(s),32===e.charCodeAt(Ss)?(s=xi,Ss++):(s=n,0===Is&&js(Ti));i!==n?t=r=[r,i]:(Ss=t,t=n)}else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(Ii)),t}function No(){let t,r,i,s,o;for(Is++,t=Ss,r=Ss,Is++,i=Ss,s=[],32===e.charCodeAt(Ss)?(o=xi,Ss++):(o=n,0===Is&&js(Ti));o!==n;)s.push(o),32===e.charCodeAt(Ss)?(o=xi,Ss++):(o=n,0===Is&&js(Ti));if(s!==n?(Cs=Ss,(o=(o=$i(s))?void 0:n)!==n?i=s=[s,o]:(Ss=i,i=n)):(Ss=i,i=n),Is--,i!==n?(Ss=r,r=void 0):r=n,r!==n){for(i=[],32===e.charCodeAt(Ss)?(s=xi,Ss++):(s=n,0===Is&&js(Ti));s!==n;)i.push(s),32===e.charCodeAt(Ss)?(s=xi,Ss++):(s=n,0===Is&&js(Ti));i!==n?(Cs=t,t=r=k()):(Ss=t,t=n)}else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(Ai)),t}function Bo(){let t,r,i,s;if(Is++,t=Ss,96===e.charCodeAt(Ss)?(r=Di,Ss++):(r=n,0===Is&&js(ji)),r!==n){if(i=[],Fi.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(zi)),s!==n)for(;s!==n;)i.push(s),Fi.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(zi));else i=n;i!==n?(96===e.charCodeAt(Ss)?(s=Di,Ss++):(s=n,0===Is&&js(ji)),s!==n?(Cs=t,t=r=Hi(i)):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(Bi)),t}function Do(){let t,r,i,s,o;if(Is++,t=Ss,39===e.charCodeAt(Ss)?(r=Ui,Ss++):(r=n,0===Is&&js(qi)),r!==n){if(i=[],Ki.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Wi)),s!==n)for(;s!==n;)i.push(s),Ki.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Wi));else i=n;i!==n?(39===e.charCodeAt(Ss)?(s=Ui,Ss++):(s=n,0===Is&&js(qi)),s===n&&(s=Ss,e.length>Ss?(o=e.charAt(Ss),Ss++):(o=n,0===Is&&js(Oi)),o!==n&&(Cs=s,o=Vi(i)),s=o),s!==n?(Cs=t,t=r=Zi(i)):(Ss=t,t=n)):(Ss=t,t=n)}else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(Li)),t}function jo(){let t,r,i,s;if(Is++,t=Ss,Gi.test(e.charAt(Ss))?(r=e.charAt(Ss),Ss++):(r=n,0===Is&&js(Yi)),r!==n){for(i=[],Qi.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Xi));s!==n;)i.push(s),Qi.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Xi));i!==n?(Cs=t,t=r=k()):(Ss=t,t=n)}else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(Ji)),t}function Fo(){let t,r,i,s,o;if(Is++,t=Ss,r=Ss,Is++,i=function(){let t,r,i,s;return t=Ss,(r=Xs())===n&&(r=Qs())===n&&(r=_o())===n&&(e.substr(Ss,8)===Ie?(r=Ie,Ss+=8):(r=n,0===Is&&js(Re)),r===n&&(e.substr(Ss,6)===jn?(r=jn,Ss+=6):(r=n,0===Is&&js(Fn)),r===n&&(e.substr(Ss,6)===Z?(r=Z,Ss+=6):(r=n,0===Is&&js(J)),r===n&&(e.substr(Ss,9)===Q?(r=Q,Ss+=9):(r=n,0===Is&&js(X)),r===n&&(e.substr(Ss,6)===Zr?(r=Zr,Ss+=6):(r=n,0===Is&&js(Jr)),r===n&&(e.substr(Ss,7)===Sr?(r=Sr,Ss+=7):(r=n,0===Is&&js(Cr)),r===n&&(e.substr(Ss,6)===rt?(r=rt,Ss+=6):(r=n,0===Is&&js(it))))))))),r!==n?(Pi.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(Mi)),i===n&&(i=Ss,Is++,e.length>Ss?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Oi)),Is--,s===n?i=void 0:(Ss=i,i=n)),i!==n?(Cs=t,t=r=Ni(r)):(Ss=t,t=n)):(Ss=t,t=n),t}(),Is--,i===n?r=void 0:(Ss=r,r=n),r!==n)if(ts.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(ns)),i!==n){for(s=[],Qi.test(e.charAt(Ss))?(o=e.charAt(Ss),Ss++):(o=n,0===Is&&js(Xi));o!==n;)s.push(o),Qi.test(e.charAt(Ss))?(o=e.charAt(Ss),Ss++):(o=n,0===Is&&js(Xi));s!==n?(Cs=t,t=r=k()):(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(es)),t}function zo(){let t,r,i,s;if(Is++,t=Ss,ts.test(e.charAt(Ss))?(r=e.charAt(Ss),Ss++):(r=n,0===Is&&js(ns)),r!==n){for(i=[],Qi.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Xi));s!==n;)i.push(s),Qi.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Xi));i!==n?(Cs=t,t=r=k()):(Ss=t,t=n)}else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(rs)),t}function Ho(){let t,r,i,s,o,a,c;if(Is++,t=Ss,r=Ss,(i=Lo())!==n){for(s=[],o=Ss,46===e.charCodeAt(Ss)?(a=cr,Ss++):(a=n,0===Is&&js(lr)),a!==n&&(c=Lo())!==n?o=a=[a,c]:(Ss=o,o=n);o!==n;)s.push(o),o=Ss,46===e.charCodeAt(Ss)?(a=cr,Ss++):(a=n,0===Is&&js(lr)),a!==n&&(c=Lo())!==n?o=a=[a,c]:(Ss=o,o=n);s!==n?r=i=[i,s]:(Ss=r,r=n)}else Ss=r,r=n;return t=r!==n?e.substring(t,Ss):r,Is--,t===n&&(r=n,0===Is&&js(is)),t}function Lo(){let t,r,i,s;if(Is++,t=Ss,os.test(e.charAt(Ss))?(r=e.charAt(Ss),Ss++):(r=n,0===Is&&js(as)),r!==n){for(i=[],cs.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(ls));s!==n;)i.push(s),cs.test(e.charAt(Ss))?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(ls));i!==n?(Cs=t,t=r=hs()):(Ss=t,t=n)}else Ss=t,t=n;return Is--,t===n&&(r=n,0===Is&&js(ss)),t}function Uo(){let t,r;if(Is++,t=[],32===e.charCodeAt(Ss)?(r=xi,Ss++):(r=n,0===Is&&js(Ti)),r!==n)for(;r!==n;)t.push(r),32===e.charCodeAt(Ss)?(r=xi,Ss++):(r=n,0===Is&&js(Ti));else t=n;return Is--,t===n&&(r=n,0===Is&&js(us)),t}function qo(){let t,r,i,s,o;for(Is++,t=Ss,r=[],ps.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(fs));i!==n;)r.push(i),ps.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(fs));if(r!==n?(i=Ss,Is++,e.length>Ss?(s=e.charAt(Ss),Ss++):(s=n,0===Is&&js(Oi)),Is--,s===n?i=void 0:(Ss=i,i=n),i!==n?t=r=[r,i]:(Ss=t,t=n)):(Ss=t,t=n),t===n){for(t=Ss,r=[],ps.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(fs));i!==n;)r.push(i),ps.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(fs));if(r!==n)if(e.substr(Ss,2)===ms?(i=ms,Ss+=2):(i=n,0===Is&&js(gs)),i!==n){for(s=[],S.test(e.charAt(Ss))?(o=e.charAt(Ss),Ss++):(o=n,0===Is&&js(C));o!==n;)s.push(o),S.test(e.charAt(Ss))?(o=e.charAt(Ss),Ss++):(o=n,0===Is&&js(C));s!==n&&(o=qo())!==n?t=r=[r,i,s,o]:(Ss=t,t=n)}else Ss=t,t=n;else Ss=t,t=n;if(t===n){for(t=Ss,r=[],ps.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(fs));i!==n;)r.push(i),ps.test(e.charAt(Ss))?(i=e.charAt(Ss),Ss++):(i=n,0===Is&&js(fs));r!==n&&(i=Ko())!==n?((s=qo())===n&&(s=null),s!==n?t=r=[r,i,s]:(Ss=t,t=n)):(Ss=t,t=n)}}return Is--,t===n&&(r=n,0===Is&&js(ds)),t}function Ko(){let t,r,i,s;return Is++,t=Ss,13===e.charCodeAt(Ss)?(r=_s,Ss++):(r=n,0===Is&&js(vs)),r===n&&(r=null),r!==n?(10===e.charCodeAt(Ss)?(i=ws,Ss++):(i=n,0===Is&&js(bs)),i!==n?(13===e.charCodeAt(Ss)?(s=_s,Ss++):(s=n,0===Is&&js(vs)),s===n&&(s=null),s!==n?t=r=[r,i,s]:(Ss=t,t=n)):(Ss=t,t=n)):(Ss=t,t=n),Is--,t===n&&(r=n,0===Is&&js(ys)),t}let Wo="",Vo="";const Zo=[],Jo=()=>({kind:"handle-ref",id:null,name:null,tags:[],location:As()});function Go(e){return e[1].map(e=>e[1])}function Yo(e,t,n){if(null!==e){const n=t(e);if(null!==n)return n}return null===n?null:n}if((xs=i())!==n&&Ss===e.length)return xs;throw xs!==n&&Ss<e.length&&js({type:"end"}),Fs(Es,Ts<e.length?e.charAt(Ts):null,Ts<e.length?Ds(Ts,Ts+1):Ds(Ts,Ts))};var ln,hn=n(51),un=n.n(hn);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
async function dn(e){const t=un.a.createHash("sha1");return t.update(e),Promise.resolve().then(()=>t.digest("hex"))}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class pn{constructor(){this.storageKey=null,this.name=null}apply(e){e.forEach(e=>{this[e.key]=e.value})}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function fn(e,t){return e===t?0:null===e?-1:1}function mn(e,t){return null==e||null==t?fn(e,t):e.localeCompare(t)}function gn(e,t){return null==e||null==t?fn(e,t):e-t}function yn(e,t,n){if(d()(null!=e),d()(null!=t),e.length!==t.length)return gn(e.length,t.length);for(let r=0;r<e.length;r++){let i;if(0!==(i=n(e[r],t[r])))return i}return 0}function _n(e,t){return null==e||null==t?fn(e,t):e._compareTo(t)}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class vn{}class wn extends vn{constructor(e,t){super(),this.particle=e,this.connection=t}_clone(e){return new wn(this.particle,this.connection)}_compareTo(e){let t;return 0!==(t=mn(this.particle.name,e.particle.name))?t:0!==(t=mn(this.connection,e.connection))?t:0}toString(e){return this.connection?`${this.particle.name}.${this.connection}`:`${this.particle.name}`}}class bn extends vn{constructor(e,t){super(),d()(e),this.instance=e,this.connection=t}_clone(e){return new bn(e.get(this.instance),this.connection)}_compareTo(e){let t;return 0!==(t=_n(this.instance,e.instance))?t:0!==(t=mn(this.connection,e.connection))?t:0}toString(e){return this.connection?`${e.get(this.instance)}.${this.connection}`:`${e.get(this.instance)}`}}class Sn extends vn{constructor(e){super(),this.handle=e}_clone(e){return new Sn(this.handle)}_compareTo(e){let t;return 0!==(t=mn(this.handle.localName,e.handle.localName))?t:0}toString(e){return`${this.handle.localName}`}}class Cn extends vn{constructor(e){super(),this.tags=e}_clone(e){return new Cn(this.tags)}_compareTo(e){let t;return 0!==(t=yn(this.tags,e.tags,mn))?t:0}toString(e){return this.tags.map(e=>`#${e}`).join(" ")}}class kn{constructor(e,t,n,r){d()(n),d()(r),this.from=e,this.to=t,this.direction=n,this.type=r,Object.freeze(this)}_copyInto(e,t){if("constraint"===this.type){if(!(this.from instanceof bn||this.to instanceof bn))return e.newConnectionConstraint(this.from._clone(),this.to._clone(),this.direction);d()(!1,"Can't have connection constraints of type constraint with InstanceEndPoints")}return e.newObligation(this.from._clone(t),this.to._clone(t),this.direction)}_compareTo(e){let t;return 0!==(t=this.from._compareTo(e.from))?t:0!==(t=this.to._compareTo(e.to))?t:0!==(t=mn(this.direction,e.direction))?t:0}toString(e,t){let n="";return t&&!0===t.showUnresolved&&"obligation"===this.type&&(n=" // unresolved obligation"),`${this.from.toString(e)} ${this.direction} ${this.to.toString(e)}${n}`}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function xn(e){switch(e){case"->":return"out";case"<-":return"in";case"<->":return"inout";case"consume":return"`consume";case"provide":return"`provide";case"=":return"any";default:throw new Error(`Bad arrow ${e}`)}}function Tn(e,t){return En(e).includes(t)}function En(e){switch(e){case"any":return["any","in","out","inout","host","`consume","`provide"];case"in":return["any","in","inout","host","`consume"];case"out":return["any","out","inout","`provide"];case"inout":return["any","inout"];case"host":return["any","host"];case"`consume":return["any","`consume"];case"`provide":return["any","`provide"];default:throw new Error(`Bad direction ${e}`)}}class In{constructor(e,t,n,r){this.recipe=e,this.particles=t,this.handles=n,this.reverse=new Map;for(const e of Object.keys(t))this.reverse.set(t[e],e);for(const e of n.keys())this.reverse.set(n.get(e),e);for(const e of Object.keys(r))this.reverse.set(r[e],e)}}class Rn{static makeShape(e,t,n,r){r=r||new Mn;const i={},s=new Map,o={};return e.forEach(e=>i[e]=r.newParticle(e)),t.forEach(e=>s.set(e,r.newHandle())),Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(t=>{const r=n[e][t],a=r.tags||[];r.localName&&(s.get(r.handle).localName=r.localName);const c=i[e].addConnectionName(t);c.direction=xn(r.direction||"="),s.get(r.handle).tags=a,c.connectToHandle(s.get(r.handle)),o[e+":"+t]=i[e].connections[t]})}),new In(r,i,s,o)}static recipeToShape(e){const t={};let n=0;e.particles.forEach(e=>t[e.name]=e);const r=new Map;e.handles.forEach(e=>r.set("h"+n++,e));const i={};return e.handleConnections.forEach(e=>i[e.particle.name+":"+e.name]=e),new In(e,t,r,i)}static _buildNewHCMatches(e,t,n,r){const{forward:i,reverse:s,score:o}=n;let a=!1;for(const n of e.particles)if(n.spec)for(const e of n.spec.handleConnections){if(s.has(e))continue;if(n.name!==t.particle.name)continue;if(t.name&&t.name!==e.name)continue;if(!Tn(t.direction,e.direction))continue;const c=n.connections[e.name];if(t.handle&&c&&c.handle&&t.handle.localName&&t.handle.localName!==c.handle.localName)continue;if(s.has(n)){if(s.get(n)!==t.particle)continue}else if(i.has(t.particle))continue;if(t.handle&&c&&c.handle){if(s.has(c.handle)){if(s.get(c.handle)!==t.handle)continue}else if(i.has(t.handle)&&null!==i.get(t.handle))continue;if("create"!==t.handle.fate||"create"!==c.handle.fate&&"create"!==c.handle.originalFate){if(Boolean(t.handle.immediateValue)!==Boolean(c.handle.immediateValue))continue;if(c.handle.immediateValue){if(!c.handle.immediateValue.equals(t.handle.immediateValue))continue}else if(t.handle.id!==c.handle.id&&t.handle.id!==c.handle.originalId)continue}}const l={forward:new Map(i),reverse:new Map(s),score:o};d()(!l.reverse.has(n)||l.reverse.get(n)===t.particle),d()(!l.forward.has(t.particle)||l.forward.get(t.particle)===n),l.forward.set(t.particle,n),l.reverse.set(n,t.particle),t.handle&&(c&&c.handle?(l.forward.set(t.handle,c.handle),l.reverse.set(c.handle,t.handle)):l.forward.has(t.handle)||(l.forward.set(t.handle,null),l.score-=2)),l.forward.set(t,e),l.reverse.set(e,t),r.push(l),a=!0}if(!1===a){if(n.forward.get(t.particle))return;const i=[];Rn._buildNewParticleMatches(e,t.particle,n,i),i.forEach(e=>{t.handle&&!e.forward.has(t.handle)&&(e.forward.set(t.handle,null),e.score-=2),e.forward.set(t,null),e.score-=1,r.push(e)})}}static _buildNewParticleMatches(e,t,n,r){const{forward:i,reverse:s,score:o}=n;let a=!1;for(const n of e.particles){if(s.has(n))continue;if(n.name!==t.name)continue;let e=!0;for(const r of Object.keys(n.connections)){const i=n.connections[r];if(!i.handle)continue;const s=t.connections[r];if(s&&s.handle&&s.handle.localName&&s.handle.localName!==i.handle.localName){e=!1;break}}if(!e)continue;const c={forward:new Map(i),reverse:new Map(s),score:o};d()(!c.forward.has(t)||c.forward.get(t)===n),d()(!c.reverse.has(n)||c.reverse.get(n)===t),c.forward.set(t,n),c.reverse.set(n,t),r.push(c),a=!0}if(!1===a){const e={forward:new Map,reverse:new Map,score:0};i.forEach((t,n)=>{d()(!e.forward.has(n)||e.forward.get(n)===t),e.forward.set(n,t)}),s.forEach((t,n)=>{d()(!e.reverse.has(n)||e.reverse.get(n)===t),e.reverse.set(n,t)}),e.forward.has(t)||(e.forward.set(t,null),e.score=n.score-1),r.push(e)}}static _assignHandlesToEmptyPosition(e,t,n,r){if(1===n.length){const e=[],{forward:i,reverse:s,score:o}=t;for(const t of r){let r=!0;for(const e of t.tags)if(!n[0].tags.includes(e)){r=!1;break}if(!r)continue;const a={forward:new Map(i),reverse:new Map(s),score:o+1};a.forward.set(t,n[0]),a.reverse.set(n[0],t),e.push(a)}return e}const i=n.pop(),s=Rn._assignHandlesToEmptyPosition(e,t,n,r);let o=[];for(const t of s){const n=[...e.handles.values()].filter(e=>null===t.forward.get(e));o=n.length>0?o.concat(Rn._assignHandlesToEmptyPosition(e,t,[i],n)):o.concat(t)}return o}static find(e,t){let n=[{forward:new Map,reverse:new Map,score:0}];for(const r of t.recipe.handleConnections){const t=[];for(const i of n)Rn._buildNewHCMatches(e,r,i,t);n=t}for(const r of t.recipe.particles){if(Object.keys(r.connections).length>0)continue;if(r.unnamedConnections.length>0)continue;const t=[];for(const i of n)Rn._buildNewParticleMatches(e,r,i,t);n=t}const r=e.handles.filter(e=>0===e.connections.length);if(r.length>0){let e=[];for(const i of n){const n=[...t.handles.values()].filter(e=>null===i.forward.get(e));e=n.length>0?e.concat(Rn._assignHandlesToEmptyPosition(t,i,r,n)):e.concat(i)}n=e}return n.map(e=>{const n={};return e.forward.forEach((e,r)=>n[t.reverse.get(r)]=e),{match:n,score:e.score}})}static constructImmediateValueHandle(e,t,n){if(d()(e.type instanceof at),!(e.type instanceof at&&e.type.interfaceInfo.restrictType(t)))return null;const r=e.type.clone(new Map);r.maybeEnsureResolved();const i=e.recipe.newHandle();return i.id=n.toString(),i.mappedType=r,i.fate="copy",i.immediateValue=t,i}static directionCounts(e){const t={in:0,out:0,inout:0,host:0,"`consume":0,"`provide":0,any:0};for(const n of e.connections)t[n.direction]++;return t.in+=t.inout,t.out+=t.inout,t}static matchesRecipe(e,t){const n=Rn.recipeToShape(t);return Rn.find(e,n).some(e=>0===e.score)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class An{constructor(e,t){this._tags=[],this.resolvedType=void 0,this._direction="any",this._handle=void 0,d()(t),d()(t.recipe),this._recipe=t.recipe,this._name=e,this._particle=t}_clone(e,t){if(t.has(this))return t.get(this);const n=new An(this._name,e);return n._tags=[...this._tags],n.resolvedType=this.resolvedType,n._direction=this._direction,null!=this._handle&&(n._handle=t.get(this._handle),d()(void 0!==n._handle),n._handle.connections.push(n)),t.set(this,n),n}cloneTypeWithResolutions(e){this.resolvedType&&(this.resolvedType=this.resolvedType._cloneWithResolutions(e))}_normalize(){this._tags.sort(),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=_n(this._particle,e._particle))?t:0!==(t=mn(this._name,e._name))?t:0!==(t=yn(this._tags,e._tags,mn))?t:0!==(t=_n(this._handle,e._handle))?t:0!==(t=mn(this._direction,e._direction))?t:0}get recipe(){return this._recipe}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get tags(){return this._tags}get type(){if(this.resolvedType)return this.resolvedType;const e=this.spec;return e?e.type:void 0}get direction(){if("any"!==this._direction)return this._direction;const e=this.spec;return e?e.direction:"any"}get isInput(){return"in"===this.direction||"inout"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}get handle(){return this._handle}get particle(){return this._particle}set tags(e){this._tags=e}set type(e){this.resolvedType=e,this._resetHandleType()}set direction(e){if(null===e)throw new Error(`Invalid direction '${e}' for handle connection '${this.getQualifiedName()}'`);this._direction=e,this._resetHandleType()}get spec(){return null==this.particle.spec?null:this.particle.spec.handleConnectionMap.get(this.name)}toSlotConnection(){if(!this.handle||"`slot"!==this.handle.fate)return;const e=new Nn(this.name,this.particle);return e.tags=this.tags,e.targetSlot=this.handle&&this.handle.toSlot(),this.spec&&this.spec.dependentConnections.forEach(t=>{const n=this.particle.getConnectionByName(t.name);if(!n)return;const r=n.toSlotConnection();r&&(d()(!e.providedSlots[n.spec.name],`provided slot '${n.spec.name}' already exists`),e.providedSlots[n.spec.name]=r.targetSlot)}),e}get isOptional(){return null!=this.spec&&this.spec.isOptional}_isValid(e){if(null===this.direction||void 0===this.direction)return e&&e.errors&&e.errors.set(this,`Invalid direction '${this.direction}' for handle connection '${this.getQualifiedName()}'`),!1;if(this.particle.spec&&this.name){const t=this.spec;if(!t)return e&&e.errors&&e.errors.set(this,`Connection ${this.name} is not defined by ${this.particle.name}.`),!1;if(!En(this.direction).includes(t.direction))return e&&e.errors&&e.errors.set(this,`Direction '${this.direction}' for handle connection '${this.getQualifiedName()}' doesn't match particle spec's direction '${t.direction}'`),!1;if(this.resolvedType){if(!t.isCompatibleType(this.resolvedType))return e&&e.errors&&e.errors.set(this,`Type '${this.resolvedType.toString()} for handle connection '${this.getQualifiedName()}' doesn't match particle spec's type '${t.type.toString()}'`),!1}else this.resolvedType=t.type}return!0}isResolved(e){let t;if(d()(Object.isFrozen(this)),this.spec&&this.spec.parentConnection){if(!(t=this.particle.connections[this.spec.parentConnection.name]))return e&&(e.details=`parent connection '${this.spec.parentConnection.name}' missing`),!1;if(!t.handle)return e&&(e.details=`parent connection '${this.spec.parentConnection.name}' missing handle`),!1}return this.handle?this.direction?!!this.type||(e&&(e.details="missing type"),!1):(e&&(e.details="missing direction"),!1):!!this.isOptional||(e&&(e.details="missing handle"),!1)}_resetHandleType(){this._handle&&(this._handle._type=void 0)}connectToHandle(e){d()(e.recipe===this.recipe),this._handle=e,this._resetHandleType(),this._handle.connections.push(this)}disconnectHandle(){const e=this._handle.connections.indexOf(this);d()(e>=0),this._handle.connections.splice(e,1),this._handle=void 0}toString(e,t){const n=[];return n.push(this.name||"*"),n.push(function(e){switch(e){case"out":return"->";case"in":return"<-";case"inout":return"<->";case"`consume":return"consume";case"`provide":return"provide";case"host":case"any":return"=";default:throw new Error(`Bad direction ${e}`)}}(this.direction)),this.handle&&(this.handle.immediateValue?n.push(this.handle.immediateValue.name):n.push(`${e&&e.get(this.handle)||this.handle.localName}`)),n.push(...this.tags.map(e=>`#${e}`)),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved handle-connection: ${t.details}`)),n.join(" ")}findSpecsForUnnamedHandles(){return this.particle.spec.handleConnections.filter(e=>!e.isOptional&&dt.compareTypes({type:this.handle.type},{type:e.type})&&!this.particle.getConnectionByName(e.name))}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class $n{constructor(e,t){this._id=void 0,this._localName=void 0,this.spec=void 0,this._verbs=[],this._tags=[],this._connections={},this._unnamedConnections=[],this._consumedSlotConnections={},d()(e),this._recipe=e,this._name=t}_copyInto(e,t,n){const r=e.newParticle(this._name);r._id=this._id,r._verbs=[...this._verbs],r._tags=[...this._tags],r.spec=this.spec?this.spec.cloneWithResolutions(n):void 0,Object.keys(this._connections).forEach(e=>{r._connections[e]=this._connections[e]._clone(r,t)}),r._unnamedConnections=this._unnamedConnections.map(e=>e._clone(r,t)),r._cloneConnectionRawTypes(n);for(const n of this.getSlotConnectionNames()){const i=this.getSlotConnectionByName(n);if(r._consumedSlotConnections[n]=i._clone(r,t),t.has(i.targetSlot)){d()(e instanceof On);const s=t.get(i.targetSlot);r.getSlotConnectionByName(n).connectToSlot(s),-1===r.recipe.slots.indexOf(s)&&r.recipe.slots.push(s)}for(const[s,o]of Object.entries(i.providedSlots))if(t.has(o)){d()(e instanceof On);const i=t.get(o);i.sourceConnection=r.getSlotConnectionByName(n),r.getSlotConnectionByName(n).providedSlots[s]=i,-1===r.recipe.slots.indexOf(i)&&r.recipe.slots.push(i)}}return r}_cloneConnectionRawTypes(e){for(const t of Object.values(this._connections))t.cloneTypeWithResolutions(e);for(const t of this._unnamedConnections)t.cloneTypeWithResolutions(e)}_startNormalize(){this._localName=null,this._verbs.sort(),this._tags.sort();const e={};for(const t of Object.keys(this._connections).sort())e[t]=this._connections[t];this._connections=e;const t={};for(const e of this.getSlotConnectionNames().sort())t[e]=this.getSlotConnectionByName(e);this._consumedSlotConnections=t}_finishNormalize(){this._unnamedConnections.sort(_n),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=mn(this._id?this._id.toString():"",e._id?e._id.toString():""))?t:0!==(t=mn(this._name,e._name))?t:0!==(t=mn(this._localName,e._localName))?t:0!==(t=yn(this._verbs,e._verbs,mn))?t:0!==(t=yn(this._tags,e._tags,mn))?t:0}matches(e){if(this.name&&e.name&&this.name!==e.name)return!1;for(const t of this.getSlotConnectionNames()){const n=this.getSlotConnectionByName(t);if(null==e.getSlotConnectionByName(t)||null==e.getSlotConnectionByName(t).targetSlot)return!1;if(n.targetSlot&&n.targetSlot.id&&n.targetSlot.id!==e.getSlotConnectionByName(t).targetSlot.id)return!1;for(const r of Object.keys(n.providedSlots)){const i=n.providedSlots[r],s=e.getSlotConnectionByName(t).providedSlots[r];if(null==s||i.id&&s.id&&i.id!==s.id)return!1}}return!0}_isValid(e){return!this.spec||(!(!this.name&&!this.primaryVerb)||(e&&e.errors&&e.errors.set(this,"Particle has no name and no verb"),!1))}isResolved(e){if(d()(Object.isFrozen(this)),!this.spec)return e&&e.showUnresolved&&(e.details="missing spec"),!1;if(0===Object.values(this.connections).filter(e=>Boolean(e.type.slandleType())).length&&this.spec.slotConnections.size>0){if(0===this.getSlotConnections().filter(e=>void 0!==e.targetSlot).length)return e&&e.showUnresolved&&(e.details=`unfulfilled slot connections ${JSON.stringify([...this.spec.slotConnections])}`),!1}if(!this.spec)return e&&e.showUnresolved&&(e.details="missing spec"),!1;const t=this.getUnboundConnections().filter(e=>{let t=e.parentConnection;for(;null!==t;){if(!this.connections[t.name])return!1;t=t.parentConnection}return!0});return t.length>0?(e&&e.showUnresolved&&(e.details=`unresolved connections: ${t.map(e=>e.name).join(", ")}`),!1):0===this.unnamedConnections.length||(e&&e.showUnresolved&&(e.details=`${this.unnamedConnections.length} unnamed connections`),!1)}get recipe(){return this._recipe}get localName(){return this._localName}set localName(e){this._localName=e}get id(){return this._id}set id(e){d()(!this._id,"Particle ID can only be set once."),this._id=e}get name(){return this._name}set name(e){this._name=e}get connections(){return this._connections}get unnamedConnections(){return this._unnamedConnections}get primaryVerb(){return this._verbs.length>0?this._verbs[0]:void 0}set verbs(e){this._verbs=e}set tags(e){this._tags=e}addUnnamedConnection(){const e=new An(void 0,this);return this._unnamedConnections.push(e),e}addConnectionName(e){return d()(e,"Cannot create connection with no name"),d()(null==this._connections[e]),this._connections[e]=new An(e,this),this._connections[e]}allConnections(){return Object.values(this._connections).concat(this._unnamedConnections)}ensureConnectionName(e){return this._connections[e]||this.addConnectionName(e)}getSlotConnectionNames(){return Object.keys(this._consumedSlotConnections)}getSlandleConnectionByName(e){if(e in this._connections){return this._connections[e].toSlotConnection()}return this._consumedSlotConnections[e]}getSlandleConnectionBySpec(e){return this.getSlandleConnections().find(t=>t.getSlotSpec()===e)}getSlotConnectionByName(e){return this._consumedSlotConnections[e]}getSlotConnectionBySpec(e){return this.getSlotConnections().find(t=>t.getSlotSpec()===e)}getSlandleConnections(){return[...Object.values(this._consumedSlotConnections),...this.allConnections().map(e=>"`consume"===e.direction&&e.toSlotConnection()).filter(e=>e)]}getSlotConnections(){return Object.values(this._consumedSlotConnections)}getSlotSpecByName(e){if(!this.spec)return;const t=this.spec.slotConnections.get(e);if(t)return t;for(const t of this.spec.slotConnections.values())for(const n of t.provideSlotConnections)if(n.name===e)return n}getProvidedSlotByName(e,t){const n=this.getSlotConnectionByName(e);return n&&n.providedSlots[t]}getSlotSpecs(){return this.spec?this.spec.slotConnections:new Map}getConnectionByName(e){return this._connections[e]}nameConnection(e,t){d()(!this._connections[t],`Connection "${t}" already has a handle`);const n=this._unnamedConnections.indexOf(e);d()(n>=0,`Cannot name '${t}' nonexistent unnamed connection.`),e._name=t;const r=this.spec.getConnectionByName(t);e.type=r.type,e.direction!==r.direction&&(d()("inout"===e.direction,`Unnamed connection cannot adjust direction ${e.direction} to ${t}'s direction ${r.direction}`),e.direction=r.direction),this._connections[t]=e,this._unnamedConnections.splice(n,1)}getUnboundConnections(e){return this.spec.handleConnections.filter(t=>!t.isOptional&&!this.getConnectionByName(t.name)&&(!e||dt.compareTypes({type:e},{type:t.type})))}addSlotConnection(e){d()(!this.getSlotConnectionByName(e),"slot connection already exists");const t=this.spec&&this.spec.connections.find(t=>t.name===e),n=t&&t.type.isSlot(),r=t&&t.type.isCollectionType()&&t.type.getContainedType().isSlot();d()(!this.spec||this.spec.slotConnections.has(e)||n||r,`slot connection '${e}' is not in particle spec`);const i=this.addSlotConnectionAsCopy(e),s=this.getSlotSpecByName(e);return s&&s.provideSlotConnections.forEach(e=>{const t=this.recipe.newSlot(e.name);t.sourceConnection=i,i.providedSlots[e.name]=t}),i}addSlotConnectionAsCopy(e){const t=new Nn(e,this);return this._consumedSlotConnections[e]=t,t}removeSlotConnection(e){this._consumedSlotConnections[e.name]=null,e.disconnectFromSlot()}remove(){this.recipe.removeParticle(this)}isJavaParticle(){return this.spec&&(this.spec.implFile||"").endsWith("java")}toString(e={},t){let n=[];this.name?(n.push(this.name),n.push(`as ${t&&t.get(this)||this.localName}`),this.primaryVerb&&this.primaryVerb!==this.name&&n.push(`// verb=${this.primaryVerb}`)):n.push(`&${this.primaryVerb}`),e.showUnresolved&&(this.isResolved(e)||n.push(`// unresolved particle: ${e.details}`)),n=[n.join(" ")];for(const r of this.unnamedConnections)n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const r of Object.values(this.connections))n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const r of this.getSlotConnections())n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));return n.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Pn{constructor(e,t){d()(e),this._phrase=e;const n=this.phrase.toLowerCase().split(/[^a-z0-9]/g);this._unresolvedTokens=[],(t||n).forEach(e=>this._unresolvedTokens.push(e)),this._resolvedTokens=n.slice();for(const e of this.unresolvedTokens){const t=this._resolvedTokens.indexOf(e);t>=0&&this._resolvedTokens.splice(t,1)}d()(n.length===this.unresolvedTokens.length+this.resolvedTokens.length)}_append(e,t,n){this._phrase.length>0&&(this._phrase=this.phrase.concat(" ")),this._phrase=this._phrase.concat(e),n.forEach(e=>this._resolvedTokens.push(e)),t.forEach(e=>this._unresolvedTokens.push(e))}get phrase(){return this._phrase}get unresolvedTokens(){return this._unresolvedTokens}get resolvedTokens(){return this._resolvedTokens}resolveToken(e){const t=this.unresolvedTokens.indexOf(e.toLowerCase());d()(t>=0,`Cannot resolved nonexistent token ${e}`),this._unresolvedTokens.splice(t,1),this._resolvedTokens.push(e.toLowerCase())}isValid(){return this._unresolvedTokens.length>0||this._resolvedTokens.length>0}isResolved(){return d()(Object.isFrozen(this)),this._resolvedTokens.length>0}_normalize(){this._unresolvedTokens.sort(),this._resolvedTokens.sort(),Object.freeze(this)}_copyInto(e){return e.search?e.search._append(this.phrase,this.unresolvedTokens,this.resolvedTokens):(e.search=new Pn(this.phrase,this.unresolvedTokens),d()(e.search.resolvedTokens.length===this.resolvedTokens.length,`${e.search.resolvedTokens} is not same as ${this.resolvedTokens}`)),d()(this.resolvedTokens.every(t=>e.search.resolvedTokens.indexOf(t)>=0)&&this.unresolvedTokens.every(t=>e.search.unresolvedTokens.indexOf(t)>=0)),e.search}toString(e){const t=[];t.push(`search \`${this.phrase}\``);const n=[];return n.push("  tokens"),this.unresolvedTokens.length>0&&n.push(this.unresolvedTokens.map(e=>`\`${e}\``).join(" ")),this.resolvedTokens.length>0&&n.push(`// ${this.resolvedTokens.map(e=>`\`${e}\``).join(" ")}`),e&&e.showUnresolved&&this.unresolvedTokens.length>0&&n.push("// unresolved search tokens"),t.push(n.join(" ")),t.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Mn{constructor(e){this._requires=[],this._particles=[],this._handles=[],this._slots=[],this._localName=void 0,this.annotation=void 0,this.triggers=[],this._connectionConstraints=[],this._obligations=[],this._verbs=[],this._search=null,this._patterns=[],this._name=e}newConnectionConstraint(e,t,n){const r=new kn(e,t,n,"constraint");return this._connectionConstraints.push(r),r}newObligation(e,t,n){const r=new kn(e,t,n,"obligation");return this._obligations.push(r),r}removeObligation(e){const t=this._obligations.indexOf(e);d()(t>-1),this._obligations.splice(t,1)}removeConstraint(e){const t=this._connectionConstraints.indexOf(e);d()(t>=0),this._connectionConstraints.splice(t,1)}clearConnectionConstraints(){this._connectionConstraints.length=0}newRequireSection(){const e=new On(this);return this._requires.push(e),e}newParticle(e){const t=new $n(this,e);return this._particles.push(t),t}removeParticle(e){const t=this._particles.indexOf(e);d()(t>-1),this._particles.splice(t,1),e.getSlotConnections().forEach(e=>e.remove())}newHandle(){const e=new Dn(this);return this._handles.push(e),e}removeHandle(e){d()(0===e.connections.length);const t=this._handles.indexOf(e);d()(t>-1),this._handles.splice(t,1)}newSlot(e){const t=new Bn(this,e);return this._slots.push(t),t}addSlot(e){-1===this.slots.indexOf(e)&&this.slots.push(e)}removeSlot(e){d()(0===e.consumeConnections.length);let t=this._slots.indexOf(e);d()(t>-1),this._slots.splice(t,1);for(const n of this.requires)-1!==(t=n.slots.indexOf(e))&&n.slots.splice(t,1)}isResolved(e){d()(Object.isFrozen(this),"Recipe must be normalized to be resolved.");const t=(t,n)=>(!t&&e&&e.errors&&e.errors.set(this.name,n),t);return t(0===this._obligations.length,"unresolved obligations")&&t(0===this._connectionConstraints.length,"unresolved constraints")&&t(this.requires.every(e=>e.isEmpty()),"unresolved require")&&t(null===this._search||this._search.isResolved(),"unresolved search")&&t(this._handles.every(e=>e.isResolved()),"unresolved handles")&&t(this._particles.every(t=>t.isResolved(e)),"unresolved particles")&&t(this.modality.isResolved(),"unresolved modality")&&t(this.allRequiredSlotsPresent(e),"unresolved required slot")&&t(this._slots.every(e=>e.isResolved()),"unresolved slots")&&t(this.handleConnections.every(t=>t.isResolved(e)),"unresolved handle connections")&&t(this.slotConnections.every(t=>t.isResolved(e)),"unresolved slot connections")}isCompatible(e){return this.particles.every(t=>!t.spec||t.spec.isCompatible(e))}get modality(){return fe.intersection(this.particles.filter(e=>Boolean(e.spec&&e.spec.slandleConnectionNames().length>0)).map(e=>e.spec.modality))}allRequiredSlotsPresent(e){for(const t of this.particles){if(0===t.spec.slotConnections.size)continue;let n=!1,r=!1;for(const e of Object.values(t.spec.connections))e.type.slandleType()&&(r=!0);for(const[r,i]of t.spec.slotConnections){if(i.isRequired&&!t.getSlotConnectionByName(r))return e&&e.errors&&e.errors.set(r,`required slot ${r} has no matching connection`),!1;if(t.getSlotConnectionByName(r)){n=!0;for(const n of i.provideSlotConnections)if(n.isRequired&&!t.getProvidedSlotByName(r,n.name))return e&&e.errors&&e.errors.set(r,`required provided slot ${n.name} has no matching connection`),!1}}if(!r&&!n)return e&&e.errors&&e.errors.set("?","no slot connections"),!1}return!0}_findDuplicate(e,t){const n=new Set,r=e.find(e=>{if(e.id){if(n.has(e.id))return e;n.add(e.id)}});return r&&t&&t.errors&&t.errors.set(r,`Has Duplicate ${r instanceof Dn?"Handle":"Slot"} '${r.id}'`),r}_isValid(e){const t=t=>t.every(t=>t._isValid(e));return!this._findDuplicate(this._handles,e)&&!this._findDuplicate(this._slots,e)&&t(this._handles)&&t(this._particles)&&t(this._slots)&&t(this.handleConnections)&&t(this.slotConnections)&&(!this.search||this.search.isValid())}get requires(){return this._requires}get name(){return this._name}set name(e){this._name=e}get localName(){return this._localName}set localName(e){this._localName=e}get particles(){return this._particles}set particles(e){this._particles=e}get handles(){return this._handles}set handles(e){this._handles=e}get slots(){return this._slots}set slots(e){this._slots=e}get connectionConstraints(){return this._connectionConstraints}get obligations(){return this._obligations}get verbs(){return this._verbs}set verbs(e){this._verbs=e}get search(){return this._search}set search(e){this._search=e}setSearchPhrase(e){d()(!this._search,"Cannot override search phrase"),e&&(this._search=new Pn(e))}get slotConnections(){const e=[];return this._particles.forEach(t=>{e.push(...t.getSlotConnections())}),e}get handleConnections(){const e=[];return this._particles.forEach(t=>{e.push(...Object.values(t.connections)),e.push(...t._unnamedConnections)}),e}isEmpty(){return 0===this.particles.length&&0===this.handles.length&&0===this.slots.length&&0===this._connectionConstraints.length}findHandle(e){for(const t of this.handles)if(t.id===e)return t;return null}findSlot(e){for(const t of this.slots)if(t.id===e)return t;return null}findParticle(e){for(const t of this.particles)if(t.id.toString()===e)return t;return null}get patterns(){return this._patterns}set patterns(e){this._patterns=e}set description(e){const t=e.find(e=>"pattern"===e.name);t&&t.patterns.forEach(e=>this._patterns.push(e)),e.forEach(e=>{if("pattern"!==e.name){const t=this.handles.find(t=>t.localName===e.name);d()(t,`Cannot set description pattern for nonexistent handle ${e.name}.`),t.pattern=e.pattern}})}async digest(){return dn(this.toString())}normalize(e){if(Object.isFrozen(this))return e&&e.errors&&e.errors.set(this,"already normalized"),!1;if(!this._isValid()){this._findDuplicate(this._handles,e),this._findDuplicate(this._slots,e);const t=t=>t.forEach(t=>!t._isValid(e));return t(this._handles),t(this._particles),t(this._slots),t(this.handleConnections),t(this.slotConnections),!1}for(const e of this._particles)e._startNormalize();for(const e of this._handles)e._startNormalize();for(const e of this._slots)e._startNormalize();const t=this.handleConnections;for(const e of t)e._normalize();t.sort(_n);const n=this.slotConnections;for(const e of n)e._normalize();n.sort(_n),this.search&&this.search._normalize();for(const e of this.requires)e.normalize();for(const e of this._particles)e._finishNormalize();for(const e of this._handles)e._finishNormalize();for(const e of this._slots)e._finishNormalize();const r=new Set,i=new Set,s=new Set,o=[],a=[],c=[];let l=t.filter(e=>!(e.type&&e.type instanceof at));l=l.concat(t.filter(e=>!!e.type&&!!(e.type instanceof at)));for(const e of l)i.has(e.particle)||(o.push(e.particle),i.add(e.particle)),e.handle&&!r.has(e.handle)&&(a.push(e.handle),r.add(e.handle));for(const e of n)e.targetSlot&&!s.has(e.targetSlot)&&(c.push(e.targetSlot),s.add(e.targetSlot)),Object.values(e.providedSlots).forEach(e=>{s.has(e)||(c.push(e),s.add(e))});const h=this._handles.filter(e=>!r.has(e));h.sort(_n),a.push(...h);const u=this._particles.filter(e=>!i.has(e));u.sort(_n),o.push(...u);const d=this._slots.filter(e=>!s.has(e));return d.sort(_n),c.push(...d),this._particles=o,this._handles=a,this._slots=c,this._connectionConstraints.sort(_n),this._verbs.sort(),this._patterns.sort(),Object.freeze(this._particles),Object.freeze(this._handles),Object.freeze(this._slots),Object.freeze(this._connectionConstraints),Object.freeze(this),!0}clone(e){const t=new Mn(this.name);return null==e&&(e=new Map),this._copyInto(t,e),t._cloneMap=e,t}mergeInto(e){const t=new Map,n=e._handles.length,r=e._particles.length,i=e._slots.length;return this._copyInto(e,t),{handles:e._handles.slice(n),particles:e._particles.slice(r),slots:e._slots.slice(i),cloneMap:t}}_copyInto(e,t){const n=new Map,r=r=>{const i=r._copyInto(e,t,n);t.set(r,i)};e._name=this.name,e._verbs=e._verbs.concat(...this._verbs),this._handles.forEach(r),this._particles.forEach(r),this._slots.forEach(r),this._connectionConstraints.forEach(r),this._obligations.forEach(r),e.verbs=e.verbs.slice(),this.search&&this.search._copyInto(e);for(const n of this.requires){const r=e.newRequireSection();n._copyInto(r,t),r._cloneMap=t}e.patterns=e.patterns.concat(this.patterns)}updateToClone(e){const t={};return Object.keys(e).forEach(n=>t[n]=this._cloneMap.get(e[n])),t}_makeLocalNameMap(){const e=new Set([...this.particles,...this.handles,...this.slots].map(e=>e.localName));let t;const n=new Map,r=(r,i)=>{let s=r.localName;if(!s)do{s=`${i}${t++}`}while(e.has(s));n.set(r,s)};return t=0,this.particles.forEach(e=>r(e,"particle")),t=0,this.handles.forEach(e=>r(e,"handle")),t=0,this.slots.forEach(e=>r(e,"slot")),n}toString(e){const t=this._makeLocalNameMap(),n=[],r=this.verbs.length>0?` ${this.verbs.map(e=>`&${e}`).join(" ")}`:"";n.push(`recipe${this.name?` ${this.name}`:""}${r}`),e&&e.showUnresolved&&this.search&&n.push(this.search.toString(e).replace(/^|(\n)/g,"$1  "));for(const t of this._connectionConstraints){let r=t.toString().replace(/^|(\n)/g,"$1  ");e&&e.showUnresolved&&(r=r.concat(" // unresolved connection-constraint")),n.push(r)}n.push(...this.handles.map(n=>n.toString(e,t)).filter(e=>e).map(e=>e.replace(/^|(\n)/g,"$1  ")));for(const r of this.slots){const i=r.toString(e,t);i&&n.push(i.replace(/^|(\n)/g,"$1  "))}for(const r of this.requires)r.isEmpty()||n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));for(const r of this.particles)n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(e=>void 0!==e.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let e=1;e<this.patterns.length;++e)n.push(`    pattern \`${this.patterns[e]}\``);this.handles.forEach(e=>{e.pattern&&n.push(`    ${e.localName} \`${e.pattern}\``)})}if(this._obligations.length>0){n.push("  obligations");for(const e of this._obligations){const r=e.toString(t).replace(/^|(\n)/g,"$1    ");n.push(r)}}return n.join("\n")}getFreeHandles(){return this.handles.filter(e=>0===e.connections.length)}get allSpecifiedConnections(){return[].concat(...this.particles.filter(e=>e.spec&&e.spec.connections).map(e=>e.spec.connections.map(t=>({particle:e,connSpec:t}))))}getFreeConnections(e){return this.allSpecifiedConnections.filter(({particle:t,connSpec:n})=>!n.isOptional&&"descriptions"!==n.name&&"host"!==n.direction&&!t.connections[n.name]&&(!e||dt.compareTypes({type:e},{type:n.type})))}findHandleByID(e){return this.handles.find(t=>t.id===e)}getUnnamedUntypedConnections(){return this.handleConnections.find(e=>!e.type||!e.name||e.isOptional)}getParticlesByImplFile(e){return this.particles.filter(t=>t.spec&&e.has(t.spec.implFile))}findSlotByID(e){let t=this.slots.find(t=>t.id===e);if(void 0===t)for(const n of this.requires)if(void 0!==(t=n.slots.find(t=>t.id===e)))break;return t}}class On extends Mn{constructor(e,t){super(t),this.parent=e}findSlotByID(e){let t=this.slots.find(t=>t.id===e);return void 0===t&&(t=this.parent.slots.find(t=>t.id===e)),t}toString(e={},t){null==t&&(t=this._makeLocalNameMap());const n=[];n.push("require"),e.showUnresolved&&this.search&&n.push(this.search.toString(e).replace(/^|(\n)/g,"$1  "));for(const t of this.connectionConstraints){let r=t.toString().replace(/^|(\n)/g,"$1  ");e.showUnresolved&&(r=r.concat(" // unresolved connection-constraint")),n.push(r)}n.push(...this.handles.map(n=>n.toString(e,t)).filter(e=>e).map(e=>e.replace(/^|(\n)/g,"$1  ")));for(const r of this.slots){const i=r.toString(e,t);i&&n.push(i.replace(/^|(\n)/g,"$1  "))}for(const r of this.particles)n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(e=>void 0!==e.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let e=1;e<this.patterns.length;++e)n.push(`    pattern \`${this.patterns[e]}\``);this.handles.forEach(e=>{e.pattern&&n.push(`    ${e.localName} \`${e.pattern}\``)})}if(this.obligations.length>0){n.push("  obligations");for(const e of this.obligations){const r=e.toString(t).replace(/^|(\n)/g,"$1    ");n.push(r)}}return n.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Nn{constructor(e,t){this._targetSlot=void 0,this._providedSlots={},this._tags=[],d()(t),d()(t.recipe),d()(e),this._recipe=t.recipe,this._particle=t,this._name=e}remove(){this._particle.removeSlotConnection(this)}get recipe(){return this._recipe}get particle(){return this._particle}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get targetSlot(){return this._targetSlot}set targetSlot(e){this._targetSlot=e}get providedSlots(){return this._providedSlots}get tags(){return this._tags}set tags(e){this._tags=e}getSlotSpec(){return this.particle.spec&&this.particle.spec.getSlandleSpec(this.name)}connectToSlot(e){d()(e),d()(!this.targetSlot),d()(this.recipe instanceof On||this.recipe===e.recipe,"Cannot connect to slot from different recipe"),this._targetSlot=e,e.consumeConnections.push(this)}disconnectFromSlot(){this._targetSlot&&(this._targetSlot.removeConsumeConnection(this),this._targetSlot=void 0)}_clone(e,t){if(t.has(this))return t.get(this);const n=e.addSlotConnectionAsCopy(this.name);return n.tags=this.tags,t.set(this,n),n}_normalize(){const e={};for(const t of Object.keys(this._providedSlots).sort())e[t]=this._providedSlots[t];this._providedSlots=e,Object.freeze(this)}_compareTo(e){let t;return 0!==(t=mn(this.name,e.name))?t:0!==(t=_n(this._targetSlot,e._targetSlot))?t:0!==(t=_n(this._particle,e._particle))?t:0}_isValid(e){return!this._targetSlot||!this._targetSlot.sourceConnection||this._targetSlot===this._targetSlot.sourceConnection.providedSlots[this._targetSlot.name]||(e&&e.errors&&e.errors.set(this,`Invalid target slot '${this._targetSlot.name}' for slot connection '${this.name}' of particle ${this.particle.name}`),!1)}isResolved(e){const t=t=>{e&&e.errors&&e.errors.set(this.name,t),e&&e.details&&(e.details=t)};if(d()(Object.isFrozen(this),`slot connection ${this.name} must be frozen before it is resolved`),!this.name)return t("missing name"),!1;if(!this.particle)return t("missing particle"),!1;const n=this.getSlotSpec();if(void 0===n||n.isRequired){if(!this.targetSlot)return t("missing target-slot"),!1;if(!(this.targetSlot.id||this.targetSlot.sourceConnection&&this.targetSlot.sourceConnection.isConnected()))return t("unresolved target-slot"),!1}return!this.targetSlot||(void 0===n||this.getSlotSpec().provideSlotConnections.every(e=>!e||!e.isRequired||0!==this.providedSlots[e.name].consumeConnections.length||(t("missing consuming slot"),!1)))}isConnectedToInternalSlot(){return this.targetSlot&&!!this.targetSlot.sourceConnection}isConnectedToRemoteSlot(){return this.targetSlot&&!!this.targetSlot.id}isConnected(){return this.isConnectedToInternalSlot()||this.isConnectedToRemoteSlot()}toString(e,t){const n=[];n.push("consume"),n.push(`${this.name}`),this.targetSlot&&n.push(`as ${e&&e.get(this.targetSlot)||this.targetSlot.localName}`),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved slot-connection: ${t.details}`));const r=[];return r.push(n.join(" ")),Object.keys(this.providedSlots).forEach(t=>{const n=this.providedSlots[t],i=[];if(i.push("  provide"),this.getSlotSpec()){const e=this.particle.getSlotSpecByName(t);d()(e,`Cannot find providedSlotSpec for ${t}`)}i.push(`${t} as ${e&&e.get(n)||n}`),r.push(i.join(" "))}),r.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Bn{constructor(e,t){this._id=void 0,this._localName=void 0,this._tags=[],this._sourceConnection=void 0,this._formFactor=void 0,this._consumeConnections=[],d()(e),this._recipe=e,this._name=t}get recipe(){return this._recipe}get id(){return this._id}set id(e){this._id=e}get localName(){return this._localName}set localName(e){this._localName=e}get name(){return this._name}set name(e){this._name=e}get tags(){return this._tags}set tags(e){this._tags=e}get formFactor(){return this._formFactor}set formFactor(e){this._formFactor=e}get sourceConnection(){return this._sourceConnection}set sourceConnection(e){this._sourceConnection=e}get consumeConnections(){return this._consumeConnections}get spec(){return this.sourceConnection&&this.sourceConnection.getSlotSpec()?this.sourceConnection.particle.getSlotSpecByName(this.name):{isSet:!1,tags:[]}}get handles(){const e=[];if(this.sourceConnection&&this.sourceConnection.getSlotSpec())for(const t of this.sourceConnection.particle.getSlotSpecByName(this.name).handles){const n=this.sourceConnection.particle.connections[t];(n||n.handle)&&e.push(n.handle)}return e}_copyInto(e,t){let n=void 0;return t.has(this)?t.get(this):(!this.sourceConnection&&this.id&&(n=e.findSlot(this.id)),null==n&&((n=e.newSlot(this.name))._id=this.id,n._formFactor=this.formFactor,n._localName=this._localName,n._tags=[...this._tags],n._sourceConnection=t.get(this._sourceConnection),n.sourceConnection&&(n.sourceConnection.providedSlots[n.name]=n)),this._consumeConnections.forEach(e=>{const r=t.get(e);r&&r instanceof Nn&&null==r.targetSlot&&r.connectToSlot(n)}),n)}_startNormalize(){this.localName=null,this._tags.sort()}_finishNormalize(){this._consumeConnections.forEach(e=>d()(Object.isFrozen(e))),this._consumeConnections.sort(_n),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=mn(this.id,e.id))?t:0!==(t=mn(this.localName,e.localName))?t:0!==(t=mn(this.formFactor,e.formFactor))?t:0!==(t=yn(this._tags,e._tags,mn))?t:0}findHandleByID(e){return this.handles.find(t=>t.id===e)}removeConsumeConnection(e){const t=this._consumeConnections.indexOf(e);d()(t>-1),this._consumeConnections.splice(t,1),0===this._consumeConnections.length&&this.remove()}remove(){this._recipe.removeSlot(this)}isResolved(e){return d()(Object.isFrozen(this)),e&&e.showUnresolved&&(e.details=[],this._sourceConnection||e.details.push("missing source-connection"),this.id||e.details.push("missing id")),Boolean(this._sourceConnection||this.id)}_isValid(e){return!0}toString(e={},t){const n=[];n.push("slot"),this.id&&n.push(`'${this.id}'`),this.tags.length>0&&n.push(this.tags.map(e=>`#${e}`).join(" ")),n.push(`as ${t&&t.get(this)||this.localName}`);const r=e.showUnresolved&&!this.isResolved(e);return r&&n.push(`// unresolved slot: ${e.details}`),this.id||r?n.join(" "):""}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Dn{constructor(e){this._id=null,this._localName=void 0,this._tags=[],this._type=void 0,this._fate=null,this._originalFate=null,this._originalId=null,this._connections=[],this._mappedType=void 0,this._storageKey=void 0,this._pattern=void 0,this._immediateValue=void 0,this.claims=void 0,d()(e),this._recipe=e}toSlot(){if(!this.type)return;if("`slot"!==this.fate)return;const e=new Bn(this.recipe,this.localName);e.tags=this.tags,e.id=this.id;const t=this.type.slandleType();if(t){const n=t.getSlot();if(n&&(e.formFactor=n.formFactor,n.handle)){const t=void 0;e.sourceConnection=new Nn(n.handle,t)}}return e}_copyInto(e,t,n){let r=void 0;return null!==this._id&&["map","use","copy"].includes(this.fate)&&(r=e.findHandle(this._id)),null==r&&((r=e.newHandle())._id=this._id,r._tags=[...this._tags],r._type=this._type?this._type._cloneWithResolutions(n):void 0,r._fate=this._fate,r._originalFate=this._originalFate,r._originalId=this._originalId,r._mappedType=this._mappedType,r._storageKey=this._storageKey,r._immediateValue=this._immediateValue,r._connections=[],r._pattern=this._pattern),r}mergeInto(e){for(d()(this.recipe===e.recipe,"Cannot merge handles from different recipes.");this.connections.length>0;){const[t]=this.connections;t.disconnectHandle(),t.connectToHandle(e)}e._immediateValue=this._immediateValue,e.tags=e.tags.concat(this.tags),e.recipe.removeHandle(this),e.fate=this._mergedFate([this.fate,e.fate])}_mergedFate(e){return d()(e.length>0,"Cannot merge empty fates list"),d()(!e.includes("map")&&!e.includes("copy"),"Merging map/copy not supported yet"),e.every(e=>"use"===e)?"use":"create"}_startNormalize(){this._localName=null,this._tags.sort();const e=e=>{const t=e&&"?"===this._fate,n=e.canWriteSuperset&&e.canWriteSuperset.slandleType(),r=e.canReadSubset&&e.canReadSubset.slandleType();return t&&(n||r)},t=this.type.resolvedType(),n=t&&t.isCollectionType()&&t.collectionType;(e(t)||e(n))&&(this._fate="`slot")}_finishNormalize(){for(const e of this._connections)d()(Object.isFrozen(e),`Handle connection '${e.name}' is not frozen.`);this._connections.sort(_n),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=mn(this._id,e._id))?t:0!==(t=mn(this._localName,e._localName))?t:0!==(t=yn(this._tags,e._tags,mn))?t:0!==(t=mn(this.fate,e.fate))?t:0!==(t=mn(this._immediateValue&&this._immediateValue.toString()||"",e._immediateValue&&e._immediateValue.toString()||""))?t:0}get fate(){return this._fate||"?"}set fate(e){null==this._originalFate&&(this._originalFate=this._fate),this._fate=e}get originalFate(){return this._originalFate||"?"}get originalId(){return this._originalId}get recipe(){return this._recipe}get tags(){return this._tags}set tags(e){this._tags=e}get type(){return this._type}get id(){return this._id}set id(e){this._originalId||(this._originalId=this._id),this._id=e}mapToStorage(e){if(!e)throw new Error("Cannot map to undefined storage");this._id=e.id,this._originalId=e.originalId,this._type=void 0,this._mappedType=e.type,this._storageKey=e.storageKey,this.claims=e.claims}get localName(){return this._localName}set localName(e){this._localName=e}get connections(){return this._connections}get storageKey(){return this._storageKey}set storageKey(e){this._storageKey=e}get pattern(){return this._pattern}set pattern(e){this._pattern=e}get mappedType(){return this._mappedType}set mappedType(e){this._mappedType=e}get immediateValue(){return this._immediateValue}set immediateValue(e){this._immediateValue=e}static effectiveType(e,t){const n=new Map,r=t.filter(e=>null!=e.type).map(e=>({type:e.type._cloneWithResolutions(n),direction:e.direction}));return dt.processTypeList(e?e._cloneWithResolutions(n):null,r)}static resolveEffectiveType(e,t){const n=t.filter(e=>null!=e.type).map(e=>({type:e.type,direction:e.direction}));return dt.processTypeList(e,n)}_isValid(e){const t=new Set;for(const n of this._connections){if("map"===this.fate&&["out","inout"].includes(n.direction))return e&&e.errors&&e.errors.set(this,`Invalid fate '${this.fate}' for handle '${this}'; it is used for '${n.direction}' ${n.getQualifiedName()} connection`),!1;n.tags.forEach(e=>t.add(e))}this.mappedType||"`slot"!==this.fate||(this._mappedType=rt.make(this.id,null,null));const n=Dn.resolveEffectiveType(this._mappedType,this._connections);return n?(this._type=n,this._tags.forEach(e=>t.add(e)),this._tags=[...t],!0):(e&&e.errors&&e.errors.set(this,`Type validations failed for handle '${this}' with type ${this._mappedType} and fate ${this.fate}`),!1)}isResolved(e){d()(Object.isFrozen(this));let t=!0;if(this.type){let n=!0;"create"!==this.fate&&"`slot"!==this.fate||(n=!1),this.type.canEnsureResolved()||(e&&e.details.push("unresolved type (cannot ensure resolved)"),t=!1),n&&!this.type.isResolved()&&(e&&e.details.push("unresolved type"),t=!1)}else e&&e.details.push("missing type"),t=!1;switch(this.fate){case"?":e&&e.details.push("missing fate"),t=!1;break;case"copy":case"map":case"use":e&&null===this.id&&e.details.push("missing id"),t=t&&null!==this.id;break;case"`slot":case"create":break;default:throw e&&e.details.push(`invalid fate ${this.fate}`),new Error(`Unexpected fate: ${this.fate}`)}return t}toString(e={},t){if(this._immediateValue)return;const n=[];n.push(this.fate),this.id&&n.push(`'${this.id}'`),n.push(...this.tags.map(e=>`#${e}`));const r=t&&t.get(this)||this.localName;if(r&&n.push(`as ${r}`),this.type)if(n.push("//"),this.type.isResolved())n.push(this.type.resolvedType().toString({hideFields:null==e.hideFields||e.hideFields}));else if(n.push(this.type.toString()),e.showUnresolved&&this.type.canEnsureResolved()){const t=tt.fromLiteral(this.type.toLiteral());t.maybeEnsureResolved(),n.push("//"),n.push(t.resolvedType().toString({hideFields:null==e.hideFields||e.hideFields}))}if(e.showUnresolved){const e={details:[]};this.isResolved(e)||n.push(` // unresolved handle: ${e.details.join(", ")}`)}return n.join(" ")}findConnectionByDirection(e){return this._connections.find(t=>t.direction===e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class jn{}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Fn{_compareTo(e){let t;return 0!==(t=mn(this.name,e.name))?t:0!==(t=gn(this.version,e.version))?t:0!==(t=mn(this.source,e.source))?t:0!==(t=mn(this.id,e.id))?t:0}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.change="Change"}(ln||(ln={}));class zn{constructor(e){this.arcId=e,this._debug=!1,d()(void 0!==e,"Arcs with storage must have ids")}set debug(e){this._debug=e}async shutdown(){}}class Hn{constructor(e){Object.assign(this,e)}}class Ln extends Fn{constructor(e,t,n,r){super(),this.referenceMode=!1,d()(n,"id must be provided when constructing StorageProviders"),d()(!e.hasUnresolvedVariable,"Storage types must be concrete"),this._type=e,this.listeners=new Map,this.name=t,this.version=0,this.id=n,this.source=null,this._storageKey=r,this.nextLocalID=0}enableReferenceMode(){this.referenceMode=!0}get storageKey(){return this._storageKey}get type(){return this._type}reportExceptionInHost(e){throw e}on(e,t,n){d()(void 0!==n,"must provide a target to register a storage event handler");const r=ln[e],i=this.listeners.get(r)||new Map;i.set(t,{target:n}),this.listeners.set(r,i)}off(e,t){const n=ln[e],r=this.listeners.get(n);r&&r.delete(t)}async _fire(e,t){const n=ln[e],r=this.listeners.get(n);if(!r||0===r.size)return;const i=[];for(const[e]of r.entries())i.push(e);await 0;for(const e of i)e(t)}toString(e){const t=[],n=[];return n.push("store"),this.name&&n.push(`${this.name}`),n.push(`of ${this.type.toString()}`),this.id&&n.push(`'${this.id}'`),e&&e.length&&n.push(`${e.join(" ")}`),this.source&&n.push(`in '${this.source}'`),t.push(n.join(" ")),this.claims&&this.claims.length>0&&t.push(`  claim is ${this.claims.map(e=>e.tag).join(" and is ")}`),this.description&&t.push(`  description \`${this.description}\``),t.join("\n")}get apiChannelMappingId(){return this.id}dispose(){}async modelForSynchronization(){return this.toLiteral()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Un{constructor(e=[],t={}){this.particleDescriptions=e,this.storeDescById=t,this.seenHandles=new Set,this.seenParticles=new Set,this.excludeValues=!1}getDescription(e){if(e.patterns.length>0){let t=[];for(const n of e.patterns)t.push(this.patternToSuggestion(n,{_recipe:e}));if((t=t.filter(e=>Boolean(e))).length>0)return this._capitalizeAndPunctuate(this._joinDescriptions(t))}const t=new Set(e.particles);let n=this.particleDescriptions.filter(e=>t.has(e._particle)&&this._isSelectedDescription(e));if(n.find(e=>e._particle.spec.slotConnections.size>0)&&(n=n.filter(e=>e._particle.spec.slotConnections.size>0)),(n=n.sort(Un.sort)).length>0)return this._combineSelectedDescriptions(n)}_isSelectedDescription(e){return!!e.pattern}getHandleDescription(e){const t=this._selectHandleConnection(e)||e.connections[0];return this._formatDescription(t)}_combineSelectedDescriptions(e,t={}){const n=[];e.forEach(e=>{this.seenParticles.has(e._particle)||n.push(this.patternToSuggestion(e.pattern,e))});const r=this._joinDescriptions(n);if(r)return t.skipFormatting?r:this._capitalizeAndPunctuate(r)}_joinDescriptions(e){const t=e.filter(e=>e),n=t.length;if(n>0){const e=["",""," and ",", and "][Math.min(3,n)],r=t.pop();return`${t.join(", ")}${e}${r}`}}_joinTokens(e){return e.join("")}_capitalizeAndPunctuate(e){d()(e);const t=e.length-1;return`${e[0].toUpperCase()}${e.slice(1,t)}${e[t]}${e[t].match(/[a-z0-9()' >\]]/i)?".":""}`}patternToSuggestion(e,t){const n=this._initTokens(e,t).map(e=>this.tokenToString(e));if(0===n.filter(e=>null==e).length)return this._joinTokens(n)}_initTokens(e,t){e=e.replace(/</g,"&lt;");let n=[];for(;e.length>0;){const r=e.match(Un.tokensRegex);let i,s;r?(i=r[0],s=e.indexOf(i)):(i="",s=e.length),d()(s>=0);const o=e.substring(0,s);o.length>0&&n.push({text:o}),i.length>0&&(n=n.concat(this._initSubTokens(i,t))),e=e.substring(s+i.length)}return n}_initSubTokens(e,t){const n=e.match(Un.tokensInnerRegex),r=n[1].split("."),i=3===n.length?n[2]:void 0;if(!t._particle){const e=r.shift();if(e[0]!==e[0].toUpperCase())return console.warn(`Invalid particle name '${e}' - must start with a capital letter.`),[];const n=this.particleDescriptions.filter(n=>n._particle.name===e&&t._recipe.particles.find(e=>e===n._particle));if(0===n.length)return console.warn(`Cannot find particles with name ${e}.`),[];t=n[n.length-1]}const s=t._particle;if(0===r.length)return[{particleName:s.spec.name,particleDescription:t}];const o=s.connections[r[0]];if(o)return d()(o.handle,"Missing handle???"),[{fullName:n[0],handleName:o.name,storeId:o.handle.id,properties:r.splice(1),extra:i,_handleConn:o,value:t._connections[o.name].value}];if(2!==r.length)return 1===r.length?console.warn(`Unknown handle connection name '${r[0]}'`):console.warn(`Slot connections tokens must have exactly 2 names, found ${r.length} in '${r.join(".")}'`),[];const a=s.getSlotConnectionByName(r[0]).providedSlots[r[1]];return d()(a,`Could not find handle ${r.join(".")}`),[{fullName:n[0],consumeSlotName:r[0],provideSlotName:r[1],extra:i,_providedSlotConn:a}]}tokenToString(e){if(e.text)return e.text;if(e.particleName)return this._particleTokenToString(e);if(e.handleName)return this._handleTokenToString(e);if(e.consumeSlotName&&e.provideSlotName)return this._slotTokenToString(e);throw new Error("no handle or slot name")}_particleTokenToString(e){return this._combineSelectedDescriptions([e.particleDescription],{skipFormatting:!0})}_handleTokenToString(e){switch(e.extra){case"_type_":return e._handleConn.type.toPrettyString().toLowerCase();case"_values_":return this._formatStoreValue(e.handleName,e.value);case"_name_":return this._formatDescription(e._handleConn);default:{if(d()(!e.extra,`Unrecognized extra ${e.extra}`),e._handleConn.type instanceof at){if(!e.value)return;return d()(e.value.interfaceValue,`Missing interface type value for '${e._handleConn.type}'.`),At.fromLiteral(e.value.interfaceValue).pattern}if(e.properties&&e.properties.length>0)return this._propertyTokenToString(e.handleName,e.value,e.properties);let t=this._formatDescriptionPattern(e._handleConn)||this._formatStoreDescription(e._handleConn);const n=this._formatStoreValue(e.handleName,e.value);if(!t){const t=e._handleConn.type;if(n&&!this.excludeValues&&!(t instanceof it)&&!(t instanceof st))return n}return t=t||this._formatHandleType(e._handleConn),!n||this.excludeValues||this.seenHandles.has(e.storeId)?t:(this.seenHandles.add(e.storeId),this._combineDescriptionAndValue(e,t,n))}}}_combineDescriptionAndValue(e,t,n){return t===n?t:`${t} (${n})`}_slotTokenToString(e){switch(e.extra){case"_empty_":return 0===e._providedSlotConn.consumeConnections.length;default:d()(!e.extra,`Unrecognized slot extra ${e.extra}`)}const t=e._providedSlotConn.consumeConnections.map(e=>{const t=e.particle,n=this.particleDescriptions.find(e=>e._particle===t);return this.seenParticles.add(t),this.patternToSuggestion(t.spec.pattern,n)});return this._joinDescriptions(t)}_propertyTokenToString(e,t,n){if(!t)return"";d()(t.entityValue,`Cannot return property ${n.join(",")} for non EntityType.`);t.entityValue;if(t.entityValue){let r=t.entityValue;for(const e of n)r&&(r=r[e]);if(r)return this._formatEntityProperty(e,n,r)}}_formatEntityProperty(e,t,n){return n}_formatStoreValue(e,t){if(t){if(t.collectionValues)return this._formatCollection(e,t.collectionValues);if(t.bigCollectionValues)return this._formatBigCollection(e,t.bigCollectionValues);if(t.entityValue)return this._formatSingleton(e,t);throw new Error(`invalid store type for handle ${e}`)}}_formatCollection(e,t){return t[0].rawData.name?t.length>2?`${t[0].rawData.name} plus ${t.length-1} other items`:t.map(e=>e.rawData.name).join(", "):`${t.length} items`}_formatBigCollection(e,t){return`collection of items like ${t.rawData.name}`}_formatSingleton(e,t){const n=t.entityValue;if(t.valueDescription){let e,r=t.valueDescription;for(;e=r.match(/\${([a-zA-Z0-9.]+)}/);)r=r.replace(e[0],n[e[1]]);return r}if(n.name)return n.name}_formatDescription(e){return this._formatDescriptionPattern(e)||this._formatStoreDescription(e)||this._formatHandleType(e)}_formatDescriptionPattern(e){let t=e;if(!t.spec.isOutput){const n=this._selectHandleConnection(e.handle);n&&(t=n)}const n=this.particleDescriptions.find(e=>e._particle===t.particle),r=n?n._connections[t.name]:null;if(r&&r.pattern)return this.patternToSuggestion(r.pattern,n)}_formatStoreDescription(e){if(e.handle){if(!e.handle.id)return;const t=this.storeDescById[e.handle.id],n=this._formatHandleType(e);if(t&&t!==n)return t}}_formatHandleType(e){return(e.handle&&e.handle.type.isResolved()?e.handle.type:e.type).toPrettyString().toLowerCase()}_selectHandleConnection(e){const t=e.connections.filter(e=>{const t=e.spec,n=this.particleDescriptions.find(t=>t._particle===e.particle);return!!t.pattern||!!n&&!!n._connections[e.name].pattern});if(t.sort((e,t)=>{const n=e.spec.isOutput;if(n!==t.spec.isOutput)return n?-1:1;const r=this.particleDescriptions.find(t=>t._particle===e.particle);return this.particleDescriptions.find(e=>e._particle===t.particle)._rank-r._rank}),t.length>0)return t[0]}static sort(e,t){const n=[...e._particle.spec.slotConnections.values()].some(e=>Tt(e));if(n!==[...t._particle.spec.slotConnections.values()].some(e=>Tt(e)))return n?-1:1;if(e._rank!==t._rank)return t._rank-e._rank;let r=0,i=0;return e._particle.spec.slotConnections.forEach(e=>{e.isSet||++r}),t._particle.spec.slotConnections.forEach(e=>{e.isSet||++i}),i-r}}Un.tokensRegex=/\${[a-zA-Z0-9.]+}(?:\.[_a-zA-Z]+)?/g,Un.tokensInnerRegex=/\${([a-zA-Z0-9.]+)}(?:\.([_a-zA-Z]+))?/;
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class qn{constructor(e,t,n,r,i,s,o,a,c,l,h=!1,u){this.type=e,this.id=t,this.name=n,this.storageKey=r,this.storageProviderFactory=i,this.originalId=s,this.claims=o,this.description=a,this.version=c,this.source=l,this.referenceMode=h,this.model=u}async inflate(e){const t=e||this.storageProviderFactory,n=this.isBackedByManifest()?await t.construct(this.id,this.type,this.storageKey):await t.connect(this.id,this.type,this.storageKey);return d()(null!=n,"inflating missing storageKey "+this.storageKey),this.isBackedByManifest()?n.referenceMode=this.referenceMode:this.referenceMode=n.referenceMode,n.originalId=this.originalId,n.name=this.name,n.source=this.source,n.description=this.description,this.isBackedByManifest()&&await n.fromLiteral({version:this.version,model:this.model}),n}toLiteral(){}isBackedByManifest(){return void 0!==this.version&&!!this.model}toString(e){const t=[],n=[];return n.push("store"),this.name&&n.push(`${this.name}`),n.push(`of ${this.type.toString()}`),this.id&&n.push(`'${this.id}'`),this.originalId&&n.push(`!!${this.originalId}`),void 0!==this.version&&n.push(`@${this.version}`),e&&e.length&&n.push(`${e.join(" ")}`),this.source?n.push(`in '${this.source}'`):this.storageKey&&n.push(`at '${this.storageKey}'`),t.push(n.join(" ")),this.claims.length>0&&t.push(`  claim is ${this.claims.map(e=>e.tag).join(" and is ")}`),this.description&&t.push(`  description \`${this.description}\``),t.join("\n")}_compareTo(e){let t;return 0!==(t=mn(this.name,e.name))?t:0!==(t=mn(this.id,e.id))?t:0}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Kn{constructor(e={},t,n=[]){this.storeDescById=e,this.arcRecipes=t,this.particleDescriptions=n}static async XcreateForPlan(e){const t=await Kn.initDescriptionHandles(e.particles);return new Kn({},[{patterns:e.patterns,particles:e.particles}],t)}static async createForPlan(e,t){const n=t.particles,r=await Kn.initDescriptionHandles(n,e),i={};for(const{id:n}of t.handles){const t=e.findStoreById(n);t&&t instanceof Ln&&(i[n]=e.getStoreDescription(t))}return new Kn(i,[{patterns:t.patterns,particles:t.particles}],r)}static async create(e,t){const n=[].concat(...e.allDescendingArcs.map(e=>e.activeRecipe.particles)),r=await Kn.initDescriptionHandles(n,e,t),i={};for(const{id:t}of e.activeRecipe.handles){const n=e.findStoreById(t);n&&n instanceof Ln&&(i[t]=e.getStoreDescription(n))}return new Kn(i,e.recipeDeltas,r)}getArcDescription(e=Un){const t=[].concat(...this.arcRecipes.map(e=>e.patterns)),n=[].concat(...this.arcRecipes.map(e=>e.particles)),r=new e(this.particleDescriptions,this.storeDescById).getDescription({patterns:t,particles:n});if(r)return r}getRecipeSuggestion(e=Un){return new e(this.particleDescriptions,this.storeDescById).getDescription(this.arcRecipes[this.arcRecipes.length-1])}getHandleDescription(e){d()(e.connections.length>0,"handle has no connections?");const t=new Un(this.particleDescriptions,this.storeDescById);return t.excludeValues=!0,t.getHandleDescription(e)}static getAllTokens(e){const t=[],n=e.match(Un.tokensRegex);for(let e=0;e<n.length;++e)t[e]=n[e].match(Un.tokensInnerRegex)[1].split(".");return t}static async initDescriptionHandles(e,t,n){return await Promise.all(e.map(e=>Kn._createParticleDescription(e,t,n)))}static async _createParticleDescription(e,t,n){let r={_particle:e,_connections:{}};n&&(r._rank=n.calcParticleRelevance(e));const i=await Kn._getPatternByNameFromDescriptionHandle(e,t);(r={...r,...i}).pattern=r.pattern||e.spec.pattern;for(const n of Object.values(e.connections)){const s=e.spec.handleConnectionMap.get(n.name),o=i[n.name]||s.pattern,a=t?t.findStoreById(n.handle.id):null;r._connections[n.name]={pattern:o,_handleConn:n,value:await Kn._prepareStoreValue(a)}}return r}static async _getPatternByNameFromDescriptionHandle(e,t){const n=e.connections.descriptions;if(n&&n.handle&&n.handle.id){const e=t.findStoreById(n.handle.id);if(e){const t={};for(const n of await e.toList())t[n.rawData.key]=n.rawData.value;return t}}return{}}static async _prepareStoreValue(e){if(e&&!(e instanceof qn))if(e.type instanceof it){const t=e,n=await t.toList();if(n&&n.length>0)return{collectionValues:n}}else if(e.type instanceof st){const t=e,n=await t.stream(1),{value:r,done:i}=await t.cursorNext(n);if(t.cursorClose(n),!i&&r[0].rawData.name)return{bigCollectionValues:r[0]}}else if(e.type instanceof nt){const t=e,n=await t.get();if(n&&n.rawData)return{entityValue:n.rawData,valueDescription:e.type.entitySchema.description.value}}else if(e.type instanceof at){const t=e,n=await t.get();if(n)return{interfaceValue:n}}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Wn{constructor(e,t,n){this._channel=e,this._id=t,this._other=n,this._onmessage=void 0}async postMessage(e){await this._channel._post(this._other,e)}set onmessage(e){this._onmessage=e}close(){this.postMessage=(async()=>{})}}class Vn{constructor(e){this.data=e}}class Zn{constructor(){this.port1=new Wn(this,0,1),this.port2=new Wn(this,1,0),this._ports=[this.port1,this.port2]}async _post(e,t){if(t=JSON.parse(JSON.stringify(t)),this._ports[e]._onmessage)try{await 0,await this._ports[e]._onmessage(new Vn(t))}catch(e){console.error("Exception in particle code\n",e)}}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
var Jn,Gn=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Yn=function(e,t){return function(n,r){t(n,r,e)}};!function(e){e[e.Mapped=0]="Mapped",e[e.LocalMapped=1]="LocalMapped",e[e.RemoteMapped=2]="RemoteMapped",e[e.Direct=3]="Direct",e[e.ObjectMap=4]="ObjectMap",e[e.List=5]="List",e[e.ByLiteral=6]="ByLiteral"}(Jn||(Jn={}));const Qn=new Map;function Xn(e,t){let n=Qn.get(e);null==n&&(n=new Map,Qn.set(e,n));let r=n.get(t);return null==r&&(r=[],n.set(t,r)),r}function er(e,t,n){const r=Qn.get(e);if(r){const e=r.get(t);if(e){const t=e[n];if(t)return t}}throw new Error(`the target ${e}, propertyKey ${t} and parameterIndex ${n} provided did not exist`)}function tr(e,t,n,r){Xn(e,t)[n]=r}function nr(e,t,n){tr(e.constructor,t,n,{type:Jn.Direct})}function rr(e,t,n){tr(e.constructor,t,n,{type:Jn.Mapped})}function ir(e){return(t,n,r)=>{const i={type:Jn.ByLiteral,converter:e};tr(t.constructor,n,r,i)}}function sr(e,t){return(n,r,i)=>{const s={type:Jn.ObjectMap,key:{type:e},value:{type:t}};tr(n.constructor,r,i,s)}}function or(e){return(t,n,r)=>{const i={type:Jn.List,value:{type:e}};tr(t.constructor,n,r,i)}}function ar(e,t,n){tr(e.constructor,t,n,{type:Jn.LocalMapped})}function cr(e,t,n){tr(e.constructor,t,n,{type:Jn.RemoteMapped})}function lr(e,t){Xn(e.constructor,t)}function hr(e,t,n){tr(e.constructor,t,n,{type:Jn.Direct,initializer:!0})}function ur(e,t,n){er(e.constructor,t,n).identifier=!0}function dr(e,t,n){er(e.constructor,t,n).ignore=!0}class pr{constructor(e){this._prefix=e,this._nextIdentifier=0,this._idMap=new Map,this._reverseIdMap=new Map}_newIdentifier(){return this._prefix+this._nextIdentifier++}createMappingForThing(e,t){let n;return d()(!this._reverseIdMap.has(e)),n=t||(e.apiChannelMappingId?e.apiChannelMappingId:this._newIdentifier()),d()(!this._idMap.has(n),`${t?"requestedId":e.apiChannelMappingId?"apiChannelMappingId":"newIdentifier()"} ${n} already in use`),this.establishThingMapping(n,e),n}recreateMappingForThing(e){const t=[];return e.forEach(e=>{d()(this._reverseIdMap.has(e));const n=this._reverseIdMap.get(e);this.establishThingMapping(n,e),t.push(n)}),t}maybeCreateMappingForThing(e){return this.hasMappingForThing(e)?this.identifierForThing(e):this.createMappingForThing(e)}async establishThingMapping(e,t){let n;if(Array.isArray(e)||(Array.isArray(t)&&([t,n]=t),this._idMap.set(e,t)),t instanceof Promise)d()(null==n),await this.establishThingMapping(e,await t);else if(Array.isArray(e)){d()(e.length===t.length);for(let n=0;n<e.length;n++)await this.establishThingMapping(e[n],t[n])}else this._reverseIdMap.set(t,e),n&&await n()}hasMappingForThing(e){return this._reverseIdMap.has(e)}identifierForThing(e){return d()(this._reverseIdMap.has(e),`Missing thing [${e}]`),this._reverseIdMap.get(e)}thingForIdentifier(e){return d()(this._idMap.has(e),`Missing id: ${e}`),this._idMap.get(e)}}class fr{constructor(e,t){this._port=e,this._mapper=new pr(t),this._port.onmessage=(async e=>this._processMessage(e)),this.inspector=null,this.attachStack=!1,this.messageCount=0,this._testingHook()}_testingHook(){}close(){this._port.close()}async _processMessage(e){d()(void 0!==this["before"+e.data.messageType]);const t=this.messageCount++;this.inspector&&this.inspector.pecMessage("on"+e.data.messageType,e.data.messageBody,t,e.data.stack),this["before"+e.data.messageType](e.data.messageBody)}async send(e,t){const n={messageType:e,messageBody:t,stack:this.attachStack?(new Error).stack:void 0},r=this.messageCount++;this.inspector&&this.inspector.pecMessage(e,t,r,(new Error).stack||""),await this._port.postMessage(n)}supportsJavaParticle(){return"MessagePort"===Object.getPrototypeOf(this._port.constructor).name}}function mr(e){return e.toString().match(/.*?\(([^)]*)\)/)[1].split(",").map(e=>e.replace(/\/\*.*\*\//,"").trim()).filter(e=>e)}function gr(e,t,n){if(void 0!==e)switch(e.type){case Jn.Mapped:return n.identifierForThing(t);case Jn.LocalMapped:return n.maybeCreateMappingForThing(t);case Jn.RemoteMapped:case Jn.Direct:return t;case Jn.ObjectMap:{const r={};return t.forEach((t,i)=>r[gr(e.key,i,n)]=gr(e.value,t,n)),r}case Jn.List:return t.map(t=>gr(e.value,t,n));case Jn.ByLiteral:return t.toLiteral();default:throw new Error(`Can't yet send MappingType ${e.type}`)}}function yr(e,t,n){if(void 0!==e)switch(e.type){case Jn.Mapped:return n.thingForIdentifier(t);case Jn.LocalMapped:return t;case Jn.RemoteMapped:return n.thingForIdentifier(t);case Jn.Direct:return t;case Jn.ObjectMap:{const r=new Map;for(const i of Object.keys(t))r.set(yr(e.key,i,n),yr(e.value,t[i],n));return r}case Jn.List:return t.map(t=>yr(e.value,t,n));case Jn.ByLiteral:if(!e.converter)throw new Error(`Expected ${e.type} to have a converter but it doesn't`);return e.converter.fromLiteral(t);default:throw new Error(`Can't yet recieve MappingType ${e.type}`)}}class _r extends fr{constructor(e,t){super(e,"o"),this.inspector=t.inspector,this.inspector&&this.inspector.onceActive.then(()=>this.DevToolsConnected(),e=>console.error(e))}Stop(){}DefineHandle(e,t,n){}InstantiateParticle(e,t,n,r){}ReinstantiateParticle(e,t,n){}ReloadParticles(e,t){}UIEvent(e,t,n){}SimpleCallback(e,t){}AwaitIdle(e){}StartRender(e,t,n,r){}StopRender(e,t){}GetBackingStoreCallback(e,t,n,r,i,s){}ConstructArcCallback(e,t){}CreateHandleCallback(e,t,n,r,i){}MapHandleCallback(e,t,n){}CreateSlotCallback(e,t,n){}InnerArcRender(e,t,n,r){}DevToolsConnected(){}}Gn([lr],_r.prototype,"Stop",null),Gn([Yn(0,function(e,t,n){tr(e.constructor,t,n,{type:Jn.Direct,initializer:!0,redundant:!0})}),Yn(1,ir(tt)),Yn(2,nr)],_r.prototype,"DefineHandle",null),Gn([Yn(0,hr),Yn(1,ur),Yn(1,nr),Yn(2,ir(At)),Yn(3,sr(Jn.Direct,Jn.Mapped))],_r.prototype,"InstantiateParticle",null),Gn([Yn(0,ur),Yn(0,nr),Yn(1,ir(At)),Yn(2,sr(Jn.Direct,Jn.Mapped))],_r.prototype,"ReinstantiateParticle",null),Gn([Yn(0,function(e,t,n){tr(e.constructor,t,n,{type:Jn.Direct,initializer:!0,overriding:!0})}),Yn(1,or(Jn.Direct))],_r.prototype,"ReloadParticles",null),Gn([Yn(0,rr),Yn(1,nr),Yn(2,nr)],_r.prototype,"UIEvent",null),Gn([Yn(0,cr),Yn(1,nr)],_r.prototype,"SimpleCallback",null),Gn([Yn(0,nr)],_r.prototype,"AwaitIdle",null),Gn([Yn(0,rr),Yn(1,nr),Yn(2,sr(Jn.Direct,Jn.Direct)),Yn(3,or(Jn.Direct))],_r.prototype,"StartRender",null),Gn([Yn(0,rr),Yn(1,nr)],_r.prototype,"StopRender",null),Gn([Yn(0,hr),Yn(1,cr),Yn(2,ir(tt)),Yn(3,nr),Yn(4,ur),Yn(4,nr),Yn(5,nr)],_r.prototype,"GetBackingStoreCallback",null),Gn([Yn(0,cr),Yn(1,ar)],_r.prototype,"ConstructArcCallback",null),Gn([Yn(0,hr),Yn(1,cr),Yn(2,ir(tt)),Yn(3,nr),Yn(4,ur),Yn(4,nr)],_r.prototype,"CreateHandleCallback",null),Gn([Yn(0,dr),Yn(0,hr),Yn(1,cr),Yn(2,nr)],_r.prototype,"MapHandleCallback",null),Gn([Yn(0,dr),Yn(0,hr),Yn(1,cr),Yn(2,nr)],_r.prototype,"CreateSlotCallback",null),Gn([Yn(0,rr),Yn(1,nr),Yn(2,nr),Yn(3,nr)],_r.prototype,"InnerArcRender",null),Gn([lr],_r.prototype,"DevToolsConnected",null);let vr=class extends fr{constructor(e){super(e,"i")}Render(e,t,n){}Output(e,t){}InitializeProxy(e,t){}SynchronizeProxy(e,t){}HandleGet(e,t){}HandleToList(e,t){}HandleSet(e,t,n,r){}HandleClear(e,t,n){}HandleStore(e,t,n,r){}HandleRemove(e,t,n,r){}HandleRemoveMultiple(e,t,n,r){}HandleStream(e,t,n,r){}StreamCursorNext(e,t,n){}StreamCursorClose(e,t){}Idle(e,t){}GetBackingStore(e,t,n){}ConstructInnerArc(e,t){}ArcCreateHandle(e,t,n,r){}ArcMapHandle(e,t,n){}ServiceRequest(e,t,n){}ArcCreateSlot(e,t,n,r,i){}ArcLoadRecipe(e,t,n){}ReportExceptionInHost(e){}onDevToolsConnected(){this.attachStack=!0}};var wr,br,Sr,Cr,kr,xr,Tr;Gn([Yn(0,rr),Yn(1,nr),Yn(2,nr)],vr.prototype,"Render",null),Gn([Yn(0,rr),Yn(1,nr)],vr.prototype,"Output",null),Gn([Yn(0,rr),Yn(1,ar)],vr.prototype,"InitializeProxy",null),Gn([Yn(0,rr),Yn(1,ar)],vr.prototype,"SynchronizeProxy",null),Gn([Yn(0,rr),Yn(1,ar)],vr.prototype,"HandleGet",null),Gn([Yn(0,rr),Yn(1,ar)],vr.prototype,"HandleToList",null),Gn([Yn(0,rr),Yn(1,nr),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleSet",null),Gn([Yn(0,rr),Yn(1,nr),Yn(2,nr)],vr.prototype,"HandleClear",null),Gn([Yn(0,rr),Yn(1,ar),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleStore",null),Gn([Yn(0,rr),Yn(1,ar),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleRemove",null),Gn([Yn(0,rr),Yn(1,ar),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleRemoveMultiple",null),Gn([Yn(0,rr),Yn(1,ar),Yn(2,nr),Yn(3,nr)],vr.prototype,"HandleStream",null),Gn([Yn(0,rr),Yn(1,ar),Yn(2,nr)],vr.prototype,"StreamCursorNext",null),Gn([Yn(0,rr),Yn(1,nr)],vr.prototype,"StreamCursorClose",null),Gn([Yn(0,nr),Yn(1,sr(Jn.Mapped,Jn.Direct))],vr.prototype,"Idle",null),Gn([Yn(0,ar),Yn(1,nr),Yn(2,ir(tt))],vr.prototype,"GetBackingStore",null),Gn([Yn(0,ar),Yn(1,rr)],vr.prototype,"ConstructInnerArc",null),Gn([Yn(0,ar),Yn(1,cr),Yn(2,ir(tt)),Yn(3,nr)],vr.prototype,"ArcCreateHandle",null),Gn([Yn(0,ar),Yn(1,cr),Yn(2,rr)],vr.prototype,"ArcMapHandle",null),Gn([Yn(0,rr),Yn(1,nr),Yn(2,ar)],vr.prototype,"ServiceRequest",null),Gn([Yn(0,ar),Yn(1,cr),Yn(2,rr),Yn(3,nr),Yn(4,nr)],vr.prototype,"ArcCreateSlot",null),Gn([Yn(0,cr),Yn(1,nr),Yn(2,ar)],vr.prototype,"ArcLoadRecipe",null),Gn([Yn(0,ir(ce))],vr.prototype,"ReportExceptionInHost",null),vr=Gn([(wr=_r,e=>{const t=(e,t)=>{const n=Qn.get(e)||new Map;for(const r of n.keys()){const i=mr(e.prototype[r]),s=n.get(r)||[],o=s.findIndex(e=>e.initializer||!1),a=s.findIndex(e=>e.identifier||!1),c=async function(...e){const t={};for(let n=0;n<s.length;n++)n!==o&&(t[i[n]]=gr(s[n],e[n],this._mapper));-1!==o&&(s[o].redundant?(d()(-1===a),t.identifier=this._mapper.maybeCreateMappingForThing(e[o])):s[o].overriding?t.identifier=this._mapper.recreateMappingForThing(e[o]):t.identifier=this._mapper.createMappingForThing(e[o],e[a])),await this.send(r,t)},l=async function(e){const t=[],n=[];for(let r=0;r<s.length;r++){if(r===o&&(-1!==a||s[r].ignore))continue;const c=r===o?"identifier":i[r],l=yr(s[r],e[c],this._mapper);l instanceof Promise?(n.push({promise:l,position:t.length}),t.push(()=>yr(s[r],e[c],this._mapper))):t.push(l)}n.length>0&&(await Promise.all(n.map(async e=>e.promise)),n.forEach(e=>{t[e.position]=t[e.position]()}));const c=this["on"+r](...t);o>-1&&(d()(e.identifier),await this._mapper.establishThingMapping(e.identifier,c))};Object.defineProperty(e.prototype,r,{get:()=>c}),Object.defineProperty(t.prototype,"before"+r,{get:()=>l})}};t(e,wr),t(wr,e)})],vr);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Er{constructor(e,t,n,r){this.handlers=new Map,this.requestedContentTypes=new Set,this._isRendered=!1,this.apiPort=e,this.slotName=n,this.particle=t,this.providedSlots=r}get isRendered(){return this._isRendered}render(e){this.apiPort.Render(this.particle,this.slotName,e),Object.keys(e).forEach(e=>{this.requestedContentTypes.delete(e)}),this._isRendered=0===this.requestedContentTypes.size&&Object.keys(e).length>0}registerEventHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}clearEventHandlers(e){this.handlers.set(e,[])}fireEvent(e){for(const t of this.handlers.get(e.handler)||[])t(e)}rewire(e){this.particle.removeSlotProxy(this.slotName),this.particle=e,this._isRendered=!1,this.particle.addSlotProxy(this),this.particle.renderSlot(this.slotName,["model","template","templateName"])}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ir{constructor(e){const t=e.entityClass.schema;d()(t.names.length>0,"At least one schema name is required for entity packaging");let n=null;e.type instanceof lt?n=e.type:e.type.getContainedType()instanceof lt&&(n=e.type.getContainedType()),this.encoder=new Ar(t),this.decoder=new $r(t,n,e.storage.pec)}encodeSingleton(e){return this.encoder.encodeSingleton(e)}encodeCollection(e){return this.encoder.encodeCollection(e)}decodeSingleton(e){return this.decoder.decodeSingleton(e)}}function Rr(e){return e.length+":"+e}class Ar{constructor(e){this.schema=e}encodeSingleton(e){if(e instanceof Oe){const{id:t,storageKey:n}=e.dataClone();return Rr(t)+"|"+Rr(n)+"|"}{let t=Rr(De.id(e))+"|";for(const[n,r]of Object.entries(e))t+=this.encodeField(this.schema.fields[n],n,r);return t}}encodeCollection(e){let t=e.length+":";for(const n of e)t+=Rr(this.encodeSingleton(n));return t}static encodeDictionary(e){const t=Object.entries(e);let n=t.length+":";for(const[e,r]of t)n+=Rr(e)+Rr(r);return n}encodeField(e,t,n){switch(e.kind){case"schema-primitive":return t+":"+e.type.substr(0,1)+this.encodeValue(e.type,n)+"|";case"schema-collection":case"schema-union":case"schema-tuple":case"schema-reference":throw new Error(`'${e.kind}' not yet supported for entity packaging`);default:throw new Error(`Unknown field kind '${e.kind}' in schema`)}}encodeValue(e,t){switch(e){case"Text":case"URL":return Rr(t);case"Number":return t+":";case"Boolean":return t?"1":"0";case"Bytes":case"Object":throw new Error(`'${e}' not yet supported for entity packaging`);default:throw new Error(`Unknown primitive value type '${e}' in schema`)}}}class $r{constructor(e=null,t=null,n=null){this.schema=e,this.referenceType=t,this.pec=n}decodeSingleton(e){this.str=e;const t=Number(this.upTo(":")),n=this.chomp(t);if(this.validate("|"),this.referenceType){const e=Number(this.upTo(":")),t=this.chomp(e);return this.validate("|"),new Oe({id:n,storageKey:t},this.referenceType,this.pec)}{const e={};for(;this.str.length>0;){const t=this.upTo(":"),n=this.chomp(1);e[t]=this.decodeValue(n),this.validate("|")}const t=new(this.schema.entityClass())(e);return""!==n&&De.identify(t,n),t}}decodeDictionary(e){this.str=e;const t={};let n=Number(this.upTo(":"));for(;n--;){const e=Number(this.upTo(":")),n=this.chomp(e),r=Number(this.upTo(":"));t[n]=this.chomp(r)}return t}upTo(e){const t=this.str.indexOf(e);if(t<0)throw new Error(`Packaged entity decoding fail: expected '${e}' separator in '${this.str}'`);const n=this.str.slice(0,t);return this.str=this.str.slice(t+1),n}chomp(e){if(e>this.str.length)throw new Error(`Packaged entity decoding fail: expected '${e}' chars to remain in '${this.str}'`);const t=this.str.slice(0,e);return this.str=this.str.slice(e),t}validate(e){if(this.chomp(e.length)!==e)throw new Error(`Packaged entity decoding fail: expected '${e}' at start of '${this.str}'`)}decodeValue(e){switch(e){case"T":case"U":{const e=Number(this.upTo(":"));return this.chomp(e)}case"N":return Number(this.upTo(":"));case"B":return Boolean("1"===this.chomp(1));default:throw new Error(`Packaged entity decoding fail: unknown or unsupported primitive value type '${e}'`)}}}class Pr{constructor(e){this.logInfo=null;const t=new Uint8Array(e),n=[];let r=0;for(;r<t.byteLength;){let e=0,i=0;for(;;){const n=t[r++];if(e|=(127&n)<<i,!(128&n))break;i+=7}n.push(e)}if(n.length<4)throw new Error("emscripten metadata section should have at least 4 values; "+`got ${n.length}`);if(0!==n[0]||2!==n[1])throw new Error("emscripten metadata version should be 0.2; "+`got ${n[0]}.${n[1]}`);if(0!==n[2]||4!==n[3])throw new Error("emscripten ABI version should be 0.4; "+`got ${n[2]}.${n[3]}`);if(11!==n.length)throw new Error("emscripten metadata section should have 11 values; "+`got ${n.length}`);this.cfg={memSize:n[5],tableSize:n[6],globalBase:n[7],dynamicBase:n[8],dynamictopPtr:n[9]}}configureEnvironment(e,t,n){t.memory=new WebAssembly.Memory({initial:this.cfg.memSize,maximum:this.cfg.memSize}),t.heapU8=new Uint8Array(t.memory.buffer),t.heap32=new Int32Array(t.memory.buffer),t.heap32[this.cfg.dynamictopPtr>>2]=this.cfg.dynamicBase,Object.assign(n,{memory:t.memory,__memory_base:this.cfg.globalBase,table:new WebAssembly.Table({initial:this.cfg.tableSize,maximum:this.cfg.tableSize,element:"anyfunc"}),__table_base:0,DYNAMICTOP_PTR:this.cfg.dynamictopPtr,_emscripten_get_heap_size:()=>t.heapU8.length,_emscripten_resize_heap:e=>!1,_emscripten_memcpy_big:(e,n,r)=>t.heapU8.set(t.heapU8.subarray(n,n+r),e),_systemError:e=>{throw new Error(t.read(e))},abortOnCannotGrowMemory:e=>{throw new Error(`abortOnCannotGrowMemory(${e})`)},_setLogInfo:(e,n)=>this.logInfo=[t.read(e),n],___syscall146:(e,n)=>this.sysWritev(t,e,n)})}initializeInstance(e,t){}sysWritev(e,t,n){const r=()=>(n+=4,e.heap32[n-4>>2]),i=1===r()?console.log:console.error,s=r(),o=r();let a=this.logInfo?`[${this.logInfo[0]}:${this.logInfo[1]}] `:"",c=0;for(let t=0;t<o;t++){const n=e.heap32[s+8*t>>2],r=e.heap32[s+(8*t+4)>>2];for(let t=0;t<r;t++){const r=e.heapU8[n+t];0===r||10===r?(i(a),a=""):a+=String.fromCharCode(r)}c+=r}return this.logInfo=null,c}}class Mr{configureEnvironment(e,t,n){Object.assign(n,{Konan_js_arg_size:e=>1,Konan_js_fetch_arg:(e,t)=>"dummyArg",Konan_js_allocateArena:e=>{},Konan_js_freeArena:e=>{},write:e=>console.log(t.read(e)),flush:()=>{},Konan_notify_memory_grow:()=>this.updateMemoryViews(t),Konan_abort:e=>{throw new Error("Konan_abort("+t.read(e)+")")},Konan_exit:e=>{},Konan_date_now:e=>{const n=Date.now(),r=Math.floor(n/4294967295),i=Math.floor(n%4294967295);t.heap32[e]=i,t.heap32[e+1]=r}})}initializeInstance(e,t){this.updateMemoryViews(e),t.exports.Konan_js_main(1,0)}updateMemoryViews(e){e.memory=e.exports.memory,e.heapU8=new Uint8Array(e.memory.buffer),e.heap32=new Int32Array(e.memory.buffer)}}class Or{constructor(e,t){this.particleMap=new Map,this.loader=e,this.apiPort=t}async initialize(e){const t=await WebAssembly.compile(e),n=this.driverForModule(t),r={abort:()=>{throw new Error("Abort!")},_singletonSet:(e,t,n)=>this.getParticle(e).singletonSet(t,n),_singletonClear:(e,t)=>this.getParticle(e).singletonClear(t),_collectionStore:(e,t,n)=>this.getParticle(e).collectionStore(t,n),_collectionRemove:(e,t,n)=>this.getParticle(e).collectionRemove(t,n),_collectionClear:(e,t)=>this.getParticle(e).collectionClear(t),_onRenderOutput:(e,t,n)=>this.getParticle(e).onRenderOutput(t,n),_dereference:(e,t,n,r)=>this.getParticle(e).dereference(t,n,r),_render:(e,t,n,r)=>this.getParticle(e).renderImpl(t,n,r),_serviceRequest:(e,t,n,r)=>this.getParticle(e).serviceRequest(t,n,r),_resolveUrl:e=>this.resolve(e)};n.configureEnvironment(t,this,r);const i={NaN:NaN,Infinity:1/0};this.wasm=await WebAssembly.instantiate(t,{env:r,global:i}),this.exports=this.wasm.exports,n.initializeInstance(this,this.wasm)}driverForModule(e){const t=WebAssembly.Module.customSections(e,"emscripten_metadata");return 1===t.length?new Pr(t[0]):new Mr}getParticle(e){return this.particleMap.get(e)}register(e,t){this.particleMap.set(t,e)}resolve(e){return this.store(this.loader.resolve(this.read(e)))}store(e){const t=this.exports._malloc(e.length+1);for(let n=0;n<e.length;n++)this.heapU8[t+n]=e.charCodeAt(n);return this.heapU8[t+e.length]=0,t}free(...e){e.forEach(e=>e&&this.exports._free(e))}read(e){let t="";for(;e<this.heapU8.length&&0!==this.heapU8[e];)t+=String.fromCharCode(this.heapU8[e++]);return t}}class Nr extends Xt{constructor(e,t){super(),this.handleMap=new Map,this.revHandleMap=new Map,this.converters=new Map,this.id=e,this.container=t,this.exports=t.exports;const n=`_new${this.spec.name}`;if(!(n in this.exports))throw new Error(`wasm module does not export instantiator function '${n}' for particle '${this.spec.name}'`);this.innerParticle=this.exports[n](),this.container.register(this,this.innerParticle),setTimeout(()=>this.renderOutput(),100)}renderOutput(){this.exports._renderOutput&&this.exports._renderOutput(this.innerParticle)}async setHandles(e){for(const[t,n]of e){const e=this.container.store(t),r=this.exports._connectHandle(this.innerParticle,e,n.canRead,n.canWrite);if(this.container.free(e),0===r)throw new Error(`Wasm particle failed to connect handle '${t}'`);this.handleMap.set(n,r),this.revHandleMap.set(r,n),this.converters.set(n,new Ir(n))}this.exports._init(this.innerParticle)}async onHandleSync(e,t){const n=this.handleMap.get(e);if(!t)return void this.exports._syncHandle(this.innerParticle,n,0);const r=this.converters.get(e);if(!r)throw new Error("cannot find handle "+e.name);let i;i=e instanceof Jt?r.encodeSingleton(t):r.encodeCollection(t);const s=this.container.store(i);this.exports._syncHandle(this.innerParticle,n,s),this.container.free(s)}async onHandleUpdate(e,t){if(t.originator)return;const n=this.handleMap.get(e),r=this.converters.get(e);if(!r)throw new Error("cannot find handle "+e.name);let i=0,s=0;e instanceof Jt?t.data&&(i=this.container.store(r.encodeSingleton(t.data))):(i=this.container.store(r.encodeCollection(t.added||[])),s=this.container.store(r.encodeCollection(t.removed||[]))),this.exports._updateHandle(this.innerParticle,n,i,s),this.container.free(i,s)}async onHandleDesync(e){}singletonSet(e,t){const n=this.getHandle(e),r=this.decodeEntity(n,t),i=this.ensureIdentified(r,n);return n.set(r),i}singletonClear(e){this.getHandle(e).clear()}collectionStore(e,t){const n=this.getHandle(e),r=this.decodeEntity(n,t),i=this.ensureIdentified(r,n);return n.store(r),i}collectionRemove(e,t){const n=this.getHandle(e);n.remove(this.decodeEntity(n,t))}collectionClear(e){this.getHandle(e).clear()}async dereference(e,t,n){const r=this.getHandle(e),i=this.converters.get(r);if(!i)throw new Error("cannot find handle "+r.name);const s=this.container.read(t);let o;if(r instanceof Jt)o=await r.get();else{if(!(r instanceof Zt))throw new Error(`wasm particle '${this.spec.name}' dereferenced an unsupported handle type ${r._id}`);o=await r.get(s)}let a=0;if(o){const e=await o.dereference();a=this.container.store(i.encodeSingleton(e))}this.exports._dereferenceResponse(this.innerParticle,n,a),this.container.free(a)}getHandle(e){const t=this.revHandleMap.get(e);if(!t){const e=new Error(`wasm particle '${this.spec.name}' attempted to write to unconnected handle`),t=new he(e,"WasmParticle::getHandle",this.id,this.spec.name);throw this.container.apiPort.ReportExceptionInHost(t),e}return t}decodeEntity(e,t){return this.converters.get(e).decodeSingleton(this.container.read(t))}ensureIdentified(e,t){let n=0;return e instanceof De&&!De.isIdentified(e)&&(t.createIdentityFor(e),n=this.container.store(De.id(e))),n}output(e){this.container.apiPort.Output(this,e)}onRenderOutput(e,t){const n={templateName:"default"};n.template=this.container.read(e),n.model=(new $r).decodeDictionary(this.container.read(t)),this.output(n)}renderSlot(e,t){const n=this.container.store(e),r=t.includes("template"),i=t.includes("model");this.exports._renderSlot(this.innerParticle,n,r,i),this.container.free(n)}renderHostedSlot(e,t,n){throw new Error("renderHostedSlot not implemented for wasm particles")}renderImpl(e,t,n){const r=this.slotProxiesByName.get(this.container.read(e));if(r){const e={templateName:"default"};t&&(e.template=this.container.read(t),r.requestedContentTypes.add("template")),n&&(e.model=(new $r).decodeDictionary(this.container.read(n)),r.requestedContentTypes.add("model")),r.render(e)}}async serviceRequest(e,t,n){const r=this.container.read(e),i=(new $r).decodeDictionary(this.container.read(t)),s=this.container.read(n),o=await this.service({call:r,...i}),a={};if("object"==typeof o)for(const e of Object.entries(o)){const[t,n]=e;a[t]="object"==typeof n?JSON.stringify(n):n+""}else a.value=o+"";const c=this.container.store(r),l=this.container.store(Ar.encodeDictionary(a)),h=this.container.store(s);this.exports._serviceResponse(this.innerParticle,c,l,h),this.container.free(c,l,h)}fireEvent(e,t){const n=this.container.store(e),r=this.container.store(t.handler);this.exports._fireEvent(this.innerParticle,n,r),this.container.free(n,r)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Br{constructor(e,t,n,r){this.particles=new Map,this.pendingLoads=[],this.scheduler=new Kt,this.keyedProxies={},this.wasmContainers={};const i=this;this.apiPort=new class extends vr{onDefineHandle(e,t,n){return zt.newProxy(e,t,this,i,i.scheduler,n)}onGetBackingStoreCallback(e,t,n,r,s){const o=zt.newProxy(r,t,this,i,i.scheduler,n);return o.storageKey=s,[o,()=>e(o,s)]}onCreateHandleCallback(e,t,n,r){const s=zt.newProxy(r,t,this,i,i.scheduler,n);return[s,()=>e(s)]}onMapHandleCallback(e,t){return[t,()=>e(t)]}onCreateSlotCallback(e,t){return[t,()=>e(t)]}onInnerArcRender(e,t,n,r){e.renderHostedSlot(t,n,r)}onStop(){global.close&&global.close()}async onInstantiateParticle(e,t,n){return i.instantiateParticle(e,t,n)}async onReinstantiateParticle(e,t,n){d()(!1,"Not implemented")}async onReloadParticles(e){return i.reloadParticles(e)}onSimpleCallback(e,t){e(t)}onConstructArcCallback(e,t){e(t)}onAwaitIdle(e){i.idle.then(t=>{setTimeout(()=>this.Idle(e,i.relevance),0)})}onUIEvent(e,t,n){e.fireEvent(t,n)}onStartRender(e,t,n,r){e.addSlotProxy(new Er(this,e,t,n)),e.renderSlot(t,r)}onStopRender(e,t){d()(e.hasSlotProxy(t),`Stop render called for particle ${e.spec.name} slot ${t} without start render being called.`),e.removeSlotProxy(t)}}(e),this.pecId=t,this.idGenerator=n,this.loader=r,r.setParticleExecutionContext(this)}generateID(){return this.idGenerator.newChildId(this.pecId).toString()}innerArcHandle(e,t){const n=this;return{createHandle:async(r,i,s)=>new Promise((o,a)=>n.apiPort.ArcCreateHandle(e=>{const r=Qt(e,n.idGenerator,i,t);o(r),s&&e.register(s,r)},e,r,i)),mapHandle:async t=>new Promise((r,i)=>n.apiPort.ArcMapHandle(e=>{r(e)},e,t)),createSlot:async(t,r,i)=>new Promise((s,o)=>n.apiPort.ArcCreateSlot(e=>s(e),e,t,r,i)),loadRecipe:async t=>new Promise((r,i)=>n.apiPort.ArcLoadRecipe(e,t,e=>{e.error?i(e.error):r(e)}))}}getStorageProxy(e,t){return this.keyedProxies[e]||(this.keyedProxies[e]=new Promise((n,r)=>{this.apiPort.GetBackingStore((e,t)=>{this.keyedProxies[t]=e,n(e)},e,t)})),this.keyedProxies[e]}capabilities(e){const t={serviceRequest:(e,t,n)=>{this.apiPort.ServiceRequest(e,t,n)},output:(e,t)=>{this.apiPort.Output(e,t)}};return e&&(t.constructInnerArc=(async e=>new Promise((t,n)=>this.apiPort.ConstructInnerArc(e=>t(this.innerArcHandle(e,void 0)),e)))),t}async instantiateParticle(e,t,n){let r;const i=new Promise(e=>r=e);this.pendingLoads.push(i);const s=await this.createParticleFromSpec(e,t),o=new Map,a=[];return n.forEach((n,r)=>{this.createHandle(s,t,e,r,n,o,a)}),[s,async()=>{await this.assignHandle(s,t,e,o,a,i),r()}]}async reloadParticles(e){e.forEach(e=>{const t=this.particles.get(e);t.spec.implBlobUrl&&delete t.spec.implBlobUrl,t.spec.implFile.endsWith(".wasm")&&this.wasmContainers[t.spec.implFile]&&(this.wasmContainers[t.spec.implFile]=void 0)});const t=[];for(const n of e){let e;const r=new Promise(t=>e=t);this.pendingLoads.push(r);const i=this.particles.get(n),s=await this.createParticleFromSpec(n,i.spec),o=new Map,a=[];i.handles.forEach(e=>{this.createHandle(s,i.spec,n,e.name,e.storage,o,a),e.disable(i)}),t.push([s,async()=>{await this.assignHandle(s,i.spec,n,o,a,r),e();for(const e of i.getSlotNames())i.getSlot(e).rewire(s)}])}return t}createHandle(e,t,n,r,i,s,o){const a=t.handleConnectionMap.get(r),c=Qt(i,this.idGenerator,r,n,a.isInput,a.isOutput);s.set(r,c),o.push({proxy:i,particle:e,handle:c})}async assignHandle(e,t,n,r,i,s){await e.callSetHandles(r,e=>{const r=new he(e,"setHandles",n,t.name);this.apiPort.ReportExceptionInHost(r)}),i.forEach(({proxy:e,particle:t,handle:n})=>{e instanceof zt&&e.register(t,n)});const o=this.pendingLoads.indexOf(s);this.pendingLoads.splice(o,1)}async createParticleFromSpec(e,t){let n;if(t.implFile&&t.implFile.endsWith(".wasm"))(n=await this.loadWasmParticle(e,t)).setCapabilities(this.capabilities(!1));else{const r=await this.loader.loadParticleClass(t);if(!r)return Promise.reject(new Error(`Unknown error loading particle ${e} ${t.name}`));(n=new r).setCapabilities(this.capabilities(!0))}return this.particles.set(e,n),n}async loadWasmParticle(e,t){d()(t.name.length>0);let n=this.wasmContainers[t.implFile];if(!n){const e=await this.loader.loadWasmBinary(t);if(!e||0===e.byteLength)throw new Error(`Failed to load wasm binary '${t.implFile}'`);n=new Or(this.loader,this.apiPort),await n.initialize(e),this.wasmContainers[t.implFile]=n}Nr.spec=t;const r=new Nr(e,n);return Nr.spec=null,r}get relevance(){const e=new Map;return this.particles.forEach(t=>{0!==t.relevances.length&&(e.set(t,t.relevances),t.relevances.length=0)}),e}get busy(){return!!(this.pendingLoads.length>0||this.scheduler.busy)||[...this.particles.values()].filter(e=>e.busy).length>0}get idle(){if(!this.busy)return Promise.resolve();const e=[...this.particles.values()].filter(async e=>e.busy).map(async e=>e.idle);return Promise.all([this.scheduler.idle,...this.pendingLoads,...e]).then(()=>this.idle)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Dr(e){return(t,n)=>{const r=new Zn;new Br(r.port1,t,n,e.clone());return r.port2}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.Permuted="permuted",e.Independent="independent"}(br||(br={}));class jr{constructor(e,t){this._arc=e,this._args=t}get arc(){return this._arc}getResults({generated:e}){return e}async generateFrom(e){return this.generate({generated:e,population:[],terminal:[],generation:0})}}class Fr{constructor(e){this.descendants=[],d()(e),this.tactic=e}onAction(e){this.currentAction=e}onResult(e){this.currentResult=e,this.updateList=[]}onResultDone(){this.runUpdateList(this.currentResult.result,this.updateList),this.currentResult=void 0,this.updateList=void 0}onActionDone(){this.currentAction=void 0}static walk(e,t,n){return t.onAction(n),e.forEach(e=>{t.onResult(e),t.onResultDone()}),t.onActionDone(),t.descendants}visit(e,...t){const n=e(this.currentResult.result,...t);this.isEmptyResult(n)||this.updateList.push({continuation:n,context:t})}runUpdateList(e,t){const n=[];if(t.length)switch(this.tactic){case br.Permuted:{let r=[[]];t.forEach(({continuation:e,context:t})=>{const n=[];"function"==typeof e&&(e=[e]),e.forEach(e=>{r.forEach(r=>{const i=r.slice();i.push({continuation:e,context:t}),n.push(i)})}),r=n});for(const t of r){const r=new Map,i=e.clone(r);let s=0;const o=t.filter(e=>null!==e.continuation);0!==o.length&&(o.forEach(({continuation:e,context:t})=>{s=e(i,...t.map(e=>r.get(e)||e))}),n.push({result:i,score:s}))}break}case br.Independent:t.forEach(({continuation:t,context:r})=>{"function"==typeof t&&(t=[t]),t.forEach(t=>{const i=new Map,s=e.clone(i);let o=0;o=null==t?0:t(s,...r.map(e=>i.get(e)||e)),n.push({result:s,score:o})})});break;default:throw new Error(`${this.tactic} not supported`)}for(const e of n)this.createDescendant(e.result,e.score)}createWalkerDescendant(e,t,n,r){d()(this.currentResult,"no current result"),d()(this.currentAction,"no current action"),this.currentResult.score&&(t+=this.currentResult.score),this.descendants.push({result:e,score:t,derivation:[{parent:this.currentResult,strategy:this.currentAction}],hash:n,valid:r})}isEmptyResult(e){return!e||(e.constructor===Array&&e.length<=0||(d()("function"==typeof e||e.length),!1))}}Fr.Permuted=br.Permuted,Fr.Independent=br.Independent;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class zr extends Fr{onResult(e){super.onResult(e);const t=e.result;if(this.onRecipe&&this.visit(this.onRecipe.bind(this)),this.onParticle)for(const e of t.particles)this.visit(this.onParticle.bind(this),e);if(this.onPotentialHandleConnection)for(const e of t.particles)if(e.spec)for(const t of e.spec.handleConnectionMap.values())e.connections[t.name]||this.visit(this.onPotentialHandleConnection.bind(this),e,t);if(this.onHandleConnection)for(const e of t.handleConnections)this.visit(this.onHandleConnection.bind(this),e);if(this.onHandle)for(const e of t.handles)this.visit(this.onHandle.bind(this),e);if(this.onPotentialSlotConnection)for(const e of t.particles)for(const[t,n]of e.getSlotSpecs())e.getSlotConnectionByName(t)||this.visit(this.onPotentialSlotConnection.bind(this),e,n);if(this.onSlotConnection)for(const e of t.slotConnections)this.visit(this.onSlotConnection.bind(this),e);if(this.onSlot)for(const e of t.slots)this.visit(this.onSlot.bind(this),e);if(this.onObligation)for(const e of t.obligations)this.visit(this.onObligation.bind(this),e);if(this.onRequiredParticle)for(const e of t.requires)for(const t of e.particles)this.visit(this.onRequiredParticle.bind(this),t)}createDescendant(e,t){const n=e.normalize(),r=n?e.digest():null;super.createWalkerDescendant(e,t,r,n)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Hr{static getClonedSlot(e,t){let n=e.updateToClone({selectedSlot:t}).selectedSlot;return n||(t.id&&(n=e.findSlotByID(t.id)),void 0===n?((n=e instanceof On?e.parent.newSlot(t.name):e.newSlot(t.name)).id=t.id,n):n)}static connectSlotConnection(e,t){const n=e.recipe;if(!e.targetSlot){const r=Hr.getClonedSlot(n,t);e.connectToSlot(r)}if(!e.targetSlot)throw new Error("missing targetSlot");d()(!t.id||!e.targetSlot.id||t.id===e.targetSlot.id,`Cannot override slot id '${e.targetSlot.id}' with '${t.id}'`),e.targetSlot.id=t.id||e.targetSlot.id,e.targetSlot.tags=[...t.tags]}static findAllSlotCandidates(e,t,n){const r=e.getSlandleConnectionByName(t.name);return{local:r&&r.targetSlot?[]:Hr._findSlotCandidates(e,t,e.recipe.slots),remote:Hr._findSlotCandidates(e,t,n.pec.slotComposer.getAvailableContexts())}}static _findSlotCandidates(e,t,n){const r=n.filter(n=>this.slotMatches(e,t,n));return r.sort((e,t)=>e.name<t.name),r}static slotMatches(e,t,n){if(!Hr.specMatch(t,n.spec))return!1;const r=e.getSlandleConnectionBySpec(t);return!!Hr.tagsOrNameMatch(t,n.spec,r,n)&&!!Hr.handlesMatch(e,n)}static specMatch(e,t){return e&&t&&e.isSet===t.isSet}static handlesMatch(e,t){return 0===t.handles.length||!!Object.values(e.connections).find(e=>t.handles.includes(e.handle)||e.handle&&e.handle.id&&t.handles.map(e=>e.id).includes(e.handle.id))}static tagsOrNameMatch(e,t,n,r){const i=[].concat(e.tags||[],n?n.tags:[],n&&n.targetSlot?n.targetSlot.tags:[]),s=[].concat(t.tags||[],r?r.tags:[],r?r.name:t.name?t.name:[]);return!!(i.length>0&&i.some(e=>s.includes(e)))||e.name===(r?r.name:t.name)}static replaceOldSlot(e,t,n){if(t&&(!t.id||t.id!==n.id)){if(void 0!==t.sourceConnection){if(void 0===n.sourceConnection)return!1;const e=Hr.getClonedSlot(t.sourceConnection.recipe,n);t.sourceConnection.providedSlots[t.name]=e}for(;t.consumeConnections.length>0;){const e=t.consumeConnections[0];e.disconnectFromSlot(),Hr.connectSlotConnection(e,n)}}return!0}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Lr extends zr{constructor(e,t,n){super(e),this.arc=t,this.options=n}onHandle(e,t){const n=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]);if("`slot"===t.fate)return[];if(t.type.slandleType())return[];const r=this.arc;if(0===t.connections.length||t.id&&t.storageKey||!t.type||!t.fate)return n("No connections to handle or missing handle information");let i;if(t.id){if(!t.storageKey){let e;switch(t.fate){case"use":e=r.findStoreById(t.id);break;case"map":case"copy":e=r.context.findStoreById(t.id);break;case"create":case"?":break;default:throw new Error(`unexpected fate ${t.fate}`)}if(!e)return n("cannot find associated store");i=[e]}}else{Rn.directionCounts(t);switch(t.fate){case"use":i=r.findStoresByType(t.type,{tags:t.tags});break;case"map":case"copy":i=r.context.findStoresByType(t.type,{tags:t.tags,subtype:!0});break;case"create":case"?":i=[];break;default:throw new Error(`unexpected fate ${t.fate}`)}}return 0===i.length?n("Cannot find a handle matching requested type and tags."):0===(i=i.filter(n=>{for(const r of e.handles)if(n.id===r.id&&r!==t)return!1;return!0})).length?n("The only handles matching the requested type and tags are already present in this recipe"):i.map(e=>(t,n)=>(n.mapToStorage(e),0))}onSlotConnection(e,t){const n=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]),r=this.arc;if(t.isConnected())return n("Slot connection is already connected");const i=t.getSlotSpec(),s=t.particle,{local:o,remote:a}=Hr.findAllSlotCandidates(s,i,r),c=[...o,...a];if(1!==c.length)return n("There are multiple matching slots (match is ambiguous)");const l=c[0];return(e,t)=>(Hr.connectSlotConnection(t,l),1)}onPotentialSlotConnection(e,t,n){const r=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]),i=this.arc,{local:s,remote:o}=Hr.findAllSlotCandidates(t,n,i),a=[...s,...o];if(1!==a.length)return r("There are multiple matching slots for this slot spec (match is ambiguous)");const c=a[0];return(e,t,n)=>{const r=t.addSlotConnection(n.name);return Hr.connectSlotConnection(r,c),1}}onObligation(e,t){const n=t.from.instance,r=t.to.instance;for(const e of Object.values(n.connections))for(const t of Object.values(r.connections))if(e.handle&&e.handle===t.handle)return(e,t)=>(e.removeObligation(t),1);return[]}}class Ur extends jr{withOptions(e){this.options=e}async generate(e){return Lr.walk(this.getResults(e),new Lr(Lr.Permuted,this.arc,this.options),this)}}class qr{constructor(e){this.resolver=new Ur(e)}async resolve(e,t){if(!(e=e.clone()).normalize(t))return console.warn(`could not normalize a recipe: ${[...t.errors.values()].join("\n")}.\n${e.toString()}`),null;this.resolver.withOptions(t);const n=await this.resolver.generateFrom([{result:e,score:1}]);return 0===n.length?(t&&t.errors&&t.errors.set(e,"Resolver generated 0 recipes"),null):n[0].result}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Kr{static register(e,t){Kr.registry[e]=t}static async request(e){let{service:t,invoke:n,call:r}=e;r&&([t,n]=r.split("."));const i=Kr.registry[t];return i&&i[n]?await i[n](e):null}}Kr.registry={},Object.freeze(Kr),Kr.register("test",{classify:async e=>({data:"it's a pig, that don't fly straight"})});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Wr{constructor(e,t,n){this._portByParticle=new Map,this.nextIdentifier=0,this.idleVersion=0,this.particles=[],this.close=(()=>{n.forEach(e=>e.close()),this._apiPorts.forEach(e=>e.close())}),this.arc=t,this.slotComposer=e;this._apiPorts=n.map(e=>new Vr(e,t))}choosePortForParticle(e){d()(!this._portByParticle.has(e),`port already found for particle '${e.spec.name}'`);const t=this._apiPorts.find(t=>e.isJavaParticle()===t.supportsJavaParticle());return d()(!!t,`No port found for '${e.spec.name}'`),this._portByParticle.set(e,t),this.getPort(e)}getPort(e){return d()(this._portByParticle.has(e),`Cannot get port for particle '${e.spec.name}'`),this._portByParticle.get(e)}stop(){this._apiPorts.forEach(e=>e.Stop())}get idle(){return null==this.idlePromise&&(this.idlePromise=new Promise((e,t)=>{this.idleResolve=e})),this.idleVersion=this.nextIdentifier,this._apiPorts.forEach(e=>e.AwaitIdle(this.nextIdentifier++)),this.idlePromise}get messageCount(){return[...this._apiPorts.values()].map(e=>e.messageCount).reduce((e,t)=>e+t,0)}sendEvent(e,t,n){this.getPort(e).UIEvent(e,t,n)}instantiate(e,t){this.particles.push(e);const n=this.choosePortForParticle(e);t.forEach((e,t)=>{n.DefineHandle(e,e.type.resolvedType(),t)}),n.InstantiateParticle(e,e.id.toString(),e.spec,t)}reinstantiate(e,t){d()(this.particles.find(t=>t===e),`Cannot reinstantiate nonexistent particle ${e.name}`);const n=this.getPort(e);t.forEach((e,t)=>{n.DefineHandle(e,e.type.resolvedType(),t)}),n.ReinstantiateParticle(e.id.toString(),e.spec,t)}reload(e){const t=new Map;e.forEach(e=>{const n=this.getPort(e);let r=t.get(n);r?r.push(e):(r=[e],t.set(n,r))}),t.forEach((e,t)=>{t.ReloadParticles(e,e.map(e=>e.id.toString()))})}startRender({particle:e,slotName:t,providedSlots:n,contentTypes:r}){this.getPort(e).StartRender(e,t,n,r)}stopRender({particle:e,slotName:t}){this.getPort(e).StopRender(e,t)}innerArcRender(e,t,n,r){this.getPort(e).InnerArcRender(e,t,n,r)}resolveIfIdle(e,t){e===this.idleVersion&&(this.idlePromise=void 0,this.idleResolve(t))}}class Vr extends _r{constructor(e,t){super(e,t),this.arc=t}onRender(e,t,n){this.arc.pec.slotComposer&&this.arc.pec.slotComposer.renderSlot(e,t,n)}onInitializeProxy(e,t){e.on("change",e=>this.SimpleCallback(t,e),{})}async onSynchronizeProxy(e,t){const n=await e.modelForSynchronization();this.SimpleCallback(t,n)}async onHandleGet(e,t){const n=await e.get();this.SimpleCallback(t,n)}async onHandleToList(e,t){const n=await e.toList();this.SimpleCallback(t,n)}onHandleSet(e,t,n,r){e.set(t,n,r)}onHandleClear(e,t,n){e.clear(t,n)}async onHandleStore(e,t,n,r){await e.store(n.value,n.keys,r),this.SimpleCallback(t,{})}async onHandleRemove(e,t,n,r){await e.remove(n.id,n.keys,r),this.SimpleCallback(t,{})}async onHandleRemoveMultiple(e,t,n,r){await e.removeMultiple(n,r),this.SimpleCallback(t,{})}async onHandleStream(e,t,n,r){this.SimpleCallback(t,await e.stream(n,r))}async onStreamCursorNext(e,t,n){this.SimpleCallback(t,await e.cursorNext(n))}onStreamCursorClose(e,t){e.cursorClose(t)}onIdle(e,t){this.arc.pec.resolveIfIdle(e,t)}async onGetBackingStore(e,t,n){t||(t=this.arc.storageProviderFactory.baseStorageKey(n,this.arc.storageKey||"volatile"));const r=await this.arc.storageProviderFactory.baseStorageFor(n,t);this.GetBackingStoreCallback(r,e,n.collectionOf(),n.toString(),`${r.id}:${"String(Math.random())".slice(2,9)}`,t)}onConstructInnerArc(e,t){const n=this.arc.createInnerArc(t);this.ConstructArcCallback(e,n)}async onArcCreateHandle(e,t,n,r){const i=await t.createStore(n,r,null,[],"volatile");this.CreateHandleCallback(i,e,n,r,i.id)}onArcMapHandle(e,t,n){d()(this.arc.findStoreById(n.id),`Cannot map nonexistent handle ${n.id}`),this.MapHandleCallback({},e,n.id)}onArcCreateSlot(e,t,n,r,i){let s;this.arc.pec.slotComposer&&(s=this.arc.pec.slotComposer.createHostedSlot(t,n,r,i)),this.CreateSlotCallback({},e,s)}async onArcLoadRecipe(e,t,n){const r=await as.parse(t,{loader:e.loader,fileName:""}),i={providedSlotIds:{}};let s=void 0,o=r.recipes[0];if(o){for(const t of o.slots)if(t.id=t.id||e.generateID("slot").toString(),t.sourceConnection){const e=t.sourceConnection.particle.localName;e&&(i.providedSlotIds[`${e}.${t.name}`]=t.id)}const t=[];for(const e of o.handles){const n=this.arc.findStoreById(e.id)||r.findStoreById(e.id);n?e.mapToStorage(n):t.push(e)}if(t.length>0){let n=o;for(const t of[new qr(e),new qr(this.arc)])n=await t.resolve(n)||n;n===o?s=`Recipe couldn't load due to missing handles [recipe=${o}, missingHandles=${t.join("\n")}].`:o=n}if(!s){const n={errors:new Map};if(t.length>0||o.normalize(n))if(o.isResolved()){for(const e of r.stores)e instanceof qn?this.arc._registerStore(await e.inflate(),[]):this.arc._registerStore(e,[]);e.instantiate(o)}else s=`Recipe is not resolvable:\n${o.toString({showUnresolved:!0})}`;else s=`Recipe ${o} could not be normalized:\n${[...n.errors.values()].join("\n")}`}}else s="No recipe defined";this.SimpleCallback(n,s?{error:s}:i)}onOutput(e,t){const n=this.arc.pec.slotComposer;n&&n.delegateOutput&&n.delegateOutput(this.arc,e,t)}onReportExceptionInHost(e){e.particleName||(e.particleName=this.arc.loadedParticleInfo.get(e.particleId).spec.name),function(e){for(const t of ue)t(e)}(e)}async onServiceRequest(e,t,n){const r=await Kr.request(t);this.SimpleCallback(n,r)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Zr{constructor(){this.next=Promise.resolve(),this.depth=0}get locked(){return 0!==this.depth}async acquire(){let e;const t=this.next.then(()=>(this.depth++,()=>{e(),this.depth--}));return this.next=new Promise(t=>{e=t}),t}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.ShouldExist=0]="ShouldExist",e[e.ShouldCreate=1]="ShouldCreate",e[e.MayExist=2]="MayExist"}(Sr||(Sr={}));class Jr{constructor(e,t){this.storageKey=e,this.exists=t}}class Gr{static clearRegistrationsForTesting(){this.providers=new Set}static async driverInstance(e,t){for(const n of this.providers)if(n.willSupport(e))return n.driver(e,t);return null}static register(e){this.providers.add(e)}static unregister(e){this.providers.delete(e)}static willSupport(e){for(const t of this.providers)if(t.willSupport(e))return!0;return!1}}Gr.providers=new Set;
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Yr{constructor(e){this.protocol=e}childKeyForArcInfo(){return this.childWithComponent("arc-info")}childKeyForHandle(e){return this.childWithComponent(`handle/${e}`)}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Qr{constructor(){this.entries=new Map}}class Xr extends Jr{constructor(e,t,n){super(e,t),this.pendingVersion=0,this.pendingModel=null;const r=e.toString();switch(this.memory=n,t){case Sr.ShouldCreate:if(this.memory.entries.has(r))throw new Error(`requested creation of memory location ${e} can't proceed as location already exists`);this.data={data:null,version:0,drivers:[]},this.memory.entries.set(r,this.data);break;case Sr.ShouldExist:if(!this.memory.entries.has(r))throw new Error(`requested connection to memory location ${e} can't proceed as location doesn't exist`);case Sr.MayExist:{const e=this.memory.entries.get(r);e?(this.data=e,this.pendingModel=e.data,this.pendingVersion=e.version):(this.data={data:null,version:0,drivers:[]},this.memory.entries.set(r,this.data));break}default:throw new Error(`unknown Exists code ${t}`)}this.data.drivers.push(this)}registerReceiver(e){this.receiver=e,this.pendingModel&&(e(this.pendingModel,this.pendingVersion),this.pendingModel=null)}async send(e,t){return await 0,this.data.version===t-1&&(this.data.data=e,this.data.version+=1,this.data.drivers.forEach(t=>{t!==this&&t.receiver(e,this.data.version)}),!0)}async write(e,t){throw new Error("Method not implemented.")}async read(e){throw new Error("Method not implemented.")}}class ei{constructor(e){this.arc=e}willSupport(e){return"volatile"===e.protocol&&e.arcId.equal(this.arc.id)}async driver(e,t){if(!this.willSupport(e))throw new Error(`This provider does not support storageKey ${e.toString()}`);return new Xr(e,t,this.arc.volatileMemory)}static register(e){Gr.register(new ei(e))}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Direct=0]="Direct",e[e.Backing=1]="Backing",e[e.ReferenceMode=2]="ReferenceMode"}(Cr||(Cr={})),function(e){e[e.SyncRequest=0]="SyncRequest",e[e.ModelUpdate=1]="ModelUpdate",e[e.Operations=2]="Operations"}(kr||(kr={}));class ti{constructor(e,t,n,r){this.storageKey=e,this.exists=t,this.type=n,this.mode=r}async idle(){return Promise.resolve()}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.Idle="Idle",e.AwaitingResponse="AwaitingResponse",e.AwaitingResponseDirty="AwaitingResponseDirty",e.AwaitingDriverModel="AwaitingDriverModel"}(xr||(xr={}));class ni extends ti{constructor(e,t,n,r){super(e,t,n,r),this.callbacks=new Map,this.nextCallbackID=1,this.version=0,this.pendingException=null,this.pendingResolves=[],this.pendingRejects=[],this.pendingDriverModels=[],this.state=xr.Idle}async idle(){return this.pendingException?Promise.reject(this.pendingException):this.state===xr.Idle?Promise.resolve():new Promise((e,t)=>{this.pendingResolves.push(e),this.pendingRejects.push(t)})}setState(e){this.state=e,e===xr.Idle&&this.notifyIdle()}notifyIdle(){this.pendingException?this.pendingRejects.forEach(e=>e(this.pendingException)):(this.pendingResolves.forEach(e=>e()),this.pendingResolves=[])}static async construct(e,t,n,r){const i=new ni(e,t,n,r);if(i.localModel=new(n.crdtInstanceConstructor()),i.driver=await Gr.driverInstance(e,t),null==i.driver)throw new Ue(`No driver exists to support storage key ${e}`);return i.driver.registerReceiver(i.onReceive.bind(i)),i}async onReceive(e,t){this.pendingDriverModels.push({model:e,version:t}),this.state!==xr.AwaitingResponse&&this.state!==xr.AwaitingResponseDirty&&this.applyPendingDriverModels()}deliverCallbacks(e,t,n){e.changeType===Ee.Operations&&e.operations.length>0?this.callbacks.forEach((r,i)=>{(t||n!==i)&&r({type:kr.Operations,operations:e.operations,id:i})}):e.changeType===Ee.Model&&this.callbacks.forEach((r,i)=>{(t||n!==i)&&r({type:kr.ModelUpdate,model:e.modelPostChange,id:i})})}async processModelChange(e,t,n,r){this.deliverCallbacks(e,!1,r),await this.updateStateAndAct(this.noDriverSideChanges(e,t,!1),n,!1)}async updateStateAndAct(e,t,n){if(e)return this.setState(xr.Idle),void(this.version=t);switch(this.state){case xr.AwaitingDriverModel:if(!n)return;case xr.Idle:for(;;){if(this.setState(xr.AwaitingResponse),this.state=xr.AwaitingResponse,this.version=++t,!await this.driver.send(this.localModel.getData(),t)){this.setState(xr.AwaitingDriverModel),this.applyPendingDriverModels();break}if(this.state===xr.AwaitingResponse){this.setState(xr.Idle),this.applyPendingDriverModels();break}if(this.state!==xr.AwaitingResponseDirty)throw new Error("reached impossible state in store state machine")}return;case xr.AwaitingResponse:return void this.setState(xr.AwaitingResponseDirty);case xr.AwaitingResponseDirty:return;default:throw new Error("reached impossible default state in switch statement")}}applyPendingDriverModels(){if(this.pendingDriverModels.length>0){const e=this.pendingDriverModels;this.pendingDriverModels=[];let t=!0,n=0;for(const{model:r,version:i}of e)try{const{modelChange:e,otherChange:s}=this.localModel.merge(r);this.deliverCallbacks(e,!0,0),t=t&&this.noDriverSideChanges(e,s,!0),n=i}catch(e){return this.pendingException=e,void this.notifyIdle()}this.updateStateAndAct(t,n,!0)}}noDriverSideChanges(e,t,n){return n?t.changeType===Ee.Operations&&0===t.operations.length:e.changeType===Ee.Operations&&0===e.operations.length}async onProxyMessage(e){if(this.pendingException)throw this.pendingException;switch(e.type){case kr.SyncRequest:return await this.callbacks.get(e.id)({type:kr.ModelUpdate,model:this.localModel.getData(),id:e.id}),!0;case kr.Operations:{for(const t of e.operations)if(!this.localModel.applyOperation(t))return await this.callbacks.get(e.id)({type:kr.SyncRequest,id:e.id}),!1;const t={changeType:Ee.Operations,operations:e.operations};return this.processModelChange(t,null,this.version,e.id),!0}case kr.ModelUpdate:{const{modelChange:t,otherChange:n}=this.localModel.merge(e.model);return this.processModelChange(t,n,this.version,e.id),!0}default:throw new Ue("Invalid operation provided to onProxyMessage")}}on(e){const t=this.nextCallbackID++;return this.callbacks.set(t,e),t}off(e){this.callbacks.delete(e)}reportExceptionInHost(e){this.pendingException=e,this.notifyIdle()}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ri{constructor(e,t,n,r){this.storageKey=e,this.exists=t,this.type=n,this.mode=r,this.stores={},this.callbacks=new Map,this.nextCallbackId=1}on(e){return this.callbacks.set(this.nextCallbackId,e),this.nextCallbackId++}off(e){this.callbacks.delete(e)}getLocalModel(e){const t=this.stores[e];return null==t?(this.stores[e]={type:"pending",promise:this.setupStore(e)},null):"pending"===t.type?null:t.store.localModel}async setupStore(e){const t=await ni.construct(this.storageKey.childWithComponent(e),this.exists,this.type,this.mode),n=t.on(t=>this.processStoreCallback(e,t)),r={store:t,id:n,type:"record"};return this.stores[e]=r,r}async onProxyMessage(e,t){let n=this.stores[t];null==n&&(n=await this.setupStore(t)),"pending"===n.type&&(n=await n.promise);const{store:r,id:i}=n;return e.id=i,r.onProxyMessage(e)}static async construct(e,t,n,r){return new ri(e,t,n,r)}async idle(){const e=[];for(const t of Object.values(this.stores))"record"===t.type&&e.push(t.store);await Promise.all(e.map(e=>e.idle()))}async processStoreCallback(e,t){return Promise.all([...this.callbacks.values()].map(n=>n(t,e))).then(e=>e.reduce((e,t)=>e&&t))}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Container=0]="Container",e[e.BackingStore=1]="BackingStore",e[e.StorageProxy=2]="StorageProxy"}(Tr||(Tr={}));class ii extends Yr{constructor(e,t){super("reference-mode"),this.backingKey=e,this.storageKey=t}embedKey(e){return e.toString().replace(/\{/g,"{{").replace(/\}/g,"}}")}toString(){return`${this.protocol}://{${this.embedKey(this.backingKey)}}{${this.embedKey(this.storageKey)}}`}childWithComponent(e){return new ii(this.backingKey,this.storageKey.childWithComponent(e))}}class si extends ti{constructor(){super(...arguments),this.callbacks=new Map,this.nextCallbackID=1,this.crdtKey=Math.random()*Math.pow(2,64)+"",this.versions={},this.receiveQueue=[],this.pendingSends=[],this.holdQueue=new ai,this.blockCounter=0}static async construct(e,t,n){const r=new si(e,t,n,Cr.ReferenceMode);let i;return r.backingStore=await ri.construct(e.backingKey,t,n.getContainedType(),Cr.Backing),i=n.isCollectionType()?new it(new lt(n.getContainedType())):new lt(n.getContainedType()),r.containerStore=await ni.construct(e.storageKey,t,n,Cr.Direct),r.registerStoreCallbacks(),r}reportExceptionInHost(e){}on(e){const t=this.nextCallbackID++;return this.callbacks.set(t,e),t}off(e){this.callbacks.delete(e)}registerStoreCallbacks(){this.backingStore.on(this.onBackingStore.bind(this)),this.containerStore.on(this.onContainerStore.bind(this))}async onContainerStore(e){return this.enqueue({from:Tr.Container,message:e})}async onBackingStore(e,t){return this.enqueue({from:Tr.BackingStore,message:e,muxId:t})}async onProxyMessage(e){return this.enqueue({from:Tr.StorageProxy,message:e})}async enqueue(e){return new Promise((t,n)=>{const r=0===this.receiveQueue.length;this.receiveQueue.push({...e,promise:t}),r&&this.processQueue()})}async processQueue(){for(;this.receiveQueue.length>0;){const e=this.receiveQueue[0];switch(e.from){case Tr.StorageProxy:e.promise(await this.handleProxyMessage(e.message));break;case Tr.BackingStore:e.promise(await this.handleBackingStore(e.message,e.muxId));break;case Tr.Container:e.promise(await this.handleContainerStore(e.message));break;default:throw new Error("invalid message type")}this.receiveQueue.shift()}}async handleContainerStore(e){switch(e.type){case kr.Operations:for(const t of e.operations){const e=this.operationElement(t);let n;if(e){const r=this.backingStore.getLocalModel(e.id);if(!r){this.enqueueBlockingSend([e],()=>{const n=this.backingStore.getLocalModel(e.id),r=this.updateOp(t,()=>this.entityFromModel(n.getData(),e.id));this.send({type:kr.Operations,operations:[r]})});break}n=(()=>this.entityFromModel(r.getData(),e.id))}else n=(()=>null);this.enqueueSend(()=>{const e=this.updateOp(t,n);this.send({type:kr.Operations,operations:[e]})})}break;case kr.ModelUpdate:{const t=e.model,{pendingIds:n,model:r}=this.constructPendingIdsAndModel(t),i=()=>void this.send({type:kr.ModelUpdate,model:r()});0===n.length?this.enqueueSend(i):this.enqueueBlockingSend(n,i);break}case kr.SyncRequest:this.enqueueSend(()=>{this.send({type:kr.SyncRequest})});break;default:throw new Error("Unexpected ProxyMessageType")}return!0}async handleBackingStore(e,t){switch(e.type){case kr.ModelUpdate:this.holdQueue.processID(t,e.model.version);break;case kr.Operations:this.holdQueue.processID(t,e.operations[e.operations.length-1].clock);break;case kr.SyncRequest:throw new Error("Unexpected SyncRequest from backing store");default:throw new Error("Unexpected ProxyMessageType")}return!0}async handleProxyMessage(e){switch(e.type){case kr.Operations:{const t=e.operations;for(const n of t){const t=this.operationElement(n);let r=null;if(t){await this.updateBackingStore(t);const e=this.backingStore.getLocalModel(t.id).getData().version;r={id:t.id,storageKey:this.backingStore.storageKey,version:e}}const i=this.updateOp(n,()=>r);if(!await this.containerStore.onProxyMessage({type:kr.Operations,operations:[i],id:1}))return!1;this.enqueueSend(()=>void this.sendExcept(e,e.id))}break}case kr.ModelUpdate:{const{version:t,values:n}=e.model,r={},i=[];Object.entries(n).forEach(([e,{value:t,version:n}])=>{i.push(this.updateBackingStore(t).then(t=>{if(t){const t=this.backingStore.getLocalModel(e).getData().version;r[e]={value:{id:e,storageKey:this.backingStore.storageKey,version:t},version:n}}return t}))}),await Promise.all(i);const s={version:t,values:r};await this.containerStore.onProxyMessage({type:kr.ModelUpdate,model:s,id:1}),this.enqueueSend(()=>this.sendExcept(e,e.id));break}case kr.SyncRequest:{const{pendingIds:t,model:n}=this.constructPendingIdsAndModel(this.containerStore.localModel.getData()),r=()=>void this.callbacks.get(e.id)({type:kr.ModelUpdate,model:n(),id:e.id});0===t.length?this.enqueueSend(r):this.enqueueBlockingSend(t,r);break}default:throw new Error("Unexpected ProxyMessageType")}return!0}enqueueSend(e){0===this.pendingSends.length?e():this.pendingSends.push({fn:e})}enqueueBlockingSend(e,t){const n=this.blockCounter+++"";this.pendingSends.push({fn:t,block:n}),this.holdQueue.enqueue(e,()=>this.processPendingSends(n))}processPendingSends(e){for(;this.pendingSends.length>0;)if(null==this.pendingSends[0].block||this.pendingSends[0].block===e){this.pendingSends.shift().fn()}}entityToModel(e){null==this.versions[e.id]&&(this.versions[e.id]={});const t=this.versions[e.id],n=this.newBackingInstance().getData();let r=0;for(const i of Object.keys(e)){if("id"===i)continue;null==t[i]&&(t[i]=0);const s={[this.crdtKey]:++t[i]};if(r=Math.max(r,t[i]),n.singletons[i])n.singletons[i].values={[e[i].id]:{value:e[i],version:s}},n.singletons[i].version=s;else{if(!n.collections[i])throw new Error(`key ${i} not found for model ${n}`);n.collections[i].values={};for(const t of e[i])n.collections[i].values[t.id]={value:t,version:s};n.collections[i].version=s}}return n.version={[this.crdtKey]:r},n}entityFromModel(e,t){const n={id:t},r={};for(const t of Object.keys(e.singletons))r[t]=new Ze;const i={};for(const t of Object.keys(e.collections))i[t]=new qe;const s=new Je(r,i);s.merge(e);const o=s.getParticleView();for(const[e,t]of Object.entries(o.singletons))n[e]=t;for(const[e,t]of Object.entries(o.collections))n[e]=t;return n}cloneMap(e){const t={};return Object.entries(e).forEach(([e,n])=>t[e]=n),t}constructPendingIdsAndModel(e){const t=[];for(const n of Object.keys(e.values)){const r=e.values[n].value.version;if(0===Object.keys(r).length)continue;const i=this.backingStore.getLocalModel(n);null!=i&&oi(i.getData().version,r)||t.push({id:n,version:r})}return{pendingIds:t,model:()=>{const t={values:{},version:this.cloneMap(e.version)};for(const n of Object.keys(e.values)){const r=e.values[n].value.version,i=0===Object.keys(r).length?this.newBackingInstance():this.backingStore.getLocalModel(n);t.values[n]={value:this.entityFromModel(i.getData(),n),version:e.values[n].version}}return t}}}async send(e){for(const t of this.callbacks.keys())this.callbacks.get(t)({...e,id:t})}async sendExcept(e,t){for(const n of this.callbacks.keys())n!==t&&this.callbacks.get(n)({...e,id:n})}async updateBackingStore(e){const t=this.entityToModel(e);return this.backingStore.onProxyMessage({type:kr.ModelUpdate,model:t,id:1},e.id)}newBackingInstance(){return new(this.type.getContainedType().crdtInstanceConstructor())}processOp(e,t,n,r,i){if(ci(i))switch(i.type){case Ie.Add:return e(i);case Ie.Remove:return t(i);default:throw new Error("unexpected operation type")}else if(function(e){return!ci(e)}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(i))switch(i.type){case Re.Set:return n(i);case Re.Clear:return r(i);default:throw new Error("unexpected operation type")}throw new Error("unexpected operation type")}operationElement(e){return this.processOp(e=>e.added,e=>e.removed,e=>e.value,e=>null,e)}updateOp(e,t){return this.processOp(e=>({...e,added:t()}),e=>({...e,removed:t()}),e=>({...e,value:t()}),e=>e,e)}}function oi(e,t){for(const n in Object.keys(t))if(e[n]<t[n])return!1;return!0}class ai{constructor(){this.queue={}}enqueue(e,t){const n={};for(const{id:t,version:r}of e)n[t]=r;const r={ids:n,onRelease:t};for(const t of e)this.queue[t.id]||(this.queue[t.id]=[]),this.queue[t.id].push(r)}processID(e,t){const n=this.queue[e];if(n){for(const r of n)oi(t,r.ids[e])&&(delete r.ids[e],0===Object.keys(r.ids).length&&r.onRelease());this.queue[e]=[]}}}function ci(e){return Boolean(e.added||e.removed)}class li extends Fn{constructor(e,t,n,r,i=""){super(),this.version=0,this.storageKey=e,this.exists=t,this.type=n,this.mode=e instanceof ii?Cr.ReferenceMode:Cr.Direct,this.id=r,this.name=i}toString(e){throw new Error("Method not implemented.")}async toLiteral(){throw new Error("Method not implemented.")}cloneFrom(e){throw new Error("Method not implemented.")}modelForSynchronization(){throw new Error("Method not implemented.")}on(e,t,n){throw new Error("Method not implemented.")}async activate(){if(null==li.constructors.get(this.mode))throw new Error(`StorageMode ${this.mode} not yet implemented`);const e=li.constructors.get(this.mode);if(null==e)throw new Error(`No constructor registered for mode ${this.mode}`);const t=await e.construct(this.storageKey,this.exists,this.type,this.mode);return this.exists=Sr.ShouldExist,t}get referenceMode(){return this.mode===Cr.ReferenceMode}}li.constructors=new Map([[Cr.Direct,ni],[Cr.ReferenceMode,si]]);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class hi{constructor({id:e,context:t,pecFactories:n,slotComposer:r,loader:i,storageKey:s,storageProviderFactory:o,speculative:a,innerArc:c,stub:l,inspectorFactory:h}){this._activeRecipe=new Mn,this._recipeDeltas=[],this.dataChangeCallbacks=new Map,this.storesById=new Map,this.storageKeys={},this.storeTags=new Map,this.storeDescriptions=new Map,this.innerArcsByParticle=new Map,this.instantiateMutex=new Zr,this.idGenerator=Bt.newSession(),this.loadedParticleInfo=new Map,this.volatileMemory=new Qr,this._context=t||new as({id:e}),this.pecFactories=n&&n.length>0?n.slice():[Dr(i).bind(null)],r&&!r.arc&&(r.arc=this),"string"==typeof e?(console.error(`Arc created with string ID ${e}!!! This should be an object of type Id instead. This warning will turn into an `+"exception soon (end of April 2019)."),this.id=jt.fromString(e)):this.id=e,this.isSpeculative=!!a,this.isInnerArc=!!c,this.isStub=!!l,this._loader=i,this.inspectorFactory=h,this.inspector=h&&h.create(this),this.storageKey=s;const u=this.pecFactories.map(e=>e(this.generateID(),this.idGenerator));this.pec=new Wr(r,this,u),this.storageProviderFactory=o||new rs(this.id),this.volatileStorageDriverProvider=new ei(this),Gr.register(this.volatileStorageDriverProvider)}get loader(){return this._loader}get modality(){return this.pec.slotComposer&&this.pec.slotComposer.modality?this.pec.slotComposer.modality:this.activeRecipe.isEmpty()?fe.union(this.context.allRecipes.map(e=>e.modality)):this.activeRecipe.modality}dispose(){for(const e of this.innerArcs)e.dispose();if(this.pec.stop(),this.pec.close(),!this.isInnerArc&&this.pec.slotComposer){const e=this.allDescendingArcs;this.pec.slotComposer.consumers.forEach(t=>d()(e.includes(t.arc))),this.pec.slotComposer.dispose()}Gr.unregister(this.volatileStorageDriverProvider);for(const e of this._stores)Ui.getRuntime().unregisterStore(e.id,[...this.findStoreTags(e)])}async _waitForIdle(){for(;;){const e=this.pec.messageCount,t=this.innerArcs;if(await Promise.all([this.pec.idle,...t.map(async e=>e.idle)]),this.innerArcs.length===t.length&&this.pec.messageCount===e+2)break}}get idle(){if(this.waitForIdlePromise)return this.waitForIdlePromise;const e=this._waitForIdle().then(()=>this.waitForIdlePromise=null);return this.waitForIdlePromise=e,e}findInnerArcs(e){return this.innerArcsByParticle.get(e)||[]}get innerArcs(){return[].concat(...this.innerArcsByParticle.values())}get allDescendingArcs(){return[this].concat(...this.innerArcs.map(e=>e.allDescendingArcs))}createInnerArc(e){const t=this.generateID("inner"),n=new hi({id:t,pecFactories:this.pecFactories,slotComposer:this.pec.slotComposer,loader:this._loader,context:this.context,innerArc:!0,speculative:this.isSpeculative,inspectorFactory:this.inspectorFactory});let r=this.innerArcsByParticle.get(e);return r||(r=[],this.innerArcsByParticle.set(e,r)),r.push(n),n}async _serializeStore(e,t,n){const r=e.type.getContainedType()||e.type;let i;r instanceof at&&(t.interfaces+=r.interfaceInfo.toString()+"\n"),i="string"==typeof e.storageKey?this.storageProviderFactory.parseStringAsKey(e.storageKey):e.storageKey;const s=[...this.storeTags.get(e)||new Set].map(e=>`#${e}`).join(" "),o=this.activeRecipe.findHandle(e.id),a=o?o.originalId:null;let c=`'${e.id}'`;switch(a&&(c+=`!!'${a}'`),i.protocol){case"firebase":case"pouchdb":t.handles+=`store ${n} of ${e.type.toString()} ${c} @${null===e.version?0:e.version} ${s} at '${e.storageKey}'\n`;break;case"volatile":{let r=[];if(s.includes("volatile")||(r=(await e.toLiteral()).model.map(e=>{const{id:t,value:n}=e,r=e.index;if(null==n)return null;let i;if(n.rawData){i={$id:t};for(const e of Object.keys(n.rawData))i[e]=n.rawData[e]}else i=n;return void 0!==r&&(i.$index=r),i})),e.referenceMode&&r.length>0){const i=r[0].storageKey;if(!t.dataResources.has(i)){const r=`${n}_Data`;t.dataResources.set(i,r),e instanceof Ln&&(await e.ensureBackingStore(),await this._serializeStore(e.backingStore,t,r))}const s=t.dataResources.get(i);r.forEach(e=>{e.storageKey=s})}const i="  ",o=JSON.stringify(r);t.resources+=`resource ${n}Resource\n`+i+"start\n"+o.split("\n").map(e=>i+e).join("\n")+"\n",t.handles+=`store ${n} of ${e.type.toString()} ${c} @${e.version||0} ${s} in ${n}Resource\n`;break}default:throw new Error(`unknown storageKey protocol ${i.protocol}`)}}async _serializeHandles(){const e={handles:"",resources:"",interfaces:"",dataResources:new Map};let t=0;const n=new Set,r=new Set,i=new Set(this.context.stores.map(e=>e.id));for(const e of this._activeRecipe.handles)if("map"===e.fate)n.add(this.context.findManifestUrlForHandleId(e.id));else{if(e.immediateValue)continue;r.add(e.id)}for(const t of n.values())e.resources+=`import '${t}'\n`;for(const n of this._stores)r.has(n.id)&&!i.has(n.id)&&await this._serializeStore(n,e,`Store${t++}`);return e.resources+e.interfaces+e.handles}_serializeParticles(){const e=[];e.push(...this._activeRecipe.particles.map(e=>e.spec)),e.push(...this._activeRecipe.handles.filter(e=>e.immediateValue).map(e=>e.immediateValue));const t=[];return e.forEach(e=>{for(const n of e.handleConnections)n.type instanceof at&&t.push(n.type.interfaceInfo.toString());t.push(e.toString())}),t.join("\n")}_serializeStorageKey(){return this.storageKey?`storageKey: '${this.storageKey}'\n`:""}async serialize(){return await this.idle,`\nmeta\n  name: '${this.id}'\n  ${this._serializeStorageKey()}\n\n${await this._serializeHandles()}\n\n${this._serializeParticles()}\n\n@active\n${this.activeRecipe.toString()}`}async persistSerialization(e){const t=this.storageProviderFactory;let n;n="string"==typeof this.storageKey?t.parseStringAsKey(this.storageKey).childKeyForArcInfo():this.storageKey.childKeyForArcInfo();const r=new ht,i=await t.connectOrConstruct("store",r,n.toString());i.referenceMode=!1,await i.set(r.newInstance(this.id,e))}static async deserialize({serialization:e,pecFactories:t,slotComposer:n,loader:r,fileName:i,context:s,inspectorFactory:o}){const a=await as.parse(e,{loader:r,fileName:i,context:s}),c=new hi({id:Dt.fromString(a.meta.name),storageKey:a.meta.storageKey,slotComposer:n,pecFactories:t,loader:r,storageProviderFactory:a.storageProviderFactory,context:s,inspectorFactory:o});await Promise.all(a.stores.map(async e=>{const t=a.storeTags.get(e),n=await e.inflate();c._registerStore(n,t)}));const l=a.activeRecipe.clone(),h={errors:new Map};return d()(l.normalize(h),`Couldn't normalize recipe ${l.toString()}:\n${[...h.errors.values()].join("\n")}`),await c.instantiate(l),c}get context(){return this._context}get activeRecipe(){return this._activeRecipe}get allRecipes(){return[this.activeRecipe].concat(this.context.allRecipes)}get recipes(){return[this.activeRecipe]}get recipeDeltas(){return this._recipeDeltas}loadedParticleSpecs(){return[...this.loadedParticleInfo.values()].map(({spec:e})=>e)}async reinstantiateParticle(e){const t=await this._getParticleInstantiationInfo(e);this.pec.reinstantiate(e,t.stores)}async _instantiateParticle(e){e.id||(e.id=this.generateID("particle"));const t=await this._getParticleInstantiationInfo(e);this.pec.instantiate(e,t.stores)}async _getParticleInstantiationInfo(e){const t={spec:e.spec,stores:new Map};this.loadedParticleInfo.set(e.id.toString(),t),e.isJavaParticle()||await this._provisionSpecUrl(e.spec);for(const[n,r]of Object.entries(e.connections))if("`slot"!==r.handle.fate){const e=this.findStoreById(r.handle.id);d()(e,`can't find store of id ${r.handle.id}`),d()(void 0!==t.spec.handleConnectionMap.get(n),"can't connect handle to a connection that doesn't exist"),t.stores.set(n,e)}return t}async _provisionSpecUrl(e){if(!e.implBlobUrl&&this.loader&&this.loader.provisionObjectUrl){const t=await this.loader.provisionObjectUrl(e.implFile);if(!t)throw new Error(`Expected url for ${e.implFile} but got ${t}`);e.setImplBlobUrl(t)}}generateID(e=""){return this.idGenerator.newChildId(this.id,e)}get _stores(){return[...this.storesById.values()]}async cloneForSpeculativeExecution(){const e=new hi({id:this.generateID(),pecFactories:this.pecFactories,context:this.context,loader:this._loader,speculative:!0,innerArc:this.isInnerArc,inspectorFactory:this.inspectorFactory}),t=new Map;for(const n of this._stores){const r=await e.storageProviderFactory.construct(n.id,n.type,"volatile");await r.cloneFrom(n),t.set(n,r),this.storeDescriptions.has(n)&&e.storeDescriptions.set(r,this.storeDescriptions.get(n))}this.loadedParticleInfo.forEach((n,r)=>{const i=new Map;n.stores.forEach((e,n)=>i.set(n,t.get(e))),e.loadedParticleInfo.set(r,{spec:n.spec,stores:i})});const{cloneMap:n}=this._activeRecipe.mergeInto(e._activeRecipe);this._recipeDeltas.forEach(t=>e._recipeDeltas.push({particles:t.particles.map(e=>n.get(e)),handles:t.handles.map(e=>n.get(e)),slots:t.slots.map(e=>n.get(e)),patterns:t.patterns}));for(const[t,r]of this.innerArcsByParticle.entries())e.innerArcsByParticle.set(n.get(t),await Promise.all(r.map(async e=>e.cloneForSpeculativeExecution())));for(const n of t.values())e._registerStore(n,[]);return e}async instantiate(e){d()(e.isResolved(),`Cannot instantiate an unresolved recipe: ${e.toString({showUnresolved:!0})}`),d()(e.isCompatible(this.modality),`Cannot instantiate recipe ${e.toString()} with [${e.modality.names}] modalities in '${this.modality.names}' arc`);const t=await this.instantiateMutex.acquire();try{await this._doInstantiate(e)}finally{t()}}async mergeIntoActiveRecipe(e){const{handles:t,particles:n,slots:r}=e.mergeInto(this._activeRecipe);this._recipeDeltas.push({particles:n,handles:t,slots:r,patterns:e.patterns}),r.forEach(e=>e.id=e.id||this.generateID("slot").toString()),t.forEach(e=>{e.toSlot()&&(e.id=e.id||this.generateID("slandle").toString())});for(const e of t){const t=this.context.findStoreById(e.id);if(["copy","create"].includes(e.fate)||"map"===e.fate&&t instanceof qn&&t.isBackedByManifest()){let t=e.type;"create"===e.fate&&d()(t.maybeEnsureResolved(),`Can't assign resolved type to ${t}`),t=t.resolvedType(),d()(t.isResolved(),`Can't create handle for unresolved type ${t}`);const n=await this.createStore(t,null,this.generateID().toString(),e.tags,e.immediateValue?"volatile":null);if(e.immediateValue){const t=e.immediateValue,r=e.type;d()(r instanceof at&&r.interfaceInfo.particleMatches(t));const i=t.clone().toLiteral();i.id=n.id,await n.set(i)}else if(["copy","map"].includes(e.fate)){const t=this.context.findStoreById(e.id),r=await t.inflate(this.storageProviderFactory);d()(r,`Cannot find store ${e.id}`),d()(null!==r.version,`Copied store ${e.id} doesn't have version.`),await n.cloneFrom(r),this._tagStore(n,this.context.findStoreTags(t)),n.name=r.name&&`Copy of ${r.name}`;const i=this.getStoreDescription(r);i&&this.storeDescriptions.set(n,i)}e.id=n.id,e.fate="use",e.storageKey=n.storageKey}else if(!this.storesById.has(e.id)&&"`slot"!==e.fate){let t=e.storageKey;t||(t=this.keyForId(e.id)),d()(t,`couldn't find storage key for handle '${e}'`);const n=e.type.resolvedType();if(d()(n.isResolved()),"string"!=typeof t)throw new Error("Need to implement storageNG code path here!");{const r=await this.storageProviderFactory.connect(e.id,n,t);d()(r,`store '${e.id}' was not found (${t})`),this._registerStore(r,e.tags)}}}return{handles:t,particles:n,slots:r}}async _doInstantiate(e){const{handles:t,particles:n,slots:r}=await this.mergeIntoActiveRecipe(e);await Promise.all(n.map(e=>this._instantiateParticle(e))),this.pec.slotComposer&&await this.pec.slotComposer.initializeRecipe(this,n),this.inspector&&this.inspector.recipeInstantiated(n,this.activeRecipe.toString())}async createStore(e,t,n,r,i){d()(e instanceof tt,`can't createStore with type ${e} that isn't a Type`),e instanceof ot&&(e=new it(e)),null==n&&(n=this.generateID().toString()),null==i&&("string"==typeof this.storageKey?i=this.storageProviderFactory.parseStringAsKey(this.storageKey).childKeyForHandle(n).toString():this.storageKey&&(i=this.storageKey.childKeyForHandle(n)));if((null==i||(e=>e&&e.includes("volatile"))(r))&&(i="volatile"),"string"==typeof i){const s=await this.storageProviderFactory.construct(n,e,i);return d()(s,`failed to create store with id [${n}]`),s.name=t,this._registerStore(s,r),s}{const s=new li(i,Sr.ShouldCreate,e,n,t);return this._registerStore(s,r),s}}_registerStore(e,t){d()(!this.storesById.has(e.id),`Store already registered '${e.id}'`),t=t||[],t=Array.isArray(t)?t:[t],this.storesById.set(e.id,e),this.storeTags.set(e,new Set(t)),this.storageKeys[e.id]=e.storageKey,e.on("change",()=>this._onDataChange(),this),Ui.getRuntime().registerStore(e,t)}_tagStore(e,t){d()(this.storesById.has(e.id)&&this.storeTags.has(e),`Store not registered '${e.id}'`);const n=this.storeTags.get(e);(t=t||new Set).forEach(e=>n.add(e))}_onDataChange(){for(const e of this.dataChangeCallbacks.values())e()}onDataChange(e,t){this.dataChangeCallbacks.set(t,e)}clearDataChange(e){this.dataChangeCallbacks.delete(e)}static _typeToKey(e){const t=e.getContainedType();if(t){const e=this._typeToKey(t);if(e)return`list:${e}`}else{if(e instanceof nt)return e.entitySchema.name;if(e instanceof at)return e.interfaceInfo;if(e instanceof rt&&e.isResolved())return hi._typeToKey(e.resolvedType())}return null}findStoresByType(e,t){const n=hi._typeToKey(e);let r=[...this.storesById.values()].filter(t=>{if(n){const e=hi._typeToKey(t.type);if(n===e)return!0}else{if(e instanceof rt&&!e.isResolved()&&t.type instanceof nt)return!0;const n=e.getContainedType();if(n&&n instanceof rt&&!n.isResolved()&&e.tag===t.type.tag)return!0}return!1});return t&&t.tags&&t.tags.length>0&&(r=r.filter(e=>0===t.tags.filter(t=>!this.storeTags.get(e).has(t)).length)),r.filter(t=>!!Dn.effectiveType(e,[{type:t.type,direction:t.type instanceof at?"host":"inout"}]))}findStoreById(e){const t=this.storesById.get(e);return null==t?this._context.findStoreById(e):t}findStoreTags(e){return this.storeTags.has(e)?this.storeTags.get(e):this._context.findStoreTags(e)}getStoreDescription(e){return d()(e,"Cannot fetch description for nonexistent store"),this.storeDescriptions.get(e)||e.description}getVersionByStore({includeArc:e=!0,includeContext:t=!1}){const n={};return e&&this.storesById.forEach((e,t)=>n[t]=e.version),t&&this._context.allStores.forEach(e=>n[e.id]=e.version),n}keyForId(e){return this.storageKeys[e]}toContextString(){const e=[];return[...this.storesById.values()].sort(_n).forEach(t=>{e.push(t.toString([...this.storeTags.get(t)]))}),this._activeRecipe.isEmpty()||e.push(this._activeRecipe.toString()),e.join("\n")}get apiChannelMappingId(){return this.id.toString()}get idGeneratorForTesting(){return this.idGenerator}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ui{constructor(){this.map=new Map,this.nextID=0}getOrCreateCache(e){return this.map.has(e)||this.map.set(e,new Map),this.map.get(e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var di='\n  icon {\n    font-family: "Material Icons";\n    font-size: 24px;\n    font-style: normal;\n    -webkit-font-feature-settings: "liga";\n    -webkit-font-smoothing: antialiased;\n    cursor: pointer;\n    user-select: none;\n    flex-shrink: 0;\n    /* partial FOUC prevention */\n    display: inline-block;\n    width: 24px;\n    height: 24px;\n    overflow: hidden;\n  }\n  icon[hidden] {\n    /* required because of display rule above,\n    display rule required for overflow: hidden */\n    display: none;\n  }\n';
/**
 * @license
 * Copyright (c) 2016 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const pi=function(e,t,n){n=n||[];for(const r in t){const i=t[r];if(i){const t=e.childNodes[r];n[i.key]=t.nodeType===Node.TEXT_NODE?t.parentElement:t,i.sub&&pi(t,i.sub,n)}}return n},fi=function(e,t,n){if(gi(e,t,n,"textContent",e.textContent))return e.textContent="",!0},mi=function(e,t,n){if(e.hasAttributes()){let r=!1;for(let i,s=e.attributes,o=s.length-1;o>=0&&(i=s[o]);o--)(yi(e,t,n,i.name,i.value)||gi(e,t,n,i.name,i.value)||_i(e,t,n,i.name,i.value))&&(e.removeAttribute(i.name),r=!0);return r}},gi=function(e,t,n,r,i){if("{{"===i.slice(0,2)){"class"===r&&(r="className");let e=i.slice(2,-2);const s=e.split(":");return 2===s.length&&(r=s[0],e=s[1]),vi(n,t,"mustaches",r,e),"$"===e[0]&&vi(n,"xlate",e,!0),!0}},yi=function(e,t,n,r,i){if("on-"===r.slice(0,3))return"{{"===i.slice(0,2)&&(i=i.slice(2,-2),console.warn(`Xen: event handler for '${r}' expressed as a mustache, which is not supported. Using literal value '${i}' instead.`)),vi(n,t,"events",r.slice(3),i),!0},_i=function(e,t,n,r,i){if("xen:forward"===r)return vi(n,t,"events","xen:forward",i),!0},vi=function(e,t,n,r,i){const s=e[t]||(e[t]=Object.create(null));(s[n]||(s[n]={}))[r]=i},wi=new class{constructor(e){this.cb=e}annotate(e,t,n){return this.notes=t,this.opts=n||0,this.key=this.opts.key||0,t.locator=this._annotateSubtree(e),t}_annotateSubtree(e){let t;for(let n,r=0,i=e.firstChild,s=null;i;r++){const o=this._annotateNode(i);o&&((t=t||{})[r]=o),(n=s?s.nextSibling:e.firstChild)===i?(s=i,i=i.nextSibling):(i=n,r--)}return t}_annotateNode(e){const t=this.key++,n=this.cb(e,t,this.notes,this.opts),r=this._annotateSubtree(e);if(n||r){const e=Object.create(null);return e.key=t,r&&(e.sub=r),e}}}(function(e,t,n,r){let i=!1;switch(r.annotator&&r.annotator(e,t,n,r)&&(i=!0),e.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:break;case Node.ELEMENT_NODE:return i||mi(e,t,n);case Node.TEXT_NODE:return i||fi(e,t,n)}return i}),bi=function(e,t,n){for(const r in e){const i=t[r],s=e[r]&&e[r].events;if(i&&s)for(const e in s)n(i,e,s[e])}},Si=function(e,t,n,r){const i=t.slice(-1);if("style%"===t||"style"===t||"xen:style"===t)"string"==typeof n?e.style.cssText=n:Object.assign(e.style,n);else if("$"==i){const r=t.slice(0,-1);"boolean"==typeof n||void 0===n?Ci(e,r,Boolean(n)):e.setAttribute(r,n)}else"textContent"===t?n&&(n.$template||n.template)?ki(e,n,r):e.textContent=n||"":"unsafe-html"===t?e.innerHTML=n||"":"value"===t?e.value!==n&&(e.value=n):e[t]=n},Ci=function(e,t,n){e[(void 0===n?!e.hasAttribute(t):n)?"setAttribute":"removeAttribute"](t,"")},ki=function(e,t,n){let{template:r,models:i}=t;if(r)r=Ii(r);else{r=e.getRootNode().querySelector(`template[${t.$template}]`)}xi(e,n,r,i)},xi=function(e,t,n,r){let i,s=e.firstElementChild;for(n&&r&&r&&r.forEach((r,o)=>{if(i=s&&s.nextElementSibling,!s){const r=Ti(n).events(t);(s=r.root.firstElementChild)&&(s._subtreeDom=r,e.appendChild(s),!n._shapeWarning&&r.root.firstElementChild&&(n._shapeWarning=!0,console.warn("xen-template: subtemplate has multiple root nodes: only the first is used.",n)))}s&&(s._subtreeDom.set(r),s=i)});s;)i=s.nextElementSibling,s.remove(),s=i},Ti=function(e,t){const n=function(e,t,n){return e._notes||(e._notes=wi.annotate(e.content,{},t,n))}(e=Ii(e),t),r=document.importNode(e.content,!0),i=r.firstElementChild,s=pi(r,n.locator);return{root:r,notes:n,map:s,firstElement:i,$(e){return this.root.querySelector(e)},set:function(e){return e&&function(e,t,n,r){if(n)for(const i in e){const s=t[i];if(s){s.scope=n;const t=e[i].mustaches;for(const e in t){const i=t[e];i in n&&Si(s,e,n[i],r)}}}}(n,s,e,this.controller),this},events:function(e){return e&&"function"!=typeof e&&(e=function(e,t,n,r){t.addEventListener(n,function(t){return e[r]?e[r](t,t.detail):e.defaultHandler?e.defaultHandler(r,t):void 0})}.bind(this,e)),this.controller=e,e&&bi(n,s,e),this},forward:function(){return bi(n,s,(e,t,n)=>{e.addEventListener(t,r=>{const i={eventName:t,handlerName:n,detail:r.detail,target:r.target};Ei(e,"xen:forward",i,{bubbles:!0})})}),this},appendTo:function(e){return this.root?e.appendChild(this.root):console.warn("Xen: cannot appendTo, template stamped no DOM"),this.root=e,this}}},Ei=(e,t,n,r)=>{const i=r||{};i.detail=n;const s=new CustomEvent(t,i);return e.dispatchEvent(s),s.detail},Ii=e=>"string"==typeof e?Ri(e):e,Ri=e=>Object.assign(document.createElement("template"),{innerHTML:e}),Ai={createTemplate:Ri,setBoolAttribute:Ci,stamp:Ti,takeNote:vi};
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class $i{}$i.alwaysTrue=(()=>!0),$i.alwaysFalse=(()=>!1);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Pi{constructor(e,t=null){this.slotConsumers=[],this.id=e,this.sourceSlotConsumer=t}addSlotConsumer(e){this.slotConsumers.push(e),e.slotContext=this}clearSlotConsumers(){this.slotConsumers.forEach(e=>e.slotContext=null),this.slotConsumers.length=0}}class Mi extends Pi{constructor(e,t,n){super(e,t),this._containerAvailable=!1,d()(t),this.storeId=n,t.addHostedSlotContexts(this)}onRenderSlot(e,t,n){this.sourceSlotConsumer.arc.pec.innerArcRender(this.sourceSlotConsumer.consumeConn.particle,this.sourceSlotConsumer.consumeConn.name,this.id,e.formatHostedContent(t))}addSlotConsumer(e){super.addSlotConsumer(e),this.containerAvailable&&e.startRender()}get containerAvailable(){return this._containerAvailable}set containerAvailable(e){if(this._containerAvailable!==e){this._containerAvailable=e;for(const t of this.slotConsumers)e?t.startRender():t.stopRender()}}}class Oi extends Pi{constructor(e,t,n,r,i,s=null){super(e,s),this.tags=[],d()(Boolean(r)!==Boolean(i),"Exactly one of either container or slotSpec may be set"),d()(Boolean(i)==Boolean(i),"Spec and source slot can only be set together"),this.name=t,this.tags=n||[],this._container=r,this.spec=i||new Rt({name:t}),this.sourceSlotConsumer&&this.sourceSlotConsumer.directlyProvidedSlotContexts.push(this),this.handles=this.spec&&this.sourceSlotConsumer?this.spec.handles.map(e=>this.sourceSlotConsumer.consumeConn.particle.connections[e].handle).filter(e=>void 0!==e):[]}onRenderSlot(e,t,n){e.setContent(t,n)}get container(){return this._container}get containerAvailable(){return Boolean(this._container)}static createContextForContainer(e,t,n,r){return new Oi(e,t,r,n,null)}isSameContainer(e){return this.spec.isSet?Boolean(this.container)===Boolean(e)&&(!this.container||Object.keys(this.container).length===Object.keys(e).length&&Object.keys(this.container).every(t=>Object.keys(e).some(e=>e===t))&&Object.values(this.container).every(t=>Object.values(e).some(e=>e===t))):!e&&!this.container||this.container===e}set container(e){if(this.isSameContainer(e))return;const t=this.container;this._container=e,this.slotConsumers.forEach(e=>e.onContainerUpdate(this.container,t))}addSlotConsumer(e){super.addSlotConsumer(e),this.container&&e.onContainerUpdate(this.container,null)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ni{constructor(e,t,n){this.directlyProvidedSlotContexts=[],this.hostedSlotContexts=[],this._renderingBySubId=new Map,this.innerContainerBySlotId={},this.arc=e,this.consumeConn=t,this.containerKind=n}getRendering(e){return this._renderingBySubId.get(e)}get renderings(){return[...this._renderingBySubId.entries()]}addRenderingBySubId(e,t){this._renderingBySubId.set(e,t)}addHostedSlotContexts(e){e.containerAvailable=Boolean(this.slotContext&&this.slotContext.containerAvailable),this.hostedSlotContexts.push(e)}get allProvidedSlotContexts(){return[...this.generateProvidedContexts()]}findProvidedContext(e){return this.generateProvidedContexts(e).next().value}*generateProvidedContexts(e=$i.alwaysTrue){for(const t of this.directlyProvidedSlotContexts)e(t)&&(yield t);for(const t of this.hostedSlotContexts)for(const n of t.slotConsumers)yield*n.generateProvidedContexts(e)}onContainerUpdate(e,t){d()(this.slotContext instanceof Oi,"Container can only be updated in non-hosted context");const n=this.slotContext;if(e!==t){const e=new Map;n&&n.spec.isSet?Object.keys(n.container||{}).forEach(t=>e.set(t,n.container[t])):e.set(void 0,n.container);for(const[t,n]of e){this._renderingBySubId.has(t)||this._renderingBySubId.set(t,{});const e=this.getRendering(t);e.container&&this.isSameContainer(e.container,n)||(e.container&&this.clearContainer(e),e.container=this.createNewContainer(n,t))}for(const[t,n]of this.renderings)e.has(t)||(this.deleteContainer(n.container),this._renderingBySubId.delete(t))}Boolean(e)!==Boolean(t)&&(e?this.startRender():this.stopRender()),this.hostedSlotContexts.forEach(t=>t.containerAvailable=Boolean(e))}createProvidedContexts(){return d()(this.consumeConn.getSlotSpec(),"Missing consume connection spec"),this.consumeConn.getSlotSpec().provideSlotConnections.map(e=>new Oi(this.consumeConn.providedSlots[e.name].id,e.name,[],null,e,this))}updateProvidedContexts(){this.allProvidedSlotContexts.forEach(e=>{e.container=e.sourceSlotConsumer.getInnerContainer(e.id)})}startRender(){if(this.consumeConn&&this.startRenderCallback){const e=new Map(this.allProvidedSlotContexts.map(e=>[e.name,e.id]));this.startRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name,providedSlots:e,contentTypes:this.constructRenderRequest()})}}stopRender(){this.consumeConn&&this.stopRenderCallback&&this.stopRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name})}setContent(e,t){e&&Object.keys(e).length>0&&this.description&&(e.descriptions=this._populateHandleDescriptions()),this.eventHandler=t;for(const[t,n]of this.renderings)this.setContainerContent(n,this.formatContent(e,t),t)}_populateHandleDescriptions(){if(!this.consumeConn)return null;const e=new Map;return Object.values(this.consumeConn.particle.connections).forEach(t=>{t.handle&&(e[`${t.name}.description`]=this.description.getHandleDescription(t.handle).toString())}),e}getInnerContainer(e){return this.innerContainerBySlotId[e]}_initInnerSlotContainer(e,t,n){t?(this.innerContainerBySlotId[e]||(this.innerContainerBySlotId[e]={}),d()(!this.innerContainerBySlotId[e][t],`Multiple ${e}:${t} inner slots cannot be provided`),this.innerContainerBySlotId[e][t]=n):this.innerContainerBySlotId[e]=n}_clearInnerSlotContainers(e){e.forEach(e=>{e?Object.values(this.innerContainerBySlotId).forEach(t=>delete t[e]):this.innerContainerBySlotId={}})}isSameContainer(e,t){return!e&&!t||e===t}constructRenderRequest(){return[]}dispose(){}createNewContainer(e,t){return null}deleteContainer(e){}clearContainer(e){}setContainerContent(e,t,n){}formatContent(e,t){return null}formatHostedContent(e){return null}static clear(e){}static findRootContainers(e){return{}}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Bi=()=>Ui.getRuntime().getCacheService().getOrCreateCache("templateByName");let Di;class ji extends Ni{constructor(e,t,n){super(e,t,n),this._observer=this._initMutationObserver()}constructRenderRequest(){const e=["model"],t=[this.templatePrefix];return ji.hasTemplate(t.join("::"))||e.push("template"),e}static hasTemplate(e){return[...Bi().keys()].find(t=>t.startsWith(e))}isSameContainer(e,t){return e.parentNode===t}createNewContainer(e,t){d()(e,"contextContainer cannot be null");const n=document.createElement(this.containerKind||"div");return this.consumeConn&&n.setAttribute("particle-host",this.consumeConn.getQualifiedName()),e.appendChild(n),n.attachShadow({mode:"open"}),n.shadowRoot}deleteContainer(e){(e=e.host||e).parentNode&&e.parentNode.removeChild(e)}formatContent(e,t){d()(this.slotContext instanceof Oi,"Content formatting can only be done for provided SlotContext");const n=this.slotContext.spec,r={};if(Object.keys(e).indexOf("model")>=0)if(e.model){let i;if(!(i=n.isSet&&this.consumeConn.getSlotSpec().isSet?this._modelForSetSlotConsumedAsSetSlot(e.model,t):n.isSet&&!this.consumeConn.getSlotSpec().isSet?this._modelForSetSlotConsumedAsSingletonSlot(e.model,t):this._modelForSingletonSlot(e.model,t)))return;r.model={...i,...e.descriptions}}else r.model=void 0;return e.templateName&&(r.templateName="string"==typeof e.templateName?e.templateName:e.templateName[t],e.template&&(r.template="string"==typeof e.template?e.template:e.template[r.templateName])),r}_modelForSingletonSlot(e,t){return d()(!t,"subId should be absent for a Singleton Slot"),e}_modelForSetSlotConsumedAsSetSlot(e,t){return d()(e.items&&e.items.every(e=>e.subId),"model for a Set Slot consumed as a Set Slot needs to have items array, with every element having subId"),e.items.find(e=>e.subId===t)}_modelForSetSlotConsumedAsSingletonSlot(e,t){return d()(e.subId,"model for a Set Slot consumed as a Singleton Slot needs to have subId"),t===e.subId?e:null}setContainerContent(e,t,n){if(e.container){if(!t||0===Object.keys(t).length)return this.clearContainer(e),void(e.model=null);this._setTemplate(e,this.templatePrefix,t.templateName,t.template),e.model=t.model,this._onUpdate(e)}}clearContainer(e){e.liveDom&&(e.liveDom.root.textContent=""),e.liveDom=null}dispose(){this._observer&&this._observer.disconnect(),this.renderings.forEach(([e,{container:t}])=>this.deleteContainer(t))}static clear(e){e.textContent=""}static clearCache(){Bi().clear()}static findRootContainers(e){const t={};return Array.from(e.querySelectorAll("[slotid]")).forEach(e=>{const n=e.getAttribute("slotid");d()(!t[n],`Duplicate root slot ${n}`),t[n]=e}),t}createTemplateElement(e){return Object.assign(document.createElement("template"),{innerHTML:e})}get templatePrefix(){return this.consumeConn.getQualifiedName()}_setTemplate(e,t,n,r){n&&(e.templateName=[t,n].filter(e=>e).join("::"),r&&(Bi().has(e.templateName)&&this.clearContainer(e),Bi().set(e.templateName,this.createTemplateElement(r))))}_onUpdate(e){if(this._observe(e.container),e.templateName){const t=Bi().get(e.templateName);d()(t,`No template for ${e.templateName}`),this._stampTemplate(e,t)}this._updateModel(e)}_observe(e){d()(e,"Cannot observe without a container"),this._observer&&this._observer.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["subid"]})}_stampTemplate(e,t){if(!e.liveDom){Di||(Di=Ai.createTemplate(`<style>${di}</style>`)),Ai.stamp(Di).appendTo(e.container);const n=this._eventMapper.bind(this,this.eventHandler);e.liveDom=Ai.stamp(t).events(n).appendTo(e.container)}}_eventMapper(e,t,n,r){t.addEventListener(n,i=>{i.stopPropagation(),"xen:forward"===n&&(t=i.detail.target,r=i.detail.handlerName);const{altKey:s,ctrlKey:o,metaKey:a,shiftKey:c,code:l,key:h,repeat:u}=i,d={key:t.key,value:t.value,keys:{altKey:s,ctrlKey:o,metaKey:a,shiftKey:c,code:l,key:h,repeat:u}};e({detail:d,handler:r,data:d})})}_updateModel(e){e.liveDom&&e.liveDom.set(e.model)}initInnerContainers(e){Array.from(e.querySelectorAll("[slotid]")).forEach(t=>{if(!this.isDirectInnerSlot(e,t))return;const n=this.getNodeValue(t,"slotid"),r=this.findProvidedContext(e=>e.id===n);if(!r)return void console.warn(`Slot ${this.consumeConn.getSlotSpec().name} has unexpected inner slot ${n}`);const i=this.getNodeValue(t,"subid");d()(Boolean(i)===r.spec.isSet,`Sub-id ${i} for slot ${r.name} doesn't match set spec: ${r.spec.isSet}`),r.sourceSlotConsumer._initInnerSlotContainer(n,i,t)})}getNodeValue(e,t){return e[t]||e.getAttribute(t)}isDirectInnerSlot(e,t){if(t===e)return!0;const n=e=>e.parentNode;let r=n(t);for(;r;){if(r===e)return!0;if(r.getAttribute&&r.getAttribute("slotid"))return!1;r=n(r)}return!1}_initMutationObserver(){return this.consumeConn?new MutationObserver(async e=>{this._observer.disconnect();const t=new Map;for(const[n,{container:r}]of this.renderings)e.some(e=>this.isDirectInnerSlot(r,e.target))&&t.set(n,r);const n=[...t.values()];n.length>0&&(this._clearInnerSlotContainers([...t.keys()]),n.forEach(e=>this.initInnerContainers(e)),this.updateProvidedContexts(),n.forEach(e=>this._observe(e)))}):null}formatHostedContent(e){if(e.templateName){if("string"!=typeof e.templateName)throw new Error("TODO: Implement this!");e.templateName=`${this.consumeConn.getQualifiedName()}::${e.templateName}`}return e}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Fi extends ji{constructor(e,t){super(e,t),this._content={},this.contentAvailable=new Promise(e=>this._contentAvailableResolve=e)}setContent(e,t){super.setContent(e,t),e?(this._content.templateName=e.templateName,e.template&&(this._content.template=e.template),this._content.model=e.model,this._contentAvailableResolve()):this._content={}}createNewContainer(e,t){return e}isSameContainer(e,t){return e===t}getInnerContainer(e){const t=Array.from(this.renderings,([e,{model:t}])=>t)[0],n=this.findProvidedContext(t=>t.id===e);if(n){if(n.spec.isSet&&t&&t.items&&t.items.models){const e={};for(const n of t.items.models)d()(n.id),e[n.id]=n.id;return e}return e}console.warn(`Cannot find provided spec for ${e} in ${this.consumeConn.getQualifiedName()}`)}createTemplateElement(e){return e}static findRootContainers(e){return e}static clear(e){}_onUpdate(e){}_stampTemplate(e){}_initMutationObserver(){return null}_observe(){}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class zi{constructor(e,t){this.slotConsumerClass=e,this.descriptionFormatter=t}static createHeadlessHandler(){return new zi(Fi)}}zi.headlessHandler=new zi(Fi),zi.basicHandler=new zi(Ni,Un),zi.domHandler=new zi(ji,class extends Un{constructor(){super(...arguments),this.nextID=0}_isSelectedDescription(e){return super._isSelectedDescription(e)||!!e.template&&!!e.model}_combineSelectedDescriptions(e,t){const n=new Map;for(const r of e){if(this.seenParticles.has(r._particle))continue;let{template:e,model:i}=this._retrieveTemplateAndModel(r,n.size,t||{});Object.keys(i).map(t=>this._initSubTokens(i[t],r).map(n=>{const r=this.tokenToString(n);if(null==r)return!1;if(r&&r.template&&r.model)e=e.replace(`{{${t}}}`,r.template),delete i[t],i={...i,...r.model};else{const n=`${t}${++this.nextID}`;e=e.replace(`{{${t}}}`,`{{${n}}}`),delete i[t],i[n]=r}return!0}).every(e=>!!e)).every(e=>!!e)&&n.set(r,{template:e,model:i})}const r=[];if(e.forEach(e=>{n.has(e)&&r.push(n.get(e))}),r.length>0){const e=this._joinDescriptions(r);return t&&t.skipFormatting||(e.template+="."),e}}_retrieveTemplateAndModel(e,t,n){if(e._template_&&e._model_)return{template:e._template_,model:JSON.parse(e._model_)};d()(e.pattern,"Description must contain template and model, or pattern");let r="";const i={};return this._initTokens(e.pattern,e).forEach((e,s)=>{if(e.text)r=r.concat(`${0!==t||0!==s||n.skipFormatting?e.text:e.text[0].toUpperCase()+e.text.slice(1)}`);else{const t=e.fullName.replace(/[.{}_$]/g,"");let o="";0!==s||n.skipFormatting||(r=r.concat("<style>\n            [firstletter]::first-letter { text-transform: capitalize; }\n            [firstletter] {display: inline-block}\n            </style>"),o=" firstletter"),r=r.concat(`<span${o}>{{${t}}}</span>`),i[t]=e.fullName}}),{template:r,model:i}}_capitalizeAndPunctuate(e){if("string"==typeof e)return{template:super._capitalizeAndPunctuate(e),model:{}};const t=e.template.match(/<[a-zA-Z0-9]+>{{([a-zA-Z0-9]*)}}<\/[a-zA-Z0-9]+>/);if(t&&t.length>1&&e.model[t[1]]){const n=e.model[t[1]];n.length>0&&(e.model[t[1]]=`${n[0].toUpperCase()}${n.substr(1)}`)}return e.template+=".",e}_joinDescriptions(e){if(e.every(e=>"string"==typeof e))return super._joinDescriptions(e);const t={template:"",model:{}},n=e.length;return e.forEach((e,r)=>{let i;"string"==typeof e&&(e={template:e,model:{}}),t.template+=e.template,t.model={...t.model,...e.model},r<n-2?i=", ":r===n-2&&(i=["",""," and ",", and "][Math.min(3,n)]),i&&(t.template+=i)}),t}_joinTokens(e){if(e.every(e=>"string"==typeof e))return super._joinTokens(e);const t=(e=e.map(e=>"object"!=typeof e?{template:`<span>{{text${++this.nextID}}}</span>`,model:{[`text${this.nextID}`]:e}}:e)).filter(e=>e&&!!e.template&&!!e.model);return{template:t.map(e=>e.template).join(""),model:t.map(e=>e.model).reduce((e,t)=>({...e,...t}),{})}}_combineDescriptionAndValue(e,t,n){if(t.template&&t.model)return{template:`${t.template} (${n.template})`,model:{...t.model,...n.model}};const r=`${e.handleName}Description${++this.nextID}`;return{template:`<span>{{${r}}}</span> (${n.template})`,model:{[r]:t,...n.model}}}_formatEntityProperty(e,t,n){const r=`${e}${t.join("")}Value${++this.nextID}`;return{template:`<b>{{${r}}}</b>`,model:{[`${r}`]:n}}}_formatCollection(e,t){const n=`${e}${++this.nextID}`;return t[0].rawData.name?t.length>2?{template:`<b>{{${n}FirstName}}</b> plus <b>{{${n}OtherCount}}</b> other items`,model:{[`${n}FirstName`]:t[0].rawData.name,[`${n}OtherCount`]:t.length-1}}:{template:t.map((e,t)=>`<b>{{${n}${t}}}</b>`).join(", "),model:Object.assign({},...t.map((e,t)=>({[`${n}${t}`]:e.rawData.name})))}:{template:`<b>{{${n}Length}}</b> items`,model:{[`${n}Length`]:t.length}}}_formatBigCollection(e,t){return{template:`collection of items like {{${e}FirstName}}`,model:{[`${e}FirstName`]:t.rawData.name}}}_formatSingleton(e,t){const n=super._formatSingleton(e,t);if(n)return{template:`<b>{{${e}Var}}</b>`,model:{[`${e}Var`]:n}}}});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Hi{constructor(e){if(this._consumers=[],this._contexts=[],d()(e.modalityHandler,`Missing or invalid modality handler: ${e.modalityHandler}`),e.rootContainer=e.rootContainer||e.rootContext||(e.containers||Object).root,d()(void 0!==e.rootContainer!=(!0===e.noRoot),"Root container is mandatory unless it is explicitly skipped"),this._containerKind=e.containerKind,e.modalityName&&(this.modality=fe.create([e.modalityName])),this.modalityHandler=e.modalityHandler,e.noRoot)return;const t=e.containers||this.modalityHandler.slotConsumerClass.findRootContainers(e.rootContainer)||{};0===Object.keys(t).length&&(t.root=e.rootContainer),Object.keys(t).forEach(e=>{this._contexts.push(Oi.createContextForContainer(`rootslotid-${e}`,e,t[e],[`${e}`]))})}get consumers(){return this._consumers}get containerKind(){return this._containerKind}getSlotConsumer(e,t){return this.consumers.find(n=>n.consumeConn.particle===e&&n.consumeConn.name===t)}findContainerByName(e){const t=this.findContextsByName(e);if(0===t.length)console.warn(`No containers for '${e}'`);else if(1===t.length)return t[0].container;console.warn(`Ambiguous containers for '${e}'`)}findContextsByName(e){return this._contexts.filter(e=>e instanceof Oi).filter(t=>t.name===e)}findContextById(e){return this._contexts.find(({id:t})=>t===e)}createHostedSlot(e,t,n,r){const i=this.getSlotConsumer(t,n);d()(i,`Transformation particle ${t.name} with consumed ${n} not found`);const s=e.generateID("slot").toString();return this._contexts.push(new Mi(s,i,r)),s}_addSlotConsumer(e){e.startRenderCallback=e.arc.pec.startRender.bind(e.arc.pec),e.stopRenderCallback=e.arc.pec.stopRender.bind(e.arc.pec),this._consumers.push(e)}async initializeRecipe(e,t){const n=[];t.forEach(t=>{t.getSlandleConnections().forEach(r=>{if(!r.targetSlot)return void d()(!r.getSlotSpec().isRequired,`No target slot for particle's ${t.name} required consumed slot: ${r.name}.`);const i=new this.modalityHandler.slotConsumerClass(e,r,this._containerKind),s=i.createProvidedContexts();this._contexts=this._contexts.concat(s),n.push(i)})}),n.forEach(e=>{this._addSlotConsumer(e);const t=this.findContextById(e.consumeConn.targetSlot.id);d()(t,`No context found for ${e.consumeConn.getQualifiedName()}`),t.addSlotConsumer(e)});const r=this.consumers.map(e=>e.arc),i=[...new Set(r).values()],s=await Promise.all(i.map(e=>Kn.create(e))),o=new Map(s.map((e,t)=>[i[t],e]));for(const e of this.consumers)e.description=o.get(e.arc)}renderSlot(e,t,n){const r=this.getSlotConsumer(e,t);d()(r,`Cannot find slot (or hosted slot) ${t} for particle ${e.name}`),r.slotContext.onRenderSlot(r,n,async n=>{if(r.arc.pec.sendEvent(e,t,n),n.data&&n.data.key)for(const e of r.hostedSlotContexts)if(e.storeId)for(const t of e.slotConsumers){const r=t.arc.findStoreById(e.storeId);d()(r),r.get().then(e=>{e&&e.id===n.data.key&&t.arc.pec.sendEvent(t.consumeConn.particle,t.consumeConn.name,n)})}})}getAvailableContexts(){return this._contexts}dispose(){this.consumers.forEach(e=>e.dispose()),this._contexts.forEach(e=>{e.clearSlotConsumers(),e instanceof Oi&&e.container&&this.modalityHandler.slotConsumerClass.clear(e.container)}),this._contexts=this._contexts.filter(e=>!e.sourceSlotConsumer),this._consumers.length=0}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Li extends Hi{constructor(e={}){void 0===e.modalityHandler&&(e.modalityHandler=zi.createHeadlessHandler()),super({rootContainer:{root:"root-context"},...e})}renderSlot(e,t,n){super.renderSlot(e,t,n);const r=this.getSlotConsumer(e,t);r&&r.updateProvidedContexts()}get contexts(){return this._contexts}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ui{constructor(e,t,n){this.arcById=new Map,this.cacheService=new ui,this.loader=e,this.composerClass=t,this.context=n||new as({id:"manifest:default"}),this.ramDiskMemory=new Qr,qi=this}static getRuntime(){return null==qi&&(qi=new Ui),qi}static clearRuntimeForTesting(){null!==qi&&(qi.destroy(),qi=null)}static newForNodeTesting(e){return new Ui(new on,Li,e)}getCacheService(){return this.cacheService}getRamDiskMemory(){return this.ramDiskMemory}destroy(){}newArc(e,t,n){const r=Bt.newSession().newArcId(e),i=this.composerClass?new this.composerClass:null;if("string"==typeof t){const e=t+r.toString();return new hi({id:r,storageKey:e,loader:this.loader,slotComposer:i,context:this.context,...n})}{const e=t(r);return new hi({id:r,storageKey:e,loader:this.loader,slotComposer:i,context:this.context,...n})}}runArc(e,t,n){return this.arcById.has(e)||this.arcById.set(e,this.newArc(e,t,n)),this.arcById.get(e)}stop(e){d()(this.arcById.has(e),`Cannot stop nonexistent arc ${e}`),this.arcById.get(e).dispose(),this.arcById.delete(e)}findArcByParticleId(e){return[...this.arcById.values()].find(t=>!!t.activeRecipe.findParticle(e))}registerStore(e,t){!this.context.findStoreById(e.id)&&t.includes("shared")&&this.context._addStore(e,t)}unregisterStore(e,t){if(!t.includes("shared"))return;const n=this.context.stores.findIndex(t=>t.id===e);if(n>=0){const e=this.context.stores[n];this.context.storeTags.delete(e),this.context.stores.splice(n,1)}}static async getArcDescription(e){return(await Kn.create(e)).getArcDescription()}static async parseManifest(e,t){return as.parse(e,t)}static async loadManifest(e,t,n){return as.load(e,t,n)}}let qi=null;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ki extends jn{constructor(e){super();let t=e.split("://");this.protocol=t[0],d()("volatile"===this.protocol,`can't construct volatile key for protocol ${this.protocol} (input key ${e})`),t=t[1]?t.slice(1).join("://").split("^^"):[],this.arcId=t[0],this.location=t[1],d()(this.toString()===e,`Expected ${e}, but got ${this.toString()} volatile key base.`)}base(){return"volatile"}get arcId(){return this._arcId}set arcId(e){this._arcId=e}childKeyForHandle(e){return new Ki("volatile")}childKeyForArcInfo(){return new Ki(`${this.protocol}://${this.arcId}^^arc-info`)}childKeyForSuggestions(e,t){return new Ki(`${this.protocol}://${this.arcId}^^${e}/suggestions/${t}`)}childKeyForSearch(e){return new Ki(`${this.protocol}://${this.arcId}^^${e}/search`)}toString(){return void 0!==this.location&&void 0!==this.arcId?`${this.protocol}://${this.arcId}^^${this.location}`:void 0!==this.arcId?`${this.protocol}://${this.arcId}`:`${this.protocol}`}}const Wi=()=>Ui.getRuntime().getCacheService().getOrCreateCache("volatileStorageCache");class Vi extends Ln{constructor(){super(...arguments),this.backingStore=null,this.pendingBackingStore=null}static newProvider(e,t,n,r,i){return e instanceof it?new Zi(e,t,n,r,i):e instanceof st?new Yi(e,t,n,r,i):new Ji(e,t,n,r,i)}async ensureBackingStore(){if(this.backingStore)return this.backingStore;if(!this.pendingBackingStore){const e=this.storageEngine.baseStorageKey(this.backingType());this.pendingBackingStore=this.storageEngine.baseStorageFor(this.backingType(),e),await this.pendingBackingStore.then(e=>this.backingStore=e)}return this.pendingBackingStore}fromLiteral({version:e,model:t}){}}class Zi extends Vi{constructor(e,t,n,r,i){super(e,n,r,i),this._model=new Pt,this.storageEngine=t,d()(null!==this.version)}backingType(){return this.type.getContainedType()}async clone(){const e=new Zi(this.type,this.storageEngine,this.name,this.id,null);return await e.cloneFrom(this),e}async cloneFrom(e){this.referenceMode=e.referenceMode;const t=await e.toLiteral();if(this.referenceMode&&t.model.length>0){await Promise.all([this.ensureBackingStore(),e.ensureBackingStore()]),t.model=t.model.map(({id:e,value:t})=>({id:e,value:{id:t.id,storageKey:this.backingStore.storageKey}}));const n=await e.backingStore.getMultiple(t.model.map(({id:e})=>e));await this.backingStore.storeMultiple(n,[this.storageKey])}this.fromLiteral(t)}async modelForSynchronization(){const e=await this._toList();return{version:this.version,model:e}}async toLiteral(){return{version:this.version,model:this._model.toLiteral()}}fromLiteral({version:e,model:t}){this.version=e,this._model=new Pt(t)}async _toList(){if(this.referenceMode){const e=(await this.toLiteral()).model;if(0===e.length)return[];const t=new Set;e.forEach(e=>t.add(e.value.storageKey)),d()(1===t.size,"multiple storageKeys in reference set of collection not yet supported.");t.values().next().value;await this.ensureBackingStore();const n=e.map(e=>e.value.id),r=await this.backingStore.getMultiple(n),i=[];for(let t=0;t<r.length;t++)i.push({id:n[t],value:r[t],keys:e[t].keys});return i}return(await this.toLiteral()).model}async toList(){return(await this._toList()).map(e=>e.value)}async getMultiple(e){return d()(!this.referenceMode,"getMultiple not implemented for referenceMode stores"),e.map(e=>this._model.getValue(e))}async storeMultiple(e,t,n=null){d()(!this.referenceMode,"storeMultiple not implemented for referenceMode stores"),e.map(e=>this._model.add(e.id,e,t)),this.version++}async get(e){if(this.referenceMode){const t=this._model.getValue(e);return null==t?null:(await this.ensureBackingStore(),await this.backingStore.get(t.id))}return this._model.getValue(e)}traceInfo(){return{items:this._model.size}}async store(e,t,n=null){d()(null!=t&&t.length>0,"keys required");const r={value:e,keys:t,effective:void 0};if(this.referenceMode){const n=this.type.getContainedType(),i=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(n);r.effective=this._model.add(e.id,{id:e.id,storageKey:i},t),await this.ensureBackingStore(),await this.backingStore.store(e,t)}else r.effective=this._model.add(e.id,e,t);this.version++,await this._fire("change",new Hn({add:[r],version:this.version,originatorId:n}))}async removeMultiple(e,t=null){0===e.length&&(e=this._model.toList().map(e=>({id:e.id,keys:[]}))),e.forEach(e=>{0===e.keys.length&&(e.keys=this._model.getKeys(e.id)),e.value=this._model.getValue(e.id),null!==e.value&&(e.effective=this._model.remove(e.id,e.keys))}),this.version++,await this._fire("change",new Hn({remove:e,version:this.version,originatorId:t}))}async remove(e,t=[],n=null){0===t.length&&(t=this._model.getKeys(e));const r=this._model.getValue(e);if(null!==r){const i=this._model.remove(e,t);this.version++,await this._fire("change",new Hn({remove:[{value:r,keys:t,effective:i}],version:this.version,originatorId:n}))}}clearItemsForTesting(){this._model=new Pt}}class Ji extends Vi{constructor(e,t,n,r,i){super(e,n,r,i),this.localKeyId=0,this.storageEngine=t,this._stored=null,this.backingStore=null}backingType(){return this.type}async clone(){const e=new Ji(this.type,this.storageEngine,this.name,this.id,null);return await e.cloneFrom(this),e}async cloneFrom(e){this.referenceMode=e.referenceMode,e.referenceMode&&e.localModified&&await e._persistChanges();const t=await e.toLiteral();if(this.referenceMode&&t.model.length>0){await Promise.all([this.ensureBackingStore(),e.ensureBackingStore()]),t.model=t.model.map(({id:e,value:t})=>({id:e,value:{id:t.id,storageKey:this.backingStore.storageKey}}));const n=await e.backingStore.getMultiple(t.model.map(({id:e})=>e));await this.backingStore.storeMultiple(n,[this.storageKey])}await this.fromLiteral(t)}async modelForSynchronization(){if(this.referenceMode&&null!==this._stored){const e=this._stored;await this.ensureBackingStore();const t=await this.backingStore.get(e.id);return{version:this.version,model:[{id:e.id,value:t}]}}return super.modelForSynchronization()}async toLiteral(){const e=this._stored,t=null!=e?[{id:e.id,value:e,keys:[]}]:[];return{version:this.version,model:t}}fromLiteral({version:e,model:t}){const n=0===t.length?null:t[0].value;this.referenceMode&&n&&n.rawData&&d()(!1,`shouldn't have rawData ${JSON.stringify(n.rawData)} here`),d()(void 0!==n),this._stored=n,this.version=e}traceInfo(){return{stored:null!==this._stored}}async get(){if(this.referenceMode&&this._stored){const e=this._stored;return await this.ensureBackingStore(),await this.backingStore.get(e.id)}return this._stored}async set(e,t=null,n=null){if(d()(void 0!==e),this.referenceMode&&e){const t=this.type,n=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(t);this._stored={id:e.id,storageKey:n},await this.ensureBackingStore(),await this.backingStore.store(e,[this.storageKey+this.localKeyId++])}else{if(JSON.stringify(this._stored)===JSON.stringify(e)&&null==n)return;this._stored=e}this.version++;const r=this.referenceMode?e:this._stored;await this._fire("change",new Hn({data:r,version:this.version,originatorId:t,barrier:n}))}async clear(e=null,t=null){await this.set(null,e,t)}}class Gi{constructor(e,t,n,r){this.version=e,this.pageSize=n;const i=[...t];i.sort((e,t)=>e.index-t.index),this.data=i.map(e=>e.value),r||this.data.reverse()}async next(){return 0===this.data.length?{done:!0}:{value:this.data.splice(0,this.pageSize),done:!1}}close(){this.data=[]}}class Yi extends Vi{constructor(e,t,n,r,i){super(e,n,r,i),this.items=new Map,this.cursors=new Map,this.cursorIndex=0}enableReferenceMode(){d()(!1,"referenceMode is not supported for BigCollection")}backingType(){return this.type.getContainedType()}async get(e){const t=this.items.get(e);return void 0!==t?t.value:null}async store(e,t,n){d()(null!=t&&t.length>0,"keys required"),this.version++,this.items.has(e.id)||this.items.set(e.id,{index:null,value:null,keys:{}});const r=this.items.get(e.id);r.index=this.version,r.value=e,t.forEach(e=>r.keys[e]=this.version)}async remove(e,t,n){this.version++,this.items.delete(e)}async stream(e,t=!0){d()(!isNaN(e)&&e>0),this.cursorIndex++;const n=new Gi(this.version,this.items.values(),e,t);return this.cursors.set(this.cursorIndex,n),this.cursorIndex}async cursorNext(e){const t=this.cursors.get(e);if(!t)return{done:!0};const n=await t.next();return n.done&&this.cursors.delete(e),n}async cursorClose(e){const t=this.cursors.get(e);t&&(this.cursors.delete(e),t.close())}cursorVersion(e){const t=this.cursors.get(e);return t?t.version:null}async cloneFrom(e){e.items&&this.fromLiteral(e.toLiteral())}async toLiteral(){const e=[];for(const[t,{index:n,value:r,keys:i}]of this.items.entries())e.push({id:t,index:n,value:r,keys:Object.keys(i)});return{version:this.version,model:e}}fromLiteral({version:e,model:t}){this.version=e,this.items.clear();for(const{id:e,index:n,value:r,keys:i}of t){const t={};for(const e of i)t[e]=n;this.items.set(e,{index:n,value:r,keys:t})}}clearItemsForTesting(){this.items.clear()}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var Qi,Xi;!function(e){e[e.arc=1]="arc"}(Qi||(Qi={})),function(e){e[e.handles=1]="handles"}(Xi||(Xi={}));class es extends jn{constructor(e,t){super();const n=e.match(/^synthetic:\/\/([^\/]+)\/([^\/]+)\/(.+)$/);if(null===n||4!==n.length)throw new Error(`invalid synthetic key: ${e}`);if(this.scope=Qi[n[1]],this.category=Xi[n[2]],this.scope!==Qi.arc)throw new Error(`invalid scope '${n[1]}' for synthetic key: ${e}`);{this.targetType=new ht;const e=t.parseStringAsKey(n[3]).childKeyForArcInfo();this.targetKey=e.toString()}if(this.category!==Xi.handles)throw new Error(`invalid category '${n[2]}' for synthetic key: ${e}`);this.syntheticType=new ut}get protocol(){return"synthetic"}base(){return d()(!1,"base not supported for synthetic keys"),null}get arcId(){return d()(!1,"arcId not supported for synthetic keys"),null}childKeyForHandle(e){return d()(!1,"childKeyForHandle not supported for synthetic keys"),null}childKeyForArcInfo(){return d()(!1,"childKeyForArcInfo not supported for synthetic keys"),null}childKeyForSuggestions(e,t){return d()(!1,"childKeyForSuggestions not supported for synthetic keys"),null}childKeyForSearch(e){return d()(!1,"childKeyForSearch not supported for synthetic keys"),null}toString(){return`${this.protocol}://${Qi[this.scope]}/${Xi[this.category]}/${this.targetKey}`}}class ts extends Ln{constructor(e,t,n,r,i){super(e,void 0,t,n),this.model=[],this.backingStore=void 0,this.targetStore=r,this.storageFactory=i,this.initialized=(async()=>{const e=await r.get();await this.process(e,!1),r.on("change",e=>this.process(e.data,!0),this)})()}async process(e,t){let n;try{if(e){const t=await as.parse(Qe.extractSerialization(e),{});n=t.activeRecipe&&t.activeRecipe.handles}}catch(e){console.warn(`Error parsing manifest at ${this.storageKey}:\n${e.message}`)}const r=this.model;this.model=[];for(const e of n||[])if(this.storageFactory.isPersistent(e.storageKey)){if("string"!=typeof e.storageKey)throw new Error("Can't use old storage stack with NG StorageKey objects");this.model.push(new Xe(e.id,e.storageKey,e.mappedType,e.tags))}if(t){const e=function(e,t,n){const r={add:[],remove:[]},i=new Map,s=new Map,o=new Map;for(const t of e){const e=n(t);i.set(e,t),s.set(e,t)}for(const e of t){const t=n(e);i.set(t,e),o.set(t,e)}for(const[e,t]of i)if(s.has(e)){if(o.has(e))continue;r.remove.push(t)}else d()(o.has(e)),r.add.push(t);return r}(r,this.model,JSON.stringify),t=e.add.map(e=>({value:e})),n=e.remove.map(e=>({value:e}));await this._fire("change",new Hn({add:t,remove:n}))}}async toList(){return await this.initialized,this.model}async toLiteral(){throw new Error("unimplemented")}async cloneFrom(){throw new Error("cloneFrom should never be called on SyntheticCollection!")}async ensureBackingStore(){throw new Error("ensureBackingStore should never be called on SyntheticCollection!")}async getMultiple(e){throw new Error("unimplemented")}async storeMultiple(e,t,n){throw new Error("unimplemented")}async removeMultiple(e,t){throw new Error("unimplemented")}async get(e){throw new Error("unimplemented")}remove(e,t,n){throw new Error("unimplemented")}store(e,t,n){throw new Error("unimplemented")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const ns={volatile:{storage:class extends zn{constructor(e){super(e),this._memoryMap={},this._typeMap={},this.localIDBase=0,this.typePromiseMap={},Wi().set(this.arcId.toString(),this)}async construct(e,t,n){const r=await this._construct(e,t,n);return t instanceof lt||t instanceof st?r:t.isTypeContainer()&&t.getContainedType()instanceof lt?r:(r.enableReferenceMode(),r)}async _construct(e,t,n){const r=this.constructKey(n),i=Vi.newProvider(t,this,void 0,e,r);return void 0!==this._memoryMap[r]?null:(this._memoryMap[r]=i,i)}constructKey(e){const t=new Ki(e);return void 0===t.arcId&&(t.arcId=this.arcId.toString()),void 0===t.location&&(t.location="volatile-"+this.localIDBase++),t.toString()}async connect(e,t,n){const r=new Ki(n);return r.arcId!==this.arcId.toString()?null==Wi().get(r.arcId)?null:Wi().get(r.arcId).connect(e,t,n):void 0===this._memoryMap[n]?null:this._memoryMap[n]}baseStorageKey(e){const t=new Ki("volatile");return t.arcId=this.arcId.toString(),t.location="volatile-"+e.toString(),t.toString()}async baseStorageFor(e,t){if(this._typeMap[t])return this._typeMap[t];if(this.typePromiseMap[t])return this.typePromiseMap[t];const n=this._construct(e.toString(),e.collectionOf(),t);this.typePromiseMap[t]=n;const r=await n;return d()(r,`could not construct baseStorage for key ${t}`),this._typeMap[t]=r,r}parseStringAsKey(e){const t=new Ki(e);return void 0===t.arcId&&(t.arcId=this.arcId.toString()),t}},isPersistent:!1},synthetic:{storage:class extends zn{constructor(e,t){super(e),this.storageFactory=t}async construct(e,t,n){throw new Error("cannot construct SyntheticStorage providers; use connect")}async connect(e,t,n){d()(null===t,"SyntheticStorage does not accept a type parameter");const r=new es(n,this.storageFactory),i=await this.storageFactory.connect(e,r.targetType,r.targetKey);return null===i?null:new ts(r.syntheticType,e,n,i,this.storageFactory)}async baseStorageFor(e,t){throw new Error("baseStorageFor not implemented for SyntheticStorage")}baseStorageKey(e,t){throw new Error("baseStorageKey not implemented for SyntheticStorage")}parseStringAsKey(e){return new es(e,this.storageFactory)}},isPersistent:!1}};class rs{constructor(e){this.arcId=e,this.mutexMap=new Map,this._storageInstances={},Object.keys(ns).forEach(t=>{const{storage:n,isPersistent:r}=ns[t];this._storageInstances[t]={storage:new n(e,this),isPersistent:r}})}static register(e,t){ns[e]=t}getInstance(e){const t=this._storageInstances[e.split(":")[0]];if(!t)throw new Error(`unknown storage protocol: ${e}`);return t}_storageForKey(e){if(!e)throw new Error("key is required");return this.getInstance(e).storage}isPersistent(e){return e&&this.getInstance(e).isPersistent}async construct(e,t,n){return await this._storageForKey(n).construct(e,t,n)}async connect(e,t,n){return await this._storageForKey(n).connect(e,t,n)}async _acquireMutexForKey(e){return this.mutexMap.has(e)||this.mutexMap.set(e,new Zr),this.mutexMap.get(e).acquire()}async connectOrConstruct(e,t,n){const r=this._storageForKey(n),i=await this._acquireMutexForKey(n);try{let s=await r.connect(e,t,n);return null==s&&(s=await r.construct(e,t,n)),s}finally{i()}}async baseStorageFor(e,t){return await this._storageForKey(t).baseStorageFor(e,t)}baseStorageKey(e,t){return this._storageForKey(t).baseStorageKey(e,t)}parseStringAsKey(e){return this._storageForKey(e).parseStringAsKey(e)}newKey(e,t){}async shutdown(){for(const e of Object.values(this._storageInstances))await e.storage.shutdown()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class is extends Error{constructor(e,t){super(t),this.location=e}}class ss{traverse(e){if(["string","number","boolean"].includes(typeof e)||null===e)return;if(e instanceof Array){for(const t of e)this.traverse(t);return}d()(e.location,"expected manifest node to have `location`"),d()(e.kind,"expected manifest node to have `kind`");let t=!1;const n=()=>{if(!t){t=!0;for(const t of Object.keys(e))["location","kind","model"].includes(t)||this.traverse(e[t])}};this.visit(e,n),n()}visit(e,t){}}const os=new Set;class as{constructor({id:e}){if(this._recipes=[],this._imports=[],this._particles={},this._schemas={},this._stores=[],this._interfaces=[],this.storeTags=new Map,this._fileName=null,this._idGenerator=Bt.newSession(),this._storageProviderFactory=void 0,this._meta=new pn,this._resources={},this.storeManifestUrls=new Map,this.errors=[],d()(e instanceof Dt||"string"==typeof e),e instanceof Dt)this._id=e;else{const t=e.split(":");this._id=Dt._newIdInternal(t[0],t.slice(1))}}get id(){return this._meta.name?Dt.fromString(this._meta.name):this._id}get storageProviderFactory(){return null==this._storageProviderFactory&&(this._storageProviderFactory=new rs(this.id)),this._storageProviderFactory}get recipes(){return this._recipes}get allRecipes(){return[...new Set(this._findAll(e=>e._recipes))]}get activeRecipe(){return this._recipes.find(e=>"active"===e.annotation)}get particles(){return Object.values(this._particles)}get allParticles(){return[...new Set(this._findAll(e=>Object.values(e._particles)))]}get imports(){return this._imports}get schemas(){return this._schemas}get allSchemas(){return[...new Set(this._findAll(e=>Object.values(e._schemas)))]}get fileName(){return this._fileName}get stores(){return this._stores}get allStores(){return[...this._findAll(e=>e._stores)]}get interfaces(){return this._interfaces}get meta(){return this._meta}get resources(){return this._resources}applyMeta(e){void 0!==this._storageProviderFactory&&d()(e.name===this._meta.name||null==e.name,"can't change manifest ID after storage is constructed"),this._meta.apply(e)}async createStore(e,t,n,r,i,s){return this.newStorageStub(e,t,n,s,r,null,i)}_addStore(e,t){return this._stores.push(e),this.storeTags.set(e,t||[]),e}newStorageStub(e,t,n,r,i,s,o,a,c,l,h,u){return l&&this.storeManifestUrls.set(n,this.fileName),this._addStore(new qn(e,n,t,r,this.storageProviderFactory,s,o,a,c,l,h,u),i)}_find(e){let t=e(this);if(!t)for(const n of this._imports)if(t=n._find(e))break;return t}*_findAll(e){yield*e(this);for(const t of this._imports)yield*t._findAll(e)}findSchemaByName(e){return this._find(t=>t._schemas[e])}findTypeByName(e){const t=this.findSchemaByName(e);if(t)return new nt(t);const n=this.findInterfaceByName(e);return n?new at(n):void 0}findParticleByName(e){return this._find(t=>t._particles[e])}findParticlesByVerb(e){return[...this._findAll(t=>Object.values(t._particles).filter(t=>t.primaryVerb===e))]}findStoreByName(e){return this._find(t=>t._stores.find(t=>t.name===e))}findStoreById(e){return this._find(t=>t._stores.find(t=>t.id===e))}findStoreTags(e){return new Set(this._find(t=>t.storeTags.get(e)))}findManifestUrlForHandleId(e){return this._find(t=>t.storeManifestUrls.get(e))}findStoresByType(e,t={tags:[],subtype:!1}){const n=t.tags||[],r=t.subtype||!1;return[...this._findAll(t=>t._stores.filter(i=>(function(t){const n=e.resolvedType();if(!n.isResolved())return e instanceof it==t.type instanceof it&&e instanceof st==t.type instanceof st;if(r){const[e,r]=tt.unwrapPair(t.type,n);return e instanceof nt&&r instanceof nt&&e.entitySchema.isMoreSpecificThan(r.entitySchema)}return dt.compareTypes({type:t.type},{type:e})})(i)&&function(e,t){return 0===n.filter(n=>!e.storeTags.get(t).includes(n)).length}(t,i)))].filter(t=>!!Dn.effectiveType(e,[{type:t.type,direction:t.type instanceof at?"host":"inout"}]))}findInterfaceByName(e){return this._find(t=>t._interfaces.find(t=>t.name===e))}findRecipesByVerb(e){return[...this._findAll(t=>t._recipes.filter(t=>t.verbs.includes(e)))]}generateID(){return this._idGenerator.newChildId(this.id)}static async load(e,t,n={}){let{registry:r}=n;return(r=r||{})&&r[e]?await r[e]:(r[e]=(async()=>{const n=await t.loadResource(e);return d()(void 0!==n,`${e} unable to be loaded by Manifest parser`),await as.parse(n,{fileName:e,loader:t,registry:r})})(),await r[e])}static getErrors(e){return e.errors}static async parse(e,t={}){let{fileName:n,loader:r,registry:i,context:s,throwImportErrors:o}=t;i=i||{};const a=`manifest:${n}:`;function c(e){for(const t of e.errors){if(t.key){if(os.has(t.key))continue;os.add(t.key)}console.warn(l(t).message)}}function l(t,r){return t instanceof is||t.location?function(t,r){const i=e.split("\n")[t.location.start.line-1];let s=t.message||"";if(i){let e=1;e=t.location.end.line===t.location.start.line?t.location.end.column-t.location.start.column:i.length-t.location.start.column,e=Math.max(1,e);let o,a="";for(let e=0;e<t.location.start.column-1;e++)a+=" ";for(let t=0;t<e;t++)a+="^";s=`${o=r?"Parse error in":"Post-parse processing error caused by"} '${n}' line ${t.location.start.line}.\n${t.message}\n  ${i}\n  ${a}`}const o=new is(t.location,s);r||(o.stack=t.stack);return o}(t,r):t}let h=[];try{h=cn(e)}catch(e){throw l(e,!0)}const u=new as({id:a});u._fileName=n,s&&u._imports.push(s);try{await Promise.all(h.map(async e=>{if("import"===e.kind){if(!r)throw new Error("loader required to parse import statements");const t=r.path(u.fileName),n=r.join(t,e.path);try{u._imports.push(await as.load(n,r,{registry:i}))}catch(t){u.errors.push(t),u.errors.push(new is(e.location,`Error importing '${n}'`))}}}));const e=async(e,t)=>{for(const n of h)n.kind===e&&(as._augmentAstWithTypes(u,n),await t(n))};await e("meta",e=>u.applyMeta(e.items)),await e("resource",e=>this._processResource(u,e)),await e("schema",e=>this._processSchema(u,e)),await e("interface",e=>this._processInterface(u,e)),await e("particle",e=>this._processParticle(u,e,r)),await e("store",e=>this._processStore(u,e,r)),await e("recipe",e=>this._processRecipe(u,e))}catch(e){throw c(u),l(e,!1)}if(c(u),t.throwImportErrors&&u.errors.length>0)throw u.errors[0];return u}static _augmentAstWithTypes(e,t){(new class extends ss{constructor(){super()}visit(t,n){switch(n(),t.kind){case"schema-inline":{const n=[],r=[],i=[];for(const s of t.names){const t=e.resolveTypeName(s);t&&t.schema&&t.schema.isAlias?r.push(t.schema):i.push(s),t&&t.schema&&n.push(t.schema)}const s={};for(let{name:e,type:r}of t.fields){for(const i of n)if(r){const n=i.fields[e];if(n&&!Ge.typesEqual(n,r))throw new is(t.location,`Type of '${e}' does not match schema (${r} vs ${n})`)}else r=i.fields[e];if(!r)throw new is(t.location,`Could not infer type of '${e}' field`);s[e]=r}let o=new Ge(i,s);for(const e of r)if(!(o=Ge.union(e,o)))throw new is(t.location,"Could not merge schema aliases");return void(t.model=new nt(o))}case"variable-type":{const e=t.constraint&&t.constraint.model;return void(t.model=rt.make(t.name,e,null))}case"slot-type":{const e={};for(const n of Object.keys(t.fields)){const r=t.fields[n];e[r.name]=r.value}return void(t.model=ct.make(e.formFactor,e.handle))}case"type-name":{const n=e.resolveTypeName(t.name);if(!n)throw new is(t.location,`Could not resolve type reference to type name '${t.name}'`);if(n.schema)t.model=new nt(n.schema);else{if(!n.iface)throw new is(t.location,"Expected {iface} or {schema}");t.model=new at(n.iface)}return}case"collection-type":return void(t.model=new it(t.type.model));case"big-collection-type":return void(t.model=new st(t.type.model));case"reference-type":return void(t.model=new lt(t.type.model));default:return}}}).traverse(t)}static _processSchema(e,t){let n;const r={};let i=[...t.names];for(const e of t.items)switch(e.kind){case"schema-field":{const t=e;if(r[t.name])throw new is(t.location,`Duplicate definition of field '${t.name}'`);r[t.name]=t.type;break}case"description":if(n)throw new is(e.location,"Duplicate schema description");n=e;break;default:throw new is(e.location,`unknown parser artifact ${e.kind} while processing schema`)}for(const n of t.parents){const s=e.findSchemaByName(n);if(!s)throw new is(t.location,`Could not find parent schema '${n}'`);for(const[e,i]of Object.entries(s.fields))if(r[e]&&!Ge.typesEqual(r[e],i))throw new is(t.location,`'${n}' defines incompatible type for field '${e}'`);Object.assign(r,s.fields),i.push(...s.names)}i=[i[0],...i.filter(e=>e!==i[0])];const s=t.alias||i[0];if(!s)throw new is(t.location,"Schema defined without name or alias");const o=new Ge(i,r,n);t.alias&&(o.isAlias=!0),e._schemas[s]=o}static _processResource(e,t){e._resources[t.name]=t.data}static _processParticle(e,t,n){if(d()(null==t.implFile||null!==t.args,"no valid body defined for this particle"),t.args||(t.args=[]),t.hasParticleArgument){const n=new is(t.location,"Particle uses deprecated argument body");n.key="hasParticleArgument",e._warnings.push(n)}t.implFile&&n&&(t.implFile=n.join(e.fileName,t.implFile));const r=e=>{for(const t of e)t.type=t.type.model,r(t.dependentConnections)};r(t.args),e._particles[t.name]=new At(t)}static _processInterface(e,t){const n=[];for(const e of t.args){const t={name:void 0,type:void 0,direction:e.direction};"*"!==e.name&&(t.name=e.name),e.type&&(t.type=e.type.model),n.push(t)}const r=[];for(const e of t.slots)r.push({direction:e.direction,name:e.name,isRequired:e.isRequired,isSet:e.isSet});const i=new ke(t.name,n,r);e._interfaces.push(i)}static _processRecipe(e,t){const n=e._newRecipe(t.name);t.annotation&&(n.annotation=t.annotation),t.triggers&&(n.triggers=t.triggers),t.verbs&&(n.verbs=t.verbs),this._buildRecipe(e,n,t.items)}static _buildRecipe(e,t,n){const r={require:n.filter(e=>"require"===e.kind),handles:n.filter(e=>"handle"===e.kind),byHandle:new Map,requireHandles:n.filter(e=>"requireHandle"===e.kind),particles:n.filter(e=>"particle"===e.kind),byParticle:new Map,slots:n.filter(e=>"slot"===e.kind),bySlot:new Map,byName:new Map,connections:n.filter(e=>"connection"===e.kind),search:n.find(e=>"search"===e.kind),description:n.find(e=>"description"===e.kind)};d()(!(r.handles.length>0&&r.requireHandles.length>0),"Inconsistent handle definitions");const i=r.handles.length>0?r.handles:r.requireHandles;for(const n of i){const i=t.newHandle(),s=n.ref;if(s.id){i.id=s.id;const t=e.findStoreById(i.id);t&&i.mapToStorage(t)}else if(s.name){const t=e.findStoreByName(s.name);d()(t,`Could not find handle ${s.name}`),i.mapToStorage(t)}i.tags=s.tags,n.name&&(d()(!r.byName.has(n.name),`duplicate handle name: ${n.name}`),i.localName=n.name,r.byName.set(n.name,{item:n,handle:i})),i.fate=n.fate?n.fate:null,r.byHandle.set(i,n)}const s=(t,n)=>{switch(n.targetType){case"particle":{const r=e.findParticleByName(n.particle);if(!r)throw new is(t.location,`could not find particle '${n.particle}'`);if(null!==n.param&&!r.handleConnectionMap.has(n.param))throw new is(t.location,`param '${n.param}' is not defined by '${n.particle}'`);return new wn(r,n.param)}case"localName":if(!r.byName.has(n.name))throw new is(t.location,`local name '${n.name}' does not exist in recipe`);if(null==n.param&&0===n.tags.length&&r.byName.get(n.name).handle)return new Sn(r.byName.get(n.name).handle);throw new is(t.location,"references to particles by local name not yet supported");case"tag":return new Cn(n.tags);default:throw new is(t.location,`endpoint ${n.targetType} not supported`)}};for(const e of r.connections){const n=s(e,e.from),r=s(e,e.to);t.newConnectionConstraint(n,r,e.direction)}r.search&&(t.search=new Pn(r.search.phrase,r.search.tokens));for(const e of r.slots){const n=t.newSlot(void 0);e.ref.id&&(n.id=e.ref.id),e.ref.tags&&(n.tags=e.ref.tags),e.name&&(d()(!r.byName.has(e.name),`Duplicate slot local name ${e.name}`),n.localName=e.name,r.byName.set(e.name,n)),r.bySlot.set(n,e)}for(const n of r.particles){const i=t.newParticle(n.ref.name);if(i.verbs=n.ref.verbs,!(t instanceof On)&&n.ref.name){const t=e.findParticleByName(n.ref.name);if(!t)throw new is(n.location,`could not find particle ${n.ref.name}`);i.spec=t.clone()}n.name&&(d()(!r.byName.has(n.name)),i.localName=n.name,r.byName.set(n.name,{item:n,particle:i})),r.byParticle.set(i,n);for(const e of n.slotConnections){if("provide"===e.direction)throw new is(n.location,"invalid slot connection: provide slot must be dependent");let s=i.getSlotConnectionByName(e.param);if(!s){if(void 0!==i.spec){if(!i.spec.slotConnections.has(e.param))throw new is(e.location,`Consumed slot '${e.param}' is not defined by '${i.name}'`);e.dependentSlotConnections.forEach(e=>{if(!i.getSlotSpecByName(e.param))throw new is(e.location,`Provided slot '${e.param}' is not defined by '${i.name}'`)})}s=i.addSlotConnection(e.param)}s.tags=e.tags||[],e.dependentSlotConnections.forEach(e=>{if("consume"===e.direction)throw new is(n.location,"invalid slot connection: consume slot must not be dependent");if(0!==e.dependentSlotConnections.length)throw new is(n.location,"invalid slot connection: provide slot must not have dependencies");if(t instanceof On){const n=t.parent.slots.find(t=>t.localName===e.name);void 0!==n&&(s.providedSlots[e.param]=n,n.sourceConnection=s,n.name=e.param)}let i=s.providedSlots[e.param];if(i){if(e.name)if(r.byName.has(e.name)){const n=r.byName.get(e.name);d()(n!==i),d()(!n.name&&i),d()(!n.sourceConnection&&i.sourceConnection),i.id=n.id,i.tags=n.tags,r.byName.set(e.name,i),t.removeSlot(n)}else r.byName.set(e.name,i);r.bySlot.set(i,e)}else i=r.byName.get(e.name);i||((i=t.newSlot(e.param)).localName=e.name,i.sourceConnection=s,e.name&&(d()(!r.byName.has(e.name)),r.byName.set(e.name,i)),r.bySlot.set(i,e)),s.providedSlots[e.param]||(s.providedSlots[e.param]=i),i.localName=e.name})}}const o=(n,i)=>{let s;"*"===i.param?s=n.addUnnamedConnection():(s=n.connections[i.param])||(s=n.addConnectionName(i.param)),s.tags=i.target?i.target.tags:[];const a=xn(i.dir);if(!Tn(a,s.direction))throw new is(i.location,`'${i.dir}' (${a}) not compatible with '${s.direction}' param of '${n.name}'`);if("any"===s.direction){if("*"!==i.param&&void 0!==n.spec)throw new is(i.location,`param '${i.param}' is not defined by '${n.name}'`);s.direction=a}let c,l;if(i.target&&i.target.name){let e=r.byName.get(i.target.name);if(e){if(!e.item)throw new is(i.location,`did not expect '${e}' expected handle or particle`)}else{const n=t.newHandle();n.tags=[],n.localName=i.target.name,"`consume"===s.direction||"`provide"===s.direction?n.fate="`slot":n.fate="create",n.item={kind:"handle"},e={item:n.item,handle:n},r.byName.set(n.localName,e),r.byHandle.set(n,n.item)}if("handle"===e.item.kind||"requireHandle"===e.item.kind)c=e.handle;else{if("particle"!==e.item.kind)throw new is(i.location,`did not expect ${e.item.kind}`);l=e.particle}}if(i.target&&i.target.particle){const t=e.findParticleByName(i.target.particle);if(!t)throw new is(i.target.location,`Could not find hosted particle '${i.target.particle}'`);if(!(c=Rn.constructImmediateValueHandle(s,t,e.generateID())))throw new is(i.target.location,`Hosted particle '${t.name}' does not match interface '${s.name}'`)}if(l){let e;i.target.name?(e=l.connections[i.target.name])||(e=l.addConnectionName(i.target.name)):e=l.addUnnamedConnection(),(c=e.handle)||(c=t.newHandle(),e.connectToHandle(c))}c&&s.connectToHandle(c),i.dependentConnections.forEach(e=>o(n,e))};for(const[e,n]of r.byParticle){for(const t of n.connections)o(e,t);for(const i of n.slotConnections){let n=r.byName.get(i.name);n?(d()(r.bySlot.has(n)),n.name||(n.name=i.param),d()(n===r.byName.get(i.name),`Target slot ${n.name} doesn't match slot connection ${i.param}`)):i.name&&(t instanceof On&&void 0!==(n=t.parent.slots.find(e=>e.localName===i.name))&&(r.bySlot.set(n,i),i.name&&r.byName.set(i.name,n)),null==n&&((n=t.newSlot(i.param)).localName=i.name,r.byName.set(i.name,n),r.bySlot.set(n,i))),n&&e.getSlotConnectionByName(i.param).connectToSlot(n)}}if(r.description&&r.description.description&&(t.description=r.description.description),r.require)for(const n of r.require){const r=t.newRequireSection();this._buildRecipe(e,r,n.items)}}resolveTypeName(e){const t=this.findSchemaByName(e);if(t)return{schema:t};const n=this.findInterfaceByName(e);return n?{iface:n}:null}static async _processStore(e,t,n){const r=t.name;let i=t.id;const s=t.originalId,o=t.type.model;null==i&&(i=`${e._id}store${e._stores.length}`);let a=t.tags;null==a&&(a=[]);const c=[];if(t.claim&&t.claim.tags.forEach(e=>c.push(new St(!1,e))),"storage"===t.origin)return e.newStorageStub(o,r,i,t.source,a,s,c,t.description,t.version);let l,h,u;if("file"===t.origin){if(!n)throw new is(t.location,"No loader available for file");t.source=n.join(e.fileName,t.source),l=await n.loadResource(t.source)}else if("resource"===t.origin&&(h=t.source,null==(l=e.resources[h])))throw new is(t.location,`Resource '${h}' referenced by store '${i}' is not defined in this manifest`);try{u=JSON.parse(l)}catch(e){throw new is(t.location,`Error parsing JSON from '${h}' (${e.message})'`)}let d,p=null,f=!0;if(o instanceof it?p=o.collectionType:o instanceof st?p=o.bigCollectionType:0===u.length?f=!1:(u=u.slice(u.length-1),p=o),p&&p instanceof nt){let n=!1;if(u=u.map(t=>{if(null==t)return null;n=n||t.$id;const r=t.$id||e.generateID().toString();return delete t.$id,{id:r,rawData:t}}),!t.id&&!n){i=`${i}:${await dn(JSON.stringify(u.map(e=>e.rawData)))}`}}if(u.length>0&&u[0].rawData&&u[0].rawData.storageKey){let t=u[0].rawData.storageKey;t=e.findStoreByName(t).storageKey,u=u.map(({id:e,rawData:n})=>({id:e,storageKey:t}))}else u.length>0&&(f=!1);d=o instanceof it?u.map(e=>({id:e.id,value:e,keys:new Set([e.id])})):o instanceof st?u.map(e=>{const t=e.rawData.$index;return delete e.rawData.$index,{id:e.id,index:t,value:e,keys:new Set([e.id])}}):u.map(e=>({id:e.id,value:e}));const m=t.version||0,g=e.storageProviderFactory._storageForKey("volatile").constructKey("volatile");return e.newStorageStub(o,r,i,g,a,s,c,t.description,m,t.source,f,d)}_newRecipe(e){const t=new Mn(e);return this._recipes.push(t),t}toString(e={}){const t=[];return this._imports.forEach(n=>{if(e.recursive){t.push(`// import '${n.fileName}'`);n.toString(e);t.push(`${n.toString(e)}`)}else t.push(`import '${n.fileName}'`)}),Object.values(this._schemas).forEach(e=>{t.push(e.toManifestString())}),Object.values(this._particles).forEach(e=>{t.push(e.toString())}),this._recipes.forEach(n=>{t.push(n.toString(e))}),[...this.stores].sort(_n).forEach(e=>{t.push(e.toString(this.storeTags.get(e).map(e=>`#${e}`)))}),t.join("\n")}get idGeneratorForTesting(){return this._idGenerator}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const cs=i()(process.argv.slice(2),{string:["output"],boolean:["verbose","help"],alias:{o:"output",v:"verbose"},default:{output:"bundle.zip",verbose:!1}});(cs.help||0===cs._.length)&&(console.log("Usage\n  $ bundle [-options] [file ...]\n\nDescription\n  Creates a zip bundle containing all transitive dependencies of an Arcs manifest.\n\nOptions\n  --output, -o   name of the created bundle, bundle.zip by default\n  --verbose, -v  list bundled files\n  --help         usage info\n\nExamples\n  $ bundle Feature.arcs\n  $ bundle -v -o mybundle.zip recipes/Feature.arcs recipes/ExtraStuff.arcs"),process.exit()),Array.isArray(cs.output)&&(console.error("Only one output path can be specified"),process.exit(1)),async function(e,t,n){const r=await async function(...e){e=e.map(e=>c.a.isAbsolute(e)?e:c.a.resolve(process.cwd(),e).split(c.a.sep).join("/"));const t=new on,n=await Promise.all(e.map(e=>as.load(e,t))),r=new Set;n.forEach(e=>(function e(t,n){if(!t.fileName)throw new Error("Missing filename");n.add(t.fileName);for(const e of t.particles)n.add(e.implFile);for(const e of t.stores)e.source&&n.add(e.source);for(const r of t.imports)e(r,n)})(e,r));const i=[...r].sort(),s=function(e){const t=e[0],n=e[e.length-1];let r=0;for(let e=0;e<Math.min(t.length,n.length)&&t[e]===n[e];e++)"/"===t[e]&&(r=e+1);return r}(i),o=n.map(e=>e.fileName);return i.map(e=>({filePath:e,bundlePath:e.substr(s),entryPoint:o.includes(e)}))}(...e);if(r.some(e=>"__bundle_entry.arcs"===e.bundlePath))throw new Error("Error: Top-level '__bundle_entry.arcs' file found. Please remove it.");return n&&(console.log("Bundled files:"),r.forEach(e=>console.log(e.filePath))),new Promise(e=>{const n=c.a.dirname(t);o.a.existsSync(n)||o.a.mkdirSync(n,{recursive:!0});const i=new h.a;for(const e of r)i.file(e.bundlePath,o.a.readFileSync(e.filePath),{createFolders:!1});i.file("__bundle_entry.arcs",r.filter(e=>e.entryPoint).map(e=>`import '${e.bundlePath}'\n`).join("")),i.generateNodeStream().pipe(o.a.createWriteStream(t)).on("finish",()=>e())})}(cs._,cs.output,cs.verbose).catch(e=>{console.error(e.message),process.exit(1)})}]);