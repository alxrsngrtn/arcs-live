!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}([function(e,t,n){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};n.d(t,"a",function(){return i}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return S}),n.d(t,"d",function(){return H}),n.d(t,"e",function(){return s}),n.d(t,"f",function(){return o}),n.d(t,"g",function(){return c}),n.d(t,"h",function(){return l}),n.d(t,"i",function(){return N}),n.d(t,"j",function(){return O}),n.d(t,"k",function(){return z}),n.d(t,"l",function(){return u}),n.d(t,"m",function(){return d}),n.d(t,"n",function(){return K}),n.d(t,"o",function(){return B}),n.d(t,"p",function(){return j}),n.d(t,"q",function(){return F}),n.d(t,"r",function(){return P}),n.d(t,"s",function(){return L}),n.d(t,"t",function(){return D}),n.d(t,"u",function(){return $}),n.d(t,"v",function(){return R}),n.d(t,"w",function(){return g}),n.d(t,"x",function(){return A}),n.d(t,"y",function(){return m}),n.d(t,"z",function(){return y}),n.d(t,"A",function(){return v}),n.d(t,"B",function(){return _}),n.d(t,"C",function(){return x}),n.d(t,"D",function(){return E}),n.d(t,"E",function(){return M}),n.d(t,"F",function(){return p}),n.d(t,"G",function(){return U}),n.d(t,"H",function(){return I}),n.d(t,"I",function(){return Y}),n.d(t,"J",function(){return Z}),n.d(t,"K",function(){return k}),n.d(t,"L",function(){return V}),n.d(t,"M",function(){return Q}),n.d(t,"N",function(){return G});
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var s=e[i],o=i+1<e.length,a=o?e[i+1]:0,c=i+2<e.length,l=c?e[i+2]:0,h=s>>2,u=(3&s)<<4|a>>4,d=(15&a)<<2|l>>6,p=63&l;c||(p=64,o||(d=64)),r.push(n[h],n[u],n[d],n[p])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){var o=((7&i)<<18|(63&(s=e[n++]))<<12|(63&(a=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{s=e[n++];var a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var s=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,c=++i<e.length?n[e.charAt(i)]:64;if(++i,null==s||null==o||null==a||null==c)throw Error();var l=s<<2|o>>4;if(r.push(l),64!=a){var h=o<<4&240|a>>2;if(r.push(h),64!=c){var u=a<<6&192|c;r.push(u)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},l=function(e){var t=a(e);return c.encodeByteArray(t,!0)},h=function(e){try{return c.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function u(e){return d(void 0,e)}function d(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&(e[n]=d(e[n],t[n]));return e}function p(e,t,n){e[t]=n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var f=function(){function e(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch(function(){}),1===e.length?e(n):e(n,r))}},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function y(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function g(){return"object"==typeof self&&self.self===self}function _(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function v(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var b="FirebaseError",w=function(e){function t(n,r){var i=e.call(this,r)||this;return i.code=n,i.name=b,Object.setPrototypeOf(i,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,S.prototype.create),i}return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error),S=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=t[0]||{},i=this.service+"/"+e,s=this.errors[e],o=s?function(e,t){return e.replace(C,function(e,n){var r=t[n];return null!=r?r.toString():"<"+n+"?>"})}(s,r):"Error",a=this.serviceName+": "+o+" ("+i+").",c=new w(i,a),l=0,h=Object.keys(r);l<h.length;l++){var u=h[l];"_"!==u.slice(-1)&&(u in c&&console.warn('Overwriting FirebaseError base field "'+u+'" can cause unexpected behavior.'),c[u]=r[u])}return c},e}();var C=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E(e){return JSON.parse(e)}function k(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var T=function(e){var t={},n={},r={},i="";try{var s=e.split(".");t=E(h(s[0])||""),n=E(h(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},x=function(e){var t=T(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},R=function(e){var t=T(e).claims;return"object"==typeof t&&!0===t.admin},O=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},I=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},P=function(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])},N=function(e){return t={},P(e,function(e,n){t[e]=n}),t;var t},A=function(e){for(var t in e)return!1;return!0},D=function(e){var t=0;for(var n in e)t++;return t},M=function(e,t,n){var r={};for(var i in e)r[i]=t.call(n,e[i],i,e);return r},j=function(e,t,n){for(var r in e)if(t.call(n,e[r],r,e))return r},F=function(e,t,n){var r=j(e,t,n);return r&&e[r]},L=function(e){for(var t in e)return t},$=function(e){var t=[],n=0;for(var r in e)t[n++]=e[r];return t},B=function(e,t){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&!t(n,e[n]))return!1;return!0},U=function(e){var t=[];return P(e,function(e,n){Array.isArray(n)?n.forEach(function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}),t.length?"&"+t.join("&"):""},H=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var s,o,a=this.chain_[0],c=this.chain_[1],l=this.chain_[2],h=this.chain_[3],u=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(s=h^c&(l^h),o=1518500249):(s=c^l^h,o=1859775393):r<60?(s=c&l|h&(c|l),o=2400959708):(s=c^l^h,o=3395469782);i=(a<<5|a>>>27)+s+u+o+n[r]&4294967295;u=h,h=l,l=4294967295&(c<<30|c>>>2),c=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;r<t;){if(0==s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++r,++s==this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++r,++s==this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},e}();function z(e,t){var n=new q(e,t);return n.subscribe.bind(n)}var q=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}return e.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},e.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},e.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=W),void 0===r.error&&(r.error=W),void 0===r.complete&&(r.complete=W);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),s},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},e}();function W(){}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var V=function(e,t,n,r){var i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function K(e,t,n){var r="";switch(t){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";return i+=r+" argument "}function Q(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(K(e,t,r)+"must be a valid function.")}function G(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(K(e,t,r)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Z=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;s(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},Y=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t}},function(e,t,n){"use strict";var r=n(6),i=n(33),s=n(20),o=n(64),a=n(14);function c(e){return e}function l(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}t.newBlob=function(e,n){t.checkSupport("blob");try{return new Blob([e],{type:n})}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(e),r.getBlob(n)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(e,t,n){var r=[],i=0,s=e.length;if(s<=n)return String.fromCharCode.apply(null,e);for(;i<s;)"array"===t||"nodebuffer"===t?r.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,s)))):r.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,s)))),i+=n;return r.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var n=65536,r=t.getTypeOf(e),i=!0;if("uint8array"===r?i=h.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=h.applyCanBeUsed.nodebuffer),i)for(;n>1;)try{return h.stringifyByChunk(e,r,n)}catch(e){n=Math.floor(n/2)}return h.stringifyByChar(e)}function d(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}t.applyFromCharCode=u;var p={};p.string={string:c,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,s.allocBuffer(e.length))}},p.array={string:u,array:c,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},p.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:c,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},p.uint8array={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:c,nodebuffer:function(e){return s.newBufferFrom(e)}},p.nodebuffer={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:c},t.transformTo=function(e,n){if(n||(n=""),!e)return n;t.checkSupport(e);var r=t.getTypeOf(n);return p[r][e](n)},t.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":r.nodebuffer&&s.isBuffer(e)?"nodebuffer":r.uint8array&&e instanceof Uint8Array?"uint8array":r.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},t.checkSupport=function(e){if(!r[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)r+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return r},t.delay=function(e,t,n){o(function(){e.apply(n||null,t||[])})},t.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},t.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},t.prepareContent=function(e,n,s,o,c){return a.Promise.resolve(n).then(function(e){return r.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise(function(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.error)},r.readAsArrayBuffer(e)}):e}).then(function(n){var h,u=t.getTypeOf(n);return u?("arraybuffer"===u?n=t.transformTo("uint8array",n):"string"===u&&(c?n=i.decode(n):s&&!0!==o&&(n=l(h=n,r.uint8array?new Uint8Array(h.length):new Array(h.length)))),n):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return s}),n.d(t,"c",function(){return o});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}c((r=r.apply(e,t||[])).next())})}function o(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}},function(e,t,n){"use strict";function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},e.exports=r},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var i,s=n(0),o=n(15),a=((i={})["no-app"]="No Firebase App '{$name}' has been created - call Firebase App.initializeApp()",i["bad-app-name"]="Illegal App name: '{$name}",i["duplicate-app"]="Firebase App named '{$name}' already exists",i["app-deleted"]="Firebase App named '{$name}' already deleted",i["duplicate-service"]="Firebase service named '{$name}' already registered",i["invalid-app-argument"]="firebase.{$name}() takes either no argument or a Firebase App instance.",i),c=new s.c("app","Firebase",a),l="[DEFAULT]",h=[],u=function(){function e(e,t,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=Object(s.l)(e),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(e){h.push(e),setTimeout(function(){return e(null)},0)},removeAuthTokenListener:function(e){h=h.filter(function(t){return t!==e})}}}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise(function(t){e.checkDestroyed_(),t()}).then(function(){e.firebase_.INTERNAL.removeApp(e.name_);for(var t=[],n=0,r=Object.keys(e.services_);n<r.length;n++)for(var i=r[n],s=0,o=Object.keys(e.services_[i]);s<o.length;s++){var a=o[s];t.push(e.services_[i][a])}return Promise.all(t.map(function(e){return e.INTERNAL.delete()}))}).then(function(){e.isDeleted_=!0,e.services_={}})},e.prototype._getService=function(e,t){if(void 0===t&&(t=l),this.checkDestroyed_(),this.services_[e]||(this.services_[e]={}),!this.services_[e][t]){var n=t!==l?t:void 0,r=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),n);this.services_[e][t]=r}return this.services_[e][t]},e.prototype.extendApp=function(e){var t=this;Object(s.m)(this,e),e.INTERNAL&&e.INTERNAL.addAuthTokenListener&&(h.forEach(function(e){t.INTERNAL.addAuthTokenListener(e)}),h=[])},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw c.create("app-deleted",{name:this.name_})},e}();u.prototype.name&&u.prototype.options||u.prototype.delete||console.log("dc");var d="6.0.4";
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var f=new o.b("@firebase/app");if(Object(s.w)()&&"firebase"in self){f.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var m=self.firebase.SDK_VERSION;m&&m.indexOf("LITE")>=0&&f.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var y=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function e(){var t=function(e){var t={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){if(void 0===r&&(r={}),"object"!=typeof r||null===r){var s=r;r={name:s}}var o=r;void 0===o.name&&(o.name=l);var a=o.name;if("string"!=typeof a||!a)throw c.create("bad-app-name",{name:String(a)});if(p(t,a))throw c.create("duplicate-app",{name:a});var u=new e(n,o,i);return t[a]=u,h(u,"create"),u},app:o,apps:null,SDK_VERSION:d,INTERNAL:{registerService:function(t,l,h,u,d){if(void 0===d&&(d=!1),n[t])throw c.create("duplicate-service",{name:t});function p(e){if(void 0===e&&(e=o()),"function"!=typeof e[t])throw c.create("invalid-app-argument",{name:t});return e[t]()}return n[t]=l,u&&(r[t]=u,a().forEach(function(e){u("create",e)})),void 0!==h&&Object(s.m)(p,h),i[t]=p,e.prototype[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,t).apply(this,d?e:[])},p},removeApp:function(e){h(t[e],"delete"),delete t[e]},factories:n,useAsService:u}};function o(e){if(!p(t,e=e||l))throw c.create("no-app",{name:e});return t[e]}function a(){return Object.keys(t).map(function(e){return t[e]})}function h(e,t){for(var i=0,s=Object.keys(n);i<s.length;i++){var o=u(0,s[i]);if(null===o)return;r[o]&&r[o](t,e)}}function u(e,t){return"serverAuth"===t?null:t}return Object(s.F)(i,"default",i),Object.defineProperty(i,"apps",{get:a}),Object(s.F)(o,"App",e),i}(u);return t.INTERNAL=r({},t.INTERNAL,{createFirebaseNamespace:e,extendNamespace:function(e){Object(s.m)(t,e)},createSubscribe:s.k,ErrorFactory:s.c,deepExtend:s.m}),t}(),g=y.initializeApp;y.initializeApp=function(){return Object(s.z)()&&f.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and set "module"\n      to false and "main" to true:\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),g.apply(void 0,arguments)};var _=y;t.a=_},function(e,t,n){"use strict";if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,t.nodebuffer="undefined"!=typeof Buffer,t.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)t.blob=!1;else{var r=new ArrayBuffer(0);try{t.blob=0===new Blob([r],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(r),t.blob=0===i.getBlob("application/zip").size}catch(e){t.blob=!1}}}try{t.nodestream=!!n(26).Readable}catch(e){t.nodestream=!1}},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){var t,n,r,i,s,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)s=e[t],o.set(s,i),i+=s.length;return o}},o={arraySet:function(e,t,n,r,i){for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";for(var r=n(1),i=n(6),s=n(20),o=n(3),a=new Array(256),c=0;c<256;c++)a[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;a[254]=a[254]=1;function l(){o.call(this,"utf-8 decode"),this.leftOver=null}function h(){o.call(this,"utf-8 encode")}t.utf8encode=function(e){return i.nodebuffer?s.newBufferFrom(e,"utf-8"):function(e){var t,n,r,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=i.uint8array?new Uint8Array(c):new Array(c),o=0,s=0;o<c;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t}(e)},t.utf8decode=function(e){return i.nodebuffer?r.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,i,s,o=e.length,c=new Array(2*o);for(n=0,t=0;t<o;)if((i=e[t++])<128)c[n++]=i;else if((s=a[i])>4)c[n++]=65533,t+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&t<o;)i=i<<6|63&e[t++],s--;s>1?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return c.length!==n&&(c.subarray?c=c.subarray(0,n):c.length=n),r.applyFromCharCode(c)}(e=r.transformTo(i.uint8array?"uint8array":"array",e))},r.inherits(l,o),l.prototype.processChunk=function(e){var n=r.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var s=n;(n=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),n.set(s,this.leftOver.length)}else n=this.leftOver.concat(n);this.leftOver=null}var o=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+a[e[n]]>t?n:t}(n),c=n;o!==n.length&&(i.uint8array?(c=n.subarray(0,o),this.leftOver=n.subarray(o,n.length)):(c=n.slice(0,o),this.leftOver=n.slice(o,n.length))),this.push({data:t.utf8decode(c),meta:e.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=l,r.inherits(h,o),h.prototype.processChunk=function(e){this.push({data:t.utf8encode(e.data),meta:e.meta})},t.Utf8EncodeWorker=h},function(e,t,n){"use strict";var r=n(17),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=u;var s=n(12);s.inherits=n(13);var o=n(27),a=n(30);s.inherits(u,o);for(var c=i(a.prototype),l=0;l<c.length;l++){var h=c[l];u.prototype[h]||(u.prototype[h]=a.prototype[h])}function u(e){if(!(this instanceof u))return new u(e);o.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),u.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){e.exports=require("zlib")},function(e,t){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=Buffer.isBuffer},function(e,t,n){try{var r=n(19);if("function"!=typeof r.inherits)throw"";e.exports=r.inherits}catch(t){e.exports=n(60)}},function(e,t,n){"use strict";var r=null;r="undefined"!=typeof Promise?Promise:n(65),e.exports={Promise:r}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var r,i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));var s=r.INFO,o=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(t<e.logLevel)){var s=(new Date).toISOString();switch(t){case r.DEBUG:case r.VERBOSE:console.log.apply(console,["["+s+"]  "+e.name+":"].concat(n));break;case r.INFO:console.info.apply(console,["["+s+"]  "+e.name+":"].concat(n));break;case r.WARN:console.warn.apply(console,["["+s+"]  "+e.name+":"].concat(n));break;case r.ERROR:console.error.apply(console,["["+s+"]  "+e.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}}},a=function(){function e(e){this.name=e,this._logLevel=s,this._logHandler=o,i.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in r))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!0,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.DEBUG].concat(e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.VERBOSE].concat(e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.INFO].concat(e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.WARN].concat(e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,r.ERROR].concat(e))},e}()},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,s,o=arguments.length;switch(o){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,n)});case 4:return process.nextTick(function(){e.call(null,t,n,r)});default:for(i=new Array(o-1),s=0;s<i.length;)i[s++]=arguments[s];return process.nextTick(function(){e.apply(null,i)})}}}:e.exports=process},function(e,t,n){var r=n(59),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=o),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},function(e,t){e.exports=require("url")},function(e,t,n){"use strict";var r=n(14),i=n(36),s=n(37),o=n(38);s=n(37);function a(e,t,n,r,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=r,this.compressedContent=i}a.prototype={getContentWorker:function(){var e=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,n){return e.pipe(new o).pipe(new s("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},e.exports=a},function(e,t,n){"use strict";var r=n(1);var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t){return void 0!==e&&e.length?"string"!==r.getTypeOf(e)?function(e,t,n,r){var s=i,o=r+n;e^=-1;for(var a=r;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,n,r){var s=i,o=r+n;e^=-1;for(var a=r;a<o;a++)e=e>>>8^s[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t){e.exports=require("http")},function(e,t,n){var r=n(4);"disable"===process.env.READABLE_STREAM&&r?(e.exports=r,(t=e.exports=r.Readable).Readable=r.Readable,t.Writable=r.Writable,t.Duplex=r.Duplex,t.Transform=r.Transform,t.PassThrough=r.PassThrough,t.Stream=r):((t=e.exports=n(27)).Stream=r||t,t.Readable=t,t.Writable=n(30),t.Duplex=n(10),t.Transform=n(32),t.PassThrough=n(63))},function(e,t,n){"use strict";var r=n(17);e.exports=_;var i,s=n(57);_.ReadableState=g;n(58).EventEmitter;var o=function(e,t){return e.listeners(t).length},a=n(28),c=n(18).Buffer,l=global.Uint8Array||function(){};var h=n(12);h.inherits=n(13);var u=n(19),d=void 0;d=u&&u.debuglog?u.debuglog("stream"):function(){};var p,f=n(61),m=n(29);h.inherits(_,a);var y=["error","close","destroy","pause","resume"];function g(e,t){e=e||{};var r=t instanceof(i=i||n(10));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var s=e.highWaterMark,o=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:r&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(31).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function _(e){if(i=i||n(10),!(this instanceof _))return new _(e);this._readableState=new g(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function v(e,t,n,r,i){var s,o=e._readableState;null===t?(o.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,C(e)}(e,o)):(i||(s=function(e,t){var n;r=t,c.isBuffer(r)||r instanceof l||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(o,t)),s?e.emit("error",s):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):b(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?b(e,o,t,!1):k(e,o)):b(e,o,t,!1))):r||(o.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function b(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&C(e)),k(e,t)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=m.destroy,_.prototype._undestroy=m.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),n=!0),v(this,e,t,!1,n)},_.prototype.unshift=function(e){return v(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return p||(p=n(31).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var w=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=w?e=w:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function C(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(E,e):E(e))}function E(e){d("emit readable"),e.emit("readable"),O(e)}function k(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(T,e,t))}function T(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(d("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function x(e){d("readable nexttick read 0"),e.read(0)}function R(e,t){t.reading||(d("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),O(e),t.flowing&&!t.reading&&e.read(0)}function O(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function I(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;e-=i.length;for(;n=n.next;){var s=n.data,o=e>s.length?s.length:e;if(o===s.length?i+=s:i+=s.slice(0,e),0===(e-=o)){o===s.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=c.allocUnsafe(e),r=t.head,i=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var s=r.data,o=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,o),0===(e-=o)){o===s.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(o));break}++i}return t.length-=i,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function P(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(N,t,e))}function N(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function A(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}_.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?P(this):C(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&P(this),null;var r,i=t.needReadable;return d("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",i=!0),t.ended||t.reading?d("reading or ended",i=!1):i&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(n,t))),null===(r=e>0?I(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&P(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,d("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?l:_;function c(t,r){d("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,d("cleanup"),e.removeListener("close",y),e.removeListener("finish",g),e.removeListener("drain",h),e.removeListener("error",m),e.removeListener("unpipe",c),n.removeListener("end",l),n.removeListener("end",_),n.removeListener("data",f),u=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function l(){d("onend"),e.end()}i.endEmitted?r.nextTick(a):n.once("end",a),e.on("unpipe",c);var h=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,O(e))}}(n);e.on("drain",h);var u=!1;var p=!1;function f(t){d("ondata"),p=!1,!1!==e.write(t)||p||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==A(i.pipes,e))&&!u&&(d("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function m(t){d("onerror",t),_(),e.removeListener("error",m),0===o(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",g),_()}function g(){d("onfinish"),e.removeListener("close",y),_()}function _(){d("unpipe"),n.unpipe(e)}return n.on("data",f),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",m),e.once("close",y),e.once("finish",g),e.emit("pipe",n),i.flowing||(d("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)r[s].emit("unpipe",this,n);return this}var o=A(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},_.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&C(this):r.nextTick(x,this))}return n},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(R,e,t))}(this,e)),this},_.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(d("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){(d("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<y.length;s++)e.on(y[s],this.emit.bind(this,y[s]));return this._read=function(t){d("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=I},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";var r=n(17);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";var r=n(17);function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var s,o=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:r.nextTick;y.WritableState=m;var a=n(12);a.inherits=n(13);var c={deprecate:n(62)},l=n(28),h=n(18).Buffer,u=global.Uint8Array||function(){};var d,p=n(29);function f(){}function m(e,t){s=s||n(10),e=e||{};var a=t instanceof s;this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var c=e.highWaterMark,l=e.writableHighWaterMark,h=this.objectMode?16:16384;this.highWaterMark=c||0===c?c:a&&(l||0===l)?l:h,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,s=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,s){--t.pendingcb,n?(r.nextTick(s,i),r.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(s(i),e._writableState.errorEmitted=!0,e.emit("error",i),S(e,t))}(e,n,i,t,s);else{var a=b(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||v(e,n),i?o(_,e,n,a,s):_(e,n,a,s)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function y(e){if(s=s||n(10),!(d.call(y,this)||this instanceof s))return new y(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function g(e,t,n,r,i,s,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function _(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),S(e,t)}function v(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,s=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)s[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;s.allBuffers=c,g(e,t,!0,t.length,s,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,h=n.encoding,u=n.callback;if(g(e,t,!1,t.objectMode?1:l.length,l,h,u),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function b(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function w(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)})}function S(e,t){var n=b(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,r.nextTick(w,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}a.inherits(y,l),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:c.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!d.call(this,e)||this===y&&(e&&e._writableState instanceof m)}})):d=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var i,s=this._writableState,o=!1,a=!s.objectMode&&(i=e,h.isBuffer(i)||i instanceof u);return a&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof n&&(n=f),s.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),r.nextTick(t,n)}(this,n):(a||function(e,t,n,i){var s=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),r.nextTick(i,o),s=!1),s}(this,s,e,n))&&(s.pendingcb++,o=function(e,t,n,r,i,s){if(!n){var o=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,n));return t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:s,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else g(e,t,!1,a,r,i,s);return c}(this,s,a,e,t,n)),o},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||v(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=p.destroy,y.prototype._undestroy=p.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}},function(e,t,n){"use strict";var r=n(18).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=h,this.end=u,t=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function h(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},s.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=o(t[r]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if((i=o(t[r]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if((i=o(t[r]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=o;var r=n(10),i=n(12);function s(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){c(e,t,n)}):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(13),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){"use strict";var r=n(1),i=n(6),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.encode=function(e){for(var t,n,i,o,a,c,l,h=[],u=0,d=e.length,p=d,f="string"!==r.getTypeOf(e);u<e.length;)p=d-u,f?(t=e[u++],n=u<d?e[u++]:0,i=u<d?e[u++]:0):(t=e.charCodeAt(u++),n=u<d?e.charCodeAt(u++):0,i=u<d?e.charCodeAt(u++):0),o=t>>2,a=(3&t)<<4|n>>4,c=p>1?(15&n)<<2|i>>6:64,l=p>2?63&i:64,h.push(s.charAt(o)+s.charAt(a)+s.charAt(c)+s.charAt(l));return h.join("")},t.decode=function(e){var t,n,r,o,a,c,l=0,h=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var u,d=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&d--,e.charAt(e.length-2)===s.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(u=i.uint8array?new Uint8Array(0|d):new Array(0|d);l<e.length;)t=s.indexOf(e.charAt(l++))<<2|(o=s.indexOf(e.charAt(l++)))>>4,n=(15&o)<<4|(a=s.indexOf(e.charAt(l++)))>>2,r=(3&a)<<6|(c=s.indexOf(e.charAt(l++))),u[h++]=t,64!==a&&(u[h++]=n),64!==c&&(u[h++]=r);return u}},function(e,t,n){"use strict";var r=n(1),i=n(67),s=n(3),o=n(33),a=n(6),c=n(14),l=null;if(a.nodestream)try{l=n(68)}catch(e){}function h(e,t){return new c.Promise(function(n,i){var s=[],a=e._internalType,c=e._outputType,l=e._mimeType;e.on("data",function(e,n){s.push(e),t&&t(n)}).on("error",function(e){s=[],i(e)}).on("end",function(){try{var e=function(e,t,n){switch(e){case"blob":return r.newBlob(r.transformTo("arraybuffer",t),n);case"base64":return o.encode(t);default:return r.transformTo(e,t)}}(c,function(e,t){var n,r=0,i=null,s=0;for(n=0;n<t.length;n++)s+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(s),n=0;n<t.length;n++)i.set(t[n],r),r+=t[n].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(a,s),l);n(e)}catch(e){i(e)}s=[]}).resume()})}function u(e,t,n){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=n,r.checkSupport(o),this._worker=e.pipe(new i(o)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return h(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,function(e){t.call(n,e.data,e.meta)}):this._worker.on(e,function(){r.delay(t,arguments,n)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(r.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},e)}},e.exports=u},function(e,t,n){"use strict";t.base64=!1,t.binary=!1,t.dir=!1,t.createFolders=!0,t.date=null,t.compression=null,t.compressionOptions=null,t.comment=null,t.unixPermissions=null,t.dosPermissions=null},function(e,t,n){"use strict";var r=n(1),i=n(3);function s(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}r.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},function(e,t,n){"use strict";var r=n(1),i=n(3);function s(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}r.inherits(s,i),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},e.exports=s},function(e,t,n){"use strict";var r=n(3),i=n(23);function s(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n(1).inherits(s,r),s.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},e.exports=s},function(e,t,n){"use strict";var r=n(3);t.STORE={magic:"\0\0",compressWorker:function(e){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},t.DEFLATE=n(71)},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,s=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{s=s+(i=i+t[r++]|0)|0}while(--o);i%=65521,s%=65521}return i|s<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var s=r,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},function(e,t,n){"use strict";var r=n(7),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var o=new r.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,t.string2buf=function(e){var t,n,i,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(c),o=0,s=0;o<c;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,s,a=t||e.length,l=new Array(2*a);for(r=0,n=0;n<a;)if((i=e[n++])<128)l[r++]=i;else if((s=o[i])>4)l[r++]=65533,n+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&n<a;)i=i<<6|63&e[n++],s--;s>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return c(l,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+o[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";t.LOCAL_FILE_HEADER="PK",t.CENTRAL_FILE_HEADER="PK",t.CENTRAL_DIRECTORY_END="PK",t.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",t.ZIP64_CENTRAL_DIRECTORY_END="PK",t.DATA_DESCRIPTOR="PK\b"},function(e,t,n){"use strict";var r=n(1),i=n(6),s=n(47),o=n(85),a=n(86),c=n(49);e.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new a(e):i.uint8array?new c(r.transformTo("uint8array",e)):new s(r.transformTo("array",e)):new o(e)}},function(e,t,n){"use strict";var r=n(48);function i(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}n(1).inherits(i,r),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;s>=0;--s)if(this.data[s]===t&&this.data[s+1]===n&&this.data[s+2]===r&&this.data[s+3]===i)return s-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&n===s[1]&&r===s[2]&&i===s[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(1);function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},e.exports=i},function(e,t,n){"use strict";var r=n(47);function i(e){r.call(this,e)}n(1).inherits(i,r),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("vm")},function(e,t){function n(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}e.exports=function(e,t){t||(t={});var r={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(r.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?r.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(e){r.bools[e]=!0});var i={};Object.keys(t.alias||{}).forEach(function(e){i[e]=[].concat(t.alias[e]),i[e].forEach(function(t){i[t]=[e].concat(i[e].filter(function(e){return t!==e}))})}),[].concat(t.string).filter(Boolean).forEach(function(e){r.strings[e]=!0,i[e]&&(r.strings[i[e]]=!0)});var s=t.default||{},o={_:[]};Object.keys(r.bools).forEach(function(e){c(e,void 0!==s[e]&&s[e])});var a=[];function c(e,t,s){if(!s||!r.unknownFn||function(e,t){return r.allBools&&/^--[^=]+$/.test(t)||r.strings[e]||r.bools[e]||i[e]}(e,s)||!1!==r.unknownFn(s)){var a=!r.strings[e]&&n(t)?Number(t):t;l(o,e.split("."),a),(i[e]||[]).forEach(function(e){l(o,e.split("."),a)})}}function l(e,t,n){var i=e;t.slice(0,-1).forEach(function(e){void 0===i[e]&&(i[e]={}),i=i[e]});var s=t[t.length-1];void 0===i[s]||r.bools[s]||"boolean"==typeof i[s]?i[s]=n:Array.isArray(i[s])?i[s].push(n):i[s]=[i[s],n]}function h(e){return i[e].some(function(e){return r.bools[e]})}-1!==e.indexOf("--")&&(a=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var u=0;u<e.length;u++){var d=e[u];if(/^--.+=/.test(d)){var p=d.match(/^--([^=]+)=([\s\S]*)$/),f=p[1],m=p[2];r.bools[f]&&(m="false"!==m),c(f,m,d)}else if(/^--no-.+/.test(d)){c(f=d.match(/^--no-(.+)/)[1],!1,d)}else if(/^--.+/.test(d)){f=d.match(/^--(.+)/)[1];void 0===(v=e[u+1])||/^-/.test(v)||r.bools[f]||r.allBools||i[f]&&h(f)?/^(true|false)$/.test(v)?(c(f,"true"===v,d),u++):c(f,!r.strings[f]||"",d):(c(f,v,d),u++)}else if(/^-[^-]+/.test(d)){for(var y=d.slice(1,-1).split(""),g=!1,_=0;_<y.length;_++){var v;if("-"!==(v=d.slice(_+2))){if(/[A-Za-z]/.test(y[_])&&/=/.test(v)){c(y[_],v.split("=")[1],d),g=!0;break}if(/[A-Za-z]/.test(y[_])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(v)){c(y[_],v,d),g=!0;break}if(y[_+1]&&y[_+1].match(/\W/)){c(y[_],d.slice(_+2),d),g=!0;break}c(y[_],!r.strings[y[_]]||"",d)}else c(y[_],v,d)}f=d.slice(-1)[0];g||"-"===f||(!e[u+1]||/^(-|--)[^-]/.test(e[u+1])||r.bools[f]||i[f]&&h(f)?e[u+1]&&/true|false/.test(e[u+1])?(c(f,"true"===e[u+1],d),u++):c(f,!r.strings[f]||"",d):(c(f,e[u+1],d),u++))}else if(r.unknownFn&&!1===r.unknownFn(d)||o._.push(r.strings._||!n(d)?d:Number(d)),t.stopEarly){o._.push.apply(o._,e.slice(u+1));break}}return Object.keys(s).forEach(function(e){var t,n,r;t=o,n=e.split("."),r=t,n.slice(0,-1).forEach(function(e){r=r[e]||{}}),n[n.length-1]in r||(l(o,e.split("."),s[e]),(i[e]||[]).forEach(function(t){l(o,t.split("."),s[e])}))}),t["--"]?(o["--"]=new Array,a.forEach(function(e){o["--"].push(e)})):a.forEach(function(e){o._.push(e)}),o}},function(e,t,n){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}r.prototype=n(56),r.prototype.loadAsync=n(83),r.support=n(6),r.defaults=n(35),r.version="3.2.0",r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=n(14),e.exports=r},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var r=n(9),i=n(1),s=n(3),o=n(34),a=n(35),c=n(22),l=n(69),h=n(70),u=n(20),d=n(82),p=function(e,t,n){var r,o=i.getTypeOf(t),h=i.extend(n||{},a);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(e=m(e)),h.createFolders&&(r=f(e))&&y.call(this,r,!0);var p="string"===o&&!1===h.binary&&!1===h.base64;n&&void 0!==n.binary||(h.binary=!p),(t instanceof c&&0===t.uncompressedSize||h.dir||!t||0===t.length)&&(h.base64=!1,h.binary=!0,t="",h.compression="STORE",o="string");var g=null;g=t instanceof c||t instanceof s?t:u.isNode&&u.isStream(t)?new d(e,t):i.prepareContent(e,t,h.binary,h.optimizedBinaryString,h.base64);var _=new l(e,g,h);this.files[e]=_},f=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},y=function(e,t){return t=void 0!==t?t:a.createFolders,e=m(e),this.files[e]||p.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function g(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,r))},filter:function(e){var t=[];return this.forEach(function(n,r){e(n,r)&&t.push(r)}),t},file:function(e,t,n){if(1===arguments.length){if(g(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}var i=this.files[this.root+e];return i&&!i.dir?i:null}return e=this.root+e,p.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(g(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=y.call(this,t),r=this.clone();return r.root=n.name,r},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=i.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var a=n.comment||this.comment||"";t=h.generateWorker(this,n,a)}catch(e){(t=new s("error")).error(e)}return new o(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};e.exports=_},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("buffer")},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var r=n(18).Buffer,i=n(19);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i,s=r.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=s,i=a,t.copy(n,i),a+=o.data.length,o=o.next;return s},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t,n){e.exports=n(19).deprecate},function(e,t,n){"use strict";e.exports=s;var r=n(32),i=n(12);function s(e){if(!(this instanceof s))return new s(e);r.call(this,e)}i.inherits=n(13),i.inherits(s,r),s.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},function(e,t,n){"use strict";var r=n(66);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];if(!process.browser)var l=["UNHANDLED"];function h(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,process.browser||(this.handled=l),e!==i&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r(function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)})}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}var o=m(function(){t(i,r)});"error"===o.status&&r(o.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=h,h.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})},h.prototype.catch=function(e){return this.then(null,e)},h.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);(process.browser||this.handled===l&&(this.handled=null),this.state!==c)?d(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t));return n},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=m(p,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t,process.browser||e.handled===l&&r(function(){e.handled===l&&process.emit("unhandledRejection",t,e)});for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},h.resolve=function(e){if(e instanceof this)return e;return s.resolve(new this(i),e)},h.reject=function(e){var t=new this(i);return s.reject(t,e)},h.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=new Array(n),a=0,c=-1,l=new this(i);for(;++c<n;)h(e[c],c);return l;function h(e,i){t.resolve(e).then(function(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(l,o))},function(e){r||(r=!0,s.reject(l,e))})}},h.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=-1,a=new this(i);for(;++o<n;)c=e[o],t.resolve(c).then(function(e){r||(r=!0,s.resolve(a,e))},function(e){r||(r=!0,s.reject(a,e))});var c;return a}},function(e,t,n){"use strict";var r,i,s=global.MutationObserver||global.WebKitMutationObserver;if(process.browser)if(s){var o=0,a=new s(u),c=global.document.createTextNode("");a.observe(c,{characterData:!0}),r=function(){c.data=o=++o%2}}else if(global.setImmediate||void 0===global.MessageChannel)r="document"in global&&"onreadystatechange"in global.document.createElement("script")?function(){var e=global.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},global.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new global.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}else r=function(){process.nextTick(u)};var h=[];function u(){var e,t;i=!0;for(var n=h.length;n;){for(t=h,h=[],e=-1;++e<n;)t[e]();n=h.length}i=!1}e.exports=function(e){1!==h.push(e)||i||r()}},function(e,t,n){"use strict";var r=n(3),i=n(1);function s(e){r.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(s,r),s.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},e.exports=s},function(e,t,n){"use strict";var r=n(26).Readable;function i(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",function(e,t){i.push(e)||i._helper.pause(),n&&n(t)}).on("error",function(e){i.emit("error",e)}).on("end",function(){i.push(null)})}n(1).inherits(i,r),i.prototype._read=function(){this._helper.resume()},e.exports=i},function(e,t,n){"use strict";var r=n(34),i=n(36),s=n(9),o=n(22),a=n(3),c=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};c.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!i&&(t=t.pipe(new s.Utf8EncodeWorker)),!o&&i&&(t=t.pipe(new s.Utf8DecodeWorker))}catch(e){(t=new a("error")).error(e)}return new r(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new s.Utf8EncodeWorker)),o.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof a?this._data:new i(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<l.length;u++)c.prototype[l[u]]=h;e.exports=c},function(e,t,n){"use strict";var r=n(39),i=n(81);t.generateWorker=function(e,t,n){var s=new i(t.streamFiles,n,t.platform,t.encodeFileName),o=0;try{e.forEach(function(e,n){o++;var i=function(e,t){var n=e||t,i=r[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(n.options.compression,t.compression),a=n.options.compressionOptions||t.compressionOptions||{},c=n.dir,l=n.date;n._compressWorker(i,a).withStreamInfo("file",{name:e,dir:c,date:l,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(s)}),s.entriesCount=o}catch(e){s.error(e)}return s}},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=n(72),s=n(1),o=n(3),a=r?"uint8array":"array";function c(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}t.magic="\b\0",s.inherits(c,o),c.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(a,e.data),!1)},c.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},t.compressWorker=function(e){return new c("Deflate",e)},t.uncompressWorker=function(){return new c("Inflate",{})}},function(e,t,n){"use strict";var r={};(0,n(7).assign)(r,n(73),n(76),n(44)),e.exports=r},function(e,t,n){"use strict";var r=n(74),i=n(7),s=n(42),o=n(24),a=n(43),c=Object.prototype.toString,l=0,h=-1,u=0,d=8;function p(e){if(!(this instanceof p))return new p(e);this.options=i.assign({level:h,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==l)throw new Error(o[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var f;if(f="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=r.deflateSetDictionary(this.strm,f))!==l)throw new Error(o[n]);this._dict_set=!0}}function f(e,t){var n=new p(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}p.prototype.push=function(e,t){var n,o,a=this.strm,h=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=s.string2buf(e):"[object ArrayBuffer]"===c.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(h),a.next_out=0,a.avail_out=h),1!==(n=r.deflate(a,o))&&n!==l)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(s.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===o?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l):2!==o||(this.onEnd(l),a.avail_out=0,!0)},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=p,t.deflate=f,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,f(e,t)}},function(e,t,n){"use strict";var r,i=n(7),s=n(75),o=n(40),a=n(41),c=n(24),l=0,h=1,u=3,d=4,p=5,f=0,m=1,y=-2,g=-3,_=-5,v=-1,b=1,w=2,S=3,C=4,E=0,k=2,T=8,x=9,R=15,O=8,I=286,P=30,N=19,A=2*I+1,D=15,M=3,j=258,F=j+M+1,L=32,$=42,B=69,U=73,H=91,z=103,q=113,W=666,V=1,K=2,Q=3,G=4,Z=3;function Y(e,t){return e.msg=c[t],t}function X(e){return(e<<1)-(e>4?9:0)}function J(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function re(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t){var n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0,l=e.window,h=e.w_mask,u=e.prev,d=e.strstart+j,p=l[s+o-1],f=l[s+o];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(l[(n=t)+o]===f&&l[n+o-1]===p&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<d);if(r=j-(d-s),s=d-j,r>o){if(e.match_start=t,o=r,r>=a)break;p=l[s+o-1],f=l[s+o]}}}while((t=u[t&h])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead}function se(e){var t,n,r,s,c,l,h,u,d,p,f=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-F)){i.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=f?r-f:0}while(--n);t=n=f;do{r=e.prev[--t],e.prev[t]=r>=f?r-f:0}while(--n);s+=f}if(0===e.strm.avail_in)break;if(l=e.strm,h=e.window,u=e.strstart+e.lookahead,d=s,p=void 0,(p=l.avail_in)>d&&(p=d),n=0===p?0:(l.avail_in-=p,i.arraySet(h,l.input,l.next_in,p,u),1===l.state.wrap?l.adler=o(l.adler,h,p,u):2===l.state.wrap&&(l.adler=a(l.adler,h,p,u)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=M)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+M-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<M)););}while(e.lookahead<F&&0!==e.strm.avail_in)}function oe(e,t){for(var n,r;;){if(e.lookahead<F){if(se(e),e.lookahead<F&&t===l)return V;if(0===e.lookahead)break}if(n=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-F&&(e.match_length=ie(e,n)),e.match_length>=M)if(r=s._tr_tally(e,e.strstart-e.match_start,e.match_length-M),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=M){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(te(e,!1),0===e.strm.avail_out))return V}return e.insert=e.strstart<M-1?e.strstart:M-1,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?V:K}function ae(e,t){for(var n,r,i;;){if(e.lookahead<F){if(se(e),e.lookahead<F&&t===l)return V;if(0===e.lookahead)break}if(n=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=M-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-F&&(e.match_length=ie(e,n),e.match_length<=5&&(e.strategy===b||e.match_length===M&&e.strstart-e.match_start>4096)&&(e.match_length=M-1)),e.prev_length>=M&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-M,r=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-M),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=M-1,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return V}else if(e.match_available){if((r=s._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return V}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<M-1?e.strstart:M-1,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?V:K}function ce(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*A),this.dyn_dtree=new i.Buf16(2*(2*P+1)),this.bl_tree=new i.Buf16(2*(2*N+1)),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(D+1),this.heap=new i.Buf16(2*I+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*I+1),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function he(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=k,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?$:q,e.adler=2===t.wrap?0:1,t.last_flush=l,s._tr_init(t),f):Y(e,y)}function ue(e){var t,n=he(e);return n===f&&((t=e.state).window_size=2*t.w_size,J(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=M-1,t.match_available=0,t.ins_h=0),n}function de(e,t,n,r,s,o){if(!e)return y;var a=1;if(t===v&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),s<1||s>x||n!==T||r<8||r>15||t<0||t>9||o<0||o>C)return Y(e,y);8===r&&(r=9);var c=new le;return e.state=c,c.strm=e,c.wrap=a,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+M-1)/M),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=o,c.method=n,ue(e)}r=[new ce(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(se(e),0===e.lookahead&&t===l)return V;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,te(e,!1),0===e.strm.avail_out))return V;if(e.strstart-e.block_start>=e.w_size-F&&(te(e,!1),0===e.strm.avail_out))return V}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),V)}),new ce(4,4,8,4,oe),new ce(4,5,16,8,oe),new ce(4,6,32,32,oe),new ce(4,4,16,16,ae),new ce(8,16,32,32,ae),new ce(8,16,128,128,ae),new ce(8,32,128,256,ae),new ce(32,128,258,1024,ae),new ce(32,258,258,4096,ae)],t.deflateInit=function(e,t){return de(e,t,T,R,O,E)},t.deflateInit2=de,t.deflateReset=ue,t.deflateResetKeep=he,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?y:(e.state.gzhead=t,f):y},t.deflate=function(e,t){var n,i,o,c;if(!e||!e.state||t>p||t<0)return e?Y(e,y):y;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===W&&t!==d)return Y(e,0===e.avail_out?_:y);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===$)if(2===i.wrap)e.adler=0,ne(i,31),ne(i,139),ne(i,8),i.gzhead?(ne(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ne(i,255&i.gzhead.time),ne(i,i.gzhead.time>>8&255),ne(i,i.gzhead.time>>16&255),ne(i,i.gzhead.time>>24&255),ne(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),ne(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(ne(i,255&i.gzhead.extra.length),ne(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=a(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=B):(ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),ne(i,Z),i.status=q);else{var g=T+(i.w_bits-8<<4)<<8;g|=(i.strategy>=w||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(g|=L),g+=31-g%31,i.status=q,re(i,g),0!==i.strstart&&(re(i,e.adler>>>16),re(i,65535&e.adler)),e.adler=1}if(i.status===B)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending!==i.pending_buf_size));)ne(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,ne(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===c&&(i.gzindex=0,i.status=H)}else i.status=H;if(i.status===H)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,ne(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===c&&(i.status=z)}else i.status=z;if(i.status===z&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(ne(i,255&e.adler),ne(i,e.adler>>8&255),e.adler=0,i.status=q)):i.status=q),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,f}else if(0===e.avail_in&&X(t)<=X(n)&&t!==d)return Y(e,_);if(i.status===W&&0!==e.avail_in)return Y(e,_);if(0!==e.avail_in||0!==i.lookahead||t!==l&&i.status!==W){var v=i.strategy===w?function(e,t){for(var n;;){if(0===e.lookahead&&(se(e),0===e.lookahead)){if(t===l)return V;break}if(e.match_length=0,n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return V}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?V:K}(i,t):i.strategy===S?function(e,t){for(var n,r,i,o,a=e.window;;){if(e.lookahead<=j){if(se(e),e.lookahead<=j&&t===l)return V;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=M&&e.strstart>0&&(r=a[i=e.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){o=e.strstart+j;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);e.match_length=j-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=M?(n=s._tr_tally(e,1,e.match_length-M),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return V}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Q:G):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?V:K}(i,t):r[i.level].func(i,t);if(v!==Q&&v!==G||(i.status=W),v===V||v===Q)return 0===e.avail_out&&(i.last_flush=-1),f;if(v===K&&(t===h?s._tr_align(i):t!==p&&(s._tr_stored_block(i,0,0,!1),t===u&&(J(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,f}return t!==d?f:i.wrap<=0?m:(2===i.wrap?(ne(i,255&e.adler),ne(i,e.adler>>8&255),ne(i,e.adler>>16&255),ne(i,e.adler>>24&255),ne(i,255&e.total_in),ne(i,e.total_in>>8&255),ne(i,e.total_in>>16&255),ne(i,e.total_in>>24&255)):(re(i,e.adler>>>16),re(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?f:m)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==$&&t!==B&&t!==U&&t!==H&&t!==z&&t!==q&&t!==W?Y(e,y):(e.state=null,t===q?Y(e,g):f):y},t.deflateSetDictionary=function(e,t){var n,r,s,a,c,l,h,u,d=t.length;if(!e||!e.state)return y;if(2===(a=(n=e.state).wrap)||1===a&&n.status!==$||n.lookahead)return y;for(1===a&&(e.adler=o(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===a&&(J(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new i.Buf8(n.w_size),i.arraySet(u,t,d-n.w_size,n.w_size,0),t=u,d=n.w_size),c=e.avail_in,l=e.next_in,h=e.input,e.avail_in=d,e.next_in=0,e.input=t,se(n);n.lookahead>=M;){r=n.strstart,s=n.lookahead-(M-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+M-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--s);n.strstart=r,n.lookahead=M-1,se(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=M-1,n.match_available=0,e.next_in=l,e.input=h,e.avail_in=c,n.wrap=a,f},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(7),i=4,s=0,o=1,a=2;function c(e){for(var t=e.length;--t>=0;)e[t]=0}var l=0,h=1,u=2,d=29,p=256,f=p+1+d,m=30,y=19,g=2*f+1,_=15,v=16,b=7,w=256,S=16,C=17,E=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=new Array(2*(f+2));c(O);var I=new Array(2*m);c(I);var P=new Array(512);c(P);var N=new Array(256);c(N);var A=new Array(d);c(A);var D,M,j,F=new Array(m);function L(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function $(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function B(e){return e<256?P[e]:P[256+(e>>>7)]}function U(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function H(e,t,n){e.bi_valid>v-n?(e.bi_buf|=t<<e.bi_valid&65535,U(e,e.bi_buf),e.bi_buf=t>>v-e.bi_valid,e.bi_valid+=n-v):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function z(e,t,n){H(e,n[2*t],n[2*t+1])}function q(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function W(e,t,n){var r,i,s=new Array(_+1),o=0;for(r=1;r<=_;r++)s[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var a=e[2*i+1];0!==a&&(e[2*i]=q(s[a]++,a))}}function V(e){var t;for(t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<y;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*w]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function K(e){e.bi_valid>8?U(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Q(e,t,n,r){var i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]}function G(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&Q(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Q(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function Z(e,t,n){var r,i,s,o,a=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],i=e.pending_buf[e.l_buf+a],a++,0===r?z(e,i,t):(z(e,(s=N[i])+p+1,t),0!==(o=k[s])&&H(e,i-=A[s],o),z(e,s=B(--r),n),0!==(o=T[s])&&H(e,r-=F[s],o))}while(a<e.last_lit);z(e,w,t)}function Y(e,t){var n,r,i,s=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=g,n=0;n<c;n++)0!==s[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=o[2*i+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)G(e,s,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],G(e,s,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,s[2*i]=s[2*n]+s[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,s[2*n+1]=s[2*r+1]=i,e.heap[1]=i++,G(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,s,o,a,c=t.dyn_tree,l=t.max_code,h=t.stat_desc.static_tree,u=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(s=0;s<=_;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<g;n++)(s=c[2*c[2*(r=e.heap[n])+1]+1]+1)>f&&(s=f,m++),c[2*r+1]=s,r>l||(e.bl_count[s]++,o=0,r>=p&&(o=d[r-p]),a=c[2*r],e.opt_len+=a*(s+o),u&&(e.static_len+=a*(h[2*r+1]+o)));if(0!==m){do{for(s=f-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(s=f;0!==s;s--)for(r=e.bl_count[s];0!==r;)(i=e.heap[--n])>l||(c[2*i+1]!==s&&(e.opt_len+=(s-c[2*i+1])*c[2*i],c[2*i+1]=s),r--)}}(e,t),W(s,l,e.bl_count)}function X(e,t,n){var r,i,s=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++a<c&&i===o||(a<l?e.bl_tree[2*i]+=a:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[2*S]++):a<=10?e.bl_tree[2*C]++:e.bl_tree[2*E]++,a=0,s=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4))}function J(e,t,n){var r,i,s=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++a<c&&i===o)){if(a<l)do{z(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==s&&(z(e,i,e.bl_tree),a--),z(e,S,e.bl_tree),H(e,a-3,2)):a<=10?(z(e,C,e.bl_tree),H(e,a-3,3)):(z(e,E,e.bl_tree),H(e,a-11,7));a=0,s=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4)}}c(F);var ee=!1;function te(e,t,n,i){H(e,(l<<1)+(i?1:0),3),function(e,t,n,i){K(e),i&&(U(e,n),U(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(function(){var e,t,n,r,i,s=new Array(_+1);for(n=0,r=0;r<d-1;r++)for(A[r]=n,e=0;e<1<<k[r];e++)N[n++]=r;for(N[n-1]=r,i=0,r=0;r<16;r++)for(F[r]=i,e=0;e<1<<T[r];e++)P[i++]=r;for(i>>=7;r<m;r++)for(F[r]=i<<7,e=0;e<1<<T[r]-7;e++)P[256+i++]=r;for(t=0;t<=_;t++)s[t]=0;for(e=0;e<=143;)O[2*e+1]=8,e++,s[8]++;for(;e<=255;)O[2*e+1]=9,e++,s[9]++;for(;e<=279;)O[2*e+1]=7,e++,s[7]++;for(;e<=287;)O[2*e+1]=8,e++,s[8]++;for(W(O,f+1,s),e=0;e<m;e++)I[2*e+1]=5,I[2*e]=q(e,5);D=new L(O,k,p+1,f,_),M=new L(I,T,0,m,_),j=new L(new Array(0),x,0,y,b)}(),ee=!0),e.l_desc=new $(e.dyn_ltree,D),e.d_desc=new $(e.dyn_dtree,M),e.bl_desc=new $(e.bl_tree,j),e.bi_buf=0,e.bi_valid=0,V(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,r){var c,l,d=0;e.level>0?(e.strm.data_type===a&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return s;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<p;t++)if(0!==e.dyn_ltree[2*t])return o;return s}(e)),Y(e,e.l_desc),Y(e,e.d_desc),d=function(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),Y(e,e.bl_desc),t=y-1;t>=3&&0===e.bl_tree[2*R[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),c=e.opt_len+3+7>>>3,(l=e.static_len+3+7>>>3)<=c&&(c=l)):c=l=n+5,n+4<=c&&-1!==t?te(e,t,n,r):e.strategy===i||l===c?(H(e,(h<<1)+(r?1:0),3),Z(e,O,I)):(H(e,(u<<1)+(r?1:0),3),function(e,t,n,r){var i;for(H(e,t-257,5),H(e,n-1,5),H(e,r-4,4),i=0;i<r;i++)H(e,e.bl_tree[2*R[i]+1],3);J(e,e.dyn_ltree,t-1),J(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),Z(e,e.dyn_ltree,e.dyn_dtree)),V(e),r&&K(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(N[n]+p+1)]++,e.dyn_dtree[2*B(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){H(e,h<<1,3),z(e,w,O),function(e){16===e.bi_valid?(U(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(77),i=n(7),s=n(42),o=n(44),a=n(24),c=n(43),l=n(80),h=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(a[n]);if(this.header=new l,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=s.string2buf(t.dictionary):"[object ArrayBuffer]"===h.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(a[n])}function d(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}u.prototype.push=function(e,t){var n,a,c,l,u,d=this.strm,p=this.options.chunkSize,f=this.options.dictionary,m=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=s.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(p),d.next_out=0,d.avail_out=p),(n=r.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&f&&(n=r.inflateSetDictionary(this.strm,f)),n===o.Z_BUF_ERROR&&!0===m&&(n=o.Z_OK,m=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==o.Z_STREAM_END&&(0!==d.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(c=s.utf8border(d.output,d.next_out),l=d.next_out-c,u=s.buf2string(d.output,c),d.next_out=l,d.avail_out=p-l,l&&i.arraySet(d.output,d.output,c,l,0),this.onData(u)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=u,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},function(e,t,n){"use strict";var r=n(7),i=n(40),s=n(41),o=n(78),a=n(79),c=0,l=1,h=2,u=4,d=5,p=6,f=0,m=1,y=2,g=-2,_=-3,v=-4,b=-5,w=8,S=1,C=2,E=3,k=4,T=5,x=6,R=7,O=8,I=9,P=10,N=11,A=12,D=13,M=14,j=15,F=16,L=17,$=18,B=19,U=20,H=21,z=22,q=23,W=24,V=25,K=26,Q=27,G=28,Z=29,Y=30,X=31,J=32,ee=852,te=592,ne=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function se(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,f):g}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,se(e)):g}function ae(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?g:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,oe(e))):g}function ce(e,t){var n,r;return e?(r=new ie,e.state=r,r.window=null,(n=ae(e,t))!==f&&(e.state=null),n):g}var le,he,ue=!0;function de(e){if(ue){var t;for(le=new r.Buf32(512),he=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(l,e.lens,0,288,le,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(h,e.lens,0,32,he,0,e.work,{bits:5}),ue=!1}e.lencode=le,e.lenbits=9,e.distcode=he,e.distbits=5}function pe(e,t,n,i){var s,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((s=o.wsize-o.wnext)>i&&(s=i),r.arraySet(o.window,t,n-i,s,o.wnext),(i-=s)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}t.inflateReset=oe,t.inflateReset2=ae,t.inflateResetKeep=se,t.inflateInit=function(e){return ce(e,ne)},t.inflateInit2=ce,t.inflate=function(e,t){var n,ee,te,ne,ie,se,oe,ae,ce,le,he,ue,fe,me,ye,ge,_e,ve,be,we,Se,Ce,Ee,ke,Te=0,xe=new r.Buf8(4),Re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return g;(n=e.state).mode===A&&(n.mode=D),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,se=e.avail_in,ae=n.hold,ce=n.bits,le=se,he=oe,Ce=f;e:for(;;)switch(n.mode){case S:if(0===n.wrap){n.mode=D;break}for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(2&n.wrap&&35615===ae){n.check=0,xe[0]=255&ae,xe[1]=ae>>>8&255,n.check=s(n.check,xe,2,0),ae=0,ce=0,n.mode=C;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&ae)<<8)+(ae>>8))%31){e.msg="incorrect header check",n.mode=Y;break}if((15&ae)!==w){e.msg="unknown compression method",n.mode=Y;break}if(ce-=4,Se=8+(15&(ae>>>=4)),0===n.wbits)n.wbits=Se;else if(Se>n.wbits){e.msg="invalid window size",n.mode=Y;break}n.dmax=1<<Se,e.adler=n.check=1,n.mode=512&ae?P:A,ae=0,ce=0;break;case C:for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(n.flags=ae,(255&n.flags)!==w){e.msg="unknown compression method",n.mode=Y;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Y;break}n.head&&(n.head.text=ae>>8&1),512&n.flags&&(xe[0]=255&ae,xe[1]=ae>>>8&255,n.check=s(n.check,xe,2,0)),ae=0,ce=0,n.mode=E;case E:for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.time=ae),512&n.flags&&(xe[0]=255&ae,xe[1]=ae>>>8&255,xe[2]=ae>>>16&255,xe[3]=ae>>>24&255,n.check=s(n.check,xe,4,0)),ae=0,ce=0,n.mode=k;case k:for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.xflags=255&ae,n.head.os=ae>>8),512&n.flags&&(xe[0]=255&ae,xe[1]=ae>>>8&255,n.check=s(n.check,xe,2,0)),ae=0,ce=0,n.mode=T;case T:if(1024&n.flags){for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.length=ae,n.head&&(n.head.extra_len=ae),512&n.flags&&(xe[0]=255&ae,xe[1]=ae>>>8&255,n.check=s(n.check,xe,2,0)),ae=0,ce=0}else n.head&&(n.head.extra=null);n.mode=x;case x:if(1024&n.flags&&((ue=n.length)>se&&(ue=se),ue&&(n.head&&(Se=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,ee,ne,ue,Se)),512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,n.length-=ue),n.length))break e;n.length=0,n.mode=R;case R:if(2048&n.flags){if(0===se)break e;ue=0;do{Se=ee[ne+ue++],n.head&&Se&&n.length<65536&&(n.head.name+=String.fromCharCode(Se))}while(Se&&ue<se);if(512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,Se)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=O;case O:if(4096&n.flags){if(0===se)break e;ue=0;do{Se=ee[ne+ue++],n.head&&Se&&n.length<65536&&(n.head.comment+=String.fromCharCode(Se))}while(Se&&ue<se);if(512&n.flags&&(n.check=s(n.check,ee,ue,ne)),se-=ue,ne+=ue,Se)break e}else n.head&&(n.head.comment=null);n.mode=I;case I:if(512&n.flags){for(;ce<16;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Y;break}ae=0,ce=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=A;break;case P:for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}e.adler=n.check=re(ae),ae=0,ce=0,n.mode=N;case N:if(0===n.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,y;e.adler=n.check=1,n.mode=A;case A:if(t===d||t===p)break e;case D:if(n.last){ae>>>=7&ce,ce-=7&ce,n.mode=Q;break}for(;ce<3;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}switch(n.last=1&ae,ce-=1,3&(ae>>>=1)){case 0:n.mode=M;break;case 1:if(de(n),n.mode=U,t===p){ae>>>=2,ce-=2;break e}break;case 2:n.mode=L;break;case 3:e.msg="invalid block type",n.mode=Y}ae>>>=2,ce-=2;break;case M:for(ae>>>=7&ce,ce-=7&ce;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if((65535&ae)!=(ae>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Y;break}if(n.length=65535&ae,ae=0,ce=0,n.mode=j,t===p)break e;case j:n.mode=F;case F:if(ue=n.length){if(ue>se&&(ue=se),ue>oe&&(ue=oe),0===ue)break e;r.arraySet(te,ee,ne,ue,ie),se-=ue,ne+=ue,oe-=ue,ie+=ue,n.length-=ue;break}n.mode=A;break;case L:for(;ce<14;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(n.nlen=257+(31&ae),ae>>>=5,ce-=5,n.ndist=1+(31&ae),ae>>>=5,ce-=5,n.ncode=4+(15&ae),ae>>>=4,ce-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Y;break}n.have=0,n.mode=$;case $:for(;n.have<n.ncode;){for(;ce<3;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.lens[Re[n.have++]]=7&ae,ae>>>=3,ce-=3}for(;n.have<19;)n.lens[Re[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ee={bits:n.lenbits},Ce=a(c,n.lens,0,19,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,Ce){e.msg="invalid code lengths set",n.mode=Y;break}n.have=0,n.mode=B;case B:for(;n.have<n.nlen+n.ndist;){for(;ge=(Te=n.lencode[ae&(1<<n.lenbits)-1])>>>16&255,_e=65535&Te,!((ye=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(_e<16)ae>>>=ye,ce-=ye,n.lens[n.have++]=_e;else{if(16===_e){for(ke=ye+2;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae>>>=ye,ce-=ye,0===n.have){e.msg="invalid bit length repeat",n.mode=Y;break}Se=n.lens[n.have-1],ue=3+(3&ae),ae>>>=2,ce-=2}else if(17===_e){for(ke=ye+3;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ce-=ye,Se=0,ue=3+(7&(ae>>>=ye)),ae>>>=3,ce-=3}else{for(ke=ye+7;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ce-=ye,Se=0,ue=11+(127&(ae>>>=ye)),ae>>>=7,ce-=7}if(n.have+ue>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Y;break}for(;ue--;)n.lens[n.have++]=Se}}if(n.mode===Y)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Y;break}if(n.lenbits=9,Ee={bits:n.lenbits},Ce=a(l,n.lens,0,n.nlen,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,Ce){e.msg="invalid literal/lengths set",n.mode=Y;break}if(n.distbits=6,n.distcode=n.distdyn,Ee={bits:n.distbits},Ce=a(h,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ee),n.distbits=Ee.bits,Ce){e.msg="invalid distances set",n.mode=Y;break}if(n.mode=U,t===p)break e;case U:n.mode=H;case H:if(se>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,o(e,he),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,se=e.avail_in,ae=n.hold,ce=n.bits,n.mode===A&&(n.back=-1);break}for(n.back=0;ge=(Te=n.lencode[ae&(1<<n.lenbits)-1])>>>16&255,_e=65535&Te,!((ye=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ge&&0==(240&ge)){for(ve=ye,be=ge,we=_e;ge=(Te=n.lencode[we+((ae&(1<<ve+be)-1)>>ve)])>>>16&255,_e=65535&Te,!(ve+(ye=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ae>>>=ve,ce-=ve,n.back+=ve}if(ae>>>=ye,ce-=ye,n.back+=ye,n.length=_e,0===ge){n.mode=K;break}if(32&ge){n.back=-1,n.mode=A;break}if(64&ge){e.msg="invalid literal/length code",n.mode=Y;break}n.extra=15&ge,n.mode=z;case z:if(n.extra){for(ke=n.extra;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.length+=ae&(1<<n.extra)-1,ae>>>=n.extra,ce-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=q;case q:for(;ge=(Te=n.distcode[ae&(1<<n.distbits)-1])>>>16&255,_e=65535&Te,!((ye=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(0==(240&ge)){for(ve=ye,be=ge,we=_e;ge=(Te=n.distcode[we+((ae&(1<<ve+be)-1)>>ve)])>>>16&255,_e=65535&Te,!(ve+(ye=Te>>>24)<=ce);){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}ae>>>=ve,ce-=ve,n.back+=ve}if(ae>>>=ye,ce-=ye,n.back+=ye,64&ge){e.msg="invalid distance code",n.mode=Y;break}n.offset=_e,n.extra=15&ge,n.mode=W;case W:if(n.extra){for(ke=n.extra;ce<ke;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}n.offset+=ae&(1<<n.extra)-1,ae>>>=n.extra,ce-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Y;break}n.mode=V;case V:if(0===oe)break e;if(ue=he-oe,n.offset>ue){if((ue=n.offset-ue)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Y;break}ue>n.wnext?(ue-=n.wnext,fe=n.wsize-ue):fe=n.wnext-ue,ue>n.length&&(ue=n.length),me=n.window}else me=te,fe=ie-n.offset,ue=n.length;ue>oe&&(ue=oe),oe-=ue,n.length-=ue;do{te[ie++]=me[fe++]}while(--ue);0===n.length&&(n.mode=H);break;case K:if(0===oe)break e;te[ie++]=n.length,oe--,n.mode=H;break;case Q:if(n.wrap){for(;ce<32;){if(0===se)break e;se--,ae|=ee[ne++]<<ce,ce+=8}if(he-=oe,e.total_out+=he,n.total+=he,he&&(e.adler=n.check=n.flags?s(n.check,te,he,ie-he):i(n.check,te,he,ie-he)),he=oe,(n.flags?ae:re(ae))!==n.check){e.msg="incorrect data check",n.mode=Y;break}ae=0,ce=0}n.mode=G;case G:if(n.wrap&&n.flags){for(;ce<32;){if(0===se)break e;se--,ae+=ee[ne++]<<ce,ce+=8}if(ae!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Y;break}ae=0,ce=0}n.mode=Z;case Z:Ce=m;break e;case Y:Ce=_;break e;case X:return v;case J:default:return g}return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=se,n.hold=ae,n.bits=ce,(n.wsize||he!==e.avail_out&&n.mode<Y&&(n.mode<Q||t!==u))&&pe(e,e.output,e.next_out,he-e.avail_out)?(n.mode=X,v):(le-=e.avail_in,he-=e.avail_out,e.total_in+=le,e.total_out+=he,n.total+=he,n.wrap&&he&&(e.adler=n.check=n.flags?s(n.check,te,he,e.next_out-he):i(n.check,te,he,e.next_out-he)),e.data_type=n.bits+(n.last?64:0)+(n.mode===A?128:0)+(n.mode===U||n.mode===j?256:0),(0===le&&0===he||t===u)&&Ce===f&&(Ce=b),Ce)},t.inflateEnd=function(e){if(!e||!e.state)return g;var t=e.state;return t.window&&(t.window=null),e.state=null,f},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?g:(n.head=t,t.done=!1,f):g},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==N?g:n.mode===N&&i(1,t,r,0)!==n.check?_:pe(e,t,r,r)?(n.mode=X,v):(n.havedict=1,f):g},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,s,o,a,c,l,h,u,d,p,f,m,y,g,_,v,b,w,S,C,E,k,T;n=e.state,r=e.next_in,k=e.input,i=r+(e.avail_in-5),s=e.next_out,T=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),c=n.dmax,l=n.wsize,h=n.whave,u=n.wnext,d=n.window,p=n.hold,f=n.bits,m=n.lencode,y=n.distcode,g=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{f<15&&(p+=k[r++]<<f,f+=8,p+=k[r++]<<f,f+=8),v=m[p&g];t:for(;;){if(p>>>=b=v>>>24,f-=b,0===(b=v>>>16&255))T[s++]=65535&v;else{if(!(16&b)){if(0==(64&b)){v=m[(65535&v)+(p&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&v,(b&=15)&&(f<b&&(p+=k[r++]<<f,f+=8),w+=p&(1<<b)-1,p>>>=b,f-=b),f<15&&(p+=k[r++]<<f,f+=8,p+=k[r++]<<f,f+=8),v=y[p&_];n:for(;;){if(p>>>=b=v>>>24,f-=b,!(16&(b=v>>>16&255))){if(0==(64&b)){v=y[(65535&v)+(p&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(S=65535&v,f<(b&=15)&&(p+=k[r++]<<f,(f+=8)<b&&(p+=k[r++]<<f,f+=8)),(S+=p&(1<<b)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=b,f-=b,S>(b=s-o)){if((b=S-b)>h&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,E=d,0===u){if(C+=l-b,b<w){w-=b;do{T[s++]=d[C++]}while(--b);C=s-S,E=T}}else if(u<b){if(C+=l+u-b,(b-=u)<w){w-=b;do{T[s++]=d[C++]}while(--b);if(C=0,u<w){w-=b=u;do{T[s++]=d[C++]}while(--b);C=s-S,E=T}}}else if(C+=u-b,b<w){w-=b;do{T[s++]=d[C++]}while(--b);C=s-S,E=T}for(;w>2;)T[s++]=E[C++],T[s++]=E[C++],T[s++]=E[C++],w-=3;w&&(T[s++]=E[C++],w>1&&(T[s++]=E[C++]))}else{C=s-S;do{T[s++]=T[C++],T[s++]=T[C++],T[s++]=T[C++],w-=3}while(w>2);w&&(T[s++]=T[C++],w>1&&(T[s++]=T[C++]))}break}}break}}while(r<i&&s<a);r-=w=f>>3,p&=(1<<(f-=w<<3))-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=s<a?a-s+257:257-(s-a),n.hold=p,n.bits=f}},function(e,t,n){"use strict";var r=n(7),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,h,u,d){var p,f,m,y,g,_,v,b,w,S=d.bits,C=0,E=0,k=0,T=0,x=0,R=0,O=0,I=0,P=0,N=0,A=null,D=0,M=new r.Buf16(16),j=new r.Buf16(16),F=null,L=0;for(C=0;C<=15;C++)M[C]=0;for(E=0;E<c;E++)M[t[n+E]]++;for(x=S,T=15;T>=1&&0===M[T];T--);if(x>T&&(x=T),0===T)return l[h++]=20971520,l[h++]=20971520,d.bits=1,0;for(k=1;k<T&&0===M[k];k++);for(x<k&&(x=k),I=1,C=1;C<=15;C++)if(I<<=1,(I-=M[C])<0)return-1;if(I>0&&(0===e||1!==T))return-1;for(j[1]=0,C=1;C<15;C++)j[C+1]=j[C]+M[C];for(E=0;E<c;E++)0!==t[n+E]&&(u[j[t[n+E]]++]=E);if(0===e?(A=F=u,_=19):1===e?(A=i,D-=257,F=s,L-=257,_=256):(A=o,F=a,_=-1),N=0,E=0,C=k,g=h,R=x,O=0,m=-1,y=(P=1<<x)-1,1===e&&P>852||2===e&&P>592)return 1;for(;;){v=C-O,u[E]<_?(b=0,w=u[E]):u[E]>_?(b=F[L+u[E]],w=A[D+u[E]]):(b=96,w=0),p=1<<C-O,k=f=1<<R;do{l[g+(N>>O)+(f-=p)]=v<<24|b<<16|w|0}while(0!==f);for(p=1<<C-1;N&p;)p>>=1;if(0!==p?(N&=p-1,N+=p):N=0,E++,0==--M[C]){if(C===T)break;C=t[n+u[E]]}if(C>x&&(N&y)!==m){for(0===O&&(O=x),g+=k,I=1<<(R=C-O);R+O<T&&!((I-=M[R+O])<=0);)R++,I<<=1;if(P+=1<<R,1===e&&P>852||2===e&&P>592)return 1;l[m=N&y]=x<<24|R<<16|g-h|0}}return 0!==N&&(l[g+N]=C-O<<24|64<<16|0),d.bits=x,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";var r=n(1),i=n(3),s=n(9),o=n(23),a=n(45),c=function(e,t){var n,r="";for(n=0;n<t;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},l=function(e,t,n,i,l,h){var u,d,p=e.file,f=e.compression,m=h!==s.utf8encode,y=r.transformTo("string",h(p.name)),g=r.transformTo("string",s.utf8encode(p.name)),_=p.comment,v=r.transformTo("string",h(_)),b=r.transformTo("string",s.utf8encode(_)),w=g.length!==p.name.length,S=b.length!==_.length,C="",E="",k="",T=p.dir,x=p.date,R={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(R.crc32=e.crc32,R.compressedSize=e.compressedSize,R.uncompressedSize=e.uncompressedSize);var O=0;t&&(O|=8),m||!w&&!S||(O|=2048);var I,P,N,A=0,D=0;T&&(A|=16),"UNIX"===l?(D=798,A|=(I=p.unixPermissions,P=T,N=I,I||(N=P?16893:33204),(65535&N)<<16)):(D=20,A|=63&(p.dosPermissions||0)),u=x.getUTCHours(),u<<=6,u|=x.getUTCMinutes(),u<<=5,u|=x.getUTCSeconds()/2,d=x.getUTCFullYear()-1980,d<<=4,d|=x.getUTCMonth()+1,d<<=5,d|=x.getUTCDate(),w&&(E=c(1,1)+c(o(y),4)+g,C+="up"+c(E.length,2)+E),S&&(k=c(1,1)+c(o(v),4)+b,C+="uc"+c(k.length,2)+k);var M="";return M+="\n\0",M+=c(O,2),M+=f.magic,M+=c(u,2),M+=c(d,2),M+=c(R.crc32,4),M+=c(R.compressedSize,4),M+=c(R.uncompressedSize,4),M+=c(y.length,2),M+=c(C.length,2),{fileRecord:a.LOCAL_FILE_HEADER+M+y+C,dirRecord:a.CENTRAL_FILE_HEADER+c(D,2)+M+c(v.length,2)+"\0\0\0\0"+c(A,4)+c(i,4)+y+C+v}},h=function(e){return a.DATA_DESCRIPTOR+c(e.crc32,4)+c(e.compressedSize,4)+c(e.uncompressedSize,4)};function u(e,t,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(u,i),u.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-r-1))/n:100}}))},u.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=l(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=l(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:h(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,i=function(e,t,n,i,s){var o=r.transformTo("string",s(i));return a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(e,2)+c(e,2)+c(t,4)+c(n,4)+c(o.length,2)+o}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},u.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},u.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},e.exports=u},function(e,t,n){"use strict";var r=n(1),i=n(3);function s(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}r.inherits(s,i),s.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},function(e,t,n){"use strict";var r=n(1),i=n(14),s=n(9),o=(r=n(1),n(84)),a=n(38),c=n(20);function l(e){return new i.Promise(function(t,n){var r=e.decompressed.getContentWorker().pipe(new a);r.on("error",function(e){n(e)}).on("end",function(){r.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}e.exports=function(e,t){var n=this;return t=r.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),c.isNode&&c.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(e){var n=new o(t);return n.load(e),n}).then(function(e){var n=[i.Promise.resolve(e)],r=e.files;if(t.checkCRC32)for(var s=0;s<r.length;s++)n.push(l(r[s]));return i.Promise.all(n)}).then(function(e){for(var r=e.shift(),i=r.files,s=0;s<i.length;s++){var o=i[s];n.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n})}},function(e,t,n){"use strict";var r=n(46),i=n(1),s=n(45),o=n(87),a=(n(9),n(6));function c(e){this.files=[],this.loadOptions=e}c.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4)===t;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",n=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=t-n;if(r>0)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=c},function(e,t,n){"use strict";var r=n(48);function i(e){r.call(this,e)}n(1).inherits(i,r),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(49);function i(e){r.call(this,e)}n(1).inherits(i,r),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,n){"use strict";var r=n(46),i=n(1),s=n(22),o=n(23),a=n(9),c=n(39),l=n(6);function h(e,t){this.options=e,this.loadOptions=t}h.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in c)if(c.hasOwnProperty(t)&&c[t].magic===e)return c[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<i;)t=e.readInt(2),n=e.readInt(2),r=e.readData(n),this.extraFields[t]={id:t,length:n,value:r}},handleUTF8:function(){var e=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var s=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:o(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:o(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},e.exports=h},function(e,t,n){"use strict";(function(e){var t,r=n(5),i=n(2),s=n(0),o=n(15),a=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(s.K)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(s.D)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),c=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return Object(s.j)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),l=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new a(t)}}catch(e){}return new c},h=l("localStorage"),u=l("sessionStorage"),d=new o.b("@firebase/database"),p=(t=1,function(){return t++}),f=function(e){var t=Object(s.J)(e),n=new s.d;n.update(t);var r=n.digest();return s.g.encodeByteArray(r)},m=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++)Array.isArray(e[r])||e[r]&&"object"==typeof e[r]&&"number"==typeof e[r].length?n+=m.apply(null,e[r]):"object"==typeof e[r]?n+=Object(s.K)(e[r]):n+=e[r],n+=" ";return n},y=null,g=!0,_=function(e,t){Object(s.e)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(d.logLevel=o.a.VERBOSE,y=d.log.bind(d),t&&u.set("logging_enabled",!0)):"function"==typeof e?y=e:(y=null,u.remove("logging_enabled"))},v=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===g&&(g=!1,null===y&&!0===u.get("logging_enabled")&&_(!0)),y){var n=m.apply(null,e);y(n)}},b=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];v.apply(void 0,[e].concat(t))}},w=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+m.apply(void 0,e);d.error(n)},S=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+m.apply(void 0,e);throw d.error(n),new Error(n)},C=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+m.apply(void 0,e);d.warn(n)},E=function(e){return"number"==typeof e&&(e!=e||e==Number.POSITIVE_INFINITY||e==Number.NEGATIVE_INFINITY)},k="[MIN_NAME]",T="[MAX_NAME]",x=function(e,t){if(e===t)return 0;if(e===k||t===T)return-1;if(t===k||e===T)return 1;var n=M(e),r=M(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},R=function(e,t){return e===t?0:e<t?-1:1},O=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(s.K)(t))},I=function(e){if("object"!=typeof e||null===e)return Object(s.K)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=Object(s.K)(t[i]),r+=":",r+=I(e[t[i]]);return r+="}"},P=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r},N=function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;++n)t(n,e[n]);else Object(s.r)(e,function(e,n){return t(n,e)})},A=function(e){Object(s.e)(!E(e),"Invalid JSON number");var t,n,r,i,o,a,c;for(0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse(),c=a.join("");var l="";for(o=0;o<64;o+=8){var h=parseInt(c.substr(o,8),2).toString(16);1===h.length&&(h="0"+h),l+=h}return l.toLowerCase()},D=new RegExp("^-?\\d{1,10}$"),M=function(e){if(D.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},j=function(e){try{e()}catch(e){setTimeout(function(){var t=e.stack||"";throw C("Exception was thrown by user callback.",t),e},Math.floor(0))}},F=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},L=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},$=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:!0,configurable:!0}),e.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},e.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new e(this.pieces_,t)},e.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},e.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)t.push(this.pieces_[n]);return new e(t,0)},e.prototype.child=function(t){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(t instanceof e)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new e(n,0)},e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},e.relativePath=function(t,n){var r=t.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return e.relativePath(t.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+t+")")},e.comparePaths=function(e,t){for(var n=e.slice(),r=t.slice(),i=0;i<n.length&&i<r.length;i++){var s=x(n[i],r[i]);if(0!==s)return s}return n.length===r.length?0:n.length<r.length?-1:1},e.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,n=e.pieceNum_;t<=this.pieces_.length;t++,n++)if(this.pieces_[t]!==e.pieces_[n])return!1;return!0},e.prototype.contains=function(e){var t=this.pieceNum_,n=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0},e}(),B=function(){function e(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(s.I)(this.parts_[n]);this.checkValid_()}return Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=Object(s.I)(e),this.checkValid_()},e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=Object(s.I)(e),this.parts_.length>0&&(this.byteLength_-=1)},e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},e.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},e}(),U="long_polling",H=function(){function e(e,t,n,r,i){void 0===i&&(i=""),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=h.get("host:"+e)||this.host}return e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},e.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&h.set("host:"+this.host,this.internalHost))},e.prototype.connectionURL=function(e,t){var n;if(Object(s.e)("string"==typeof e,"typeof type must == string"),Object(s.e)("object"==typeof t,"typeof params must == object"),"websocket"===e)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==U)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return Object(s.r)(t,function(e,t){r.push(e+"="+t)}),n+r.join("&")},e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},e}();var z,q,W,V,K,Q=function(e){var t=G(e),n=t.subdomain;"firebase"===t.domain&&S(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===t.domain||S("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&C("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===t.scheme||"wss"===t.scheme;return{repoInfo:new H(t.host,t.secure,n,r),path:new $(t.pathString)}},G=function(e){var t="",n="",r="",i="",s=!0,o="https",a=443;if("string"==typeof e){var c=e.indexOf("//");c>=0&&(o=e.substring(0,c-1),e=e.substring(c+2));var l=e.indexOf("/");-1===l&&(l=e.length);var h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(l,h)),l<h&&(i=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(l,h)));var u=function(e){var t={};"?"===e.charAt(0)&&(e=e.substring(1));for(var n=0,r=e.split("&");n<r.length;n++){var i=r[n];if(0!==i.length){var s=i.split("=");2===s.length?t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):C("Invalid query segment '"+i+"' in query '"+e+"'")}}return t}(e.substring(Math.min(e.length,h)));(c=t.indexOf(":"))>=0?(s="https"===o||"wss"===o,a=parseInt(t.substring(c+1),10)):c=e.length;var d=t.split(".");3===d.length?(n=d[1],r=d[0].toLowerCase()):2===d.length?n=d[0]:"localhost"===d[0].slice(0,c).toLowerCase()&&(n="localhost"),""===r&&"ns"in u&&(r=u.ns)}return{host:t,port:a,domain:n,subdomain:r,secure:s,scheme:o,pathString:i}},Z=/[\[\].#$\/\u0000-\u001F\u007F]/,Y=/[\[\].#$\u0000-\u001F\u007F]/,X=function(e){return"string"==typeof e&&0!==e.length&&!Z.test(e)},J=function(e){return"string"==typeof e&&0!==e.length&&!Y.test(e)},ee=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!E(e)||e&&"object"==typeof e&&Object(s.j)(e,".sv")},te=function(e,t,n,r,i){i&&void 0===n||ne(Object(s.n)(e,t,i),n,r)},ne=function(e,t,n){var r=n instanceof $?new B(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(e+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(E(t))throw new Error(e+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>10485760/3&&Object(s.I)(t)>10485760)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Object(s.r)(t,function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!X(t)))throw new Error(e+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),ne(e,n,r),r.pop()}),i&&o)throw new Error(e+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},re=function(e,t,n,r,i){if(!i||void 0!==n){var o=Object(s.n)(e,t,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Object(s.r)(n,function(e,t){var n=new $(e);if(ne(o,t,r.child(n)),".priority"===n.getBack()&&!ee(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=(r=t[n]).slice(),s=0;s<i.length;s++)if(".priority"===i[s]&&s===i.length-1);else if(!X(i[s]))throw new Error(e+"contains an invalid key ("+i[s]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort($.comparePaths);var o=null;for(n=0;n<t.length;n++){if(r=t[n],null!==o&&o.contains(r))throw new Error(e+"contains a path "+o.toString()+" that is ancestor of another path "+r.toString());o=r}}(o,a)}},ie=function(e,t,n,r){if(!r||void 0!==n){if(E(n))throw new Error(Object(s.n)(e,t,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ee(n))throw new Error(Object(s.n)(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},se=function(e,t,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(s.n)(e,t,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},oe=function(e,t,n,r){if(!(r&&void 0===n||X(n)))throw new Error(Object(s.n)(e,t,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ae=function(e,t,n,r){if(!(r&&void 0===n||J(n)))throw new Error(Object(s.n)(e,t,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ce=function(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")},le=function(e,t,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!X(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),J(e)}(r))throw new Error(Object(s.n)(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},he=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){Object(s.L)("OnDisconnect.cancel",0,1,arguments.length),Object(s.M)("OnDisconnect.cancel",1,e,!0);var t=new s.b;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){Object(s.L)("OnDisconnect.remove",0,1,arguments.length),ce("OnDisconnect.remove",this.path_),Object(s.M)("OnDisconnect.remove",1,e,!0);var t=new s.b;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){Object(s.L)("OnDisconnect.set",1,2,arguments.length),ce("OnDisconnect.set",this.path_),te("OnDisconnect.set",1,e,this.path_,!1),Object(s.M)("OnDisconnect.set",2,t,!0);var n=new s.b;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){Object(s.L)("OnDisconnect.setWithPriority",2,3,arguments.length),ce("OnDisconnect.setWithPriority",this.path_),te("OnDisconnect.setWithPriority",1,e,this.path_,!1),ie("OnDisconnect.setWithPriority",2,t,!1),Object(s.M)("OnDisconnect.setWithPriority",3,n,!0);var r=new s.b;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,r.wrapCallback(n)),r.promise},e.prototype.update=function(e,t){if(Object(s.L)("OnDisconnect.update",1,2,arguments.length),ce("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,C("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}re("OnDisconnect.update",1,e,this.path_,!1),Object(s.M)("OnDisconnect.update",2,t,!0);var i=new s.b;return this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t)),i.promise},e}(),ue=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return Object(s.L)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),de=(z="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",q=0,W=[],function(e){var t,n=e===q;q=e;var r=new Array(8);for(t=7;t>=0;t--)r[t]=z.charAt(e%64),e=Math.floor(e/64);Object(s.e)(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;t>=0&&63===W[t];t--)W[t]=0;W[t]++}else for(t=0;t<12;t++)W[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=z.charAt(W[t]);return Object(s.e)(20===i.length,"nextPushId: Length should be 20."),i}),pe=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),fe=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new pe(k,e),r=new pe(k,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return pe.MIN},e}(),me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.b)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return V},set:function(e){V=e},enumerable:!0,configurable:!0}),t.prototype.compare=function(e,t){return x(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw Object(s.f)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return pe.MIN},t.prototype.maxPost=function(){return new pe(T,V)},t.prototype.makePost=function(e,t){return Object(s.e)("string"==typeof e,"KeyIndex indexValue must always be a string."),new pe(e,V)},t.prototype.toString=function(){return".key"},t}(fe),ye=new me;var ge,_e,ve,be=function(e){return"number"==typeof e?"number:"+A(e):"string:"+e},we=function(e){if(e.isLeafNode()){var t=e.val();Object(s.e)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(s.j)(t,".sv"),"Priority must be a string or number.")}else Object(s.e)(e===K||e.isEmpty(),"priority of unexpected type.");Object(s.e)(e===K||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Se=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Object(s.e)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),we(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return ge},set:function(e){ge=e},enumerable:!0,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=t.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(s.e)(".priority"!==r||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+be(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?A(this.value_):this.value_,this.lazyHash_=f(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Object(s.e)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return Object(s.e)(i>=0,"Unknown leaf type: "+n),Object(s.e)(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var Ce,Ee,ke=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.b)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?x(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return pe.MIN},t.prototype.maxPost=function(){return new pe(T,new Se("[PRIORITY-POST]",ve))},t.prototype.makePost=function(e,t){var n=_e(e);return new pe(t,new Se("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(fe)),Te=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var s=1;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),xe=function(){function e(t,n,r,i,s){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Oe.EMPTY_NODE,this.right=null!=s?s:Oe.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,s){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r,i;return(i=(r=n(e,(i=this).key))<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Oe.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Oe.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){var e;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((e=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Re=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new xe(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Oe=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,xe.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,xe.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Te(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Te(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Te(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Te(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Re,e}(),Ie=Math.log(2),Pe=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ie,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),Ne=function(e,t,n,r){e.sort(t);var i=function(t,r){var s,o,a=r-t;if(0==a)return null;if(1==a)return s=e[t],o=n?n(s):s,new xe(o,s.node,xe.BLACK,null,null);var c=parseInt(a/2,10)+t,l=i(t,c),h=i(c+1,r);return s=e[c],o=n?n(s):s,new xe(o,s.node,xe.BLACK,l,h)},s=function(t){for(var r=null,s=null,o=e.length,a=function(t,r){var s=o-t,a=o;o-=t;var l=i(s+1,a),h=e[s],u=n?n(h):h;c(new xe(u,h.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(s=e,r=e)},l=0;l<t.count;++l){var h=t.nextBitIsOne(),u=Math.pow(2,t.count-(l+1));h?a(u,xe.BLACK):(a(u,xe.BLACK),a(u,xe.RED))}return s}(new Pe(e.length));return new Oe(r||t,s)},Ae={},De=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return Object(s.e)(Ae&&ke,"ChildrenNode.ts has not been loaded"),Ce=Ce||new e({".priority":Ae},{".priority":ke})},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var t=Object(s.H)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t===Ae?null:t},e.prototype.hasIndex=function(e){return Object(s.j)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){Object(s.e)(t!==ye,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],o=!1,a=n.getIterator(pe.Wrap),c=a.getNext();c;)o=o||t.isDefinedOn(c.node),i.push(c),c=a.getNext();r=o?Ne(i,t.getCompare()):Ae;var l=t.toString(),h=Object(s.i)(this.indexSet_);h[l]=t;var u=Object(s.i)(this.indexes_);return u[l]=r,new e(u,h)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(Object(s.E)(this.indexes_,function(e,i){var o=Object(s.H)(r.indexSet_,i);if(Object(s.e)(o,"Missing index implementation for "+i),e===Ae){if(o.isDefinedOn(t.node)){for(var a=[],c=n.getIterator(pe.Wrap),l=c.getNext();l;)l.name!=t.name&&a.push(l),l=c.getNext();return a.push(t),Ne(a,o.getCompare())}return Ae}var h=n.get(t.name),u=e;return h&&(u=u.remove(new pe(t.name,h))),u.insert(t,t.node)}),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(Object(s.E)(this.indexes_,function(e){if(e===Ae)return e;var r=n.get(t.name);return r?e.remove(new pe(t.name,r)):e}),this.indexSet_)},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Me(e,t){return x(e.name,t.name)}function je(e,t){return x(e,t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fe=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&we(this.priorityNode_),this.children_.isEmpty()&&Object(s.e)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return Ee||(Ee=new e(new Oe(je),null,De.Default))},enumerable:!0,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||Ee},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ee:t},e.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(Object(s.e)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r,i=new pe(t,n),o=void 0,a=void 0;return n.isEmpty()?(o=this.children_.remove(t),a=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,n),a=this.indexMap_.addToIndexes(i,this.children_)),r=o.isEmpty()?Ee:this.priorityNode_,new e(o,r,a)},e.prototype.updateChild=function(e,t){var n=e.getFront();if(null===n)return t;Object(s.e)(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(e.popFront(),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,s=!0;if(this.forEachChild(ke,function(o,a){n[o]=a.val(t),r++,s&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!t&&s&&i<2*r){var o=[];for(var a in n)o[a]=n[a];return o}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+be(this.getPriority().val())+":"),this.forEachChild(ke,function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":f(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new pe(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new pe(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new pe(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,pe.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,pe.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Le?-1:0},e.prototype.withIndex=function(t){if(t===ye||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===ye||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(ke),r=t.getIterator(ke),i=n.getNext(),s=r.getNext();i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=n.getNext(),s=r.getNext()}return null===i&&null===s}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===ye?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),Le=new(function(e){function t(){return e.call(this,new Oe(je),Fe.EMPTY_NODE,De.Default)||this}return Object(i.b)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return Fe.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(Fe));Object.defineProperties(pe,{MIN:{value:new pe(k,Fe.EMPTY_NODE)},MAX:{value:new pe(T,Le)}}),me.__EMPTY_NODE=Fe.EMPTY_NODE,Se.__childrenNodeConstructor=Fe,K=Le,function(e){ve=e}(Le);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var $e=!0;function Be(e,t){if(void 0===t&&(t=null),null===e)return Fe.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(s.e)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Se(e,Be(t));if(e instanceof Array||!$e){var n=Fe.EMPTY_NODE,r=e;return Object(s.r)(r,function(e,t){if(Object(s.j)(r,e)&&"."!==e.substring(0,1)){var i=Be(t);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}}),n.updatePriority(Be(t))}var i=[],o=!1,a=e;if(Object(s.r)(a,function(e,t){if("string"!=typeof e||"."!==e.substring(0,1)){var n=Be(a[e]);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),i.push(new pe(e,n)))}}),0==i.length)return Fe.EMPTY_NODE;var c=Ne(i,Me,function(e){return e.name},je);if(o){var l=Ne(i,ke.getCompare());return new Fe(c,Be(t),new De({".priority":l},{".priority":ke}))}return new Fe(c,Be(t),De.Default)}!function(e){_e=e}(Be);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ue,He,ze=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.b)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?x(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return pe.MIN},t.prototype.maxPost=function(){return pe.MAX},t.prototype.makePost=function(e,t){var n=Be(e);return new pe(t,n)},t.prototype.toString=function(){return".value"},t}(fe)),qe=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,Object(s.e)(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Object(i.b)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?x(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=Be(e),r=Fe.EMPTY_NODE.updateChild(this.indexPath_,n);return new pe(t,r)},t.prototype.maxPost=function(){var e=Fe.EMPTY_NODE.updateChild(this.indexPath_,Le);return new pe(T,e)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(fe),We=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return Object(s.L)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return Object(s.L)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return Object(s.L)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return Object(s.L)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){Object(s.L)("DataSnapshot.child",0,1,arguments.length),t=String(t),ae("DataSnapshot.child",1,t,!1);var n=new $(t),r=this.ref_.child(n);return new e(this.node_.getChild(n),r,ke)},e.prototype.hasChild=function(e){Object(s.L)("DataSnapshot.hasChild",1,1,arguments.length),ae("DataSnapshot.hasChild",1,e,!1);var t=new $(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return Object(s.L)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;return Object(s.L)("DataSnapshot.forEach",1,1,arguments.length),Object(s.M)("DataSnapshot.forEach",1,t,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return t(new e(i,n.ref_.child(r),ke))})},e.prototype.hasChildren=function(){return Object(s.L)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return Object(s.L)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return Object(s.L)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),e}(),Ve=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(s.K)(this.snapshot.exportVal())},e}(),Ke=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Qe=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new Ve("value",this,new We(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(s.e)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Ke(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),Ge=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,Object(s.j)(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Ke(this,e,t):null},e.prototype.createEvent=function(e,t){Object(s.e)(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),r=t.getQueryParams().getIndex();return new Ve(e.type,this,new We(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(s.e)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var n=Object(s.t)(t.callbacks_);if(n===Object(s.t)(this.callbacks_)){if(1===n){var r=Object(s.s)(t.callbacks_),i=Object(s.s)(this.callbacks_);return!(i!==r||t.callbacks_[r]&&this.callbacks_[i]&&t.callbacks_[r]!==this.callbacks_[i])}return Object(s.o)(this.callbacks_,function(e,n){return t.callbacks_[e]===n})}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}(),Ze=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(s.e)(Ue,"Reference.ts has not been loaded"),Ue},set:function(e){Ue=e},enumerable:!0,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===ye){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!=k)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!=T)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===ke){if(null!=t&&!ee(t)||null!=n&&!ee(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(s.e)(e.getIndex()instanceof qe||e.getIndex()===ze,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return Object(s.L)("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,r,i){Object(s.L)("Query.on",2,4,arguments.length),se("Query.on",1,t,!1),Object(s.M)("Query.on",2,n,!1);var o=e.getCancelAndContextArgs_("Query.on",r,i);if("value"===t)this.onValueEvent(n,o.cancel,o.context);else{var a={};a[t]=n,this.onChildEvent(a,o.cancel,o.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new Qe(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new Ge(e,t,n);this.repo.addEventCallbackForQuery(this,r)},e.prototype.off=function(e,t,n){Object(s.L)("Query.off",0,3,arguments.length),se("Query.off",1,e,!0),Object(s.M)("Query.off",2,t,!0),Object(s.N)("Query.off",3,n,!0);var r=null,i=null;"value"===e?r=new Qe(t||null,null,n||null):e&&(t&&((i={})[e]=t),r=new Ge(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},e.prototype.once=function(t,n,r,i){var o=this;Object(s.L)("Query.once",1,4,arguments.length),se("Query.once",1,t,!1),Object(s.M)("Query.once",2,n,!0);var a=e.getCancelAndContextArgs_("Query.once",r,i),c=!0,l=new s.b;l.promise.catch(function(){});var h=function(e){c&&(c=!1,o.off(t,h),n&&n.bind(a.context)(e),l.resolve(e))};return this.on(t,h,function(e){o.off(t,h),a.cancel&&a.cancel.bind(a.context)(e),l.reject(e)}),l.promise},e.prototype.limitToFirst=function(t){if(Object(s.L)("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if(Object(s.L)("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if(Object(s.L)("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ae("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new $(t);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new qe(n),i=this.queryParams_.orderBy(r);return e.validateQueryEndpoints_(i),new e(this.repo,this.path,i,!0)},e.prototype.orderByKey=function(){Object(s.L)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(ye);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){Object(s.L)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(ke);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){Object(s.L)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(ze);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),Object(s.L)("Query.startAt",0,2,arguments.length),te("Query.startAt",1,t,this.path,!0),oe("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),Object(s.L)("Query.endAt",0,2,arguments.length),te("Query.endAt",1,t,this.path,!0),oe("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if(Object(s.L)("Query.equalTo",1,2,arguments.length),te("Query.equalTo",1,e,this.path,!1),oe("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return Object(s.L)("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},e.prototype.toJSON=function(){return Object(s.L)("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=I(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if(Object(s.L)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var n=this.repo===t.repo,r=this.path.equals(t.path),i=this.queryIdentifier()===t.queryIdentifier();return n&&r&&i},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:null,context:null};if(t&&n)r.cancel=t,Object(s.M)(e,3,r.cancel,!0),r.context=n,Object(s.N)(e,4,r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(s.n)(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),e}(),Ye=function(){function e(){this.set={}}return e.prototype.add=function(e,t){this.set[e]=null===t||t},e.prototype.contains=function(e){return Object(s.j)(this.set,e)},e.prototype.get=function(e){return this.contains(e)?this.set[e]:void 0},e.prototype.remove=function(e){delete this.set[e]},e.prototype.clear=function(){this.set={}},e.prototype.isEmpty=function(){return Object(s.x)(this.set)},e.prototype.count=function(){return Object(s.t)(this.set)},e.prototype.each=function(e){Object(s.r)(this.set,function(t,n){return e(t,n)})},e.prototype.keys=function(){var e=[];return Object(s.r)(this.set,function(t){e.push(t)}),e},e}(),Xe=function(){function e(){this.value_=null,this.children_=null}return e.prototype.find=function(e){if(null!=this.value_)return this.value_.getChild(e);if(e.isEmpty()||null==this.children_)return null;var t=e.getFront();return e=e.popFront(),this.children_.contains(t)?this.children_.get(t).find(e):null},e.prototype.remember=function(t,n){if(t.isEmpty())this.value_=n,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(t,n);else{null==this.children_&&(this.children_=new Ye);var r=t.getFront();this.children_.contains(r)||this.children_.add(r,new e);var i=this.children_.get(r);t=t.popFront(),i.remember(t,n)}},e.prototype.forget=function(e){if(e.isEmpty())return this.value_=null,this.children_=null,!0;if(null!==this.value_){if(this.value_.isLeafNode())return!1;var t=this.value_;this.value_=null;var n=this;return t.forEachChild(ke,function(e,t){n.remember(new $(e),t)}),this.forget(e)}if(null!==this.children_){var r=e.getFront();if(e=e.popFront(),this.children_.contains(r))this.children_.get(r).forget(e)&&this.children_.remove(r);return!!this.children_.isEmpty()&&(this.children_=null,!0)}return!0},e.prototype.forEachTree=function(e,t){null!==this.value_?t(e,this.value_):this.forEachChild(function(n,r){var i=new $(e.toString()+"/"+n);r.forEachTree(i,t)})},e.prototype.forEachChild=function(e){null!==this.children_&&this.children_.each(function(t,n){e(t,n)})},e}(),Je=function(e,t){return e&&"object"==typeof e?(Object(s.e)(".sv"in e,"Unexpected leaf node or priority contents"),t[e[".sv"]]):e},et=function(e,t){var n,r=e.getPriority().val(),i=Je(r,t);if(e.isLeafNode()){var s=e,o=Je(s.getValue(),t);return o!==s.getValue()||i!==s.getPriority().val()?new Se(o,Be(i)):e}var a=e;return n=a,i!==a.getPriority().val()&&(n=n.updatePriority(new Se(i))),a.forEachChild(ke,function(e,r){var i=et(r,t);i!==r&&(n=n.updateImmediateChild(e,i))}),n};!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(He||(He={}));var tt,nt,rt=function(){function e(e,t,n,r){this.fromUser=e,this.fromServer=t,this.queryId=n,this.tagged=r,Object(s.e)(!r||t,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),it=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=He.ACK_USER_WRITE,this.source=rt.User}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Object(s.e)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new $(t));return new e($.Empty,n,this.revert)}return Object(s.e)(this.path.getFront()===t,"operationForChild called for unrelated child."),new e(this.path.popFront(),this.affectedTree,this.revert)},e}(),st=function(){return tt||(tt=new Oe(R)),tt},ot=function(){function e(e,t){void 0===t&&(t=st()),this.value=e,this.children=t}return e.fromObject=function(t){var n=e.Empty;return Object(s.r)(t,function(e,t){n=n.set(new $(e),t)}),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:$.Empty,value:this.value};if(e.isEmpty())return null;var n=e.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=i?{path:new $(n).child(i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},e.prototype.subtree=function(t){if(t.isEmpty())return this;var n=t.getFront(),r=this.children.get(n);return null!==r?r.subtree(t.popFront()):e.Empty},e.prototype.set=function(t,n){if(t.isEmpty())return new e(n,this.children);var r=t.getFront(),i=(this.children.get(r)||e.Empty).set(t.popFront(),n),s=this.children.insert(r,i);return new e(this.value,s)},e.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?e.Empty:new e(null,this.children);var n=t.getFront(),r=this.children.get(n);if(r){var i=r.remove(t.popFront()),s=void 0;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&s.isEmpty()?e.Empty:new e(this.value,s)}return this},e.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),n=this.children.get(t);return n?n.get(e.popFront()):null},e.prototype.setTree=function(t,n){if(t.isEmpty())return n;var r=t.getFront(),i=(this.children.get(r)||e.Empty).setTree(t.popFront(),n),s=void 0;return s=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,s)},e.prototype.fold=function(e){return this.fold_($.Empty,e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(e.child(r),t)}),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,$.Empty,t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(e.isEmpty())return null;var i=e.getFront(),s=this.children.get(i);return s?s.findOnPath_(e.popFront(),t.child(i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,$.Empty,t)},e.prototype.foreachOnPath_=function(t,n,r){if(t.isEmpty())return this;this.value&&r(n,this.value);var i=t.getFront(),s=this.children.get(i);return s?s.foreachOnPath_(t.popFront(),n.child(i),r):e.Empty},e.prototype.foreach=function(e){this.foreach_($.Empty,e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(n,r){r.foreach_(e.child(n),t)}),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,n){n.value&&e(t,n.value)})},e.Empty=new e(null),e}(),at=function(){function e(e,t){this.source=e,this.path=t,this.type=He.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,$.Empty):new e(this.source,this.path.popFront())},e}(),ct=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=He.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,$.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),lt=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=He.MERGE}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var n=this.children.subtree(new $(t));return n.isEmpty()?null:n.value?new ct(this.source,$.Empty,n.value):new e(this.source,$.Empty,n)}return Object(s.e)(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,this.path.popFront(),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),ht=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),ut=function(){function e(e,t){this.eventCache_=e,this.serverCache_=t}return e.prototype.updateEventSnap=function(t,n,r){return new e(new ht(t,n,r),this.serverCache_)},e.prototype.updateServerSnap=function(t,n,r){return new e(this.eventCache_,new ht(t,n,r))},e.prototype.getEventCache=function(){return this.eventCache_},e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},e.prototype.getServerCache=function(){return this.serverCache_},e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},e.Empty=new e(new ht(Fe.EMPTY_NODE,!1,!1),new ht(Fe.EMPTY_NODE,!1,!1)),e}(),dt=function(){function e(e,t,n,r,i){this.type=e,this.snapshotNode=t,this.childName=n,this.oldSnap=r,this.prevName=i}return e.valueChange=function(t){return new e(e.VALUE,t)},e.childAddedChange=function(t,n){return new e(e.CHILD_ADDED,n,t)},e.childRemovedChange=function(t,n){return new e(e.CHILD_REMOVED,n,t)},e.childChangedChange=function(t,n,r){return new e(e.CHILD_CHANGED,n,t,r)},e.childMovedChange=function(t,n){return new e(e.CHILD_MOVED,n,t)},e.CHILD_ADDED="child_added",e.CHILD_REMOVED="child_removed",e.CHILD_CHANGED="child_changed",e.CHILD_MOVED="child_moved",e.VALUE="value",e}(),pt=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){Object(s.e)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(dt.childRemovedChange(t,a)):Object(s.e)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(dt.childAddedChange(t,n)):o.trackChildChange(dt.childChangedChange(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(ke,function(e,r){t.hasChild(e)||n.trackChildChange(dt.childRemovedChange(e,r))}),t.isLeafNode()||t.forEachChild(ke,function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(dt.childChangedChange(t,r,i))}else n.trackChildChange(dt.childAddedChange(t,r))})),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?Fe.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),ft=function(){function e(){this.changeMap_={}}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;Object(s.e)(t==dt.CHILD_ADDED||t==dt.CHILD_CHANGED||t==dt.CHILD_REMOVED,"Only child changes supported for tracking"),Object(s.e)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=Object(s.H)(this.changeMap_,n);if(r){var i=r.type;if(t==dt.CHILD_ADDED&&i==dt.CHILD_REMOVED)this.changeMap_[n]=dt.childChangedChange(n,e.snapshotNode,r.snapshotNode);else if(t==dt.CHILD_REMOVED&&i==dt.CHILD_ADDED)delete this.changeMap_[n];else if(t==dt.CHILD_REMOVED&&i==dt.CHILD_CHANGED)this.changeMap_[n]=dt.childRemovedChange(n,r.oldSnap);else if(t==dt.CHILD_CHANGED&&i==dt.CHILD_ADDED)this.changeMap_[n]=dt.childAddedChange(n,e.snapshotNode);else{if(t!=dt.CHILD_CHANGED||i!=dt.CHILD_CHANGED)throw Object(s.f)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap_[n]=dt.childChangedChange(n,e.snapshotNode,r.oldSnap)}}else this.changeMap_[n]=e},e.prototype.getChanges=function(){return Object(s.u)(this.changeMap_)},e}(),mt=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),yt=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new ht(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},e}(),gt=function(){return function(e,t){this.viewCache=e,this.changes=t}}(),_t=function(){function e(e){this.filter_=e}return e.prototype.assertIndexed=function(e){Object(s.e)(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Object(s.e)(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},e.prototype.applyOperation=function(t,n,r,i){var o,a,c=new ft;if(n.type===He.OVERWRITE){var l=n;l.source.fromUser?o=this.applyUserOverwrite_(t,l.path,l.snap,r,i,c):(Object(s.e)(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.getServerCache().isFiltered()&&!l.path.isEmpty(),o=this.applyServerOverwrite_(t,l.path,l.snap,r,i,a,c))}else if(n.type===He.MERGE){var h=n;h.source.fromUser?o=this.applyUserMerge_(t,h.path,h.children,r,i,c):(Object(s.e)(h.source.fromServer,"Unknown source."),a=h.source.tagged||t.getServerCache().isFiltered(),o=this.applyServerMerge_(t,h.path,h.children,r,i,a,c))}else if(n.type===He.ACK_USER_WRITE){var u=n;o=u.revert?this.revertUserWrite_(t,u.path,r,i,c):this.ackUserWrite_(t,u.path,u.affectedTree,r,i,c)}else{if(n.type!==He.LISTEN_COMPLETE)throw Object(s.f)("Unknown operation type: "+n.type);o=this.listenComplete_(t,n.path,r,c)}var d=c.getChanges();return e.maybeAddValueEvent_(t,o,d),new gt(o,d)},e.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=e.getCompleteEventSnap();(n.length>0||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(dt.valueChange(t.getCompleteEventSnap()))}},e.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,r,i){var o=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var a=void 0,c=void 0;if(t.isEmpty())if(Object(s.e)(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var l=e.getCompleteServerSnap(),h=l instanceof Fe?l:Fe.EMPTY_NODE,u=n.calcCompleteEventChildren(h);a=this.filter_.updateFullNode(e.getEventCache().getNode(),u,i)}else{var d=n.calcCompleteEventCache(e.getCompleteServerSnap());a=this.filter_.updateFullNode(e.getEventCache().getNode(),d,i)}else{var p=t.getFront();if(".priority"==p){Object(s.e)(1==t.getLength(),"Can't have a priority with additional path components");var f=o.getNode();c=e.getServerCache().getNode();var m=n.calcEventCacheAfterServerOverwrite(t,f,c);a=null!=m?this.filter_.updatePriority(f,m):o.getNode()}else{var y=t.popFront(),g=void 0;if(o.isCompleteForChild(p)){c=e.getServerCache().getNode();var _=n.calcEventCacheAfterServerOverwrite(t,o.getNode(),c);g=null!=_?o.getNode().getImmediateChild(p).updateChild(y,_):o.getNode().getImmediateChild(p)}else g=n.calcCompleteChild(p,e.getServerCache());a=null!=g?this.filter_.updateChild(o.getNode(),p,g,y,r,i):o.getNode()}}return e.updateEventSnap(a,o.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},e.prototype.applyServerOverwrite_=function(e,t,n,r,i,s,o){var a,c=e.getServerCache(),l=s?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())a=l.updateFullNode(c.getNode(),n,null);else if(l.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(t,n);a=l.updateFullNode(c.getNode(),h,null)}else{var u=t.getFront();if(!c.isCompleteForPath(t)&&t.getLength()>1)return e;var d=t.popFront(),p=c.getNode().getImmediateChild(u).updateChild(d,n);a=".priority"==u?l.updatePriority(c.getNode(),p):l.updateChild(c.getNode(),u,p,d,mt,null)}var f=e.updateServerSnap(a,c.isFullyInitialized()||t.isEmpty(),l.filtersNodes()),m=new yt(r,f,i);return this.generateEventCacheAfterServerEvent_(f,t,r,m,o)},e.prototype.applyUserOverwrite_=function(e,t,n,r,i,s){var o,a,c=e.getEventCache(),l=new yt(r,e,i);if(t.isEmpty())a=this.filter_.updateFullNode(e.getEventCache().getNode(),n,s),o=e.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var h=t.getFront();if(".priority"===h)a=this.filter_.updatePriority(e.getEventCache().getNode(),n),o=e.updateEventSnap(a,c.isFullyInitialized(),c.isFiltered());else{var u=t.popFront(),d=c.getNode().getImmediateChild(h),p=void 0;if(u.isEmpty())p=n;else{var f=l.getCompleteChild(h);p=null!=f?".priority"===u.getBack()&&f.getChild(u.parent()).isEmpty()?f:f.updateChild(u,n):Fe.EMPTY_NODE}if(d.equals(p))o=e;else{var m=this.filter_.updateChild(c.getNode(),h,p,u,l,s);o=e.updateEventSnap(m,c.isFullyInitialized(),this.filter_.filtersNodes())}}}return o},e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},e.prototype.applyUserMerge_=function(t,n,r,i,s,o){var a=this,c=t;return r.foreach(function(r,l){var h=n.child(r);e.cacheHasChild_(t,h.getFront())&&(c=a.applyUserOverwrite_(c,h,l,i,s,o))}),r.foreach(function(r,l){var h=n.child(r);e.cacheHasChild_(t,h.getFront())||(c=a.applyUserOverwrite_(c,h,l,i,s,o))}),c},e.prototype.applyMerge_=function(e,t){return t.foreach(function(t,n){e=e.updateChild(t,n)}),e},e.prototype.applyServerMerge_=function(e,t,n,r,i,s,o){var a=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var c,l=e;c=t.isEmpty()?n:ot.Empty.setTree(t,n);var h=e.getServerCache().getNode();return c.children.inorderTraversal(function(t,n){if(h.hasChild(t)){var c=e.getServerCache().getNode().getImmediateChild(t),u=a.applyMerge_(c,n);l=a.applyServerOverwrite_(l,new $(t),u,r,i,s,o)}}),c.children.inorderTraversal(function(t,n){var c=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!h.hasChild(t)&&!c){var u=e.getServerCache().getNode().getImmediateChild(t),d=a.applyMerge_(u,n);l=a.applyServerOverwrite_(l,new $(t),d,r,i,s,o)}}),l},e.prototype.ackUserWrite_=function(e,t,n,r,i,s){if(null!=r.shadowingWrite(t))return e;var o=e.getServerCache().isFiltered(),a=e.getServerCache();if(null!=n.value){if(t.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,a.getNode().getChild(t),r,i,o,s);if(t.isEmpty()){var c=ot.Empty;return a.getNode().forEachChild(ye,function(e,t){c=c.set(new $(e),t)}),this.applyServerMerge_(e,t,c,r,i,o,s)}return e}var l=ot.Empty;return n.foreach(function(e,n){var r=t.child(e);a.isCompleteForPath(r)&&(l=l.set(e,a.getNode().getChild(r)))}),this.applyServerMerge_(e,t,l,r,i,o,s)},e.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),s=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(s,t,n,mt,r)},e.prototype.revertUserWrite_=function(e,t,n,r,i){var o;if(null!=n.shadowingWrite(t))return e;var a=new yt(n,e,r),c=e.getEventCache().getNode(),l=void 0;if(t.isEmpty()||".priority"===t.getFront()){var h=void 0;if(e.getServerCache().isFullyInitialized())h=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var u=e.getServerCache().getNode();Object(s.e)(u instanceof Fe,"serverChildren would be complete if leaf node"),h=n.calcCompleteEventChildren(u)}h=h,l=this.filter_.updateFullNode(c,h,i)}else{var d=t.getFront(),p=n.calcCompleteChild(d,e.getServerCache());null==p&&e.getServerCache().isCompleteForChild(d)&&(p=c.getImmediateChild(d)),(l=null!=p?this.filter_.updateChild(c,d,p,t.popFront(),a,i):e.getEventCache().getNode().hasChild(d)?this.filter_.updateChild(c,d,Fe.EMPTY_NODE,t.popFront(),a,i):c).isEmpty()&&e.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(l=this.filter_.updateFullNode(l,o,i))}return o=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite($.Empty),e.updateEventSnap(l,o,this.filter_.filtersNodes())},e}(),vt=function(){function e(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return e.prototype.generateEventsForChanges=function(e,t,n){var r=this,i=[],s=[];return e.forEach(function(e){e.type===dt.CHILD_CHANGED&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push(dt.childMovedChange(e.childName,e.snapshotNode))}),this.generateEventsForType_(i,dt.CHILD_REMOVED,e,n,t),this.generateEventsForType_(i,dt.CHILD_ADDED,e,n,t),this.generateEventsForType_(i,dt.CHILD_MOVED,s,n,t),this.generateEventsForType_(i,dt.CHILD_CHANGED,e,n,t),this.generateEventsForType_(i,dt.VALUE,e,n,t),i},e.prototype.generateEventsForType_=function(e,t,n,r,i){var s=this,o=n.filter(function(e){return e.type===t});o.sort(this.compareChanges_.bind(this)),o.forEach(function(t){var n=s.materializeSingleChange_(t,i);r.forEach(function(r){r.respondsTo(t.type)&&e.push(r.createEvent(n,s.query_))})})},e.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type?e:(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_),e)},e.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw Object(s.f)("Should only compare child_ events.");var n=new pe(e.childName,e.snapshotNode),r=new pe(t.childName,t.snapshotNode);return this.index_.compare(n,r)},e}(),bt=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new pt(n.getIndex()),i=n.getNodeFilter();this.processor_=new _t(i);var s=t.getServerCache(),o=t.getEventCache(),a=r.updateFullNode(Fe.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(Fe.EMPTY_NODE,o.getNode(),null),l=new ht(a,s.isFullyInitialized(),r.filtersNodes()),h=new ht(c,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=new ut(h,l),this.eventGenerator_=new vt(this.query_)}return e.prototype.getQuery=function(){return this.query_},e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},e.prototype.removeEventRegistration=function(e,t){var n=[];if(t){Object(s.e)(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(e){t=t;var i=e.createCancelEvent(t,r);i&&n.push(i)})}if(e){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(e)){if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},e.prototype.applyOperation=function(e,t,n){e.type===He.MERGE&&null!==e.source.queryId&&(Object(s.e)(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Object(s.e)(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,e,t,n);return this.processor_.assertIndexed(i.viewCache),Object(s.e)(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(ke,function(e,t){n.push(dt.childAddedChange(e,t))});return t.isFullyInitialized()&&n.push(dt.valueChange(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},e.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},e}(),wt=function(){function e(){this.views_={}}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(s.e)(nt,"Reference.ts has not been loaded"),nt},set:function(e){Object(s.e)(!nt,"__referenceConstructor has already been defined"),nt=e},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return Object(s.x)(this.views_)},e.prototype.applyOperation=function(e,t,n){var r=e.source.queryId;if(null!==r){var i=Object(s.H)(this.views_,r);return Object(s.e)(null!=i,"SyncTree gave us an op for an invalid query."),i.applyOperation(e,t,n)}var o=[];return Object(s.r)(this.views_,function(r,i){o=o.concat(i.applyOperation(e,t,n))}),o},e.prototype.addEventRegistration=function(e,t,n,r,i){var o=e.queryIdentifier(),a=Object(s.H)(this.views_,o);if(!a){var c=n.calcCompleteEventCache(i?r:null),l=!1;c?l=!0:r instanceof Fe?(c=n.calcCompleteEventChildren(r),l=!1):(c=Fe.EMPTY_NODE,l=!1);var h=new ut(new ht(c,l,!1),new ht(r,i,!1));a=new bt(e,h),this.views_[o]=a}return a.addEventRegistration(t),a.getInitialEvents(t)},e.prototype.removeEventRegistration=function(t,n,r){var i=t.queryIdentifier(),o=[],a=[],c=this.hasCompleteView();if("default"===i){var l=this;Object(s.r)(this.views_,function(e,t){a=a.concat(t.removeEventRegistration(n,r)),t.isEmpty()&&(delete l.views_[e],t.getQuery().getQueryParams().loadsAllData()||o.push(t.getQuery()))})}else{var h=Object(s.H)(this.views_,i);h&&(a=a.concat(h.removeEventRegistration(n,r)),h.isEmpty()&&(delete this.views_[i],h.getQuery().getQueryParams().loadsAllData()||o.push(h.getQuery())))}return c&&!this.hasCompleteView()&&o.push(new e.__referenceConstructor(t.repo,t.path)),{removed:o,events:a}},e.prototype.getQueryViews=function(){var e=this;return Object.keys(this.views_).map(function(t){return e.views_[t]}).filter(function(e){return!e.getQuery().getQueryParams().loadsAllData()})},e.prototype.getCompleteServerCache=function(e){var t=null;return Object(s.r)(this.views_,function(n,r){t=t||r.getCompleteServerCache(e)}),t},e.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return Object(s.H)(this.views_,t)},e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},e.prototype.getCompleteView=function(){return Object(s.q)(this.views_,function(e){return e.getQuery().getQueryParams().loadsAllData()})||null},e}(),St=function(){function e(e){this.writeTree_=e}return e.prototype.addWrite=function(t,n){if(t.isEmpty())return new e(new ot(n));var r=this.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,s=r.value,o=$.relativePath(i,t);return s=s.updateChild(o,n),new e(this.writeTree_.set(i,s))}var a=new ot(n);return new e(this.writeTree_.setTree(t,a))},e.prototype.addWrites=function(e,t){var n=this;return Object(s.r)(t,function(t,r){n=n.addWrite(e.child(t),r)}),n},e.prototype.removeWrite=function(t){return t.isEmpty()?e.Empty:new e(this.writeTree_.setTree(t,ot.Empty))},e.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild($.relativePath(t.path,e)):null},e.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(ke,function(t,n){e.push(new pe(t,n))}):this.writeTree_.children.inorderTraversal(function(t,n){null!=n.value&&e.push(new pe(t,n.value))}),e},e.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var n=this.getCompleteNode(t);return new e(null!=n?new ot(n):this.writeTree_.subtree(t))},e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},e.prototype.apply=function(t){return e.applySubtreeWrite_($.Empty,this.writeTree_,t)},e.Empty=new e(new ot(null)),e.applySubtreeWrite_=function(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(Object(s.e)(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=e.applySubtreeWrite_(t.child(n),o,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(t.child(".priority"),i)),r},e}(),Ct=function(){function e(){this.visibleWrites_=St.Empty,this.allWrites_=[],this.lastWriteId_=-1}return e.prototype.childWrites=function(e){return new Et(e,this)},e.prototype.addOverwrite=function(e,t,n,r){Object(s.e)(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=n},e.prototype.addMerge=function(e,t,n){Object(s.e)(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=n},e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},e.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex(function(t){return t.writeId===e});Object(s.e)(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&a>=0;){var c=this.allWrites_[a];c.visible&&(a>=n&&this.recordContainsPath_(c,r.path)?i=!1:r.path.contains(c.path)&&(o=!0)),a--}if(i){if(o)return this.resetTree_(),!0;if(r.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(r.path);else{var l=r.children;Object(s.r)(l,function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(r.path.child(e))})}return!0}return!1},e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcCompleteEventCache=function(t,n,r,i){if(r||i){var s=this.visibleWrites_.childCompoundWrite(t);if(!i&&s.isEmpty())return n;if(i||null!=n||s.hasCompleteWrite($.Empty)){var o=e.layerTree_(this.allWrites_,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))},t);l=n||Fe.EMPTY_NODE;return o.apply(l)}return null}var a=this.visibleWrites_.getCompleteNode(t);if(null!=a)return a;var c=this.visibleWrites_.childCompoundWrite(t);if(c.isEmpty())return n;if(null!=n||c.hasCompleteWrite($.Empty)){var l=n||Fe.EMPTY_NODE;return c.apply(l)}return null},e.prototype.calcCompleteEventChildren=function(e,t){var n=Fe.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(ke,function(e,t){n=n.updateImmediateChild(e,t)}),n;if(t){var i=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(ke,function(e,t){var r=i.childCompoundWrite(new $(e)).apply(t);n=n.updateImmediateChild(e,r)}),i.getCompleteChildren().forEach(function(e){n=n.updateImmediateChild(e.name,e.node)}),n}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach(function(e){n=n.updateImmediateChild(e.name,e.node)}),n},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,r){Object(s.e)(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=e.child(t);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(t):o.apply(r.getChild(t))},e.prototype.calcCompleteChild=function(e,t,n){var r=e.child(t),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(t)):null},e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcIndexedSlice=function(e,t,n,r,i,s){var o,a=this.visibleWrites_.childCompoundWrite(e),c=a.getCompleteNode($.Empty);if(null!=c)o=c;else{if(null==t)return[];o=a.apply(t)}if((o=o.withIndex(s)).isEmpty()||o.isLeafNode())return[];for(var l=[],h=s.getCompare(),u=i?o.getReverseIteratorFrom(n,s):o.getIteratorFrom(n,s),d=u.getNext();d&&l.length<r;)0!==h(d,n)&&l.push(d),d=u.getNext();return l},e.prototype.recordContainsPath_=function(e,t){return e.snap?e.path.contains(t):!!Object(s.p)(e.children,function(n,r){return e.path.child(r).contains(t)})},e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,$.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},e.DefaultFilter_=function(e){return e.visible},e.layerTree_=function(e,t,n){for(var r=St.Empty,i=0;i<e.length;++i){var o=e[i];if(t(o)){var a=o.path,c=void 0;if(o.snap)n.contains(a)?(c=$.relativePath(n,a),r=r.addWrite(c,o.snap)):a.contains(n)&&(c=$.relativePath(a,n),r=r.addWrite($.Empty,o.snap.getChild(c)));else{if(!o.children)throw Object(s.f)("WriteRecord should have .snap or .children");if(n.contains(a))c=$.relativePath(n,a),r=r.addWrites(c,o.children);else if(a.contains(n))if((c=$.relativePath(a,n)).isEmpty())r=r.addWrites($.Empty,o.children);else{var l=Object(s.H)(o.children,c.getFront());if(l){var h=l.getChild(c.popFront());r=r.addWrite($.Empty,h)}}}}}return r},e}(),Et=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},e.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),kt=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=ot.Empty,this.pendingWriteTree_=new Ct,this.tagToQueryMap_={},this.queryToTagMap_={}}return e.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new ct(rt.User,e,t)):[]},e.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=ot.fromObject(t);return this.applyOperationToSyncPoints_(new lt(rt.User,e,r))},e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=ot.Empty;return null!=n.snap?r=r.set($.Empty,!0):Object(s.r)(n.children,function(e,t){r=r.set(new $(e),t)}),this.applyOperationToSyncPoints_(new it(n.path,r,t))}return[]},e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new ct(rt.Server,e,t))},e.prototype.applyServerMerge=function(e,t){var n=ot.fromObject(t);return this.applyOperationToSyncPoints_(new lt(rt.Server,e,n))},e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new at(rt.Server,e))},e.prototype.applyTaggedQueryOverwrite=function(t,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var s=e.parseQueryKey_(i),o=s.path,a=s.queryId,c=$.relativePath(o,t),l=new ct(rt.forServerTaggedQuery(a),c,n);return this.applyTaggedOperation_(o,l)}return[]},e.prototype.applyTaggedQueryMerge=function(t,n,r){var i=this.queryKeyForTag_(r);if(i){var s=e.parseQueryKey_(i),o=s.path,a=s.queryId,c=$.relativePath(o,t),l=ot.fromObject(n),h=new lt(rt.forServerTaggedQuery(a),c,l);return this.applyTaggedOperation_(o,h)}return[]},e.prototype.applyTaggedListenComplete=function(t,n){var r=this.queryKeyForTag_(n);if(r){var i=e.parseQueryKey_(r),s=i.path,o=i.queryId,a=$.relativePath(s,t),c=new at(rt.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(s,c)}return[]},e.prototype.addEventRegistration=function(t,n){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(e,t){var n=$.relativePath(e,r);i=i||t.getCompleteServerCache(n),o=o||t.hasCompleteView()});var a,c=this.syncPointTree_.get(r);(c?(o=o||c.hasCompleteView(),i=i||c.getCompleteServerCache($.Empty)):(c=new wt,this.syncPointTree_=this.syncPointTree_.set(r,c)),null!=i)?a=!0:(a=!1,i=Fe.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(e,t){var n=t.getCompleteServerCache($.Empty);n&&(i=i.updateImmediateChild(e,n))}));var l=c.viewExistsForQuery(t);if(!l&&!t.getQueryParams().loadsAllData()){var h=e.makeQueryKey_(t);Object(s.e)(!(h in this.queryToTagMap_),"View does not exist, but we have a tag");var u=e.getNextQueryTag_();this.queryToTagMap_[h]=u,this.tagToQueryMap_["_"+u]=h}var d=this.pendingWriteTree_.childWrites(r),p=c.addEventRegistration(t,n,d,i,a);if(!l&&!o){var f=c.viewForQuery(t);p=p.concat(this.setupListener_(t,f))}return p},e.prototype.removeEventRegistration=function(t,n,r){var i=this,s=t.path,o=this.syncPointTree_.get(s),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var c=o.removeEventRegistration(t,n,r);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(s));var l=c.removed;a=c.events;var h=-1!==l.findIndex(function(e){return e.getQueryParams().loadsAllData()}),u=this.syncPointTree_.findOnPath(s,function(e,t){return t.hasCompleteView()});if(h&&!u){var d=this.syncPointTree_.subtree(s);if(!d.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(d),f=0;f<p.length;++f){var m=p[f],y=m.getQuery(),g=this.createListenerForView_(m);this.listenProvider_.startListening(e.queryForListening_(y),this.tagForQuery_(y),g.hashFn,g.onComplete)}}if(!u&&l.length>0&&!r)if(h){this.listenProvider_.stopListening(e.queryForListening_(t),null)}else l.forEach(function(t){var n=i.queryToTagMap_[e.makeQueryKey_(t)];i.listenProvider_.stopListening(e.queryForListening_(t),n)});this.removeTags_(l)}return a},e.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,function(t,n){var r=$.relativePath(t,e),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(e,r,t,!0)},e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),Object(s.r)(n,function(e,t){r=r.concat(t)}),r})},e.prototype.removeTags_=function(t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(r),s=this.queryToTagMap_[i];delete this.queryToTagMap_[i],delete this.tagToQueryMap_["_"+s]}}},e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},e.prototype.setupListener_=function(t,n){var r=t.path,i=this.tagForQuery_(t),o=this.createListenerForView_(n),a=this.listenProvider_.startListening(e.queryForListening_(t),i,o.hashFn,o.onComplete),c=this.syncPointTree_.subtree(r);if(i)Object(s.e)(!c.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var l=c.fold(function(e,t,n){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map(function(e){return e.getQuery()}))),Object(s.r)(n,function(e,t){r=r.concat(t)}),r}),h=0;h<l.length;++h){var u=l[h];this.listenProvider_.stopListening(e.queryForListening_(u),this.tagForQuery_(u))}return a},e.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||Fe.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==e?n="Client doesn't have permission to access the desired data.":"unavailable"==e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,n);return t.removeEventRegistration(n,null,i)}}},e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},e.parseQueryKey_=function(e){var t=e.indexOf("$");return Object(s.e)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new $(e.substr(0,t))}},e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap_["_"+e]},e.prototype.tagForQuery_=function(t){var n=e.makeQueryKey_(t);return Object(s.H)(this.queryToTagMap_,n)},e.getNextQueryTag_=function(){return e.nextQueryTag_++},e.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);Object(s.e)(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,r,null)},e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites($.Empty))},e.prototype.applyOperationHelper_=function(e,t,n,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get($.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache($.Empty));var s=[],o=e.path.getFront(),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){var l=n?n.getImmediateChild(o):null,h=r.child(o);s=s.concat(this.applyOperationHelper_(a,c,l,h))}return i&&(s=s.concat(i.applyOperation(e,r,n))),s},e.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,s=t.get($.Empty);null==n&&null!=s&&(n=s.getCompleteServerCache($.Empty));var o=[];return t.children.inorderTraversal(function(t,s){var a=n?n.getImmediateChild(t):null,c=r.child(t),l=e.operationForChild(t);l&&(o=o.concat(i.applyOperationDescendantsHelper_(l,s,a,c)))}),s&&(o=o.concat(s.applyOperation(e,r,n))),o},e.nextQueryTag_=1,e}(),Tt=function(){function e(){this.rootNode_=Fe.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),xt=function(){function e(e){this.app_=e}return e.prototype.getToken=function(e){return this.app_.INTERNAL.getToken(e).then(null,function(e){return e&&"auth/token-not-initialized"===e.code?(v("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})},e.prototype.addTokenChangeListener=function(e){this.app_.INTERNAL.addAuthTokenListener(e)},e.prototype.removeTokenChangeListener=function(e){this.app_.INTERNAL.removeAuthTokenListener(e)},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',C(e)},e}(),Rt=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),Object(s.j)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return Object(s.l)(this.counters_)},e}(),Ot=function(){function e(){}return e.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new Rt),this.collections_[t]},e.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},e.collections_={},e.reporters_={},e}(),It=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=Object(s.i)(e);return this.last_&&Object(s.r)(this.last_,function(e,n){t[e]=t[e]-n}),this.last_=e,t},e}(),Pt=1e4,Nt=3e4,At=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new It(e);var n=Pt+(Nt-Pt)*Math.random();L(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.includeStat=function(e){this.statsToReport_[e]=!0},e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;Object(s.r)(t,function(t,i){i>0&&Object(s.j)(e.statsToReport_,t)&&(n[t]=i,r=!0)}),r&&this.server_.reportStats(n),L(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}(),Dt=function(){function e(){this.eventLists_=[],this.recursionDepth_=0}return e.prototype.queueEvents=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n],i=r.getPath();null===t||i.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new Mt(i)),t.add(r)}t&&this.eventLists_.push(t)},e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)e(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):t=!1}t&&(this.eventLists_=[]),this.recursionDepth_--},e}(),Mt=function(){function e(e){this.path_=e,this.events_=[]}return e.prototype.add=function(e){this.events_.push(e)},e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var n=t.getEventRunner();y&&v("event: "+t.toString()),j(n)}}},e.prototype.getPath=function(){return this.path_},e}(),jt=function(){function e(e){this.allowedEvents_=e,this.listeners_={},Object(s.e)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=this.listeners_[e].slice(),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){Object(s.e)(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},e}(),Ft=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))},!1),r}return Object(i.b)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(s.e)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(jt),Lt=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(s.y)()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return Object(i.b)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(s.e)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(jt),$t=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&j(function(){n.onMessage_(e[t])})},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),Bt="pLPCommand",Ut="pRTLPCB",Ht=function(){function e(e,t,n,r){this.connId=e,this.repoInfo=t,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=b(e),this.stats_=Ot.getCollection(t),this.urlFn=function(e){return t.connectionURL(U,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new $t(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if(Object(s.A)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new zt(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e[1],s=e[2];if(n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==r)n.id=i,n.password=s;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(i,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(r,i)},function(){n.onClosed_()},n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),!Object(s.A)()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,function(){})}})},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return e.forceAllow_||!e.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!Object(s.A)()},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=Object(s.K)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=Object(s.h)(t),r=P(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!Object(s.A)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=Object(s.K)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),zt=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Ye,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(s.A)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=p(),window[Bt+this.uniqueCallbackIdentifier]=t,window[Ut+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(e){v("frame writing exception"),e.stack&&v(e.stack),v(e)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||v("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var t=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0))),Object(s.A)()&&this.myID){var n={disconn:"t"};n.id=this.myID,n.pw=this.myPW;var r=this.urlFn(n);e.nodeRestRequest(r)}var i=this.onDisconnect;i&&(this.onDisconnect=null,i())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t,1);var r=function(){n.outstandingRequests.remove(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,function(){clearTimeout(i),r()})},e.prototype.addTag=function(e,t){var n=this;Object(s.A)()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){v("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}},Math.floor(1))},e}(),qt=null;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */"undefined"!=typeof MozWebSocket?qt=MozWebSocket:"undefined"!=typeof WebSocket&&(qt=WebSocket);var Wt=function(){function e(t,n,r,i){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=b(this.connId),this.stats_=Ot.getCollection(n),this.connURL=e.connectionURL_(n,r,i)}return e.connectionURL_=function(e,t,n){var r={v:"5"};return!Object(s.A)()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),e.connectionURL("websocket",r)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,h.set("previous_websocket_failure",!0);try{if(Object(s.A)()){var i=s.a.NODE_ADMIN?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+r.a.SDK_VERSION+"/"+process.platform+"/"+i}},a=process.env,c=0==this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;c&&(o.proxy={origin:c}),this.mySock=new qt(this.connURL,[],o)}else this.mySock=new qt(this.connURL)}catch(e){this.log_("Error instantiating WebSocket.");var l=e.message||e.data;return l&&this.log_(l),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==qt&&!e.forceDisallow_},e.previouslyFailed=function(){return h.isInMemoryStorage||!0===h.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){h.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length==this.totalFrames){var t=this.frames.join("");this.frames=null;var n=Object(s.D)(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if(Object(s.e)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=Object(s.K)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=P(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(45e3))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),Vt=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Ht,Wt]},enumerable:!0,configurable:!0}),e.prototype.initTransports_=function(t){var n=Wt&&Wt.isAvailable(),r=n&&!Wt.previouslyFailed();if(t.webSocketOnly&&(n||C("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Wt];else{var i=this.transports_=[];N(e.ALL_TRANSPORTS,function(e,t){t&&t.isAvailable()&&i.push(t)})}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),Kt=function(){function e(e,t,n,r,i,s,o){this.id=e,this.repoInfo_=t,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=s,this.lastSessionId=o,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=b("c:"+this.id+":"),this.transportManager_=new Vt(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(n,r)},Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=L(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!=t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=O("t",e),n=O("d",e);if("c"==t)this.onSecondaryControl_(n);else{if("d"!=t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=O("t",e),n=O("d",e);"c"==t?this.onControl_(n):"d"==t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=O("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?w("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):w("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&C("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),L(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):L(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(h.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),Qt=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),Gt=1e3,Zt=3e5,Yt=function(e){function t(n,r,i,o,a,c){var l=e.call(this)||this;if(l.repoInfo_=n,l.onDataUpdate_=r,l.onConnectStatus_=i,l.onServerInfoUpdate_=o,l.authTokenProvider_=a,l.authOverride_=c,l.id=t.nextPersistentConnectionId_++,l.log_=b("p:"+l.id+":"),l.interruptReasons_={},l.listens_={},l.outstandingPuts_=[],l.outstandingPutCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=Gt,l.maxReconnectDelay_=Zt,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,c&&!Object(s.A)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),Ft.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&Lt.getInstance().on("online",l.onOnline_,l),l}return Object(i.b)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Object(s.K)(i)),Object(s.e)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.listen=function(e,t,n,r){var i=e.queryIdentifier(),o=e.path.toString();this.log_("Listen called for "+o+" "+i),this.listens_[o]=this.listens_[o]||{},Object(s.e)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Object(s.e)(!this.listens_[o][i],"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens_[o][i]=a,this.connected_&&this.sendListen_(a)},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),s=r.queryIdentifier();this.log_("Listen on "+i+" for "+s);var o={p:i};e.tag&&(o.q=r.queryObject(),o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,function(o){var a=o.d,c=o.s;t.warnOnListenWarnings_(a,r),(n.listens_[i]&&n.listens_[i][s])===e&&(n.log_("listen response",o),"ok"!==c&&n.removeListen_(i,s),e.onComplete&&e.onComplete(c,a))})},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&Object(s.j)(e,"w")){var n=Object(s.H)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',i=t.path.toString();C("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||Object(s.v)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=Object(s.C)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Object(s.e)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)})},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}})}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+Object(s.K)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):w("Unrecognized action received from server: "+Object(s.K)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;Object(s.e)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Gt,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Gt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Gt),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+t.nextConnectionId_++,o=this,a=this.lastSessionId,c=!1,l=null,h=function(){l?l.close():(c=!0,r())};this.realtime_={close:h,sendRequest:function(e){Object(s.e)(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)}};var u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(u).then(function(t){c?v("getToken() completed but was canceled"):(v("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,l=new Kt(i,o.repoInfo_,e,n,r,function(e){C(e+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(e){o.log_("Failed to get token: "+e),c||(s.a.NODE_ADMIN&&C(e),h())})}},t.prototype.interrupt=function(e){v("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){v("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(s.x)(this.interruptReasons_)&&(this.reconnectDelay_=Gt,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map(function(e){return I(e)}).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new $(e).toString();return void 0!==this.listens_[r]?(n=this.listens_[r][t],delete this.listens_[r][t],0===Object(s.t)(this.listens_[r])&&delete this.listens_[r]):n=void 0,n},t.prototype.onAuthRevoked_=function(e,t){v("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e=this;this.tryAuth(),Object(s.r)(this.listens_,function(t,n){Object(s.r)(n,function(t,n){e.sendListen_(n)})});for(var t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){var n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}},t.prototype.sendConnectStats_=function(){var e={},t="js";s.a.NODE_ADMIN?t="admin_node":s.a.NODE_CLIENT&&(t="node"),e["sdk."+t+"."+r.a.SDK_VERSION.replace(/\./g,"-")]=1,Object(s.y)()?e["framework.cordova"]=1:Object(s.B)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=Lt.getInstance().currentlyOnline();return Object(s.x)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(Qt),Xt=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=b("p:rest:"),i.listens_={},i}return Object(i.b)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(Object(s.e)(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,r,i){var o=this,a=e.path.toString();this.log_("Listen called for "+a+" "+e.queryIdentifier());var c=t.getListenId_(e,r),l={};this.listens_[c]=l;var h=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",h,function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(a,n,!1,r),Object(s.H)(o.listens_,c)===l)&&i(e?401==e?"permission_denied":"rest_error:"+e:"ok",null)})},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var o=i&&i.accessToken;o&&(t.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+Object(s.G)(t);r.log_("Sending REST request for "+a);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(n&&4===c.readyState){r.log_("REST Response for "+a+" received. status:",c.status,"response:",c.responseText);var e=null;if(c.status>=200&&c.status<300){try{e=Object(s.D)(c.responseText)}catch(e){C("Failed to parse JSON response for "+a+": "+c.responseText)}n(null,e)}else 401!==c.status&&404!==c.status&&C("Got unsuccessful REST response for "+a+" Status: "+c.status),n(c.status);n=null}},c.open("GET",a,!0),c.send()})},t}(Qt),Jt=function(){function e(e,t,n){var r=this;this.repoInfo_=e,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Dt,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Xe,this.persistentConnection_=null;var i=new xt(n);if(this.stats_=Ot.getCollection(e),t||F())this.server_=new Xt(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(null!=o){if("object"!=typeof o)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(s.K)(o)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}this.persistentConnection_=new Yt(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,o),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(e){r.server_.refreshAuthToken(e)}),this.statsReporter_=Ot.getOrCreateReporter(e,function(){return new At(r.stats_,r.server_)}),this.transactions_init_(),this.infoData_=new Tt,this.infoSyncTree_=new kt({startListening:function(e,t,n,i){var s=[],o=r.infoData_.getNode(e.path);return o.isEmpty()||(s=r.infoSyncTree_.applyServerOverwrite(e.path,o),setTimeout(function(){i("ok")},0)),s},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new kt({startListening:function(e,t,n,i){return r.server_.listen(e,n,t,function(t,n){var s=i(t,n);r.eventQueue_.raiseEventsForChangedPath(e.path,s)}),[]},stopListening:function(e,t){r.server_.unlisten(e,t)}})}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e.prototype.name=function(){return this.repoInfo_.namespace},e.prototype.serverTime=function(){var e=this.infoData_.getNode(new $(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},e.prototype.generateServerValues=function(){return(e=(e={timestamp:this.serverTime()})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e},e.prototype.onDataUpdate_=function(e,t,n,r){this.dataUpdateCount++;var i=new $(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var o=[];if(r)if(n){var a=Object(s.E)(t,function(e){return Be(e)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var c=Be(t);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,c,r)}else if(n){var l=Object(s.E)(t,function(e){return Be(e)});o=this.serverSyncTree_.applyServerMerge(i,l)}else{var h=Be(t);o=this.serverSyncTree_.applyServerOverwrite(i,h)}var u=i;o.length>0&&(u=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(u,o)},e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},e.prototype.onServerInfoUpdate_=function(e){var t=this;N(e,function(e,n){t.updateInfo_(n,e)})},e.prototype.updateInfo_=function(e,t){var n=new $("/.info/"+e),r=Be(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},e.prototype.getNextWriteId_=function(){return this.nextWriteId_++},e.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var s=this.generateServerValues(),o=Be(t,n),a=et(o,s),c=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(e,a,c,!0);this.eventQueue_.queueEvents(l),this.server_.put(e.toString(),o.val(!0),function(t,n){var s="ok"===t;s||C("set at "+e+" failed: "+t);var o=i.serverSyncTree_.ackUserWrite(c,!s);i.eventQueue_.raiseEventsForChangedPath(e,o),i.callOnCompleteCallback(r,t,n)});var h=this.abortTransactions_(e);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},e.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,o=this.generateServerValues(),a={};if(Object(s.r)(t,function(e,t){i=!1;var n=Be(t);a[e]=et(n,o)}),i)v("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var c=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserMerge(e,a,c);this.eventQueue_.queueEvents(l),this.server_.merge(e.toString(),t,function(t,i){var s="ok"===t;s||C("update at "+e+" failed: "+t);var o=r.serverSyncTree_.ackUserWrite(c,!s),a=o.length>0?r.rerunTransactions_(e):e;r.eventQueue_.raiseEventsForChangedPath(a,o),r.callOnCompleteCallback(n,t,i)}),Object(s.r)(t,function(t){var n=r.abortTransactions_(e.child(t));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(e,[])}},e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=function(e,t){var n=new Xe;return e.forEachTree(new $(""),function(e,r){n.remember(e,et(r,t))}),n}(this.onDisconnect_,t),r=[];n.forEachTree($.Empty,function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)}),this.onDisconnect_=new Xe,this.eventQueue_.raiseEventsForChangedPath($.Empty,r)},e.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)})},e.prototype.onDisconnectSet=function(e,t,n){var r=this,i=Be(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),function(t,s){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,s)})},e.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,s=Be(t,n);this.server_.onDisconnectPut(e.toString(),s.val(!0),function(t,n){"ok"===t&&i.onDisconnect_.remember(e,s),i.callOnCompleteCallback(r,t,n)})},e.prototype.onDisconnectUpdate=function(e,t,n){var r=this;if(Object(s.x)(t))return v("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,function(i,o){"ok"===i&&Object(s.r)(t,function(t,n){var i=Be(n);r.onDisconnect_.remember(e.child(t),i)}),r.callOnCompleteCallback(n,i,o)})},e.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},e.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new It(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var n=Object.keys(t).reduce(function(e,t){return Math.max(t.length,e)},0);Object(s.r)(t,function(e,t){for(var r=e.length;r<n+2;r++)e+=" ";console.log(e+t)})}},e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},e.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),v.apply(void 0,[n].concat(e))},e.prototype.callOnCompleteCallback=function(e,t,n){e&&j(function(){if("ok"==t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var s=new Error(i);s.code=r,e(s)}})},Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new hn(this))},enumerable:!0,configurable:!0}),e}(),en=function(){function e(t){this.indexedFilter_=new pt(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,s){return this.matches(new pe(t,n))||(n=Fe.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=Fe.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(Fe.EMPTY_NODE);var i=this;return t.forEachChild(ke,function(e,t){i.matches(new pe(e,t))||(r=r.updateImmediateChild(e,Fe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),tn=function(){function e(e){this.rangedFilter_=new en(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,s){return this.rangedFilter_.matches(new pe(t,n))||(n=Fe.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=Fe.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=Fe.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var s=0;i.hasNext()&&s<this.limit_;){var o=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),o)<=0:this.index_.compare(o,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(o.name,o.node),s++}}else{r=(r=t.withIndex(this.index_)).updatePriority(Fe.EMPTY_NODE);var a=void 0,c=void 0,l=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();l=function(e,t){return h(t,e)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();s=0;for(var u=!1;i.hasNext();){o=i.getNext();!u&&l(a,o)<=0&&(u=!0),u&&s<this.limit_&&l(o,c)<=0?s++:r=r.updateImmediateChild(o.name,Fe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(e,t){return a(t,e)}}else o=this.index_.getCompare();var c=e;Object(s.e)(c.numChildren()==this.limit_,"");var l=new pe(t,n),h=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(c.hasChild(t)){for(var d=c.getImmediateChild(t),p=r.getChildAfterChild(this.index_,h,this.reverse_);null!=p&&(p.name==t||c.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:o(p,l);if(u&&!n.isEmpty()&&f>=0)return null!=i&&i.trackChildChange(dt.childChangedChange(t,n,d)),c.updateImmediateChild(t,n);null!=i&&i.trackChildChange(dt.childRemovedChange(t,d));var m=c.updateImmediateChild(t,Fe.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(dt.childAddedChange(p.name,p.node)),m.updateImmediateChild(p.name,p.node)):m}return n.isEmpty()?e:u&&o(h,l)>=0?(null!=i&&(i.trackChildChange(dt.childRemovedChange(h.name,h.node)),i.trackChildChange(dt.childAddedChange(t,n))),c.updateImmediateChild(t,n).updateImmediateChild(h.name,Fe.EMPTY_NODE)):e},e}(),nn=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ke}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},e.prototype.getIndexStartValue=function(){return Object(s.e)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return Object(s.e)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:k},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return Object(s.e)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return Object(s.e)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:T},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return Object(s.e)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.copy_=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},e.prototype.limitToFirst=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},e.prototype.limitToLast=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},e.prototype.startAt=function(e,t){var n=this.copy_();return n.startSet_=!0,void 0===e&&(e=null),n.indexStartValue_=e,null!=t?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n},e.prototype.endAt=function(e,t){var n=this.copy_();return n.endSet_=!0,void 0===e&&(e=null),n.indexEndValue_=e,void 0!==t?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n},e.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[t.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),n[t.VIEW_FROM]=r}return this.index_!==ke&&(n[t.INDEX]=this.index_.toString()),n},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==ke},e.prototype.getNodeFilter=function(){return this.loadsAllData()?new pt(this.getIndex()):this.hasLimit()?new tn(this):new en(this)},e.prototype.toRestQueryStringParameters=function(){var t,n=e.REST_QUERY_CONSTANTS_,r={};return this.isDefault()?r:(this.index_===ke?t=n.PRIORITY_INDEX:this.index_===ze?t=n.VALUE_INDEX:this.index_===ye?t=n.KEY_INDEX:(Object(s.e)(this.index_ instanceof qe,"Unrecognized index type!"),t=this.index_.toString()),r[n.ORDER_BY]=Object(s.K)(t),this.startSet_&&(r[n.START_AT]=Object(s.K)(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+Object(s.K)(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=Object(s.K)(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+Object(s.K)(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_),r)},e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},e.DEFAULT=new e,e}(),rn=function(e){function t(t,n){if(!(t instanceof Jt))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,nn.DEFAULT,!1)||this}return Object(i.b)(t,e),t.prototype.getKey=function(){return Object(s.L)("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},t.prototype.child=function(e){return Object(s.L)("Reference.child",1,1,arguments.length),"number"==typeof e?e=String(e):e instanceof $||(null===this.path.getFront()?function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ae(e,t,n,r)}("Reference.child",1,e,!1):ae("Reference.child",1,e,!1)),new t(this.repo,this.path.child(e))},t.prototype.getParent=function(){Object(s.L)("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){Object(s.L)("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return this.repo.database},t.prototype.set=function(e,t){Object(s.L)("Reference.set",1,2,arguments.length),ce("Reference.set",this.path),te("Reference.set",1,e,this.path,!1),Object(s.M)("Reference.set",2,t,!0);var n=new s.b;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if(Object(s.L)("Reference.update",1,2,arguments.length),ce("Reference.update",this.path),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,C("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}re("Reference.update",1,e,this.path,!1),Object(s.M)("Reference.update",2,t,!0);var i=new s.b;return this.repo.update(this.path,e,i.wrapCallback(t)),i.promise},t.prototype.setWithPriority=function(e,t,n){if(Object(s.L)("Reference.setWithPriority",2,3,arguments.length),ce("Reference.setWithPriority",this.path),te("Reference.setWithPriority",1,e,this.path,!1),ie("Reference.setWithPriority",2,t,!1),Object(s.M)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new s.b;return this.repo.setWithPriority(this.path,e,t,r.wrapCallback(n)),r.promise},t.prototype.remove=function(e){return Object(s.L)("Reference.remove",0,1,arguments.length),ce("Reference.remove",this.path),Object(s.M)("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if(Object(s.L)("Reference.transaction",1,3,arguments.length),ce("Reference.transaction",this.path),Object(s.M)("Reference.transaction",1,e,!1),Object(s.M)("Reference.transaction",2,t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(s.n)(e,t,r)+"must be a boolean.")}("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new s.b;"function"==typeof t&&r.promise.catch(function(){});return this.repo.startTransaction(this.path,e,function(e,n,i){e?r.reject(e):r.resolve(new ue(n,i)),"function"==typeof t&&t(e,n,i)},n),r.promise},t.prototype.setPriority=function(e,t){Object(s.L)("Reference.setPriority",1,2,arguments.length),ce("Reference.setPriority",this.path),ie("Reference.setPriority",1,e,!1),Object(s.M)("Reference.setPriority",2,t,!0);var n=new s.b;return this.repo.setWithPriority(this.path.child(".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){Object(s.L)("Reference.push",0,2,arguments.length),ce("Reference.push",this.path),te("Reference.push",1,e,this.path,!0),Object(s.M)("Reference.push",2,t,!0);var n,r=this.repo.serverTime(),i=de(r),o=this.child(i),a=this.child(i);return n=null!=e?o.set(e,t).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof t&&n.catch(function(){}),o},t.prototype.onDisconnect=function(){return ce("Reference.onDisconnect",this.path),new he(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),t}(Ze);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ze.__referenceConstructor=rn,wt.__referenceConstructor=rn;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var sn,on=function(){return function(){this.children={},this.childCount=0,this.value=null}}(),an=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new on),this.name_=e,this.parent_=t,this.node_=n}return e.prototype.subTree=function(t){for(var n,r=t instanceof $?t:new $(t),i=this;null!==(n=r.getFront());){i=new e(n,i,Object(s.H)(i.node_.children,n)||new on),r=r.popFront()}return i},e.prototype.getValue=function(){return this.node_.value},e.prototype.setValue=function(e){Object(s.e)(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},e.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},e.prototype.hasChildren=function(){return this.node_.childCount>0},e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},e.prototype.forEachChild=function(t){var n=this;Object(s.r)(this.node_.children,function(r,i){t(new e(r,n,i))})},e.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},e.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},e.prototype.path=function(){return new $(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},e.prototype.name=function(){return this.name_},e.prototype.parent=function(){return this.parent_},e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},e.prototype.updateChild_=function(e,t){var n=t.isEmpty(),r=Object(s.j)(this.node_.children,e);n&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},e}();!function(e){e[e.RUN=0]="RUN",e[e.SENT=1]="SENT",e[e.COMPLETED=2]="COMPLETED",e[e.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",e[e.NEEDS_ABORT=4]="NEEDS_ABORT"}(sn||(sn={})),Jt.MAX_TRANSACTION_RETRIES_=25,Jt.prototype.transactions_init_=function(){this.transactionQueueTree_=new an},Jt.prototype.startTransaction=function(e,t,n,r){this.log_("transaction on "+e);var i=function(){},o=new rn(this,e);o.on("value",i);var a={path:e,update:t,onComplete:n,status:null,order:p(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},c=this.getLatestState_(e);a.currentInputSnapshot=c;var l=a.update(c.val());if(void 0===l){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var h=new We(a.currentInputSnapshot,new rn(this,a.path),ke);a.onComplete(null,!1,h)}}else{ne("transaction failed: Data returned ",l,a.path),a.status=sn.RUN;var u=this.transactionQueueTree_.subTree(e),d=u.getValue()||[];d.push(a),u.setValue(d);var f=void 0;if("object"==typeof l&&null!==l&&Object(s.j)(l,".priority"))f=Object(s.H)(l,".priority"),Object(s.e)(ee(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(e)||Fe.EMPTY_NODE).getPriority().val();f=f;var m=this.generateServerValues(),y=Be(l,f),g=et(y,m);a.currentOutputSnapshotRaw=y,a.currentOutputSnapshotResolved=g,a.currentWriteId=this.getNextWriteId_();var _=this.serverSyncTree_.applyUserOverwrite(e,g,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,_),this.sendReadyTransactions_()}},Jt.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||Fe.EMPTY_NODE},Jt.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);Object(s.e)(n.length>0,"Sending zero length transaction queue"),n.every(function(e){return e.status===sn.RUN})&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild(function(e){t.sendReadyTransactions_(e)})},Jt.prototype.sendTransactionQueue_=function(e,t){for(var n=this,r=t.map(function(e){return e.currentWriteId}),i=this.getLatestState_(e,r),o=i,a=i.hash(),c=0;c<t.length;c++){var l=t[c];Object(s.e)(l.status===sn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=sn.SENT,l.retryCount++;var h=$.relativePath(e,l.path);o=o.updateChild(h,l.currentOutputSnapshotRaw)}var u=o.val(!0),d=e;this.server_.put(d.toString(),u,function(r){n.log_("transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var s=[],o=0;o<t.length;o++){if(t[o].status=sn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[o].currentWriteId)),t[o].onComplete){var a=t[o].currentOutputSnapshotResolved,c=new rn(n,t[o].path),l=new We(a,c,ke);s.push(t[o].onComplete.bind(null,null,!0,l))}t[o].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(e,i);for(o=0;o<s.length;o++)j(s[o])}else{if("datastale"===r)for(o=0;o<t.length;o++)t[o].status===sn.SENT_NEEDS_ABORT?t[o].status=sn.NEEDS_ABORT:t[o].status=sn.RUN;else{C("transaction at "+d.toString()+" failed: "+r);for(o=0;o<t.length;o++)t[o].status=sn.NEEDS_ABORT,t[o].abortReason=r}n.rerunTransactions_(e)}},a)},Jt.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},Jt.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,r=[],i=[],o=e.filter(function(e){return e.status===sn.RUN}).map(function(e){return e.currentWriteId}),a=0;a<e.length;a++){var c=e[a],l=$.relativePath(t,c.path),h=!1,u=void 0;if(Object(s.e)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===sn.NEEDS_ABORT)h=!0,u=c.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else if(c.status===sn.RUN)if(c.retryCount>=Jt.MAX_TRANSACTION_RETRIES_)h=!0,u="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else{var d=this.getLatestState_(c.path,o);c.currentInputSnapshot=d;var p=e[a].update(d.val());if(void 0!==p){ne("transaction failed: Data returned ",p,c.path);var f=Be(p);"object"==typeof p&&null!=p&&Object(s.j)(p,".priority")||(f=f.updatePriority(d.getPriority()));var m=c.currentWriteId,y=this.generateServerValues(),g=et(f,y);c.currentOutputSnapshotRaw=f,c.currentOutputSnapshotResolved=g,c.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(m),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(c.path,g,c.currentWriteId,c.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(m,!0))}else h=!0,u="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,i),i=[],h&&(e[a].status=sn.COMPLETED,n=e[a].unwatcher,setTimeout(n,Math.floor(0)),e[a].onComplete))if("nodata"===u){var _=new rn(this,e[a].path),v=e[a].currentInputSnapshot,b=new We(v,_,ke);r.push(e[a].onComplete.bind(null,null,!1,b))}else r.push(e[a].onComplete.bind(null,new Error(u),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)j(r[a]);this.sendReadyTransactions_()}},Jt.prototype.getAncestorTransactionNode_=function(e){for(var t,n=this.transactionQueueTree_;null!==(t=e.getFront())&&null===n.getValue();)n=n.subTree(t),e=e.popFront();return n},Jt.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort(function(e,t){return e.order-t.order}),t},Jt.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild(function(e){n.aggregateTransactionQueuesForNode_(e,t)})},Jt.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==sn.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(n.length>0?n:null)}e.forEachChild(function(e){t.pruneCompletedTransactionsBelowNode_(e)})},Jt.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor(function(e){t.abortTransactionsOnNode_(e)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(e){t.abortTransactionsOnNode_(e)}),n},Jt.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],r=[],i=-1,o=0;o<t.length;o++)if(t[o].status===sn.SENT_NEEDS_ABORT);else if(t[o].status===sn.SENT)Object(s.e)(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=sn.SENT_NEEDS_ABORT,t[o].abortReason="set";else if(Object(s.e)(t[o].status===sn.RUN,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[o].currentWriteId,!0)),t[o].onComplete){n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?e.setValue(null):t.length=i+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r);for(o=0;o<n.length;o++)j(n[o])}};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var cn,ln=function(){function e(){this.repos_={},this.useRestClient_=!1}return e.getInstance=function(){return cn||(cn=new e),cn},e.prototype.interrupt=function(){for(var e in this.repos_)for(var t in this.repos_[e])this.repos_[e][t].interrupt()},e.prototype.resume=function(){for(var e in this.repos_)for(var t in this.repos_[e])this.repos_[e][t].resume()},e.prototype.databaseFromApp=function(e,t){var n=t||e.options.databaseURL;void 0===n&&S("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var r=Q(n),i=r.repoInfo;return le("Invalid Firebase Database URL",1,r),r.path.isEmpty()||S("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,e).database},e.prototype.deleteRepo=function(e){var t=Object(s.H)(this.repos_,e.app.name);t&&Object(s.H)(t,e.repoInfo_.toURLString())===e||S("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.repoInfo_.toURLString()]},e.prototype.createRepo=function(e,t){var n=Object(s.H)(this.repos_,t.name);n||(n={},this.repos_[t.name]=n);var r=Object(s.H)(n,e.toURLString());return r&&S("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Jt(e,this.useRestClient_,t),n[e.toURLString()]=r,r},e.prototype.forceRestClient=function(e){this.useRestClient_=e},e}(),hn=function(){function e(e){this.repo_=e,e instanceof Jt||S("Don't call new Database() directly - please use firebase.database()."),this.root_=new rn(e,$.Empty),this.INTERNAL=new un(this)}return Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),e.prototype.ref=function(e){return this.checkDeleted_("ref"),Object(s.L)("database.ref",0,1,arguments.length),e instanceof rn?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),Object(s.L)(t,1,1,arguments.length);var n=Q(e);le(t,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&S(t+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repo_&&S("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){Object(s.L)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},e.prototype.goOnline=function(){Object(s.L)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},e.ServerValue={TIMESTAMP:{".sv":"timestamp"}},e}(),un=function(){function e(e){this.database=e}return e.prototype.delete=function(){return Object(i.a)(this,void 0,void 0,function(){return Object(i.c)(this,function(e){return this.database.checkDeleted_("delete"),ln.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},e}(),dn=Object.freeze({forceLongPolling:function(){Wt.forceDisallow(),Ht.forceAllow()},forceWebSockets:function(){Ht.forceDisallow()},isWebSocketsAvailable:function(){return Wt.isAvailable()},setSecurityDebugCallback:function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){e.repo.stats(t)},statsIncrementCounter:function(e,t){e.repo.statsIncrementCounter(t)},dataUpdateCount:function(e){return e.repo.dataUpdateCount},interceptServerData:function(e,t){return e.repo.interceptServerData_(t)}}),pn=Yt;Yt.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Yt.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var fn,mn,yn=Kt,gn=H,_n=Object.freeze({DataConnection:pn,RealTimeConnection:yn,hijackHash:function(e){var t=Yt.prototype.put;return Yt.prototype.put=function(n,r,i,s){void 0!==s&&(s=e()),t.call(this,n,r,i,s)},function(){Yt.prototype.put=t}},ConnectionTarget:gn,queryIdentifier:function(e){return e.queryIdentifier()},listens:function(e){return e.repo.persistentConnection_.listens_},forceRestClient:function(e){ln.getInstance().forceRestClient(e)}}),vn=hn.ServerValue;fn=r.a,mn=fn.INTERNAL.registerService("database",function(e,t,n){return ln.getInstance().databaseFromApp(e,n)},{Reference:rn,Query:Ze,Database:hn,DataSnapshot:We,enableLogging:_,INTERNAL:dn,ServerValue:vn,TEST_ACCESS:_n},null,!0),Object(s.A)()&&(e.exports=mn)}).call(this,n(89)(e))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";n.r(t);var r=n(52),i=n.n(r),s=n(8),o=n.n(s),a=n(16),c=n.n(a),l=n(53),h=n.n(l),u=n(50),d=n.n(u),p=n(4),f=n(25),m=n(21),y=n(54),g=n(11);const _=Symbol("buffer"),v=Symbol("type");class b{constructor(){this[v]="";const e=arguments[0],t=arguments[1],n=[];if(e){const t=e,r=Number(t.length);for(let e=0;e<r;e++){const r=t[e];let i;i=r instanceof Buffer?r:ArrayBuffer.isView(r)?Buffer.from(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?Buffer.from(r):r instanceof b?r[_]:Buffer.from("string"==typeof r?r:String(r)),n.push(i)}}this[_]=Buffer.concat(n);let r=t&&void 0!==t.type&&String(t.type).toLowerCase();r&&!/[^\u0020-\u007E]/.test(r)&&(this[v]=r)}get size(){return this[_].length}get type(){return this[v]}slice(){const e=this.size,t=arguments[0],n=arguments[1];let r,i;r=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),i=void 0===n?e:n<0?Math.max(e+n,0):Math.min(n,e);const s=Math.max(i-r,0),o=this[_].slice(r,r+s),a=new b([],{type:arguments[2]});return a[_]=o,a}}function w(e,t,n){Error.call(this,e),this.message=e,this.type=t,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let S;Object.defineProperties(b.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(b.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),w.prototype=Object.create(Error.prototype),w.prototype.constructor=w,w.prototype.name="FetchError";try{S=require("encoding").convert}catch(e){}const C=Symbol("Body internals"),E=p.PassThrough;function k(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.size;let i=void 0===r?0:r;var s=n.timeout;let o=void 0===s?0:s;null==e?e=null:"string"==typeof e||x(e)||e instanceof b||Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)||e instanceof p||(e=String(e)),this[C]={body:e,disturbed:!1,error:null},this.size=i,this.timeout=o,e instanceof p&&e.on("error",function(e){const n="AbortError"===e.name?e:new w(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[C].error=n})}function T(){var e=this;if(this[C].disturbed)return k.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[C].disturbed=!0,this[C].error)return k.Promise.reject(this[C].error);if(null===this.body)return k.Promise.resolve(Buffer.alloc(0));if("string"==typeof this.body)return k.Promise.resolve(Buffer.from(this.body));if(this.body instanceof b)return k.Promise.resolve(this.body[_]);if(Buffer.isBuffer(this.body))return k.Promise.resolve(this.body);if("[object ArrayBuffer]"===Object.prototype.toString.call(this.body))return k.Promise.resolve(Buffer.from(this.body));if(ArrayBuffer.isView(this.body))return k.Promise.resolve(Buffer.from(this.body.buffer,this.body.byteOffset,this.body.byteLength));if(!(this.body instanceof p))return k.Promise.resolve(Buffer.alloc(0));let t=[],n=0,r=!1;return new k.Promise(function(i,s){let o;e.timeout&&(o=setTimeout(function(){r=!0,s(new w(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))},e.timeout)),e.body.on("error",function(t){"AbortError"===t.name?(r=!0,s(t)):s(new w(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))}),e.body.on("data",function(i){if(!r&&null!==i){if(e.size&&n+i.length>e.size)return r=!0,void s(new w(`content size at ${e.url} over limit: ${e.size}`,"max-size"));n+=i.length,t.push(i)}}),e.body.on("end",function(){if(!r){clearTimeout(o);try{i(Buffer.concat(t))}catch(t){s(new w(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}})})}function x(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function R(e){let t,n,r=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return r instanceof p&&"function"!=typeof r.getBoundary&&(t=new E,n=new E,r.pipe(t),r.pipe(n),e[C].body=t,r=n),r}function O(e){const t=e.body;return null===t?0:"string"==typeof t?Buffer.byteLength(t):x(t)?Buffer.byteLength(String(t)):t instanceof b?t.size:Buffer.isBuffer(t)?t.length:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?t.byteLength:ArrayBuffer.isView(t)?t.byteLength:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}k.prototype={get body(){return this[C].body},get bodyUsed(){return this[C].disturbed},arrayBuffer(){return T.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob(){let e=this.headers&&this.headers.get("content-type")||"";return T.call(this).then(function(t){return Object.assign(new b([],{type:e.toLowerCase()}),{[_]:t})})},json(){var e=this;return T.call(this).then(function(t){try{return JSON.parse(t.toString())}catch(t){return k.Promise.reject(new w(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}})},text(){return T.call(this).then(function(e){return e.toString()})},buffer(){return T.call(this)},textConverted(){var e=this;return T.call(this).then(function(t){return function(e,t){if("function"!=typeof S)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=t.get("content-type");let r,i,s="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));i=e.slice(0,1024).toString(),!r&&i&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(i));!r&&i&&(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(i))&&(r=/charset=(.*)/i.exec(r.pop()));!r&&i&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(i));r&&("gb2312"!==(s=r.pop())&&"gbk"!==s||(s="gb18030"));return S(e,"UTF-8",s).toString()}(t,e.headers)})}},Object.defineProperties(k.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),k.mixIn=function(e){for(const t of Object.getOwnPropertyNames(k.prototype))if(!(t in e)){const n=Object.getOwnPropertyDescriptor(k.prototype,t);Object.defineProperty(e,t,n)}},k.Promise=global.Promise;const I=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,P=/[^\t\x20-\x7e\x80-\xff]/;function N(e){if(e=`${e}`,I.test(e))throw new TypeError(`${e} is not a legal HTTP header name`)}function A(e){if(e=`${e}`,P.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}function D(e,t){t=t.toLowerCase();for(const n in e)if(n.toLowerCase()===t)return n}const M=Symbol("map");class j{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[M]=Object.create(null),e instanceof j){const t=e.raw(),n=Object.keys(t);for(const e of n)for(const n of t[e])this.append(e,n)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const n=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(t))}for(const e of n){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const n=e[t];this.append(t,n)}}}}get(e){N(e=`${e}`);const t=D(this[M],e);return void 0===t?null:this[M][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=F(this),r=0;for(;r<n.length;){var i=n[r];const s=i[0],o=i[1];e.call(t,o,s,this),n=F(this),r++}}set(e,t){t=`${t}`,N(e=`${e}`),A(t);const n=D(this[M],e);this[M][void 0!==n?n:e]=[t]}append(e,t){t=`${t}`,N(e=`${e}`),A(t);const n=D(this[M],e);void 0!==n?this[M][n].push(t):this[M][e]=[t]}has(e){return N(e=`${e}`),void 0!==D(this[M],e)}delete(e){N(e=`${e}`);const t=D(this[M],e);void 0!==t&&delete this[M][t]}raw(){return this[M]}keys(){return $(this,"key")}values(){return $(this,"value")}[Symbol.iterator](){return $(this,"key+value")}}function F(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(e[M]).sort().map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[M][t].join(", ")}:function(t){return[t.toLowerCase(),e[M][t].join(", ")]})}j.prototype.entries=j.prototype[Symbol.iterator],Object.defineProperty(j.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(j.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const L=Symbol("internal");function $(e,t){const n=Object.create(B);return n[L]={target:e,kind:t,index:0},n}const B=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==B)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[L];const t=e.target,n=e.kind,r=e.index,i=F(t,n);return r>=i.length?{value:void 0,done:!0}:(this[L].index=r+1,{value:i[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function U(e){const t=Object.assign({__proto__:null},e[M]),n=D(e[M],"Host");return void 0!==n&&(t[n]=t[n][0]),t}Object.defineProperty(B,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const H=Symbol("Response internals"),z=f.STATUS_CODES;class q{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};k.call(this,e,t);const n=t.status||200;this[H]={url:t.url,status:n,statusText:t.statusText||z[n],headers:new j(t.headers)}}get url(){return this[H].url}get status(){return this[H].status}get ok(){return this[H].status>=200&&this[H].status<300}get statusText(){return this[H].statusText}get headers(){return this[H].headers}clone(){return new q(R(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok})}}k.mixIn(q.prototype),Object.defineProperties(q.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(q.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const W=Symbol("Request internals"),V=m.parse,K=m.format,Q="destroy"in p.Readable.prototype;function G(e){return"object"==typeof e&&"object"==typeof e[W]}class Z{constructor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};G(e)?t=V(e.url):(t=e&&e.href?V(e.href):V(`${e}`),e={});let r=n.method||e.method||"GET";if(r=r.toUpperCase(),(null!=n.body||G(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let i=null!=n.body?n.body:G(e)&&null!==e.body?R(e):null;k.call(this,i,{timeout:n.timeout||e.timeout||0,size:n.size||e.size||0});const s=new j(n.headers||e.headers||{});if(null!=n.body){const e=function(e){const t=e.body;return null===t?null:"string"==typeof t?"text/plain;charset=UTF-8":x(t)?"application/x-www-form-urlencoded;charset=UTF-8":t instanceof b?t.type||null:Buffer.isBuffer(t)?null:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?null:ArrayBuffer.isView(t)?null:"function"==typeof t.getBoundary?`multipart/form-data;boundary=${t.getBoundary()}`:null}(this);null===e||s.has("Content-Type")||s.append("Content-Type",e)}let o=G(e)?e.signal:null;if("signal"in n&&(o=n.signal),null!=o&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(o))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[W]={method:r,redirect:n.redirect||e.redirect||"follow",headers:s,parsedURL:t,signal:o},this.follow=void 0!==n.follow?n.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===e.compress||e.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent}get method(){return this[W].method}get url(){return K(this[W].parsedURL)}get headers(){return this[W].headers}get redirect(){return this[W].redirect}get signal(){return this[W].signal}clone(){return new Z(this)}}function Y(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}k.mixIn(Z.prototype),Object.defineProperty(Z.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Z.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),Y.prototype=Object.create(Error.prototype),Y.prototype.constructor=Y,Y.prototype.name="AbortError";const X=p.PassThrough,J=m.resolve;function ee(e,t){if(!ee.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return k.Promise=ee.Promise,new ee.Promise(function(n,r){const i=new Z(e,t),s=function(e){const t=e[W].parsedURL,n=new j(e[W].headers);if(n.has("Accept")||n.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof p.Readable&&!Q)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let r=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(r="0"),null!=e.body){const t=O(e);"number"==typeof t&&(r=String(t))}return r&&n.set("Content-Length",r),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate"),n.has("Connection")||e.agent||n.set("Connection","close"),Object.assign({},t,{method:e.method,headers:U(n),agent:e.agent})}(i),o=("https:"===s.protocol?y:f).request,a=i.signal;let c=null;const l=function(){let e=new Y("The user aborted a request.");r(e),i.body&&i.body instanceof p.Readable&&i.body.destroy(e),c&&c.body&&c.body.emit("error",e)};if(a&&a.aborted)return void l();const h=function(){l(),m()},u=o(s);let d;function m(){u.abort(),a&&a.removeEventListener("abort",h),clearTimeout(d)}a&&a.addEventListener("abort",h),i.timeout&&u.once("socket",function(e){d=setTimeout(function(){r(new w(`network timeout at: ${i.url}`,"request-timeout")),m()},i.timeout)}),u.on("error",function(e){r(new w(`request to ${i.url} failed, reason: ${e.message}`,"system",e)),m()}),u.on("response",function(e){clearTimeout(d);const t=function(e){const t=new j;for(const n of Object.keys(e))if(!I.test(n))if(Array.isArray(e[n]))for(const r of e[n])P.test(r)||(void 0===t[M][n]?t[M][n]=[r]:t[M][n].push(r));else P.test(e[n])||(t[M][n]=[e[n]]);return t}(e.headers);if(ee.isRedirect(e.statusCode)){const s=t.get("Location"),o=null===s?null:J(i.url,s);switch(i.redirect){case"error":return r(new w(`redirect mode is set to error: ${i.url}`,"no-redirect")),void m();case"manual":if(null!==o)try{t.set("Location",o)}catch(e){r(e)}break;case"follow":if(null===o)break;if(i.counter>=i.follow)return r(new w(`maximum redirect reached at: ${i.url}`,"max-redirect")),void m();const s={headers:new j(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:i.body,signal:i.signal};return 303!==e.statusCode&&i.body&&null===O(i)?(r(new w("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void m()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==i.method)||(s.method="GET",s.body=void 0,s.headers.delete("content-length")),n(ee(new Z(o,s))),void m())}}e.once("end",function(){a&&a.removeEventListener("abort",h)});let s=e.pipe(new X);const o={url:i.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:i.size,timeout:i.timeout},l=t.get("Content-Encoding");if(!i.compress||"HEAD"===i.method||null===l||204===e.statusCode||304===e.statusCode)return c=new q(s,o),void n(c);const u={flush:g.Z_SYNC_FLUSH,finishFlush:g.Z_SYNC_FLUSH};if("gzip"==l||"x-gzip"==l)return s=s.pipe(g.createGunzip(u)),c=new q(s,o),void n(c);if("deflate"!=l&&"x-deflate"!=l)c=new q(s,o),n(c);else{e.pipe(new X).once("data",function(e){s=8==(15&e[0])?s.pipe(g.createInflate()):s.pipe(g.createInflateRaw()),c=new q(s,o),n(c)})}}),function(e,t){const n=t.body;null===n?e.end():"string"==typeof n?(e.write(n),e.end()):x(n)?(e.write(Buffer.from(String(n))),e.end()):n instanceof b?(e.write(n[_]),e.end()):Buffer.isBuffer(n)?(e.write(n),e.end()):"[object ArrayBuffer]"===Object.prototype.toString.call(n)?(e.write(Buffer.from(n)),e.end()):ArrayBuffer.isView(n)?(e.write(Buffer.from(n.buffer,n.byteOffset,n.byteLength)),e.end()):n.pipe(e)}(u,i)})}ee.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},ee.Promise=global.Promise;var te=ee,ne=n(51),re=n.n(ne);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const ie=["Text","URL","Number","Boolean"];class se{static convert(e,t){const n=JSON.parse(e),r={},i={};n["@graph"]||(n["@graph"]=[n]);for(const e of n["@graph"])"rdf:Property"===e["@type"]?i[e["@id"]]=e:"rdfs:Class"===e["@type"]&&(r[e["@id"]]=e,e.subclasses=[],e.superclass=null);for(const e of Object.values(r))if(void 0!==e["rdfs:subClassOf"]){null==e["rdfs:subClassOf"].length&&(e["rdfs:subClassOf"]=[e["rdfs:subClassOf"]]);for(const t of e["rdfs:subClassOf"]){const n=t["@id"];null==e.superclass&&(e.superclass=[]),r[n]?(r[n].subclasses.push(e),e.superclass.push(r[n])):e.superclass.push({"@id":n})}}for(const e of Object.values(r))0===e.subclasses.length&&null==t&&(t=e);const s=[];for(const e of Object.values(i)){let n=e["schema:domainIncludes"];if(n||(n={"@id":t["@id"]}),n.length||(n=[n]),(n=n.map(e=>e["@id"])).includes(t["@id"])){const t=e["@id"].split(":")[1];let n=e["schema:rangeIncludes"];n||console.log(e),n.length||(n=[n]),(n=(n=n.map(e=>e["@id"].split(":")[1])).filter(e=>ie.includes(e))).length>0&&s.push({name:t,type:n})}}const o=t["@id"].split(":")[1],a=t&&t.superclass?t.superclass.map(e=>e["@id"].split(":")[1]):[];let c="";for(const e of a)c+=`import 'https://schema.org/${e}'\n\n`;if(c+=`schema ${o}`,a.length>0&&(c+=` extends ${a.join(", ")}`),s.length>0)for(const e of s){let t;c+=`\n  ${t=e.type.length>1?"("+e.type.join(" or ")+")":e.type[0]} ${e.name}`}return c+="\n"}}class oe extends Error{constructor(e,t,n,r){super(),this.cause=e,this.method=t,this.particleId=n,this.particleName=r,this.stack+=`\nCaused by: ${this.cause.stack}`}toLiteral(){return{exceptionType:this.constructor.name,cause:{name:this.cause.name,message:this.cause.message,stack:this.cause.stack},method:this.method,particleId:this.particleId,particleName:this.particleName,stack:this.stack}}static fromLiteral(e){const t=e.cause;let n;switch(e.exceptionType){case ae.name:n=new ae(t,e.method,e.particleId,e.particleName);break;case ce.name:n=new ce(t,e.method,e.particleId,e.particleName);break;default:throw new Error(`Unknown exception type: ${e.exceptionType}`)}return n.stack=e.stack,n}}class ae extends oe{get message(){const e=this.particleName?this.particleName:this.particleId;return`SystemException: exception ${this.cause.name} raised when invoking system function ${this.method} on behalf of particle ${e}: ${this.cause.message}`}}class ce extends oe{get message(){const e=this.particleName?this.particleName:this.particleId;return`UserException: exception ${this.cause.name} raised when invoking function ${this.method} on particle ${e}: ${this.cause.message}`}}const le=[];var he,ue;he=(e=>{throw console.log(e.method,e.particleName),e}),le.includes(he)||le.push(he),function(e){e.Dom="dom",e.DomTouch="domTouch",e.Vr="vr",e.Voice="voice"}(ue||(ue={}));class de{constructor(e,t=[]){this.all=e,this.names=t}static create(e){return d()(null!=e),new de(!1,e)}intersection(e){return this.all&&e.all?new de(!0,[]):this.all?new de(!1,e.names):new de(!1,this.names.filter(t=>e.all||e.names.includes(t)))}static intersection(e){return e.reduce((e,t)=>e.intersection(t),de.all)}union(e){return this.all||e.all?de.all:new de(!1,[...new Set(this.names.concat(e.names))])}static union(e){return 0===e.length?de.all:e.reduce((e,t)=>e.union(t),de.create([]))}isResolved(){return this.all||this.names.length>0}isCompatible(e){return this.intersection(de.create(e)).isResolved()}static get Name(){return ue}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function pe(e){return jt.fromLiteral(e)}function fe(e){return"object"==typeof e?pe(e):e}function me({type:e,name:t,direction:n}){return{type:e?pe(e):void 0,name:t?fe(t):void 0,direction:n||"any"}}function ye({name:e,direction:t,isRequired:n,isSet:r}){return{name:e?fe(e):void 0,direction:t,isRequired:n,isSet:r}}function ge(e){return e instanceof Lt?e.toLiteral():e}function _e({type:e,name:t,direction:n}){return{type:e&&(r=e,r.toLiteral()),name:t&&ge(t),direction:n};var r}function ve({name:e,direction:t,isRequired:n,isSet:r}){return{name:e&&ge(e),direction:t,isRequired:n,isSet:r}}de.all=new de(!0,[]),de.dom=new de(!1,[de.Name.Dom]),de.domTouch=new de(!1,[de.Name.DomTouch]),de.voice=new de(!1,[de.Name.Voice]),de.vr=new de(!1,[de.Name.Vr]);const be=["type","name","direction"],we=["name","direction","isRequired","isSet"];class Se{constructor(e,t,n){d()(e),d()(void 0!==t),d()(void 0!==n),this.name=e,this.handleConnections=t,this.slots=n,this.typeVars=[];for(const e of t)for(const t of be)Se.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t});for(const e of n)for(const t of we)Se.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t})}toPrettyString(){return"InterfaceInfo"}mergeTypeVariablesByName(e){this.typeVars.forEach(({object:t,field:n})=>t[n]=t[n].mergeTypeVariablesByName(e))}get canReadSubset(){return this._cloneAndUpdate(e=>e.canReadSubset)}get canWriteSuperset(){return this._cloneAndUpdate(e=>e.canWriteSuperset)}isMoreSpecificThan(e){if(this.handleConnections.length!==e.handleConnections.length||this.slots.length!==e.slots.length)return!1;for(let t=0;t<this.typeVars.length;t++){const n=this.typeVars[t],r=e.typeVars[t];if(!n.object[n.field].isMoreSpecificThan(r.object[r.field]))return!1}return!0}_applyExistenceTypeTest(e){for(const t of this.typeVars)if(e(t.object[t.field]))return!0;return!1}_handleConnectionsToManifestString(){return this.handleConnections.map(e=>`  ${e.direction||"any"} ${e.type.toString()} ${e.name?e.name:"*"}`).join("\n")}_slotsToManifestString(){return this.slots.map(e=>`  ${e.direction} ${e.isSet?"set of ":""}${e.name?e.name+" ":""}`).join("\n")}toString(){return`interface ${this.name}\n${this._handleConnectionsToManifestString()}\n${this._slotsToManifestString()}`}static fromLiteral(e){const t=e.handleConnections.map(me),n=e.slots.map(ye);return new Se(e.name,t,n)}toLiteral(){const e=this.handleConnections.map(_e),t=this.slots.map(ve);return{name:this.name,handleConnections:e,slots:t}}clone(e){const t=this.handleConnections.map(({name:t,direction:n,type:r})=>({name:t,direction:n,type:r?r.clone(e):void 0})),n=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new Se(this.name,t,n)}cloneWithResolutions(e){return this._cloneWithResolutions(e)}_cloneWithResolutions(e){const t=this.handleConnections.map(({name:t,direction:n,type:r})=>({name:t,direction:n,type:r?r._cloneWithResolutions(e):void 0})),n=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new Se(this.name,t,n)}canEnsureResolved(){for(const e of this.typeVars)if(!e.object[e.field].canEnsureResolved())return!1;return!0}maybeEnsureResolved(){for(const e of this.typeVars){let t=e.object[e.field];if(!(t=t.clone(new Map)).maybeEnsureResolved())return!1}for(const e of this.typeVars)e.object[e.field].maybeEnsureResolved();return!0}tryMergeTypeVariablesWith(e){if(!this._equalItems(e.slots,this.slots,this._equalSlot))return null;if(e.handleConnections.length!==this.handleConnections.length)return null;const t=new Set(this.handleConnections),n=new Set(e.handleConnections),r=new Map;let i=t.size;for(;t.size>0;){const e=[...t.values()].map(e=>({handleConnection:e,match:[...n.values()].filter(t=>this._equalHandleConnection(e,t))}));for(const i of e){if(0===i.match.length)return null;1===i.match.length&&(r.set(i.handleConnection,i.match[0]),n.delete(i.match[0]),t.delete(i.handleConnection))}if(t.size===i)return null;i=t.size}const s=[];for(const e of this.handleConnections){const t=r.get(e);let n;if(e.type.hasVariable||t.type.hasVariable){if(!(n=Kt._tryMergeTypeVariable(e.type,t.type)))return null}else n=e.type||t.type;s.push({name:e.name||t.name,direction:e.direction||t.direction,type:n})}const o=this.slots.map(({name:e,direction:t,isRequired:n,isSet:r})=>({name:e,direction:t,isRequired:n,isSet:r}));return new Se(this.name,s,o)}resolvedType(){return this._cloneAndUpdate(e=>e.resolvedType())}equals(e){return this.handleConnections.length===e.handleConnections.length&&(!!this._equalItems(e.handleConnections,this.handleConnections,this._equalHandleConnection)&&!!this._equalItems(e.slots,this.slots,this._equalSlot))}_equalHandleConnection(e,t){return e.name===t.name&&e.direction===t.direction&&Kt.compareTypes({type:e.type},{type:t.type})}_equalSlot(e,t){return e.name===t.name&&e.direction===t.direction&&e.isRequired===t.isRequired&&e.isSet===t.isSet}_equalItems(e,t,n){for(const r of e){let e=!1;for(const i of t)if(n(i,r)){e=!0;break}if(!e)return!1}return!0}_cloneAndUpdate(e){const t=this.clone(new Map);return t.typeVars.forEach(t=>Se._updateTypeVar(t,e)),t}static _updateTypeVar(e,t){e.object[e.field]=t(e.object[e.field])}static isTypeVar(e){return e instanceof Lt||e instanceof jt&&e.hasVariable}static mustMatch(e){return!(null==e||Se.isTypeVar(e))}static handleConnectionsMatch(e,t){if(Se.mustMatch(e.name)&&e.name!==t.name)return!1;if(Se.mustMatch(e.direction)&&"any"!==e.direction&&"any"!==t.direction&&e.direction!==t.direction)return!1;if(null==e.type)return!0;const[n,r]=jt.unwrapPair(e.type,t.type);return n instanceof Lt?[{var:n,value:r,direction:e.direction}]:Kt.compareTypes({type:n},{type:r})}static slotsMatch(e,t){return(!Se.mustMatch(e.name)||e.name===t.name)&&((!Se.mustMatch(e.direction)||e.direction===t.direction)&&((!Se.mustMatch(e.isRequired)||e.isRequired===t.isRequired)&&(!Se.mustMatch(e.isSet)||e.isSet===t.isSet)))}particleMatches(e){return!1!==this.cloneWithResolutions(new Map).restrictType(e)}restrictType(e){return this._restrictThis(e)}_restrictThis(e){const t=this.handleConnections.map(t=>e.handleConnections.map(e=>({match:e,result:Se.handleConnectionsMatch(t,e)})).filter(e=>!1!==e.result)),n=[];e.slotConnections.forEach(e=>{n.push({name:e.name,direction:"consume",isRequired:e.isRequired,isSet:e.isSet}),e.provideSlotConnections.forEach(e=>{n.push({name:e.name,direction:"provide",isRequired:!1,isSet:e.isSet})})});const r=this.slots.map(e=>n.filter(t=>Se.slotsMatch(e,t))).map(e=>e.map(e=>({match:e,result:!0})));function i(e,t){if(0===e.length)return[];const n=e.pop();for(const r of n){if(t.includes(r.match))continue;const n=t.slice();n.push(r.match);const s=i(e,n);if(!1!==s)return"boolean"==typeof r.result?s:s.concat(r.result)}return!1}const s=i(t,[]),o=i(r,[]);if(!1===s||!1===o)return!1;for(const e of s)if(e.var.variable.resolution){if(e.var.variable.resolution instanceof Lt){if(!Kt.processTypeList(e.var,[{type:e.value,direction:e.direction}]))return!1}else if(!Kt.compareTypes({type:e.var.variable.resolution},{type:e.value}))return!1}else e.var.variable.resolution=e.value;return!0}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Ce=Symbol("internals");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ee{constructor(e,t,n,r,i){this.mutable=!0,this.entity=e,this.entityClass=t,this.schema=n,this.context=r,this.userIDComponent=i}getId(){if(void 0===this.id)throw new Error("no id");return this.id}getEntityClass(){return this.entityClass}isIdentified(){return void 0!==this.id}identify(e){d()(!this.isIdentified(),"identify() called on already identified entity"),this.id=e;const t=e.split(":"),n=t.lastIndexOf("uid");this.userIDComponent=n>0?t.slice(n+1).join(":"):""}createIdentity(e,t){let n;d()(!this.isIdentified(),"createIdentity() called on already identified entity"),n=this.userIDComponent?`${e.toString()}:uid:${this.userIDComponent}`:t.newChildId(e).toString(),this.id=n}isMutable(){return this.mutable}makeImmutable(){this.mutable=!1}mutate(e){if(!this.mutable)throw new Error("Entity is immutable.");let t;"function"==typeof e?e(t=this.dataClone()):t=e,xe(this.entity,t,this.schema,this.context)}toLiteral(){return JSON.parse(JSON.stringify(this.entity))}dataClone(){const e={},t=this.schema.fields;for(const n of Object.keys(t))void 0!==this.entity[n]&&(t[n]&&"schema-reference"===t[n].kind?this.entity[n]&&(e[n]=this.entity[n].dataClone()):t[n]&&"schema-collection"===t[n].kind?this.entity[n]&&(e[n]=[...this.entity[n]].map(e=>e.dataClone())):e[n]=this.entity[n]);return e}serialize(){return{id:this.id,rawData:this.dataClone()}}debugLog(){const e=this.entity,t=new Ee(null,this.entityClass,this.schema,this.context,this.userIDComponent);t.id=this.id,t.entity=t;const n=class extends ke{constructor(){super(),Object.assign(this,e),this[Ce]=t}};Object.defineProperty(n,"name",{value:e.constructor.name}),console.dir(new n,{depth:null})}}class ke{toString(){const e=Object.entries(this).map(([e,t])=>`${e}: ${JSON.stringify(t)}`);return`${this.constructor.name} { ${e.join(", ")} }`}static createEntityClass(e,t){const n=class extends ke{constructor(r,i){return super(),d()(r,"can't construct entity with null data"),d()(!i||-1===i.indexOf(":"),"user IDs must not contain the ':' character"),Object.defineProperty(this,Ce,{value:new Ee(this,n,e,t,i),enumerable:!1}),xe(this,r,e,t),new Proxy(this,{set:(e,t,n)=>{throw new Error(`Tried to modify entity field '${t}'. Use the mutate method instead.`)}})}static get type(){return new Ft(e)}static get key(){return{tag:"entity",schema:e}}static get schema(){return e}};return Object.defineProperty(n,"name",{value:e.name}),n}static id(e){return Te(e).getId()}static entityClass(e){return Te(e).getEntityClass()}static isIdentified(e){return Te(e).isIdentified()}static identify(e,t){return Te(e).identify(t),e}static createIdentity(e,t,n){Te(e).createIdentity(t,n)}static isMutable(e){return Te(e).isMutable()}static makeImmutable(e){Te(e).makeImmutable()}static mutate(e,t){Te(e).mutate(t)}static toLiteral(e){return Te(e).toLiteral()}static dataClone(e){return Te(e).dataClone()}static serialize(e){return Te(e).serialize()}static debugLog(e){Te(e).debugLog()}}function Te(e){const t=e[Ce];return d()(void 0!==t,"SYMBOL_INTERNALS lookup on non-entity"),t}function xe(e,t,n,r){for(const[i,s]of Object.entries(t)){const t=Ie(n.fields[i],s,i,r);Oe(i,t,n),e[i]=t}}function Re(e,t){switch(e.type){case"Text":case"URL":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Bytes":return"Uint8Array";default:throw new Error(`Unknown field type ${e.type} in schema ${t}`)}}function Oe(e,t,n,r){if(void 0===(r=r||n.fields[e]))throw new Error(`Can't set field ${e}; not in schema ${n.name}`);if(null!=t)switch(r.kind){case"schema-primitive":if(("Uint8Array"===t.constructor.name?"Uint8Array":typeof t)!==Re(r,n.name))throw new TypeError(`Type mismatch setting field ${e} (type ${r.type}); `+`value '${t}' is type ${typeof t}`);break;case"schema-union":for(const e of r.types)if(typeof t===Re(e,n.name))return;throw new TypeError(`Type mismatch setting field ${e} (union [${r.types}]); `+`value '${t}' is type ${typeof t}`);case"schema-tuple":if(!Array.isArray(t))throw new TypeError(`Cannot set tuple ${e} with non-array value '${t}'`);if(t.length!==r.types.length)throw new TypeError(`Length mismatch setting tuple ${e} `+`[${r.types}] with value '${t}'`);r.types.map((i,s)=>{if(void 0!==t[s]&&null!==t[s]&&typeof t[s]!==Re(i,n.name))throw new TypeError(`Type mismatch setting field ${e} (tuple [${r.types}]); `+`value '${t}' has type ${typeof t[s]} at index ${s}`)});break;case"schema-reference":if(!(t instanceof On))throw new TypeError(`Cannot set reference ${e} with non-reference '${t}'`);if(!Kt.compareTypes({type:t.type},{type:new qt(r.schema.model)}))throw new TypeError(`Cannot set reference ${e} with value '${t}' of mismatched type`);break;case"schema-collection":if("Set"!==t.constructor.name)throw new TypeError(`Cannot set collection ${e} with non-Set '${t}'`);for(const i of t)Oe(e,i,n,r.schema);break;default:throw new Error(`Unknown kind '${r.kind}' for field ${e} in schema ${n.name}`)}}function Ie(e,t,n,r){if(!e)return t;if("schema-reference"===e.kind&&t){if(t instanceof On)return t;if(t.id&&t.storageKey)return new On(t,new qt(e.schema.model),r);throw new TypeError(`Cannot set reference ${n} with non-reference '${t}'`)}if("schema-collection"===e.kind&&t){if("Set"===t.constructor.name)return t;if(t.length&&t instanceof Object)return new Set(t.map(t=>Ie(e.schema,t,n,r)));throw new TypeError(`Cannot set collection ${n} with non-collection '${t}'`)}return t}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Pe extends Error{}var Ne,Ae,De,Me,je;!function(e){e[e.Operations=0]="Operations",e[e.Model=1]="Model"}(Ne||(Ne={})),function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.FastForward=2]="FastForward"}(Ae||(Ae={}));class Fe{constructor(){this.model={values:{},version:{}}}merge(e){const t=Le(this.model.version,e.version),n={},r={type:Ae.FastForward,added:[],removed:[],oldClock:e.version,newClock:t};for(const t of Object.values(e.values)){const e=t.value,i=e.id,s=this.model.values[i];if(s)if($e(s.version,t.version))n[i]=s;else{const o=Le(s.version,t.version);n[i]={value:e,version:o},r.added.push([e,o])}else Be(this.model.version,t.version)?r.removed.push(e):n[i]=t}for(const[t,i]of Object.entries(this.model.values))e.values[t]||Be(e.version,i.version)||(n[t]=i,r.added.push([i.value,i.version]));const i=function(e){if(e.removed.length>0)return null;if(0===e.added.length)return null;const t=function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return null;const n=Object.entries(e).filter(([e,n])=>t[e]>n);return 1===n.length?n[0][0]:null}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(e.oldClock,e.newClock);if(null===t)return null;const n=[...e.added].sort(([e,n],[r,i])=>(n[t]||0)-(i[t]||0));let r=e.oldClock[t];for(const[e,i]of n)if(++r!==i[t])return null;const i={...e.oldClock};if(i[t]=r,!$e(i,e.newClock))return null;return n.map(([e,n])=>({type:Ae.Add,added:e,actor:t,clock:n}))}(r)||[r];return this.model.values=n,this.model.version=t,{modelChange:{changeType:Ne.Model,modelPostChange:this.model},otherChange:{changeType:Ne.Operations,operations:i}}}applyOperation(e){switch(e.type){case Ae.Add:return this.add(e.added,e.actor,e.clock);case Ae.Remove:return this.remove(e.removed,e.actor,e.clock);case Ae.FastForward:return this.fastForward(e);default:throw new Pe(`Op ${e} not supported`)}}getData(){return this.model}getParticleView(){return new Set(Object.values(this.model.values).map(e=>e.value))}add(e,t,n){if(this.checkValue(e),(this.model.version[t]||0)+1!==n[t])return!1;this.model.version[t]=n[t];const r=this.model.values[e.id]?this.model.values[e.id].version:{};return this.model.values[e.id]={value:e,version:Le(n,r)},!0}remove(e,t,n){if(this.checkValue(e),!this.model.values[e.id])return!1;const r=n[t]||0;return(this.model.version[t]||0)===r&&(!!Be(n,this.model.values[e.id].version)&&(this.model.version[t]=r,delete this.model.values[e.id],!0))}fastForward(e){const t=this.model.version;if(!Be(t,e.oldClock))return!1;if(Be(t,e.newClock))return!0;for(const[n,r]of e.added){this.checkValue(n);const e=this.model.values[n.id];e?e.version=Le(e.version,r):Be(t,r)||(this.model.values[n.id]={value:n,version:r})}for(const t of e.removed){this.checkValue(t);const n=this.model.values[t.id];n&&Be(e.newClock,n.version)&&delete this.model.values[t.id]}return this.model.version=Le(t,e.newClock),!0}checkValue(e){d()(e.id&&e.id.length,"CRDT value must have an ID.")}}function Le(e,t){const n={};for(const[t,r]of Object.entries(e))n[t]=r;for(const[r,i]of Object.entries(t))n[r]=Math.max(i,e[r]||0);return n}function $e(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const[n,r]of Object.entries(e))if(r!==t[n])return!1;return!0}function Be(e,t){for(const[n,r]of Object.entries(t))if((e[n]||0)<r)return!1;return!0}!function(e){e[e.Set=0]="Set",e[e.Clear=1]="Clear"}(De||(De={}));class Ue{constructor(){this.collection=new Fe}merge(e){this.collection.merge(e);const t={changeType:Ne.Model,modelPostChange:this.collection.getData()};return{modelChange:t,otherChange:t}}applyOperation(e){if(e.type===De.Clear)return this.clear(e.actor,e.clock);if(e.type===De.Set){const t={};for(const[n,r]of Object.entries(e.clock))t[n]=r;if(t[e.actor]=e.clock[e.actor]-1,!this.clear(e.actor,t))return!1;const n={type:Ae.Add,added:e.value,actor:e.actor,clock:e.clock};if(!this.collection.applyOperation(n))return!1}return!0}getData(){return this.collection.getData()}getParticleView(){return[...this.collection.getParticleView()].sort()[0]||null}clear(e,t){for(const n of Object.values(this.collection.getData().values)){const r={type:Ae.Remove,removed:n.value,actor:e,clock:t};this.collection.applyOperation(r)}return!0}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Set=0]="Set",e[e.Clear=1]="Clear",e[e.Add=2]="Add",e[e.Remove=3]="Remove"}(Me||(Me={}));class He{constructor(e,t){this.model={singletons:e,collections:t,version:{}}}merge(e){const t={},n={};let r=!0;for(const n of Object.keys(this.model.singletons))t[n]=this.model.singletons[n].merge(e.singletons[n]),t[n].modelChange.changeType!==Ne.Model&&t[n].otherChange.changeType!==Ne.Model||(r=!1);for(const t of Object.keys(this.model.collections))n[t]=this.model.collections[t].merge(e.collections[t]),n[t].modelChange.changeType!==Ne.Model&&n[t].otherChange.changeType!==Ne.Model||(r=!1);for(const t of Object.keys(e.version))this.model.version[t]=Math.max(this.model.version[t]||0,e.version[t]);if(r){const e=[],r=[];for(const n of Object.keys(t)){for(const r of t[n].modelChange.operations){let t;t=r.type===De.Set?{...r,type:Me.Set,field:n}:{...r,type:Me.Clear,field:n},e.push(t)}for(const e of t[n].otherChange.operations){let t;t=e.type===De.Set?{...e,type:Me.Set,field:n}:{...e,type:Me.Clear,field:n},r.push(t)}}for(const t of Object.keys(n)){for(const r of n[t].modelChange.operations){let n;n=r.type===Ae.Add?{...r,type:Me.Add,field:t}:{...r,type:Me.Remove,field:t},e.push(n)}for(const e of n[t].otherChange.operations){let n;n=e.type===Ae.Add?{...e,type:Me.Add,field:t}:{...e,type:Me.Remove,field:t},r.push(n)}}return{modelChange:{changeType:Ne.Operations,operations:e},otherChange:{changeType:Ne.Operations,operations:r}}}{const e={changeType:Ne.Model,modelPostChange:this.getData()};return{modelChange:e,otherChange:e}}}applyOperation(e){if(e.type===Me.Set||e.type===Me.Clear){if(!this.model.singletons[e.field]){if(this.model.collections[e.field])throw new Error(`Can't apply ${e.type===Me.Set?"Set":"Clear"} operation to collection field ${e.field}`);throw new Error(`Invalid field: ${e.field} does not exist`)}}else if(!this.model.collections[e.field]){if(this.model.singletons[e.field])throw new Error(`Can't apply ${e.type===Me.Add?"Add":"Remove"} operation to singleton field ${e.field}`);throw new Error(`Invalid field: ${e.field} does not exist`)}if((()=>{switch(e.type){case Me.Set:return this.model.singletons[e.field].applyOperation({...e,type:De.Set});case Me.Clear:return this.model.singletons[e.field].applyOperation({...e,type:De.Clear});case Me.Add:return this.model.collections[e.field].applyOperation({...e,type:Ae.Add});case Me.Remove:return this.model.collections[e.field].applyOperation({...e,type:Ae.Remove});default:throw new Error(`Unexpected op ${e} for Entity CRDT`)}})()){for(const t of Object.keys(e.clock))this.model.version[t]=Math.max(this.model.version[t]||0,e.clock[t]);return!0}return!1}getData(){const e={},t={};return Object.keys(this.model.singletons).forEach(t=>{e[t]=this.model.singletons[t].getData()}),Object.keys(this.model.collections).forEach(e=>{t[e]=this.model.collections[e].getData()}),{singletons:e,collections:t,version:this.model.version}}getParticleView(){const e={singletons:{},collections:{}};for(const t of Object.keys(this.model.singletons))e.singletons[t]=this.model.singletons[t].getParticleView();for(const t of Object.keys(this.model.collections))e.collections[t]=this.model.collections[t].getParticleView();return e}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ze{constructor(e,t,n){this.description={},this.names=e,this.fields={};for(const[e,n]of Object.entries(t))this.fields[e]="string"==typeof n?{kind:"schema-primitive",type:n}:n;n&&n.description.forEach(e=>this.description[e.name]=e.pattern||e.patterns[0])}toLiteral(){const e={},t=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:t.model.toLiteral()}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:t(e.schema)}:e};for(const n of Object.keys(this.fields))e[n]=t(this.fields[n]);return{names:this.names,fields:e,description:this.description}}static fromLiteral(e={fields:{},names:[],description:{}}){const t={},n=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:jt.fromLiteral(t.model)}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:n(e.schema)}:e};for(const r of Object.keys(e.fields))t[r]=n(e.fields[r]);const r=new ze(e.names,t);return r.description=e.description||{},r}get name(){return this.names[0]}static typesEqual(e,t){return ze._typeString(e)===ze._typeString(t)}static _typeString(e){switch(e.kind){case"schema-primitive":return e.type;case"schema-union":return`(${e.types.map(e=>e.type).join(" or ")})`;case"schema-tuple":return`(${e.types.map(e=>e.type).join(", ")})`;case"schema-reference":return`Reference<${ze._typeString(e.schema)}>`;case"type-name":case"schema-inline":return e.model.entitySchema.toInlineSchemaString();case"schema-collection":return`[${ze._typeString(e.schema)}]`;default:throw new Error(`Unknown type kind ${e.kind} in schema ${this.name}`)}}static union(e,t){const n=[...new Set([...e.names,...t.names])],r={};for(const[n,i]of[...Object.entries(e.fields),...Object.entries(t.fields)])if(r[n]){if(!ze.typesEqual(r[n],i))return null}else r[n]=i;return new ze(n,r)}static intersect(e,t){const n=[...e.names].filter(e=>t.names.includes(e)),r={};for(const[n,i]of Object.entries(e.fields)){const e=t.fields[n];e&&ze.typesEqual(i,e)&&(r[n]=i)}return new ze(n,r)}equals(e){return this===e||this.name===e.name&&this.isMoreSpecificThan(e)&&e.isMoreSpecificThan(this)}isMoreSpecificThan(e){const t=new Set(this.names);for(const n of e.names)if(!t.has(n))return!1;const n={};for(const[e,t]of Object.entries(this.fields))n[e]=t;for(const[t,r]of Object.entries(e.fields)){if(null==n[t])return!1;if(!ze.typesEqual(n[t],r))return!1}return!0}get type(){return new Ft(this)}entityClass(e=null){return ke.createEntityClass(this,e)}crdtConstructor(){const e={},t={};for(const[t,{type:n}]of Object.entries(this.fields))if("Text"===n)e[t]=new Ue;else{if("Number"!==n)throw new Error(`Big Scary Exception: entity field ${t} of type ${n} doesn't yet have a CRDT mapping implemented`);e[t]=new Ue}return class extends He{constructor(){super(e,t)}}}toInlineSchemaString(e){const t=this.names.join(" ")||"*",n=Object.entries(this.fields).map(([e,t])=>`${ze._typeString(t)} ${e}`).join(", ");return`${t} {${n.length>0&&e&&e.hideFields?"...":n}}`}toManifestString(){const e=[];if(e.push(`schema ${this.names.join(" ")}`),e.push(...Object.entries(this.fields).map(([e,t])=>`  ${ze._typeString(t)} ${e}`)),Object.keys(this.description).length>0){e.push(`  description \`${this.description.pattern}\``);for(const t of Object.keys(this.description))"pattern"!==t&&e.push(`    ${t} \`${this.description[t]}\``)}return e.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class qe{constructor(e,t){this.formFactor=e,this.handle=t}toLiteral(){return this}static fromLiteral({formFactor:e,handle:t}){return new qe(e,t)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class We{constructor(e,t){this.id=e.toString(),this.serialization=t.replace(/\bimport .*\n/g,"")}static extractSerialization(e){return e.serialization.replace(/\bimport .*\n/g,"")}}class Ve{constructor(e,t,n,r){this.id=e,this.storageKey=t,this.type=n,this.tags=r}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ke{constructor(e,t,n){this.name=e,this._canWriteSuperset=t,this._canReadSubset=n,this._resolution=null}maybeMergeConstraints(e){return!!this.maybeMergeCanReadSubset(e.canReadSubset)&&this.maybeMergeCanWriteSuperset(e.canWriteSuperset)}maybeMergeCanReadSubset(e){if(null==e)return!0;if(null==this.canReadSubset)return this.canReadSubset=e,!0;if(this.canReadSubset instanceof zt&&e instanceof zt)return!0;if(this.canReadSubset instanceof Ft&&e instanceof Ft){const t=ze.intersect(this.canReadSubset.entitySchema,e.entitySchema);return!!t&&(this.canReadSubset=new Ft(t),!0)}return!1}maybeMergeCanWriteSuperset(e){if(null==e)return!0;if(null==this.canWriteSuperset)return this.canWriteSuperset=e,!0;if(this.canWriteSuperset instanceof zt&&e instanceof zt)return!0;if(this.canWriteSuperset instanceof Ft&&e instanceof Ft){const t=ze.union(this.canWriteSuperset.entitySchema,e.entitySchema);return!!t&&(this.canWriteSuperset=new Ft(t),!0)}return!1}isSatisfiedBy(e){const t=this._canWriteSuperset;if(!t)return!0;if(!(t instanceof Ft&&e instanceof Ft))throw new Error(`constraint checking not implemented for ${this} and ${e}`);return e.getEntitySchema().isMoreSpecificThan(t.getEntitySchema())}get resolution(){return this._resolution?this._resolution.resolvedType():null}isValidResolutionCandidate(e){const t=e.resolvedType().getContainedType();return t instanceof Lt&&t.variable===this?{result:!1,detail:"variable cannot resolve to collection of itself"}:{result:!0}}set resolution(e){d()(!this._resolution);const t=this.isValidResolutionCandidate(e);d()(t.result,t.detail);let n=e;for(;n&&n instanceof Lt;){if(n.variable===this)return;n=n.variable.resolution}this._resolution=e,this._canWriteSuperset=null,this._canReadSubset=null}get canWriteSuperset(){return this._resolution?(d()(!this._canWriteSuperset),this._resolution instanceof Lt?this._resolution.variable.canWriteSuperset:null):this._canWriteSuperset}set canWriteSuperset(e){d()(!this._resolution),this._canWriteSuperset=e}get canReadSubset(){return this._resolution?(d()(!this._canReadSubset),this._resolution instanceof Lt?this._resolution.variable.canReadSubset:null):this._canReadSubset}set canReadSubset(e){d()(!this._resolution),this._canReadSubset=e}get hasConstraint(){return null!==this._canReadSubset||null!==this._canWriteSuperset}canEnsureResolved(){return this._resolution?this._resolution.canEnsureResolved():!(!this._canWriteSuperset&&!this._canReadSubset)}maybeEnsureResolved(){return this._resolution?this._resolution.maybeEnsureResolved():this._canWriteSuperset?(this.resolution=this._canWriteSuperset,!0):!!this._canReadSubset&&(this.resolution=this._canReadSubset,!0)}toLiteral(){return d()(null==this.resolution),this.toLiteralIgnoringResolutions()}toLiteralIgnoringResolutions(){return{name:this.name,canWriteSuperset:this._canWriteSuperset&&this._canWriteSuperset.toLiteral(),canReadSubset:this._canReadSubset&&this._canReadSubset.toLiteral()}}static fromLiteral(e){return new Ke(e.name,e.canWriteSuperset?jt.fromLiteral(e.canWriteSuperset):null,e.canReadSubset?jt.fromLiteral(e.canReadSubset):null)}isResolved(){return this._resolution&&this._resolution.isResolved()}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Increment=0]="Increment",e[e.MultiIncrement=1]="MultiIncrement"}(je||(je={}));
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Qe{}const Ge=new class extends Qe{next(){return Math.random()}};class Ze{static next(){return Ge.next()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ye{constructor(e){this._nextComponentId=0,this._currentSessionId=e}static newSession(){const e=Math.floor(Ze.next()*Math.pow(2,50))+"";return new Ye(e)}static createWithSessionIdForTesting(e){return new Ye(e)}newArcId(e){return Je._newArcIdInternal(this._currentSessionId,e)}newChildId(e,t=""){return t+=this._nextComponentId++,Xe._newIdInternal(this._currentSessionId,[...e.idTree,t])}get currentSessionIdForTesting(){return this._currentSessionId}}class Xe{constructor(e,t=[]){this.idTree=[],this.root=e,this.idTree=t}static _newIdInternal(e,t=[]){return new Xe(e,t)}static fromString(e){const t=e.split(":");if(t[0].startsWith("!")){const e=t[0].slice(1),n=t.slice(1).filter(e=>e.length>0);return new Xe(e,n)}return new Xe("",t)}toString(){return`!${this.root}:${this.idTree.join(":")}`}idTreeAsString(){return this.idTree.join(":")}equal(e){if(e.root!==this.root||e.idTree.length!==this.idTree.length)return!1;for(let t=0;t<e.idTree.length;t++)if(e.idTree[t]!==this.idTree[t])return!1;return!0}}class Je extends Xe{static _newArcIdInternal(e,t){return new Je(e,[t])}static newForTest(e){return Ye.newSession().newArcId(e)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const et=(e,t)=>t([e]);
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var tt,nt,rt,it,st,ot,at,ct,lt,ht;!function(e){e[e.ShouldExist=0]="ShouldExist",e[e.ShouldCreate=1]="ShouldCreate",e[e.MayExist=2]="MayExist"}(tt||(tt={}));class ut{constructor(e,t){this.storageKey=e,this.exists=t}}class dt{static clearRegistrationsForTesting(){this.providers=new Set}static async driverInstance(e,t){for(const n of this.providers)if(n.willSupport(e))return n.driver(e,t);return null}static register(e){this.providers.add(e)}static unregister(e){this.providers.delete(e)}static willSupport(e){for(const t of this.providers)if(t.willSupport(e))return!0;return!1}}dt.providers=new Set,function(e){e[e.Direct=0]="Direct",e[e.Backing=1]="Backing",e[e.ReferenceMode=2]="ReferenceMode"}(nt||(nt={})),function(e){e[e.SyncRequest=0]="SyncRequest",e[e.ModelUpdate=1]="ModelUpdate",e[e.Operations=2]="Operations"}(rt||(rt={}));class pt{constructor(e){this.storageKey=e.storageKey,this.exists=e.exists,this.type=e.type,this.mode=e.mode,this.baseStore=e.baseStore}async idle(){return Promise.resolve()}async toLiteral(){throw new Error("Method not implemented.")}async cloneFrom(e){throw new Error("Method not implemented.")}async modelForSynchronization(){return this.toLiteral()}getStorageEndpoint(){const e=this;let t;return{onProxyMessage:async n=>(n.id=t,e.onProxyMessage(n)),setCallback(n){t=e.on(n)},reportExceptionInHost(t){e.reportExceptionInHost(t)}}}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.Idle="Idle",e.AwaitingResponse="AwaitingResponse",e.AwaitingResponseDirty="AwaitingResponseDirty",e.AwaitingDriverModel="AwaitingDriverModel"}(it||(it={}));class ft extends pt{constructor(e){super(e),this.callbacks=new Map,this.nextCallbackID=1,this.version=0,this.pendingException=null,this.pendingResolves=[],this.pendingRejects=[],this.pendingDriverModels=[],this.state=it.Idle}async idle(){return this.pendingException?Promise.reject(this.pendingException):this.state===it.Idle?Promise.resolve():new Promise((e,t)=>{this.pendingResolves.push(e),this.pendingRejects.push(t)})}setState(e){this.state=e,e===it.Idle&&this.notifyIdle()}notifyIdle(){this.pendingException?this.pendingRejects.forEach(e=>e(this.pendingException)):(this.pendingResolves.forEach(e=>e()),this.pendingResolves=[])}static async construct(e){const t=new ft(e);if(t.localModel=new(e.type.crdtInstanceConstructor()),t.driver=await dt.driverInstance(e.storageKey,e.exists),null==t.driver)throw new Pe(`No driver exists to support storage key ${e.storageKey}`);return t.driver.registerReceiver(t.onReceive.bind(t)),t}async onReceive(e,t){this.pendingDriverModels.push({model:e,version:t}),this.state!==it.AwaitingResponse&&this.state!==it.AwaitingResponseDirty&&this.applyPendingDriverModels()}deliverCallbacks(e,t,n){e.changeType===Ne.Operations&&e.operations.length>0?this.callbacks.forEach((r,i)=>{(t||n!==i)&&r({type:rt.Operations,operations:e.operations,id:i})}):e.changeType===Ne.Model&&this.callbacks.forEach((r,i)=>{(t||n!==i)&&r({type:rt.ModelUpdate,model:e.modelPostChange,id:i})})}async processModelChange(e,t,n,r){this.deliverCallbacks(e,!1,r),await this.updateStateAndAct(this.noDriverSideChanges(e,t,!1),n,!1)}async updateStateAndAct(e,t,n){if(e)return this.setState(it.Idle),void(this.version=t);switch(this.state){case it.AwaitingDriverModel:if(!n)return;case it.Idle:for(;;){if(this.setState(it.AwaitingResponse),this.state=it.AwaitingResponse,this.version=++t,!await this.driver.send(this.localModel.getData(),t)){this.setState(it.AwaitingDriverModel),this.applyPendingDriverModels();break}if(this.state===it.AwaitingResponse){this.setState(it.Idle),this.applyPendingDriverModels();break}if(this.state!==it.AwaitingResponseDirty)throw new Error("reached impossible state in store state machine")}return;case it.AwaitingResponse:return void this.setState(it.AwaitingResponseDirty);case it.AwaitingResponseDirty:return;default:throw new Error("reached impossible default state in switch statement")}}applyPendingDriverModels(){if(this.pendingDriverModels.length>0){const e=this.pendingDriverModels;this.pendingDriverModels=[];let t=!0,n=0;for(const{model:r,version:i}of e)try{const{modelChange:e,otherChange:s}=this.localModel.merge(r);this.deliverCallbacks(e,!0,0),t=t&&this.noDriverSideChanges(e,s,!0),n=i}catch(e){return this.pendingException=e,void this.notifyIdle()}this.updateStateAndAct(t,n,!0)}}noDriverSideChanges(e,t,n){return n?t.changeType===Ne.Operations&&0===t.operations.length:e.changeType===Ne.Operations&&0===e.operations.length}async onProxyMessage(e){if(this.pendingException)throw this.pendingException;switch(e.type){case rt.SyncRequest:return await this.callbacks.get(e.id)({type:rt.ModelUpdate,model:this.localModel.getData(),id:e.id}),!0;case rt.Operations:{for(const t of e.operations)if(!this.localModel.applyOperation(t))return await this.callbacks.get(e.id)({type:rt.SyncRequest,id:e.id}),!1;const t={changeType:Ne.Operations,operations:e.operations};return this.processModelChange(t,null,this.version,e.id),!0}case rt.ModelUpdate:{const{modelChange:t,otherChange:n}=this.localModel.merge(e.model);return this.processModelChange(t,n,this.version,e.id),!0}default:throw new Pe("Invalid operation provided to onProxyMessage")}}on(e){const t=this.nextCallbackID++;return this.callbacks.set(t,e),t}off(e){this.callbacks.delete(e)}reportExceptionInHost(e){this.pendingException=e,this.notifyIdle()}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class mt{constructor(e){this.stores={},this.callbacks=new Map,this.nextCallbackId=1,this.storageKey=e.storageKey,this.options=e}on(e){return this.callbacks.set(this.nextCallbackId,e),this.nextCallbackId++}off(e){this.callbacks.delete(e)}getLocalModel(e){const t=this.stores[e];return null==t?(this.stores[e]={type:"pending",promise:this.setupStore(e)},null):"pending"===t.type?null:t.store.localModel}async setupStore(e){const t=await ft.construct({...this.options,storageKey:this.storageKey.childWithComponent(e)}),n=t.on(t=>this.processStoreCallback(e,t)),r={store:t,id:n,type:"record"};return this.stores[e]=r,r}async onProxyMessage(e,t){let n=this.stores[t];null==n&&(n=await this.setupStore(t)),"pending"===n.type&&(n=await n.promise);const{store:r,id:i}=n;return e.id=i,r.onProxyMessage(e)}static async construct(e){return new mt(e)}async idle(){const e=[];for(const t of Object.values(this.stores))"record"===t.type&&e.push(t.store);await Promise.all(e.map(e=>e.idle()))}async processStoreCallback(e,t){return Promise.all([...this.callbacks.values()].map(n=>n(t,e))).then(e=>e.reduce((e,t)=>e&&t))}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class yt{constructor(e){this.protocol=e}childKeyForArcInfo(){return this.childWithComponent("arc-info")}childKeyForHandle(e){return this.childWithComponent(`handle/${e}`)}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Container=0]="Container",e[e.BackingStore=1]="BackingStore",e[e.StorageProxy=2]="StorageProxy"}(st||(st={}));class gt extends yt{constructor(e,t){super("reference-mode"),this.backingKey=e,this.storageKey=t}embedKey(e){return e.toString().replace(/\{/g,"{{").replace(/\}/g,"}}")}toString(){return`${this.protocol}://{${this.embedKey(this.backingKey)}}{${this.embedKey(this.storageKey)}}`}childWithComponent(e){return new gt(this.backingKey,this.storageKey.childWithComponent(e))}}class _t extends pt{constructor(){super(...arguments),this.callbacks=new Map,this.nextCallbackID=1,this.crdtKey=Math.random()*Math.pow(2,64)+"",this.versions={},this.receiveQueue=[],this.pendingSends=[],this.holdQueue=new bt,this.blockCounter=0}static async construct(e){const t=new _t(e),{storageKey:n,type:r}=e;let i;return t.backingStore=await mt.construct({storageKey:n.backingKey,type:r.getContainedType(),mode:nt.Backing,exists:e.exists,baseStore:e.baseStore}),i=r.isCollectionType()?new $t(new qt(r.getContainedType())):new qt(r.getContainedType()),t.containerStore=await ft.construct({storageKey:n.storageKey,type:r,mode:nt.Direct,exists:e.exists,baseStore:e.baseStore}),t.registerStoreCallbacks(),t}reportExceptionInHost(e){}on(e){const t=this.nextCallbackID++;return this.callbacks.set(t,e),t}off(e){this.callbacks.delete(e)}registerStoreCallbacks(){this.backingStore.on(this.onBackingStore.bind(this)),this.containerStore.on(this.onContainerStore.bind(this))}async onContainerStore(e){return this.enqueue({from:st.Container,message:e})}async onBackingStore(e,t){return this.enqueue({from:st.BackingStore,message:e,muxId:t})}async onProxyMessage(e){return this.enqueue({from:st.StorageProxy,message:e})}async enqueue(e){return new Promise((t,n)=>{const r=0===this.receiveQueue.length;this.receiveQueue.push({...e,promise:t}),r&&this.processQueue()})}async processQueue(){for(;this.receiveQueue.length>0;){const e=this.receiveQueue[0];switch(e.from){case st.StorageProxy:e.promise(await this.handleProxyMessage(e.message));break;case st.BackingStore:e.promise(await this.handleBackingStore(e.message,e.muxId));break;case st.Container:e.promise(await this.handleContainerStore(e.message));break;default:throw new Error("invalid message type")}this.receiveQueue.shift()}}async handleContainerStore(e){switch(e.type){case rt.Operations:for(const t of e.operations){const e=this.operationElement(t);let n;if(e){const r=this.backingStore.getLocalModel(e.id);if(!r){this.enqueueBlockingSend([e],()=>{const n=this.backingStore.getLocalModel(e.id),r=this.updateOp(t,()=>this.entityFromModel(n.getData(),e.id));this.send({type:rt.Operations,operations:[r]})});break}n=(()=>this.entityFromModel(r.getData(),e.id))}else n=(()=>null);this.enqueueSend(()=>{const e=this.updateOp(t,n);this.send({type:rt.Operations,operations:[e]})})}break;case rt.ModelUpdate:{const t=e.model,{pendingIds:n,model:r}=this.constructPendingIdsAndModel(t),i=()=>void this.send({type:rt.ModelUpdate,model:r()});0===n.length?this.enqueueSend(i):this.enqueueBlockingSend(n,i);break}case rt.SyncRequest:this.enqueueSend(()=>{this.send({type:rt.SyncRequest})});break;default:throw new Error("Unexpected ProxyMessageType")}return!0}async handleBackingStore(e,t){switch(e.type){case rt.ModelUpdate:this.holdQueue.processID(t,e.model.version);break;case rt.Operations:this.holdQueue.processID(t,e.operations[e.operations.length-1].clock);break;case rt.SyncRequest:throw new Error("Unexpected SyncRequest from backing store");default:throw new Error("Unexpected ProxyMessageType")}return!0}async handleProxyMessage(e){switch(e.type){case rt.Operations:{const t=e.operations;for(const n of t){const t=this.operationElement(n);let r=null;if(t){await this.updateBackingStore(t);const e=this.backingStore.getLocalModel(t.id).getData().version;r={id:t.id,storageKey:this.backingStore.storageKey,version:e}}const i=this.updateOp(n,()=>r);if(!await this.containerStore.onProxyMessage({type:rt.Operations,operations:[i],id:1}))return!1;this.enqueueSend(()=>void this.sendExcept(e,e.id))}break}case rt.ModelUpdate:{const{version:t,values:n}=e.model,r={},i=[];Object.entries(n).forEach(([e,{value:t,version:n}])=>{i.push(this.updateBackingStore(t).then(t=>{if(t){const t=this.backingStore.getLocalModel(e).getData().version;r[e]={value:{id:e,storageKey:this.backingStore.storageKey,version:t},version:n}}return t}))}),await Promise.all(i);const s={version:t,values:r};await this.containerStore.onProxyMessage({type:rt.ModelUpdate,model:s,id:1}),this.enqueueSend(()=>this.sendExcept(e,e.id));break}case rt.SyncRequest:{const{pendingIds:t,model:n}=this.constructPendingIdsAndModel(this.containerStore.localModel.getData()),r=()=>void this.callbacks.get(e.id)({type:rt.ModelUpdate,model:n(),id:e.id});0===t.length?this.enqueueSend(r):this.enqueueBlockingSend(t,r);break}default:throw new Error("Unexpected ProxyMessageType")}return!0}enqueueSend(e){0===this.pendingSends.length?e():this.pendingSends.push({fn:e})}enqueueBlockingSend(e,t){const n=this.blockCounter+++"";this.pendingSends.push({fn:t,block:n}),this.holdQueue.enqueue(e,()=>this.processPendingSends(n))}processPendingSends(e){for(;this.pendingSends.length>0;)if(null==this.pendingSends[0].block||this.pendingSends[0].block===e){this.pendingSends.shift().fn()}}entityToModel(e){null==this.versions[e.id]&&(this.versions[e.id]={});const t=this.versions[e.id],n=this.newBackingInstance().getData();let r=0;for(const i of Object.keys(e)){if("id"===i)continue;null==t[i]&&(t[i]=0);const s={[this.crdtKey]:++t[i]};if(r=Math.max(r,t[i]),n.singletons[i])n.singletons[i].values={[e[i].id]:{value:e[i],version:s}},n.singletons[i].version=s;else{if(!n.collections[i])throw new Error(`key ${i} not found for model ${n}`);n.collections[i].values={};for(const t of e[i])n.collections[i].values[t.id]={value:t,version:s};n.collections[i].version=s}}return n.version={[this.crdtKey]:r},n}entityFromModel(e,t){const n={id:t},r={};for(const t of Object.keys(e.singletons))r[t]=new Ue;const i={};for(const t of Object.keys(e.collections))i[t]=new Fe;const s=new He(r,i);s.merge(e);const o=s.getParticleView();for(const[e,t]of Object.entries(o.singletons))n[e]=t;for(const[e,t]of Object.entries(o.collections))n[e]=t;return n}cloneMap(e){const t={};return Object.entries(e).forEach(([e,n])=>t[e]=n),t}constructPendingIdsAndModel(e){const t=[];for(const n of Object.keys(e.values)){const r=e.values[n].value.version;if(0===Object.keys(r).length)continue;const i=this.backingStore.getLocalModel(n);null!=i&&vt(i.getData().version,r)||t.push({id:n,version:r})}return{pendingIds:t,model:()=>{const t={values:{},version:this.cloneMap(e.version)};for(const n of Object.keys(e.values)){const r=e.values[n].value.version,i=0===Object.keys(r).length?this.newBackingInstance():this.backingStore.getLocalModel(n);t.values[n]={value:this.entityFromModel(i.getData(),n),version:e.values[n].version}}return t}}}async send(e){for(const t of this.callbacks.keys())this.callbacks.get(t)({...e,id:t})}async sendExcept(e,t){for(const n of this.callbacks.keys())n!==t&&this.callbacks.get(n)({...e,id:n})}async updateBackingStore(e){const t=this.entityToModel(e);return this.backingStore.onProxyMessage({type:rt.ModelUpdate,model:t,id:1},e.id)}newBackingInstance(){return new(this.type.getContainedType().crdtInstanceConstructor())}processOp(e,t,n,r,i){if(wt(i))switch(i.type){case Ae.Add:return e(i);case Ae.Remove:return t(i);default:throw new Error("unexpected operation type")}else if(function(e){return!wt(e)}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(i))switch(i.type){case De.Set:return n(i);case De.Clear:return r(i);default:throw new Error("unexpected operation type")}throw new Error("unexpected operation type")}operationElement(e){return this.processOp(e=>e.added,e=>e.removed,e=>e.value,e=>null,e)}updateOp(e,t){return this.processOp(e=>({...e,added:t()}),e=>({...e,removed:t()}),e=>({...e,value:t()}),e=>e,e)}}function vt(e,t){for(const n in Object.keys(t))if(e[n]<t[n])return!1;return!0}class bt{constructor(){this.queue={}}enqueue(e,t){const n={};for(const{id:t,version:r}of e)n[t]=r;const r={ids:n,onRelease:t};for(const t of e)this.queue[t.id]||(this.queue[t.id]=[]),this.queue[t.id].push(r)}processID(e,t){const n=this.queue[e];if(n){for(const r of n)vt(t,r.ids[e])&&(delete r.ids[e],0===Object.keys(r.ids).length&&r.onRelease());this.queue[e]=[]}}}function wt(e){return Boolean(e.added||e.removed)}function St(e,t){return e===t?0:null===e?-1:1}function Ct(e,t){return null==e||null==t?St(e,t):e.localeCompare(t)}function Et(e,t){return null==e||null==t?St(e,t):e-t}function kt(e,t,n){if(d()(null!=e),d()(null!=t),e.length!==t.length)return Et(e.length,t.length);for(let r=0;r<e.length;r++){let i;if(0!==(i=n(e[r],t[r])))return i}return 0}function Tt(e,t){return null==e||null==t?St(e,t):e._compareTo(t)}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class xt{constructor(e){this.storeInfo=e}get id(){return this.storeInfo.id}get name(){return this.storeInfo.name}get type(){return this.storeInfo.type}get originalId(){return this.storeInfo.originalId}get source(){return this.storeInfo.source}get description(){return this.storeInfo.description}get claims(){return this.storeInfo.claims}castToStorageStub(){return d()("StorageStub"===this.unifiedStoreType,"Not a StorageStub!"),this}reportExceptionInHost(e){throw e}_compareTo(e){let t;return 0!==(t=Ct(this.name,e.name))?t:0!==(t=Et(this.version,e.version))?t:0!==(t=Ct(this.source,e.source))?t:0!==(t=Ct(this.id,e.id))?t:0}toManifestString(e){e=e||{};const t={...this.storeInfo,...e.overrides},n=[],r=[];return r.push("store"),t.name&&r.push(`${t.name}`),r.push(`of ${t.type.toString()}`),t.id&&r.push(`'${t.id}'`),t.originalId&&r.push(`!!${t.originalId}`),null!=this.version&&r.push(`@${this.version}`),e.handleTags&&e.handleTags.length&&r.push(`${e.handleTags.map(e=>`#${e}`).join(" ")}`),t.source?"file"===t.origin?r.push(`in '${t.source}'`):r.push(`in ${t.source}`):this.storageKey&&r.push(`at '${this.storageKey}'`),n.push(r.join(" ")),t.claims&&t.claims.length>0&&n.push(`  claim is ${t.claims.map(e=>e.tag).join(" and is ")}`),t.description&&n.push(`  description \`${t.description}\``),n.join("\n")}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Rt extends xt{constructor(e){super(e),this.unifiedStoreType="Store",this.version=0,this.storageKey=e.storageKey,this.exists=e.exists,this.mode=e.storageKey instanceof gt?nt.ReferenceMode:nt.Direct}async activate(){if(this.activeStore)return this.activeStore;if(null==Rt.constructors.get(this.mode))throw new Error(`StorageMode ${this.mode} not yet implemented`);const e=Rt.constructors.get(this.mode);if(null==e)throw new Error(`No constructor registered for mode ${this.mode}`);const t=await e.construct({storageKey:this.storageKey,exists:this.exists,type:this.type,mode:this.mode,baseStore:this});return this.exists=tt.ShouldExist,this.activeStore=t,t}get referenceMode(){return this.mode===nt.ReferenceMode}}Rt.constructors=new Map([[nt.Direct,ft],[nt.ReferenceMode,_t]]);
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ot{constructor(e,t,n){this.handles=[],this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=!1,this.modelHasSynced=(()=>void 0),this.apiChannelId=e,this.store=t.getStorageEndpoint(this),this.crdt=new(n.crdtInstanceConstructor()),this.type=n,this.scheduler=new Pt}get pec(){throw new Error("StorageProxyNG does not have a pec.")}async idle(){return this.scheduler.idle}reportExceptionInHost(e){et?et(e.cause.stack,t=>{e.cause.stack=t,this.store.reportExceptionInHost(e)}):this.store.reportExceptionInHost(e)}registerHandle(e){return this.handles.push(e),this.listenerAttached||(this.store.setCallback(e=>this.onMessage(e)),this.listenerAttached=!0),e.options.keepSynced&&(this.keepSynced||(this.requestSynchronization().catch(t=>{this.reportExceptionInHost(new ae(t,e.key,"StorageProxy::registerHandle"))}),this.keepSynced=!0),e.options.notifySync&&this.synchronized&&e.onSync()),this.versionCopy()}deregisterHandle(e){this.handles=this.handles.filter(t=>t!==e)}versionCopy(){const e={};for(const[t,n]of Object.entries(this.crdt.getData().version))e[t]=n;return e}async applyOp(e){const t=this.crdt.getParticleView();if(!this.crdt.applyOperation(e))return!1;const n={type:rt.Operations,operations:[e]};return await this.store.onProxyMessage(n),this.notifyUpdate(e,t),!0}async getParticleView(){if(this.synchronized)return[this.crdt.getParticleView(),this.versionCopy()];{const e=new Promise(e=>{this.modelHasSynced=(()=>{this.modelHasSynced=(()=>void 0),e([this.crdt.getParticleView(),this.versionCopy()])})});return await this.requestSynchronization(),e}}async onMessage(e){switch(e.type){case rt.ModelUpdate:this.crdt.merge(e.model),this.synchronized=!0,this.modelHasSynced(),this.notifySync();break;case rt.Operations:{if(!this.keepSynced)return!1;let t=this.crdt.getParticleView();for(const n of e.operations){if(!this.crdt.applyOperation(n))return this.synchronized=!1,await this.notifyDesync(),this.requestSynchronization();this.notifyUpdate(n,t),t=this.crdt.getParticleView()}this.synchronized=!0;break}case rt.SyncRequest:await this.store.onProxyMessage({type:rt.ModelUpdate,model:this.crdt.getData()});break;default:throw new Pe(`Invalid operation provided to onMessage, message: ${e}`)}return!0}notifyUpdate(e,t){const n=this.versionCopy();for(const r of this.handles)r.options.notifyUpdate?this.scheduler.enqueue(r.particle,r,{type:ot.Update,op:e,oldData:t,version:n}):r.options.keepSynced&&this.scheduler.enqueue(r.particle,r,{type:ot.Sync})}notifySync(){for(const e of this.handles)e.options.notifySync&&this.scheduler.enqueue(e.particle,e,{type:ot.Sync})}notifyDesync(){for(const e of this.handles)e.options.notifyDesync&&this.scheduler.enqueue(e.particle,e,{type:ot.Desync})}async requestSynchronization(){return this.store.onProxyMessage({type:rt.SyncRequest})}}class It extends Ot{constructor(){super(null,{getStorageEndpoint(){}},Ft.make([],{}))}async idle(){return new Promise(e=>{})}reportExceptionInHost(e){}registerHandle(e){return{}}deregisterHandle(e){}versionCopy(){return null}async applyOp(e){return new Promise(e=>{})}async getParticleView(){return new Promise(e=>{})}async getData(){return new Promise(e=>{})}async onMessage(e){return new Promise(e=>{})}notifyUpdate(e,t){}notifySync(){}notifyDesync(){}async requestSynchronization(){return new Promise(e=>{})}}!function(e){e[e.Sync=0]="Sync",e[e.Desync=1]="Desync",e[e.Update=2]="Update"}(ot||(ot={}));class Pt{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(e,t,n){this._queues.has(e)||this._queues.set(e,new Map);const r=this._queues.get(e);r.has(t)||r.set(t,[]),r.get(t).push(n),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(e=>this._idleResolver=e)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const e=[...this._queues.keys()][0],t=this._queues.get(e);this._queues.delete(e);for(const[e,n]of t.entries())for(const t of n)this._dispatchUpdate(e,t).catch(t=>e.storageProxy.reportExceptionInHost(new ae(t,"StorageProxyScheduler::_dispatch",e.key)))}this._updateIdle()}async _dispatchUpdate(e,t){switch(t.type){case ot.Sync:e.onSync();break;case ot.Desync:await e.onDesync();break;case ot.Update:e.onUpdate(t.op,t.oldData,t.version);break;default:console.error("Ignoring unknown update",t)}}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Nt{constructor(e,t,n,r,i,s,o){this.key=e,this.name=o,this.storageProxy=t,this.idGenerator=n,this.particle=r,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1},this.canRead=i,this.canWrite=s,this.clock=this.storageProxy.registerHandle(this)}get storage(){return this.storageProxy}get type(){return this.storageProxy.type}get _id(){return this.storageProxy.apiChannelId}createIdentityFor(e){ke.createIdentity(e,Xe.fromString(this._id),this.idGenerator)}configure(e){d()(this.canRead,"configure can only be called on readable Handles"),this.options={...this.options,...e}}reportUserExceptionInHost(e,t,n){this.storageProxy.reportExceptionInHost(new ce(e,n,this.key,t.spec.name))}async onDesync(){await this.particle.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,this.particle,"onHandleDesync"))}disable(e){this.storageProxy.deregisterHandle(this),this.storageProxy=new It}}class At extends Nt{constructor(e,t,n,r,i,s,o){super(e,t,n,r,i,s,o);const a=this.storageProxy.type.getContainedType()||this.storageProxy.type;if(!(a instanceof Ft))throw new Error("can't construct handle for entity mutation if type is not an entity type");this.entityClass=a.entitySchema.entityClass()}serialize(e){return e[Ce].serialize()}ensureEntityHasId(e){ke.isIdentified(e)||this.createIdentityFor(e)}deserialize(e){const{id:t,rawData:n}=e,r=new this.entityClass(n);return ke.identify(r,t),r}}class Dt extends At{async get(e){const t=await this.toCRDTList();return this.deserialize(t.find(t=>t.id===e))}async add(e){this.ensureEntityHasId(e),this.clock[this.key]=(this.clock[this.key]||0)+1;const t={type:Ae.Add,added:this.serialize(e),actor:this.key,clock:this.clock};return this.storageProxy.applyOp(t)}async addMultiple(e){return Promise.all(e.map(e=>this.add(e))).then(e=>e.every(Boolean))}async remove(e){const t={type:Ae.Remove,removed:this.serialize(e),actor:this.key,clock:this.clock};return this.storageProxy.applyOp(t)}async clear(){const e=await this.toCRDTList();for(const t of e){const e={type:Ae.Remove,removed:t,actor:this.key,clock:this.clock};if(!this.storageProxy.applyOp(e))return!1}return!0}async toList(){return(await this.toCRDTList()).map(e=>this.deserialize(e))}async toCRDTList(){const[e,t]=await this.storageProxy.getParticleView();return this.clock=t,[...e]}async onUpdate(e,t,n){if(this.clock=n,e.type===Ae.FastForward)return this.onSync();const r={originator:"actor"in e&&this.key===e.actor};e.type===Ae.Add&&(r.added=this.deserialize(e.added)),e.type===Ae.Remove&&(r.removed=this.deserialize(e.removed)),await this.particle.callOnHandleUpdate(this,r,e=>this.reportUserExceptionInHost(e,this.particle,"onHandleUpdate"))}async onSync(){await this.particle.callOnHandleSync(this,this.toList(),e=>this.reportUserExceptionInHost(e,this.particle,"onHandleSync"))}}class Mt extends At{async set(e){this.ensureEntityHasId(e),this.clock[this.key]=(this.clock[this.key]||0)+1;const t={type:De.Set,value:this.serialize(e),actor:this.key,clock:this.clock};return this.storageProxy.applyOp(t)}async clear(){const e={type:De.Clear,actor:this.key,clock:this.clock};return this.storageProxy.applyOp(e)}async get(){const[e,t]=await this.storageProxy.getParticleView();return this.clock=t,null==e?null:this.deserialize(e)}async onUpdate(e,t,n){this.clock=n;const r={oldData:t,originator:this.key===e.actor};e.type===De.Set&&(r.data=this.deserialize(e.value)),await this.particle.callOnHandleUpdate(this,r,e=>this.reportUserExceptionInHost(e,this.particle,"onHandleUpdate"))}async onSync(){await this.particle.callOnHandleSync(this,this.get(),e=>this.reportUserExceptionInHost(e,this.particle,"onHandleSync"))}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class jt{constructor(e){this.tag=e}static fromLiteral(e){switch(e.tag){case"Entity":return new Ft(ze.fromLiteral(e.data));case"TypeVariable":return new Lt(Ke.fromLiteral(e.data));case"Collection":return new $t(jt.fromLiteral(e.data));case"BigCollection":return new Bt(jt.fromLiteral(e.data));case"Relation":return new Ut(e.data.map(e=>jt.fromLiteral(e)));case"Interface":return new Ht(Se.fromLiteral(e.data));case"Slot":return new zt(qe.fromLiteral(e.data));case"Reference":return new qt(jt.fromLiteral(e.data));case"Arc":return new Wt;case"Handle":return new Vt;default:throw new Error(`fromLiteral: unknown type ${e}`)}}static unwrapPair(e,t){if(e.tag===t.tag){const n=e.getContainedType();if(null!==n)return jt.unwrapPair(n,t.getContainedType())}return[e,t]}static canMergeConstraints(e,t){return jt._canMergeCanReadSubset(e,t)&&jt._canMergeCanWriteSuperset(e,t)}static _canMergeCanReadSubset(e,t){if(e.canReadSubset&&t.canReadSubset){if(e.canReadSubset.tag!==t.canReadSubset.tag)return!1;if(e.canReadSubset instanceof Ft&&t.canReadSubset instanceof Ft)return null!==ze.intersect(e.canReadSubset.entitySchema,t.canReadSubset.entitySchema);throw new Error(`_canMergeCanReadSubset not implemented for types tagged with ${e.canReadSubset.tag}`)}return!0}static _canMergeCanWriteSuperset(e,t){if(e.canWriteSuperset&&t.canWriteSuperset){if(e.canWriteSuperset.tag!==t.canWriteSuperset.tag)return!1;if(e.canWriteSuperset instanceof Ft&&t.canWriteSuperset instanceof Ft)return null!==ze.union(e.canWriteSuperset.entitySchema,t.canWriteSuperset.entitySchema)}return!0}isSlot(){return this instanceof zt}slandleType(){return this.isSlot()?this:this.isCollectionType()&&this.collectionType.isSlot()?this.collectionType:void 0}isCollectionType(){return this instanceof $t}isBigCollectionType(){return this instanceof Bt}isResolved(){return!this.hasUnresolvedVariable}mergeTypeVariablesByName(e){return this}_applyExistenceTypeTest(e){return e(this)}get hasVariable(){return this._applyExistenceTypeTest(e=>e instanceof Lt)}get hasUnresolvedVariable(){return this._applyExistenceTypeTest(e=>e instanceof Lt&&!e.variable.isResolved())}getContainedType(){return null}isTypeContainer(){return!1}get isReference(){return!1}collectionOf(){return new $t(this)}bigCollectionOf(){return new Bt(this)}resolvedType(){return this}canEnsureResolved(){return this.isResolved()||this._canEnsureResolved()}_canEnsureResolved(){return!0}maybeEnsureResolved(){return!0}get canWriteSuperset(){throw new Error(`canWriteSuperset not implemented for ${this}`)}get canReadSubset(){throw new Error(`canReadSubset not implemented for ${this}`)}isMoreSpecificThan(e){return this.tag===e.tag&&this._isMoreSpecificThan(e)}_isMoreSpecificThan(e){throw new Error(`isMoreSpecificThan not implemented for ${this}`)}clone(e){return this.resolvedType()._clone(e)}_clone(e){return jt.fromLiteral(this.toLiteral())}_cloneWithResolutions(e){return jt.fromLiteral(this.toLiteral())}hasProperty(e){return e(this)||this._hasProperty(e)}_hasProperty(e){return!1}toString(e){return this.tag}getEntitySchema(){return null}toPrettyString(){return null}crdtInstanceConstructor(){return null}handleConstructor(){return null}}class Ft extends jt{constructor(e){super("Entity"),this.entitySchema=e}static make(e,t,n){return new Ft(new ze(e,t,n))}get isEntity(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return this.entitySchema.isMoreSpecificThan(e.entitySchema)}toLiteral(){return{tag:this.tag,data:this.entitySchema.toLiteral()}}toString(e){return this.entitySchema.toInlineSchemaString(e)}getEntitySchema(){return this.entitySchema}_cloneWithResolutions(e){if(e.has(this.entitySchema))return e.get(this.entitySchema);const t=new Ft(this.entitySchema);return e.set(this.entitySchema,t),t}toPrettyString(){return this.entitySchema.description.pattern?this.entitySchema.description.pattern:this.entitySchema.name?this.entitySchema.name.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim():JSON.stringify(this.entitySchema.toLiteral())}crdtInstanceConstructor(){return this.entitySchema.crdtConstructor()}handleConstructor(){return Mt}}class Lt extends jt{constructor(e){super("TypeVariable"),this.variable=e}static make(e,t,n){return new Lt(new Ke(e,t,n))}get isVariable(){return!0}mergeTypeVariablesByName(e){const t=this.variable.name;let n=e.get(t);if(n){if(n instanceof Lt&&(n.variable.hasConstraint||this.variable.hasConstraint)){if(!n.variable.maybeMergeConstraints(this.variable))throw new Error("could not merge type variables")}}else n=this,e.set(t,this);return n}resolvedType(){return this.variable.resolution||this}_canEnsureResolved(){return this.variable.canEnsureResolved()}maybeEnsureResolved(){return this.variable.maybeEnsureResolved()}get canWriteSuperset(){return this.variable.canWriteSuperset}get canReadSubset(){return this.variable.canReadSubset}_clone(e){const t=this.variable.name;if(e.has(t))return new Lt(e.get(t));{const n=Ke.fromLiteral(this.variable.toLiteral());return e.set(t,n),new Lt(n)}}_cloneWithResolutions(e){if(e.has(this.variable))return new Lt(e.get(this.variable));{const t=Ke.fromLiteral(this.variable.toLiteralIgnoringResolutions());return this.variable.resolution&&(t._resolution=this.variable._resolution._cloneWithResolutions(e)),this.variable._canReadSubset&&(t.canReadSubset=this.variable.canReadSubset._cloneWithResolutions(e)),this.variable._canWriteSuperset&&(t.canWriteSuperset=this.variable.canWriteSuperset._cloneWithResolutions(e)),e.set(this.variable,t),new Lt(t)}}toLiteral(){return this.variable.resolution?this.variable.resolution.toLiteral():{tag:this.tag,data:this.variable.toLiteral()}}toString(e){return`~${this.variable.name}`}getEntitySchema(){return this.variable.isResolved()?this.resolvedType().getEntitySchema():null}toPrettyString(){return this.variable.isResolved()?this.resolvedType().toPrettyString():`[~${this.variable.name}]`}}class $t extends jt{constructor(e){super("Collection"),this.collectionType=e}get isCollection(){return!0}mergeTypeVariablesByName(e){const t=this.collectionType,n=t.mergeTypeVariablesByName(e);return n===t?this:n.collectionOf()}_applyExistenceTypeTest(e){return this.collectionType._applyExistenceTypeTest(e)}getContainedType(){return this.collectionType}isTypeContainer(){return!0}resolvedType(){const e=this.collectionType,t=e.resolvedType();return e!==t?t.collectionOf():this}_canEnsureResolved(){return this.collectionType.canEnsureResolved()}maybeEnsureResolved(){return this.collectionType.maybeEnsureResolved()}get canWriteSuperset(){return Ht.make(this.tag,[],[])}get canReadSubset(){return Ht.make(this.tag,[],[])}_clone(e){const t=this.collectionType.clone(e).toLiteral();return jt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new $t(this.collectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.collectionType.toLiteral()}}_hasProperty(e){return this.collectionType.hasProperty(e)}toString(e){return`[${this.collectionType.toString(e)}]`}getEntitySchema(){return this.collectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`${this.collectionType.toPrettyString()} List`}crdtInstanceConstructor(){return Fe}handleConstructor(){return Dt}}class Bt extends jt{constructor(e){super("BigCollection"),this.bigCollectionType=e}get isBigCollection(){return!0}mergeTypeVariablesByName(e){const t=this.bigCollectionType,n=t.mergeTypeVariablesByName(e);return n===t?this:n.bigCollectionOf()}_applyExistenceTypeTest(e){return this.bigCollectionType._applyExistenceTypeTest(e)}getContainedType(){return this.bigCollectionType}isTypeContainer(){return!0}resolvedType(){const e=this.bigCollectionType,t=e.resolvedType();return e!==t?t.bigCollectionOf():this}_canEnsureResolved(){return this.bigCollectionType.canEnsureResolved()}maybeEnsureResolved(){return this.bigCollectionType.maybeEnsureResolved()}get canWriteSuperset(){return Ht.make(this.tag,[],[])}get canReadSubset(){return Ht.make(this.tag,[],[])}_clone(e){const t=this.bigCollectionType.clone(e).toLiteral();return jt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new Bt(this.bigCollectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.bigCollectionType.toLiteral()}}_hasProperty(e){return this.bigCollectionType.hasProperty(e)}toString(e){return`BigCollection<${this.bigCollectionType.toString(e)}>`}getEntitySchema(){return this.bigCollectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`Collection of ${this.bigCollectionType.toPrettyString()}`}}class Ut extends jt{constructor(e){super("Relation"),this.relationEntities=e}get isRelation(){return!0}toLiteral(){return{tag:this.tag,data:this.relationEntities.map(e=>e.toLiteral())}}toPrettyString(){return JSON.stringify(this.relationEntities)}}class Ht extends jt{constructor(e){super("Interface"),this.interfaceInfo=e}static make(e,t,n){return new Ht(new Se(e,t,n))}get isInterface(){return!0}mergeTypeVariablesByName(e){const t=this.interfaceInfo.clone(new Map);return t.mergeTypeVariablesByName(e),new Ht(t)}_applyExistenceTypeTest(e){return this.interfaceInfo._applyExistenceTypeTest(e)}resolvedType(){return new Ht(this.interfaceInfo.resolvedType())}_canEnsureResolved(){return this.interfaceInfo.canEnsureResolved()}maybeEnsureResolved(){return this.interfaceInfo.maybeEnsureResolved()}get canWriteSuperset(){return new Ht(this.interfaceInfo.canWriteSuperset)}get canReadSubset(){return new Ht(this.interfaceInfo.canReadSubset)}_isMoreSpecificThan(e){return this.interfaceInfo.isMoreSpecificThan(e.interfaceInfo)}_clone(e){const t=this.interfaceInfo.clone(e).toLiteral();return jt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new Ht(this.interfaceInfo._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.interfaceInfo.toLiteral()}}toString(e){return this.interfaceInfo.name}toPrettyString(){return this.interfaceInfo.toPrettyString()}}class zt extends jt{constructor(e){super("Slot"),this.slot=e}static make(e,t){return new zt(new qe(e,t))}getSlot(){return this.slot}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return!0}toLiteral(){return{tag:this.tag,data:this.slot.toLiteral()}}toString(e){const t=[];for(const e of Object.keys(this.slot))void 0!==this.slot[e]&&t.push(`${e}:${this.slot[e]}`);let n="";return 0!==t.length&&(n=` {${t.join(", ")}}`),`Slot${n}`}toPrettyString(){const e=[];for(const t of Object.keys(this.slot))void 0!==this.slot[t]&&e.push(`${t}:${this.slot[t]}`);let t="";return 0!==e.length&&(t=` {${e.join(", ")}}`),`Slot${t}`}}class qt extends jt{constructor(e){super("Reference"),this.referredType=e}get isReference(){return!0}getContainedType(){return this.referredType}isTypeContainer(){return!0}resolvedType(){const e=this.referredType,t=e.resolvedType();return e!==t?new qt(t):this}_canEnsureResolved(){return this.referredType.canEnsureResolved()}maybeEnsureResolved(){return this.referredType.maybeEnsureResolved()}get canWriteSuperset(){return this.referredType.canWriteSuperset}get canReadSubset(){return this.referredType.canReadSubset}_clone(e){const t=this.referredType.clone(e).toLiteral();return jt.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new qt(this.referredType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.referredType.toLiteral()}}toString(e){return"Reference<"+this.referredType.toString()+">"}getEntitySchema(){return this.referredType.getEntitySchema()}}class Wt extends jt{constructor(){super("Arc")}get isArc(){return!0}newInstance(e,t){return new We(e,t)}toLiteral(){return{tag:this.tag}}}class Vt extends jt{constructor(){super("Handle")}get isHandle(){return!0}toLiteral(){return{tag:this.tag}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Kt{static processTypeList(e,t){const n=Lt.make("",null,null);e&&(n.variable.resolution=e),e=n;const r=[];for(const n of t)if(n.type.resolvedType().hasVariable){if(null==(e=Kt._tryMergeTypeVariable(e,n.type)))return null}else r.push(n);for(const t of r)if(!Kt._tryMergeConstraints(e,t))return null;const i=e=>e instanceof Lt?null==e.canReadSubset||null==e.canWriteSuperset?e:e.canReadSubset.isMoreSpecificThan(e.canWriteSuperset)?(e.canWriteSuperset.isMoreSpecificThan(e.canReadSubset)&&(e.variable.resolution=e.canReadSubset),e):null:e,s=e.resolvedType();if(s.isCollectionType()){const e=i(s.collectionType);return null!==e?e.collectionOf():null}if(s.isBigCollectionType()){const e=i(s.bigCollectionType);return null!==e?e.bigCollectionOf():null}return i(s)}static _tryMergeTypeVariable(e,t){const[n,r]=jt.unwrapPair(e.resolvedType(),t.resolvedType());if(n instanceof Lt){if(r instanceof Lt){if(!1===n.variable.maybeMergeConstraints(r.variable))return null;r.variable.resolution=n}else{if(!n.variable.isValidResolutionCandidate(r).result)return null;n.variable.resolution=r}return e}if(r instanceof Lt)return r.variable.isValidResolutionCandidate(n).result?(r.variable.resolution=n,t):null;if(n instanceof Ht&&r instanceof Ht){const e=n.interfaceInfo.tryMergeTypeVariablesWith(r.interfaceInfo);return null==e?null:new Ht(e)}if(n.isTypeContainer()&&n.hasVariable||r.isTypeContainer()&&r.hasVariable)return null;throw new Error("tryMergeTypeVariable shouldn't be called on two types without any type variables")}static _tryMergeConstraints(e,{type:t,direction:n}){let[r,i]=jt.unwrapPair(e.resolvedType(),t.resolvedType());if(r instanceof Lt){for(;i.isTypeContainer();){if(null!=r.variable.resolution||null!=r.variable.canReadSubset||null!=r.variable.canWriteSuperset)return!1;const e=Lt.make("a",null,null);r.variable.resolution=i instanceof $t?new $t(e):i instanceof Bt?new Bt(e):new qt(e);const t=jt.unwrapPair(r.resolvedType(),i);if([r,i]=t,!(r instanceof Lt))throw new TypeError("unwrapping a wrapped TypeVariable somehow didn't become a TypeVariable")}if(("out"===n||"inout"===n||"`provide"===n)&&!r.variable.maybeMergeCanReadSubset(i.canWriteSuperset))return!1;if(("in"===n||"inout"===n||"`consume"===n)&&!r.variable.maybeMergeCanWriteSuperset(i.canReadSubset))return!1}else{if(i.tag!==r.tag)return!1;if(("out"===n||"inout"===n)&&!Kt._writeConstraintsApply(r,i))return!1;if(("in"===n||"inout"===n)&&!Kt._readConstraintsApply(r,i))return!1}return!0}static _writeConstraintsApply(e,t){const n=t.canWriteSuperset;return null==n||null==e.canReadSubset||!!n.isMoreSpecificThan(e.canReadSubset)}static _readConstraintsApply(e,t){const n=t.canReadSubset;return null==n||null==e.canWriteSuperset||!!e.canWriteSuperset.isMoreSpecificThan(n)}static compareTypes(e,t){const n=e.type.resolvedType(),r=t.type.resolvedType(),[i,s]=jt.unwrapPair(n,r);if(i instanceof Lt&&s.isTypeContainer())return!(i.variable.canReadSubset||i.variable.canWriteSuperset);if(s instanceof Lt&&i.isTypeContainer())return!(s.variable.canReadSubset||s.variable.canWriteSuperset);if(i instanceof Lt||s instanceof Lt)return jt.canMergeConstraints(i,s);if(void 0===i!=(void 0===s))return!1;if(i===s)return!0;if(i.tag!==s.tag)return!1;if(i instanceof zt)return!0;if(i instanceof Ht&&s instanceof Ht&&i.interfaceInfo.equals(s.interfaceInfo))return!0;if(!(i instanceof Ft&&s instanceof Ft))return!1;const o=i.entitySchema.isMoreSpecificThan(s.entitySchema),a=s.entitySchema.isMoreSpecificThan(i.entitySchema);if(a&&o)return!0;if(!a&&!o)return!1;const[c,l]=a?[e,t]:[t,e],h=c.direction||(c.connection?c.connection.direction:"inout"),u=l.direction||(l.connection?l.connection.direction:"inout");return"in"===h||"out"===u}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.HasTag="has-tag",e.IsFromHandle="is-from-handle",e.IsFromOutput="is-from-output",e.IsFromStore="is-from-store"}(at||(at={}));class Qt{constructor(e,t){this.target=e,this.expression=t}toManifestString(){let e;return`check ${e=this.target instanceof un?this.target.name:`${this.target.name} data`} ${this.expression.toManifestString()}`}}class Gt{constructor(e,t){this.type=e,this.children=t}toManifestString(e=!1){const t=this.children.map(e=>e.toManifestString(!0)).join(` ${this.type} `);return e?`(${t})`:t}}class Zt{constructor(e,t){this.tag=e,this.isNot=t,this.type=at.HasTag}static fromASTNode(e){return new Zt(e.tag,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}${this.tag}`}}class Yt{constructor(e,t){this.parentHandle=e,this.isNot=t,this.type=at.IsFromHandle}static fromASTNode(e,t){const n=t.get(e.parentHandle);if(!n)throw new Error(`Unknown "check is from handle" handle name: ${e.parentHandle}.`);return new Yt(n,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}from handle ${this.parentHandle.name}`}}class Xt{constructor(e,t){this.output=e,this.isNot=t,this.type=at.IsFromOutput}static fromASTNode(e,t){const n=t.get(e.output);if(!n)throw new Error(`Unknown "check is from output" output name: ${e.output}.`);return new Xt(n,e.isNot)}toManifestString(){return`is ${this.isNot?"not ":""}from output ${this.output.name}`}}class Jt{constructor(e,t){this.storeRef=e,this.isNot=t,this.type=at.IsFromStore}static fromASTNode(e){return new Jt({type:e.storeRef.type,store:e.storeRef.store},e.isNot)}toManifestString(){let e=this.storeRef.store;return"id"===this.storeRef.type&&(e=`'${e}'`),`is ${this.isNot?"not ":""}from store ${e}`}}function en(e,t){return"particle-trust-check-boolean-expression"===e.kind?(d()(e.children.length>=2,"Boolean check expressions must have at least two children."),new Gt(e.operator,e.children.map(e=>en(e,t)))):function(e,t){switch(e.checkType){case at.HasTag:return Zt.fromASTNode(e);case at.IsFromHandle:return Yt.fromASTNode(e,t);case at.IsFromStore:return Jt.fromASTNode(e);case at.IsFromOutput:return Xt.fromASTNode(e,t);default:throw new Error("Unknown check type.")}}(e,t)}function tn(e,t,n){const r=en(t.expression,n);return new Qt(e,r)}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.IsTag="is-tag",e.DerivesFrom="derives-from"}(ct||(ct={}));class nn{constructor(e,t){this.handle=e,this.claims=t}toManifestString(){const e=this.claims.map(e=>e.toManifestString());return`claim ${this.handle.name} ${e.join(" and ")}`}}class rn{constructor(e,t){this.isNot=e,this.tag=t,this.type=ct.IsTag}static fromASTNode(e){return new rn(e.isNot,e.tag)}toManifestString(){return`is ${this.isNot?"not ":""}${this.tag}`}}class sn{constructor(e){this.parentHandle=e,this.type=ct.DerivesFrom}static fromASTNode(e,t){const n=t.get(e.parentHandle);if(!n)throw new Error(`Unknown "derives from" handle name: ${n}.`);return new sn(n)}toManifestString(){return`derives from ${this.parentHandle.name}`}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class on{}on.useNewStorageStack=!1,on.usePreSlandlesSyntax=!0;class an extends on{static reset(){Object.assign(an,on)}static withPreSlandlesSyntax(e){return an.withFlags({usePreSlandlesSyntax:!0},e)}static withPostSlandlesSyntax(e){return an.withFlags({usePreSlandlesSyntax:!1},e)}static withFlags(e,t){return async()=>{let n;Object.assign(an,e);try{n=await t()}finally{an.reset()}return n}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function cn(e){return e instanceof jt?e:jt.fromLiteral(e)}function ln(e){return e instanceof jt?e.toLiteral():e}function hn({name:e,tags:t,id:n,type:r,fate:i}){const s=["root","toproot","modal"];if(i&&"`slot"!==i||r&&!r.slandleType())return!1;if(n&&0===n.lastIndexOf("rootslotid-",0)){const e=n.substr("rootslotid-".length);if(s.includes(e))return!0}return s.includes(e)||t.some(e=>s.includes(e))}an.reset();class un{constructor(e,t){this.parentConnection=null,this.rawData=e,this.direction=e.direction,this.name=e.name,this.type=cn(e.type).mergeTypeVariablesByName(t),this.isOptional=e.isOptional,this.tags=e.tags||[],this.dependentConnections=[]}instantiateDependentConnections(e,t){for(const n of this.rawData.dependentConnections){const r=e.createConnection(n,t);r.parentConnection=this,this.dependentConnections.push(r)}}toSlotConnectionSpec(){const e=this.type.slandleType();if(!e)return;const t=this.type.isCollectionType(),n=e.getSlot();return{name:this.name,isOptional:this.isOptional,direction:this.direction,tags:this.tags,dependentConnections:this.dependentConnections.map(e=>e.toSlotConnectionSpec()),isRequired:!this.isOptional,isSet:t,type:e,handles:n.handle?[n.handle]:[],formFactor:n.formFactor,provideSlotConnections:this.dependentConnections.map(e=>e.toSlotConnectionSpec())}}get isInput(){return"in"===this.direction||"inout"===this.direction||"host"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}isCompatibleType(e){return Kt.compareTypes({type:e},{type:this.type,direction:this.direction})}}class dn{constructor(e){this.name=e.name,this.isRequired=e.isRequired||!1,this.isSet=e.isSet||!1,this.tags=e.tags||[],this.formFactor=e.formFactor,this.handles=e.handles||[],this.provideSlotConnections=[],e.provideSlotConnections&&e.provideSlotConnections.forEach(e=>{this.provideSlotConnections.push(new pn(e))})}get isOptional(){return!this.isRequired}get direction(){return"`consume"}get type(){const e=zt.make(this.formFactor,null);return this.isSet?e.collectionOf():e}get dependentConnections(){return this.provideSlotConnections}}class pn extends dn{constructor(e){super(e),this.check=e.check}}class fn{constructor(e){this.model=e,this.name=e.name,this.verbs=e.verbs;const t=new Map;this.handleConnectionMap=new Map,e.args.forEach(e=>this.createConnection(e,t)),e.description=e.description||{},this.validateDescription(e.description),this.pattern=e.description.pattern,this.handleConnectionMap.forEach((t,n)=>{t.pattern=e.description[n]}),this.implFile=e.implFile,this.implBlobUrl=e.implBlobUrl,this.modality=e.modality?de.create(e.modality):de.all,this.slotConnections=new Map,e.slotConnections&&e.slotConnections.forEach(e=>this.slotConnections.set(e.name,new dn(e))),this.slotConnections.forEach(e=>{e.provideSlotConnections.forEach(e=>{e.handles.forEach(e=>d()(this.handleConnectionMap.has(e),"Cannot provide slot for nonexistent handle constraint "+e))})}),this.trustClaims=this.validateTrustClaims(e.trustClaims),this.trustChecks=this.validateTrustChecks(e.trustChecks)}createConnection(e,t){const n=new un(e,t);if(this.handleConnectionMap.get(n.name))throw new Error(`Particle Spec ${this.name} already has a handle connection named "${n.name}".`);return this.handleConnectionMap.set(n.name,n),n.instantiateDependentConnections(this,t),n}get handleConnections(){return this.connections}get connections(){return[...this.handleConnectionMap.values()]}get inputs(){return this.connections.filter(e=>e.isInput)}get outputs(){return this.connections.filter(e=>e.isOutput)}isInput(e){const t=this.handleConnectionMap.get(e);return t&&t.isInput}isOutput(e){const t=this.handleConnectionMap.get(e);return t&&t.isOutput}getConnectionByName(e){return this.handleConnectionMap.get(e)}getSlotSpec(e){return this.slotConnections.get(e)}getSlandleSpec(e){const t=this.slotConnections.get(e);return t||this.handleConnectionMap.get(e).toSlotConnectionSpec()}slandleConnectionNames(){const e=this.handleConnections.filter(e=>e.toSlotConnectionSpec()).map(e=>e.name);return[...this.slotConnections.keys(),...e]}slotConnectionNames(){return[...this.slotConnections.keys()]}get primaryVerb(){return this.verbs.length>0?this.verbs[0]:void 0}isCompatible(e){return 0===this.slandleConnectionNames().length||this.modality.intersection(e).isResolved()}setImplBlobUrl(e){this.model.implBlobUrl=this.implBlobUrl=e}toLiteral(){const{args:e,name:t,verbs:n,description:r,implFile:i,implBlobUrl:s,modality:o,slotConnections:a,trustClaims:c,trustChecks:l}=this.model,h=({type:e,direction:t,name:n,isOptional:r,dependentConnections:i})=>({type:ln(e),direction:t,name:n,isOptional:r,dependentConnections:i.map(h)});return{args:e.map(e=>h(e)),name:t,verbs:n,description:r,implFile:i,implBlobUrl:s,modality:o,slotConnections:a,trustClaims:c,trustChecks:l}}static fromLiteral(e){let{args:t,name:n,verbs:r,description:i,implFile:s,implBlobUrl:o,modality:a,slotConnections:c,trustClaims:l,trustChecks:h}=e;const u=({type:e,direction:t,name:n,isOptional:r,dependentConnections:i})=>({type:cn(e),direction:t,name:n,isOptional:r,dependentConnections:i?i.map(u):[]});return t=t.map(u),new fn({args:t,name:n,verbs:r||[],description:i,implFile:s,implBlobUrl:o,modality:a,slotConnections:c,trustClaims:l,trustChecks:h})}clone(){return fn.fromLiteral(this.toLiteral())}cloneWithResolutions(e){const t=this.clone();return this.handleConnectionMap.forEach((n,r)=>{t.handleConnectionMap.get(r).type=n.type._cloneWithResolutions(e)}),t}equals(e){return JSON.stringify(this.toLiteral())===JSON.stringify(e.toLiteral())}validateDescription(e){Object.keys(e||[]).forEach(e=>{d()(["kind","location","pattern"].includes(e)||this.handleConnectionMap.has(e),`Unexpected description for ${e}`)})}toInterface(){d()(!this.slotConnections.size,"please implement slots toInterface");const e=this.model.args.map(({type:e,name:t,direction:n})=>({type:cn(e),name:t,direction:n}));return Ht.make(this.name,e,[])}toString(){const e=[];let t="";this.verbs.length>0&&(t=" "+this.verbs.map(e=>`&${e}`).join(" ")),e.push(`particle ${this.name}${t} in '${this.implFile}'`.trim());const n=(t,r)=>{const i=t.tags.map(e=>` #${e}`).join("");an.usePreSlandlesSyntax?e.push(`${r}${t.direction}${t.isOptional?"?":""} ${t.type.toString()} ${t.name}${i}`):e.push(`${r}${t.name}: ${t.direction}${t.isOptional?"?":""} ${t.type.toString()}${i}`);for(const e of t.dependentConnections)n(e,r+"  ")};for(const e of this.handleConnections)e.parentConnection||n(e,"  ");this.trustClaims.forEach(t=>e.push(`  ${t.toManifestString()}`)),this.trustChecks.forEach(t=>e.push(`  ${t.toManifestString()}`)),this.modality.names.forEach(t=>e.push(`  modality ${t}`));const r=(t,n,i)=>{const s=[];t.isRequired&&s.push("must"),s.push(n),t.isSet&&s.push("set of"),s.push(t.name),t.tags.length>0&&s.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`${i}${s.join(" ")}`),t.formFactor&&e.push(`${i}  formFactor ${t.formFactor}`);for(const n of t.handles)e.push(`${i}  handle ${n}`);t.provideSlotConnections&&t.provideSlotConnections.forEach(e=>r(e,"provide",i+"  "))};return this.slotConnections.forEach(e=>r(e,"consume","  ")),this.pattern&&(e.push(`  description \`${this.pattern}\``),this.handleConnectionMap.forEach(t=>{t.pattern&&e.push(`    ${t.name} \`${t.pattern}\``)})),e.join("\n")}toManifestString(){return this.toString()}validateTrustClaims(e){const t=[];return e&&e.forEach(e=>{const n=this.handleConnectionMap.get(e.handle);if(!n)throw new Error(`Can't make a claim on unknown handle ${e.handle}.`);if(!n.isOutput)throw new Error(`Can't make a claim on handle ${e.handle} (not an output handle).`);if(n.claims)throw new Error(`Can't make multiple claims on the same output (${e.handle}).`);const r=function(e,t,n){const r=t.expression.map(e=>{switch(e.claimType){case ct.IsTag:return rn.fromASTNode(e);case ct.DerivesFrom:return sn.fromASTNode(e,n);default:throw new Error("Unknown claim type.")}});return new nn(e,r)}(n,e,this.handleConnectionMap);n.claims=r.claims,t.push(r)}),t}validateTrustChecks(e){const t=[];if(e){const n=this.getProvidedSlotsByName();e.forEach(e=>{switch(e.target.targetType){case"handle":{const n=e.target.name,r=this.handleConnectionMap.get(n);if(!r)throw new Error(`Can't make a check on unknown handle ${n}.`);if("`consume"===r.direction||"`provide"===r.direction){if("`consume"===r.direction)throw new Error(`Can't make a check on handle ${n}. Can only make checks on input and provided handles.`)}else if(!r.isInput)throw new Error(`Can't make a check on handle ${n} (not an input handle).`);if(r.check)throw new Error(`Can't make multiple checks on the same input (${n}).`);r.check=tn(r,e,this.handleConnectionMap),t.push(r.check);break}case"slot":{const r=e.target.name,i=n.get(r);if(!i)throw this.slotConnectionNames().includes(r)?new Error(`Slot ${r} is a consumed slot. Can only make checks on provided slots.`):new Error(`Can't make a check on unknown slot ${r}.`);i.check=tn(i,e,this.handleConnectionMap),t.push(i.check);break}default:throw new Error("Unknown check target type.")}})}return t}getProvidedSlotsByName(){const e=new Map;for(const t of this.slotConnections.values())for(const n of t.provideSlotConnections){const t=n.name;if(e.has(t))throw new Error(`Another slot with name '${t}' has already been provided by this particle.`);e.set(t,n)}return e}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class mn{constructor(e){if(this.items=new Map,e)for(let{id:t,value:n,keys:r}of e)r||(r=[]),this.items.set(t,{value:n,keys:new Set(r)})}add(e,t,n){d()(n.length>0&&"object"==typeof n,"add requires a list of keys");let r=this.items.get(e),i=!1;if(r){let e=!1;for(const t of n)r.keys.has(t)||(e=!0),r.keys.add(t);this._equals(r.value,t)||(d()(e,"cannot add without new keys. incoming="+n.join(",")+" existing="+[...r.keys].join(",")),r.value=t,i=!0)}else r={value:t,keys:new Set(n)},this.items.set(e,r),i=!0;return i}_equals(e,t){if(Boolean(e)!==Boolean(t))return!1;if(!e)return!0;const n=typeof e;if(n!==typeof t)return!1;if("object"===n){const n=Object.keys(e);return n.length===Object.keys(t).length&&n.every(n=>this._equals(e[n],t[n]))}return JSON.stringify(e)===JSON.stringify(t)}remove(e,t){const n=this.items.get(e);if(!n)return!1;for(const e of t)n.keys.delete(e);const r=0===n.keys.size;return r&&this.items.delete(e),r}toLiteral(){const e=[];for(const[t,{value:n,keys:r}]of this.items.entries())e.push({id:t,value:n,keys:[...r]});return e}toList(){return[...this.items.values()].map(e=>e.value)}has(e){return this.items.has(e)}getKeys(e){const t=this.items.get(e);return t?[...t.keys]:[]}getValue(e){const t=this.items.get(e);return t?t.value:null}get size(){return this.items.size}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.none=0]="none",e[e.pending=1]="pending",e[e.full=2]="full"}(lt||(lt={}));class yn{constructor(e,t,n,r,i,s){this.version=void 0,this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=lt.none,this.observers=[],this.updates=[],this.barrier=null,this.id=e,this.type=t,this.port=n,this.scheduler=i,this.name=s,this.updates=[],this.pec=r}static newProxy(e,t,n,r,i,s){return t instanceof $t?new gn(e,t,n,r,i,s):t instanceof Bt?new vn(e,t,n,r,i,s):new _n(e,t,n,r,i,s)}static newNoOpProxy(e,t){return new bn(e,t,null,null,null,"NoOpStorage")}reportExceptionInHost(e){et?et(e.cause.stack,t=>{e.cause.stack=t,this.port.ReportExceptionInHost(e)}):this.port.ReportExceptionInHost(e)}register(e,t){if(t.canRead&&(d()(t instanceof Cn),this.observers.push({particle:e,handle:t}),this.listenerAttached||(this.port.InitializeProxy(this,e=>this._onUpdate(e)),this.listenerAttached=!0),t.options.keepSynced&&(this.keepSynced||(this.port.SynchronizeProxy(this,e=>this._onSynchronize(e)),this.keepSynced=!0),t.options.notifySync&&this.synchronized===lt.full))){const n=this._getModelForSync();this.scheduler.enqueue(e,t,["sync",e,n])}}deregister(e,t){this.observers=this.observers.filter(({particle:n,handle:r})=>n!==e||r!==t)}_onSynchronize({version:e,model:t}){if(void 0!==this.version&&e<=this.version)return void console.warn(`StorageProxy '${this.id}' received stale model version ${e}; `+`current is ${this.version}`);if(!this._synchronizeModel(e,t))return;for(this.synchronized=lt.full;this.updates.length>0&&this.updates[0].version<=e;)this.updates.shift();const n=this._getModelForSync();this._notify("sync",n,e=>e.keepSynced&&e.notifySync),this._processUpdates()}_onUpdate(e){if(this.observers.find(({handle:e})=>!e.options.keepSynced&&e.options.notifyUpdate)){const t=this._processUpdate(e,!1);this._notify("update",t,e=>!e.keepSynced&&e.notifyUpdate)}this.keepSynced&&(e.version<=this.version?console.warn(`StorageProxy '${this.id}' received stale update version ${e.version}; `+`current is ${this.version}`):(this.updates.push(e),this.updates.sort((e,t)=>e.version-t.version),this._processUpdates()))}_notify(e,t,n=(e=>!0)){for(const{handle:r,particle:i}of this.observers)n(r.options)&&this.scheduler.enqueue(i,r,[e,i,t])}_processUpdates(){const e=e=>e.version===this.version+1||!(!this.barrier||e.barrier!==this.barrier);for(;this.updates.length>0&&e(this.updates[0]);){const e=this.updates.shift(),t=this._processUpdate(e);this.version=e.version,t&&this._notify("update",t,e=>e.keepSynced&&e.notifyUpdate)}if(this.updates.length>0){if(this.synchronized!==lt.none){this.synchronized=lt.none,this.port.SynchronizeProxy(this,e=>this._onSynchronize(e));for(const{handle:e,particle:t}of this.observers)e.options.notifyDesync&&this.scheduler.enqueue(t,e,["desync",t,{}])}}else this.synchronized!==lt.full&&(this.synchronized=lt.full)}generateBarrier(){return this.pec.idGenerator.newChildId(Xe.fromString(this.id),"barrier").toString()}}class gn extends yn{constructor(){super(...arguments),this.model=new mn}_getModelForSync(){return this.model.toList()}_synchronizeModel(e,t){return this.version=e,this.model=new mn(t),!0}_processUpdate(e,t=!0){if(this.synchronized===lt.full)for(const{handle:t}of this.observers)if(e.originatorId===t._particleId)return null;const n=[],r=[];if("add"in e)for(const{value:r,keys:i,effective:s}of e.add)(t&&this.model.add(r.id,r,i)||!t&&s)&&n.push(r);else{if(!("remove"in e))throw new Error(`StorageProxy received invalid update event: ${JSON.stringify(e)}`);for(const{value:n,keys:i,effective:s}of e.remove){const e=this.model.getValue(n.id);(t&&this.model.remove(n.id,i)||!t&&s)&&r.push(e)}}if(n.length||r.length){const t={originatorId:e.originatorId};return n.length&&(t.add=n),r.length&&(t.remove=r),t}return null}async toList(){return this.synchronized===lt.full?Promise.resolve(this.model.toList()):new Promise(e=>this.port.HandleToList(this,e))}async get(e){return this.synchronized===lt.full?Promise.resolve(this.model.getValue(e)):new Promise((t,n)=>this.port.HandleToList(this,n=>t(n.find(t=>t.id===e))))}async store(e,t,n){const r=e.id,i={value:e,keys:t};if(this.port.HandleStore(this,()=>{},i,n),this.synchronized!==lt.full)return Promise.resolve();if(!this.model.add(r,e,t))return Promise.resolve();const s={originatorId:n,add:[e]};return this._notify("update",s,e=>e.notifyUpdate),Promise.resolve()}async clear(e){this.synchronized!==lt.full&&this.port.HandleRemoveMultiple(this,()=>{},[],e);let t=this.model.toList().map(e=>({id:e.id,keys:this.model.getKeys(e.id)}));return this.port.HandleRemoveMultiple(this,()=>{},t,e),(t=(t=t.map(({id:e,keys:t})=>({rawData:this.model.getValue(e).rawData,id:e,keys:t}))).filter(e=>this.model.remove(e.id,e.keys))).length>0&&this._notify("update",{originatorId:e,remove:t},e=>e.notifyUpdate),Promise.resolve()}async remove(e,t,n){if(this.synchronized!==lt.full){const t={id:e,keys:[]};return this.port.HandleRemove(this,()=>{},t,n),Promise.resolve()}const r=this.model.getValue(e);if(!r)return Promise.resolve();0===t.length&&(t=this.model.getKeys(e));const i={id:e,keys:t};if(this.port.HandleRemove(this,()=>{},i,n),!this.model.remove(e,t))return Promise.resolve();const s={originatorId:n,remove:[r]};return this._notify("update",s,e=>e.notifyUpdate),Promise.resolve()}}class _n extends yn{constructor(){super(...arguments),this.model=null}_getModelForSync(){return this.model}_synchronizeModel(e,t){return null==this.barrier&&(this.version=e,this.model=0===t.length?null:t[0].value,d()(void 0!==this.model),!0)}_processUpdate(e,t=!0){if(d()("data"in e),!t)return e;if(null!=this.barrier){if(e.barrier===this.barrier&&(this.barrier=null,this.synchronized!==lt.full)){this.synchronized=lt.full;const e=this._getModelForSync();this._notify("sync",e,e=>e.keepSynced&&e.notifySync)}return null}const n=this.model;return this.model=e.data,{...e,oldData:n}}async get(){return this.synchronized===lt.full?Promise.resolve(this.model):new Promise(e=>this.port.HandleGet(this,e))}async set(e,t){if(d()(void 0!==e),JSON.stringify(this.model)===JSON.stringify(e))return Promise.resolve();let n;n=this.listenerAttached?this.generateBarrier():null;const r=this.model;this.model=JSON.parse(JSON.stringify(e)),this.barrier=n,this.port.HandleSet(this,e,t,n);const i={originatorId:t,data:e,oldData:r};return this._notify("update",i,e=>e.notifyUpdate),Promise.resolve()}async clear(e){if(this.synchronized===lt.full&&null==this.model)return Promise.resolve();const t=this.generateBarrier(),n=this.model;this.model=null,this.barrier=t,this.port.HandleClear(this,e,t);const r={originatorId:e,data:null,oldData:n};return this._notify("update",r,e=>e.notifyUpdate),Promise.resolve()}}class vn extends yn{register(e,t){t.canRead&&this.scheduler.enqueue(e,t,["sync",e,{}])}_getModelForSync(){throw new Error("_getModelForSync not implemented for BigCollectionProxy")}_processUpdate(){throw new Error("_processUpdate not implemented for BigCollectionProxy")}_synchronizeModel(){throw new Error("_synchronizeModel not implemented for BigCollectionProxy")}async get(e){throw new Error("unimplemented")}async store(e,t,n){return new Promise(r=>this.port.HandleStore(this,r,{value:e,keys:t},n))}async remove(e,t,n){return new Promise(t=>this.port.HandleRemove(this,t,{id:e,keys:[]},n))}async stream(e,t){return new Promise(n=>this.port.HandleStream(this,n,e,t))}async cursorNext(e){return new Promise(t=>this.port.StreamCursorNext(this,t,e))}async cursorClose(e){return this.port.StreamCursorClose(this,e),Promise.resolve()}}class bn extends yn{_getModelForSync(){return null}_synchronizeModel(e,t){return!0}_processUpdate(e,t){return null}reportExceptionInHost(e){}deregister(){}register(){}_onSynchronize({version:e,model:t}){}_onUpdate(e){}_notify(e,t,n=(e=>!0)){}_processUpdates(){}generateBarrier(){return null}async get(e){return new Promise(e=>{})}async store(e,t,n){return new Promise(e=>{})}async clear(e){return new Promise(e=>{})}async remove(e,t,n){return new Promise(e=>{})}async toList(){return new Promise(e=>{})}async stream(e,t){return new Promise(e=>{})}async cursorNext(e){return new Promise(e=>{})}async cursorClose(e){return new Promise(e=>{})}async set(e,t){return new Promise(e=>{})}}class wn{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(e,t,n){this._queues.has(e)||this._queues.set(e,new Map);const r=this._queues.get(e);r.has(t)||r.set(t,[]),r.get(t).push(n),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(e=>this._idleResolver=e)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const e=[...this._queues.keys()][0],t=this._queues.get(e);this._queues.delete(e);for(const[e,n]of t.entries())for(const t of n)try{e._notify(...t)}catch(t){console.error("Error dispatching to particle",t),e.storage.reportExceptionInHost(new ae(t,e._particleId,"StorageProxyScheduler::_dispatch"))}}this._updateIdle()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Sn(e,t){d()(t,"Handles need entity classes for deserialization");const{id:n,rawData:r}=e,i=new t(r);return e.id&&ke.identify(i,e.id),i}class Cn{constructor(e,t,n,r,i,s){d()(!(e instanceof Cn)),this._storage=e,this.idGenerator=t,this.name=n||this.storage.name,this.canRead=i,this.canWrite=s,this._particleId=r,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1}}reportUserExceptionInHost(e,t,n){this.storage.reportExceptionInHost(new ce(e,n,this._particleId,t.spec.name))}reportSystemExceptionInHost(e,t){this.storage.reportExceptionInHost(new ae(e,t,this._particleId))}configure(e){d()(this.canRead,"configure can only be called on readable Handles");try{const t=Object.keys(this.options),n=Object.keys(e).filter(e=>!t.includes(e));if(n.length>0)throw new Error(`Invalid option in Handle.configure(): ${n}`);Object.assign(this.options,e)}catch(e){throw this.reportSystemExceptionInHost(e,"Handle::configure"),e}}_serialize(e){return d()(e,"can't serialize a null entity"),e instanceof ke&&(ke.isIdentified(e)||this.createIdentityFor(e)),e[Ce].serialize()}createIdentityFor(e){ke.createIdentity(e,Xe.fromString(this._id),this.idGenerator)}get type(){return this.storage.type}get _id(){return this.storage.id}get storage(){return this._storage}toManifestString(){return`'${this._id}'`}generateKey(){return this.idGenerator.newChildId(Xe.fromString(this._id),"key").toString()}disable(e){this.storage instanceof yn&&this.storage.deregister(e,this),this._storage=yn.newNoOpProxy(this.storage.id,this.storage.type)}}class En extends Cn{async _notify(e,t,n){switch(d()(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void await t.callOnHandleSync(this,this._restore(n),e=>this.reportUserExceptionInHost(e,t,"onHandleSync"));case"update":{const e={};return"add"in n&&(e.added=this._restore(n.add)),"remove"in n&&(e.removed=this._restore(n.remove)),e.originator=n.originatorId===this._particleId,void await t.callOnHandleUpdate(this,e,e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"))}case"desync":return void await t.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"));default:throw new Error("unsupported")}}async get(e){if(!this.canRead)throw new Error("Handle not readable");return this._restore([await this.storage.get(e)])[0]}async toList(){if(!this.canRead)throw new Error("Handle not readable");return this._restore(await this.storage.toList())}_restore(e){if(null==e)return null;const t=this.type.getContainedType();if(t instanceof Ft)return e.map(e=>Sn(e,this.entityClass));if(t instanceof qt)return e.map(e=>new On(e,t,this.storage.pec));throw new Error(`Don't know how to deliver handle data of type ${this.type}`)}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),n=[this.generateKey()];return this.storage.store(t,n,this._particleId)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");if(this.storage.clear)return this.storage.clear(this._particleId);throw new Error("clear not implemented by storage")}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);await this.storage.remove(t.id,[],this._particleId)}get storage(){return this._storage}}class kn extends Cn{async _notify(e,t,n){switch(d()(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void await t.callOnHandleSync(this,this._restore(n),e=>this.reportUserExceptionInHost(e,t,"onHandleSync"));case"update":{const e=this._restore(n.data),r=this._restore(n.oldData);return void await t.callOnHandleUpdate(this,{data:e,oldData:r},e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"))}case"desync":return void await t.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,t,"onHandleDesync"));default:throw new Error("unsupported")}}async get(){if(!this.canRead)throw new Error("Handle not readable");const e=await this.storage.get();return this._restore(e)}_restore(e){if(null==e)return null;if(this.type instanceof Ft)return Sn(e,this.entityClass);if(this.type instanceof Ht)return fn.fromLiteral(e);if(this.type instanceof qt)return new On(e,this.type,this.storage.pec);throw new Error(`Don't know how to deliver handle data of type ${this.type}`)}async set(e){try{if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);return this.storage.set(t,this._particleId)}catch(e){throw this.reportSystemExceptionInHost(e,"Handle::set"),e}}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this.storage.clear(this._particleId)}get storage(){return this._storage}}class Tn{constructor(e,t){this._parent=e,this._cursorId=t}async next(){const e=await this._parent.storage.cursorNext(this._cursorId);return e.done||(e.value=e.value.map(e=>Sn(e,this._parent.entityClass))),e}close(){this._parent.storage.cursorClose(this._cursorId)}}class xn extends Cn{configure(e){throw new Error("BigCollections do not support sync/update configuration")}async _notify(e,t,n){d()(this.canRead,"_notify should not be called for non-readable handles"),d()("sync"===e,"BigCollection._notify only supports sync events"),await t.callOnHandleSync(this,[],e=>this.reportUserExceptionInHost(e,t,"onHandleSync"))}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),n=[this.generateKey()];return this.storage.store(t,n,this._particleId)}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);await this.storage.remove(t.id,[],this._particleId)}async stream({pageSize:e,forward:t=!0}){if(!this.canRead)throw new Error("Handle not readable");if(isNaN(e)||e<1)throw new Error("Streamed reads require a positive pageSize");const n=await this.storage.stream(e,t);return new Tn(this,n)}get storage(){return this._storage}}function Rn(e){return(e={particleId:"",canRead:!0,canWrite:!0,...e}).proxy instanceof Ot?(d()(e.particleId.length,"NG Handles require a particle ID"),t=e.particleId,n=e.proxy,r=e.idGenerator,i=e.particle,s=e.canRead,o=e.canWrite,a=e.name,new(n.type.handleConstructor())(t,n,r,i,s,o,a)):function(e,t,n=null,r="",i=!0,s=!0){let o;o=e.type instanceof $t?new En(e,t,n,r,i,s):e.type instanceof Bt?new xn(e,t,n,r,i,s):new kn(e,t,n,r,i,s);const a=e.type.getEntitySchema();return a&&(o.entityClass=a.entityClass(e.pec)),o}(e.proxy,e.idGenerator,e.name,e.particleId,e.canRead,e.canWrite);var t,n,r,i,s,o,a}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.Unstored=0]="Unstored",e[e.Stored=1]="Stored"}(ht||(ht={}));class On{constructor(e,t,n){this.entity=null,this.storageProxy=null,this.handle=null,this.id=e.id,this.storageKey=e.storageKey,this.context=n,this.type=t,this[Ce]={serialize:()=>({id:this.id,rawData:this.dataClone()})}}async ensureStorageProxy(){null==this.storageProxy&&(this.storageProxy=await this.context.getStorageProxy(this.storageKey,this.type.referredType),this.handle=Rn({proxy:this.storageProxy,idGenerator:this.context.idGenerator}),this.storageKey?d()(this.storageKey===this.storageProxy.storageKey):this.storageKey=this.storageProxy.storageKey)}async dereference(){return d()(this.context,"Must have context to dereference"),this.entity?this.entity:(await this.ensureStorageProxy(),this.entity=await this.handle.get(this.id),this.entity)}dataClone(){return{storageKey:this.storageKey,id:this.id}}}class In extends On{constructor(e,t){super({id:ke.id(e),storageKey:null},new qt(ke.entityClass(e).type),t),this.mode=ht.Unstored,this.entity=e,this.stored=this.storeReference(e)}async storeReference(e){await this.ensureStorageProxy(),this.handle instanceof Dt?await this.handle.add(e):await this.handle.store(e),this.mode=ht.Stored}async dereference(){return this.mode===ht.Unstored?null:super.dereference()}isIdentified(){return ke.isIdentified(this.entity)}static newClientReference(e){return class extends In{constructor(t){super(t,e)}}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Pn{constructor(){this.relevances=[],this._idle=Promise.resolve(),this._busy=0,this.slotProxiesByName=new Map,this.spec=this.constructor.spec,0===this.spec.inputs.length&&(this.extraData=!0)}ready(){}setCapabilities(e){if(this.capabilities)throw new Error("capabilities should only be set once");this.capabilities=e||{}}async invokeSafely(e,t){try{return this.startBusy(),await e(this)}catch(e){t(e)}finally{this.doneBusy()}}async callSetHandles(e,t){this.handles=e,await this.invokeSafely(async t=>t.setHandles(e),t),this._handlesToSync=this._countInputHandles(e),this._handlesToSync||this.ready()}async setHandles(e){}_countInputHandles(e){let t=0;for(const[n,r]of e)r.canRead&&t++;return t}async callOnHandleSync(e,t,n){await this.invokeSafely(async n=>n.onHandleSync(e,t),n),0==--this._handlesToSync&&this.ready()}async onHandleSync(e,t){}async callOnHandleUpdate(e,t,n){await this.invokeSafely(async n=>n.onHandleUpdate(e,t),n)}async onHandleUpdate(e,t){}async callOnHandleDesync(e,t){await this.invokeSafely(async t=>t.onHandleDesync(e),t)}async onHandleDesync(e){}async constructInnerArc(){if(!this.capabilities.constructInnerArc)throw new Error("This particle is not allowed to construct inner arcs");return this.capabilities.constructInnerArc(this)}get busy(){return this._busy>0}get idle(){return this._idle}set relevance(e){this.relevances.push(e)}startBusy(){0===this._busy&&(this._idle=new Promise(e=>this._idleResolver=(()=>e()))),this._busy++}doneBusy(){this._busy--,0===this._busy&&this._idleResolver()}inputs(){return this.spec.inputs}outputs(){return this.spec.outputs}hasSlotProxy(e){return this.slotProxiesByName.has(e)}addSlotProxy(e){this.slotProxiesByName.set(e.slotName,e)}removeSlotProxy(e){this.slotProxiesByName.delete(e)}async service(e){return this.capabilities.serviceRequest?new Promise(t=>{this.capabilities.serviceRequest(this,e,e=>t(e))}):(console.warn(`${this.spec.name} has no service support.`),null)}getSlot(e){return this.slotProxiesByName.get(e)}getSlotNames(){return[...this.slotProxiesByName.keys()]}static buildManifest(e,...t){const n=[];for(let r=0;r<t.length;r++){const i=e[r],s=/ *$/.exec(i)[0];let o;o=(o="string"==typeof t[r]?t[r]:t[r].toManifestString()).replace(/(\n)/g,"$1"+s),n.push(i),n.push(o)}return e.length>t.length&&n.push(e[e.length-1]),n.join("")}async setParticleDescription(e){return this.setDescriptionPattern("pattern",e)}async setDescriptionPattern(e,t){const n=this.handles.get("descriptions");if(n){if(n instanceof En||n instanceof xn){const r=n.entityClass;await n.store(new r({key:e,value:t},this.spec.name+"-"+e))}return!0}throw new Error("A particle needs a description handle to set a decription pattern")}idFor(e){return ke.id(e)}dataClone(e){return ke.dataClone(e)}mutate(e,t){ke.mutate(e,t)}output(e){const{output:t}=this.capabilities;t&&t(this,e)}renderSlot(e,t){}renderHostedSlot(e,t,n){}fireEvent(e,t){}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Nn=()=>Object.create(null),An=e=>(class extends e{constructor(){super(),this._pendingProps=Nn(),this._props=this._getInitialProps()||Nn(),this._lastProps=Nn(),this._state=this._getInitialState()||Nn(),this._lastState=Nn()}_getInitialProps(){}_getInitialState(){}_getProperty(e){return this._pendingProps[e]||this._props[e]}_setProperty(e,t){(this._validator||this._wouldChangeProp(e,t))&&(this._pendingProps[e]=t,this._invalidateProps())}_wouldChangeValue(e,t,n){return e[t]!==n}_wouldChangeProp(e,t){return this._wouldChangeValue(this._props,e,t)}_wouldChangeState(e,t){return this._wouldChangeValue(this._state,e,t)}_setProps(e){Object.assign(this._pendingProps,e),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}_setState(e){let t=!1;const n=this._state;for(const r in e){const i=e[r];this._wouldChangeState(r,i)&&(t=!0,n[r]=i)}if(t)return this._invalidate(),!0}_async(e){return Promise.resolve().then(e.bind(this))}_invalidate(){this._validator||(this._validator=this._async(this._validate))}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const e=this._getStateArgs();try{Object.assign(this._props,this._pendingProps),this._propsInvalid&&(this._willReceiveProps(...e),this._propsInvalid=!1),this._shouldUpdate(...e)&&(this._ensureMount(),this._doUpdate(...e))}catch(e){console.error(e)}this._validator=null,this._lastProps=Object.assign(Nn(),this._props),this._lastState=Object.assign(Nn(),this._state)}_doUpdate(...e){this._update(...e),this._didUpdate(...e)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(e,t,n){e=`_debounce_${e}`,this._state[e]=((e,t,n)=>{if(e&&clearTimeout(e),t&&n)return setTimeout(t,n)})(this._state[e],t,null!=n?n:16)}});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Dn extends Pn{get template(){return""}getTemplate(e){return this.template}getTemplateName(e){return"default"}shouldRender(e){return!0}render(e){return{}}renderSlot(e,t){const n=this._getStateArgs(),r=this.getSlot(e);if(r){if(this.currentSlotName=e,t.forEach(e=>r.requestedContentTypes.add(e)),this.shouldRender(...n)){const e={};if(r.requestedContentTypes.has("template")&&(e.template=this.getTemplate(r.slotName)),r.requestedContentTypes.has("model")&&(e.model=this.render(...n)),e.templateName=this.getTemplateName(r.slotName),r.providedSlots.size>0&&(e.template&&("string"==typeof e.template?e.template=this.slotNamesToModelReferences(r,e.template):e.template=Object.entries(e.template).reduce((e,[t,n])=>(e[t]=this.slotNamesToModelReferences(r,n),e),{})),e.model)){const t={};r.providedSlots.forEach((e,n)=>t[`$${n}`]=e),e.model=this.enhanceModelWithSlotIDs(e.model,t)}r.render(e)}else r.isRendered&&r.render({});this.currentSlotName=void 0}}slotNamesToModelReferences(e,t){return e.providedSlots.forEach((e,n)=>{t=t.replace(new RegExp(`slotid="${n}"`,"gi"),`slotname="${n}" slotid$="{{$${n}}}"`)}),t}enhanceModelWithSlotIDs(e,t,n=!0){n&&(e={...t,...e}),e.hasOwnProperty("$template")&&e.hasOwnProperty("models")&&Array.isArray(e.models)&&(e.models=e.models.map(e=>this.enhanceModelWithSlotIDs(e,t)));for(const[n,r]of Object.entries(e))r&&"object"==typeof r&&(e[n]=this.enhanceModelWithSlotIDs(r,t,!1));return e}_getStateArgs(){return[]}forceRenderTemplate(e=""){this.slotProxiesByName.forEach((t,n)=>{e&&n!==e||t.requestedContentTypes.add("template")})}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n})}async setParticleDescription(e){if("string"==typeof e)return super.setParticleDescription(e);if(e.template&&e.model)return await super.setDescriptionPattern("_template_",e.template),void await super.setDescriptionPattern("_model_",JSON.stringify(e.model));throw new Error("Description pattern must either be string or have template and model")}async clearHandle(e){const t=this.handles.get(e);if(!(t instanceof kn||t instanceof En))throw new Error("Singleton/Collection required");await t.clear()}async mergeEntitiesToHandle(e,t){const n={},r=this.handles.get(e);if(!(r instanceof En))throw new Error("Collection required");(await r.toList()).forEach(e=>n[e.id]=e);for(const e of t)n[this.idFor(e)]||await r.store(e)}async appendEntitiesToHandle(e,t){const n=this.handles.get(e);if(n){if(!(n instanceof En||n instanceof xn))throw new Error("Collection required");await Promise.all(t.map(e=>n.store(e)))}}async appendRawDataToHandle(e,t){const n=this.handles.get(e);if(!(n instanceof En||n instanceof xn))throw new Error("Collection required");{const e=n.entityClass;await Promise.all(t.map(t=>n.store(new e(t))))}}async updateSingleton(e,t){const n=this.handles.get(e);if(n){if(n instanceof kn){const e=new n.entityClass(t);return await n.set(e),e}throw new Error("Singleton required")}throw new Error(`Handle ${e} does not exist`)}async updateCollection(e,t){const n=this.handles.get(e);if(n){if(!(n instanceof En||n instanceof xn))throw new Error("Collection required");await n.remove(t),await n.store(t)}}async derefShares(e){let t=[];this.startBusy();try{const n=e.map(async e=>e.ref.dereference());t=await Promise.all(n)}finally{this.doneBusy()}return t}async boxQuery(e,t){if(e){const n=e.filter(e=>t===e.fromKey);return await this.derefShares(n)}return[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Mn extends(An(Dn)){willReceiveProps(...e){}update(...e){}shouldRender(...e){return!0}render(...e){return{}}setState(e){return this._setState(e)}get state(){return this._state}set state(e){this.setState(e)}get props(){return this._props}get config(){return{handleNames:this.spec.inputs.map(e=>e.name),slotNames:this.spec.slandleConnectionNames()}}_willReceiveProps(...e){this.willReceiveProps(...e)}_update(...e){this.update(...e),this.shouldRender(...e)&&(this.relevance=1),this.config.slotNames.forEach(e=>this.renderSlot(e,["model"]))}_async(e){this.startBusy();return setTimeout(()=>{try{e.call(this)}finally{this.doneBusy()}},10)}async setHandles(e){this.configureHandles(e),this.handles=e,this._invalidate()}configureHandles(e){}async onHandleSync(e,t){this._setProperty(e.name,t)}async onHandleUpdate({name:e},{data:t,added:n,removed:r}){if(void 0!==t&&this._setProps({[e]:t}),n){const t=(this.props[e]||[]).concat(n);this._props[e]=t,this._setProps({[e]:t})}if(r){const t=this.props[e];Array.isArray(t)&&(r.forEach(e=>{const n=t.findIndex(t=>this.idFor(t)===this.idFor(e));n>=0?t.splice(n,1):console.warn("dom-particle::onHandleUpdate: couldn't find item to remove")}),this._setProps({[e]:t}))}}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n},this._state)}debounce(e,t,n){const r=`_debounce_${e}`,i=this.state;i[r]||(i[r]=!0,this.startBusy());super._debounce(e,()=>{this.doneBusy(),t(),i[r]=null},n)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class jn extends Mn{getTemplate(e){return this._state.template}getTemplateName(e){return this._state.templateName}render(e,t){return t.renderModel}shouldRender(e,t){return Boolean((t.template||t.templateName)&&t.renderModel)}renderHostedSlot(e,t,n){this.combineHostedTemplate(e,t,n),this.combineHostedModel(e,t,n)}combineHostedTemplate(e,t,n){}combineHostedModel(e,t,n){}static propsToItems(e){return e?e.map(e=>({subId:ke.id(e),...e})):[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Fn extends jn{constructor(){super(...arguments),this._itemSubIdByHostedSlotId=new Map,this._connByHostedConn=new Map}async _mapParticleConnections(e,t,n,r,i){const s=[],o=[];let a=2;const c=[e,t];for(const[e,t]of r){if(c.includes(e))continue;const r=t.storage;s.push(`use '${await i.mapHandle(r)}' as v${a}`);const l=n.handleConnections.find(e=>e.isCompatibleType(t.type));l&&(o.push(`${l.name} = v${a++}`),this._connByHostedConn.set(l.name,e))}return[s,o]}async setHandles(e){this.handleIds={};const t=await this.constructInnerArc(),n=e.get("hostedParticle");let r=null,i=[],s=[];n&&(r=await n.get())&&([i,s]=await this._mapParticleConnections("list","hostedParticle",r,e,t)),this.setState({arc:t,type:e.get("list").type,hostedParticle:r,otherMappedHandles:i,otherConnections:s}),await super.setHandles(e)}async update({list:e},{arc:t,type:n,hostedParticle:r,otherMappedHandles:i,otherConnections:s},o,a){if(e&&t&&(o.list!==e||a.arc!==t)){e.length>0&&(this.relevance=.1);for(const[o,a]of this.getListEntries(e)){let e=r;const c=ke.id(a);if(this.handleIds[c]){(await this.handleIds[c]).set(a);continue}const l=t.createHandle(n.getContainedType(),`item${o}`);this.handleIds[c]=l;const h=await l;if(!e){if(!a.renderParticleSpec)continue;e=fn.fromLiteral(JSON.parse(a.renderParticleSpec));const n="list",r="renderParticle";[i,s]=await this._mapParticleConnections(n,r,e,this.handles,t)}const u=e.slandleConnectionNames()[0],p=this.spec.slandleConnectionNames();d()(p.length>0,"there must be at least one slot");const f=p[0],m=await t.createSlot(this,f,h._id);if(m){this._itemSubIdByHostedSlotId.set(m,c);try{const n=this.constructInnerRecipe(e,a,h,{name:u,id:m},{connections:s,handles:i});await t.loadRecipe(n),h.set(a)}catch(e){console.log(e)}}}}}combineHostedModel(e,t,n){const r=this._itemSubIdByHostedSlotId.get(t);if(!r)return;const i=this._state.renderModel?this._state.renderModel.items:[],s=i.findIndex(e=>e.subId===r),o={...n.model,subId:r};s>=0&&s<i.length?i[s]=o:i.push(o),this.setState({renderModel:{items:i}})}combineHostedTemplate(e,t,n){const r=this._itemSubIdByHostedSlotId.get(t);if(!r)return;d()(n.templateName,`Template name is missing for slot '${e}' (hosted slot ID: '${t}')`);const i={...this._state.templateName,[r]:`${n.templateName}`};if(this.setState({templateName:i}),n.template){let e=n.template;e=e.replace(new RegExp('slotid="[a-z]+"',"gi"),'$& subid$="{{subId}}"'),this._connByHostedConn.forEach((t,n)=>{e=e.replace(new RegExp(`{{${n}.description}}`,"g"),`{{${t}.description}}`)}),this.setState({template:{...this._state.template,[n.templateName]:e}}),this.forceRenderTemplate()}}getListEntries(e){return e.entries()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ln extends Pn{get config(){return{handleNames:this.spec.inputs.map(e=>e.name),slotNames:this.spec.slandleConnectionNames()}}get template(){return""}shouldRender(...e){return!0}renderOutput(...e){const t=this.render(...e);t&&this.renderModel(t)}renderModel(e){this.output({template:this.template,model:e})}render(...e){return{}}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n})}async setParticleDescription(e){if("string"==typeof e)return super.setParticleDescription(e);if(e.template&&e.model)return await super.setDescriptionPattern("_template_",e.template),void await super.setDescriptionPattern("_model_",JSON.stringify(e.model));throw new Error("Description pattern must either be string or have template and model")}async await(e){return await this.invokeSafely(e,e=>{throw e})}async set(e,t){const n=this._requireHandle(e);if(!(n instanceof kn))throw new Error(`Cannot set non-Singleton handle [${e}]`);if(Array.isArray(t))throw new Error(`Cannot set an Array to Singleton handle [${e}]`);return this.await(async e=>await n.set(this._requireEntity(t,n.entityClass)))}async add(e,t){const n=this._requireHandle(e);if(!(n instanceof En))throw new Error(`Cannot add to non-Collection handle [${e}]`);const r=n.entityClass,i=Array.isArray(t)?t:[t];return this.await(async e=>{await this._remove(n,i),await Promise.all(i.map(e=>n.store(this._requireEntity(e,r))))})}_requireEntity(e,t){return e instanceof ke?e:new t(e)}async remove(e,t){const n=this._requireHandle(e);if(!(n instanceof En))throw new Error(`Cannot remove from a non-Collection handle [${e}]`);return this._remove(n,t)}async _remove(e,t){const n=Array.isArray(t)?t:[t];return this.await(async t=>Promise.all(n.map(async t=>{t instanceof ke&&await e.remove(t)})))}async clear(e){const t=this._requireHandle(e);if(!(t instanceof kn||t instanceof En))throw new Error("Can only clear Singleton or Collection handles");return this.await(e=>t.clear())}_requireHandle(e){const t=this.handles.get(e);if(!t)throw new Error(`Could not find handle [${e}]`);return t}async derefShares(e){return this.await(async t=>{const n=e.map(async e=>e.ref.dereference());return await Promise.all(n)})}async boxQuery(e,t){if(!e)return[];const n=e.filter(e=>t===e.fromKey);return await this.derefShares(n)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class $n extends(An(Ln)){willReceiveProps(...e){}_willReceiveProps(...e){this.willReceiveProps(...e)}update(...e){}setState(e){return this._setState(e)}get state(){return this._state}set state(e){this.setState(e)}get props(){return this._props}_shouldUpdate(){return this._handlesToSync<=0}_update(...e){this.update(...e),this.shouldRender(...e)&&(this.relevance=1,this.renderOutput(...e))}_async(e){this.startBusy();return setTimeout(()=>{try{e.call(this)}finally{this.doneBusy()}},10)}ready(){this._invalidate()}async onHandleSync(e,t){this._setProperty(e.name,t)}async onHandleUpdate({name:e},{data:t,added:n,removed:r}){if(void 0!==t&&this._setProps({[e]:t}),n){const t=(this.props[e]||[]).concat(n);this._props[e]=t,this._setProps({[e]:t})}if(r){const t=this.props[e];Array.isArray(t)&&(r.forEach(e=>{const n=t.findIndex(t=>this.idFor(t)===this.idFor(e));n>=0?t.splice(n,1):console.warn("dom-particle::onHandleUpdate: couldn't find item to remove")}),this._setProps({[e]:t}))}}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n},this._state)}debounce(e,t,n){const r=`_debounce_${e}`,i=this.state;i[r]||(i[r]=!0,this.startBusy());super._debounce(e,()=>{this.doneBusy(),t(),i[r]=null},n)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Bn=(e,...t)=>(e[0]+t.map((t,n)=>t+e[n+1]).join("")).trim();class Un{path(e){return e.replace(/[\/][^\/]+$/,"/")}join(e,t){return/^https?:\/\//.test(t)?t:"/"===t[0]||":"===t[1]?t:(e=this.path(e),t=this.normalizeDots(`${e}${t}`))}normalizeDots(e){const t=e=>e.replace(/(?:^|\/)[^.\/]*\/\.\./g,"");for(let n=t(e=(e=e.replace(/\\/g,"/")).replace(/\/\.\//g,"/"));n!==e;n=t(e=n));return e=e.replace(/([^:])(\/\/)/g,"$1/")}async loadResource(e){return/^https?:\/\//.test(e)?this._loadURL(e):this.loadFile(e,"utf-8")}async loadWasmBinary(e){this.mapParticleUrl(e.implFile);const t=this.resolve(e.implFile);return/^https?:\/\//.test(t)?te(t).then(e=>e.arrayBuffer()):this.loadFile(t)}mapParticleUrl(e){}resolve(e){return e}async loadFile(e,t){return new Promise((n,r)=>{o.a.readFile(e,{encoding:t},(e,i)=>{e?r(e):n(t?i:i.buffer)})})}async _loadURL(e){const t=e=>te(e).then(async e=>e.ok?e.text():Promise.reject(new Error(`HTTP ${e.status}: ${e.statusText}`)));return/\/\/schema.org\//.test(e)?e.endsWith("/Thing")?t("https://schema.org/Product.jsonld").then(e=>se.convert(e,{"@id":"schema:Thing"})):t(e+".jsonld").then(e=>se.convert(e)):t(e)}async loadParticleClass(e){const t=await this.requireParticle(e.implFile);return t.spec=e,t}async requireParticle(e){null===e&&(e="");const t=await this.loadResource(e),n=new re.a.Script(t,{filename:e,displayErrors:!0}),r=[],i={defineParticle(e){r.push(e)},console:console,fetch:te,setTimeout:setTimeout,importScripts:e=>null};return n.runInNewContext(i,{filename:e,displayErrors:!0}),d()(r.length>0&&"function"==typeof r[0],`Error while instantiating particle implementation from ${e}`),this.unwrapParticle(r[0])}setParticleExecutionContext(e){this.pec=e}unwrapParticle(e){return d()(this.pec),e({Particle:Pn,DomParticle:Mn,SimpleParticle:$n,TransformationDomParticle:jn,MultiplexerDomParticle:Fn,Reference:In.newClientReference(this.pec),html:Bn})}clone(){return new Un}}function Hn(e){switch(e){case"->":return"out";case"<-":return"in";case"<->":return"inout";case"consume":return"`consume";case"provide":return"`provide";case"=":return"any";default:throw new Error(`Bad arrow ${e}`)}}function zn(e){switch(e){case"in":return"<-";case"out":return"->";case"inout":return"<->";case"host":return"=";case"`consume":return"consume";case"`provide":return"provide";case"any":return"=";default:throw new Error(`Unexpected direction ${e}`)}}class qn extends Error{constructor(e,t,n,r){super(),this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,qn)}static buildMessage(e,t){function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,e=>"\\x0"+n(e)).replace(/[\x10-\x1F\x7F-\x9F]/g,e=>"\\x"+n(e))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,e=>"\\x0"+n(e)).replace(/[\x10-\x1F\x7F-\x9F]/g,e=>"\\x"+n(e))}function s(e){switch(e.type){case"literal":return'"'+r(e.text)+'"';case"class":const t=e.parts.map(e=>Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e));return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){const t=e.map(s);let n,r;if(t.sort(),t.length>0){for(n=1,r=1;n<t.length;n++)t[n-1]!==t[n]&&(t[r]=t[n],r++);t.length=r}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+((o=t)?'"'+r(o)+'"':"end of input")+" found.";var o}}const Wn=function(e,t){t=void 0!==t?t:{};const n={},r={Manifest:Gs};let i=Gs;const s=function(e){const t=e.map(e=>{const t=e[0],n=e[2];return n.triggers=t.triggerSet,n.annotation=t.simpleAnnotation,n});return function e(t,n=""){if(!["string","number","boolean"].includes(typeof t)&&null!==t)if(void 0===t&&Us(`Internal Parser Error: result was undefined at ${n}`),Array.isArray(t)){let r=0;for(const i of t)e(i,`${n}/${r}`),r++}else{t.model&&Us(`Internal Parser Error: unexpected 'model' in ${JSON.stringify(t)} at ${n}`),t.location||Us(`Internal Parser Error: no 'location' in ${JSON.stringify(t)} at ${n}`),t.kind||Us(`Internal Parser Error: no 'kind' in ${JSON.stringify(t)} at ${n}`);for(const r of Object.keys(t))["location","kind"].includes(r)||e(t[r],`${n}/${r}`)}}(t),t},o=function(e,t){return pa({kind:"annotation",triggerSet:e.map(e=>e[1]),simpleAnnotation:da(t,e=>e[1],null)})},a=qs("a trigger for a recipe"),c="@trigger",l=Hs("@trigger",!1),h=function(e){return e.map(e=>[e[2],e[4]])},u=qs("an annotation (e.g. @foo)"),d="@",p=Hs("@",!1),f=function(e){return e},m="resource",y=Hs("resource",!1),g=function(e,t){return pa({kind:"resource",name:e,data:t})},_="start",v=Hs("start",!1),b=function(){ca=aa},w=function(e){return e.map(e=>e[0].substring(ca.length)+e[1]).join("")},S=/^[^\n]/,C=zs(["\n"],!0,!1),E=function(){return Ls()},k="store",T=Hs("store",!1),x="of",R=Hs("of",!1),O="!!",I=Hs("!!",!1),P=function(e,t,n,r,i,s,o,a){a=da(a,ua,[]);let c=null,l=null;for(const e of a)"description"===e[0]?(c&&Us("You cannot provide more than one description."),c=e[2]):"manifest-storage-claim"===e.kind?(l&&Us("You cannot provide more than one claim."),l=e):Us(`Unknown ManifestStorageItem: ${e}`);return pa({kind:"store",name:e,type:t,id:da(n,e=>e[1],null),originalId:da(r,e=>e[1],null),version:da(i,e=>e[1],null),tags:da(s,e=>e[1],null),source:o.source,origin:o.origin,description:c,claim:l})},N="in",A=Hs("in",!1),D=function(e){return pa({kind:"manifest-storage-source",origin:"file",source:e})},M=function(e){return pa({kind:"manifest-storage-source",origin:"resource",source:e})},j="at",F=Hs("at",!1),L=function(e){return pa({kind:"manifest-storage-source",origin:"storage",source:e})},$="description",B=Hs("description",!1),U="claim",H=Hs("claim",!1),z="is",q=Hs("is",!1),W="and",V=Hs("and",!1),K=function(e,t){return pa({kind:"manifest-storage-claim",tags:[e,...t.map(e=>e[5])]})},Q="import",G=Hs("import",!1),Z=function(e){return pa({kind:"import",path:e})},Y=qs("an interface"),X="interface",J=Hs("interface",!1),ee="<",te=Hs("<",!1),ne=">",re=Hs(">",!1),ie=function(e,t,n){return pa({kind:"interface",name:e,args:da(n,ua,[]).filter(e=>"interface-argument"===e.kind),slots:da(n,ua,[]).filter(e=>"interface-slot"===e.kind)})},se="*",oe=Hs("*",!1),ae=function(e,t,n){return"host"===(e=da(e,e=>e[0],"any"))&&Us("Interface cannot have arguments with a 'host' direction."),pa({kind:"interface-argument",direction:e,type:da(t,e=>e[0],null),name:n})},ce="must",le=Hs("must",!1),he="consume",ue=Hs("consume",!1),de="provide",pe=Hs("provide",!1),fe="set of",me=Hs("set of",!1),ye=function(e,t,n,r){return pa({kind:"interface-slot",name:da(r,e=>r[1],null),isRequired:da(e,e=>"must"===e[0],!1),direction:t,isSet:!!n})},ge="meta",_e=Hs("meta",!1),ve=function(e){return pa({kind:"meta",items:e=e?ua(e):[]})},be="name",we=Hs("name",!1),Se=":",Ce=Hs(":",!1),Ee=function(e){return pa({key:"name",value:e,kind:"name"})},ke="storageKey",Te=Hs("storageKey",!1),xe=function(e){return pa({key:"storageKey",value:e,kind:"storageKey"})},Re="particle",Oe=Hs("particle",!1),Ie=function(e,t,n,r){let i=[];const s=[],o=[],a=[],c=[];let l=null,h=!1;return t=da(t,e=>e[1],[]),(r=da(r,ua,[])).forEach(n=>{"particle-interface"===n.kind?(/[A-Z]/.test(n.verb[0])&&n.verb!==e&&Us(`Verb ${n.verb} must start with a lower case character or be same as particle name.`),t.push(n.verb),i=n.args,h=!0):"particle-argument"===n.kind?i.push(n):"particle-slot"===n.kind?o.push(n):"description"===n.kind?(l={kind:"description",location:$s()},n.description.forEach(e=>l[e.name]=e.pattern||e.patterns[0])):"particle-trust-claim"===n.kind?a.push(n):"particle-trust-check"===n.kind?c.push(n):n.modality?s.push(n.modality):Us(`Particle ${e} contains an unknown element: ${n.name} / ${n.kind}`)}),0===s.length&&s.push("dom"),pa({kind:"particle",name:e,implFile:da(n,e=>e[3],null),verbs:t,args:i,modality:s,slotConnections:o,description:l,hasParticleHandleConnection:h,trustClaims:a,trustChecks:c})},Pe=qs("a particle item"),Ne=function(e,t){return pa({kind:"particle-trust-claim",handle:e,expression:t})},Ae=function(e,t){return[e,...t.map(e=>e[3])]},De="not",Me=Hs("not",!1),je=function(e,t){return pa({kind:"particle-trust-claim-is-tag",claimType:ct.IsTag,isNot:null!=e,tag:t})},Fe="derives from",Le=Hs("derives from",!1),$e=function(e){return pa({kind:"particle-trust-claim-derives-from",claimType:ct.DerivesFrom,parentHandle:e})},Be="check",Ue=Hs("check",!1),He=function(e,t){return pa({kind:"particle-trust-check",target:e,expression:t})},ze="data",qe=Hs("data",!1),We=function(e,t){return pa({kind:"particle-check-target",targetType:t?"slot":"handle",name:e})},Ve="or",Ke=Hs("or",!1),Qe=function(e,t){return 0===t.length?e:(new Set(t.map(e=>e[1])).size>1&&Bs("You cannot combine 'and' and 'or' operations in a single check expression. You must nest them inside parentheses."),pa({kind:"particle-trust-check-boolean-expression",operator:t[0][1],children:[e,...t.map(e=>e[3])]}))},Ge=function(e){return e},Ze="(",Ye=Hs("(",!1),Xe=")",Je=Hs(")",!1),et=function(e,t){return pa({kind:"particle-trust-check-has-tag",checkType:at.HasTag,isNot:!!e,tag:t})},tt="from",nt=Hs("from",!1),rt="handle",it=Hs("handle",!1),st=function(e,t){return pa({kind:"particle-trust-check-is-from-handle",checkType:at.IsFromHandle,isNot:!!e,parentHandle:t})},ot="output",lt=Hs("output",!1),ht=function(e,t){return pa({kind:"particle-trust-check-is-from-output",checkType:at.IsFromOutput,isNot:!!e,output:t})},ut=function(e,t){return pa({kind:"particle-trust-check-is-from-store",checkType:at.IsFromStore,isNot:!!e,storeRef:t})},dt=function(e){return pa({kind:"store-reference",type:"name",store:e})},pt=function(e){return pa({kind:"store-reference",type:"id",store:e})},ft=function(e,t){return e.dependentConnections=da(t,ua,[]),e},mt="?",yt=Hs("?",!1),gt=function(e,t,n,r){return fa(),pa({kind:"particle-argument",direction:e,type:n,isOptional:!!t,dependentConnections:[],name:r.name,tags:r.tags})},_t=function(e){return e},vt=function(e,t,n,r,i){return ma(),pa({kind:"particle-argument",direction:t,type:r,isOptional:!!n,dependentConnections:[],name:e||i[0]||Bs(`either a name or tags to be supplied ${e} ${i}`),tags:i||[]})},bt=qs("a direction (e.g. inout, in, out, host, `consume, `provide, any)"),wt="inout",St=Hs("inout",!1),Ct="out",Et=Hs("out",!1),kt="host",Tt=Hs("host",!1),xt="`consume",Rt=Hs("`consume",!1),Ot="`provide",It=Hs("`provide",!1),Pt="any",Nt=Hs("any",!1),At=function(){const e=Ls();return null===e&&Bs("a direction"),e},Dt=qs("a direction arrow (e.g. <-, ->, <->, =, consume, provide)"),Mt="<->",jt=Hs("<->",!1),Ft="<-",Lt=Hs("<-",!1),$t="->",Bt=Hs("->",!1),Ut="=",Ht=Hs("=",!1),zt=function(){const e=Ls();return null===e&&Bs("a direction arrow"),e},qt="[",Wt=Hs("[",!1),Vt="]",Kt=Hs("]",!1),Qt=function(e){return pa({kind:"collection-type",type:e})},Gt="BigCollection<",Zt=Hs("BigCollection<",!1),Yt=function(e){return pa({kind:"big-collection-type",type:e})},Xt="Reference<",Jt=Hs("Reference<",!1),en=function(e){return pa({kind:"reference-type",type:e})},tn=qs("a type variable (e.g. ~foo)"),nn="~",rn=Hs("~",!1),sn="with",on=Hs("with",!1),cn=function(e,t){return pa({kind:"variable-type",name:e,constraint:da(t,e=>e[3],null)})},ln="Slot",hn=Hs("Slot",!1),un=/^[^a-z0-9_]/i,dn=zs([["a","z"],["0","9"],"_"],!0,!0),pn="{",fn=Hs("{",!1),mn=",",yn=Hs(",",!1),gn="}",_n=Hs("}",!1),vn=function(e){return pa({kind:"slot-type",fields:e=da(e,e=>{const t=e[2];return[t[0]].concat(t[1].map(e=>e[2]))},[])})},bn=function(e,t){return pa({kind:"slot-field",name:e,value:t})},wn=function(e){return pa({kind:"type-name",name:e})},Sn=function(e,t){return[e,...t.map(e=>e[2])]},Cn="modality",En=Hs("modality",!1),kn=function(e){return pa({kind:"particle-modality",modality:e})},Tn=function(e,t,n,r,i){let s=null;const o=[];return(i=da(i,ua,[])).forEach(e=>{"provided-slot"===e.kind?o.push(e):"form-factor"===e.kind?(s&&Us("duplicate form factor for a slot"),s=e.formFactor):Us("Unsupported particle slot item ",e)}),pa({kind:"particle-slot",name:n,tags:da(r,e=>e[1],[]),isRequired:da(e,e=>"must"===e[0],!1),isSet:!!t,formFactor:s,provideSlotConnections:o})},xn="formFactor",Rn=Hs("formFactor",!1),On="fullscreen",In=Hs("fullscreen",!1),Pn="big",Nn=Hs("big",!1),An="medium",Dn=Hs("medium",!1),Mn="small",jn=Hs("small",!1),Fn=function(e){return pa({kind:"form-factor",formFactor:e})},Ln=function(e,t,n,r,i){let s=null;const o=[];return(i=i?ua(i):[]).forEach(e=>{"form-factor"===e.kind?(s&&Us("duplicate form factor for a slot"),s=e.formFactor):o.push(e.handle)}),pa({kind:"provided-slot",name:n,tags:da(r,e=>e[1],[]),isRequired:da(e,e=>"must"===e[0],!1),isSet:!!t,formFactor:s,handles:o})},$n=function(e){return pa({kind:"particle-provided-slot-handle",handle:e})},Bn=function(e,t){t=da(t,ua,[]);const n=[];return e&&n.push(e),t.filter(e=>"pattern"===e.name).forEach(e=>n.push(e)),t=t.filter(e=>"pattern"!==e.name),{kind:"description",location:$s(),description:[{kind:"default-description?",location:$s(),name:"pattern",patterns:n},...t]}},Un=function(e,t){return pa({kind:"handle-description",name:e,pattern:t})},zn="recipe",Wn=Hs("recipe",!1),Vn=function(e,t,n){return t=da(t,e=>e[1],[]),pa({kind:"recipe",name:da(e,e=>e[1],null),verbs:t,items:da(n,ua,[])})},Kn="as",Qn=Hs("as",!1),Gn=/^[a-zA-Z0-9]/,Zn=zs([["a","z"],["A","Z"],["0","9"]],!1,!1),Yn=function(){Bs("lower identifier")},Xn=function(e,t,n){const r=[],i=[];if(n){n=ua(n);for(const e of n)"handle-connection"===e.kind?r.push(e):i.push(e)}return pa({kind:"particle",name:da(t,e=>e[1],null),ref:e,connections:r,slotConnections:i})},Jn=function(e,t,n,r){return ma(),pa({kind:"handle-connection",param:e,dir:t,target:da(n,e=>e[1],null),dependentConnections:da(r,ua,[])})},er=function(e,t,n,r){return fa(),pa({kind:"handle-connection",param:e,dir:Hn(t),target:da(n,e=>e[1],null),dependentConnections:da(r,ua,[])})},tr=function(e,t){let n=null,r=null;return(e=da(e,e=>e,null))&&(e[0].toUpperCase()===e[0]?r=e:n=e),pa({kind:"handle-connection-components",name:n,particle:r,tags:da(t,e=>e,[])})},nr=function(e,t,n,r){return fa(),pa({kind:"slot-connection",direction:e,param:t.param,tags:t.tags,name:da(n,e=>e[1],null),dependentSlotConnections:da(r,ua,[])})},rr=function(e,t,n,r,i){return ma(),pa({kind:"slot-connection",direction:t,param:e,tags:r,name:da(n,e=>e[1],null),dependentSlotConnections:da(i,ua,[])})},ir=function(e,t){return pa({kind:"slot-connection-ref",param:e,tags:t||[]})},sr=function(e,t,n){return ma(),pa({kind:"connection",direction:t,from:e,to:n})},or=function(e,t,n){return fa(),pa({kind:"connection",direction:Hn(t),from:e,to:n})},ar="search",cr=Hs("search",!1),lr="tokens",hr=Hs("tokens",!1),ur=function(e,t){return pa({kind:"search",phrase:e,tokens:da(t,e=>e[1][2].map(e=>e[1]),null)})},dr=function(e,t){const{param:n,tags:r}=t||{param:null,tags:[]};return pa({kind:"connection-target",targetType:"verb",verbs:e,param:n,tags:r})},pr=function(e){return pa({kind:"connection-target",targetType:"tag",tags:e})},fr=function(e,t){const{param:n,tags:r}=t||{param:null,tags:[]};return pa({kind:"connection-target",targetType:"localName",name:e,param:n,tags:r})},mr=function(e,t){const{param:n,tags:r}=t||{param:null,tags:[]};return pa({kind:"connection-target",targetType:"particle",particle:e,param:n,tags:r})},yr=".",gr=Hs(".",!1),_r=function(e,t){return pa({kind:"connection-target-handle-components",param:da(e,e=>e,null),tags:da(t,e=>e[1],[])})},vr="use",br=Hs("use",!1),wr="map",Sr=Hs("map",!1),Cr="create",Er=Hs("create",!1),kr="copy",Tr=Hs("copy",!1),xr="`slot",Rr=Hs("`slot",!1),Or=function(e,t,n){return pa({kind:"handle",name:da(n,e=>e[1],null),ref:da(t,e=>e[1],ha()),fate:e})},Ir="require",Pr=Hs("require",!1),Nr=function(e){return pa({kind:"require",items:ua(e)})},Ar=function(e,t){return pa({kind:"requireHandle",name:da(e,e=>e[1],null),ref:da(t,e=>e[1],ha())})},Dr="#",Mr=Hs("#",!1),jr=function(e){return e},Fr=function(e,t){return[e,...t&&t[1]||[]]},Lr=qs("a verb (e.g. &Verb)"),$r="&",Br=Hs("&",!1),Ur=function(e){return e},Hr=function(e){return e},zr=function(e,t){return pa({kind:"name-and-tag-list",name:e,tags:t=da(t,e=>e[1],[])})},qr=function(e){return pa({kind:"name-and-tag-list",name:e,tags:[]})},Wr=function(e){return pa({kind:"name-and-tag-list",name:e[0],tags:e})},Vr=function(e){return pa({kind:"particle-ref",name:e,verbs:[],tags:[]})},Kr=function(e){return pa({kind:"particle-ref",verbs:[e],tags:[]})},Qr=function(e,t){return pa({kind:"handle-ref",id:e,tags:t||[]})},Gr=function(e,t){return pa({kind:"handle-ref",name:e,tags:t||[]})},Zr=function(e){return pa({kind:"handle-ref",tags:e})},Yr="slot",Xr=Hs("slot",!1),Jr=function(e,t){return pa({kind:"slot",ref:da(e,e=>e[1],ha()),name:da(t,e=>e[1],"")})},ei=function(e,t){return pa({kind:"schema-inline",names:da(e,e=>e.map(e=>e[0]).filter(e=>"*"!==e),[]),fields:da(t,e=>[e[0],...e[1].map(e=>e[2])],[])})},ti=function(e,t){return pa({kind:"schema-inline-field",name:t,type:da(e,e=>e[0],null)})},ni="schema",ri=Hs("schema",!1),ii=function(e,t){return pa({kind:"schema",names:e.map(e=>e[1]).filter(e=>"*"!==e),parents:da(t,e=>e,[])})},si="alias",oi=Hs("alias",!1),ai=function(e,t,n){return pa({...e,kind:"schema",items:da(n,ua,[]),alias:t})},ci=function(e,t){return pa({...e,kind:"schema",items:da(t,ua,[])})},li="extends",hi=Hs("extends",!1),ui=function(e,t){return[e,...t.map(e=>e[3])]},di=function(e,t){return pa({kind:"schema-field",type:e,name:t})},pi=function(e){return pa({kind:"schema-collection",schema:e})},fi=function(e){return pa({kind:"schema-reference",schema:e})},mi="Text",yi=Hs("Text",!1),gi="URL",_i=Hs("URL",!1),vi="Number",bi=Hs("Number",!1),wi="Boolean",Si=Hs("Boolean",!1),Ci="Bytes",Ei=Hs("Bytes",!1),ki=function(e){return pa({kind:"schema-primitive",type:e})},Ti=function(e,t){const n=[e];for(const e of t)n.push(e[3]);return pa({kind:"schema-union",types:n})},xi=function(e,t){const n=[e];for(const e of t)n.push(e[3]);return pa({kind:"schema-tuple",types:n})},Ri=qs("a version number (e.g. @012)"),Oi=/^[0-9]/,Ii=zs([["0","9"]],!1,!1),Pi=function(e){return Number(e.join(""))},Ni=qs("indentation"),Ai=" ",Di=Hs(" ",!1),Mi=function(e){return(e=e.join("")).length>aa.length&&(la.push(aa),aa=e,!0)},ji=qs("same indentation"),Fi=function(e){return(e=e.join("")).length===aa.length||e.length<aa.length&&(aa=la.pop(),!1)},Li=qs("same or more indentation"),$i=function(e){return(e=e.join("")).length>=aa.length||(e.length<aa.length?(aa=la.pop(),!1):void 0)},Bi=/^[^a-zA-Z0-9_]/,Ui=zs([["a","z"],["A","Z"],["0","9"],"_"],!0,!1),Hi={type:"any"},zi=function(e){Bs("identifier")},qi=qs("a `backquoted string`"),Wi="`",Vi=Hs("`",!1),Ki=/^[^`]/,Qi=zs(["`"],!0,!1),Gi=function(e){return e.join("")},Zi=qs("an identifier (e.g. 'id')"),Yi="'",Xi=Hs("'",!1),Ji=/^[^'\n]/,es=zs(["'","\n"],!0,!1),ts=function(e){Bs("' at the end of an identifier")},ns=function(e){return e.join("")},rs=qs("an uppercase identifier (e.g. Foo)"),is=/^[A-Z]/,ss=zs([["A","Z"]],!1,!1),os=/^[a-z0-9_]/i,as=zs([["a","z"],["0","9"],"_"],!1,!0),cs=qs("a lowercase identifier (e.g. foo)"),ls=qs("a lowercase identifier or keyword"),hs=/^[a-z]/,us=zs([["a","z"]],!1,!1),ds=qs("a field name (e.g. foo9)"),ps=qs("a name conforming to the rules of an android app name, per https://developer.android.com/guide/topics/manifest/manifest-element.html#package"),fs=qs("a name starting with a letter and containing letters, digits and underscores"),ms=/^[a-zA-Z]/,ys=zs([["a","z"],["A","Z"]],!1,!1),gs=/^[a-zA-Z0-9_]/,_s=zs([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),vs=function(){return Ls()},bs=qs("one or more whitespace characters"),ws=qs("a group of new lines (and optionally comments)"),Ss=/^[ ]/,Cs=zs([" "],!1,!1),Es="//",ks=Hs("//",!1),Ts=qs("a new line"),xs="\r",Rs=Hs("\r",!1),Os="\n",Is=Hs("\n",!1);let Ps=0,Ns=0;const As=[{line:1,column:1}];let Ds,Ms=0,js=[],Fs=0;if(void 0!==t.startRule){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=r[t.startRule]}function Ls(){return e.substring(Ns,Ps)}function $s(){return Vs(Ns,Ps)}function Bs(t,n){throw n=void 0!==n?n:Vs(Ns,Ps),Qs([qs(t)],e.substring(Ns,Ps),n)}function Us(e,t){throw function(e,t){return new qn(e,[],"",t)}(e,t=void 0!==t?t:Vs(Ns,Ps))}function Hs(e,t){return{type:"literal",text:e,ignoreCase:t}}function zs(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function qs(e){return{type:"other",description:e}}function Ws(t){let n,r=As[t];if(r)return r;for(n=t-1;!As[n];)n--;for(r={line:(r=As[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return As[t]=r,r}function Vs(e,t){const n=Ws(e),r=Ws(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function Ks(e){Ps<Ms||(Ps>Ms&&(Ms=Ps,js=[]),js.push(e))}function Qs(e,t,n){return new qn(qn.buildMessage(e,t),e,t,n)}function Gs(){let e,t,r,i,o,a,c,l;if(e=Ps,(t=sa())===n&&(t=null),t!==n)if((r=Ko())===n&&(r=null),r!==n){for(i=[],o=Ps,(a=Ys())!==n&&(c=Qo())!==n&&(l=Zs())!==n?o=a=[a,c,l]:(Ps=o,o=n);o!==n;)i.push(o),o=Ps,(a=Ys())!==n&&(c=Qo())!==n&&(l=Zs())!==n?o=a=[a,c,l]:(Ps=o,o=n);i!==n?(Ns=e,e=t=s(i)):(Ps=e,e=n)}else Ps=e,e=n;else Ps=e,e=n;return e}function Zs(){let t;return(t=function(){let t,r,i,s,o,a,c,l,h,u,d;if(t=Ps,e.substr(Ps,6)===zn?(r=zn,Ps+=6):(r=n,0===Fs&&Ks(Wn)),r!==n)if(i=Ps,(s=ia())!==n&&(o=Xo())!==n?i=s=[s,o]:(Ps=i,i=n),i===n&&(i=null),i!==n)if(s=Ps,(o=ia())!==n&&(a=jo())!==n?s=o=[o,a]:(Ps=s,s=n),s===n&&(s=null),s!==n)if((o=sa())!==n){if(a=Ps,(c=Ko())!==n){for(l=[],h=Ps,(u=Qo())!==n&&(d=So())!==n?h=u=[u,d]:(Ps=h,h=n);h!==n;)l.push(h),h=Ps,(u=Qo())!==n&&(d=So())!==n?h=u=[u,d]:(Ps=h,h=n);l!==n?a=c=[c,l]:(Ps=a,a=n)}else Ps=a,a=n;a===n&&(a=null),a!==n?(Ns=t,r=Vn(i,s,a),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;if(t=Ps,e.substr(Ps,8)===Re?(r=Re,Ps+=8):(r=n,0===Fs&&Ks(Oe)),r!==n)if((i=ia())!==n)if((s=Xo())!==n)if(o=Ps,(a=ia())!==n&&(c=jo())!==n?o=a=[a,c]:(Ps=o,o=n),o===n&&(o=null),o!==n)if(a=Ps,(c=ia())!==n?(e.substr(Ps,2)===N?(l=N,Ps+=2):(l=n,0===Fs&&Ks(A)),l!==n&&(h=ia())!==n&&(u=Yo())!==n?a=c=[c,l,h,u]:(Ps=a,a=n)):(Ps=a,a=n),a===n&&(a=null),a!==n)if((c=sa())!==n){if(l=Ps,(h=Ko())!==n){for(u=[],d=Ps,(p=Qo())!==n&&(f=ro())!==n?d=p=[p,f]:(Ps=d,d=n);d!==n;)u.push(d),d=Ps,(p=Qo())!==n&&(f=ro())!==n?d=p=[p,f]:(Ps=d,d=n);u!==n?l=h=[h,u]:(Ps=l,l=n)}else Ps=l,l=n;l===n&&(l=null),l!==n?((h=sa())===n&&(h=null),h!==n?(Ns=t,r=Ie(s,o,a,l),t=r):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o;return t=Ps,e.substr(Ps,6)===Q?(r=Q,Ps+=6):(r=n,0===Fs&&Ks(G)),r!==n&&(i=ia())!==n&&(s=Yo())!==n&&(o=sa())!==n?(Ns=t,r=Z(s),t=r):(Ps=t,t=n),t}())===n&&(t=function(){let e,t,r,i,s,o,a,c,l;if(e=Ps,(t=Ho())!==n)if((r=sa())!==n){if(i=Ps,(s=Ko())!==n){for(o=[],a=Ps,(c=Qo())!==n&&(l=zo())!==n?a=c=[c,l]:(Ps=a,a=n);a!==n;)o.push(a),a=Ps,(c=Qo())!==n&&(l=zo())!==n?a=c=[c,l]:(Ps=a,a=n);o!==n?i=s=[s,o]:(Ps=i,i=n)}else Ps=i,i=n;i===n&&(i=null),i!==n?(Ns=e,t=ci(t,i),e=t):(Ps=e,e=n)}else Ps=e,e=n;else Ps=e,e=n;return e}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;if(t=Ps,e.substr(Ps,5)===si?(r=si,Ps+=5):(r=n,0===Fs&&Ks(oi)),r!==n)if((i=ia())!==n)if((s=Ho())!==n)if((o=ia())!==n)if((a=function(){let t,r,i,s;return t=Ps,e.substr(Ps,2)===Kn?(r=Kn,Ps+=2):(r=n,0===Fs&&Ks(Qn)),r!==n&&(i=ia())!==n&&(s=Xo())!==n?(Ns=t,r=_t(s),t=r):(Ps=t,t=n),t}())!==n)if((c=sa())!==n){if(l=Ps,(h=Ko())!==n){for(u=[],d=Ps,(p=Qo())!==n&&(f=zo())!==n?d=p=[p,f]:(Ps=d,d=n);d!==n;)u.push(d),d=Ps,(p=Qo())!==n&&(f=zo())!==n?d=p=[p,f]:(Ps=d,d=n);u!==n?l=h=[h,u]:(Ps=l,l=n)}else Ps=l,l=n;l===n&&(l=null),l!==n?(Ns=t,r=ai(s,a,l),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,f,m,y,g,_,v,b,w,S,C,E;if(t=Ps,e.substr(Ps,5)===k?(r=k,Ps+=5):(r=n,0===Fs&&Ks(T)),r!==n)if((i=ia())!==n)if((s=Xo())!==n)if((o=ia())!==n)if(e.substr(Ps,2)===x?(a=x,Ps+=2):(a=n,0===Fs&&Ks(R)),a!==n)if((c=ia())!==n)if((l=function(){let e;return(e=Bo())===n&&(e=uo())===n&&(e=po())===n&&(e=yo()),e}())!==n)if(h=Ps,(u=ia())!==n&&(f=Yo())!==n?h=u=[u,f]:(Ps=h,h=n),h===n&&(h=null),h!==n)if(u=Ps,e.substr(Ps,2)===O?(f=O,Ps+=2):(f=n,0===Fs&&Ks(I)),f!==n&&(m=Yo())!==n?u=f=[f,m]:(Ps=u,u=n),u===n&&(u=null),u!==n)if(f=Ps,(m=ia())!==n&&(y=function(){let t,r,i,s;if(Fs++,t=Ps,64===e.charCodeAt(Ps)?(r=d,Ps++):(r=n,0===Fs&&Ks(p)),r!==n){if(i=[],Oi.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(Ii)),s!==n)for(;s!==n;)i.push(s),Oi.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(Ii));else i=n;i!==n?(Ns=t,r=Pi(i),t=r):(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(Ri)),t}())!==n?f=m=[m,y]:(Ps=f,f=n),f===n&&(f=null),f!==n)if(m=Ps,(y=ia())!==n&&(g=Do())!==n?m=y=[y,g]:(Ps=m,m=n),m===n&&(m=null),m!==n)if((y=ia())!==n)if((g=function(){let t;return(t=function(){let t,r,i,s;return t=Ps,e.substr(Ps,2)===N?(r=N,Ps+=2):(r=n,0===Fs&&Ks(A)),r!==n&&(i=ia())!==n&&(s=Yo())!==n?(Ns=t,r=D(s),t=r):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s;return t=Ps,e.substr(Ps,2)===N?(r=N,Ps+=2):(r=n,0===Fs&&Ks(A)),r!==n&&(i=ia())!==n&&(s=Xo())!==n?(Ns=t,r=M(s),t=r):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s;return t=Ps,e.substr(Ps,2)===j?(r=j,Ps+=2):(r=n,0===Fs&&Ks(F)),r!==n&&(i=ia())!==n&&(s=Yo())!==n?(Ns=t,r=L(s),t=r):(Ps=t,t=n),t}()),t}())!==n)if((_=sa())!==n){if(v=Ps,(b=Ko())!==n){if(w=[],S=Ps,(C=Qo())!==n&&(E=eo())!==n?S=C=[C,E]:(Ps=S,S=n),S!==n)for(;S!==n;)w.push(S),S=Ps,(C=Qo())!==n&&(E=eo())!==n?S=C=[C,E]:(Ps=S,S=n);else w=n;w!==n?v=b=[b,w]:(Ps=v,v=n)}else Ps=v,v=n;v===n&&(v=null),v!==n?(Ns=t,r=P(s,l,h,u,f,m,g,v),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p;if(Fs++,t=Ps,e.substr(Ps,9)===X?(r=X,Ps+=9):(r=n,0===Fs&&Ks(J)),r!==n)if((i=ia())!==n)if((s=Xo())!==n)if(o=Ps,(a=ia())===n&&(a=null),a!==n?(60===e.charCodeAt(Ps)?(c=ee,Ps++):(c=n,0===Fs&&Ks(te)),c!==n?((l=ia())===n&&(l=null),l!==n&&(h=function(){let t,r,i,s,o,a,c;if(t=Ps,(r=fo())!==n){for(i=[],s=Ps,44===e.charCodeAt(Ps)?(o=mn,Ps++):(o=n,0===Fs&&Ks(yn)),o!==n&&(a=ia())!==n&&(c=fo())!==n?s=o=[o,a,c]:(Ps=s,s=n);s!==n;)i.push(s),s=Ps,44===e.charCodeAt(Ps)?(o=mn,Ps++):(o=n,0===Fs&&Ks(yn)),o!==n&&(a=ia())!==n&&(c=fo())!==n?s=o=[o,a,c]:(Ps=s,s=n);i!==n?(Ns=t,r=Sn(r,i),t=r):(Ps=t,t=n)}else Ps=t,t=n;return t}())!==n?((u=ia())===n&&(u=null),u!==n?(62===e.charCodeAt(Ps)?(d=ne,Ps++):(d=n,0===Fs&&Ks(re)),d!==n?o=a=[a,c,l,h,u,d]:(Ps=o,o=n)):(Ps=o,o=n)):(Ps=o,o=n)):(Ps=o,o=n)):(Ps=o,o=n),o===n&&(o=null),o!==n)if((a=sa())!==n){if(c=Ps,(l=Ko())!==n){for(h=[],u=Ps,(d=Qo())!==n&&(p=to())!==n?u=d=[d,p]:(Ps=u,u=n);u!==n;)h.push(u),u=Ps,(d=Qo())!==n&&(p=to())!==n?u=d=[d,p]:(Ps=u,u=n);h!==n?c=l=[l,h]:(Ps=c,c=n)}else Ps=c,c=n;c===n&&(c=null),c!==n?((l=sa())===n&&(l=null),l!==n?(Ns=t,r=ie(s,o,c),t=r):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(Y)),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;if(t=Ps,e.substr(Ps,4)===ge?(r=ge,Ps+=4):(r=n,0===Fs&&Ks(_e)),r!==n)if((i=sa())!==n){if(s=Ps,(o=Ko())!==n){for(a=[],c=Ps,(l=Qo())!==n&&(h=no())!==n?c=l=[l,h]:(Ps=c,c=n);c!==n;)a.push(c),c=Ps,(l=Qo())!==n&&(h=no())!==n?c=l=[l,h]:(Ps=c,c=n);a!==n?s=o=[o,a]:(Ps=s,s=n)}else Ps=s,s=n;s===n&&(s=null),s!==n?((o=sa())===n&&(o=null),o!==n?(Ns=t,r=ve(s),t=r):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;return t=Ps,e.substr(Ps,8)===m?(r=m,Ps+=8):(r=n,0===Fs&&Ks(y)),r!==n&&(i=ia())!==n&&(s=Xo())!==n&&(o=sa())!==n&&(a=Ko())!==n&&(c=Qo())!==n&&(l=function(){let t,r,i;return t=Ps,e.substr(Ps,5)===_?(r=_,Ps+=5):(r=n,0===Fs&&Ks(v)),r!==n&&(i=oa())!==n?(Ns=t,r=b(),t=r):(Ps=t,t=n),t}())!==n&&(h=function(){let e,t,r,i,s;if(e=Ps,t=[],r=Ps,(i=Go())!==n&&(s=Js())!==n?r=i=[i,s]:(Ps=r,r=n),r!==n)for(;r!==n;)t.push(r),r=Ps,(i=Go())!==n&&(s=Js())!==n?r=i=[i,s]:(Ps=r,r=n);else t=n;return t!==n&&(Ns=e,t=w(t)),e=t}())!==n?((u=sa())===n&&(u=null),u!==n?(Ns=t,r=g(s,h),t=r):(Ps=t,t=n)):(Ps=t,t=n),t}()),t}function Ys(){let t,r,i,s,a,c;for(t=Ps,r=[],i=Ps,(s=Qo())!==n&&(a=Xs())!==n&&(c=sa())!==n?i=s=[s,a,c]:(Ps=i,i=n);i!==n;)r.push(i),i=Ps,(s=Qo())!==n&&(a=Xs())!==n&&(c=sa())!==n?i=s=[s,a,c]:(Ps=i,i=n);return r!==n?(i=Ps,(s=Qo())!==n&&(a=function(){let t,r,i;return Fs++,t=Ps,64===e.charCodeAt(Ps)?(r=d,Ps++):(r=n,0===Fs&&Ks(p)),r!==n&&(i=Jo())!==n?(Ns=t,r=f(i),t=r):(Ps=t,t=n),Fs--,t===n&&(r=n,0===Fs&&Ks(u)),t}())!==n&&(c=sa())!==n?i=s=[s,a,c]:(Ps=i,i=n),i===n&&(i=null),i!==n?(Ns=t,t=r=o(r,i)):(Ps=t,t=n)):(Ps=t,t=n),t}function Xs(){let t,r,i,s,o,u,d,p,f,m,y;if(Fs++,t=Ps,e.substr(Ps,8)===c?(r=c,Ps+=8):(r=n,0===Fs&&Ks(l)),r!==n)if((i=sa())!==n)if((s=Ko())!==n){if(o=[],u=Ps,(d=sa())===n&&(d=null),d!==n&&(p=Qo())!==n&&(f=ra())!==n&&(m=ia())!==n&&(y=na())!==n?u=d=[d,p,f,m,y]:(Ps=u,u=n),u!==n)for(;u!==n;)o.push(u),u=Ps,(d=sa())===n&&(d=null),d!==n&&(p=Qo())!==n&&(f=ra())!==n&&(m=ia())!==n&&(y=na())!==n?u=d=[d,p,f,m,y]:(Ps=u,u=n);else o=n;o!==n?(Ns=t,t=r=h(o)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(a)),t}function Js(){let t,r,i;for(t=Ps,r=[],S.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(C));i!==n;)r.push(i),S.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(C));return r!==n&&(i=oa())!==n?(Ns=t,t=r=E()):(Ps=t,t=n),t}function eo(){let t;return(t=function(){let t,r,i,s,o;return t=Ps,e.substr(Ps,11)===$?(r=$,Ps+=11):(r=n,0===Fs&&Ks(B)),r!==n&&(i=ia())!==n&&(s=Zo())!==n&&(o=sa())!==n?t=r=[r,i,s,o]:(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,m;if(t=Ps,e.substr(Ps,5)===U?(r=U,Ps+=5):(r=n,0===Fs&&Ks(H)),r!==n)if((i=ia())!==n)if(e.substr(Ps,2)===z?(s=z,Ps+=2):(s=n,0===Fs&&Ks(q)),s!==n)if((o=ia())!==n)if((a=Jo())!==n){for(c=[],l=Ps,(h=ia())!==n?(e.substr(Ps,3)===W?(u=W,Ps+=3):(u=n,0===Fs&&Ks(V)),u!==n&&(d=ia())!==n?(e.substr(Ps,2)===z?(p=z,Ps+=2):(p=n,0===Fs&&Ks(q)),p!==n&&(f=ia())!==n&&(m=Jo())!==n?l=h=[h,u,d,p,f,m]:(Ps=l,l=n)):(Ps=l,l=n)):(Ps=l,l=n);l!==n;)c.push(l),l=Ps,(h=ia())!==n?(e.substr(Ps,3)===W?(u=W,Ps+=3):(u=n,0===Fs&&Ks(V)),u!==n&&(d=ia())!==n?(e.substr(Ps,2)===z?(p=z,Ps+=2):(p=n,0===Fs&&Ks(q)),p!==n&&(f=ia())!==n&&(m=Jo())!==n?l=h=[h,u,d,p,f,m]:(Ps=l,l=n)):(Ps=l,l=n)):(Ps=l,l=n);c!==n&&(l=sa())!==n?(Ns=t,r=K(a,c),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}()),t}function to(){let t;return(t=function(){let t,r,i,s,o,a,c;return t=Ps,r=Ps,e.substr(Ps,4)===ce?(i=ce,Ps+=4):(i=n,0===Fs&&Ks(le)),i!==n&&(s=ia())!==n?r=i=[i,s]:(Ps=r,r=n),r===n&&(r=null),r!==n?(e.substr(Ps,7)===he?(i=he,Ps+=7):(i=n,0===Fs&&Ks(ue)),i===n&&(e.substr(Ps,7)===de?(i=de,Ps+=7):(i=n,0===Fs&&Ks(pe))),i!==n?(s=Ps,(o=ia())!==n?(e.substr(Ps,6)===fe?(a=fe,Ps+=6):(a=n,0===Fs&&Ks(me)),a!==n?s=o=[o,a]:(Ps=s,s=n)):(Ps=s,s=n),s===n&&(s=null),s!==n?(o=Ps,(a=ia())!==n&&(c=Jo())!==n?o=a=[a,c]:(Ps=o,o=n),o===n&&(o=null),o!==n&&(a=sa())!==n?(Ns=t,r=ye(r,i,s,o),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o;return t=Ps,r=Ps,(i=co())!==n&&(s=ia())!==n?r=i=[i,s]:(Ps=r,r=n),r===n&&(r=null),r!==n?(i=Ps,(s=ho())!==n&&(o=ia())!==n?i=s=[s,o]:(Ps=i,i=n),i===n&&(i=null),i!==n?((s=Jo())===n&&(42===e.charCodeAt(Ps)?(s=se,Ps++):(s=n,0===Fs&&Ks(oe))),s!==n&&(o=sa())!==n?(Ns=t,r=ae(r,i,s),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}()),t}function no(){let t;return(t=function(){let t,r,i,s,o,a,c;return t=Ps,e.substr(Ps,10)===ke?(r=ke,Ps+=10):(r=n,0===Fs&&Ks(Te)),r!==n?((i=ia())===n&&(i=null),i!==n?(58===e.charCodeAt(Ps)?(s=Se,Ps++):(s=n,0===Fs&&Ks(Ce)),s!==n?((o=ia())===n&&(o=null),o!==n&&(a=Yo())!==n&&(c=sa())!==n?(Ns=t,r=xe(a),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c;return t=Ps,e.substr(Ps,4)===be?(r=be,Ps+=4):(r=n,0===Fs&&Ks(we)),r!==n?((i=ia())===n&&(i=null),i!==n?(58===e.charCodeAt(Ps)?(s=Se,Ps++):(s=n,0===Fs&&Ks(Ce)),s!==n?((o=ia())===n&&(o=null),o!==n&&(a=Yo())!==n&&(c=sa())!==n?(Ns=t,r=Ee(a),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}()),t}function ro(){let t,r;return Fs++,(t=function(){let t,r,i,s,o;return t=Ps,e.substr(Ps,8)===Cn?(r=Cn,Ps+=8):(r=n,0===Fs&&Ks(En)),r!==n&&(i=ia())!==n&&(s=ta())!==n&&(o=sa())!==n?(Ns=t,r=kn(s),t=r):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,m;if(t=Ps,r=Ps,e.substr(Ps,4)===ce?(i=ce,Ps+=4):(i=n,0===Fs&&Ks(le)),i!==n&&(s=ia())!==n?r=i=[i,s]:(Ps=r,r=n),r===n&&(r=null),r!==n)if(e.substr(Ps,7)===he?(i=he,Ps+=7):(i=n,0===Fs&&Ks(ue)),i!==n)if((s=ia())!==n)if(o=Ps,e.substr(Ps,6)===fe?(a=fe,Ps+=6):(a=n,0===Fs&&Ks(me)),a!==n&&(c=ia())!==n?o=a=[a,c]:(Ps=o,o=n),o===n&&(o=null),o!==n)if((a=Jo())!==n)if(c=Ps,(l=ia())!==n&&(h=Do())!==n?c=l=[l,h]:(Ps=c,c=n),c===n&&(c=null),c!==n)if((l=sa())!==n){if(h=Ps,(u=Ko())!==n){for(d=[],p=Ps,(f=Qo())!==n&&(m=go())!==n?p=f=[f,m]:(Ps=p,p=n);p!==n;)d.push(p),p=Ps,(f=Qo())!==n&&(m=go())!==n?p=f=[f,m]:(Ps=p,p=n);d!==n?h=u=[u,d]:(Ps=h,h=n)}else Ps=h,h=n;h===n&&(h=null),h!==n?(Ns=t,r=Tn(r,o,a,c,h),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=bo())===n&&(t=function t(){let r,i,s,o,a,c,l,h,u;if(r=Ps,(i=function(){let t;return(t=function(){let t,r,i,s,o,a,c;return t=Ps,(r=co())!==n?(63===e.charCodeAt(Ps)?(i=mt,Ps++):(i=n,0===Fs&&Ks(yt)),i===n&&(i=null),i!==n&&(s=ia())!==n&&(o=ho())!==n&&(a=ia())!==n&&(c=function(){let e,t,r,i,s;return e=Ps,(t=Jo())!==n?(r=Ps,(i=ia())!==n&&(s=Do())!==n?r=i=[i,s]:(Ps=r,r=n),r===n&&(r=null),r!==n?(Ns=e,t=zr(t,r),e=t):(Ps=e,e=n)):(Ps=e,e=n),e===n&&(e=Ps,(t=ia())!==n&&(r=Jo())!==n?(Ns=e,t=qr(r),e=t):(Ps=e,e=n),e===n&&(e=Ps,(t=ia())!==n&&(r=Do())!==n?(Ns=e,t=Wr(r),e=t):(Ps=e,e=n))),e}())!==n?(Ns=t,r=gt(r,i,o,c),t=r):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c;return t=Ps,(r=ao())===n&&(r=null),r!==n&&(i=co())!==n?(63===e.charCodeAt(Ps)?(s=mt,Ps++):(s=n,0===Fs&&Ks(yt)),s===n&&(s=null),s!==n&&(o=ia())!==n&&(a=ho())!==n?((c=Fo())===n&&(c=null),c!==n?(Ns=t,r=vt(r,i,s,a,c),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}()),t}())!==n)if((s=sa())!==n){if(o=Ps,(a=Ko())!==n){for(c=[],l=Ps,(h=Qo())!==n&&(u=t())!==n?l=h=[h,u]:(Ps=l,l=n);l!==n;)c.push(l),l=Ps,(h=Qo())!==n&&(u=t())!==n?l=h=[h,u]:(Ps=l,l=n);c!==n?o=a=[a,c]:(Ps=o,o=n)}else Ps=o,o=n;o===n&&(o=null),o!==n?(Ns=r,i=ft(i,o),r=i):(Ps=r,r=n)}else Ps=r,r=n;else Ps=r,r=n;return r}())===n&&(t=function(){let t,r,i,s,o,a,c;return t=Ps,e.substr(Ps,5)===U?(r=U,Ps+=5):(r=n,0===Fs&&Ks(H)),r!==n&&(i=ia())!==n&&(s=Jo())!==n&&(o=ia())!==n&&(a=function(){let t,r,i,s,o,a,c,l;if(t=Ps,(r=io())!==n){for(i=[],s=Ps,(o=ia())!==n?(e.substr(Ps,3)===W?(a=W,Ps+=3):(a=n,0===Fs&&Ks(V)),a!==n&&(c=ia())!==n&&(l=io())!==n?s=o=[o,a,c,l]:(Ps=s,s=n)):(Ps=s,s=n);s!==n;)i.push(s),s=Ps,(o=ia())!==n?(e.substr(Ps,3)===W?(a=W,Ps+=3):(a=n,0===Fs&&Ks(V)),a!==n&&(c=ia())!==n&&(l=io())!==n?s=o=[o,a,c,l]:(Ps=s,s=n)):(Ps=s,s=n);i!==n?(Ns=t,r=Ae(r,i),t=r):(Ps=t,t=n)}else Ps=t,t=n;return t}())!==n&&(c=sa())!==n?(Ns=t,r=Ne(s,a),t=r):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c;return t=Ps,e.substr(Ps,5)===Be?(r=Be,Ps+=5):(r=n,0===Fs&&Ks(Ue)),r!==n&&(i=ia())!==n&&(s=function(){let t,r,i,s,o;return t=Ps,(r=Jo())!==n?(i=Ps,(s=ia())!==n?(e.substr(Ps,4)===ze?(o=ze,Ps+=4):(o=n,0===Fs&&Ks(qe)),o!==n?i=s=[s,o]:(Ps=i,i=n)):(Ps=i,i=n),i===n&&(i=null),i!==n?(Ns=t,r=We(r,i),t=r):(Ps=t,t=n)):(Ps=t,t=n),t}())!==n&&(o=ia())!==n&&(a=so())!==n&&(c=sa())!==n?(Ns=t,r=He(s,a),t=r):(Ps=t,t=n),t}()),Fs--,t===n&&(r=n,0===Fs&&Ks(Pe)),t}function io(){let t;return(t=function(){let t,r,i,s,o,a;return t=Ps,e.substr(Ps,2)===z?(r=z,Ps+=2):(r=n,0===Fs&&Ks(q)),r!==n&&(i=ia())!==n?(s=Ps,e.substr(Ps,3)===De?(o=De,Ps+=3):(o=n,0===Fs&&Ks(Me)),o!==n&&(a=ia())!==n?s=o=[o,a]:(Ps=s,s=n),s===n&&(s=null),s!==n&&(o=Jo())!==n?(Ns=t,r=je(s,o),t=r):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s;return t=Ps,e.substr(Ps,12)===Fe?(r=Fe,Ps+=12):(r=n,0===Fs&&Ks(Le)),r!==n&&(i=ia())!==n&&(s=Jo())!==n?(Ns=t,r=$e(s),t=r):(Ps=t,t=n),t}()),t}function so(){let t,r,i,s,o,a,c,l;if(t=Ps,(r=oo())!==n){for(i=[],s=Ps,(o=ia())!==n?(e.substr(Ps,2)===Ve?(a=Ve,Ps+=2):(a=n,0===Fs&&Ks(Ke)),a===n&&(e.substr(Ps,3)===W?(a=W,Ps+=3):(a=n,0===Fs&&Ks(V))),a!==n&&(c=ia())!==n&&(l=oo())!==n?s=o=[o,a,c,l]:(Ps=s,s=n)):(Ps=s,s=n);s!==n;)i.push(s),s=Ps,(o=ia())!==n?(e.substr(Ps,2)===Ve?(a=Ve,Ps+=2):(a=n,0===Fs&&Ks(Ke)),a===n&&(e.substr(Ps,3)===W?(a=W,Ps+=3):(a=n,0===Fs&&Ks(V))),a!==n&&(c=ia())!==n&&(l=oo())!==n?s=o=[o,a,c,l]:(Ps=s,s=n)):(Ps=s,s=n);i!==n?(Ns=t,t=r=Qe(r,i)):(Ps=t,t=n)}else Ps=t,t=n;return t}function oo(){let t,r,i,s,o,a;return t=Ps,(r=function(){let t;return(t=function(){let t,r,i,s,o,a,c,l,h;return t=Ps,e.substr(Ps,2)===z?(r=z,Ps+=2):(r=n,0===Fs&&Ks(q)),r!==n?(i=Ps,(s=ia())!==n?(e.substr(Ps,3)===De?(o=De,Ps+=3):(o=n,0===Fs&&Ks(Me)),o!==n?i=s=[s,o]:(Ps=i,i=n)):(Ps=i,i=n),i===n&&(i=null),i!==n&&(s=ia())!==n?(e.substr(Ps,4)===tt?(o=tt,Ps+=4):(o=n,0===Fs&&Ks(nt)),o!==n&&(a=ia())!==n?(e.substr(Ps,6)===rt?(c=rt,Ps+=6):(c=n,0===Fs&&Ks(it)),c!==n&&(l=ia())!==n&&(h=Jo())!==n?(Ns=t,r=st(i,h),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;return t=Ps,e.substr(Ps,2)===z?(r=z,Ps+=2):(r=n,0===Fs&&Ks(q)),r!==n?(i=Ps,(s=ia())!==n?(e.substr(Ps,3)===De?(o=De,Ps+=3):(o=n,0===Fs&&Ks(Me)),o!==n?i=s=[s,o]:(Ps=i,i=n)):(Ps=i,i=n),i===n&&(i=null),i!==n&&(s=ia())!==n?(e.substr(Ps,4)===tt?(o=tt,Ps+=4):(o=n,0===Fs&&Ks(nt)),o!==n&&(a=ia())!==n?(e.substr(Ps,5)===k?(c=k,Ps+=5):(c=n,0===Fs&&Ks(T)),c!==n&&(l=ia())!==n&&(h=function(){let e,t;return e=Ps,(t=Xo())!==n&&(Ns=e,t=dt(t)),(e=t)===n&&(e=Ps,(t=Yo())!==n&&(Ns=e,t=pt(t)),e=t),e}())!==n?(Ns=t,r=ut(i,h),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;return t=Ps,e.substr(Ps,2)===z?(r=z,Ps+=2):(r=n,0===Fs&&Ks(q)),r!==n?(i=Ps,(s=ia())!==n?(e.substr(Ps,3)===De?(o=De,Ps+=3):(o=n,0===Fs&&Ks(Me)),o!==n?i=s=[s,o]:(Ps=i,i=n)):(Ps=i,i=n),i===n&&(i=null),i!==n&&(s=ia())!==n?(e.substr(Ps,4)===tt?(o=tt,Ps+=4):(o=n,0===Fs&&Ks(nt)),o!==n&&(a=ia())!==n?(e.substr(Ps,6)===ot?(c=ot,Ps+=6):(c=n,0===Fs&&Ks(lt)),c!==n&&(l=ia())!==n&&(h=Jo())!==n?(Ns=t,r=ht(i,h),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o;return t=Ps,e.substr(Ps,2)===z?(r=z,Ps+=2):(r=n,0===Fs&&Ks(q)),r!==n?(i=Ps,(s=ia())!==n?(e.substr(Ps,3)===De?(o=De,Ps+=3):(o=n,0===Fs&&Ks(Me)),o!==n?i=s=[s,o]:(Ps=i,i=n)):(Ps=i,i=n),i===n&&(i=null),i!==n&&(s=ia())!==n&&(o=Jo())!==n?(Ns=t,r=et(i,o),t=r):(Ps=t,t=n)):(Ps=t,t=n),t}()),t}())!==n&&(Ns=t,r=Ge(r)),(t=r)===n&&(t=Ps,40===e.charCodeAt(Ps)?(r=Ze,Ps++):(r=n,0===Fs&&Ks(Ye)),r!==n?((i=ia())===n&&(i=null),i!==n&&(s=so())!==n?((o=ia())===n&&(o=null),o!==n?(41===e.charCodeAt(Ps)?(a=Xe,Ps++):(a=n,0===Fs&&Ks(Je)),a!==n?(Ns=t,t=r=Ge(s)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)),t}function ao(){let t,r,i,s,o,a;return t=Ps,r=Ps,Fs++,i=Ps,(s=ea())!==n?((o=ia())===n&&(o=null),o!==n?(58===e.charCodeAt(Ps)?(a=Se,Ps++):(a=n,0===Fs&&Ks(Ce)),a!==n?i=s=[s,o,a]:(Ps=i,i=n)):(Ps=i,i=n)):(Ps=i,i=n),Fs--,i!==n?(Ps=r,r=void 0):r=n,r!==n&&(i=Jo())!==n?((s=ia())===n&&(s=null),s!==n?(58===e.charCodeAt(Ps)?(o=Se,Ps++):(o=n,0===Fs&&Ks(Ce)),o!==n?((a=ia())===n&&(a=null),a!==n?(Ns=t,t=r=_t(i)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}function co(){let t,r;return Fs++,e.substr(Ps,5)===wt?(t=wt,Ps+=5):(t=n,0===Fs&&Ks(St)),t===n&&(e.substr(Ps,2)===N?(t=N,Ps+=2):(t=n,0===Fs&&Ks(A)),t===n&&(e.substr(Ps,3)===Ct?(t=Ct,Ps+=3):(t=n,0===Fs&&Ks(Et)),t===n&&(e.substr(Ps,4)===kt?(t=kt,Ps+=4):(t=n,0===Fs&&Ks(Tt)),t===n&&(e.substr(Ps,8)===xt?(t=xt,Ps+=8):(t=n,0===Fs&&Ks(Rt)),t===n&&(e.substr(Ps,8)===Ot?(t=Ot,Ps+=8):(t=n,0===Fs&&Ks(It)),t===n&&(t=Ps,e.substr(Ps,3)===Pt?(r=Pt,Ps+=3):(r=n,0===Fs&&Ks(Nt)),r!==n&&(Ns=t,r=At()),t=r)))))),Fs--,t===n&&(r=n,0===Fs&&Ks(bt)),t}function lo(){let t,r;return Fs++,e.substr(Ps,3)===Mt?(t=Mt,Ps+=3):(t=n,0===Fs&&Ks(jt)),t===n&&(e.substr(Ps,2)===Ft?(t=Ft,Ps+=2):(t=n,0===Fs&&Ks(Lt)),t===n&&(e.substr(Ps,2)===$t?(t=$t,Ps+=2):(t=n,0===Fs&&Ks(Bt)),t===n&&(61===e.charCodeAt(Ps)?(t=Ut,Ps++):(t=n,0===Fs&&Ks(Ht)),t===n&&(e.substr(Ps,7)===he?(t=he,Ps+=7):(t=n,0===Fs&&Ks(ue)),t===n&&(t=Ps,e.substr(Ps,7)===de?(r=de,Ps+=7):(r=n,0===Fs&&Ks(pe)),r!==n&&(Ns=t,r=zt()),t=r))))),Fs--,t===n&&(r=n,0===Fs&&Ks(Dt)),t}function ho(){let t;return(t=fo())===n&&(t=uo())===n&&(t=po())===n&&(t=function(){let t,r,i,s;return t=Ps,e.substr(Ps,10)===Xt?(r=Xt,Ps+=10):(r=n,0===Fs&&Ks(Jt)),r!==n&&(i=ho())!==n?(62===e.charCodeAt(Ps)?(s=ne,Ps++):(s=n,0===Fs&&Ks(re)),s!==n?(Ns=t,r=en(i),t=r):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;if(t=Ps,e.substr(Ps,4)===ln?(r=ln,Ps+=4):(r=n,0===Fs&&Ks(hn)),r!==n)if(i=Ps,Fs++,un.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(dn)),Fs--,s!==n?(Ps=i,i=void 0):i=n,i!==n){if(s=Ps,(o=ia())===n&&(o=null),o!==n)if(123===e.charCodeAt(Ps)?(a=pn,Ps++):(a=n,0===Fs&&Ks(fn)),a!==n){if(c=Ps,(l=mo())!==n){for(h=[],u=Ps,44===e.charCodeAt(Ps)?(d=mn,Ps++):(d=n,0===Fs&&Ks(yn)),d!==n&&(p=ia())!==n&&(f=mo())!==n?u=d=[d,p,f]:(Ps=u,u=n);u!==n;)h.push(u),u=Ps,44===e.charCodeAt(Ps)?(d=mn,Ps++):(d=n,0===Fs&&Ks(yn)),d!==n&&(p=ia())!==n&&(f=mo())!==n?u=d=[d,p,f]:(Ps=u,u=n);h!==n?c=l=[l,h]:(Ps=c,c=n)}else Ps=c,c=n;c===n&&(c=null),c!==n?(125===e.charCodeAt(Ps)?(l=gn,Ps++):(l=n,0===Fs&&Ks(_n)),l!==n?s=o=[o,a,c,l]:(Ps=s,s=n)):(Ps=s,s=n)}else Ps=s,s=n;else Ps=s,s=n;s===n&&(s=null),s!==n?(Ns=t,r=vn(s),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=Bo())===n&&(t=yo()),t}function uo(){let t,r,i,s;return t=Ps,91===e.charCodeAt(Ps)?(r=qt,Ps++):(r=n,0===Fs&&Ks(Wt)),r!==n&&(i=ho())!==n?(93===e.charCodeAt(Ps)?(s=Vt,Ps++):(s=n,0===Fs&&Ks(Kt)),s!==n?(Ns=t,t=r=Qt(i)):(Ps=t,t=n)):(Ps=t,t=n),t}function po(){let t,r,i,s;return t=Ps,e.substr(Ps,14)===Gt?(r=Gt,Ps+=14):(r=n,0===Fs&&Ks(Zt)),r!==n&&(i=ho())!==n?(62===e.charCodeAt(Ps)?(s=ne,Ps++):(s=n,0===Fs&&Ks(re)),s!==n?(Ns=t,t=r=Yt(i)):(Ps=t,t=n)):(Ps=t,t=n),t}function fo(){let t,r,i,s,o,a,c,l;return Fs++,t=Ps,126===e.charCodeAt(Ps)?(r=nn,Ps++):(r=n,0===Fs&&Ks(rn)),r!==n&&(i=Jo())!==n?(s=Ps,(o=ia())!==n?(e.substr(Ps,4)===sn?(a=sn,Ps+=4):(a=n,0===Fs&&Ks(on)),a!==n&&(c=ia())!==n&&(l=ho())!==n?s=o=[o,a,c,l]:(Ps=s,s=n)):(Ps=s,s=n),s===n&&(s=null),s!==n?(Ns=t,t=r=cn(i,s)):(Ps=t,t=n)):(Ps=t,t=n),Fs--,t===n&&(r=n,0===Fs&&Ks(tn)),t}function mo(){let t,r,i,s,o,a;return t=Ps,(r=ta())!==n?((i=ia())===n&&(i=null),i!==n?(58===e.charCodeAt(Ps)?(s=Se,Ps++):(s=n,0===Fs&&Ks(Ce)),s!==n?((o=ia())===n&&(o=null),o!==n&&(a=Jo())!==n?(Ns=t,t=r=bn(r,a)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}function yo(){let e,t;return e=Ps,(t=Xo())!==n&&(Ns=e,t=wn(t)),e=t}function go(){let t;return(t=_o())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,m;if(t=Ps,r=Ps,e.substr(Ps,4)===ce?(i=ce,Ps+=4):(i=n,0===Fs&&Ks(le)),i!==n&&(s=ia())!==n?r=i=[i,s]:(Ps=r,r=n),r===n&&(r=null),r!==n)if(e.substr(Ps,7)===de?(i=de,Ps+=7):(i=n,0===Fs&&Ks(pe)),i!==n)if((s=ia())!==n)if(o=Ps,e.substr(Ps,6)===fe?(a=fe,Ps+=6):(a=n,0===Fs&&Ks(me)),a!==n&&(c=ia())!==n?o=a=[a,c]:(Ps=o,o=n),o===n&&(o=null),o!==n)if((a=Jo())!==n)if(c=Ps,(l=ia())!==n&&(h=Do())!==n?c=l=[l,h]:(Ps=c,c=n),c===n&&(c=null),c!==n)if((l=sa())!==n){if(h=Ps,(u=Ko())!==n){for(d=[],p=Ps,(f=Qo())!==n&&(m=vo())!==n?p=f=[f,m]:(Ps=p,p=n);p!==n;)d.push(p),p=Ps,(f=Qo())!==n&&(m=vo())!==n?p=f=[f,m]:(Ps=p,p=n);d!==n?h=u=[u,d]:(Ps=h,h=n)}else Ps=h,h=n;h===n&&(h=null),h!==n?(Ns=t,r=Ln(r,o,a,c,h),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}()),t}function _o(){let t,r,i,s,o;return t=Ps,e.substr(Ps,10)===xn?(r=xn,Ps+=10):(r=n,0===Fs&&Ks(Rn)),r!==n&&(i=ia())!==n?(e.substr(Ps,10)===On?(s=On,Ps+=10):(s=n,0===Fs&&Ks(In)),s===n&&(e.substr(Ps,3)===Pn?(s=Pn,Ps+=3):(s=n,0===Fs&&Ks(Nn)),s===n&&(e.substr(Ps,6)===An?(s=An,Ps+=6):(s=n,0===Fs&&Ks(Dn)),s===n&&(e.substr(Ps,5)===Mn?(s=Mn,Ps+=5):(s=n,0===Fs&&Ks(jn))))),s!==n&&(o=sa())!==n?(Ns=t,t=r=Fn(s)):(Ps=t,t=n)):(Ps=t,t=n),t}function vo(){let t;return(t=_o())===n&&(t=function(){let t,r,i,s,o;return t=Ps,e.substr(Ps,6)===rt?(r=rt,Ps+=6):(r=n,0===Fs&&Ks(it)),r!==n&&(i=ia())!==n&&(s=Jo())!==n&&(o=sa())!==n?(Ns=t,r=$n(s),t=r):(Ps=t,t=n),t}()),t}function bo(){let t,r,i,s,o,a,c,l,h,u,d;if(t=Ps,e.substr(Ps,11)===$?(r=$,Ps+=11):(r=n,0===Fs&&Ks(B)),r!==n)if((i=ia())!==n)if((s=Zo())!==n)if((o=sa())!==n){if(a=Ps,(c=Ko())!==n){if(l=[],h=Ps,(u=Qo())!==n&&(d=wo())!==n?h=u=[u,d]:(Ps=h,h=n),h!==n)for(;h!==n;)l.push(h),h=Ps,(u=Qo())!==n&&(d=wo())!==n?h=u=[u,d]:(Ps=h,h=n);else l=n;l!==n?a=c=[c,l]:(Ps=a,a=n)}else Ps=a,a=n;a===n&&(a=null),a!==n?(Ns=t,t=r=Bn(s,a)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}function wo(){let e,t,r,i,s;return e=Ps,(t=Jo())!==n&&(r=ia())!==n&&(i=Zo())!==n&&(s=sa())!==n?(Ns=e,e=t=Un(t,i)):(Ps=e,e=n),e}function So(){let t;return(t=Eo())===n&&(t=function(){let e,t,r,i,s,o;return e=Ps,(t=No())!==n?(r=Ps,(i=ia())!==n&&(s=Lo())!==n?r=i=[i,s]:(Ps=r,r=n),r===n&&(r=null),r!==n?(i=Ps,(s=ia())!==n&&(o=Co())!==n?i=s=[s,o]:(Ps=i,i=n),i===n&&(i=null),i!==n&&(s=sa())!==n?(Ns=e,t=Or(t,r,i),e=t):(Ps=e,e=n)):(Ps=e,e=n)):(Ps=e,e=n),e}())===n&&(t=Ao())===n&&(t=function(){let t,r,i,s,o,a,c,l,h;if(t=Ps,e.substr(Ps,7)===Ir?(r=Ir,Ps+=7):(r=n,0===Fs&&Ks(Pr)),r!==n)if((i=sa())!==n){if(s=Ps,(o=Ko())!==n){for(a=[],c=Ps,(l=Qo())!==n?((h=Eo())===n&&(h=Ao())===n&&(h=$o()),h!==n?c=l=[l,h]:(Ps=c,c=n)):(Ps=c,c=n);c!==n;)a.push(c),c=Ps,(l=Qo())!==n?((h=Eo())===n&&(h=Ao())===n&&(h=$o()),h!==n?c=l=[l,h]:(Ps=c,c=n)):(Ps=c,c=n);a!==n?s=o=[o,a]:(Ps=s,s=n)}else Ps=s,s=n;s===n&&(s=null),s!==n?(Ns=t,r=Nr(s),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=$o())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f,m;if(t=Ps,e.substr(Ps,6)===ar?(r=ar,Ps+=6):(r=n,0===Fs&&Ks(cr)),r!==n)if((i=ia())!==n)if((s=Zo())!==n)if((o=sa())!==n){if(a=Ps,(c=Ko())!==n){if(l=Ps,(h=Qo())!==n)if(e.substr(Ps,6)===lr?(u=lr,Ps+=6):(u=n,0===Fs&&Ks(hr)),u!==n){if(d=[],p=Ps,(f=ia())!==n&&(m=Zo())!==n?p=f=[f,m]:(Ps=p,p=n),p!==n)for(;p!==n;)d.push(p),p=Ps,(f=ia())!==n&&(m=Zo())!==n?p=f=[f,m]:(Ps=p,p=n);else d=n;d!==n&&(p=sa())!==n?l=h=[h,u,d,p]:(Ps=l,l=n)}else Ps=l,l=n;else Ps=l,l=n;l!==n?a=c=[c,l]:(Ps=a,a=n)}else Ps=a,a=n;a===n&&(a=null),a!==n?(Ns=t,r=ur(s,a),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=function(){let t;return(t=function(){let t,r,i,s,o,a,c,l;return t=Ps,(r=Io())!==n?(58===e.charCodeAt(Ps)?(i=Se,Ps++):(i=n,0===Fs&&Ks(Ce)),i!==n&&(s=ia())!==n&&(o=co())!==n&&(a=ia())!==n&&(c=Io())!==n&&(l=sa())!==n?(Ns=t,r=sr(r,o,c),t=r):(Ps=t,t=n)):(Ps=t,t=n),t}())===n&&(t=function(){let e,t,r,i,s,o,a;return e=Ps,(t=Io())!==n&&(r=ia())!==n&&(i=lo())!==n&&(s=ia())!==n&&(o=Io())!==n&&(a=sa())!==n?(Ns=e,t=or(t,i,o),e=t):(Ps=e,e=n),e}()),t}())===n&&(t=bo()),t}function Co(){let t,r,i,s,o,a;if(t=Ps,e.substr(Ps,2)===Kn?(r=Kn,Ps+=2):(r=n,0===Fs&&Ks(Qn)),r!==n)if((i=ia())!==n){if((s=Jo())===n){for(s=Ps,o=[],Gn.test(e.charAt(Ps))?(a=e.charAt(Ps),Ps++):(a=n,0===Fs&&Ks(Zn));a!==n;)o.push(a),Gn.test(e.charAt(Ps))?(a=e.charAt(Ps),Ps++):(a=n,0===Fs&&Ks(Zn));o!==n&&(Ns=s,o=Yn()),s=o}s!==n?(Ns=t,t=r=_t(s)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;return t}function Eo(){let t,r,i,s,o,a,c,l,h,u;if(t=Ps,(r=function(){let e,t;return e=Ps,(t=Xo())!==n&&(Ns=e,t=Vr(t)),(e=t)===n&&(e=Ps,(t=Mo())!==n&&(Ns=e,t=Kr(t)),e=t),e}())===n&&(42===e.charCodeAt(Ps)?(r=se,Ps++):(r=n,0===Fs&&Ks(oe))),r!==n)if(i=Ps,(s=ia())!==n&&(o=Co())!==n?i=s=[s,o]:(Ps=i,i=n),i===n&&(i=null),i!==n)if((s=sa())!==n){if(o=Ps,(a=Ko())!==n){for(c=[],l=Ps,(h=Qo())!==n&&(u=ko())!==n?l=h=[h,u]:(Ps=l,l=n);l!==n;)c.push(l),l=Ps,(h=Qo())!==n&&(u=ko())!==n?l=h=[h,u]:(Ps=l,l=n);c!==n?o=a=[a,c]:(Ps=o,o=n)}else Ps=o,o=n;o===n&&(o=null),o!==n?(Ns=t,t=r=Xn(r,i,o)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}function ko(){let e;return(e=Ro())===n&&(e=To()),e}function To(){let t;return(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p;if(t=Ps,(r=Jo())===n&&(42===e.charCodeAt(Ps)?(r=se,Ps++):(r=n,0===Fs&&Ks(oe))),r!==n)if((i=ia())!==n)if((s=lo())!==n)if(o=Ps,(a=ia())!==n&&(c=xo())!==n?o=a=[a,c]:(Ps=o,o=n),o===n&&(o=null),o!==n)if((a=sa())!==n){if(c=Ps,(l=Ko())!==n){for(h=[],u=Ps,(d=Qo())!==n&&(p=To())!==n?u=d=[d,p]:(Ps=u,u=n);u!==n;)h.push(u),u=Ps,(d=Qo())!==n&&(p=To())!==n?u=d=[d,p]:(Ps=u,u=n);h!==n?c=l=[l,h]:(Ps=c,c=n)}else Ps=c,c=n;c===n&&(c=null),c!==n?(Ns=t,r=er(r,s,o,c),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u,d,p,f;if(t=Ps,(r=Jo())===n&&(42===e.charCodeAt(Ps)?(r=se,Ps++):(r=n,0===Fs&&Ks(oe))),r!==n)if(58===e.charCodeAt(Ps)?(i=Se,Ps++):(i=n,0===Fs&&Ks(Ce)),i!==n)if((s=ia())!==n)if((o=co())!==n)if(a=Ps,(c=ia())!==n&&(l=xo())!==n?a=c=[c,l]:(Ps=a,a=n),a===n&&(a=null),a!==n)if((c=sa())!==n){if(l=Ps,(h=Ko())!==n){for(u=[],d=Ps,(p=Qo())!==n&&(f=To())!==n?d=p=[p,f]:(Ps=d,d=n);d!==n;)u.push(d),d=Ps,(p=Qo())!==n&&(f=To())!==n?d=p=[p,f]:(Ps=d,d=n);u!==n?l=h=[h,u]:(Ps=l,l=n)}else Ps=l,l=n;l===n&&(l=null),l!==n?(Ns=t,r=Jn(r,o,a,l),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}()),t}function xo(){let e,t,r,i;return e=Ps,(t=Xo())===n&&(t=Jo()),t===n&&(t=null),t!==n?((r=ia())===n&&(r=null),r!==n?((i=Do())===n&&(i=null),i!==n?(Ns=e,e=t=tr(t,i)):(Ps=e,e=n)):(Ps=e,e=n)):(Ps=e,e=n),e}function Ro(){let e;return(e=function(){let e,t,r,i,s,o,a,c,l,h,u,d;if(e=Ps,(t=Oo())!==n)if((r=ia())!==n)if((i=function(){let e,t,r;return e=Ps,(t=Jo())!==n?((r=Fo())===n&&(r=null),r!==n?(Ns=e,t=ir(t,r),e=t):(Ps=e,e=n)):(Ps=e,e=n),e}())!==n)if(s=Ps,(o=ia())!==n&&(a=Co())!==n?s=o=[o,a]:(Ps=s,s=n),s===n&&(s=null),s!==n)if((o=sa())!==n){if(a=Ps,(c=Ko())!==n){for(l=[],h=Ps,(u=Qo())!==n&&(d=Ro())!==n?h=u=[u,d]:(Ps=h,h=n);h!==n;)l.push(h),h=Ps,(u=Qo())!==n&&(d=Ro())!==n?h=u=[u,d]:(Ps=h,h=n);l!==n?a=c=[c,l]:(Ps=a,a=n)}else Ps=a,a=n;a===n&&(a=null),a!==n?(Ns=e,t=nr(t,i,s,a),e=t):(Ps=e,e=n)}else Ps=e,e=n;else Ps=e,e=n;else Ps=e,e=n;else Ps=e,e=n;else Ps=e,e=n;return e}())===n&&(e=function(){let e,t,r,i,s,o,a,c,l,h,u,d;if(e=Ps,(t=ao())!==n)if((r=Oo())!==n)if(i=Ps,(s=ia())!==n&&(o=Jo())!==n?i=s=[s,o]:(Ps=i,i=n),i===n&&(i=null),i!==n)if((s=Fo())===n&&(s=null),s!==n)if((o=sa())!==n){if(a=Ps,(c=Ko())!==n){for(l=[],h=Ps,(u=Qo())!==n&&(d=Ro())!==n?h=u=[u,d]:(Ps=h,h=n);h!==n;)l.push(h),h=Ps,(u=Qo())!==n&&(d=Ro())!==n?h=u=[u,d]:(Ps=h,h=n);l!==n?a=c=[c,l]:(Ps=a,a=n)}else Ps=a,a=n;a===n&&(a=null),a!==n?(Ns=e,t=rr(t,r,i,s,a),e=t):(Ps=e,e=n)}else Ps=e,e=n;else Ps=e,e=n;else Ps=e,e=n;else Ps=e,e=n;else Ps=e,e=n;return e}()),e}function Oo(){let t;return e.substr(Ps,7)===de?(t=de,Ps+=7):(t=n,0===Fs&&Ks(pe)),t===n&&(e.substr(Ps,7)===he?(t=he,Ps+=7):(t=n,0===Fs&&Ks(ue))),t}function Io(){let e;return(e=function(){let e,t,r;return e=Ps,(t=jo())!==n?((r=Po())===n&&(r=null),r!==n?(Ns=e,t=dr(t,r),e=t):(Ps=e,e=n)):(Ps=e,e=n),e}())===n&&(e=function(){let e,t;return e=Ps,(t=Do())!==n&&(Ns=e,t=pr(t)),e=t}())===n&&(e=function(){let e,t,r;return e=Ps,(t=Xo())!==n?((r=Po())===n&&(r=null),r!==n?(Ns=e,t=mr(t,r),e=t):(Ps=e,e=n)):(Ps=e,e=n),e}())===n&&(e=function(){let e,t,r;return e=Ps,(t=Jo())!==n?((r=Po())===n&&(r=null),r!==n?(Ns=e,t=fr(t,r),e=t):(Ps=e,e=n)):(Ps=e,e=n),e}()),e}function Po(){let t,r,i,s,o,a;return t=Ps,46===e.charCodeAt(Ps)?(r=yr,Ps++):(r=n,0===Fs&&Ks(gr)),r!==n?((i=Jo())===n&&(i=null),i!==n?(s=Ps,(o=ia())===n&&(o=null),o!==n&&(a=Do())!==n?s=o=[o,a]:(Ps=s,s=n),s===n&&(s=null),s!==n?(Ns=t,t=r=_r(i,s)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}function No(){let t;return 63===e.charCodeAt(Ps)?(t=mt,Ps++):(t=n,0===Fs&&Ks(yt)),t===n&&(e.substr(Ps,3)===vr?(t=vr,Ps+=3):(t=n,0===Fs&&Ks(br)),t===n&&(e.substr(Ps,3)===wr?(t=wr,Ps+=3):(t=n,0===Fs&&Ks(Sr)),t===n&&(e.substr(Ps,6)===Cr?(t=Cr,Ps+=6):(t=n,0===Fs&&Ks(Er)),t===n&&(e.substr(Ps,4)===kr?(t=kr,Ps+=4):(t=n,0===Fs&&Ks(Tr)),t===n&&(e.substr(Ps,5)===xr?(t=xr,Ps+=5):(t=n,0===Fs&&Ks(Rr))))))),t}function Ao(){let t,r,i,s,o,a;return t=Ps,e.substr(Ps,6)===rt?(r=rt,Ps+=6):(r=n,0===Fs&&Ks(it)),r!==n?(i=Ps,(s=ia())!==n&&(o=Co())!==n?i=s=[s,o]:(Ps=i,i=n),i===n&&(i=null),i!==n?(s=Ps,(o=ia())!==n&&(a=Lo())!==n?s=o=[o,a]:(Ps=s,s=n),s===n&&(s=null),s!==n&&(o=sa())!==n?(Ns=t,t=r=Ar(i,s)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}function Do(){let t,r,i,s,o;return t=Ps,(r=function(){let t,r,i;return t=Ps,35===e.charCodeAt(Ps)?(r=Dr,Ps++):(r=n,0===Fs&&Ks(Mr)),r!==n&&(i=ra())!==n?(Ns=t,t=r=jr(i)):(Ps=t,t=n),t}())!==n?(i=Ps,(s=ia())!==n&&(o=Do())!==n?i=s=[s,o]:(Ps=i,i=n),i===n&&(i=null),i!==n?(Ns=t,t=r=Fr(r,i)):(Ps=t,t=n)):(Ps=t,t=n),t}function Mo(){let t,r,i;return Fs++,t=Ps,38===e.charCodeAt(Ps)?(r=$r,Ps++):(r=n,0===Fs&&Ks(Br)),r!==n&&(i=ra())!==n?(Ns=t,t=r=Ur(i)):(Ps=t,t=n),Fs--,t===n&&(r=n,0===Fs&&Ks(Lr)),t}function jo(){let e,t,r,i,s;return e=Ps,(t=Mo())!==n?(r=Ps,(i=ia())!==n&&(s=jo())!==n?r=i=[i,s]:(Ps=r,r=n),r===n&&(r=null),r!==n?(Ns=e,e=t=Fr(t,r)):(Ps=e,e=n)):(Ps=e,e=n),e}function Fo(){let e,t,r;return e=Ps,(t=ia())!==n&&(r=Do())!==n?(Ns=e,e=t=Hr(r)):(Ps=e,e=n),e}function Lo(){let e,t,r;return e=Ps,(t=Yo())!==n?((r=Fo())===n&&(r=null),r!==n?(Ns=e,e=t=Qr(t,r)):(Ps=e,e=n)):(Ps=e,e=n),e===n&&(e=Ps,(t=Xo())!==n?((r=Fo())===n&&(r=null),r!==n?(Ns=e,e=t=Gr(t,r)):(Ps=e,e=n)):(Ps=e,e=n),e===n&&(e=Ps,(t=Do())!==n&&(Ns=e,t=Zr(t)),e=t)),e}function $o(){let t,r,i,s,o,a;return t=Ps,e.substr(Ps,4)===Yr?(r=Yr,Ps+=4):(r=n,0===Fs&&Ks(Xr)),r!==n?(i=Ps,(s=ia())!==n&&(o=Lo())!==n?i=s=[s,o]:(Ps=i,i=n),i===n&&(i=null),i!==n?(s=Ps,(o=ia())!==n&&(a=Co())!==n?s=o=[o,a]:(Ps=s,s=n),s===n&&(s=null),s!==n&&(o=sa())!==n?(Ns=t,t=r=Jr(i,s)):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),t}function Bo(){let t,r,i,s,o,a,c,l,h,u;if(t=Ps,r=[],i=Ps,(s=Xo())===n&&(42===e.charCodeAt(Ps)?(s=se,Ps++):(s=n,0===Fs&&Ks(oe))),s!==n&&(o=ia())!==n?i=s=[s,o]:(Ps=i,i=n),i!==n)for(;i!==n;)r.push(i),i=Ps,(s=Xo())===n&&(42===e.charCodeAt(Ps)?(s=se,Ps++):(s=n,0===Fs&&Ks(oe))),s!==n&&(o=ia())!==n?i=s=[s,o]:(Ps=i,i=n);else r=n;if(r!==n)if(123===e.charCodeAt(Ps)?(i=pn,Ps++):(i=n,0===Fs&&Ks(fn)),i!==n){if(s=Ps,(o=Uo())!==n){for(a=[],c=Ps,44===e.charCodeAt(Ps)?(l=mn,Ps++):(l=n,0===Fs&&Ks(yn)),l!==n&&(h=ia())!==n&&(u=Uo())!==n?c=l=[l,h,u]:(Ps=c,c=n);c!==n;)a.push(c),c=Ps,44===e.charCodeAt(Ps)?(l=mn,Ps++):(l=n,0===Fs&&Ks(yn)),l!==n&&(h=ia())!==n&&(u=Uo())!==n?c=l=[l,h,u]:(Ps=c,c=n);a!==n?s=o=[o,a]:(Ps=s,s=n)}else Ps=s,s=n;s===n&&(s=null),s!==n?(125===e.charCodeAt(Ps)?(o=gn,Ps++):(o=n,0===Fs&&Ks(_n)),o!==n?(Ns=t,t=r=ei(r,s)):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;return t}function Uo(){let e,t,r,i;return e=Ps,t=Ps,(r=qo())!==n&&(i=ia())!==n?t=r=[r,i]:(Ps=t,t=n),t===n&&(t=null),t!==n&&(r=ta())!==n?(Ns=e,e=t=ti(t,r)):(Ps=e,e=n),e}function Ho(){let t,r,i,s,o,a;if(t=Ps,e.substr(Ps,6)===ni?(r=ni,Ps+=6):(r=n,0===Fs&&Ks(ri)),r!==n){if(i=[],s=Ps,(o=ia())!==n?(42===e.charCodeAt(Ps)?(a=se,Ps++):(a=n,0===Fs&&Ks(oe)),a===n&&(a=Xo()),a!==n?s=o=[o,a]:(Ps=s,s=n)):(Ps=s,s=n),s!==n)for(;s!==n;)i.push(s),s=Ps,(o=ia())!==n?(42===e.charCodeAt(Ps)?(a=se,Ps++):(a=n,0===Fs&&Ks(oe)),a===n&&(a=Xo()),a!==n?s=o=[o,a]:(Ps=s,s=n)):(Ps=s,s=n);else i=n;i!==n?((s=function(){let t,r,i,s,o,a,c,l,h,u,d;if(t=Ps,(r=ia())!==n)if(e.substr(Ps,7)===li?(i=li,Ps+=7):(i=n,0===Fs&&Ks(hi)),i!==n)if((s=ia())!==n)if((o=Xo())!==n){for(a=[],c=Ps,(l=ia())===n&&(l=null),l!==n?(44===e.charCodeAt(Ps)?(h=mn,Ps++):(h=n,0===Fs&&Ks(yn)),h!==n&&(u=ia())!==n&&(d=Xo())!==n?c=l=[l,h,u,d]:(Ps=c,c=n)):(Ps=c,c=n);c!==n;)a.push(c),c=Ps,(l=ia())===n&&(l=null),l!==n?(44===e.charCodeAt(Ps)?(h=mn,Ps++):(h=n,0===Fs&&Ks(yn)),h!==n&&(u=ia())!==n&&(d=Xo())!==n?c=l=[l,h,u,d]:(Ps=c,c=n)):(Ps=c,c=n);a!==n?(Ns=t,r=ui(o,a),t=r):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(s=null),s!==n?(Ns=t,t=r=ii(i,s)):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;return t}function zo(){let e;return(e=function(){let e,t,r,i,s;return e=Ps,(t=qo())!==n&&(r=ia())!==n&&(i=ta())!==n&&(s=sa())!==n?(Ns=e,t=di(t,i),e=t):(Ps=e,e=n),e}())===n&&(e=bo()),e}function qo(){let t;return(t=Wo())===n&&(t=function(){let t,r,i,s,o,a;if(t=Ps,91===e.charCodeAt(Ps)?(r=qt,Ps++):(r=n,0===Fs&&Ks(Wt)),r!==n){for(i=[],s=ia();s!==n;)i.push(s),s=ia();if(i!==n)if((s=Wo())!==n){for(o=[],a=ia();a!==n;)o.push(a),a=ia();o!==n?(93===e.charCodeAt(Ps)?(a=Vt,Ps++):(a=n,0===Fs&&Ks(Kt)),a!==n?(Ns=t,r=pi(s),t=r):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n}else Ps=t,t=n;return t}())===n&&(t=Vo())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;if(t=Ps,40===e.charCodeAt(Ps)?(r=Ze,Ps++):(r=n,0===Fs&&Ks(Ye)),r!==n)if((i=ia())===n&&(i=null),i!==n)if((s=Vo())!==n){if(o=[],a=Ps,(c=ia())!==n?(e.substr(Ps,2)===Ve?(l=Ve,Ps+=2):(l=n,0===Fs&&Ks(Ke)),l!==n&&(h=ia())!==n&&(u=Vo())!==n?a=c=[c,l,h,u]:(Ps=a,a=n)):(Ps=a,a=n),a!==n)for(;a!==n;)o.push(a),a=Ps,(c=ia())!==n?(e.substr(Ps,2)===Ve?(l=Ve,Ps+=2):(l=n,0===Fs&&Ks(Ke)),l!==n&&(h=ia())!==n&&(u=Vo())!==n?a=c=[c,l,h,u]:(Ps=a,a=n)):(Ps=a,a=n);else o=n;o!==n?((a=ia())===n&&(a=null),a!==n?(41===e.charCodeAt(Ps)?(c=Xe,Ps++):(c=n,0===Fs&&Ks(Je)),c!==n?(Ns=t,r=Ti(s,o),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}())===n&&(t=function(){let t,r,i,s,o,a,c,l,h,u;if(t=Ps,40===e.charCodeAt(Ps)?(r=Ze,Ps++):(r=n,0===Fs&&Ks(Ye)),r!==n)if((i=ia())===n&&(i=null),i!==n)if((s=Vo())!==n){for(o=[],a=Ps,(c=ia())===n&&(c=null),c!==n?(44===e.charCodeAt(Ps)?(l=mn,Ps++):(l=n,0===Fs&&Ks(yn)),l!==n?((h=ia())===n&&(h=null),h!==n&&(u=Vo())!==n?a=c=[c,l,h,u]:(Ps=a,a=n)):(Ps=a,a=n)):(Ps=a,a=n);a!==n;)o.push(a),a=Ps,(c=ia())===n&&(c=null),c!==n?(44===e.charCodeAt(Ps)?(l=mn,Ps++):(l=n,0===Fs&&Ks(yn)),l!==n?((h=ia())===n&&(h=null),h!==n&&(u=Vo())!==n?a=c=[c,l,h,u]:(Ps=a,a=n)):(Ps=a,a=n)):(Ps=a,a=n);o!==n?((a=ia())===n&&(a=null),a!==n?(41===e.charCodeAt(Ps)?(c=Xe,Ps++):(c=n,0===Fs&&Ks(Je)),c!==n?(Ns=t,r=xi(s,o),t=r):(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;else Ps=t,t=n;return t}()),t}function Wo(){let t,r,i,s,o,a;if(t=Ps,e.substr(Ps,10)===Xt?(r=Xt,Ps+=10):(r=n,0===Fs&&Ks(Jt)),r!==n){for(i=[],s=ia();s!==n;)i.push(s),s=ia();if(i!==n)if((s=Bo())===n&&(s=yo()),s!==n){for(o=[],a=ia();a!==n;)o.push(a),a=ia();o!==n?(62===e.charCodeAt(Ps)?(a=ne,Ps++):(a=n,0===Fs&&Ks(re)),a!==n?(Ns=t,t=r=fi(s)):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n}else Ps=t,t=n;return t}function Vo(){let t,r;return t=Ps,e.substr(Ps,4)===mi?(r=mi,Ps+=4):(r=n,0===Fs&&Ks(yi)),r===n&&(e.substr(Ps,3)===gi?(r=gi,Ps+=3):(r=n,0===Fs&&Ks(_i)),r===n&&(e.substr(Ps,6)===vi?(r=vi,Ps+=6):(r=n,0===Fs&&Ks(bi)),r===n&&(e.substr(Ps,7)===wi?(r=wi,Ps+=7):(r=n,0===Fs&&Ks(Si)),r===n&&(e.substr(Ps,5)===Ci?(r=Ci,Ps+=5):(r=n,0===Fs&&Ks(Ei)))))),r!==n&&(Ns=t,r=ki(r)),t=r}function Ko(){let t,r,i,s;if(Fs++,t=Ps,Fs++,r=Ps,i=[],32===e.charCodeAt(Ps)?(s=Ai,Ps++):(s=n,0===Fs&&Ks(Di)),s!==n)for(;s!==n;)i.push(s),32===e.charCodeAt(Ps)?(s=Ai,Ps++):(s=n,0===Fs&&Ks(Di));else i=n;return i!==n?(Ns=Ps,(s=(s=Mi(i))?void 0:n)!==n?r=i=[i,s]:(Ps=r,r=n)):(Ps=r,r=n),Fs--,r!==n?(Ps=t,t=void 0):t=n,Fs--,t===n&&(r=n,0===Fs&&Ks(Ni)),t}function Qo(){let t,r,i,s,o;for(Fs++,t=Ps,r=Ps,Fs++,i=Ps,s=[],32===e.charCodeAt(Ps)?(o=Ai,Ps++):(o=n,0===Fs&&Ks(Di));o!==n;)s.push(o),32===e.charCodeAt(Ps)?(o=Ai,Ps++):(o=n,0===Fs&&Ks(Di));if(s!==n?(Ns=Ps,(o=(o=Fi(s))?void 0:n)!==n?i=s=[s,o]:(Ps=i,i=n)):(Ps=i,i=n),Fs--,i!==n?(Ps=r,r=void 0):r=n,r!==n){for(i=[],32===e.charCodeAt(Ps)?(s=Ai,Ps++):(s=n,0===Fs&&Ks(Di));s!==n;)i.push(s),32===e.charCodeAt(Ps)?(s=Ai,Ps++):(s=n,0===Fs&&Ks(Di));i!==n?t=r=[r,i]:(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(ji)),t}function Go(){let t,r,i,s,o;for(Fs++,t=Ps,r=Ps,Fs++,i=Ps,s=[],32===e.charCodeAt(Ps)?(o=Ai,Ps++):(o=n,0===Fs&&Ks(Di));o!==n;)s.push(o),32===e.charCodeAt(Ps)?(o=Ai,Ps++):(o=n,0===Fs&&Ks(Di));if(s!==n?(Ns=Ps,(o=(o=$i(s))?void 0:n)!==n?i=s=[s,o]:(Ps=i,i=n)):(Ps=i,i=n),Fs--,i!==n?(Ps=r,r=void 0):r=n,r!==n){for(i=[],32===e.charCodeAt(Ps)?(s=Ai,Ps++):(s=n,0===Fs&&Ks(Di));s!==n;)i.push(s),32===e.charCodeAt(Ps)?(s=Ai,Ps++):(s=n,0===Fs&&Ks(Di));i!==n?(Ns=t,t=r=E()):(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(Li)),t}function Zo(){let t,r,i,s;if(Fs++,t=Ps,96===e.charCodeAt(Ps)?(r=Wi,Ps++):(r=n,0===Fs&&Ks(Vi)),r!==n){if(i=[],Ki.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(Qi)),s!==n)for(;s!==n;)i.push(s),Ki.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(Qi));else i=n;i!==n?(96===e.charCodeAt(Ps)?(s=Wi,Ps++):(s=n,0===Fs&&Ks(Vi)),s!==n?(Ns=t,t=r=Gi(i)):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(qi)),t}function Yo(){let t,r,i,s,o;if(Fs++,t=Ps,39===e.charCodeAt(Ps)?(r=Yi,Ps++):(r=n,0===Fs&&Ks(Xi)),r!==n){if(i=[],Ji.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(es)),s!==n)for(;s!==n;)i.push(s),Ji.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(es));else i=n;i!==n?(39===e.charCodeAt(Ps)?(s=Yi,Ps++):(s=n,0===Fs&&Ks(Xi)),s===n&&(s=Ps,e.length>Ps?(o=e.charAt(Ps),Ps++):(o=n,0===Fs&&Ks(Hi)),o!==n&&(Ns=s,o=ts(i)),s=o),s!==n?(Ns=t,t=r=ns(i)):(Ps=t,t=n)):(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(Zi)),t}function Xo(){let t,r,i,s;if(Fs++,t=Ps,is.test(e.charAt(Ps))?(r=e.charAt(Ps),Ps++):(r=n,0===Fs&&Ks(ss)),r!==n){for(i=[],os.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(as));s!==n;)i.push(s),os.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(as));i!==n?(Ns=t,t=r=E()):(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(rs)),t}function Jo(){let t,r,i;return Fs++,t=Ps,r=Ps,Fs++,i=function(){let t,r,i,s;return t=Ps,(r=lo())===n&&(r=co())===n&&(r=Oo())===n&&(r=No())===n&&(e.substr(Ps,8)===Re?(r=Re,Ps+=8):(r=n,0===Fs&&Ks(Oe)),r===n&&(e.substr(Ps,6)===zn?(r=zn,Ps+=6):(r=n,0===Fs&&Ks(Wn)),r===n&&(e.substr(Ps,6)===Q?(r=Q,Ps+=6):(r=n,0===Fs&&Ks(G)),r===n&&(e.substr(Ps,9)===X?(r=X,Ps+=9):(r=n,0===Fs&&Ks(J)),r===n&&(e.substr(Ps,6)===ni?(r=ni,Ps+=6):(r=n,0===Fs&&Ks(ri)),r===n&&(e.substr(Ps,7)===Ir?(r=Ir,Ps+=7):(r=n,0===Fs&&Ks(Pr)),r===n&&(e.substr(Ps,6)===rt?(r=rt,Ps+=6):(r=n,0===Fs&&Ks(it))))))))),r!==n?(Bi.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(Ui)),i===n&&(i=Ps,Fs++,e.length>Ps?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(Hi)),Fs--,s===n?i=void 0:(Ps=i,i=n)),i!==n?(Ns=t,t=r=zi(r)):(Ps=t,t=n)):(Ps=t,t=n),t}(),Fs--,i===n?r=void 0:(Ps=r,r=n),r!==n&&(i=ea())!==n?(Ns=t,t=r=E()):(Ps=t,t=n),Fs--,t===n&&(r=n,0===Fs&&Ks(cs)),t}function ea(){let t,r,i,s;if(Fs++,t=Ps,hs.test(e.charAt(Ps))?(r=e.charAt(Ps),Ps++):(r=n,0===Fs&&Ks(us)),r!==n){for(i=[],os.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(as));s!==n;)i.push(s),os.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(as));i!==n?(Ns=t,t=r=E()):(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(ls)),t}function ta(){let t,r,i,s;if(Fs++,t=Ps,hs.test(e.charAt(Ps))?(r=e.charAt(Ps),Ps++):(r=n,0===Fs&&Ks(us)),r!==n){for(i=[],os.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(as));s!==n;)i.push(s),os.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(as));i!==n?(Ns=t,t=r=E()):(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(ds)),t}function na(){let t,r,i,s,o,a,c;if(Fs++,t=Ps,r=Ps,(i=ra())!==n){for(s=[],o=Ps,46===e.charCodeAt(Ps)?(a=yr,Ps++):(a=n,0===Fs&&Ks(gr)),a!==n&&(c=ra())!==n?o=a=[a,c]:(Ps=o,o=n);o!==n;)s.push(o),o=Ps,46===e.charCodeAt(Ps)?(a=yr,Ps++):(a=n,0===Fs&&Ks(gr)),a!==n&&(c=ra())!==n?o=a=[a,c]:(Ps=o,o=n);s!==n?r=i=[i,s]:(Ps=r,r=n)}else Ps=r,r=n;return t=r!==n?e.substring(t,Ps):r,Fs--,t===n&&(r=n,0===Fs&&Ks(ps)),t}function ra(){let t,r,i,s;if(Fs++,t=Ps,ms.test(e.charAt(Ps))?(r=e.charAt(Ps),Ps++):(r=n,0===Fs&&Ks(ys)),r!==n){for(i=[],gs.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(_s));s!==n;)i.push(s),gs.test(e.charAt(Ps))?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(_s));i!==n?(Ns=t,t=r=vs()):(Ps=t,t=n)}else Ps=t,t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(fs)),t}function ia(){let t,r;if(Fs++,t=[],32===e.charCodeAt(Ps)?(r=Ai,Ps++):(r=n,0===Fs&&Ks(Di)),r!==n)for(;r!==n;)t.push(r),32===e.charCodeAt(Ps)?(r=Ai,Ps++):(r=n,0===Fs&&Ks(Di));else t=n;return Fs--,t===n&&(r=n,0===Fs&&Ks(bs)),t}function sa(){let t,r,i,s,o;for(Fs++,t=Ps,r=[],Ss.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(Cs));i!==n;)r.push(i),Ss.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(Cs));if(r!==n?(i=Ps,Fs++,e.length>Ps?(s=e.charAt(Ps),Ps++):(s=n,0===Fs&&Ks(Hi)),Fs--,s===n?i=void 0:(Ps=i,i=n),i!==n?t=r=[r,i]:(Ps=t,t=n)):(Ps=t,t=n),t===n){for(t=Ps,r=[],Ss.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(Cs));i!==n;)r.push(i),Ss.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(Cs));if(r!==n)if(e.substr(Ps,2)===Es?(i=Es,Ps+=2):(i=n,0===Fs&&Ks(ks)),i!==n){for(s=[],S.test(e.charAt(Ps))?(o=e.charAt(Ps),Ps++):(o=n,0===Fs&&Ks(C));o!==n;)s.push(o),S.test(e.charAt(Ps))?(o=e.charAt(Ps),Ps++):(o=n,0===Fs&&Ks(C));s!==n&&(o=sa())!==n?t=r=[r,i,s,o]:(Ps=t,t=n)}else Ps=t,t=n;else Ps=t,t=n;if(t===n){for(t=Ps,r=[],Ss.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(Cs));i!==n;)r.push(i),Ss.test(e.charAt(Ps))?(i=e.charAt(Ps),Ps++):(i=n,0===Fs&&Ks(Cs));r!==n&&(i=oa())!==n?((s=sa())===n&&(s=null),s!==n?t=r=[r,i,s]:(Ps=t,t=n)):(Ps=t,t=n)}}return Fs--,t===n&&(r=n,0===Fs&&Ks(ws)),t}function oa(){let t,r,i,s;return Fs++,t=Ps,13===e.charCodeAt(Ps)?(r=xs,Ps++):(r=n,0===Fs&&Ks(Rs)),r===n&&(r=null),r!==n?(10===e.charCodeAt(Ps)?(i=Os,Ps++):(i=n,0===Fs&&Ks(Is)),i!==n?(13===e.charCodeAt(Ps)?(s=xs,Ps++):(s=n,0===Fs&&Ks(Rs)),s===n&&(s=null),s!==n?t=r=[r,i,s]:(Ps=t,t=n)):(Ps=t,t=n)):(Ps=t,t=n),Fs--,t===n&&(r=n,0===Fs&&Ks(Ts)),t}let aa="",ca="";const la=[],ha=()=>({kind:"handle-ref",id:null,name:null,tags:[],location:$s()});function ua(e){return e[1].map(e=>e[1])}function da(e,t,n){if(null!==e){const n=t(e);if(null!==n)return n}return null===n?null:n}function pa(e){return{...e,location:$s()}}function fa(){an.usePreSlandlesSyntax||Bs("pre slandles syntax")}function ma(){an.usePreSlandlesSyntax&&Bs("post slandles syntax")}if((Ds=i())!==n&&Ps===e.length)return Ds;throw Ds!==n&&Ps<e.length&&Ks({type:"end"}),Qs(js,Ms<e.length?e.charAt(Ms):null,Ms<e.length?Vs(Ms,Ms+1):Vs(Ms,Ms))};var Vn=n(55),Kn=n.n(Vn);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
async function Qn(e){const t=Kn.a.createHash("sha1");return t.update(e),Promise.resolve().then(()=>t.digest("hex"))}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Gn{constructor(){this.storageKey=null,this.name=null}apply(e){e.forEach(e=>{this[e.key]=e.value})}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Zn{}class Yn extends Zn{constructor(e,t){super(),this.particle=e,this.connection=t}_clone(e){return new Yn(this.particle,this.connection)}_compareTo(e){let t;return 0!==(t=Ct(this.particle.name,e.particle.name))?t:0!==(t=Ct(this.connection,e.connection))?t:0}toString(e){return this.connection?`${this.particle.name}.${this.connection}`:`${this.particle.name}`}}class Xn extends Zn{constructor(e,t){super(),d()(e),this.instance=e,this.connection=t}_clone(e){return new Xn(e.get(this.instance),this.connection)}_compareTo(e){let t;return 0!==(t=Tt(this.instance,e.instance))?t:0!==(t=Ct(this.connection,e.connection))?t:0}toString(e){return this.connection?`${e.get(this.instance)}.${this.connection}`:`${e.get(this.instance)}`}}class Jn extends Zn{constructor(e){super(),this.handle=e}_clone(e){return new Jn(this.handle)}_compareTo(e){let t;return 0!==(t=Ct(this.handle.localName,e.handle.localName))?t:0}toString(e){return`${this.handle.localName}`}}class er extends Zn{constructor(e){super(),this.tags=e}_clone(e){return new er(this.tags)}_compareTo(e){let t;return 0!==(t=kt(this.tags,e.tags,Ct))?t:0}toString(e){return this.tags.map(e=>`#${e}`).join(" ")}}class tr{constructor(e,t,n,r){d()(n),d()(r),this.from=e,this.to=t,this.direction=n,this.type=r,Object.freeze(this)}_copyInto(e,t){if("constraint"===this.type){if(!(this.from instanceof Xn||this.to instanceof Xn))return e.newConnectionConstraint(this.from._clone(),this.to._clone(),this.direction);d()(!1,"Can't have connection constraints of type constraint with InstanceEndPoints")}return e.newObligation(this.from._clone(t),this.to._clone(t),this.direction)}_compareTo(e){let t;return 0!==(t=this.from._compareTo(e.from))?t:0!==(t=this.to._compareTo(e.to))?t:0!==(t=Ct(this.direction,e.direction))?t:0}toString(e,t){let n="";return t&&!0===t.showUnresolved&&"obligation"===this.type&&(n=" // unresolved obligation"),an.usePreSlandlesSyntax?`${this.from.toString(e)} ${zn(this.direction)} ${this.to.toString(e)}${n}`:`${this.from.toString(e)}: ${this.direction} ${this.to.toString(e)}${n}`}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function nr(e,t){return rr(e).includes(t)}function rr(e){switch(e){case"any":return["any","in","out","inout","host","`consume","`provide"];case"in":return["any","in","inout","host","`consume"];case"out":return["any","out","inout","`provide"];case"inout":return["any","inout"];case"host":return["any","host"];case"`consume":return["any","`consume"];case"`provide":return["any","`provide"];default:throw new Error(`Bad direction ${e}`)}}class ir{constructor(e,t,n,r){this.recipe=e,this.particles=t,this.handles=n,this.reverse=new Map;for(const e of Object.keys(t))this.reverse.set(t[e],e);for(const e of n.keys())this.reverse.set(n.get(e),e);for(const e of Object.keys(r))this.reverse.set(r[e],e)}}class sr{static makeShape(e,t,n,r){r=r||new lr;const i={},s=new Map,o={};return e.forEach(e=>i[e]=r.newParticle(e)),t.forEach(e=>s.set(e,r.newHandle())),Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(t=>{const r=n[e][t],a=r.tags||[];r.localName&&(s.get(r.handle).localName=r.localName);const c=i[e].addConnectionName(t);c.direction=r.direction||"any",s.get(r.handle).tags=a,c.connectToHandle(s.get(r.handle)),o[e+":"+t]=i[e].connections[t]})}),new ir(r,i,s,o)}static recipeToShape(e){const t={};let n=0;e.particles.forEach(e=>t[e.name]=e);const r=new Map;e.handles.forEach(e=>r.set("h"+n++,e));const i={};return e.handleConnections.forEach(e=>i[e.particle.name+":"+e.name]=e),new ir(e,t,r,i)}static _buildNewHCMatches(e,t,n,r){const{forward:i,reverse:s,score:o}=n;let a=!1;for(const n of e.particles)if(n.spec)for(const e of n.spec.handleConnections){if(s.has(e))continue;if(n.name!==t.particle.name)continue;if(t.name&&t.name!==e.name)continue;if(!nr(t.direction,e.direction))continue;const c=n.connections[e.name];if(t.handle&&c&&c.handle&&t.handle.localName&&t.handle.localName!==c.handle.localName)continue;if(s.has(n)){if(s.get(n)!==t.particle)continue}else if(i.has(t.particle))continue;if(t.handle&&c&&c.handle){if(s.has(c.handle)){if(s.get(c.handle)!==t.handle)continue}else if(i.has(t.handle)&&null!==i.get(t.handle))continue;if("create"!==t.handle.fate||"create"!==c.handle.fate&&"create"!==c.handle.originalFate){if(Boolean(t.handle.immediateValue)!==Boolean(c.handle.immediateValue))continue;if(c.handle.immediateValue){if(!c.handle.immediateValue.equals(t.handle.immediateValue))continue}else if(t.handle.id!==c.handle.id&&t.handle.id!==c.handle.originalId)continue}}const l={forward:new Map(i),reverse:new Map(s),score:o};d()(!l.reverse.has(n)||l.reverse.get(n)===t.particle),d()(!l.forward.has(t.particle)||l.forward.get(t.particle)===n),l.forward.set(t.particle,n),l.reverse.set(n,t.particle),t.handle&&(c&&c.handle?(l.forward.set(t.handle,c.handle),l.reverse.set(c.handle,t.handle)):l.forward.has(t.handle)||(l.forward.set(t.handle,null),l.score-=2)),l.forward.set(t,e),l.reverse.set(e,t),r.push(l),a=!0}if(!1===a){if(n.forward.get(t.particle))return;const i=[];sr._buildNewParticleMatches(e,t.particle,n,i),i.forEach(e=>{t.handle&&!e.forward.has(t.handle)&&(e.forward.set(t.handle,null),e.score-=2),e.forward.set(t,null),e.score-=1,r.push(e)})}}static _buildNewParticleMatches(e,t,n,r){const{forward:i,reverse:s,score:o}=n;let a=!1;for(const n of e.particles){if(s.has(n))continue;if(n.name!==t.name)continue;let e=!0;for(const r of Object.keys(n.connections)){const i=n.connections[r];if(!i.handle)continue;const s=t.connections[r];if(s&&s.handle&&s.handle.localName&&s.handle.localName!==i.handle.localName){e=!1;break}}if(!e)continue;const c={forward:new Map(i),reverse:new Map(s),score:o};d()(!c.forward.has(t)||c.forward.get(t)===n),d()(!c.reverse.has(n)||c.reverse.get(n)===t),c.forward.set(t,n),c.reverse.set(n,t),r.push(c),a=!0}if(!1===a){const e={forward:new Map,reverse:new Map,score:0};i.forEach((t,n)=>{d()(!e.forward.has(n)||e.forward.get(n)===t),e.forward.set(n,t)}),s.forEach((t,n)=>{d()(!e.reverse.has(n)||e.reverse.get(n)===t),e.reverse.set(n,t)}),e.forward.has(t)||(e.forward.set(t,null),e.score=n.score-1),r.push(e)}}static _assignHandlesToEmptyPosition(e,t,n,r){if(1===n.length){const e=[],{forward:i,reverse:s,score:o}=t;for(const t of r){let r=!0;for(const e of t.tags)if(!n[0].tags.includes(e)){r=!1;break}if(!r)continue;const a={forward:new Map(i),reverse:new Map(s),score:o+1};a.forward.set(t,n[0]),a.reverse.set(n[0],t),e.push(a)}return e}const i=n.pop(),s=sr._assignHandlesToEmptyPosition(e,t,n,r);let o=[];for(const t of s){const n=[...e.handles.values()].filter(e=>null===t.forward.get(e));o=n.length>0?o.concat(sr._assignHandlesToEmptyPosition(e,t,[i],n)):o.concat(t)}return o}static find(e,t){let n=[{forward:new Map,reverse:new Map,score:0}];for(const r of t.recipe.handleConnections){const t=[];for(const i of n)sr._buildNewHCMatches(e,r,i,t);n=t}for(const r of t.recipe.particles){if(Object.keys(r.connections).length>0)continue;if(r.unnamedConnections.length>0)continue;const t=[];for(const i of n)sr._buildNewParticleMatches(e,r,i,t);n=t}const r=e.handles.filter(e=>0===e.connections.length);if(r.length>0){let e=[];for(const i of n){const n=[...t.handles.values()].filter(e=>null===i.forward.get(e));e=n.length>0?e.concat(sr._assignHandlesToEmptyPosition(t,i,r,n)):e.concat(i)}n=e}return n.map(e=>{const n={};return e.forward.forEach((e,r)=>n[t.reverse.get(r)]=e),{match:n,score:e.score}})}static constructImmediateValueHandle(e,t,n){if(d()(e.type instanceof Ht),!(e.type instanceof Ht&&e.type.interfaceInfo.restrictType(t)))return null;const r=e.type.clone(new Map);r.maybeEnsureResolved();const i=e.recipe.newHandle();return i.id=n.toString(),i.mappedType=r,i.fate="copy",i.immediateValue=t,i}static directionCounts(e){const t={in:0,out:0,inout:0,host:0,"`consume":0,"`provide":0,any:0};for(const n of e.connections)t[n.direction]++;return t.in+=t.inout,t.out+=t.inout,t}static matchesRecipe(e,t){const n=sr.recipeToShape(t);return sr.find(e,n).some(e=>0===e.score)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class or{constructor(e,t){this._tags=[],this.resolvedType=void 0,this._direction="any",this._handle=void 0,d()(t),d()(t.recipe),this._recipe=t.recipe,this._name=e,this._particle=t}_clone(e,t){if(t.has(this))return t.get(this);const n=new or(this._name,e);return n._tags=[...this._tags],n.resolvedType=this.resolvedType,n._direction=this._direction,null!=this._handle&&(n._handle=t.get(this._handle),d()(void 0!==n._handle),n._handle.connections.push(n)),t.set(this,n),n}cloneTypeWithResolutions(e){this.resolvedType&&(this.resolvedType=this.resolvedType._cloneWithResolutions(e))}_normalize(){this._tags.sort(),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Tt(this._particle,e._particle))?t:0!==(t=Ct(this._name,e._name))?t:0!==(t=kt(this._tags,e._tags,Ct))?t:0!==(t=Tt(this._handle,e._handle))?t:0!==(t=Ct(this._direction,e._direction))?t:0}get recipe(){return this._recipe}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get tags(){return this._tags}get type(){if(this.resolvedType)return this.resolvedType;const e=this.spec;return e?e.type:void 0}get direction(){if("any"!==this._direction)return this._direction;const e=this.spec;return e?e.direction:"any"}get isInput(){return"in"===this.direction||"inout"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}get handle(){return this._handle}get particle(){return this._particle}set tags(e){this._tags=e}set type(e){this.resolvedType=e,this._resetHandleType()}set direction(e){if(null===e)throw new Error(`Invalid direction '${e}' for handle connection '${this.getQualifiedName()}'`);this._direction=e,this._resetHandleType()}get spec(){return null==this.particle.spec?null:this.particle.spec.handleConnectionMap.get(this.name)}toSlotConnection(){if(!this.handle||"`slot"!==this.handle.fate)return;const e=new ur(this.name,this.particle);return e.tags=this.tags,e.targetSlot=this.handle&&this.handle.toSlot(),e.targetSlot.name=e.targetSlot.name||this.name,this.spec&&this.spec.dependentConnections.forEach(t=>{const n=this.particle.getConnectionByName(t.name);if(!n)return;const r=n.toSlotConnection();r&&(d()(!e.providedSlots[n.spec.name],`provided slot '${n.spec.name}' already exists`),e.providedSlots[n.spec.name]=r.targetSlot)}),e}get isOptional(){return null!=this.spec&&this.spec.isOptional}_isValid(e){if(null===this.direction||void 0===this.direction)return e&&e.errors&&e.errors.set(this,`Invalid direction '${this.direction}' for handle connection '${this.getQualifiedName()}'`),!1;if(this.particle.spec&&this.name){const t=this.spec;if(!t)return e&&e.errors&&e.errors.set(this,`Connection ${this.name} is not defined by ${this.particle.name}.`),!1;if(!rr(this.direction).includes(t.direction))return e&&e.errors&&e.errors.set(this,`Direction '${this.direction}' for handle connection '${this.getQualifiedName()}' doesn't match particle spec's direction '${t.direction}'`),!1;if(this.resolvedType){if(!t.isCompatibleType(this.resolvedType))return e&&e.errors&&e.errors.set(this,`Type '${this.resolvedType.toString()} for handle connection '${this.getQualifiedName()}' doesn't match particle spec's type '${t.type.toString()}'`),!1}else this.resolvedType=t.type}return!0}isResolved(e){let t;if(d()(Object.isFrozen(this)),this.spec&&this.spec.parentConnection){if(!(t=this.particle.connections[this.spec.parentConnection.name]))return e&&(e.details=`parent connection '${this.spec.parentConnection.name}' missing`),!1;if(!t.handle)return e&&(e.details=`parent connection '${this.spec.parentConnection.name}' missing handle`),!1}return this.handle?this.direction?!!this.type||(e&&(e.details="missing type"),!1):(e&&(e.details="missing direction"),!1):!!this.isOptional||(e&&(e.details="missing handle"),!1)}_resetHandleType(){this._handle&&(this._handle._type=void 0)}connectToHandle(e){d()(e.recipe===this.recipe),this._handle=e,this._resetHandleType(),this._handle.connections.push(this)}disconnectHandle(){const e=this._handle.connections.indexOf(this);d()(e>=0),this._handle.connections.splice(e,1),this._handle=void 0}toString(e,t){const n=[];return an.usePreSlandlesSyntax?(n.push(`${this.name||"*"}`),n.push(zn(this.direction))):(n.push(`${this.name||"*"}:`),n.push(this.direction)),this.handle&&(this.handle.immediateValue?n.push(this.handle.immediateValue.name):n.push(`${e&&e.get(this.handle)||this.handle.localName}`)),n.push(...this.tags.map(e=>`#${e}`)),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved handle-connection: ${t.details}`)),n.join(" ")}findSpecsForUnnamedHandles(){return this.particle.spec.handleConnections.filter(e=>!e.isOptional&&Kt.compareTypes({type:this.handle.type},{type:e.type})&&!this.particle.getConnectionByName(e.name))}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ar{constructor(e,t){this._id=void 0,this._localName=void 0,this.spec=void 0,this._verbs=[],this._tags=[],this._connections={},this._unnamedConnections=[],this._consumedSlotConnections={},d()(e),this._recipe=e,this._name=t}_copyInto(e,t,n){const r=e.newParticle(this._name);r._id=this._id,r._verbs=[...this._verbs],r._tags=[...this._tags],r.spec=this.spec?this.spec.cloneWithResolutions(n):void 0,Object.keys(this._connections).forEach(e=>{r._connections[e]=this._connections[e]._clone(r,t)}),r._unnamedConnections=this._unnamedConnections.map(e=>e._clone(r,t)),r._cloneConnectionRawTypes(n);for(const n of this.getSlotConnectionNames()){const i=this.getSlotConnectionByName(n);if(r._consumedSlotConnections[n]=i._clone(r,t),t.has(i.targetSlot)){d()(e instanceof hr);const s=t.get(i.targetSlot);r.getSlotConnectionByName(n).connectToSlot(s),-1===r.recipe.slots.indexOf(s)&&r.recipe.slots.push(s)}for(const[s,o]of Object.entries(i.providedSlots))if(t.has(o)){d()(e instanceof hr);const i=t.get(o);i.sourceConnection=r.getSlotConnectionByName(n),r.getSlotConnectionByName(n).providedSlots[s]=i,-1===r.recipe.slots.indexOf(i)&&r.recipe.slots.push(i)}}return r}_cloneConnectionRawTypes(e){for(const t of Object.values(this._connections))t.cloneTypeWithResolutions(e);for(const t of this._unnamedConnections)t.cloneTypeWithResolutions(e)}_startNormalize(){this._localName=null,this._verbs.sort(),this._tags.sort();const e={};for(const t of Object.keys(this._connections).sort())e[t]=this._connections[t];this._connections=e;const t={};for(const e of this.getSlotConnectionNames().sort())t[e]=this.getSlotConnectionByName(e);this._consumedSlotConnections=t}_finishNormalize(){this._unnamedConnections.sort(Tt),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Ct(this._id?this._id.toString():"",e._id?e._id.toString():""))?t:0!==(t=Ct(this._name,e._name))?t:0!==(t=Ct(this._localName,e._localName))?t:0!==(t=kt(this._verbs,e._verbs,Ct))?t:0!==(t=kt(this._tags,e._tags,Ct))?t:0}matches(e){if(this.name&&e.name&&this.name!==e.name)return!1;for(const t of this.getSlotConnectionNames()){const n=this.getSlotConnectionByName(t);if(null==e.getSlotConnectionByName(t)||null==e.getSlotConnectionByName(t).targetSlot)return!1;if(n.targetSlot&&n.targetSlot.id&&n.targetSlot.id!==e.getSlotConnectionByName(t).targetSlot.id)return!1;for(const r of Object.keys(n.providedSlots)){const i=n.providedSlots[r],s=e.getSlotConnectionByName(t).providedSlots[r];if(null==s||i.id&&s.id&&i.id!==s.id)return!1}}return!0}_isValid(e){return!this.spec||(!(!this.name&&!this.primaryVerb)||(e&&e.errors&&e.errors.set(this,"Particle has no name and no verb"),!1))}isResolved(e){if(d()(Object.isFrozen(this)),!this.spec)return e&&e.showUnresolved&&(e.details="missing spec"),!1;if(0===Object.values(this.connections).filter(e=>Boolean(e.type.slandleType())).length&&this.spec.slotConnections.size>0){if(0===this.getSlotConnections().filter(e=>void 0!==e.targetSlot).length)return e&&e.showUnresolved&&(e.details=`unfulfilled slot connections ${JSON.stringify([...this.spec.slotConnections])}`),!1}if(!this.spec)return e&&e.showUnresolved&&(e.details="missing spec"),!1;const t=this.getUnboundConnections().filter(e=>{let t=e.parentConnection;for(;null!==t;){if(!this.connections[t.name])return!1;t=t.parentConnection}return!0});return t.length>0?(e&&e.showUnresolved&&(e.details=`unresolved connections: ${t.map(e=>e.name).join(", ")}`),!1):0===this.unnamedConnections.length||(e&&e.showUnresolved&&(e.details=`${this.unnamedConnections.length} unnamed connections`),!1)}get recipe(){return this._recipe}get localName(){return this._localName}set localName(e){this._localName=e}get id(){return this._id}set id(e){d()(!this._id,"Particle ID can only be set once."),this._id=e}get name(){return this._name}set name(e){this._name=e}get connections(){return this._connections}get unnamedConnections(){return this._unnamedConnections}get primaryVerb(){return this._verbs.length>0?this._verbs[0]:void 0}set verbs(e){this._verbs=e}set tags(e){this._tags=e}addUnnamedConnection(){const e=new or(void 0,this);return this._unnamedConnections.push(e),e}addConnectionName(e){return d()(e,"Cannot create connection with no name"),d()(null==this._connections[e]),this._connections[e]=new or(e,this),this._connections[e]}allConnections(){return Object.values(this._connections).concat(this._unnamedConnections)}ensureConnectionName(e){return this._connections[e]||this.addConnectionName(e)}getSlotConnectionNames(){return Object.keys(this._consumedSlotConnections)}getSlandleConnectionByName(e){if(e in this._connections){return this._connections[e].toSlotConnection()}return this._consumedSlotConnections[e]}getSlandleConnectionBySpec(e){return this.getSlandleConnections().find(t=>t.getSlotSpec()===e)}getSlotConnectionByName(e){return this._consumedSlotConnections[e]}getSlotConnectionBySpec(e){return this.getSlotConnections().find(t=>t.getSlotSpec()===e)}getSlandleConnections(){return[...Object.values(this._consumedSlotConnections),...this.allConnections().map(e=>"`consume"===e.direction&&e.toSlotConnection()).filter(e=>e)]}getSlotConnections(){return Object.values(this._consumedSlotConnections)}getSlotSpecByName(e){if(!this.spec)return;const t=this.spec.slotConnections.get(e);if(t)return t;for(const t of this.spec.slotConnections.values())for(const n of t.provideSlotConnections)if(n.name===e)return n}getProvidedSlotByName(e,t){const n=this.getSlotConnectionByName(e);return n&&n.providedSlots[t]}getSlotSpecs(){return this.spec?this.spec.slotConnections:new Map}getConnectionByName(e){return this._connections[e]}nameConnection(e,t){d()(!this._connections[t],`Connection "${t}" already has a handle`);const n=this._unnamedConnections.indexOf(e);d()(n>=0,`Cannot name '${t}' nonexistent unnamed connection.`),e._name=t;const r=this.spec.getConnectionByName(t);e.type=r.type,e.direction!==r.direction&&(d()("inout"===e.direction,`Unnamed connection cannot adjust direction ${e.direction} to ${t}'s direction ${r.direction}`),e.direction=r.direction),this._connections[t]=e,this._unnamedConnections.splice(n,1)}getUnboundConnections(e){return this.spec.handleConnections.filter(t=>!t.isOptional&&!this.getConnectionByName(t.name)&&(!e||Kt.compareTypes({type:e},{type:t.type})))}addSlotConnection(e){d()(!this.getSlotConnectionByName(e),"slot connection already exists");const t=this.spec&&this.spec.connections.find(t=>t.name===e),n=t&&t.type.isSlot(),r=t&&t.type.isCollectionType()&&t.type.getContainedType().isSlot();d()(!this.spec||this.spec.slotConnections.has(e)||n||r,`slot connection '${e}' is not in particle spec`);const i=this.addSlotConnectionAsCopy(e),s=this.getSlotSpecByName(e);return s&&s.provideSlotConnections.forEach(e=>{const t=this.recipe.newSlot(e.name);t.sourceConnection=i,i.providedSlots[e.name]=t}),i}addSlotConnectionAsCopy(e){const t=new ur(e,this);return this._consumedSlotConnections[e]=t,t}removeSlotConnection(e){this._consumedSlotConnections[e.name]=null,e.disconnectFromSlot()}remove(){this.recipe.removeParticle(this)}isJavaParticle(){return this.spec&&(this.spec.implFile||"").endsWith("java")}toString(e={},t){let n=[];this.name?(n.push(this.name),n.push(`as ${t&&t.get(this)||this.localName}`),this.primaryVerb&&this.primaryVerb!==this.name&&n.push(`// verb=${this.primaryVerb}`)):n.push(`&${this.primaryVerb}`),e.showUnresolved&&(this.isResolved(e)||n.push(`// unresolved particle: ${e.details}`)),n=[n.join(" ")];for(const r of this.unnamedConnections)n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const r of Object.values(this.connections))n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const r of this.getSlotConnections())n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));return n.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class cr{constructor(e,t){d()(e),this._phrase=e;const n=this.phrase.toLowerCase().split(/[^a-z0-9]/g);this._unresolvedTokens=[],(t||n).forEach(e=>this._unresolvedTokens.push(e)),this._resolvedTokens=n.slice();for(const e of this.unresolvedTokens){const t=this._resolvedTokens.indexOf(e);t>=0&&this._resolvedTokens.splice(t,1)}d()(n.length===this.unresolvedTokens.length+this.resolvedTokens.length)}_append(e,t,n){this._phrase.length>0&&(this._phrase=this.phrase.concat(" ")),this._phrase=this._phrase.concat(e),n.forEach(e=>this._resolvedTokens.push(e)),t.forEach(e=>this._unresolvedTokens.push(e))}get phrase(){return this._phrase}get unresolvedTokens(){return this._unresolvedTokens}get resolvedTokens(){return this._resolvedTokens}resolveToken(e){const t=this.unresolvedTokens.indexOf(e.toLowerCase());d()(t>=0,`Cannot resolved nonexistent token ${e}`),this._unresolvedTokens.splice(t,1),this._resolvedTokens.push(e.toLowerCase())}isValid(){return this._unresolvedTokens.length>0||this._resolvedTokens.length>0}isResolved(){return d()(Object.isFrozen(this)),this._resolvedTokens.length>0}_normalize(){this._unresolvedTokens.sort(),this._resolvedTokens.sort(),Object.freeze(this)}_copyInto(e){return e.search?e.search._append(this.phrase,this.unresolvedTokens,this.resolvedTokens):(e.search=new cr(this.phrase,this.unresolvedTokens),d()(e.search.resolvedTokens.length===this.resolvedTokens.length,`${e.search.resolvedTokens} is not same as ${this.resolvedTokens}`)),d()(this.resolvedTokens.every(t=>e.search.resolvedTokens.indexOf(t)>=0)&&this.unresolvedTokens.every(t=>e.search.unresolvedTokens.indexOf(t)>=0)),e.search}toString(e){const t=[];t.push(`search \`${this.phrase}\``);const n=[];return n.push("  tokens"),this.unresolvedTokens.length>0&&n.push(this.unresolvedTokens.map(e=>`\`${e}\``).join(" ")),this.resolvedTokens.length>0&&n.push(`// ${this.resolvedTokens.map(e=>`\`${e}\``).join(" ")}`),e&&e.showUnresolved&&this.unresolvedTokens.length>0&&n.push("// unresolved search tokens"),t.push(n.join(" ")),t.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class lr{constructor(e){this._requires=[],this._particles=[],this._handles=[],this._slots=[],this._localName=void 0,this.annotation=void 0,this.triggers=[],this._connectionConstraints=[],this._obligations=[],this._verbs=[],this._search=null,this._patterns=[],this._name=e}newConnectionConstraint(e,t,n){const r=new tr(e,t,n,"constraint");return this._connectionConstraints.push(r),r}newObligation(e,t,n){const r=new tr(e,t,n,"obligation");return this._obligations.push(r),r}removeObligation(e){const t=this._obligations.indexOf(e);d()(t>-1),this._obligations.splice(t,1)}removeConstraint(e){const t=this._connectionConstraints.indexOf(e);d()(t>=0),this._connectionConstraints.splice(t,1)}clearConnectionConstraints(){this._connectionConstraints.length=0}newRequireSection(){const e=new hr(this);return this._requires.push(e),e}newParticle(e){const t=new ar(this,e);return this._particles.push(t),t}removeParticle(e){const t=this._particles.indexOf(e);d()(t>-1),this._particles.splice(t,1),e.getSlotConnections().forEach(e=>e.remove())}newHandle(){const e=new pr(this);return this._handles.push(e),e}removeHandle(e){d()(0===e.connections.length);const t=this._handles.indexOf(e);d()(t>-1),this._handles.splice(t,1)}newSlot(e){const t=new dr(this,e);return this._slots.push(t),t}addSlot(e){-1===this.slots.indexOf(e)&&this.slots.push(e)}removeSlot(e){d()(0===e.consumeConnections.length);let t=this._slots.indexOf(e);d()(t>-1),this._slots.splice(t,1);for(const n of this.requires)-1!==(t=n.slots.indexOf(e))&&n.slots.splice(t,1)}isResolved(e){d()(Object.isFrozen(this),"Recipe must be normalized to be resolved.");const t=(t,n)=>(!t&&e&&e.errors&&e.errors.set(this.name,n),t);return t(0===this._obligations.length,"unresolved obligations")&&t(0===this._connectionConstraints.length,"unresolved constraints")&&t(this.requires.every(e=>e.isEmpty()),"unresolved require")&&t(null===this._search||this._search.isResolved(),"unresolved search")&&t(this._handles.every(e=>e.isResolved()),"unresolved handles")&&t(this._particles.every(t=>t.isResolved(e)),"unresolved particles")&&t(this.modality.isResolved(),"unresolved modality")&&t(this.allRequiredSlotsPresent(e),"unresolved required slot")&&t(this._slots.every(e=>e.isResolved()),"unresolved slots")&&t(this.handleConnections.every(t=>t.isResolved(e)),"unresolved handle connections")&&t(this.slotConnections.every(t=>t.isResolved(e)),"unresolved slot connections")}isCompatible(e){return this.particles.every(t=>!t.spec||t.spec.isCompatible(e))}get modality(){return de.intersection(this.particles.filter(e=>Boolean(e.spec&&e.spec.slandleConnectionNames().length>0)).map(e=>e.spec.modality))}allRequiredSlotsPresent(e){for(const t of this.particles){if(0===t.spec.slotConnections.size)continue;let n=!1,r=!1;for(const e of Object.values(t.spec.connections))e.type.slandleType()&&(r=!0);for(const[r,i]of t.spec.slotConnections){if(i.isRequired&&!t.getSlotConnectionByName(r))return e&&e.errors&&e.errors.set(r,`required slot ${r} has no matching connection`),!1;if(t.getSlotConnectionByName(r)){n=!0;for(const n of i.provideSlotConnections)if(n.isRequired&&!t.getProvidedSlotByName(r,n.name))return e&&e.errors&&e.errors.set(r,`required provided slot ${n.name} has no matching connection`),!1}}if(!r&&!n)return e&&e.errors&&e.errors.set("?","no slot connections"),!1}return!0}_findDuplicate(e,t){const n=new Set,r=e.find(e=>{if(e.id){if(n.has(e.id))return e;n.add(e.id)}});return r&&t&&t.errors&&t.errors.set(r,`Has Duplicate ${r instanceof pr?"Handle":"Slot"} '${r.id}'`),r}_isValid(e){const t=t=>t.every(t=>t._isValid(e));return!this._findDuplicate(this._handles,e)&&!this._findDuplicate(this._slots,e)&&t(this._handles)&&t(this._particles)&&t(this._slots)&&t(this.handleConnections)&&t(this.slotConnections)&&(!this.search||this.search.isValid())}get requires(){return this._requires}get name(){return this._name}set name(e){this._name=e}get localName(){return this._localName}set localName(e){this._localName=e}get particles(){return this._particles}set particles(e){this._particles=e}get handles(){return this._handles}set handles(e){this._handles=e}get slots(){return this._slots}set slots(e){this._slots=e}get connectionConstraints(){return this._connectionConstraints}get obligations(){return this._obligations}get verbs(){return this._verbs}set verbs(e){this._verbs=e}get search(){return this._search}set search(e){this._search=e}setSearchPhrase(e){d()(!this._search,"Cannot override search phrase"),e&&(this._search=new cr(e))}get slotConnections(){const e=[];return this._particles.forEach(t=>{e.push(...t.getSlotConnections())}),e}get handleConnections(){const e=[];return this._particles.forEach(t=>{e.push(...Object.values(t.connections)),e.push(...t._unnamedConnections)}),e}isEmpty(){return 0===this.particles.length&&0===this.handles.length&&0===this.slots.length&&0===this._connectionConstraints.length}findHandle(e){for(const t of this.handles)if(t.id===e)return t;return null}findSlot(e){for(const t of this.slots)if(t.id===e)return t;return null}findParticle(e){for(const t of this.particles)if(t.id.toString()===e)return t;return null}get patterns(){return this._patterns}set patterns(e){this._patterns=e}set description(e){const t=e.find(e=>"pattern"===e.name);t&&t.patterns.forEach(e=>this._patterns.push(e)),e.forEach(e=>{if("pattern"!==e.name){const t=this.handles.find(t=>t.localName===e.name);d()(t,`Cannot set description pattern for nonexistent handle ${e.name}.`),t.pattern=e.pattern}})}async digest(){return Qn(this.toString())}normalize(e){if(Object.isFrozen(this))return e&&e.errors&&e.errors.set(this,"already normalized"),!1;if(!this._isValid()){this._findDuplicate(this._handles,e),this._findDuplicate(this._slots,e);const t=t=>t.forEach(t=>!t._isValid(e));return t(this._handles),t(this._particles),t(this._slots),t(this.handleConnections),t(this.slotConnections),!1}for(const e of this._particles)e._startNormalize();for(const e of this._handles)e._startNormalize();for(const e of this._slots)e._startNormalize();const t=this.handleConnections;for(const e of t)e._normalize();t.sort(Tt);const n=this.slotConnections;for(const e of n)e._normalize();n.sort(Tt),this.search&&this.search._normalize();for(const e of this.requires)e.normalize();for(const e of this._particles)e._finishNormalize();for(const e of this._handles)e._finishNormalize();for(const e of this._slots)e._finishNormalize();const r=new Set,i=new Set,s=new Set,o=[],a=[],c=[];let l=t.filter(e=>!(e.type&&e.type instanceof Ht));l=l.concat(t.filter(e=>!!e.type&&!!(e.type instanceof Ht)));for(const e of l)i.has(e.particle)||(o.push(e.particle),i.add(e.particle)),e.handle&&!r.has(e.handle)&&(a.push(e.handle),r.add(e.handle));for(const e of n)e.targetSlot&&!s.has(e.targetSlot)&&(c.push(e.targetSlot),s.add(e.targetSlot)),Object.values(e.providedSlots).forEach(e=>{s.has(e)||(c.push(e),s.add(e))});const h=this._handles.filter(e=>!r.has(e));h.sort(Tt),a.push(...h);const u=this._particles.filter(e=>!i.has(e));u.sort(Tt),o.push(...u);const d=this._slots.filter(e=>!s.has(e));return d.sort(Tt),c.push(...d),this._particles=o,this._handles=a,this._slots=c,this._connectionConstraints.sort(Tt),this._verbs.sort(),this._patterns.sort(),Object.freeze(this._particles),Object.freeze(this._handles),Object.freeze(this._slots),Object.freeze(this._connectionConstraints),Object.freeze(this),!0}clone(e){const t=new lr(this.name);return null==e&&(e=new Map),this._copyInto(t,e),t._cloneMap=e,t}mergeInto(e){const t=new Map,n=e._handles.length,r=e._particles.length,i=e._slots.length;return this._copyInto(e,t),{handles:e._handles.slice(n),particles:e._particles.slice(r),slots:e._slots.slice(i),cloneMap:t}}_copyInto(e,t){const n=new Map,r=r=>{const i=r._copyInto(e,t,n);t.set(r,i)};e._name=this.name,e._verbs=e._verbs.concat(...this._verbs),this._handles.forEach(r),this._particles.forEach(r),this._slots.forEach(r),this._connectionConstraints.forEach(r),this._obligations.forEach(r),e.verbs=e.verbs.slice(),this.search&&this.search._copyInto(e);for(const n of this.requires){const r=e.newRequireSection();n._copyInto(r,t),r._cloneMap=t}e.patterns=e.patterns.concat(this.patterns)}updateToClone(e){const t={};return Object.keys(e).forEach(n=>t[n]=this._cloneMap.get(e[n])),t}_makeLocalNameMap(){const e=new Set([...this.particles,...this.handles,...this.slots].map(e=>e.localName));let t;const n=new Map,r=(r,i)=>{let s=r.localName;if(!s)do{s=`${i}${t++}`}while(e.has(s));n.set(r,s)};return t=0,this.particles.forEach(e=>r(e,"particle")),t=0,this.handles.forEach(e=>r(e,"handle")),t=0,this.slots.forEach(e=>r(e,"slot")),n}toString(e){const t=this._makeLocalNameMap(),n=[],r=this.verbs.length>0?` ${this.verbs.map(e=>`&${e}`).join(" ")}`:"";n.push(`recipe${this.name?` ${this.name}`:""}${r}`),e&&e.showUnresolved&&this.search&&n.push(this.search.toString(e).replace(/^|(\n)/g,"$1  "));for(const t of this._connectionConstraints){let r=t.toString().replace(/^|(\n)/g,"$1  ");e&&e.showUnresolved&&(r=r.concat(" // unresolved connection-constraint")),n.push(r)}n.push(...this.handles.map(n=>n.toString(e,t)).filter(e=>e).map(e=>e.replace(/^|(\n)/g,"$1  ")));for(const r of this.slots){const i=r.toString(e,t);i&&n.push(i.replace(/^|(\n)/g,"$1  "))}for(const r of this.requires)r.isEmpty()||n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));for(const r of this.particles)n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(e=>void 0!==e.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let e=1;e<this.patterns.length;++e)n.push(`    pattern \`${this.patterns[e]}\``);this.handles.forEach(e=>{e.pattern&&n.push(`    ${e.localName} \`${e.pattern}\``)})}if(this._obligations.length>0){n.push("  obligations");for(const e of this._obligations){const r=e.toString(t).replace(/^|(\n)/g,"$1    ");n.push(r)}}return n.join("\n")}getFreeHandles(){return this.handles.filter(e=>0===e.connections.length)}get allSpecifiedConnections(){return[].concat(...this.particles.filter(e=>e.spec&&e.spec.connections).map(e=>e.spec.connections.map(t=>({particle:e,connSpec:t}))))}getFreeConnections(e){return this.allSpecifiedConnections.filter(({particle:t,connSpec:n})=>!n.isOptional&&"descriptions"!==n.name&&"host"!==n.direction&&!t.connections[n.name]&&(!e||Kt.compareTypes({type:e},{type:n.type})))}findHandleByID(e){return this.handles.find(t=>t.id===e)}getUnnamedUntypedConnections(){return this.handleConnections.find(e=>!e.type||!e.name||e.isOptional)}getParticlesByImplFile(e){return this.particles.filter(t=>t.spec&&e.has(t.spec.implFile))}findSlotByID(e){let t=this.slots.find(t=>t.id===e);if(void 0===t)for(const n of this.requires)if(void 0!==(t=n.slots.find(t=>t.id===e)))break;return t}}class hr extends lr{constructor(e,t){super(t),this.parent=e}findSlotByID(e){let t=this.slots.find(t=>t.id===e);return void 0===t&&(t=this.parent.slots.find(t=>t.id===e)),t}toString(e={},t){null==t&&(t=this._makeLocalNameMap());const n=[];n.push("require"),e.showUnresolved&&this.search&&n.push(this.search.toString(e).replace(/^|(\n)/g,"$1  "));for(const t of this.connectionConstraints){let r=t.toString().replace(/^|(\n)/g,"$1  ");e.showUnresolved&&(r=r.concat(" // unresolved connection-constraint")),n.push(r)}n.push(...this.handles.map(n=>n.toString(e,t)).filter(e=>e).map(e=>e.replace(/^|(\n)/g,"$1  ")));for(const r of this.slots){const i=r.toString(e,t);i&&n.push(i.replace(/^|(\n)/g,"$1  "))}for(const r of this.particles)n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(e=>void 0!==e.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let e=1;e<this.patterns.length;++e)n.push(`    pattern \`${this.patterns[e]}\``);this.handles.forEach(e=>{e.pattern&&n.push(`    ${e.localName} \`${e.pattern}\``)})}if(this.obligations.length>0){n.push("  obligations");for(const e of this.obligations){const r=e.toString(t).replace(/^|(\n)/g,"$1    ");n.push(r)}}return n.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ur{constructor(e,t){this._targetSlot=void 0,this._providedSlots={},this._tags=[],d()(t),d()(t.recipe),d()(e),this._recipe=t.recipe,this._particle=t,this._name=e}remove(){this._particle.removeSlotConnection(this)}get recipe(){return this._recipe}get particle(){return this._particle}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get targetSlot(){return this._targetSlot}set targetSlot(e){this._targetSlot=e}get providedSlots(){return this._providedSlots}get tags(){return this._tags}set tags(e){this._tags=e}getSlotSpec(){return this.particle.spec&&this.particle.spec.getSlandleSpec(this.name)}connectToSlot(e){d()(e),d()(!this.targetSlot),d()(this.recipe instanceof hr||this.recipe===e.recipe,"Cannot connect to slot from different recipe"),this._targetSlot=e,e.consumeConnections.push(this)}disconnectFromSlot(){this._targetSlot&&(this._targetSlot.removeConsumeConnection(this),this._targetSlot=void 0)}_clone(e,t){if(t.has(this))return t.get(this);const n=e.addSlotConnectionAsCopy(this.name);return n.tags=this.tags,t.set(this,n),n}_normalize(){const e={};for(const t of Object.keys(this._providedSlots).sort())e[t]=this._providedSlots[t];this._providedSlots=e,Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Ct(this.name,e.name))?t:0!==(t=Tt(this._targetSlot,e._targetSlot))?t:0!==(t=Tt(this._particle,e._particle))?t:0}_isValid(e){return!this._targetSlot||!this._targetSlot.sourceConnection||this._targetSlot===this._targetSlot.sourceConnection.providedSlots[this._targetSlot.name]||(e&&e.errors&&e.errors.set(this,`Invalid target slot '${this._targetSlot.name}' for slot connection '${this.name}' of particle ${this.particle.name}`),!1)}isResolved(e){const t=t=>{e&&e.errors&&e.errors.set(this.name,t),e&&e.details&&(e.details=t)};if(d()(Object.isFrozen(this),`slot connection ${this.name} must be frozen before it is resolved`),!this.name)return t("missing name"),!1;if(!this.particle)return t("missing particle"),!1;const n=this.getSlotSpec();if(void 0===n||n.isRequired){if(!this.targetSlot)return t("missing target-slot"),!1;if(!(this.targetSlot.id||this.targetSlot.sourceConnection&&this.targetSlot.sourceConnection.isConnected()))return t("unresolved target-slot"),!1}return!this.targetSlot||(void 0===n||this.getSlotSpec().provideSlotConnections.every(e=>!e||!e.isRequired||0!==this.providedSlots[e.name].consumeConnections.length||(t("missing consuming slot"),!1)))}isConnectedToInternalSlot(){return this.targetSlot&&!!this.targetSlot.sourceConnection}isConnectedToRemoteSlot(){return this.targetSlot&&!!this.targetSlot.id}isConnected(){return this.isConnectedToInternalSlot()||this.isConnectedToRemoteSlot()}toString(e,t){const n=[];an.usePreSlandlesSyntax?(n.push("consume"),n.push(`${this.name}`),this.targetSlot&&n.push(`as ${e&&e.get(this.targetSlot)||this.targetSlot.localName}`)):(n.push(`${this.name}:`),n.push("consume"),this.targetSlot&&n.push(`${e&&e.get(this.targetSlot)||this.targetSlot.localName}`)),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved slot-connection: ${t.details}`));const r=[];return r.push(n.join(" ")),Object.keys(this.providedSlots).forEach(t=>{const n=this.providedSlots[t],i=[];if(this.getSlotSpec()){const e=this.particle.getSlotSpecByName(t);d()(e,`Cannot find providedSlotSpec for ${t}`)}an.usePreSlandlesSyntax?(i.push("  provide"),i.push(`${t}`),i.push(`as ${e&&e.get(n)||n}`)):(i.push(`  ${t}:`),i.push("provide"),i.push(`${e&&e.get(n)||n}`)),r.push(i.join(" "))}),r.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class dr{constructor(e,t){this._id=void 0,this._localName=void 0,this._tags=[],this._sourceConnection=void 0,this._formFactor=void 0,this._consumeConnections=[],d()(e),this._recipe=e,this._name=t}get recipe(){return this._recipe}get id(){return this._id}set id(e){this._id=e}get localName(){return this._localName}set localName(e){this._localName=e}get name(){return this._name}set name(e){this._name=e}get tags(){return this._tags}set tags(e){this._tags=e}get formFactor(){return this._formFactor}set formFactor(e){this._formFactor=e}get sourceConnection(){return this._sourceConnection}set sourceConnection(e){this._sourceConnection=e}get consumeConnections(){return this._consumeConnections}get spec(){return this.sourceConnection&&this.sourceConnection.getSlotSpec()?this.sourceConnection.particle.getSlotSpecByName(this.name):{isSet:!1,tags:[]}}get handles(){const e=[];if(this.sourceConnection&&this.sourceConnection.getSlotSpec())for(const t of this.sourceConnection.particle.getSlotSpecByName(this.name).handles){const n=this.sourceConnection.particle.connections[t];(n||n.handle)&&e.push(n.handle)}return e}_copyInto(e,t){let n=void 0;return t.has(this)?t.get(this):(!this.sourceConnection&&this.id&&(n=e.findSlot(this.id)),null==n&&((n=e.newSlot(this.name))._id=this.id,n._formFactor=this.formFactor,n._localName=this._localName,n._tags=[...this._tags],n._sourceConnection=t.get(this._sourceConnection),n.sourceConnection&&(n.sourceConnection.providedSlots[n.name]=n)),this._consumeConnections.forEach(e=>{const r=t.get(e);r&&r instanceof ur&&null==r.targetSlot&&r.connectToSlot(n)}),n)}_startNormalize(){this.localName=null,this._tags.sort()}_finishNormalize(){this._consumeConnections.forEach(e=>d()(Object.isFrozen(e))),this._consumeConnections.sort(Tt),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Ct(this.id,e.id))?t:0!==(t=Ct(this.localName,e.localName))?t:0!==(t=Ct(this.formFactor,e.formFactor))?t:0!==(t=kt(this._tags,e._tags,Ct))?t:0}findHandleByID(e){return this.handles.find(t=>t.id===e)}removeConsumeConnection(e){const t=this._consumeConnections.indexOf(e);d()(t>-1),this._consumeConnections.splice(t,1),0===this._consumeConnections.length&&this.remove()}remove(){this._recipe.removeSlot(this)}isResolved(e){return d()(Object.isFrozen(this)),e&&e.showUnresolved&&(e.details=[],this._sourceConnection||e.details.push("missing source-connection"),this.id||e.details.push("missing id")),Boolean(this._sourceConnection||this.id)}_isValid(e){return!0}toString(e={},t){const n=[];n.push("slot"),this.id&&n.push(`'${this.id}'`),this.tags.length>0&&n.push(this.tags.map(e=>`#${e}`).join(" ")),n.push(`as ${t&&t.get(this)||this.localName}`);const r=e.showUnresolved&&!this.isResolved(e);return r&&n.push(`// unresolved slot: ${e.details}`),this.id||r?n.join(" "):""}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class pr{constructor(e){this._id=null,this._localName=void 0,this._tags=[],this._type=void 0,this._fate=null,this._originalFate=null,this._originalId=null,this._connections=[],this._mappedType=void 0,this._storageKey=void 0,this._pattern=void 0,this._immediateValue=void 0,this.claims=void 0,d()(e),this._recipe=e}toSlot(){if(!this.type)return;if("`slot"!==this.fate)return;const e=new dr(this.recipe,this.localName);e.tags=this.tags,e.id=this.id;const t=this.type.slandleType();if(t){const n=t.getSlot();if(n&&(e.formFactor=n.formFactor,n.handle)){const t=void 0;e.sourceConnection=new ur(n.handle,t)}}return e}_copyInto(e,t,n){let r=void 0;return null!==this._id&&["map","use","copy"].includes(this.fate)&&(r=e.findHandle(this._id)),null==r&&((r=e.newHandle())._id=this._id,r._tags=[...this._tags],r._type=this._type?this._type._cloneWithResolutions(n):void 0,r._fate=this._fate,r._originalFate=this._originalFate,r._originalId=this._originalId,r._mappedType=this._mappedType,r._storageKey=this._storageKey,r._immediateValue=this._immediateValue,r._connections=[],r._pattern=this._pattern),r}mergeInto(e){for(d()(this.recipe===e.recipe,"Cannot merge handles from different recipes.");this.connections.length>0;){const[t]=this.connections;t.disconnectHandle(),t.connectToHandle(e)}e._immediateValue=this._immediateValue,e.tags=e.tags.concat(this.tags),e.recipe.removeHandle(this),e.fate=this._mergedFate([this.fate,e.fate])}_mergedFate(e){return d()(e.length>0,"Cannot merge empty fates list"),d()(!e.includes("map")&&!e.includes("copy"),"Merging map/copy not supported yet"),e.every(e=>"use"===e)?"use":"create"}_startNormalize(){this._localName=null,this._tags.sort();const e=e=>{const t=e&&"?"===this._fate,n=e.canWriteSuperset&&e.canWriteSuperset.slandleType(),r=e.canReadSubset&&e.canReadSubset.slandleType();return t&&(n||r)},t=this.type.resolvedType(),n=t&&t.isCollectionType()&&t.collectionType;(e(t)||e(n))&&(this._fate="`slot")}_finishNormalize(){for(const e of this._connections)d()(Object.isFrozen(e),`Handle connection '${e.name}' is not frozen.`);this._connections.sort(Tt),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Ct(this._id,e._id))?t:0!==(t=Ct(this._localName,e._localName))?t:0!==(t=kt(this._tags,e._tags,Ct))?t:0!==(t=Ct(this.fate,e.fate))?t:0!==(t=Ct(this._immediateValue&&this._immediateValue.toString()||"",e._immediateValue&&e._immediateValue.toString()||""))?t:0}get fate(){return this._fate||"?"}set fate(e){null==this._originalFate&&(this._originalFate=this._fate),this._fate=e}get originalFate(){return this._originalFate||"?"}get originalId(){return this._originalId}get recipe(){return this._recipe}get tags(){return this._tags}set tags(e){this._tags=e}get type(){return this._type}get id(){return this._id}set id(e){this._originalId||(this._originalId=this._id),this._id=e}mapToStorage(e){if(!e)throw new Error("Cannot map to undefined storage");this._id=e.id,this._originalId=e.originalId,this._type=void 0,this._mappedType=e.type,this._storageKey=e.storageKey,this.claims=e.claims}get localName(){return this._localName}set localName(e){this._localName=e}get connections(){return this._connections}get storageKey(){return this._storageKey}set storageKey(e){this._storageKey=e}get pattern(){return this._pattern}set pattern(e){this._pattern=e}get mappedType(){return this._mappedType}set mappedType(e){this._mappedType=e}get immediateValue(){return this._immediateValue}set immediateValue(e){this._immediateValue=e}static effectiveType(e,t){const n=new Map,r=t.filter(e=>null!=e.type).map(e=>({type:e.type._cloneWithResolutions(n),direction:e.direction}));return Kt.processTypeList(e?e._cloneWithResolutions(n):null,r)}static resolveEffectiveType(e,t){const n=t.filter(e=>null!=e.type).map(e=>({type:e.type,direction:e.direction}));return Kt.processTypeList(e,n)}_isValid(e){const t=new Set;for(const n of this._connections){if("map"===this.fate&&["out","inout"].includes(n.direction))return e&&e.errors&&e.errors.set(this,`Invalid fate '${this.fate}' for handle '${this}'; it is used for '${n.direction}' ${n.getQualifiedName()} connection`),!1;n.tags.forEach(e=>t.add(e))}this.mappedType||"`slot"!==this.fate||(this._mappedType=Lt.make(this.id,null,null));const n=pr.resolveEffectiveType(this._mappedType,this._connections);return n?(this._type=n,this._tags.forEach(e=>t.add(e)),this._tags=[...t],!0):(e&&e.errors&&e.errors.set(this,`Type validations failed for handle '${this}' with type ${this._mappedType} and fate ${this.fate}`),!1)}isResolved(e){d()(Object.isFrozen(this));let t=!0;if(this.type){let n=!0;"create"!==this.fate&&"`slot"!==this.fate||(n=!1),this.type.canEnsureResolved()||(e&&e.details.push("unresolved type (cannot ensure resolved)"),t=!1),n&&!this.type.isResolved()&&(e&&e.details.push("unresolved type"),t=!1)}else e&&e.details.push("missing type"),t=!1;switch(this.fate){case"?":e&&e.details.push("missing fate"),t=!1;break;case"copy":case"map":case"use":e&&null===this.id&&e.details.push("missing id"),t=t&&null!==this.id;break;case"`slot":case"create":break;default:throw e&&e.details.push(`invalid fate ${this.fate}`),new Error(`Unexpected fate: ${this.fate}`)}return t}toString(e={},t){if(this._immediateValue)return;const n=[];n.push(this.fate),this.id&&n.push(`'${this.id}'`),n.push(...this.tags.map(e=>`#${e}`));const r=t&&t.get(this)||this.localName;if(r&&n.push(`as ${r}`),this.type)if(n.push("//"),this.type.isResolved())n.push(this.type.resolvedType().toString({hideFields:null==e.hideFields||e.hideFields}));else if(n.push(this.type.toString()),e.showUnresolved&&this.type.canEnsureResolved()){const t=jt.fromLiteral(this.type.toLiteral());t.maybeEnsureResolved(),n.push("//"),n.push(t.resolvedType().toString({hideFields:null==e.hideFields||e.hideFields}))}if(e.showUnresolved){const e={details:[]};this.isResolved(e)||n.push(` // unresolved handle: ${e.details.join(", ")}`)}return n.join(" ")}findConnectionByDirection(e){return this._connections.find(t=>t.direction===e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class fr{}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class mr{constructor(e){this.arcId=e,this._debug=!1,d()(void 0!==e,"Arcs with storage must have ids")}set debug(e){this._debug=e}async shutdown(){}}class yr{constructor(e){Object.assign(this,e)}}class gr extends xt{constructor(e,t,n,r){super({type:e,name:t,id:n}),this.unifiedStoreType="StorageProviderBase",this.legacyListeners=new Set,this.nextCallbackId=0,this.listeners=new Map,this.referenceMode=!1,d()(n,"id must be provided when constructing StorageProviders"),d()(!e.hasUnresolvedVariable,"Storage types must be concrete"),this.version=0,this._storageKey=r}enableReferenceMode(){this.referenceMode=!0}get baseStore(){return this}get storageKey(){return this._storageKey}reportExceptionInHost(e){throw e}on(e){const t=this.nextCallbackId++;return this.listeners.set(t,e),t}off(e){this.listeners.delete(e)}legacyOn(e){this.legacyListeners.add(e)}legacyOff(e){this.legacyListeners.delete(e)}async activate(){return this}async _fire(e){const t=[...this.listeners.values()],n=[...this.legacyListeners];await 0;for(const t of n)t(e);for(const e of t)await e(null)}get apiChannelMappingId(){return this.id}dispose(){}async modelForSynchronization(){return this.toLiteral()}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class _r{constructor(e=[],t={}){this.particleDescriptions=e,this.storeDescById=t,this.seenHandles=new Set,this.seenParticles=new Set,this.excludeValues=!1}getDescription(e){if(e.patterns.length>0){let t=[];for(const n of e.patterns)t.push(this.patternToSuggestion(n,{_recipe:e}));if((t=t.filter(e=>Boolean(e))).length>0)return this._capitalizeAndPunctuate(this._joinDescriptions(t))}const t=new Set(e.particles);let n=this.particleDescriptions.filter(e=>t.has(e._particle)&&this._isSelectedDescription(e));if(n.find(e=>e._particle.spec.slotConnections.size>0)&&(n=n.filter(e=>e._particle.spec.slotConnections.size>0)),(n=n.sort(_r.sort)).length>0)return this._combineSelectedDescriptions(n)}_isSelectedDescription(e){return!!e.pattern}getHandleDescription(e){const t=this._selectHandleConnection(e)||e.connections[0];return this._formatDescription(t)}_combineSelectedDescriptions(e,t={}){const n=[];e.forEach(e=>{this.seenParticles.has(e._particle)||n.push(this.patternToSuggestion(e.pattern,e))});const r=this._joinDescriptions(n);if(r)return t.skipFormatting?r:this._capitalizeAndPunctuate(r)}_joinDescriptions(e){const t=e.filter(e=>e),n=t.length;if(n>0){const e=["",""," and ",", and "][Math.min(3,n)],r=t.pop();return`${t.join(", ")}${e}${r}`}}_joinTokens(e){return e.join("")}_capitalizeAndPunctuate(e){d()(e);const t=e.length-1;return`${e[0].toUpperCase()}${e.slice(1,t)}${e[t]}${e[t].match(/[a-z0-9()' >\]]/i)?".":""}`}patternToSuggestion(e,t){const n=this._initTokens(e,t).map(e=>this.tokenToString(e));if(0===n.filter(e=>null==e).length)return this._joinTokens(n)}_initTokens(e,t){e=e.replace(/</g,"&lt;");let n=[];for(;e.length>0;){const r=e.match(_r.tokensRegex);let i,s;r?(i=r[0],s=e.indexOf(i)):(i="",s=e.length),d()(s>=0);const o=e.substring(0,s);o.length>0&&n.push({text:o}),i.length>0&&(n=n.concat(this._initSubTokens(i,t))),e=e.substring(s+i.length)}return n}_initSubTokens(e,t){const n=e.match(_r.tokensInnerRegex),r=n[1].split("."),i=3===n.length?n[2]:void 0;if(!t._particle){const e=r.shift();if(e[0]!==e[0].toUpperCase())return console.warn(`Invalid particle name '${e}' - must start with a capital letter.`),[];const n=this.particleDescriptions.filter(n=>n._particle.name===e&&t._recipe.particles.find(e=>e===n._particle));if(0===n.length)return console.warn(`Cannot find particles with name ${e}.`),[];t=n[n.length-1]}const s=t._particle;if(0===r.length)return[{particleName:s.spec.name,particleDescription:t}];const o=s.connections[r[0]];if(o)return d()(o.handle,"Missing handle???"),[{fullName:n[0],handleName:o.name,storeId:o.handle.id,properties:r.splice(1),extra:i,_handleConn:o,value:t._connections[o.name].value}];if(2!==r.length)return 1===r.length?console.warn(`Unknown handle connection name '${r[0]}'`):console.warn(`Slot connections tokens must have exactly 2 names, found ${r.length} in '${r.join(".")}'`),[];const a=s.getSlotConnectionByName(r[0]).providedSlots[r[1]];return d()(a,`Could not find handle ${r.join(".")}`),[{fullName:n[0],consumeSlotName:r[0],provideSlotName:r[1],extra:i,_providedSlotConn:a}]}tokenToString(e){if(e.text)return e.text;if(e.particleName)return this._particleTokenToString(e);if(e.handleName)return this._handleTokenToString(e);if(e.consumeSlotName&&e.provideSlotName)return this._slotTokenToString(e);throw new Error("no handle or slot name")}_particleTokenToString(e){return this._combineSelectedDescriptions([e.particleDescription],{skipFormatting:!0})}_handleTokenToString(e){switch(e.extra){case"_type_":return e._handleConn.type.toPrettyString().toLowerCase();case"_values_":return this._formatStoreValue(e.handleName,e.value);case"_name_":return this._formatDescription(e._handleConn);default:{if(d()(!e.extra,`Unrecognized extra ${e.extra}`),e._handleConn.type instanceof Ht){if(!e.value)return;return d()(e.value.interfaceValue,`Missing interface type value for '${e._handleConn.type}'.`),fn.fromLiteral(e.value.interfaceValue).pattern}if(e.properties&&e.properties.length>0)return this._propertyTokenToString(e.handleName,e.value,e.properties);let t=this._formatDescriptionPattern(e._handleConn)||this._formatStoreDescription(e._handleConn);const n=this._formatStoreValue(e.handleName,e.value);if(!t){const t=e._handleConn.type;if(n&&!this.excludeValues&&!(t instanceof $t)&&!(t instanceof Bt))return n}return t=t||this._formatHandleType(e._handleConn),!n||this.excludeValues||this.seenHandles.has(e.storeId)?t:(this.seenHandles.add(e.storeId),this._combineDescriptionAndValue(e,t,n))}}}_combineDescriptionAndValue(e,t,n){return t===n?t:`${t} (${n})`}_slotTokenToString(e){switch(e.extra){case"_empty_":return 0===e._providedSlotConn.consumeConnections.length;default:d()(!e.extra,`Unrecognized slot extra ${e.extra}`)}const t=e._providedSlotConn.consumeConnections.map(e=>{const t=e.particle,n=this.particleDescriptions.find(e=>e._particle===t);return this.seenParticles.add(t),this.patternToSuggestion(t.spec.pattern,n)});return this._joinDescriptions(t)}_propertyTokenToString(e,t,n){if(!t)return"";d()(t.entityValue,`Cannot return property ${n.join(",")} for non EntityType.`);t.entityValue;if(t.entityValue){let r=t.entityValue;for(const e of n)r&&(r=r[e]);if(r)return this._formatEntityProperty(e,n,r)}}_formatEntityProperty(e,t,n){return n}_formatStoreValue(e,t){if(t){if(t.collectionValues)return this._formatCollection(e,t.collectionValues);if(t.bigCollectionValues)return this._formatBigCollection(e,t.bigCollectionValues);if(t.entityValue)return this._formatSingleton(e,t);throw new Error(`invalid store type for handle ${e}`)}}_formatCollection(e,t){return t[0].rawData.name?t.length>2?`${t[0].rawData.name} plus ${t.length-1} other items`:t.map(e=>e.rawData.name).join(", "):`${t.length} items`}_formatBigCollection(e,t){return`collection of items like ${t.rawData.name}`}_formatSingleton(e,t){const n=t.entityValue;if(t.valueDescription){let e,r=t.valueDescription;for(;e=r.match(/\${([a-zA-Z0-9.]+)}/);)r=r.replace(e[0],n[e[1]]);return r}if(n.name)return n.name}_formatDescription(e){return this._formatDescriptionPattern(e)||this._formatStoreDescription(e)||this._formatHandleType(e)}_formatDescriptionPattern(e){let t=e;if(!t.spec.isOutput){const n=this._selectHandleConnection(e.handle);n&&(t=n)}const n=this.particleDescriptions.find(e=>e._particle===t.particle),r=n?n._connections[t.name]:null;if(r&&r.pattern)return this.patternToSuggestion(r.pattern,n)}_formatStoreDescription(e){if(e.handle){if(!e.handle.id)return;const t=this.storeDescById[e.handle.id],n=this._formatHandleType(e);if(t&&t!==n)return t}}_formatHandleType(e){return(e.handle&&e.handle.type.isResolved()?e.handle.type:e.type).toPrettyString().toLowerCase()}_selectHandleConnection(e){const t=e.connections.filter(e=>{const t=e.spec,n=this.particleDescriptions.find(t=>t._particle===e.particle);return!!t.pattern||!!n&&!!n._connections[e.name].pattern});if(t.sort((e,t)=>{const n=e.spec.isOutput;if(n!==t.spec.isOutput)return n?-1:1;const r=this.particleDescriptions.find(t=>t._particle===e.particle);return this.particleDescriptions.find(e=>e._particle===t.particle)._rank-r._rank}),t.length>0)return t[0]}static sort(e,t){const n=[...e._particle.spec.slotConnections.values()].some(e=>hn(e));if(n!==[...t._particle.spec.slotConnections.values()].some(e=>hn(e)))return n?-1:1;if(e._rank!==t._rank)return t._rank-e._rank;let r=0,i=0;return e._particle.spec.slotConnections.forEach(e=>{e.isSet||++r}),t._particle.spec.slotConnections.forEach(e=>{e.isSet||++i}),i-r}}_r.tokensRegex=/\${[a-zA-Z0-9.]+}(?:\.[_a-zA-Z]+)?/g,_r.tokensInnerRegex=/\${([a-zA-Z0-9.]+)}(?:\.([_a-zA-Z]+))?/;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class vr{constructor(e={},t,n=[]){this.storeDescById=e,this.arcRecipes=t,this.particleDescriptions=n}static async XcreateForPlan(e){const t=await vr.initDescriptionHandles(e.particles);return new vr({},[{patterns:e.patterns,particles:e.particles}],t)}static async createForPlan(e,t){const n=t.particles,r=await vr.initDescriptionHandles(n,e),i={};for(const{id:n}of t.handles){const t=e.findStoreById(n);t&&(i[n]=e.getStoreDescription(t))}return new vr(i,[{patterns:t.patterns,particles:t.particles}],r)}static async create(e,t){const n=[].concat(...e.allDescendingArcs.map(e=>e.activeRecipe.particles)),r=await vr.initDescriptionHandles(n,e,t),i={};for(const{id:t}of e.activeRecipe.handles){const n=e.findStoreById(t);n&&(i[t]=e.getStoreDescription(n))}return new vr(i,e.recipeDeltas,r)}getArcDescription(e=_r){const t=[].concat(...this.arcRecipes.map(e=>e.patterns)),n=[].concat(...this.arcRecipes.map(e=>e.particles)),r=new e(this.particleDescriptions,this.storeDescById).getDescription({patterns:t,particles:n});if(r)return r}getRecipeSuggestion(e=_r){return new e(this.particleDescriptions,this.storeDescById).getDescription(this.arcRecipes[this.arcRecipes.length-1])}getHandleDescription(e){d()(e.connections.length>0,"handle has no connections?");const t=new _r(this.particleDescriptions,this.storeDescById);return t.excludeValues=!0,t.getHandleDescription(e)}static getAllTokens(e){const t=[],n=e.match(_r.tokensRegex);for(let e=0;e<n.length;++e)t[e]=n[e].match(_r.tokensInnerRegex)[1].split(".");return t}static async initDescriptionHandles(e,t,n){return await Promise.all(e.map(e=>vr._createParticleDescription(e,t,n)))}static async _createParticleDescription(e,t,n){let r={_particle:e,_connections:{}};n&&(r._rank=n.calcParticleRelevance(e));const i=await vr._getPatternByNameFromDescriptionHandle(e,t);(r={...r,...i}).pattern=r.pattern||e.spec.pattern;for(const n of Object.values(e.connections)){const s=e.spec.handleConnectionMap.get(n.name),o=i[n.name]||s.pattern,a=t?t.findStoreById(n.handle.id):null;r._connections[n.name]={pattern:o,_handleConn:n,value:await vr._prepareStoreValue(a)}}return r}static async _getPatternByNameFromDescriptionHandle(e,t){const n=e.connections.descriptions;if(n&&n.handle&&n.handle.id){const e=t.findStoreById(n.handle.id);if(e){const t={};for(const n of await e.toList())t[n.rawData.key]=n.rawData.value;return t}}return{}}static async _prepareStoreValue(e){if(e)if(e.type instanceof $t){const t=e,n=await t.toList();if(n&&n.length>0)return{collectionValues:n}}else if(e.type instanceof Bt){const t=e,n=await t.stream(1),{value:r,done:i}=await t.cursorNext(n);if(t.cursorClose(n),!i&&r[0].rawData.name)return{bigCollectionValues:r[0]}}else if(e.type instanceof Ft){const t=e,n=await t.get();if(n&&n.rawData)return{entityValue:n.rawData,valueDescription:e.type.entitySchema.description.value}}else if(e.type instanceof Ht){const t=e,n=await t.get();if(n)return{interfaceValue:n}}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class br{constructor(e,t,n){this._channel=e,this._id=t,this._other=n,this._onmessage=void 0}async postMessage(e){await this._channel._post(this._other,e)}set onmessage(e){this._onmessage=e}close(){this.postMessage=(async()=>{})}}class wr{constructor(e){this.data=e}}class Sr{constructor(){this.port1=new br(this,0,1),this.port2=new br(this,1,0),this._ports=[this.port1,this.port2]}async _post(e,t){if(t=JSON.parse(JSON.stringify(t)),this._ports[e]._onmessage)try{await 0,await this._ports[e]._onmessage(new wr(t))}catch(e){console.error("Exception in particle code\n",e)}}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var Cr,Er=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},kr=function(e,t){return function(n,r){t(n,r,e)}};!function(e){e[e.Mapped=0]="Mapped",e[e.LocalMapped=1]="LocalMapped",e[e.RemoteMapped=2]="RemoteMapped",e[e.Direct=3]="Direct",e[e.ObjectMap=4]="ObjectMap",e[e.List=5]="List",e[e.ByLiteral=6]="ByLiteral"}(Cr||(Cr={}));const Tr=new Map;function xr(e,t){let n=Tr.get(e);null==n&&(n=new Map,Tr.set(e,n));let r=n.get(t);return null==r&&(r=[],n.set(t,r)),r}function Rr(e,t,n){const r=Tr.get(e);if(r){const e=r.get(t);if(e){const t=e[n];if(t)return t}}throw new Error(`the target ${e}, propertyKey ${t} and parameterIndex ${n} provided did not exist`)}function Or(e,t,n,r){xr(e,t)[n]=r}function Ir(e,t,n){Or(e.constructor,t,n,{type:Cr.Direct})}function Pr(e,t,n){Or(e.constructor,t,n,{type:Cr.Mapped})}function Nr(e){return(t,n,r)=>{const i={type:Cr.ByLiteral,converter:e};Or(t.constructor,n,r,i)}}function Ar(e,t){return(n,r,i)=>{const s={type:Cr.ObjectMap,key:{type:e},value:{type:t}};Or(n.constructor,r,i,s)}}function Dr(e){return(t,n,r)=>{const i={type:Cr.List,value:{type:e}};Or(t.constructor,n,r,i)}}function Mr(e,t,n){Or(e.constructor,t,n,{type:Cr.LocalMapped})}function jr(e,t,n){Or(e.constructor,t,n,{type:Cr.RemoteMapped})}function Fr(e,t){xr(e.constructor,t)}function Lr(e,t,n){Or(e.constructor,t,n,{type:Cr.Direct,initializer:!0})}function $r(e,t,n){Rr(e.constructor,t,n).identifier=!0}function Br(e,t,n){Rr(e.constructor,t,n).ignore=!0}class Ur{constructor(e){this._prefix=e,this._nextIdentifier=0,this._idMap=new Map,this._reverseIdMap=new Map}_newIdentifier(){return this._prefix+this._nextIdentifier++}createMappingForThing(e,t){let n;return d()(!this._reverseIdMap.has(e)),n=t||(e.apiChannelMappingId?e.apiChannelMappingId:this._newIdentifier()),d()(!this._idMap.has(n),`${t?"requestedId":e.apiChannelMappingId?"apiChannelMappingId":"newIdentifier()"} ${n} already in use`),this.establishThingMapping(n,e),n}recreateMappingForThing(e){const t=[];return e.forEach(e=>{d()(this._reverseIdMap.has(e));const n=this._reverseIdMap.get(e);this.establishThingMapping(n,e),t.push(n)}),t}maybeCreateMappingForThing(e){return this.hasMappingForThing(e)?this.identifierForThing(e):this.createMappingForThing(e)}async establishThingMapping(e,t){let n;if(Array.isArray(e)||(Array.isArray(t)&&([t,n]=t),this._idMap.set(e,t)),t instanceof Promise)d()(null==n),await this.establishThingMapping(e,await t);else if(Array.isArray(e)){d()(e.length===t.length);for(let n=0;n<e.length;n++)await this.establishThingMapping(e[n],t[n])}else this._reverseIdMap.set(t,e),n&&await n()}hasMappingForThing(e){return this._reverseIdMap.has(e)}identifierForThing(e){return d()(this._reverseIdMap.has(e),`Missing thing [${e}]`),this._reverseIdMap.get(e)}thingForIdentifier(e){return d()(this._idMap.has(e),`Missing id: ${e}`),this._idMap.get(e)}}class Hr{constructor(e,t){this._port=e,this._mapper=new Ur(t),this._port.onmessage=(async e=>this._processMessage(e)),this.inspector=null,this.attachStack=!1,this.messageCount=0,this._testingHook()}_testingHook(){}close(){this._port.close()}async _processMessage(e){d()(void 0!==this["before"+e.data.messageType]);const t=this.messageCount++;this.inspector&&this.inspector.pecMessage("on"+e.data.messageType,e.data.messageBody,t,this.supportsJavaParticle()?"a":"w",this._port.pecId,e.data.stack),this["before"+e.data.messageType](e.data.messageBody)}async send(e,t){const n={messageType:e,messageBody:t,stack:this.attachStack?(new Error).stack:void 0},r=this.messageCount++;this.inspector&&this.inspector.pecMessage(e,t,r,this.supportsJavaParticle()?"a":"w",this._port.pecId||"",(new Error).stack||""),await this._port.postMessage(n)}supportsJavaParticle(){return"MessagePort"===Object.getPrototypeOf(this._port.constructor).name}}function zr(e){return e.toString().match(/.*?\(([^)]*)\)/)[1].split(",").map(e=>e.replace(/\/\*.*\*\//,"").trim()).filter(e=>e)}function qr(e,t,n){if(void 0!==e)switch(e.type){case Cr.Mapped:return n.identifierForThing(t);case Cr.LocalMapped:return n.maybeCreateMappingForThing(t);case Cr.RemoteMapped:case Cr.Direct:return t;case Cr.ObjectMap:{const r={};return t.forEach((t,i)=>r[qr(e.key,i,n)]=qr(e.value,t,n)),r}case Cr.List:return t.map(t=>qr(e.value,t,n));case Cr.ByLiteral:return t.toLiteral();default:throw new Error(`Can't yet send MappingType ${e.type}`)}}function Wr(e,t,n){if(void 0!==e)switch(e.type){case Cr.Mapped:return n.thingForIdentifier(t);case Cr.LocalMapped:return t;case Cr.RemoteMapped:return n.thingForIdentifier(t);case Cr.Direct:return t;case Cr.ObjectMap:{const r=new Map;for(const i of Object.keys(t))r.set(Wr(e.key,i,n),Wr(e.value,t[i],n));return r}case Cr.List:return t.map(t=>Wr(e.value,t,n));case Cr.ByLiteral:if(!e.converter)throw new Error(`Expected ${e.type} to have a converter but it doesn't`);return e.converter.fromLiteral(t);default:throw new Error(`Can't yet recieve MappingType ${e.type}`)}}class Vr extends Hr{constructor(e,t){super(e,"o"),this.inspector=t.inspector,this.inspector&&this.inspector.onceActive.then(()=>this.DevToolsConnected(),e=>console.error(e))}async _processMessage(e){!function e(t){for(const n of Object.getOwnPropertyNames(t)){const r=t[n];r&&"object"==typeof r&&e(r)}Object.freeze(t)}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(e.data),await super._processMessage(e)}Stop(){}DefineHandle(e,t,n){}InstantiateParticle(e,t,n,r){}ReinstantiateParticle(e,t,n){}ReloadParticles(e,t){}UIEvent(e,t,n){}SimpleCallback(e,t){}AwaitIdle(e){}StartRender(e,t,n,r){}StopRender(e,t){}GetBackingStoreCallback(e,t,n,r,i,s){}ConstructArcCallback(e,t){}CreateHandleCallback(e,t,n,r,i){}MapHandleCallback(e,t,n){}CreateSlotCallback(e,t,n){}InnerArcRender(e,t,n,r){}DevToolsConnected(){}}Er([Fr],Vr.prototype,"Stop",null),Er([kr(0,function(e,t,n){Or(e.constructor,t,n,{type:Cr.Direct,initializer:!0,redundant:!0})}),kr(1,Nr(jt)),kr(2,Ir)],Vr.prototype,"DefineHandle",null),Er([kr(0,Lr),kr(1,$r),kr(1,Ir),kr(2,Nr(fn)),kr(3,Ar(Cr.Direct,Cr.Mapped))],Vr.prototype,"InstantiateParticle",null),Er([kr(0,$r),kr(0,Ir),kr(1,Nr(fn)),kr(2,Ar(Cr.Direct,Cr.Mapped))],Vr.prototype,"ReinstantiateParticle",null),Er([kr(0,function(e,t,n){Or(e.constructor,t,n,{type:Cr.Direct,initializer:!0,overriding:!0})}),kr(1,Dr(Cr.Direct))],Vr.prototype,"ReloadParticles",null),Er([kr(0,Pr),kr(1,Ir),kr(2,Ir)],Vr.prototype,"UIEvent",null),Er([kr(0,jr),kr(1,Ir)],Vr.prototype,"SimpleCallback",null),Er([kr(0,Ir)],Vr.prototype,"AwaitIdle",null),Er([kr(0,Pr),kr(1,Ir),kr(2,Ar(Cr.Direct,Cr.Direct)),kr(3,Dr(Cr.Direct))],Vr.prototype,"StartRender",null),Er([kr(0,Pr),kr(1,Ir)],Vr.prototype,"StopRender",null),Er([kr(0,Lr),kr(1,jr),kr(2,Nr(jt)),kr(3,Ir),kr(4,$r),kr(4,Ir),kr(5,Ir)],Vr.prototype,"GetBackingStoreCallback",null),Er([kr(0,jr),kr(1,Mr)],Vr.prototype,"ConstructArcCallback",null),Er([kr(0,Lr),kr(1,jr),kr(2,Nr(jt)),kr(3,Ir),kr(4,$r),kr(4,Ir)],Vr.prototype,"CreateHandleCallback",null),Er([kr(0,Br),kr(0,Lr),kr(1,jr),kr(2,Ir)],Vr.prototype,"MapHandleCallback",null),Er([kr(0,Br),kr(0,Lr),kr(1,jr),kr(2,Ir)],Vr.prototype,"CreateSlotCallback",null),Er([kr(0,Pr),kr(1,Ir),kr(2,Ir),kr(3,Ir)],Vr.prototype,"InnerArcRender",null),Er([Fr],Vr.prototype,"DevToolsConnected",null);let Kr=class extends Hr{constructor(e){super(e,"i")}Render(e,t,n){}Output(e,t){}InitializeProxy(e,t){}SynchronizeProxy(e,t){}HandleGet(e,t){}HandleToList(e,t){}HandleSet(e,t,n,r){}HandleClear(e,t,n){}HandleStore(e,t,n,r){}HandleRemove(e,t,n,r){}HandleRemoveMultiple(e,t,n,r){}HandleStream(e,t,n,r){}StreamCursorNext(e,t,n){}StreamCursorClose(e,t){}Register(e,t,n){}ProxyMessage(e,t,n){}Idle(e,t){}GetBackingStore(e,t,n){}ConstructInnerArc(e,t){}ArcCreateHandle(e,t,n,r){}ArcMapHandle(e,t,n){}ServiceRequest(e,t,n){}ArcCreateSlot(e,t,n,r,i){}ArcLoadRecipe(e,t,n){}ReportExceptionInHost(e){}onDevToolsConnected(){this.attachStack=!0}};var Qr,Gr;Er([kr(0,Pr),kr(1,Ir),kr(2,Ir)],Kr.prototype,"Render",null),Er([kr(0,Pr),kr(1,Ir)],Kr.prototype,"Output",null),Er([kr(0,Pr),kr(1,Mr)],Kr.prototype,"InitializeProxy",null),Er([kr(0,Pr),kr(1,Mr)],Kr.prototype,"SynchronizeProxy",null),Er([kr(0,Pr),kr(1,Mr)],Kr.prototype,"HandleGet",null),Er([kr(0,Pr),kr(1,Mr)],Kr.prototype,"HandleToList",null),Er([kr(0,Pr),kr(1,Ir),kr(2,Ir),kr(3,Ir)],Kr.prototype,"HandleSet",null),Er([kr(0,Pr),kr(1,Ir),kr(2,Ir)],Kr.prototype,"HandleClear",null),Er([kr(0,Pr),kr(1,Mr),kr(2,Ir),kr(3,Ir)],Kr.prototype,"HandleStore",null),Er([kr(0,Pr),kr(1,Mr),kr(2,Ir),kr(3,Ir)],Kr.prototype,"HandleRemove",null),Er([kr(0,Pr),kr(1,Mr),kr(2,Ir),kr(3,Ir)],Kr.prototype,"HandleRemoveMultiple",null),Er([kr(0,Pr),kr(1,Mr),kr(2,Ir),kr(3,Ir)],Kr.prototype,"HandleStream",null),Er([kr(0,Pr),kr(1,Mr),kr(2,Ir)],Kr.prototype,"StreamCursorNext",null),Er([kr(0,Pr),kr(1,Ir)],Kr.prototype,"StreamCursorClose",null),Er([kr(0,Pr),kr(1,Mr),kr(2,Mr)],Kr.prototype,"Register",null),Er([kr(0,Pr),kr(1,Ir),kr(2,Mr)],Kr.prototype,"ProxyMessage",null),Er([kr(0,Ir),kr(1,Ar(Cr.Mapped,Cr.Direct))],Kr.prototype,"Idle",null),Er([kr(0,Mr),kr(1,Ir),kr(2,Nr(jt))],Kr.prototype,"GetBackingStore",null),Er([kr(0,Mr),kr(1,Pr)],Kr.prototype,"ConstructInnerArc",null),Er([kr(0,Mr),kr(1,jr),kr(2,Nr(jt)),kr(3,Ir)],Kr.prototype,"ArcCreateHandle",null),Er([kr(0,Mr),kr(1,jr),kr(2,Pr)],Kr.prototype,"ArcMapHandle",null),Er([kr(0,Pr),kr(1,Ir),kr(2,Mr)],Kr.prototype,"ServiceRequest",null),Er([kr(0,Mr),kr(1,jr),kr(2,Pr),kr(3,Ir),kr(4,Ir)],Kr.prototype,"ArcCreateSlot",null),Er([kr(0,jr),kr(1,Ir),kr(2,Mr)],Kr.prototype,"ArcLoadRecipe",null),Er([kr(0,Nr(oe))],Kr.prototype,"ReportExceptionInHost",null),Kr=Er([(Qr=Vr,e=>{const t=(e,t)=>{const n=Tr.get(e)||new Map;for(const r of n.keys()){const i=zr(e.prototype[r]),s=n.get(r)||[],o=s.findIndex(e=>e.initializer||!1),a=s.findIndex(e=>e.identifier||!1),c=async function(...e){const t={};for(let n=0;n<s.length;n++)n!==o&&(t[i[n]]=qr(s[n],e[n],this._mapper));-1!==o&&(s[o].redundant?(d()(-1===a),t.identifier=this._mapper.maybeCreateMappingForThing(e[o])):s[o].overriding?t.identifier=this._mapper.recreateMappingForThing(e[o]):t.identifier=this._mapper.createMappingForThing(e[o],e[a])),await this.send(r,t)},l=async function(e){const t=[],n=[];for(let r=0;r<s.length;r++){if(r===o&&(-1!==a||s[r].ignore))continue;const c=r===o?"identifier":i[r],l=Wr(s[r],e[c],this._mapper);l instanceof Promise?(n.push({promise:l,position:t.length}),t.push(()=>Wr(s[r],e[c],this._mapper))):t.push(l)}n.length>0&&(await Promise.all(n.map(async e=>e.promise)),n.forEach(e=>{t[e.position]=t[e.position]()}));const c=this["on"+r](...t);o>-1&&(d()(e.identifier),await this._mapper.establishThingMapping(e.identifier,c))};Object.defineProperty(e.prototype,r,{get:()=>c}),Object.defineProperty(t.prototype,"before"+r,{get:()=>l})}};t(e,Qr),t(Qr,e)})],Kr);class Zr{constructor(e,t,n,r){this.handlers=new Map,this.requestedContentTypes=new Set,this._isRendered=!1,this.apiPort=e,this.slotName=n,this.particle=t,this.providedSlots=r}get isRendered(){return this._isRendered}render(e){this.apiPort.Render(this.particle,this.slotName,e),Object.keys(e).forEach(e=>{this.requestedContentTypes.delete(e)}),this._isRendered=0===this.requestedContentTypes.size&&Object.keys(e).length>0}registerEventHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}clearEventHandlers(e){this.handlers.set(e,[])}fireEvent(e){for(const t of this.handlers.get(e.handler)||[])t(e)}rewire(e){this.particle.removeSlotProxy(this.slotName),this.particle=e,this._isRendered=!1,this.particle.addSlotProxy(this),this.particle.renderSlot(this.slotName,["model","template","templateName"])}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Yr{constructor(e){if(this.left2right=new Map,this.right2left=new Map,e)for(const[t,n]of e)this.set(t,n)}get size(){return this.left2right.size}set(e,t){return this.hasL(e)&&this.right2left.delete(this.getL(e)),this.hasR(t)&&this.left2right.delete(this.getR(t)),this.left2right.set(e,t),this.right2left.set(t,e),this}hasL(e){return this.left2right.has(e)}hasR(e){return this.right2left.has(e)}getL(e){return this.left2right.get(e)}getR(e){return this.right2left.get(e)}deleteL(e){return this.right2left.delete(this.getL(e)),this.left2right.delete(e)}deleteR(e){return this.left2right.delete(this.getR(e)),this.right2left.delete(e)}clear(){this.left2right.clear(),this.right2left.clear()}entries(){return this.left2right.entries()}lefts(){return this.left2right.keys()}rights(){return this.right2left.keys()}forEach(e){this.left2right.forEach((t,n)=>e(n,t,this))}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Xr{constructor(e){const t=e.entityClass.schema;d()(t.names.length>0,"At least one schema name is required for entity packaging");let n=null;e.type instanceof qt?n=e.type:e.type.getContainedType()instanceof qt&&(n=e.type.getContainedType()),this.encoder=new ei(t),this.decoder=new ti(t,n,e.storage.pec)}encodeSingleton(e){return this.encoder.encodeSingleton(e)}encodeCollection(e){return this.encoder.encodeCollection(e)}decodeSingleton(e){return this.decoder.decodeSingleton(e)}}function Jr(e){return e.length+":"+e}class ei{constructor(e){this.schema=e}encodeSingleton(e){if(e instanceof On){const{id:t,storageKey:n}=e.dataClone();return Jr(t)+"|"+Jr(n)+"|"}{let t=Jr(ke.id(e))+"|";for(const[n,r]of Object.entries(e))t+=this.encodeField(this.schema.fields[n],n,r);return t}}encodeCollection(e){let t=e.length+":";for(const n of e)t+=Jr(this.encodeSingleton(n));return t}static encodeDictionary(e){const t=Object.entries(e);let n=t.length+":";for(const[e,r]of t)n+=Jr(e)+Jr(r);return n}encodeField(e,t,n){switch(e.kind){case"schema-primitive":return t+":"+e.type.substr(0,1)+this.encodeValue(e.type,n)+"|";case"schema-collection":case"schema-union":case"schema-tuple":case"schema-reference":throw new Error(`'${e.kind}' not yet supported for entity packaging`);default:throw new Error(`Unknown field kind '${e.kind}' in schema`)}}encodeValue(e,t){switch(e){case"Text":case"URL":return Jr(t);case"Number":return t+":";case"Boolean":return t?"1":"0";case"Bytes":case"Object":throw new Error(`'${e}' not yet supported for entity packaging`);default:throw new Error(`Unknown primitive value type '${e}' in schema`)}}}class ti{constructor(e=null,t=null,n=null){this.schema=e,this.referenceType=t,this.pec=n}decodeSingleton(e){this.str=e;const t=Number(this.upTo(":")),n=this.chomp(t);if(this.validate("|"),this.referenceType){const e=Number(this.upTo(":")),t=this.chomp(e);return this.validate("|"),new On({id:n,storageKey:t},this.referenceType,this.pec)}{const e={};for(;this.str.length>0;){const t=this.upTo(":"),n=this.chomp(1);e[t]=this.decodeValue(n),this.validate("|")}const t=new(this.schema.entityClass())(e);return""!==n&&ke.identify(t,n),t}}decodeDictionary(e){this.str=e;const t={};let n=Number(this.upTo(":"));for(;n--;){const e=Number(this.upTo(":")),n=this.chomp(e),r=this.chomp(1);if(r>="0"&&r<="9"){const e=Number(`${r}${this.upTo(":")}`);t[n]=this.chomp(e)}else t[n]=this.decodeValue(r)}return t}upTo(e){const t=this.str.indexOf(e);if(t<0)throw new Error(`Packaged entity decoding fail: expected '${e}' separator in '${this.str}'`);const n=this.str.slice(0,t);return this.str=this.str.slice(t+1),n}chomp(e){if(e>this.str.length)throw new Error(`Packaged entity decoding fail: expected '${e}' chars to remain in '${this.str}'`);const t=this.str.slice(0,e);return this.str=this.str.slice(e),t}validate(e){if(this.chomp(e.length)!==e)throw new Error(`Packaged entity decoding fail: expected '${e}' at start of '${this.str}'`)}decodeValue(e){switch(e){case"T":case"U":{const e=Number(this.upTo(":"));return this.chomp(e)}case"N":return Number(this.upTo(":"));case"B":return Boolean("1"===this.chomp(1));case"D":{const e=Number(this.upTo(":")),t=this.chomp(e);return this.decodeDictionary(t)}default:throw new Error(`Packaged entity decoding fail: unknown or unsupported primitive value type '${e}'`)}}}class ni{constructor(e){this.logInfo=null;const t=new Uint8Array(e),n=[];let r=0;for(;r<t.byteLength;){let e=0,i=0;for(;;){const n=t[r++];if(e|=(127&n)<<i,!(128&n))break;i+=7}n.push(e)}if(n.length<4)throw new Error("emscripten metadata section should have at least 4 values; "+`got ${n.length}`);if(0!==n[0]||2!==n[1])throw new Error("emscripten metadata version should be 0.2; "+`got ${n[0]}.${n[1]}`);if(0!==n[2]||4!==n[3])throw new Error("emscripten ABI version should be 0.4; "+`got ${n[2]}.${n[3]}`);if(11!==n.length)throw new Error("emscripten metadata section should have 11 values; "+`got ${n.length}`);this.cfg={memSize:n[5],tableSize:n[6],globalBase:n[7],dynamicBase:n[8],dynamictopPtr:n[9]}}configureEnvironment(e,t,n){t.memory=new WebAssembly.Memory({initial:this.cfg.memSize,maximum:this.cfg.memSize}),t.heapU8=new Uint8Array(t.memory.buffer),t.heap32=new Int32Array(t.memory.buffer),t.heap32[this.cfg.dynamictopPtr>>2]=this.cfg.dynamicBase,Object.assign(n,{memory:t.memory,__memory_base:this.cfg.globalBase,table:new WebAssembly.Table({initial:this.cfg.tableSize,maximum:this.cfg.tableSize,element:"anyfunc"}),__table_base:0,DYNAMICTOP_PTR:this.cfg.dynamictopPtr,_emscripten_get_heap_size:()=>t.heapU8.length,_emscripten_resize_heap:e=>!1,_emscripten_memcpy_big:(e,n,r)=>t.heapU8.set(t.heapU8.subarray(n,n+r),e),_systemError:e=>{throw new Error(t.read(e))},abortOnCannotGrowMemory:e=>{throw new Error(`abortOnCannotGrowMemory(${e})`)},_setLogInfo:(e,n)=>this.logInfo=[t.read(e).split(/[\/\\]/).pop(),n],___syscall146:(e,n)=>this.sysWritev(t,e,n)})}initializeInstance(e,t){}sysWritev(e,t,n){const r=()=>(n+=4,e.heap32[n-4>>2]),i=1===r()?console.log:console.error,s=r(),o=r();let a=this.logInfo?`[${this.logInfo[0]}:${this.logInfo[1]}] `:"",c=0;for(let t=0;t<o;t++){const n=e.heap32[s+8*t>>2],r=e.heap32[s+(8*t+4)>>2];for(let t=0;t<r;t++){const r=e.heapU8[n+t];0===r||10===r?(i(a),a=""):a+=String.fromCharCode(r)}c+=r}return this.logInfo=null,c}}class ri{configureEnvironment(e,t,n){Object.assign(n,{Konan_js_arg_size:e=>1,Konan_js_fetch_arg:(e,t)=>"dummyArg",Konan_js_allocateArena:e=>{},Konan_js_freeArena:e=>{},write:e=>console.log(t.read(e)),flush:()=>{},Konan_notify_memory_grow:()=>this.updateMemoryViews(t),Konan_abort:e=>{throw new Error("Konan_abort("+t.read(e)+")")},Konan_exit:e=>{},Konan_date_now:e=>{const n=Date.now(),r=Math.floor(n/4294967295),i=Math.floor(n%4294967295);t.heap32[e]=i,t.heap32[e+1]=r}})}initializeInstance(e,t){this.updateMemoryViews(e),t.exports.Konan_js_main(1,0)}updateMemoryViews(e){e.memory=e.exports.memory,e.heapU8=new Uint8Array(e.memory.buffer),e.heap32=new Int32Array(e.memory.buffer)}}class ii{constructor(e,t){this.particleMap=new Map,this.loader=e,this.apiPort=t}async initialize(e){const t=await WebAssembly.compile(e),n=this.driverForModule(t),r={abort:()=>{throw new Error("Abort!")},_singletonSet:(e,t,n)=>this.getParticle(e).singletonSet(t,n),_singletonClear:(e,t)=>this.getParticle(e).singletonClear(t),_collectionStore:(e,t,n)=>this.getParticle(e).collectionStore(t,n),_collectionRemove:(e,t,n)=>this.getParticle(e).collectionRemove(t,n),_collectionClear:(e,t)=>this.getParticle(e).collectionClear(t),_onRenderOutput:(e,t,n)=>this.getParticle(e).onRenderOutput(t,n),_dereference:(e,t,n,r)=>this.getParticle(e).dereference(t,n,r),_render:(e,t,n,r)=>this.getParticle(e).renderImpl(t,n,r),_serviceRequest:(e,t,n,r)=>this.getParticle(e).serviceRequest(t,n,r),_resolveUrl:e=>this.resolve(e)};n.configureEnvironment(t,this,r);const i={NaN:NaN,Infinity:1/0};this.wasm=await WebAssembly.instantiate(t,{env:r,global:i}),this.exports=this.wasm.exports,n.initializeInstance(this,this.wasm)}driverForModule(e){const t=WebAssembly.Module.customSections(e,"emscripten_metadata");return 1===t.length?new ni(t[0]):new ri}getParticle(e){return this.particleMap.get(e)}register(e,t){this.particleMap.set(t,e)}resolve(e){return this.store(this.loader.resolve(this.read(e)))}store(e){const t=this.exports._malloc(e.length+1);for(let n=0;n<e.length;n++)this.heapU8[t+n]=e.charCodeAt(n);return this.heapU8[t+e.length]=0,t}free(...e){e.forEach(e=>e&&this.exports._free(e))}read(e){let t="";for(;e<this.heapU8.length&&0!==this.heapU8[e];)t+=String.fromCharCode(this.heapU8[e++]);return t}}class si extends Pn{constructor(e,t){super(),this.handleMap=new Yr,this.converters=new Map,this.id=e,this.container=t,this.exports=t.exports;const n=`_new${this.spec.name}`;if(!(n in this.exports))throw new Error(`wasm module does not export instantiator function '${n}' for particle '${this.spec.name}'`);this.innerParticle=this.exports[n](),this.container.register(this,this.innerParticle),setTimeout(()=>this.renderOutput(),100)}renderOutput(){this.exports._renderOutput&&this.exports._renderOutput(this.innerParticle)}async setHandles(e){for(const[t,n]of e){const e=this.container.store(t),r=this.exports._connectHandle(this.innerParticle,e,n.canRead,n.canWrite);if(this.container.free(e),0===r)throw new Error(`Wasm particle failed to connect handle '${t}'`);this.handleMap.set(n,r),this.converters.set(n,new Xr(n))}this.exports._init(this.innerParticle)}async onHandleSync(e,t){const n=this.handleMap.getL(e);if(!t)return void this.exports._syncHandle(this.innerParticle,n,0);const r=this.converters.get(e);if(!r)throw new Error("cannot find handle "+e.name);let i;i=e instanceof kn?r.encodeSingleton(t):r.encodeCollection(t);const s=this.container.store(i);this.exports._syncHandle(this.innerParticle,n,s),this.container.free(s)}async onHandleUpdate(e,t){if(t.originator)return;const n=this.handleMap.getL(e),r=this.converters.get(e);if(!r)throw new Error("cannot find handle "+e.name);let i=0,s=0;e instanceof kn?t.data&&(i=this.container.store(r.encodeSingleton(t.data))):(i=this.container.store(r.encodeCollection(t.added||[])),s=this.container.store(r.encodeCollection(t.removed||[]))),this.exports._updateHandle(this.innerParticle,n,i,s),this.container.free(i,s)}async onHandleDesync(e){}singletonSet(e,t){const n=this.getHandle(e),r=this.decodeEntity(n,t),i=this.ensureIdentified(r,n);return n.set(r),i}singletonClear(e){this.getHandle(e).clear()}collectionStore(e,t){const n=this.getHandle(e),r=this.decodeEntity(n,t),i=this.ensureIdentified(r,n);return n.store(r),i}collectionRemove(e,t){const n=this.getHandle(e);n.remove(this.decodeEntity(n,t))}collectionClear(e){this.getHandle(e).clear()}async dereference(e,t,n){const r=this.getHandle(e),i=this.converters.get(r);if(!i)throw new Error("cannot find handle "+r.name);const s=this.container.read(t);let o;if(r instanceof kn)o=await r.get();else{if(!(r instanceof En))throw new Error(`wasm particle '${this.spec.name}' dereferenced an unsupported handle type ${r._id}`);o=await r.get(s)}let a=0;if(o){const e=await o.dereference();a=this.container.store(i.encodeSingleton(e))}this.exports._dereferenceResponse(this.innerParticle,n,a),this.container.free(a)}getHandle(e){const t=this.handleMap.getR(e);if(!t){const e=new Error(`wasm particle '${this.spec.name}' attempted to write to unconnected handle`),t=new ce(e,"WasmParticle::getHandle",this.id,this.spec.name);throw this.container.apiPort.ReportExceptionInHost(t),e}return t}decodeEntity(e,t){return this.converters.get(e).decodeSingleton(this.container.read(t))}ensureIdentified(e,t){let n=0;return e instanceof ke&&!ke.isIdentified(e)&&(t.createIdentityFor(e),n=this.container.store(ke.id(e))),n}output(e){this.container.apiPort.Output(this,e)}onRenderOutput(e,t){const n={templateName:"default"};n.template=this.container.read(e),n.model=(new ti).decodeDictionary(this.container.read(t)),this.output(n)}renderSlot(e,t){const n=this.container.store(e),r=t.includes("template"),i=t.includes("model");this.exports._renderSlot(this.innerParticle,n,r,i),this.container.free(n)}renderHostedSlot(e,t,n){throw new Error("renderHostedSlot not implemented for wasm particles")}renderImpl(e,t,n){const r=this.slotProxiesByName.get(this.container.read(e));if(r){const e={templateName:"default"};t&&(e.template=this.container.read(t),r.requestedContentTypes.add("template")),n&&(e.model=(new ti).decodeDictionary(this.container.read(n)),r.requestedContentTypes.add("model")),r.render(e)}}async serviceRequest(e,t,n){const r=this.container.read(e),i=(new ti).decodeDictionary(this.container.read(t)),s=this.container.read(n),o=await this.service({call:r,...i}),a={};if("object"==typeof o)for(const e of Object.entries(o)){const[t,n]=e;a[t]="object"==typeof n?JSON.stringify(n):n+""}else a.value=o+"";const c=this.container.store(r),l=this.container.store(ei.encodeDictionary(a)),h=this.container.store(s);this.exports._serviceResponse(this.innerParticle,c,l,h),this.container.free(c,l,h)}fireEvent(e,t){const n=this.container.store(e),r=this.container.store(t.handler);this.exports._fireEvent(this.innerParticle,n,r),this.container.free(n,r)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class oi{constructor(e,t,n,r){this.particles=new Map,this.pendingLoads=[],this.scheduler=new wn,this.keyedProxies={},this.wasmContainers={};const i=this;this.apiPort=new class extends Kr{onDefineHandle(e,t,n){return an.useNewStorageStack?new Ot(e,i,t):yn.newProxy(e,t,this,i,i.scheduler,n)}onGetBackingStoreCallback(e,t,n,r,s){let o;return an.useNewStorageStack?o=new Ot(r,i,t):(o=yn.newProxy(r,t,this,i,i.scheduler,n)).storageKey=s,[o,()=>e(o,s)]}onCreateHandleCallback(e,t,n,r){let s;return[s=an.useNewStorageStack?new Ot(r,i,t):yn.newProxy(r,t,this,i,i.scheduler,n),()=>e(s)]}onMapHandleCallback(e,t){return[t,()=>e(t)]}onCreateSlotCallback(e,t){return[t,()=>e(t)]}onInnerArcRender(e,t,n,r){e.renderHostedSlot(t,n,r)}onStop(){global.close&&global.close()}async onInstantiateParticle(e,t,n){return i.instantiateParticle(e,t,n)}async onReinstantiateParticle(e,t,n){d()(!1,"Not implemented")}async onReloadParticles(e){return i.reloadParticles(e)}onSimpleCallback(e,t){e(t)}onConstructArcCallback(e,t){e(t)}onAwaitIdle(e){i.idle.then(t=>{setTimeout(()=>this.Idle(e,i.relevance),0)})}onUIEvent(e,t,n){e.fireEvent(t,n)}onStartRender(e,t,n,r){e.addSlotProxy(new Zr(this,e,t,n)),e.renderSlot(t,r)}onStopRender(e,t){d()(e.hasSlotProxy(t),`Stop render called for particle ${e.spec.name} slot ${t} without start render being called.`),e.removeSlotProxy(t)}}(e),this.pecId=t,this.idGenerator=n,this.loader=r,r.setParticleExecutionContext(this)}generateID(){return this.idGenerator.newChildId(this.pecId).toString()}getStorageEndpoint(e){const t=this;let n;return{onProxyMessage:async r=>(r.id=await n,new Promise(n=>t.apiPort.ProxyMessage(e,r,e=>n(e)))),setCallback(r){n=new Promise(n=>t.apiPort.Register(e,t=>e.onMessage(t),e=>n(e)))},reportExceptionInHost(e){t.apiPort.ReportExceptionInHost(e)}}}innerArcHandle(e,t){const n=this;return{createHandle:async(r,i,s)=>new Promise((o,a)=>n.apiPort.ArcCreateHandle(e=>{const r=Rn({proxy:e,idGenerator:n.idGenerator,name:i,particleId:t});o(r),s&&e.register(s,r)},e,r,i)),mapHandle:async t=>new Promise((r,i)=>n.apiPort.ArcMapHandle(e=>{r(e)},e,t)),createSlot:async(t,r,i)=>new Promise((s,o)=>n.apiPort.ArcCreateSlot(e=>s(e),e,t,r,i)),loadRecipe:async t=>new Promise((r,i)=>n.apiPort.ArcLoadRecipe(e,t,e=>{e.error?i(e.error):r(e)}))}}getStorageProxy(e,t){return this.keyedProxies[e]||(this.keyedProxies[e]=new Promise((n,r)=>{this.apiPort.GetBackingStore((e,t)=>{this.keyedProxies[t]=e,n(e)},e,t)})),this.keyedProxies[e]}capabilities(e){const t={serviceRequest:(e,t,n)=>{this.apiPort.ServiceRequest(e,t,n)},output:(e,t)=>{this.apiPort.Output(e,t)}};return e&&(t.constructInnerArc=(async e=>new Promise((t,n)=>this.apiPort.ConstructInnerArc(e=>t(this.innerArcHandle(e,void 0)),e)))),t}async instantiateParticle(e,t,n){let r;const i=new Promise(e=>r=e);this.pendingLoads.push(i);const s=await this.createParticleFromSpec(e,t),o=new Map,a=[];return n.forEach((n,r)=>{this.createHandle(s,t,e,r,n,o,a)}),[s,async()=>{await this.assignHandle(s,t,e,o,a,i),r()}]}async reloadParticles(e){e.forEach(e=>{const t=this.particles.get(e);t.spec.implBlobUrl&&delete t.spec.implBlobUrl,t.spec.implFile.endsWith(".wasm")&&this.wasmContainers[t.spec.implFile]&&(this.wasmContainers[t.spec.implFile]=void 0)});const t=[];for(const n of e){let e;const r=new Promise(t=>e=t);this.pendingLoads.push(r);const i=this.particles.get(n),s=await this.createParticleFromSpec(n,i.spec),o=new Map,a=[];i.handles.forEach(e=>{this.createHandle(s,i.spec,n,e.name,e.storage,o,a),e.disable(i)}),t.push([s,async()=>{await this.assignHandle(s,i.spec,n,o,a,r),e();for(const e of i.getSlotNames())i.getSlot(e).rewire(s)}])}return t}createHandle(e,t,n,r,i,s,o){const a=t.handleConnectionMap.get(r),c=Rn({proxy:i,idGenerator:this.idGenerator,name:r,particleId:n,particle:e,canRead:a.isInput,canWrite:a.isOutput});s.set(r,c),o.push({proxy:i,particle:e,handle:c})}async assignHandle(e,t,n,r,i,s){await e.callSetHandles(r,e=>{const r=new ce(e,"setHandles",n,t.name);this.apiPort.ReportExceptionInHost(r)}),i.forEach(({proxy:e,particle:t,handle:n})=>{if(e instanceof yn)e.register(t,n);else{if(!(e instanceof Ot))throw new Error("Expecting a StorageProxy");e.registerHandle(n)}});const o=this.pendingLoads.indexOf(s);this.pendingLoads.splice(o,1)}async createParticleFromSpec(e,t){let n;if(t.implFile&&t.implFile.endsWith(".wasm"))(n=await this.loadWasmParticle(e,t)).setCapabilities(this.capabilities(!1));else{(n=new(await this.loader.loadParticleClass(t))).setCapabilities(this.capabilities(!0))}return this.particles.set(e,n),n}async loadWasmParticle(e,t){d()(t.name.length>0);let n=this.wasmContainers[t.implFile];if(!n){const e=await this.loader.loadWasmBinary(t);if(!e||0===e.byteLength)throw new Error(`Failed to load wasm binary '${t.implFile}'`);n=new ii(this.loader,this.apiPort),await n.initialize(e),this.wasmContainers[t.implFile]=n}si.spec=t;const r=new si(e,n);return si.spec=null,r}get relevance(){const e=new Map;return this.particles.forEach(t=>{0!==t.relevances.length&&(e.set(t,t.relevances),t.relevances.length=0)}),e}get busy(){return!!(this.pendingLoads.length>0||this.scheduler.busy)||[...this.particles.values()].filter(e=>e.busy).length>0}get idle(){if(!this.busy)return Promise.resolve();const e=[...this.particles.values()].filter(async e=>e.busy).map(async e=>e.idle);return Promise.all([this.scheduler.idle,...this.pendingLoads,...e]).then(()=>this.idle)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function ai(e){return(t,n)=>{const r=new Sr;new oi(r.port1,t,n,e.clone());return r.port2}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ci extends xt{constructor(e,t,n,r,i,s,o,a,c,l,h,u=!1,d){super({type:e,id:t,name:n,originalId:s,claims:o,description:a,source:l,origin:h}),this.storageKey=r,this.storageProviderFactory=i,this.version=c,this.referenceMode=u,this.model=d,this.unifiedStoreType="StorageStub"}on(e){return-1}off(e){}async activate(){return this.inflate()}async inflate(e){const t=e||this.storageProviderFactory,n=this.isBackedByManifest()?await t.construct(this.id,this.type,this.storageKey):await t.connect(this.id,this.type,this.storageKey);return d()(null!=n,"inflating missing storageKey "+this.storageKey),this.isBackedByManifest()?n.referenceMode=this.referenceMode:this.referenceMode=n.referenceMode,n.storeInfo={...this.storeInfo},this.isBackedByManifest()&&await n.fromLiteral({version:this.version,model:this.model}),n}toLiteral(){}isBackedByManifest(){return void 0!==this.version&&!!this.model}_compareTo(e){let t;return 0!==(t=Ct(this.name,e.name))?t:0!==(t=Ct(this.id,e.id))?t:0}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.Permuted="permuted",e.Independent="independent"}(Gr||(Gr={}));class li{constructor(e,t){this._arc=e,this._args=t}get arc(){return this._arc}getResults({generated:e}){return e}async generateFrom(e){return this.generate({generated:e,population:[],terminal:[],generation:0})}}class hi{constructor(e){this.descendants=[],d()(e),this.tactic=e}onAction(e){this.currentAction=e}onResult(e){this.currentResult=e,this.updateList=[]}onResultDone(){this.runUpdateList(this.currentResult.result,this.updateList),this.currentResult=void 0,this.updateList=void 0}onActionDone(){this.currentAction=void 0}static walk(e,t,n){return t.onAction(n),e.forEach(e=>{t.onResult(e),t.onResultDone()}),t.onActionDone(),t.descendants}visit(e,...t){const n=e(this.currentResult.result,...t);this.isEmptyResult(n)||this.updateList.push({continuation:n,context:t})}runUpdateList(e,t){const n=[];if(t.length)switch(this.tactic){case Gr.Permuted:{let r=[[]];t.forEach(({continuation:e,context:t})=>{const n=[];"function"==typeof e&&(e=[e]),e.forEach(e=>{r.forEach(r=>{const i=r.slice();i.push({continuation:e,context:t}),n.push(i)})}),r=n});for(const t of r){const r=new Map,i=e.clone(r);let s=0;const o=t.filter(e=>null!==e.continuation);0!==o.length&&(o.forEach(({continuation:e,context:t})=>{s=e(i,...t.map(e=>r.get(e)||e))}),n.push({result:i,score:s}))}break}case Gr.Independent:t.forEach(({continuation:t,context:r})=>{"function"==typeof t&&(t=[t]),t.forEach(t=>{const i=new Map,s=e.clone(i);let o=0;o=null==t?0:t(s,...r.map(e=>i.get(e)||e)),n.push({result:s,score:o})})});break;default:throw new Error(`${this.tactic} not supported`)}for(const e of n)this.createDescendant(e.result,e.score)}createWalkerDescendant(e,t,n,r){d()(this.currentResult,"no current result"),d()(this.currentAction,"no current action"),this.currentResult.score&&(t+=this.currentResult.score),this.descendants.push({result:e,score:t,derivation:[{parent:this.currentResult,strategy:this.currentAction}],hash:n,valid:r})}isEmptyResult(e){return!e||(e.constructor===Array&&e.length<=0||(d()("function"==typeof e||e.length),!1))}}hi.Permuted=Gr.Permuted,hi.Independent=Gr.Independent;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class ui extends hi{onResult(e){super.onResult(e);const t=e.result;if(this.onRecipe&&this.visit(this.onRecipe.bind(this)),this.onParticle)for(const e of t.particles)this.visit(this.onParticle.bind(this),e);if(this.onPotentialHandleConnection)for(const e of t.particles)if(e.spec)for(const t of e.spec.handleConnectionMap.values())e.connections[t.name]||this.visit(this.onPotentialHandleConnection.bind(this),e,t);if(this.onHandleConnection)for(const e of t.handleConnections)this.visit(this.onHandleConnection.bind(this),e);if(this.onHandle)for(const e of t.handles)this.visit(this.onHandle.bind(this),e);if(this.onPotentialSlotConnection)for(const e of t.particles)for(const[t,n]of e.getSlotSpecs())e.getSlotConnectionByName(t)||this.visit(this.onPotentialSlotConnection.bind(this),e,n);if(this.onSlotConnection)for(const e of t.slotConnections)this.visit(this.onSlotConnection.bind(this),e);if(this.onSlot)for(const e of t.slots)this.visit(this.onSlot.bind(this),e);if(this.onObligation)for(const e of t.obligations)this.visit(this.onObligation.bind(this),e);if(this.onRequiredParticle)for(const e of t.requires)for(const t of e.particles)this.visit(this.onRequiredParticle.bind(this),t)}createDescendant(e,t){const n=e.normalize(),r=n?e.digest():null;super.createWalkerDescendant(e,t,r,n)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class di{static getClonedSlot(e,t){let n=e.updateToClone({selectedSlot:t}).selectedSlot;return n||(t.id&&(n=e.findSlotByID(t.id)),void 0===n?((n=e instanceof hr?e.parent.newSlot(t.name):e.newSlot(t.name)).id=t.id,n):n)}static connectSlotConnection(e,t){const n=e.recipe;if(!e.targetSlot){const r=di.getClonedSlot(n,t);e.connectToSlot(r)}if(!e.targetSlot)throw new Error("missing targetSlot");d()(!t.id||!e.targetSlot.id||t.id===e.targetSlot.id,`Cannot override slot id '${e.targetSlot.id}' with '${t.id}'`),e.targetSlot.id=t.id||e.targetSlot.id,e.targetSlot.tags=[...t.tags]}static findAllSlotCandidates(e,t,n){const r=e.getSlandleConnectionByName(t.name);return{local:r&&r.targetSlot?[]:di._findSlotCandidates(e,t,e.recipe.slots),remote:di._findSlotCandidates(e,t,n.pec.slotComposer.getAvailableContexts())}}static _findSlotCandidates(e,t,n){const r=n.filter(n=>this.slotMatches(e,t,n));return r.sort((e,t)=>e.name<t.name),r}static slotMatches(e,t,n){if(!di.specMatch(t,n.spec))return!1;const r=e.getSlandleConnectionBySpec(t);return!!di.tagsOrNameMatch(t,n.spec,r,n)&&!!di.handlesMatch(e,n)}static specMatch(e,t){return e&&t&&e.isSet===t.isSet}static handlesMatch(e,t){return 0===t.handles.length||!!Object.values(e.connections).find(e=>t.handles.includes(e.handle)||e.handle&&e.handle.id&&t.handles.map(e=>e.id).includes(e.handle.id))}static tagsOrNameMatch(e,t,n,r){const i=[].concat(e.tags||[],n?n.tags:[],n&&n.targetSlot?n.targetSlot.tags:[]),s=[].concat(t.tags||[],r?r.tags:[],r?r.name:t.name?t.name:[]);return!!(i.length>0&&i.some(e=>s.includes(e)))||e.name===(r?r.name:t.name)}static replaceOldSlot(e,t,n){if(t&&(!t.id||t.id!==n.id)){if(void 0!==t.sourceConnection){if(void 0===n.sourceConnection)return!1;const e=di.getClonedSlot(t.sourceConnection.recipe,n);t.sourceConnection.providedSlots[t.name]=e}for(;t.consumeConnections.length>0;){const e=t.consumeConnections[0];e.disconnectFromSlot(),di.connectSlotConnection(e,n)}}return!0}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class pi extends ui{constructor(e,t,n){super(e),this.arc=t,this.options=n}onHandle(e,t){const n=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]);if("`slot"===t.fate)return[];if(t.type.slandleType())return[];const r=this.arc;if(0===t.connections.length||t.id&&t.storageKey||!t.type||!t.fate)return n("No connections to handle or missing handle information");let i;if(t.id){if(!t.storageKey){let e;switch(t.fate){case"use":e=r.findStoreById(t.id);break;case"map":case"copy":e=r.context.findStoreById(t.id);break;case"create":case"?":break;default:throw new Error(`unexpected fate ${t.fate}`)}if(!e)return n("cannot find associated store");i=[e]}}else{sr.directionCounts(t);switch(t.fate){case"use":i=r.findStoresByType(t.type,{tags:t.tags});break;case"map":case"copy":i=r.context.findStoresByType(t.type,{tags:t.tags,subtype:!0});break;case"create":case"?":i=[];break;default:throw new Error(`unexpected fate ${t.fate}`)}}return 0===i.length?n("Cannot find a handle matching requested type and tags."):0===(i=i.filter(n=>{for(const r of e.handles)if(n.id===r.id&&r!==t)return!1;return!0})).length?n("The only handles matching the requested type and tags are already present in this recipe"):i.map(e=>(t,n)=>(n.mapToStorage(e),0))}onSlotConnection(e,t){const n=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]),r=this.arc;if(t.isConnected())return n("Slot connection is already connected");const i=t.getSlotSpec(),s=t.particle,{local:o,remote:a}=di.findAllSlotCandidates(s,i,r),c=[...o,...a];if(1!==c.length)return n("There are multiple matching slots (match is ambiguous)");const l=c[0];return(e,t)=>(di.connectSlotConnection(t,l),1)}onPotentialSlotConnection(e,t,n){const r=e=>(this.options&&this.options.errors&&this.options.errors.set(t,e),[]),i=this.arc,{local:s,remote:o}=di.findAllSlotCandidates(t,n,i),a=[...s,...o];if(1!==a.length)return r("There are multiple matching slots for this slot spec (match is ambiguous)");const c=a[0];return(e,t,n)=>{const r=t.addSlotConnection(n.name);return di.connectSlotConnection(r,c),1}}onObligation(e,t){const n=t.from.instance,r=t.to.instance;for(const e of Object.values(n.connections))for(const t of Object.values(r.connections))if(e.handle&&e.handle===t.handle)return(e,t)=>(e.removeObligation(t),1);return[]}}class fi extends li{withOptions(e){this.options=e}async generate(e){return pi.walk(this.getResults(e),new pi(pi.Permuted,this.arc,this.options),this)}}class mi{constructor(e){this.resolver=new fi(e)}async resolve(e,t){if(!(e=e.clone()).normalize(t))return console.warn(`could not normalize a recipe: ${[...t.errors.values()].join("\n")}.\n${e.toString()}`),null;this.resolver.withOptions(t);const n=await this.resolver.generateFrom([{result:e,score:1}]);return 0===n.length?(t&&t.errors&&t.errors.set(e,"Resolver generated 0 recipes"),null):n[0].result}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class yi{static register(e,t){yi.registry[e]=t}static async request(e){let{service:t,invoke:n,call:r}=e;r&&([t,n]=r.split("."));const i=yi.registry[t];return i&&i[n]?await i[n](e):null}}yi.registry={},Object.freeze(yi),yi.register("test",{classify:async e=>({data:"it's a pig, that don't fly straight"})});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class gi{constructor(e,t,n){this._portByParticle=new Map,this.nextIdentifier=0,this.idleVersion=0,this.particles=[],this.close=(()=>{n.forEach(e=>e.close()),this._apiPorts.forEach(e=>e.close())}),this.arc=t,this.slotComposer=e;this._apiPorts=n.map(e=>new _i(e,t))}choosePortForParticle(e){d()(!this._portByParticle.has(e),`port already found for particle '${e.spec.name}'`);const t=this._apiPorts.find(t=>e.isJavaParticle()===t.supportsJavaParticle());return d()(!!t,`No port found for '${e.spec.name}'`),this._portByParticle.set(e,t),this.getPort(e)}getPort(e){return d()(this._portByParticle.has(e),`Cannot get port for particle '${e.spec.name}'`),this._portByParticle.get(e)}stop(){this._apiPorts.forEach(e=>e.Stop())}get idle(){return null==this.idlePromise&&(this.idlePromise=new Promise((e,t)=>{this.idleResolve=e})),this.idleVersion=this.nextIdentifier,this._apiPorts.forEach(e=>e.AwaitIdle(this.nextIdentifier++)),this.idlePromise}get messageCount(){return[...this._apiPorts.values()].map(e=>e.messageCount).reduce((e,t)=>e+t,0)}sendEvent(e,t,n){this.getPort(e).UIEvent(e,t,n)}instantiate(e,t){this.particles.push(e);const n=this.choosePortForParticle(e);t.forEach((e,t)=>{n.DefineHandle(e,e.type.resolvedType(),t)}),n.InstantiateParticle(e,e.id.toString(),e.spec,t)}reinstantiate(e,t){d()(this.particles.find(t=>t===e),`Cannot reinstantiate nonexistent particle ${e.name}`);const n=this.getPort(e);t.forEach((e,t)=>{n.DefineHandle(e,e.type.resolvedType(),t)}),n.ReinstantiateParticle(e.id.toString(),e.spec,t)}reload(e){const t=new Map;e.forEach(e=>{const n=this.getPort(e);let r=t.get(n);r?r.push(e):(r=[e],t.set(n,r))}),t.forEach((e,t)=>{t.ReloadParticles(e,e.map(e=>e.id.toString()))})}startRender({particle:e,slotName:t,providedSlots:n,contentTypes:r}){this.getPort(e).StartRender(e,t,n,r)}stopRender({particle:e,slotName:t}){this.getPort(e).StopRender(e,t)}innerArcRender(e,t,n,r){this.getPort(e).InnerArcRender(e,t,n,r)}resolveIfIdle(e,t){e===this.idleVersion&&(this.idlePromise=void 0,this.idleResolve(t))}}class _i extends Vr{constructor(e,t){super(e,t),this.arc=t}onRender(e,t,n){this.arc.pec.slotComposer&&this.arc.pec.slotComposer.renderSlot(e,t,n)}onInitializeProxy(e,t){e.legacyOn(e=>this.SimpleCallback(t,e))}async onSynchronizeProxy(e,t){const n=await e.modelForSynchronization();this.SimpleCallback(t,n)}async onHandleGet(e,t){const n=await e.get();this.SimpleCallback(t,n)}async onHandleToList(e,t){const n=await e.toList();this.SimpleCallback(t,n)}onHandleSet(e,t,n,r){e.set(t,n,r)}onHandleClear(e,t,n){e.clear(t,n)}async onHandleStore(e,t,n,r){await e.store(n.value,n.keys,r),this.SimpleCallback(t,{})}async onHandleRemove(e,t,n,r){await e.remove(n.id,n.keys,r),this.SimpleCallback(t,{})}async onHandleRemoveMultiple(e,t,n,r){await e.removeMultiple(n,r),this.SimpleCallback(t,{})}async onHandleStream(e,t,n,r){this.SimpleCallback(t,await e.stream(n,r))}async onStreamCursorNext(e,t,n){this.SimpleCallback(t,await e.cursorNext(n))}onStreamCursorClose(e,t){e.cursorClose(t)}async onRegister(e,t,n){const r=(await e.activate()).on(async e=>(this.SimpleCallback(t,e),Promise.resolve(!0)));this.SimpleCallback(n,r)}async onProxyMessage(e,t,n){const r=await(await e.activate()).onProxyMessage(t);this.SimpleCallback(n,r)}onIdle(e,t){this.arc.pec.resolveIfIdle(e,t)}async onGetBackingStore(e,t,n){t||(t=this.arc.storageProviderFactory.baseStorageKey(n,this.arc.storageKey||"volatile"));const r=await this.arc.storageProviderFactory.baseStorageFor(n,t);this.GetBackingStoreCallback(r,e,n.collectionOf(),n.toString(),`${r.id}:${"String(Math.random())".slice(2,9)}`,t)}onConstructInnerArc(e,t){const n=this.arc.createInnerArc(t);this.ConstructArcCallback(e,n)}async onArcCreateHandle(e,t,n,r){const i=await t.createStore(n,r,null,[],"volatile");this.CreateHandleCallback(i,e,n,r,i.id)}onArcMapHandle(e,t,n){d()(this.arc.findStoreById(n.id),`Cannot map nonexistent handle ${n.id}`),this.MapHandleCallback({},e,n.id)}onArcCreateSlot(e,t,n,r,i){let s;this.arc.pec.slotComposer&&(s=this.arc.pec.slotComposer.createHostedSlot(t,n,r,i)),this.CreateSlotCallback({},e,s)}async onArcLoadRecipe(e,t,n){const r=await _a.parse(t,{loader:e.loader,fileName:""}),i={providedSlotIds:{}};let s=void 0,o=r.recipes[0];if(o){for(const t of o.slots)if(t.id=t.id||e.generateID("slot").toString(),t.sourceConnection){const e=t.sourceConnection.particle.localName;e&&(i.providedSlotIds[`${e}.${t.name}`]=t.id)}const t=[];for(const e of o.handles){const n=this.arc.findStoreById(e.id)||r.findStoreById(e.id);n?e.mapToStorage(n):t.push(e)}if(t.length>0){let n=o;for(const t of[new mi(e),new mi(this.arc)])n=await t.resolve(n)||n;n===o?s=`Recipe couldn't load due to missing handles [recipe=${o}, missingHandles=${t.join("\n")}].`:o=n}if(!s){const n={errors:new Map};if(t.length>0||o.normalize(n))if(o.isResolved()){for(const e of r.stores)e instanceof ci?await this.arc._registerStore(await e.inflate(),[]):await this.arc._registerStore(e,[]);e.instantiate(o)}else s=`Recipe is not resolvable:\n${o.toString({showUnresolved:!0})}`;else s=`Recipe ${o} could not be normalized:\n${[...n.errors.values()].join("\n")}`}}else s="No recipe defined";this.SimpleCallback(n,s?{error:s}:i)}onOutput(e,t){const n=this.arc.pec.slotComposer;n&&n.delegateOutput&&n.delegateOutput(this.arc,e,t)}onReportExceptionInHost(e){e.particleName||(e.particleName=this.arc.loadedParticleInfo.get(e.particleId).spec.name),function(e){for(const t of le)t(e)}(e)}async onServiceRequest(e,t,n){const r=await yi.request(t);this.SimpleCallback(n,r)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class vi{constructor(){this.next=Promise.resolve(),this.depth=0}get locked(){return 0!==this.depth}async acquire(){let e;const t=this.next.then(()=>(this.depth++,()=>{e(),this.depth--}));return this.next=new Promise(t=>{e=t}),t}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class bi extends yt{constructor(e,t){super("volatile"),this.arcId=e,this.unique=t}toString(){return`${this.protocol}://${this.arcId}/${this.unique}`}childWithComponent(e){return new bi(this.arcId,`${this.unique}/${e}`)}static fromString(e){const t=e.match(/^volatile:\/\/([^\/]+)\/(.*)$/);if(!t)throw new Error(`Not a valid VolatileStorageKey: ${e}.`);const[n,r,i]=t;return new bi(Je.fromString(r),i)}}class wi{constructor(){this.entries=new Map}}class Si extends ut{constructor(e,t,n){super(e,t),this.pendingVersion=0,this.pendingModel=null;const r=e.toString();switch(this.memory=n,t){case tt.ShouldCreate:if(this.memory.entries.has(r))throw new Error(`requested creation of memory location ${e} can't proceed as location already exists`);this.data={data:null,version:0,drivers:[]},this.memory.entries.set(r,this.data);break;case tt.ShouldExist:if(!this.memory.entries.has(r))throw new Error(`requested connection to memory location ${e} can't proceed as location doesn't exist`);case tt.MayExist:{const e=this.memory.entries.get(r);e?(this.data=e,this.pendingModel=e.data,this.pendingVersion=e.version):(this.data={data:null,version:0,drivers:[]},this.memory.entries.set(r,this.data));break}default:throw new Error(`unknown Exists code ${t}`)}this.data.drivers.push(this)}registerReceiver(e){this.receiver=e,this.pendingModel&&(e(this.pendingModel,this.pendingVersion),this.pendingModel=null)}async send(e,t){return await 0,this.data.version===t-1&&(this.data.data=e,this.data.version+=1,this.data.drivers.forEach(t=>{t!==this&&t.receiver(e,this.data.version)}),!0)}async write(e,t){throw new Error("Method not implemented.")}async read(e){throw new Error("Method not implemented.")}}class Ci{constructor(e){this.arc=e}willSupport(e){return"volatile"===e.protocol&&e.arcId.equal(this.arc.id)}async driver(e,t){if(!this.willSupport(e))throw new Error(`This provider does not support storageKey ${e.toString()}`);return new Si(e,t,this.arc.volatileMemory)}static register(e){dt.register(new Ci(e))}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ei{constructor({id:e,context:t,pecFactories:n,slotComposer:r,loader:i,storageKey:s,storageProviderFactory:o,speculative:a,innerArc:c,stub:l,inspectorFactory:h}){this._activeRecipe=new lr,this._recipeDeltas=[],this.dataChangeCallbacks=new Map,this.storesById=new Map,this.storageKeys={},this.storeTags=new Map,this.storeDescriptions=new Map,this.innerArcsByParticle=new Map,this.instantiateMutex=new vi,this.idGenerator=Ye.newSession(),this.loadedParticleInfo=new Map,this.volatileMemory=new wi,this._context=t||new _a({id:e}),this.pecFactories=n&&n.length>0?n.slice():[ai(i).bind(null)],r&&!r.arc&&(r.arc=this),"string"==typeof e?(console.error(`Arc created with string ID ${e}!!! This should be an object of type Id instead. This warning will turn into an `+"exception soon (end of April 2019)."),this.id=Je.fromString(e)):this.id=e,this.isSpeculative=!!a,this.isInnerArc=!!c,this.isStub=!!l,this._loader=i,this.inspectorFactory=h,this.inspector=h&&h.create(this),this.storageKey=s;const u=this.pecFactories.map(e=>e(this.generateID(),this.idGenerator));this.pec=new gi(r,this,u),this.storageProviderFactory=o||new gs(this.id),this.volatileStorageDriverProvider=new Ci(this),dt.register(this.volatileStorageDriverProvider)}get loader(){return this._loader}get modality(){return this.pec.slotComposer&&this.pec.slotComposer.modality?this.pec.slotComposer.modality:this.activeRecipe.isEmpty()?de.union(this.context.allRecipes.map(e=>e.modality)):this.activeRecipe.modality}dispose(){for(const e of this.innerArcs)e.dispose();if(this.pec.stop(),this.pec.close(),!this.isInnerArc&&this.pec.slotComposer){const e=this.allDescendingArcs;this.pec.slotComposer.consumers.forEach(t=>d()(e.includes(t.arc))),this.pec.slotComposer.dispose()}dt.unregister(this.volatileStorageDriverProvider);for(const e of this._stores)rs.getRuntime().unregisterStore(e.id,[...this.findStoreTags(e)])}async _waitForIdle(){for(;;){const e=this.pec.messageCount,t=this.innerArcs;if(await Promise.all([this.pec.idle,...t.map(async e=>e.idle)]),this.innerArcs.length===t.length&&this.pec.messageCount===e+2)break}}get idle(){if(this.waitForIdlePromise)return this.waitForIdlePromise;const e=this._waitForIdle().then(()=>this.waitForIdlePromise=null);return this.waitForIdlePromise=e,e}findInnerArcs(e){return this.innerArcsByParticle.get(e)||[]}get innerArcs(){return[].concat(...this.innerArcsByParticle.values())}get allDescendingArcs(){return[this].concat(...this.innerArcs.map(e=>e.allDescendingArcs))}createInnerArc(e){const t=this.generateID("inner"),n=new Ei({id:t,pecFactories:this.pecFactories,slotComposer:this.pec.slotComposer,loader:this._loader,context:this.context,innerArc:!0,speculative:this.isSpeculative,inspectorFactory:this.inspectorFactory});let r=this.innerArcsByParticle.get(e);return r||(r=[],this.innerArcsByParticle.set(e,r)),r.push(n),n}async _serializeStore(e,t,n){const r=e.type.getContainedType()||e.type;let i;r instanceof Ht&&(t.interfaces+=r.interfaceInfo.toString()+"\n"),i="string"==typeof e.storageKey?this.storageProviderFactory.parseStringAsKey(e.storageKey):e.storageKey;const s=[...this.storeTags.get(e)||new Set],o=this.activeRecipe.findHandle(e.id),a=o?o.originalId:null;let c=`'${e.id}'`;switch(a&&(c+=`!!'${a}'`),i.protocol){case"firebase":case"pouchdb":t.handles+=e.toManifestString({handleTags:s,overrides:{name:n}})+"\n";break;case"volatile":{let r=[];if(!s.includes("volatile")){const t=await e.activate();r=(await t.toLiteral()).model.map(e=>{const{id:t,value:n}=e,r=e.index;if(null==n)return null;let i;if(n.rawData){i={$id:t};for(const e of Object.keys(n.rawData))i[e]=n.rawData[e]}else i=n;return void 0!==r&&(i.$index=r),i})}if(e.referenceMode&&r.length>0){const i=r[0].storageKey;if(!t.dataResources.has(i)){const r=`${n}_Data`;t.dataResources.set(i,r),e instanceof gr&&(await e.ensureBackingStore(),await this._serializeStore(e.backingStore,t,r))}const s=t.dataResources.get(i);r.forEach(e=>{e.storageKey=s})}const i="  ",o=JSON.stringify(r),a=`${n}Resource`;t.resources+=`resource ${a}\n`+i+"start\n"+o.split("\n").map(e=>i+e).join("\n")+"\n",t.handles+=e.toManifestString({handleTags:s,overrides:{name:n,source:a,origin:"resource"}})+"\n";break}default:throw new Error(`unknown storageKey protocol ${i.protocol}`)}}async _serializeHandles(){const e={handles:"",resources:"",interfaces:"",dataResources:new Map};let t=0;const n=new Set,r=new Set,i=new Set(this.context.stores.map(e=>e.id));for(const e of this._activeRecipe.handles)if("map"===e.fate)n.add(this.context.findManifestUrlForHandleId(e.id));else{if(e.immediateValue)continue;r.add(e.id)}for(const t of n.values())e.resources+=`import '${t}'\n`;for(const n of this._stores)r.has(n.id)&&!i.has(n.id)&&await this._serializeStore(n,e,`Store${t++}`);return e.resources+e.interfaces+e.handles}_serializeParticles(){const e=[];e.push(...this._activeRecipe.particles.map(e=>e.spec)),e.push(...this._activeRecipe.handles.filter(e=>e.immediateValue).map(e=>e.immediateValue));const t=[];return e.forEach(e=>{for(const n of e.handleConnections)n.type instanceof Ht&&t.push(n.type.interfaceInfo.toString());t.push(e.toString())}),t.join("\n")}_serializeStorageKey(){return this.storageKey?`storageKey: '${this.storageKey}'\n`:""}async serialize(){return await this.idle,`\nmeta\n  name: '${this.id}'\n  ${this._serializeStorageKey()}\n\n${await this._serializeHandles()}\n\n${this._serializeParticles()}\n\n@active\n${this.activeRecipe.toString()}`}async persistSerialization(e){const t=this.storageProviderFactory;let n;n="string"==typeof this.storageKey?t.parseStringAsKey(this.storageKey).childKeyForArcInfo():this.storageKey.childKeyForArcInfo();const r=new Wt,i=await t.connectOrConstruct("store",r,n.toString());i.referenceMode=!1,await i.set(r.newInstance(this.id,e))}static async deserialize({serialization:e,pecFactories:t,slotComposer:n,loader:r,fileName:i,context:s,inspectorFactory:o}){const a=await _a.parse(e,{loader:r,fileName:i,context:s}),c=new Ei({id:Xe.fromString(a.meta.name),storageKey:a.meta.storageKey,slotComposer:n,pecFactories:t,loader:r,storageProviderFactory:a.storageProviderFactory,context:s,inspectorFactory:o});await Promise.all(a.stores.map(async e=>{const t=a.storeTags.get(e),n=await e.activate();await c._registerStore(n.baseStore,t)}));const l=a.activeRecipe.clone(),h={errors:new Map};return d()(l.normalize(h),`Couldn't normalize recipe ${l.toString()}:\n${[...h.errors.values()].join("\n")}`),await c.instantiate(l),c}get context(){return this._context}get activeRecipe(){return this._activeRecipe}get allRecipes(){return[this.activeRecipe].concat(this.context.allRecipes)}get recipes(){return[this.activeRecipe]}get recipeDeltas(){return this._recipeDeltas}loadedParticleSpecs(){return[...this.loadedParticleInfo.values()].map(({spec:e})=>e)}async reinstantiateParticle(e){const t=await this._getParticleInstantiationInfo(e);this.pec.reinstantiate(e,t.stores)}async _instantiateParticle(e){e.id||(e.id=this.generateID("particle"));const t=await this._getParticleInstantiationInfo(e);this.pec.instantiate(e,t.stores)}async _getParticleInstantiationInfo(e){const t={spec:e.spec,stores:new Map};this.loadedParticleInfo.set(e.id.toString(),t),e.isJavaParticle()||await this._provisionSpecUrl(e.spec);for(const[n,r]of Object.entries(e.connections))if("`slot"!==r.handle.fate){const e=this.findStoreById(r.handle.id);d()(e,`can't find store of id ${r.handle.id}`),d()(void 0!==t.spec.handleConnectionMap.get(n),"can't connect handle to a connection that doesn't exist"),t.stores.set(n,e)}return t}async _provisionSpecUrl(e){if(!e.implBlobUrl&&this.loader&&this.loader.provisionObjectUrl){const t=await this.loader.provisionObjectUrl(e.implFile);if(!t)throw new Error(`Expected url for ${e.implFile} but got ${t}`);e.setImplBlobUrl(t)}}generateID(e=""){return this.idGenerator.newChildId(this.id,e)}get _stores(){return[...this.storesById.values()]}async cloneForSpeculativeExecution(){const e=new Ei({id:this.generateID(),pecFactories:this.pecFactories,context:this.context,loader:this._loader,speculative:!0,innerArc:this.isInnerArc,inspectorFactory:this.inspectorFactory}),t=new Map;for(const n of this._stores){const r=await e.storageProviderFactory.construct(n.id,n.type,"volatile");await r.cloneFrom(await n.activate()),t.set(n,r),this.storeDescriptions.has(n)&&e.storeDescriptions.set(r,this.storeDescriptions.get(n))}this.loadedParticleInfo.forEach((n,r)=>{const i=new Map;n.stores.forEach((e,n)=>i.set(n,t.get(e))),e.loadedParticleInfo.set(r,{spec:n.spec,stores:i})});const{cloneMap:n}=this._activeRecipe.mergeInto(e._activeRecipe);this._recipeDeltas.forEach(t=>e._recipeDeltas.push({particles:t.particles.map(e=>n.get(e)),handles:t.handles.map(e=>n.get(e)),slots:t.slots.map(e=>n.get(e)),patterns:t.patterns}));for(const[t,r]of this.innerArcsByParticle.entries())e.innerArcsByParticle.set(n.get(t),await Promise.all(r.map(async e=>e.cloneForSpeculativeExecution())));for(const n of t.values())await e._registerStore(n,[]);return e}async instantiate(e){d()(e.isResolved(),`Cannot instantiate an unresolved recipe: ${e.toString({showUnresolved:!0})}`),d()(e.isCompatible(this.modality),`Cannot instantiate recipe ${e.toString()} with [${e.modality.names}] modalities in '${this.modality.names}' arc`);const t=await this.instantiateMutex.acquire();try{await this._doInstantiate(e)}finally{t()}}async mergeIntoActiveRecipe(e){const{handles:t,particles:n,slots:r}=e.mergeInto(this._activeRecipe);this._recipeDeltas.push({particles:n,handles:t,slots:r,patterns:e.patterns}),r.forEach(e=>e.id=e.id||this.generateID("slot").toString()),t.forEach(e=>{e.toSlot()&&(e.id=e.id||this.generateID("slandle").toString())});for(const e of t){const t=this.context.findStoreById(e.id);if(["copy","create"].includes(e.fate)||"map"===e.fate&&t instanceof ci&&t.isBackedByManifest()){let t=e.type;"create"===e.fate&&d()(t.maybeEnsureResolved(),`Can't assign resolved type to ${t}`),t=t.resolvedType(),d()(t.isResolved(),`Can't create handle for unresolved type ${t}`);const n=await this.createStore(t,null,this.generateID().toString(),e.tags,e.immediateValue?"volatile":null);if(e.immediateValue){const t=e.immediateValue,r=e.type;d()(r instanceof Ht&&r.interfaceInfo.particleMatches(t));const i=t.clone().toLiteral();i.id=n.id,await n.set(i)}else if(["copy","map"].includes(e.fate)){const t=this.context.findStoreById(e.id),r=await t.activate();d()(r,`Cannot find store ${e.id}`),d()(null!==t.version,`Copied store ${e.id} doesn't have version.`);const i=await n.activate();await i.cloneFrom(r),this._tagStore(n,this.context.findStoreTags(t)),n.storeInfo.name=t.name&&`Copy of ${t.name}`;const s=this.getStoreDescription(t);s&&this.storeDescriptions.set(n,s)}e.id=n.id,e.fate="use",e.storageKey=n.storageKey}else if(!this.storesById.has(e.id)&&"`slot"!==e.fate){let t=e.storageKey;t||(t=this.keyForId(e.id)),d()(t,`couldn't find storage key for handle '${e}'`);const n=e.type.resolvedType();if(d()(n.isResolved()),"string"!=typeof t)throw new Error("Need to implement storageNG code path here!");{const r=await this.storageProviderFactory.connect(e.id,n,t);d()(r,`store '${e.id}' was not found (${t})`),await this._registerStore(r,e.tags)}}}return{handles:t,particles:n,slots:r}}async _doInstantiate(e){const{handles:t,particles:n,slots:r}=await this.mergeIntoActiveRecipe(e);await Promise.all(n.map(e=>this._instantiateParticle(e))),this.pec.slotComposer&&await this.pec.slotComposer.initializeRecipe(this,n),this.inspector&&await this.inspector.recipeInstantiated(n,this.activeRecipe.toString())}async createStore(e,t,n,r,i){d()(e instanceof jt,`can't createStore with type ${e} that isn't a Type`),e instanceof Ut&&(e=new $t(e)),null==n&&(n=this.generateID().toString()),null==i&&("string"==typeof this.storageKey?i=this.storageProviderFactory.parseStringAsKey(this.storageKey).childKeyForHandle(n).toString():this.storageKey&&(i=this.storageKey.childKeyForHandle(n)));let s;if((null==i||(e=>e&&e.includes("volatile"))(r))&&(i=an.useNewStorageStack?new bi(this.id,n):"volatile"),an.useNewStorageStack){if("string"==typeof i)throw new Error("Can't use string storage keys with the new storage stack.");s=new Rt({storageKey:i,exists:tt.ShouldCreate,type:e,id:n,name:t})}else{if("string"!=typeof i)throw new Error("Can't use new-style storage keys with the old storage stack.");s=await this.storageProviderFactory.construct(n,e,i),d()(s,`failed to create store with id [${n}]`),s.storeInfo.name=t}return await this._registerStore(s,r),s}async _registerStore(e,t){d()(!this.storesById.has(e.id),`Store already registered '${e.id}'`),t=t||[],t=Array.isArray(t)?t:[t],this.storesById.set(e.id,e),this.storeTags.set(e,new Set(t)),this.storageKeys[e.id]=e.storageKey,(await e.activate()).on(async()=>this._onDataChange()),rs.getRuntime().registerStore(e,t)}_tagStore(e,t){d()(this.storesById.has(e.id)&&this.storeTags.has(e),`Store not registered '${e.id}'`);const n=this.storeTags.get(e);(t=t||new Set).forEach(e=>n.add(e))}_onDataChange(){for(const e of this.dataChangeCallbacks.values())e();return!0}onDataChange(e,t){this.dataChangeCallbacks.set(t,e)}clearDataChange(e){this.dataChangeCallbacks.delete(e)}static _typeToKey(e){const t=e.getContainedType();if(t){const e=this._typeToKey(t);if(e)return`list:${e}`}else{if(e instanceof Ft)return e.entitySchema.name;if(e instanceof Ht)return e.interfaceInfo;if(e instanceof Lt&&e.isResolved())return Ei._typeToKey(e.resolvedType())}return null}findStoresByType(e,t){const n=Ei._typeToKey(e);let r=[...this.storesById.values()].filter(t=>{if(n){const e=Ei._typeToKey(t.type);if(n===e)return!0}else{if(e instanceof Lt&&!e.isResolved()&&t.type instanceof Ft)return!0;const n=e.getContainedType();if(n&&n instanceof Lt&&!n.isResolved()&&e.tag===t.type.tag)return!0}return!1});return t&&t.tags&&t.tags.length>0&&(r=r.filter(e=>0===t.tags.filter(t=>!this.storeTags.get(e).has(t)).length)),r.filter(t=>!!pr.effectiveType(e,[{type:t.type,direction:t.type instanceof Ht?"host":"inout"}]))}findStoreById(e){const t=this.storesById.get(e);return null==t?this._context.findStoreById(e):t}findStoreTags(e){return this.storeTags.has(e)?this.storeTags.get(e):this._context.findStoreTags(e)}getStoreDescription(e){return d()(e,"Cannot fetch description for nonexistent store"),this.storeDescriptions.get(e)||e.description}getVersionByStore({includeArc:e=!0,includeContext:t=!1}){const n={};return e&&this.storesById.forEach((e,t)=>n[t]=e.version),t&&this._context.allStores.forEach(e=>n[e.id]=e.version),n}keyForId(e){return this.storageKeys[e]}toContextString(){const e=[];return[...this.storesById.values()].sort(Tt).forEach(t=>{e.push(t.toManifestString({handleTags:[...this.storeTags.get(t)]}))}),this._activeRecipe.isEmpty()||e.push(this._activeRecipe.toString()),e.join("\n")}get apiChannelMappingId(){return this.id.toString()}get idGeneratorForTesting(){return this.idGenerator}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ki{constructor(){this.map=new Map,this.nextID=0}getOrCreateCache(e){return this.map.has(e)||this.map.set(e,new Map),this.map.get(e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var Ti='\n  icon {\n    font-family: "Material Icons";\n    font-size: 24px;\n    font-style: normal;\n    -webkit-font-feature-settings: "liga";\n    -webkit-font-smoothing: antialiased;\n    cursor: pointer;\n    user-select: none;\n    flex-shrink: 0;\n    /* partial FOUC prevention */\n    display: inline-block;\n    width: 24px;\n    height: 24px;\n    overflow: hidden;\n  }\n  icon[hidden] {\n    /* required because of display rule above,\n    display rule required for overflow: hidden */\n    display: none;\n  }\n';
/**
 * @license
 * Copyright (c) 2016 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const xi=function(e,t,n){n=n||[];for(const r in t){const i=t[r];if(i){const t=e.childNodes[r];n[i.key]=t.nodeType===Node.TEXT_NODE?t.parentElement:t,i.sub&&xi(t,i.sub,n)}}return n},Ri=function(e,t,n){if(Ii(e,t,n,"textContent",e.textContent))return e.textContent="",!0},Oi=function(e,t,n){if(e.hasAttributes()){let r=!1;for(let i,s=e.attributes,o=s.length-1;o>=0&&(i=s[o]);o--)(Pi(e,t,n,i.name,i.value)||Ii(e,t,n,i.name,i.value)||Ni(e,t,n,i.name,i.value))&&(e.removeAttribute(i.name),r=!0);return r}},Ii=function(e,t,n,r,i){if("{{"===i.slice(0,2)){"class"===r&&(r="className");let e=i.slice(2,-2);const s=e.split(":");return 2===s.length&&(r=s[0],e=s[1]),Ai(n,t,"mustaches",r,e),"$"===e[0]&&Ai(n,"xlate",e,!0),!0}},Pi=function(e,t,n,r,i){if("on-"===r.slice(0,3))return"{{"===i.slice(0,2)&&(i=i.slice(2,-2),console.warn(`Xen: event handler for '${r}' expressed as a mustache, which is not supported. Using literal value '${i}' instead.`)),Ai(n,t,"events",r.slice(3),i),!0},Ni=function(e,t,n,r,i){if("xen:forward"===r)return Ai(n,t,"events","xen:forward",i),!0},Ai=function(e,t,n,r,i){const s=e[t]||(e[t]=Object.create(null));(s[n]||(s[n]={}))[r]=i},Di=new class{constructor(e){this.cb=e}annotate(e,t,n){return this.notes=t,this.opts=n||0,this.key=this.opts.key||0,t.locator=this._annotateSubtree(e),t}_annotateSubtree(e){let t;for(let n,r=0,i=e.firstChild,s=null;i;r++){const o=this._annotateNode(i);o&&((t=t||{})[r]=o),(n=s?s.nextSibling:e.firstChild)===i?(s=i,i=i.nextSibling):(i=n,r--)}return t}_annotateNode(e){const t=this.key++,n=this.cb(e,t,this.notes,this.opts),r=this._annotateSubtree(e);if(n||r){const e=Object.create(null);return e.key=t,r&&(e.sub=r),e}}}(function(e,t,n,r){let i=!1;switch(r.annotator&&r.annotator(e,t,n,r)&&(i=!0),e.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:break;case Node.ELEMENT_NODE:return i||Oi(e,t,n);case Node.TEXT_NODE:return i||Ri(e,t,n)}return i}),Mi=function(e,t,n){for(const r in e){const i=t[r],s=e[r]&&e[r].events;if(i&&s)for(const e in s)n(i,e,s[e])}},ji=function(e,t,n,r){const i=t.slice(-1);if("style%"===t||"style"===t||"xen:style"===t)"string"==typeof n?e.style.cssText=n:Object.assign(e.style,n);else if("$"==i){const r=t.slice(0,-1);"boolean"==typeof n||void 0===n?Fi(e,r,Boolean(n)):e.setAttribute(r,n)}else"textContent"===t?n&&(n.$template||n.template)?Li(e,n,r):e.textContent=n||"":"unsafe-html"===t?e.innerHTML=n||"":"value"===t?e.value!==n&&(e.value=n):e[t]=n},Fi=function(e,t,n){e[(void 0===n?!e.hasAttribute(t):n)?"setAttribute":"removeAttribute"](t,"")},Li=function(e,t,n){let{template:r,models:i}=t;if(r)r=Hi(r);else{r=e.getRootNode().querySelector(`template[${t.$template}]`)}$i(e,n,r,i)},$i=function(e,t,n,r){let i,s=e.firstElementChild;for(n&&r&&r&&r.forEach((r,o)=>{if(i=s&&s.nextElementSibling,!s){const r=Bi(n).events(t);(s=r.root.firstElementChild)&&(s._subtreeDom=r,e.appendChild(s),!n._shapeWarning&&r.root.firstElementChild&&(n._shapeWarning=!0,console.warn("xen-template: subtemplate has multiple root nodes: only the first is used.",n)))}s&&(s._subtreeDom.set(r),s=i)});s;)i=s.nextElementSibling,s.remove(),s=i},Bi=function(e,t){const n=function(e,t,n){return e._notes||(e._notes=Di.annotate(e.content,{},t,n))}(e=Hi(e),t),r=document.importNode(e.content,!0),i=r.firstElementChild,s=xi(r,n.locator);return{root:r,notes:n,map:s,firstElement:i,$(e){return this.root.querySelector(e)},set:function(e){return e&&function(e,t,n,r){if(n)for(const i in e){const s=t[i];if(s){s.scope=n;const t=e[i].mustaches;for(const e in t){const i=t[e];i in n&&ji(s,e,n[i],r)}}}}(n,s,e,this.controller),this},events:function(e){return e&&"function"!=typeof e&&(e=function(e,t,n,r){t.addEventListener(n,function(t){return e[r]?e[r](t,t.detail):e.defaultHandler?e.defaultHandler(r,t):void 0})}.bind(this,e)),this.controller=e,e&&Mi(n,s,e),this},forward:function(){return Mi(n,s,(e,t,n)=>{e.addEventListener(t,r=>{const i={eventName:t,handlerName:n,detail:r.detail,target:r.target};Ui(e,"xen:forward",i,{bubbles:!0})})}),this},appendTo:function(e){return this.root?e.appendChild(this.root):console.warn("Xen: cannot appendTo, template stamped no DOM"),this.root=e,this}}},Ui=(e,t,n,r)=>{const i=r||{};i.detail=n;const s=new CustomEvent(t,i);return e.dispatchEvent(s),s.detail},Hi=e=>"string"==typeof e?zi(e):e,zi=e=>Object.assign(document.createElement("template"),{innerHTML:e}),qi={createTemplate:zi,setBoolAttribute:Fi,stamp:Bi,takeNote:Ai};
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Wi{}Wi.alwaysTrue=(()=>!0),Wi.alwaysFalse=(()=>!1);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Vi{constructor(e,t=null){this.slotConsumers=[],this.id=e,this.sourceSlotConsumer=t}addSlotConsumer(e){this.slotConsumers.push(e),e.slotContext=this}clearSlotConsumers(){this.slotConsumers.forEach(e=>e.slotContext=null),this.slotConsumers.length=0}}class Ki extends Vi{constructor(e,t,n){super(e,t),this._containerAvailable=!1,d()(t),this.storeId=n,t.addHostedSlotContexts(this)}onRenderSlot(e,t,n){this.sourceSlotConsumer.arc.pec.innerArcRender(this.sourceSlotConsumer.consumeConn.particle,this.sourceSlotConsumer.consumeConn.name,this.id,e.formatHostedContent(t))}addSlotConsumer(e){super.addSlotConsumer(e),this.containerAvailable&&e.startRender()}get containerAvailable(){return this._containerAvailable}set containerAvailable(e){if(this._containerAvailable!==e){this._containerAvailable=e;for(const t of this.slotConsumers)e?t.startRender():t.stopRender()}}}class Qi extends Vi{constructor(e,t,n,r,i,s=null){super(e,s),this.tags=[],d()(Boolean(r)!==Boolean(i),"Exactly one of either container or slotSpec may be set"),d()(Boolean(i)==Boolean(i),"Spec and source slot can only be set together"),this.name=t,this.tags=n||[],this._container=r,this.spec=i||new pn({name:t}),this.sourceSlotConsumer&&this.sourceSlotConsumer.directlyProvidedSlotContexts.push(this),this.handles=this.spec&&this.sourceSlotConsumer?this.spec.handles.map(e=>this.sourceSlotConsumer.consumeConn.particle.connections[e].handle).filter(e=>void 0!==e):[]}onRenderSlot(e,t,n){e.setContent(t,n)}get container(){return this._container}get containerAvailable(){return Boolean(this._container)}static createContextForContainer(e,t,n,r){return new Qi(e,t,r,n,null)}isSameContainer(e){return this.spec.isSet?Boolean(this.container)===Boolean(e)&&(!this.container||Object.keys(this.container).length===Object.keys(e).length&&Object.keys(this.container).every(t=>Object.keys(e).some(e=>e===t))&&Object.values(this.container).every(t=>Object.values(e).some(e=>e===t))):!e&&!this.container||this.container===e}set container(e){if(this.isSameContainer(e))return;const t=this.container;this._container=e,this.slotConsumers.forEach(e=>e.onContainerUpdate(this.container,t))}addSlotConsumer(e){super.addSlotConsumer(e),this.container&&e.onContainerUpdate(this.container,null)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Gi{constructor(e,t,n){this.directlyProvidedSlotContexts=[],this.hostedSlotContexts=[],this._renderingBySubId=new Map,this.innerContainerBySlotId={},this.arc=e,this.consumeConn=t,this.containerKind=n}getRendering(e){return this._renderingBySubId.get(e)}get renderings(){return[...this._renderingBySubId.entries()]}addRenderingBySubId(e,t){this._renderingBySubId.set(e,t)}addHostedSlotContexts(e){e.containerAvailable=Boolean(this.slotContext&&this.slotContext.containerAvailable),this.hostedSlotContexts.push(e)}get allProvidedSlotContexts(){return[...this.generateProvidedContexts()]}findProvidedContext(e){return this.generateProvidedContexts(e).next().value}*generateProvidedContexts(e=Wi.alwaysTrue){for(const t of this.directlyProvidedSlotContexts)e(t)&&(yield t);for(const t of this.hostedSlotContexts)for(const n of t.slotConsumers)yield*n.generateProvidedContexts(e)}onContainerUpdate(e,t){d()(this.slotContext instanceof Qi,"Container can only be updated in non-hosted context");const n=this.slotContext;if(e!==t){const e=new Map;n&&n.spec.isSet?Object.keys(n.container||{}).forEach(t=>e.set(t,n.container[t])):e.set(void 0,n.container);for(const[t,n]of e){this._renderingBySubId.has(t)||this._renderingBySubId.set(t,{});const e=this.getRendering(t);e.container&&this.isSameContainer(e.container,n)||(e.container&&this.clearContainer(e),e.container=this.createNewContainer(n,t))}for(const[t,n]of this.renderings)e.has(t)||(this.deleteContainer(n.container),this._renderingBySubId.delete(t))}Boolean(e)!==Boolean(t)&&(e?this.startRender():this.stopRender()),this.hostedSlotContexts.forEach(t=>t.containerAvailable=Boolean(e))}createProvidedContexts(){return d()(this.consumeConn.getSlotSpec(),"Missing consume connection spec"),this.consumeConn.getSlotSpec().provideSlotConnections.map(e=>new Qi(this.consumeConn.providedSlots[e.name].id,e.name,[],null,e,this))}updateProvidedContexts(){this.allProvidedSlotContexts.forEach(e=>{e.container=e.sourceSlotConsumer.getInnerContainer(e.id)})}startRender(){if(this.consumeConn&&this.startRenderCallback){const e=new Map(this.allProvidedSlotContexts.map(e=>[e.name,e.id]));this.startRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name,providedSlots:e,contentTypes:this.constructRenderRequest()})}}stopRender(){this.consumeConn&&this.stopRenderCallback&&this.stopRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name})}setContent(e,t){e&&Object.keys(e).length>0&&this.description&&(e.descriptions=this._populateHandleDescriptions()),this.eventHandler=t;for(const[t,n]of this.renderings)this.setContainerContent(n,this.formatContent(e,t),t)}_populateHandleDescriptions(){if(!this.consumeConn)return null;const e=new Map;return Object.values(this.consumeConn.particle.connections).forEach(t=>{t.handle&&(e[`${t.name}.description`]=this.description.getHandleDescription(t.handle).toString())}),e}getInnerContainer(e){return this.innerContainerBySlotId[e]}_initInnerSlotContainer(e,t,n){t?(this.innerContainerBySlotId[e]||(this.innerContainerBySlotId[e]={}),d()(!this.innerContainerBySlotId[e][t],`Multiple ${e}:${t} inner slots cannot be provided`),this.innerContainerBySlotId[e][t]=n):this.innerContainerBySlotId[e]=n}_clearInnerSlotContainers(e){e.forEach(e=>{e?Object.values(this.innerContainerBySlotId).forEach(t=>delete t[e]):this.innerContainerBySlotId={}})}isSameContainer(e,t){return!e&&!t||e===t}constructRenderRequest(){return[]}dispose(){}createNewContainer(e,t){return null}deleteContainer(e){}clearContainer(e){}setContainerContent(e,t,n){}formatContent(e,t){return null}formatHostedContent(e){return null}static clear(e){}static findRootContainers(e){return{}}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Zi=()=>rs.getRuntime().getCacheService().getOrCreateCache("templateByName");let Yi;class Xi extends Gi{constructor(e,t,n){super(e,t,n),this._observer=this._initMutationObserver()}constructRenderRequest(){const e=["model"],t=[this.templatePrefix];return Xi.hasTemplate(t.join("::"))||e.push("template"),e}static hasTemplate(e){return[...Zi().keys()].find(t=>t.startsWith(e))}isSameContainer(e,t){return e.parentNode===t}createNewContainer(e,t){d()(e,"contextContainer cannot be null");const n=document.createElement(this.containerKind||"div");return this.consumeConn&&n.setAttribute("particle-host",this.consumeConn.getQualifiedName()),e.appendChild(n),n.attachShadow({mode:"open"}),n.shadowRoot}deleteContainer(e){(e=e.host||e).parentNode&&e.parentNode.removeChild(e)}formatContent(e,t){d()(this.slotContext instanceof Qi,"Content formatting can only be done for provided SlotContext");const n=this.slotContext.spec,r={};if(Object.keys(e).indexOf("model")>=0)if(e.model){let i;if(!(i=n.isSet&&this.consumeConn.getSlotSpec().isSet?this._modelForSetSlotConsumedAsSetSlot(e.model,t):n.isSet&&!this.consumeConn.getSlotSpec().isSet?this._modelForSetSlotConsumedAsSingletonSlot(e.model,t):this._modelForSingletonSlot(e.model,t)))return;r.model={...i,...e.descriptions}}else r.model=void 0;return e.templateName&&(r.templateName="string"==typeof e.templateName?e.templateName:e.templateName[t],e.template&&(r.template="string"==typeof e.template?e.template:e.template[r.templateName])),r}_modelForSingletonSlot(e,t){return d()(!t,"subId should be absent for a Singleton Slot"),e}_modelForSetSlotConsumedAsSetSlot(e,t){return d()(e.items&&e.items.every(e=>e.subId),"model for a Set Slot consumed as a Set Slot needs to have items array, with every element having subId"),e.items.find(e=>e.subId===t)}_modelForSetSlotConsumedAsSingletonSlot(e,t){return d()(e.subId,"model for a Set Slot consumed as a Singleton Slot needs to have subId"),t===e.subId?e:null}setContainerContent(e,t,n){if(e.container){if(!t||0===Object.keys(t).length)return this.clearContainer(e),void(e.model=null);this._setTemplate(e,this.templatePrefix,t.templateName,t.template),e.model=t.model,this._onUpdate(e)}}clearContainer(e){e.liveDom&&(e.liveDom.root.textContent=""),e.liveDom=null}dispose(){this._observer&&this._observer.disconnect(),this.renderings.forEach(([e,{container:t}])=>this.deleteContainer(t))}static clear(e){e.textContent=""}static clearCache(){Zi().clear()}static findRootContainers(e){const t={};return Array.from(e.querySelectorAll("[slotid]")).forEach(e=>{const n=e.getAttribute("slotid");d()(!t[n],`Duplicate root slot ${n}`),t[n]=e}),t}createTemplateElement(e){return Object.assign(document.createElement("template"),{innerHTML:e})}get templatePrefix(){return this.consumeConn.getQualifiedName()}_setTemplate(e,t,n,r){n&&(e.templateName=[t,n].filter(e=>e).join("::"),r&&(Zi().has(e.templateName)&&this.clearContainer(e),Zi().set(e.templateName,this.createTemplateElement(r))))}_onUpdate(e){if(this._observe(e.container),e.templateName){const t=Zi().get(e.templateName);d()(t,`No template for ${e.templateName}`),this._stampTemplate(e,t)}this._updateModel(e)}_observe(e){d()(e,"Cannot observe without a container"),this._observer&&this._observer.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["subid"]})}_stampTemplate(e,t){if(!e.liveDom){Yi||(Yi=qi.createTemplate(`<style>${Ti}</style>`)),qi.stamp(Yi).appendTo(e.container);const n=this._eventMapper.bind(this,this.eventHandler);e.liveDom=qi.stamp(t).events(n).appendTo(e.container)}}_eventMapper(e,t,n,r){t.addEventListener(n,i=>{i.stopPropagation(),"xen:forward"===n&&(t=i.detail.target,r=i.detail.handlerName);const{altKey:s,ctrlKey:o,metaKey:a,shiftKey:c,code:l,key:h,repeat:u}=i,d={key:t.key,value:t.value,keys:{altKey:s,ctrlKey:o,metaKey:a,shiftKey:c,code:l,key:h,repeat:u}};e({detail:d,handler:r,data:d})})}_updateModel(e){e.liveDom&&e.liveDom.set(e.model)}initInnerContainers(e){Array.from(e.querySelectorAll("[slotid]")).forEach(t=>{if(!this.isDirectInnerSlot(e,t))return;const n=this.getNodeValue(t,"slotid"),r=this.findProvidedContext(e=>e.id===n);if(!r)return void console.warn(`Slot ${this.consumeConn.getSlotSpec().name} has unexpected inner slot ${n}`);const i=this.getNodeValue(t,"subid");d()(Boolean(i)===r.spec.isSet,`Sub-id ${i} for slot ${r.name} doesn't match set spec: ${r.spec.isSet}`),r.sourceSlotConsumer._initInnerSlotContainer(n,i,t)})}getNodeValue(e,t){return e[t]||e.getAttribute(t)}isDirectInnerSlot(e,t){if(t===e)return!0;const n=e=>e.parentNode;let r=n(t);for(;r;){if(r===e)return!0;if(r.getAttribute&&r.getAttribute("slotid"))return!1;r=n(r)}return!1}_initMutationObserver(){return this.consumeConn?new MutationObserver(async e=>{this._observer.disconnect();const t=new Map;for(const[n,{container:r}]of this.renderings)e.some(e=>this.isDirectInnerSlot(r,e.target))&&t.set(n,r);const n=[...t.values()];n.length>0&&(this._clearInnerSlotContainers([...t.keys()]),n.forEach(e=>this.initInnerContainers(e)),this.updateProvidedContexts(),n.forEach(e=>this._observe(e)))}):null}formatHostedContent(e){if(e.templateName){if("string"!=typeof e.templateName)throw new Error("TODO: Implement this!");e.templateName=`${this.consumeConn.getQualifiedName()}::${e.templateName}`}return e}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ji extends Xi{constructor(e,t){super(e,t),this._content={},this.contentAvailable=new Promise(e=>this._contentAvailableResolve=e)}setContent(e,t){super.setContent(e,t),e?(this._content.templateName=e.templateName,e.template&&(this._content.template=e.template),this._content.model=e.model,this._contentAvailableResolve()):this._content={}}createNewContainer(e,t){return e}isSameContainer(e,t){return e===t}getInnerContainer(e){const t=Array.from(this.renderings,([e,{model:t}])=>t)[0],n=this.findProvidedContext(t=>t.id===e);if(n){if(n.spec.isSet&&t&&t.items&&t.items.models){const e={};for(const n of t.items.models)d()(n.id),e[n.id]=n.id;return e}return e}console.warn(`Cannot find provided spec for ${e} in ${this.consumeConn.getQualifiedName()}`)}createTemplateElement(e){return e}static findRootContainers(e){return e}static clear(e){}_onUpdate(e){}_stampTemplate(e){}_initMutationObserver(){return null}_observe(){}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class es{constructor(e,t){this.slotConsumerClass=e,this.descriptionFormatter=t}static createHeadlessHandler(){return new es(Ji)}}es.headlessHandler=new es(Ji),es.basicHandler=new es(Gi,_r),es.domHandler=new es(Xi,class extends _r{constructor(){super(...arguments),this.nextID=0}_isSelectedDescription(e){return super._isSelectedDescription(e)||!!e.template&&!!e.model}_combineSelectedDescriptions(e,t){const n=new Map;for(const r of e){if(this.seenParticles.has(r._particle))continue;let{template:e,model:i}=this._retrieveTemplateAndModel(r,n.size,t||{});Object.keys(i).map(t=>this._initSubTokens(i[t],r).map(n=>{const r=this.tokenToString(n);if(null==r)return!1;if(r&&r.template&&r.model)e=e.replace(`{{${t}}}`,r.template),delete i[t],i={...i,...r.model};else{const n=`${t}${++this.nextID}`;e=e.replace(`{{${t}}}`,`{{${n}}}`),delete i[t],i[n]=r}return!0}).every(e=>!!e)).every(e=>!!e)&&n.set(r,{template:e,model:i})}const r=[];if(e.forEach(e=>{n.has(e)&&r.push(n.get(e))}),r.length>0){const e=this._joinDescriptions(r);return t&&t.skipFormatting||(e.template+="."),e}}_retrieveTemplateAndModel(e,t,n){if(e._template_&&e._model_)return{template:e._template_,model:JSON.parse(e._model_)};d()(e.pattern,"Description must contain template and model, or pattern");let r="";const i={};return this._initTokens(e.pattern,e).forEach((e,s)=>{if(e.text)r=r.concat(`${0!==t||0!==s||n.skipFormatting?e.text:e.text[0].toUpperCase()+e.text.slice(1)}`);else{const t=e.fullName.replace(/[.{}_$]/g,"");let o="";0!==s||n.skipFormatting||(r=r.concat("<style>\n            [firstletter]::first-letter { text-transform: capitalize; }\n            [firstletter] {display: inline-block}\n            </style>"),o=" firstletter"),r=r.concat(`<span${o}>{{${t}}}</span>`),i[t]=e.fullName}}),{template:r,model:i}}_capitalizeAndPunctuate(e){if("string"==typeof e)return{template:super._capitalizeAndPunctuate(e),model:{}};const t=e.template.match(/<[a-zA-Z0-9]+>{{([a-zA-Z0-9]*)}}<\/[a-zA-Z0-9]+>/);if(t&&t.length>1&&e.model[t[1]]){const n=e.model[t[1]];n.length>0&&(e.model[t[1]]=`${n[0].toUpperCase()}${n.substr(1)}`)}return e.template+=".",e}_joinDescriptions(e){if(e.every(e=>"string"==typeof e))return super._joinDescriptions(e);const t={template:"",model:{}},n=e.length;return e.forEach((e,r)=>{let i;"string"==typeof e&&(e={template:e,model:{}}),t.template+=e.template,t.model={...t.model,...e.model},r<n-2?i=", ":r===n-2&&(i=["",""," and ",", and "][Math.min(3,n)]),i&&(t.template+=i)}),t}_joinTokens(e){if(e.every(e=>"string"==typeof e))return super._joinTokens(e);const t=(e=e.map(e=>"object"!=typeof e?{template:`<span>{{text${++this.nextID}}}</span>`,model:{[`text${this.nextID}`]:e}}:e)).filter(e=>e&&!!e.template&&!!e.model);return{template:t.map(e=>e.template).join(""),model:t.map(e=>e.model).reduce((e,t)=>({...e,...t}),{})}}_combineDescriptionAndValue(e,t,n){if(t.template&&t.model)return{template:`${t.template} (${n.template})`,model:{...t.model,...n.model}};const r=`${e.handleName}Description${++this.nextID}`;return{template:`<span>{{${r}}}</span> (${n.template})`,model:{[r]:t,...n.model}}}_formatEntityProperty(e,t,n){const r=`${e}${t.join("")}Value${++this.nextID}`;return{template:`<b>{{${r}}}</b>`,model:{[`${r}`]:n}}}_formatCollection(e,t){const n=`${e}${++this.nextID}`;return t[0].rawData.name?t.length>2?{template:`<b>{{${n}FirstName}}</b> plus <b>{{${n}OtherCount}}</b> other items`,model:{[`${n}FirstName`]:t[0].rawData.name,[`${n}OtherCount`]:t.length-1}}:{template:t.map((e,t)=>`<b>{{${n}${t}}}</b>`).join(", "),model:Object.assign({},...t.map((e,t)=>({[`${n}${t}`]:e.rawData.name})))}:{template:`<b>{{${n}Length}}</b> items`,model:{[`${n}Length`]:t.length}}}_formatBigCollection(e,t){return{template:`collection of items like {{${e}FirstName}}`,model:{[`${e}FirstName`]:t.rawData.name}}}_formatSingleton(e,t){const n=super._formatSingleton(e,t);if(n)return{template:`<b>{{${e}Var}}</b>`,model:{[`${e}Var`]:n}}}});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class ts{constructor(e){if(this._consumers=[],this._contexts=[],d()(e.modalityHandler,`Missing or invalid modality handler: ${e.modalityHandler}`),e.rootContainer=e.rootContainer||e.rootContext||(e.containers||Object).root,d()(void 0!==e.rootContainer!=(!0===e.noRoot),"Root container is mandatory unless it is explicitly skipped"),this._containerKind=e.containerKind,e.modalityName&&(this.modality=de.create([e.modalityName])),this.modalityHandler=e.modalityHandler,e.noRoot)return;const t=e.containers||this.modalityHandler.slotConsumerClass.findRootContainers(e.rootContainer)||{};0===Object.keys(t).length&&(t.root=e.rootContainer),Object.keys(t).forEach(e=>{this._contexts.push(Qi.createContextForContainer(`rootslotid-${e}`,e,t[e],[`${e}`]))})}get consumers(){return this._consumers}get containerKind(){return this._containerKind}getSlotConsumer(e,t){return this.consumers.find(n=>n.consumeConn.particle===e&&n.consumeConn.name===t)}findContainerByName(e){const t=this.findContextsByName(e);if(0===t.length)console.warn(`No containers for '${e}'`);else if(1===t.length)return t[0].container;console.warn(`Ambiguous containers for '${e}'`)}findContextsByName(e){return this._contexts.filter(e=>e instanceof Qi).filter(t=>t.name===e)}findContextById(e){return this._contexts.find(({id:t})=>t===e)}createHostedSlot(e,t,n,r){const i=this.getSlotConsumer(t,n);d()(i,`Transformation particle ${t.name} with consumed ${n} not found`);const s=e.generateID("slot").toString();return this._contexts.push(new Ki(s,i,r)),s}_addSlotConsumer(e){e.startRenderCallback=e.arc.pec.startRender.bind(e.arc.pec),e.stopRenderCallback=e.arc.pec.stopRender.bind(e.arc.pec),this._consumers.push(e)}async initializeRecipe(e,t){const n=[];t.forEach(t=>{t.getSlandleConnections().forEach(r=>{if(!r.targetSlot)return void d()(!r.getSlotSpec().isRequired,`No target slot for particle's ${t.name} required consumed slot: ${r.name}.`);const i=new this.modalityHandler.slotConsumerClass(e,r,this._containerKind),s=i.createProvidedContexts();this._contexts=this._contexts.concat(s),n.push(i)})}),n.forEach(e=>{this._addSlotConsumer(e);const t=this.findContextById(e.consumeConn.targetSlot.id);d()(t,`No context found for ${e.consumeConn.getQualifiedName()}`),t.addSlotConsumer(e)});const r=this.consumers.map(e=>e.arc),i=[...new Set(r).values()],s=await Promise.all(i.map(e=>vr.create(e))),o=new Map(s.map((e,t)=>[i[t],e]));for(const e of this.consumers)e.description=o.get(e.arc)}renderSlot(e,t,n){const r=this.getSlotConsumer(e,t);d()(r,`Cannot find slot (or hosted slot) ${t} for particle ${e.name}`),n={...n},r.slotContext.onRenderSlot(r,n,async n=>{if(r.arc.pec.sendEvent(e,t,n),n.data&&n.data.key)for(const e of r.hostedSlotContexts)if(e.storeId)for(const t of e.slotConsumers){const r=t.arc.findStoreById(e.storeId);d()(r),r.get().then(e=>{e&&e.id===n.data.key&&t.arc.pec.sendEvent(t.consumeConn.particle,t.consumeConn.name,n)})}})}getAvailableContexts(){return this._contexts}dispose(){this.consumers.forEach(e=>e.dispose()),this._contexts.forEach(e=>{e.clearSlotConsumers(),e instanceof Qi&&e.container&&this.modalityHandler.slotConsumerClass.clear(e.container)}),this._contexts=this._contexts.filter(e=>!e.sourceSlotConsumer),this._consumers.length=0}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ns extends ts{constructor(e={}){void 0===e.modalityHandler&&(e.modalityHandler=es.createHeadlessHandler()),super({rootContainer:{root:"root-context"},...e})}renderSlot(e,t,n){super.renderSlot(e,t,n);const r=this.getSlotConsumer(e,t);r&&r.updateProvidedContexts()}get contexts(){return this._contexts}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class rs{constructor(e,t,n){this.arcById=new Map,this.cacheService=new ki,this.loader=e,this.composerClass=t,this.context=n||new _a({id:"manifest:default"}),this.ramDiskMemory=new wi,is=this}static getRuntime(){return null==is&&(is=new rs),is}static clearRuntimeForTesting(){null!==is&&(is.destroy(),is=null)}static newForNodeTesting(e){return new rs(new Un,ns,e)}getCacheService(){return this.cacheService}getRamDiskMemory(){return this.ramDiskMemory}destroy(){}newArc(e,t,n){const r=Ye.newSession().newArcId(e),i=this.composerClass?new this.composerClass:null;if("string"==typeof t){const e=t+r.toString();return new Ei({id:r,storageKey:e,loader:this.loader,slotComposer:i,context:this.context,...n})}{const e=t(r);return new Ei({id:r,storageKey:e,loader:this.loader,slotComposer:i,context:this.context,...n})}}runArc(e,t,n){return this.arcById.has(e)||this.arcById.set(e,this.newArc(e,t,n)),this.arcById.get(e)}stop(e){d()(this.arcById.has(e),`Cannot stop nonexistent arc ${e}`),this.arcById.get(e).dispose(),this.arcById.delete(e)}findArcByParticleId(e){return[...this.arcById.values()].find(t=>!!t.activeRecipe.findParticle(e))}registerStore(e,t){!this.context.findStoreById(e.id)&&t.includes("shared")&&this.context._addStore(e,t)}unregisterStore(e,t){if(!t.includes("shared"))return;const n=this.context.stores.findIndex(t=>t.id===e);if(n>=0){const e=this.context.stores[n];this.context.storeTags.delete(e),this.context.stores.splice(n,1)}}static async getArcDescription(e){return(await vr.create(e)).getArcDescription()}static async parseManifest(e,t){return _a.parse(e,t)}static async loadManifest(e,t,n){return _a.load(e,t,n)}}let is=null;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ss extends fr{constructor(e){super();let t=e.split("://");this.protocol=t[0],d()("volatile"===this.protocol,`can't construct volatile key for protocol ${this.protocol} (input key ${e})`),t=t[1]?t.slice(1).join("://").split("^^"):[],this.arcId=t[0],this.location=t[1],d()(this.toString()===e,`Expected ${e}, but got ${this.toString()} volatile key base.`)}base(){return"volatile"}get arcId(){return this._arcId}set arcId(e){this._arcId=e}childKeyForHandle(e){return new ss("volatile")}childKeyForArcInfo(){return new ss(`${this.protocol}://${this.arcId}^^arc-info`)}childKeyForSuggestions(e,t){return new ss(`${this.protocol}://${this.arcId}^^${e}/suggestions/${t}`)}childKeyForSearch(e){return new ss(`${this.protocol}://${this.arcId}^^${e}/search`)}toString(){return void 0!==this.location&&void 0!==this.arcId?`${this.protocol}://${this.arcId}^^${this.location}`:void 0!==this.arcId?`${this.protocol}://${this.arcId}`:`${this.protocol}`}}const os=()=>rs.getRuntime().getCacheService().getOrCreateCache("volatileStorageCache");class as extends gr{constructor(){super(...arguments),this.backingStore=null,this.pendingBackingStore=null}static newProvider(e,t,n,r,i){return e instanceof $t?new cs(e,t,n,r,i):e instanceof Bt?new us(e,t,n,r,i):new ls(e,t,n,r,i)}async ensureBackingStore(){if(this.backingStore)return this.backingStore;if(!this.pendingBackingStore){const e=this.storageEngine.baseStorageKey(this.backingType());this.pendingBackingStore=this.storageEngine.baseStorageFor(this.backingType(),e),await this.pendingBackingStore.then(e=>this.backingStore=e)}return this.pendingBackingStore}fromLiteral({version:e,model:t}){}}class cs extends as{constructor(e,t,n,r,i){super(e,n,r,i),this._model=new mn,this.storageEngine=t,d()(null!==this.version)}backingType(){return this.type.getContainedType()}async clone(){const e=new cs(this.type,this.storageEngine,this.name,this.id,null);return await e.cloneFrom(this),e}async cloneFrom(e){this.referenceMode=e.referenceMode;const t=await e.toLiteral();if(this.referenceMode&&t.model.length>0){await Promise.all([this.ensureBackingStore(),e.ensureBackingStore()]),t.model=t.model.map(({id:e,value:t})=>({id:e,value:{id:t.id,storageKey:this.backingStore.storageKey}}));const n=await e.backingStore.getMultiple(t.model.map(({id:e})=>e));await this.backingStore.storeMultiple(n,[this.storageKey])}this.fromLiteral(t)}async modelForSynchronization(){const e=await this._toList();return{version:this.version,model:e}}async toLiteral(){return{version:this.version,model:this._model.toLiteral()}}fromLiteral({version:e,model:t}){this.version=e,this._model=new mn(t)}async _toList(){if(this.referenceMode){const e=(await this.toLiteral()).model;if(0===e.length)return[];const t=new Set;e.forEach(e=>t.add(e.value.storageKey)),d()(1===t.size,"multiple storageKeys in reference set of collection not yet supported.");t.values().next().value;await this.ensureBackingStore();const n=e.map(e=>e.value.id),r=await this.backingStore.getMultiple(n),i=[];for(let t=0;t<r.length;t++)i.push({id:n[t],value:r[t],keys:e[t].keys});return i}return(await this.toLiteral()).model}async toList(){return(await this._toList()).map(e=>e.value)}async getMultiple(e){return d()(!this.referenceMode,"getMultiple not implemented for referenceMode stores"),e.map(e=>this._model.getValue(e))}async storeMultiple(e,t,n=null){d()(!this.referenceMode,"storeMultiple not implemented for referenceMode stores"),e.map(e=>this._model.add(e.id,e,t)),this.version++}async get(e){if(this.referenceMode){const t=this._model.getValue(e);return null==t?null:(await this.ensureBackingStore(),await this.backingStore.get(t.id))}return this._model.getValue(e)}traceInfo(){return{items:this._model.size}}async store(e,t,n=null){d()(null!=t&&t.length>0,"keys required");const r={value:e,keys:t,effective:void 0};if(this.referenceMode){const n=this.type.getContainedType(),i=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(n);r.effective=this._model.add(e.id,{id:e.id,storageKey:i},t),await this.ensureBackingStore(),await this.backingStore.store(e,t)}else r.effective=this._model.add(e.id,e,t);this.version++,await this._fire(new yr({add:[r],version:this.version,originatorId:n}))}async removeMultiple(e,t=null){0===e.length&&(e=this._model.toList().map(e=>({id:e.id,keys:[]})));const n=e.map(e=>{const t={id:e.id,keys:e.keys.length?e.keys:this._model.getKeys(e.id),value:this._model.getValue(e.id)};return null!==t.value&&(t.effective=this._model.remove(e.id,t.keys)),t});this.version++,await this._fire(new yr({remove:n,version:this.version,originatorId:t}))}async remove(e,t=[],n=null){0===t.length&&(t=this._model.getKeys(e));const r=this._model.getValue(e);if(null!==r){const i=this._model.remove(e,t);this.version++,await this._fire(new yr({remove:[{value:r,keys:t,effective:i}],version:this.version,originatorId:n}))}}clearItemsForTesting(){this._model=new mn}}class ls extends as{constructor(e,t,n,r,i){super(e,n,r,i),this.localKeyId=0,this.storageEngine=t,this._stored=null,this.backingStore=null}backingType(){return this.type}async clone(){const e=new ls(this.type,this.storageEngine,this.name,this.id,null);return await e.cloneFrom(this),e}async cloneFrom(e){this.referenceMode=e.referenceMode,e.referenceMode&&e.localModified&&await e._persistChanges();const t=await e.toLiteral();if(this.referenceMode&&t.model.length>0){await Promise.all([this.ensureBackingStore(),e.ensureBackingStore()]),t.model=t.model.map(({id:e,value:t})=>({id:e,value:{id:t.id,storageKey:this.backingStore.storageKey}}));const n=await e.backingStore.getMultiple(t.model.map(({id:e})=>e));await this.backingStore.storeMultiple(n,[this.storageKey])}await this.fromLiteral(t)}async modelForSynchronization(){if(this.referenceMode&&null!==this._stored){const e=this._stored;await this.ensureBackingStore();const t=await this.backingStore.get(e.id);return{version:this.version,model:[{id:e.id,value:t}]}}return super.modelForSynchronization()}async toLiteral(){const e=this._stored,t=null!=e?[{id:e.id,value:e,keys:[]}]:[];return{version:this.version,model:t}}fromLiteral({version:e,model:t}){const n=0===t.length?null:t[0].value;this.referenceMode&&n&&n.rawData&&d()(!1,`shouldn't have rawData ${JSON.stringify(n.rawData)} here`),d()(void 0!==n),this._stored=n,this.version=e}traceInfo(){return{stored:null!==this._stored}}async get(){if(this.referenceMode&&this._stored){const e=this._stored;return await this.ensureBackingStore(),await this.backingStore.get(e.id)}return this._stored}async set(e,t=null,n=null){if(d()(void 0!==e),this.referenceMode&&e){const t=this.type,n=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(t);this._stored={id:e.id,storageKey:n},await this.ensureBackingStore(),await this.backingStore.store(e,[this.storageKey+this.localKeyId++])}else{if(JSON.stringify(this._stored)===JSON.stringify(e)&&null==n)return;this._stored=e}this.version++;const r=this.referenceMode?e:this._stored;await this._fire(new yr({data:r,version:this.version,originatorId:t,barrier:n}))}async clear(e=null,t=null){await this.set(null,e,t)}}class hs{constructor(e,t,n,r){this.version=e,this.pageSize=n;const i=[...t];i.sort((e,t)=>e.index-t.index),this.data=i.map(e=>e.value),r||this.data.reverse()}async next(){return 0===this.data.length?{done:!0}:{value:this.data.splice(0,this.pageSize),done:!1}}close(){this.data=[]}}class us extends as{constructor(e,t,n,r,i){super(e,n,r,i),this.items=new Map,this.cursors=new Map,this.cursorIndex=0}enableReferenceMode(){d()(!1,"referenceMode is not supported for BigCollection")}backingType(){return this.type.getContainedType()}async get(e){const t=this.items.get(e);return void 0!==t?t.value:null}async store(e,t,n){d()(null!=t&&t.length>0,"keys required"),this.version++,this.items.has(e.id)||this.items.set(e.id,{index:null,value:null,keys:{}});const r=this.items.get(e.id);r.index=this.version,r.value=e,t.forEach(e=>r.keys[e]=this.version)}async remove(e,t,n){this.version++,this.items.delete(e)}async stream(e,t=!0){d()(!isNaN(e)&&e>0),this.cursorIndex++;const n=new hs(this.version,this.items.values(),e,t);return this.cursors.set(this.cursorIndex,n),this.cursorIndex}async cursorNext(e){const t=this.cursors.get(e);if(!t)return{done:!0};const n=await t.next();return n.done&&this.cursors.delete(e),n}async cursorClose(e){const t=this.cursors.get(e);t&&(this.cursors.delete(e),t.close())}cursorVersion(e){const t=this.cursors.get(e);return t?t.version:null}async cloneFrom(e){e.items&&this.fromLiteral(e.toLiteral())}async toLiteral(){const e=[];for(const[t,{index:n,value:r,keys:i}]of this.items.entries())e.push({id:t,index:n,value:r,keys:Object.keys(i)});return{version:this.version,model:e}}fromLiteral({version:e,model:t}){this.version=e,this.items.clear();for(const{id:e,index:n,value:r,keys:i}of t){const t={};for(const e of i)t[e]=n;this.items.set(e,{index:n,value:r,keys:t})}}clearItemsForTesting(){this.items.clear()}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var ds,ps;!function(e){e[e.arc=1]="arc"}(ds||(ds={})),function(e){e[e.handles=1]="handles"}(ps||(ps={}));class fs extends fr{constructor(e,t){super();const n=e.match(/^synthetic:\/\/([^\/]+)\/([^\/]+)\/(.+)$/);if(null===n||4!==n.length)throw new Error(`invalid synthetic key: ${e}`);if(this.scope=ds[n[1]],this.category=ps[n[2]],this.scope!==ds.arc)throw new Error(`invalid scope '${n[1]}' for synthetic key: ${e}`);{this.targetType=new Wt;const e=t.parseStringAsKey(n[3]).childKeyForArcInfo();this.targetKey=e.toString()}if(this.category!==ps.handles)throw new Error(`invalid category '${n[2]}' for synthetic key: ${e}`);this.syntheticType=new Vt}get protocol(){return"synthetic"}base(){return d()(!1,"base not supported for synthetic keys"),null}get arcId(){return d()(!1,"arcId not supported for synthetic keys"),null}childKeyForHandle(e){return d()(!1,"childKeyForHandle not supported for synthetic keys"),null}childKeyForArcInfo(){return d()(!1,"childKeyForArcInfo not supported for synthetic keys"),null}childKeyForSuggestions(e,t){return d()(!1,"childKeyForSuggestions not supported for synthetic keys"),null}childKeyForSearch(e){return d()(!1,"childKeyForSearch not supported for synthetic keys"),null}toString(){return`${this.protocol}://${ds[this.scope]}/${ps[this.category]}/${this.targetKey}`}}class ms extends gr{constructor(e,t,n,r,i){super(e,void 0,t,n),this.model=[],this.backingStore=void 0,this.targetStore=r,this.storageFactory=i,this.initialized=(async()=>{const e=await r.get();await this.process(e,!1),r.legacyOn(e=>this.process(e.data,!0))})()}async process(e,t){let n;try{if(e){const t=await _a.parse(We.extractSerialization(e),{});n=t.activeRecipe&&t.activeRecipe.handles}}catch(e){console.warn(`Error parsing manifest at ${this.storageKey}:\n${e.message}`)}const r=this.model;this.model=[];for(const e of n||[])if(this.storageFactory.isPersistent(e.storageKey)){if("string"!=typeof e.storageKey)throw new Error("Can't use old storage stack with NG StorageKey objects");this.model.push(new Ve(e.id,e.storageKey,e.mappedType,e.tags))}if(t){const e=function(e,t,n){const r={add:[],remove:[]},i=new Map,s=new Map,o=new Map;for(const t of e){const e=n(t);i.set(e,t),s.set(e,t)}for(const e of t){const t=n(e);i.set(t,e),o.set(t,e)}for(const[e,t]of i)if(s.has(e)){if(o.has(e))continue;r.remove.push(t)}else d()(o.has(e)),r.add.push(t);return r}(r,this.model,JSON.stringify),t=e.add.map(e=>({value:e})),n=e.remove.map(e=>({value:e}));await this._fire(new yr({add:t,remove:n}))}}async toList(){return await this.initialized,this.model}async toLiteral(){throw new Error("unimplemented")}async cloneFrom(){throw new Error("cloneFrom should never be called on SyntheticCollection!")}async ensureBackingStore(){throw new Error("ensureBackingStore should never be called on SyntheticCollection!")}async getMultiple(e){throw new Error("unimplemented")}async storeMultiple(e,t,n){throw new Error("unimplemented")}async removeMultiple(e,t){throw new Error("unimplemented")}async get(e){throw new Error("unimplemented")}remove(e,t,n){throw new Error("unimplemented")}store(e,t,n){throw new Error("unimplemented")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const ys={volatile:{storage:class extends mr{constructor(e){super(e),this._memoryMap={},this._typeMap={},this.localIDBase=0,this.typePromiseMap={},os().set(this.arcId.toString(),this)}async construct(e,t,n){const r=await this._construct(e,t,n);return t instanceof qt||t instanceof Bt?r:t.isTypeContainer()&&t.getContainedType()instanceof qt?r:(r.enableReferenceMode(),r)}async _construct(e,t,n){const r=this.constructKey(n);let i=this._memoryMap[r];return i||(i=as.newProvider(t,this,void 0,e,r),this._memoryMap[r]=i),i}constructKey(e){const t=new ss(e);return void 0===t.arcId&&(t.arcId=this.arcId.toString()),void 0===t.location&&(t.location="volatile-"+this.localIDBase++),t.toString()}async connect(e,t,n){const r=new ss(n);return r.arcId!==this.arcId.toString()?null==os().get(r.arcId)?null:os().get(r.arcId).connect(e,t,n):void 0===this._memoryMap[n]?null:this._memoryMap[n]}baseStorageKey(e){const t=new ss("volatile");return t.arcId=this.arcId.toString(),t.location="volatile-"+e.toString(),t.toString()}async baseStorageFor(e,t){if(this._typeMap[t])return this._typeMap[t];if(this.typePromiseMap[t])return this.typePromiseMap[t];const n=this._construct(e.toString(),e.collectionOf(),t);this.typePromiseMap[t]=n;const r=await n;return d()(r,`could not construct baseStorage for key ${t}`),this._typeMap[t]=r,r}parseStringAsKey(e){const t=new ss(e);return void 0===t.arcId&&(t.arcId=this.arcId.toString()),t}},isPersistent:!1},synthetic:{storage:class extends mr{constructor(e,t){super(e),this.storageFactory=t}async construct(e,t,n){throw new Error("cannot construct SyntheticStorage providers; use connect")}async connect(e,t,n){d()(null===t,"SyntheticStorage does not accept a type parameter");const r=new fs(n,this.storageFactory),i=await this.storageFactory.connect(e,r.targetType,r.targetKey);return null===i?null:new ms(r.syntheticType,e,n,i,this.storageFactory)}async baseStorageFor(e,t){throw new Error("baseStorageFor not implemented for SyntheticStorage")}baseStorageKey(e,t){throw new Error("baseStorageKey not implemented for SyntheticStorage")}parseStringAsKey(e){return new fs(e,this.storageFactory)}},isPersistent:!1}};class gs{constructor(e){this.arcId=e,this.mutexMap=new Map,this._storageInstances={},Object.keys(ys).forEach(t=>{const{storage:n,isPersistent:r}=ys[t];this._storageInstances[t]={storage:new n(e,this),isPersistent:r}})}static register(e,t){ys[e]=t}getInstance(e){const t=this._storageInstances[e.split(":")[0]];if(!t)throw new Error(`unknown storage protocol: ${e}`);return t}_storageForKey(e){if(!e)throw new Error("key is required");return this.getInstance(e).storage}isPersistent(e){return e&&this.getInstance(e).isPersistent}async construct(e,t,n){return await this._storageForKey(n).construct(e,t,n)}async connect(e,t,n){return await this._storageForKey(n).connect(e,t,n)}async _acquireMutexForKey(e){return this.mutexMap.has(e)||this.mutexMap.set(e,new vi),this.mutexMap.get(e).acquire()}async connectOrConstruct(e,t,n){const r=this._storageForKey(n),i=await this._acquireMutexForKey(n);try{let s=await r.connect(e,t,n);return null==s&&(s=await r.construct(e,t,n)),s}finally{i()}}async baseStorageFor(e,t){return await this._storageForKey(t).baseStorageFor(e,t)}baseStorageKey(e,t){return this._storageForKey(t).baseStorageKey(e,t)}parseStringAsKey(e){return this._storageForKey(e).parseStringAsKey(e)}newKey(e,t){}async shutdown(){for(const e of Object.values(this._storageInstances))await e.storage.shutdown()}}var _s=n(5),vs=_s.a,bs=(n(88),"firebasestorage.googleapis.com"),ws=12e4,Ss=6e4,Cs=-9007199254740991,Es=function(){function e(e,t){this.code_=Ts(e),this.message_="Firebase Storage: "+t,this.serverResponse_=null,this.name_="FirebaseError"}return e.prototype.codeProp=function(){return this.code},e.prototype.codeEquals=function(e){return Ts(e)===this.codeProp()},e.prototype.serverResponseProp=function(){return this.serverResponse_},e.prototype.setServerResponseProp=function(e){this.serverResponse_=e},Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),e}(),ks={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ts(e){return"storage/"+e}function xs(){return new Es(ks.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Rs(){return new Es(ks.CANCELED,"User canceled the upload/download.")}function Os(){return new Es(ks.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Is(e,t,n){return new Es(ks.INVALID_ARGUMENT,"Invalid argument in `"+t+"` at index "+e+": "+n)}function Ps(){return new Es(ks.APP_DELETED,"The Firebase app was deleted.")}function Ns(e,t){return new Es(ks.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function As(e){throw new Es(ks.INTERNAL_ERROR,"Internal error: "+e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ds={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function Ms(e){switch(e){case Ds.RAW:case Ds.BASE64:case Ds.BASE64URL:case Ds.DATA_URL:return;default:throw"Expected one of the event types: ["+Ds.RAW+", "+Ds.BASE64+", "+Ds.BASE64URL+", "+Ds.DATA_URL+"]."}}var js=function(){return function(e,t){this.data=e,this.contentType=t||null}}();function Fs(e,t){switch(e){case Ds.RAW:return new js(Ls(t));case Ds.BASE64:case Ds.BASE64URL:return new js($s(e,t));case Ds.DATA_URL:return new js(function(e){var t=new Bs(e);return t.base64?$s(Ds.BASE64,t.rest):function(e){var t;try{t=decodeURIComponent(e)}catch(e){throw Ns(Ds.DATA_URL,"Malformed data URL.")}return Ls(t)}(t.rest)}(t),function(e){return new Bs(e).contentType}(t))}throw xs()}function Ls(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else t.push(239,191,189);else 56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function $s(e,t){switch(e){case Ds.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw Ns(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Ds.BASE64URL:var i=-1!==t.indexOf("+"),s=-1!==t.indexOf("/");if(i||s)throw Ns(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var o;try{o=atob(t)}catch(t){throw Ns(e,"Invalid character found")}for(var a=new Uint8Array(o.length),c=0;c<o.length;c++)a[c]=o.charCodeAt(c);return a}var Bs=function(){return function(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw Ns(Ds.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=t[1]||null;null!=n&&(this.base64=(r=n,i=";base64",r.length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1);var r,i;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}}();var Us,Hs={STATE_CHANGED:"state_changed"},zs={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},qs={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ws(e){switch(e){case zs.RUNNING:case zs.PAUSING:case zs.CANCELING:return qs.RUNNING;case zs.PAUSED:return qs.PAUSED;case zs.SUCCESS:return qs.SUCCESS;case zs.CANCELED:return qs.CANCELED;case zs.ERROR:default:return qs.ERROR}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vs(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ks(e,t){for(var n in e)Vs(e,n)&&t(n,e[n])}function Qs(e){if(null==e)return{};var t={};return Ks(e,function(e,n){t[e]=n}),t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gs(e){return new Promise(e)}function Zs(e){return Promise.resolve(e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ys(e){return null!=e}function Xs(e){return void 0!==e}function Js(e){return"function"==typeof e}function eo(e){return"object"==typeof e}function to(e){return eo(e)&&null!==e}function no(e){return"string"==typeof e||e instanceof String}function ro(e){return io()&&e instanceof Blob}function io(){return"undefined"!=typeof Blob}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Us||(Us={}));
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var so=function(){function e(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Us.NO_ERROR,this.sendPromise_=Gs(function(t,n){e.xhr_.addEventListener("abort",function(n){e.errorCode_=Us.ABORT,t(e)}),e.xhr_.addEventListener("error",function(n){e.errorCode_=Us.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(n){t(e)})})}return e.prototype.send=function(e,t,n,r){var i=this;if(this.sent_)throw As("cannot .send() more than once");(this.sent_=!0,this.xhr_.open(t,e,!0),Ys(r))&&Ks(r,function(e,t){i.xhr_.setRequestHeader(e,t.toString())});return Ys(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},e.prototype.getErrorCode=function(){if(!this.sent_)throw As("cannot .getErrorCode() before sending");return this.errorCode_},e.prototype.getStatus=function(){if(!this.sent_)throw As("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}},e.prototype.getResponseText=function(){if(!this.sent_)throw As("cannot .getResponseText() before sending");return this.xhr_.responseText},e.prototype.abort=function(){this.xhr_.abort()},e.prototype.getResponseHeader=function(e){return this.xhr_.getResponseHeader(e)},e.prototype.addUploadProgressListener=function(e){Ys(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",e)},e.prototype.removeUploadProgressListener=function(e){Ys(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",e)},e}(),oo=function(){function e(){}return e.prototype.createXhrIo=function(){return new so},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ao(e){var t,n;try{t=JSON.parse(e)}catch(e){return null}return eo(n=t)&&!Array.isArray(n)?t:null}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var co=function(){function e(e,t){this.bucket=e,this.path_=t}return Object.defineProperty(e.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),e.prototype.fullServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)},e.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},e.makeFromBucketSpec=function(t){var n,r;try{n=e.makeFromUrl(t)}catch(n){return new e(t,"")}if(""===n.path)return n;throw r=t,new Es(ks.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")},e.makeFromUrl=function(t){var n=null;var r=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");for(var i=bs.replace(/[.]/g,"\\."),s=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(e){e.path_=decodeURIComponent(e.path)}}],o=0;o<s.length;o++){var a=s[o],c=a.regex.exec(t);if(c){var l=c[a.indices.bucket],h=c[a.indices.path];h||(h=""),n=new e(l,h),a.postModify(n);break}}if(null==n)throw function(e){return new Es(ks.INVALID_URL,"Invalid URL '"+e+"'.")}(t);return n},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lo(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ho(e){return"https://"+bs+"/v0"+e}function uo(e){var t=encodeURIComponent,n="?";return Ks(e,function(e,r){var i=t(e)+"="+t(r);n=n+i+"&"}),n=n.slice(0,-1)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function po(e,t){return t}var fo=function(){return function(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||po}}(),mo=null;function yo(){if(mo)return mo;var e=[];e.push(new fo("bucket")),e.push(new fo("generation")),e.push(new fo("metageneration")),e.push(new fo("name","fullPath",!0));var t=new fo("name");t.xform=function(e,t){return function(e){return!no(e)||e.length<2?e:lo(e=e)}(t)},e.push(t);var n=new fo("size");return n.xform=function(e,t){return Ys(t)?+t:t},e.push(n),e.push(new fo("timeCreated")),e.push(new fo("updated")),e.push(new fo("md5Hash",null,!0)),e.push(new fo("cacheControl",null,!0)),e.push(new fo("contentDisposition",null,!0)),e.push(new fo("contentEncoding",null,!0)),e.push(new fo("contentLanguage",null,!0)),e.push(new fo("contentType",null,!0)),e.push(new fo("metadata","customMetadata",!0)),mo=e}function go(e,t,n){for(var r={type:"file"},i=n.length,s=0;s<i;s++){var o=n[s];r[o.local]=o.xform(r,t[o.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){var n=e.bucket,r=e.fullPath,i=new co(n,r);return t.makeStorageReference(i)}})}(r,e),r}function _o(e,t,n){var r=ao(t);return null===r?null:go(e,r,n)}function vo(e,t){for(var n={},r=t.length,i=0;i<r;i++){var s=t[i];s.writable&&(n[s.server]=e[s.local])}return JSON.stringify(n)}function bo(e){if(!(e&&eo(e)))throw"Expected Metadata object.";for(var t in e){var n=e[t];if("customMetadata"===t){if(!eo(n))throw"Expected object for 'customMetadata' mapping."}else if(to(n))throw"Mapping for '"+t+"' cannot be an object."}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wo(e,t,n){for(var r=t.length,i=t.length,s=0;s<t.length;s++)if(t[s].optional){r=s;break}var o,a,c,l,h,u;if(!(r<=n.length&&n.length<=i))throw o=r,a=i,c=e,l=n.length,o===a?(h=o,u=1===o?"argument":"arguments"):(h="between "+o+" and "+a,u="arguments"),new Es(ks.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+c+"`: Expected "+h+" "+u+", received "+l+".");for(s=0;s<n.length;s++)try{t[s].validator(n[s])}catch(t){throw t instanceof Error?Is(s,e,t.message):Is(s,e,t)}}var So=function(){return function(e,t){var n=this;this.validator=function(t){n.optional&&!Xs(t)||e(t)},this.optional=!!t}}();function Co(e,t){function n(e){if(!no(e))throw"Expected string."}var r,i,s;return e?(i=n,s=e,r=function(e){i(e),s(e)}):r=n,new So(r,t)}function Eo(){return new So(function(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||io()&&e instanceof Blob))throw"Expected Blob or File."})}function ko(e){return new So(bo,e)}function To(){return new So(function(e){if(!(function(e){return"number"==typeof e||e instanceof Number}(e)&&e>=0))throw"Expected a number 0 or greater."})}function xo(e,t){return new So(function(t){if(!(null===t||Ys(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function Ro(e){return new So(function(e){if(null!==e&&!Js(e))throw"Expected a Function."},e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oo(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Io=function(){function e(e,t){var n=0,r="";ro(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}return e.prototype.size=function(){return this.size_},e.prototype.type=function(){return this.type_},e.prototype.slice=function(t,n){if(ro(this.data_)){var r=this.data_,i=(o=t,a=n,(s=r).webkitSlice?s.webkitSlice(o,a):s.mozSlice?s.mozSlice(o,a):s.slice?s.slice(o,a):null);return null===i?null:new e(i)}var s,o,a;return new e(new Uint8Array(this.data_.buffer,t,n-t),!0)},e.getBlob=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(io()){var r=t.map(function(t){return t instanceof e?t.data_:t});return new e(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Oo();if(void 0!==n){for(var r=new n,i=0;i<e.length;i++)r.append(e[i]);return r.getBlob()}if(io())return new Blob(e);throw Error("This browser doesn't seem to support creating Blobs")}.apply(null,r))}var i=t.map(function(e){return no(e)?Fs(Ds.RAW,e).data:e.data_}),s=0;i.forEach(function(e){s+=e.byteLength});var o=new Uint8Array(s),a=0;return i.forEach(function(e){for(var t=0;t<e.length;t++)o[a++]=e[t]}),new e(o,!0)},e.prototype.uploadData=function(){return this.data_},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Po(e,t){return-1!==e.indexOf(t)}var No=function(){return function(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ao(e){if(!e)throw xs()}function Do(e,t){return function(n,r){var i=_o(e,r,t);return Ao(null!==i),i}}function Mo(e,t){return function(n,r){var i=_o(e,r,t);return Ao(null!==i),function(e,t){var n=ao(t);if(null===n)return null;if(!no(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(t){var n=e.bucket,r=e.fullPath;return ho("/b/"+i(n)+"/o/"+i(r))+uo({alt:"media",token:t})})[0]}(i,r)}}function jo(e){return function(t,n){var r,i,s;return 401===t.getStatus()?r=new Es(ks.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new Es(ks.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Es(ks.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.setServerResponseProp(n.serverResponseProp()),r}}function Fo(e){var t=jo(e);return function(n,r){var i,s=t(n,r);return 404===n.getStatus()&&(i=e.path,s=new Es(ks.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),s.setServerResponseProp(r.serverResponseProp()),s}}function Lo(e,t,n){var r=ho(t.fullServerUrl()),i=e.maxOperationRetryTime(),s=new No(r,"GET",Do(e,n),i);return s.errorHandler=Fo(t),s}function $o(e,t,n){var r=Qs(n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}var Bo=function(){return function(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}();function Uo(e,t){var n;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){Ao(!1)}return Ao(Po(t||["active"],n)),n}function Ho(e,t,n,r,i,s,o,a){var c=new Bo(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Es(ks.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var l=c.total-c.current,h=l;i>0&&(h=Math.min(h,i));var u=c.current,d=u+h,p={"X-Goog-Upload-Command":h===l?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},f=r.slice(u,d);if(null===f)throw Os();var m=t.maxUploadRetryTime(),y=new No(n,"POST",function(e,n){var i,o=Uo(e,["active","final"]),a=c.current+h,l=r.size();return i="final"===o?Do(t,s)(e,n):null,new Bo(a,l,"final"===o,i)},m);return y.headers=p,y.body=f.uploadData(),y.progressCallback=a||null,y.errorHandler=jo(e),y}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zo=function(){return function(e,t,n){if(Js(e)||Ys(t)||Ys(n))this.next=e,this.error=t||null,this.complete=n||null;else{var r=e;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}}}(),qo=function(){return function(e,t,n,r,i,s){this.bytesTransferred=e,this.totalBytes=t,this.state=n,this.metadata=r,this.task=i,this.ref=s}}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Wo(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Zs(!0).then(function(){e.apply(null,t)})}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vo=function(){function e(e,t,n,r,i,s){var o=this;void 0===s&&(s=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=e,this.authWrapper_=t,this.location_=n,this.blob_=i,this.metadata_=s,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=zs.RUNNING,this.errorHandler_=function(e){o.request_=null,o.chunkMultiplier_=1,e.codeEquals(ks.CANCELED)?(o.needToFetchStatus_=!0,o.completeTransitions_()):(o.error_=e,o.transition_(zs.ERROR))},this.metadataErrorHandler_=function(e){o.request_=null,e.codeEquals(ks.CANCELED)?o.completeTransitions_():(o.error_=e,o.transition_(zs.ERROR))},this.promise_=Gs(function(e,t){o.resolve_=e,o.reject_=t,o.start_()}),this.promise_.then(null,function(){})}return e.prototype.makeProgressCallback_=function(){var e=this,t=this.transferred_;return function(n,r){e.updateProgress_(t+n)}},e.prototype.shouldDoResumable_=function(e){return e.size()>262144},e.prototype.start_=function(){this.state_===zs.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},e.prototype.resolveToken_=function(e){var t=this;this.authWrapper_.getAuthToken().then(function(n){switch(t.state_){case zs.RUNNING:e(n);break;case zs.CANCELING:t.transition_(zs.CANCELED);break;case zs.PAUSING:t.transition_(zs.PAUSED)}})},e.prototype.createResumable_=function(){var e=this;this.resolveToken_(function(t){var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o=$o(t,r,i),a={name:o.fullPath},c=ho(s),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=vo(o,n),u=e.maxUploadRetryTime(),d=new No(c,"POST",function(e,t){var n;Uo(e);try{n=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){Ao(!1)}return Ao(no(n)),n},u);return d.urlParams=a,d.headers=l,d.body=h,d.errorHandler=jo(t),d}(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_),r=e.authWrapper_.makeRequest(n,t);e.request_=r,r.getPromise().then(function(t){e.request_=null,e.uploadUrl_=t,e.needToFetchStatus_=!1,e.completeTransitions_()},e.errorHandler_)})},e.prototype.fetchStatus_=function(){var e=this,t=this.uploadUrl_;this.resolveToken_(function(n){var r=function(e,t,n,r){var i=e.maxUploadRetryTime(),s=new No(n,"POST",function(e,t){var n,i=Uo(e,["active","final"]);try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){Ao(!1)}var s=parseInt(n,10);return Ao(!isNaN(s)),new Bo(s,r.size(),"final"===i)},i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=jo(t),s}(e.authWrapper_,e.location_,t,e.blob_),i=e.authWrapper_.makeRequest(r,n);e.request_=i,i.getPromise().then(function(t){t=t,e.request_=null,e.updateProgress_(t.current),e.needToFetchStatus_=!1,t.finalized&&(e.needToFetchMetadata_=!0),e.completeTransitions_()},e.errorHandler_)})},e.prototype.continueUpload_=function(){var e=this,t=262144*this.chunkMultiplier_,n=new Bo(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var s;try{s=Ho(e.location_,e.authWrapper_,r,e.blob_,t,e.mappings_,n,e.makeProgressCallback_())}catch(t){return e.error_=t,void e.transition_(zs.ERROR)}var o=e.authWrapper_.makeRequest(s,i);e.request_=o,o.getPromise().then(function(t){e.increaseMultiplier_(),e.request_=null,e.updateProgress_(t.current),t.finalized?(e.metadata_=t.metadata,e.transition_(zs.SUCCESS)):e.completeTransitions_()},e.errorHandler_)})},e.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},e.prototype.fetchMetadata_=function(){var e=this;this.resolveToken_(function(t){var n=Lo(e.authWrapper_,e.location_,e.mappings_),r=e.authWrapper_.makeRequest(n,t);e.request_=r,r.getPromise().then(function(t){e.request_=null,e.metadata_=t,e.transition_(zs.SUCCESS)},e.metadataErrorHandler_)})},e.prototype.oneShotUpload_=function(){var e=this;this.resolveToken_(function(t){var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var e="",t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;var c=$o(t,r,i),l="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+vo(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",u=Io.getBlob(l,r,h);if(null===u)throw Os();var d={name:c.fullPath},p=ho(s),f=e.maxUploadRetryTime(),m=new No(p,"POST",Do(e,n),f);return m.urlParams=d,m.headers=o,m.body=u.uploadData(),m.errorHandler=jo(t),m}(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_),r=e.authWrapper_.makeRequest(n,t);e.request_=r,r.getPromise().then(function(t){e.request_=null,e.metadata_=t,e.updateProgress_(e.blob_.size()),e.transition_(zs.SUCCESS)},e.errorHandler_)})},e.prototype.updateProgress_=function(e){var t=this.transferred_;this.transferred_=e,this.transferred_!==t&&this.notifyObservers_()},e.prototype.transition_=function(e){if(this.state_!==e)switch(e){case zs.CANCELING:case zs.PAUSING:this.state_=e,null!==this.request_&&this.request_.cancel();break;case zs.RUNNING:var t=this.state_===zs.PAUSED;this.state_=e,t&&(this.notifyObservers_(),this.start_());break;case zs.PAUSED:this.state_=e,this.notifyObservers_();break;case zs.CANCELED:this.error_=Rs(),this.state_=e,this.notifyObservers_();break;case zs.ERROR:case zs.SUCCESS:this.state_=e,this.notifyObservers_()}},e.prototype.completeTransitions_=function(){switch(this.state_){case zs.PAUSING:this.transition_(zs.PAUSED);break;case zs.CANCELING:this.transition_(zs.CANCELED);break;case zs.RUNNING:this.start_()}},Object.defineProperty(e.prototype,"snapshot",{get:function(){var e=Ws(this.state_);return new qo(this.transferred_,this.blob_.size(),e,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),e.prototype.on=function(e,t,n,r){void 0===t&&(t=void 0),void 0===n&&(n=void 0),void 0===r&&(r=void 0);var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",s=Ro(!0).validator,o=xo(null,!0).validator;function a(e){try{return void s(e)}catch(e){}try{if(o(e),!(Xs(e.next)||Xs(e.error)||Xs(e.complete)))throw"";return}catch(e){throw i}}wo("on",[Co(function(t){if(e!==Hs.STATE_CHANGED)throw"Expected one of the event types: ["+Hs.STATE_CHANGED+"]."}),xo(a,!0),Ro(!0),Ro(!0)],arguments);var c=this;function l(e){return function(t,n,i){null!==e&&wo("on",e,arguments);var s=new zo(t,n,r);return c.addObserver_(s),function(){c.removeObserver_(s)}}}var h=[xo(function(e){if(null===e)throw i;a(e)}),Ro(!0),Ro(!0)];return!(Xs(t)||Xs(n)||Xs(r))?l(h):l(null)(t,n,r)},e.prototype.then=function(e,t){return this.promise_.then(e,t)},e.prototype.catch=function(e){return this.then(null,e)},e.prototype.addObserver_=function(e){this.observers_.push(e),this.notifyObserver_(e)},e.prototype.removeObserver_=function(e){var t,n,r;t=this.observers_,n=e,-1!==(r=t.indexOf(n))&&t.splice(r,1)},e.prototype.notifyObservers_=function(){var e,t=this;this.finishPromise_(),(e=this.observers_,Array.prototype.slice.call(e)).forEach(function(e){t.notifyObserver_(e)})},e.prototype.finishPromise_=function(){if(null!==this.resolve_){var e=!0;switch(Ws(this.state_)){case qs.SUCCESS:Wo(this.resolve_.bind(null,this.snapshot))();break;case qs.CANCELED:case qs.ERROR:Wo(this.reject_.bind(null,this.error_))();break;default:e=!1}e&&(this.resolve_=null,this.reject_=null)}},e.prototype.notifyObserver_=function(e){switch(Ws(this.state_)){case qs.RUNNING:case qs.PAUSED:null!==e.next&&Wo(e.next.bind(e,this.snapshot))();break;case qs.SUCCESS:null!==e.complete&&Wo(e.complete.bind(e))();break;case qs.CANCELED:case qs.ERROR:null!==e.error&&Wo(e.error.bind(e,this.error_))();break;default:null!==e.error&&Wo(e.error.bind(e,this.error_))()}},e.prototype.resume=function(){wo("resume",[],arguments);var e=this.state_===zs.PAUSED||this.state_===zs.PAUSING;return e&&this.transition_(zs.RUNNING),e},e.prototype.pause=function(){wo("pause",[],arguments);var e=this.state_===zs.RUNNING;return e&&this.transition_(zs.PAUSING),e},e.prototype.cancel=function(){wo("cancel",[],arguments);var e=this.state_===zs.RUNNING||this.state_===zs.PAUSING;return e&&this.transition_(zs.CANCELING),e},e}(),Ko=function(){function e(e,t){this.authWrapper=e,this.location=t instanceof co?t:co.makeFromUrl(t)}return e.prototype.toString=function(){return wo("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},e.prototype.newRef=function(t,n){return new e(t,n)},e.prototype.mappings=function(){return yo()},e.prototype.child=function(e){wo("child",[Co()],arguments);var t=function(e,t){var n=t.split("/").filter(function(e){return e.length>0}).join("/");return 0===e.length?n:e+"/"+n}(this.location.path,e),n=new co(this.location.bucket,t);return this.newRef(this.authWrapper,n)},Object.defineProperty(e.prototype,"parent",{get:function(){var e=function(e){if(0==e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this.location.path);if(null===e)return null;var t=new co(this.location.bucket,e);return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){var e=new co(this.location.bucket,"");return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return lo(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),e.prototype.put=function(e,t){return void 0===t&&(t=null),wo("put",[Eo(),ko(!0)],arguments),this.throwIfRoot_("put"),new Vo(this,this.authWrapper,this.location,this.mappings(),new Io(e),t)},e.prototype.putString=function(e,t,n){void 0===t&&(t=Ds.RAW),wo("putString",[Co(),Co(Ms,!0),ko(!0)],arguments),this.throwIfRoot_("putString");var r=Fs(t,e),i=Qs(n);return!Ys(i.contentType)&&Ys(r.contentType)&&(i.contentType=r.contentType),new Vo(this,this.authWrapper,this.location,this.mappings(),new Io(r.data,!0),i)},e.prototype.delete=function(){wo("delete",[],arguments),this.throwIfRoot_("delete");var e=this;return this.authWrapper.getAuthToken().then(function(t){var n=function(e,t){var n=ho(t.fullServerUrl()),r=e.maxOperationRetryTime(),i=new No(n,"DELETE",function(e,t){},r);return i.successCodes=[200,204],i.errorHandler=Fo(t),i}(e.authWrapper,e.location);return e.authWrapper.makeRequest(n,t).getPromise()})},e.prototype.getMetadata=function(){wo("getMetadata",[],arguments),this.throwIfRoot_("getMetadata");var e=this;return this.authWrapper.getAuthToken().then(function(t){var n=Lo(e.authWrapper,e.location,e.mappings());return e.authWrapper.makeRequest(n,t).getPromise()})},e.prototype.updateMetadata=function(e){wo("updateMetadata",[ko()],arguments),this.throwIfRoot_("updateMetadata");var t=this;return this.authWrapper.getAuthToken().then(function(n){var r=function(e,t,n,r){var i=ho(t.fullServerUrl()),s=vo(n,r),o=e.maxOperationRetryTime(),a=new No(i,"PATCH",Do(e,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=s,a.errorHandler=Fo(t),a}(t.authWrapper,t.location,e,t.mappings());return t.authWrapper.makeRequest(r,n).getPromise()})},e.prototype.getDownloadURL=function(){wo("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL");var e=this;return this.authWrapper.getAuthToken().then(function(t){var n=function(e,t,n){var r=ho(t.fullServerUrl()),i=e.maxOperationRetryTime(),s=new No(r,"GET",Mo(e,n),i);return s.errorHandler=Fo(t),s}(e.authWrapper,e.location,e.mappings());return e.authWrapper.makeRequest(n,t).getPromise().then(function(e){if(null===e)throw new Es(ks.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})})},e.prototype.throwIfRoot_=function(e){if(""===this.location.path)throw function(e){return new Es(ks.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)},e}(),Qo=function(){function e(e){this.promise_=function(e){return Promise.reject(e)}(e)}return e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){void 0===e&&(e=!1)},e}(),Go=function(){function e(){this.map_={},this.id_=Cs}return e.prototype.addRequest=function(e){var t=this.id_;this.id_++,this.map_[t]=e;var n=this;function r(){delete n.map_[t]}e.getPromise().then(r,r)},e.prototype.clear=function(){Ks(this.map_,function(e,t){t&&t.cancel(!0)}),this.map_={}},e}(),Zo=function(){function e(t,n,r,i,s){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;Ys(o)&&(this.bucket_=e.extractBucket_(o))}this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=s,this.service_=i,this.maxOperationRetryTime_=ws,this.maxUploadRetryTime_=Ss,this.requestMap_=new Go}return e.extractBucket_=function(e){var t=e.storageBucket||null;return null==t?null:co.makeFromBucketSpec(t).bucket},e.prototype.getAuthToken=function(){return null!==this.app_&&Ys(this.app_.INTERNAL)&&Ys(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(e){return null!==e?e.accessToken:null},function(e){return null}):Zs(null)},e.prototype.bucket=function(){if(this.deleted_)throw Ps();return this.bucket_},e.prototype.service=function(){return this.service_},e.prototype.makeStorageReference=function(e){return this.storageRefMaker_(this,e)},e.prototype.makeRequest=function(e,t){if(this.deleted_)return new Qo(Ps());var n=this.requestMaker_(e,t,this.pool_);return this.requestMap_.addRequest(n),n},e.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},e.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},e.prototype.setMaxUploadRetryTime=function(e){this.maxUploadRetryTime_=e},e.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},e.prototype.setMaxOperationRetryTime=function(e){this.maxOperationRetryTime_=e},e}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Yo=function(){function e(e,t,n,r,i,s,o,a,c,l,h){this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=s.slice(),this.callback_=o,this.errorCallback_=a,this.progressCallback_=l,this.timeout_=c,this.pool_=h;var u=this;this.promise_=Gs(function(e,t){u.resolve_=e,u.reject_=t,u.start_()})}return e.prototype.start_=function(){var e=this;function t(t,n){var r,i=e.resolve_,s=e.reject_,o=n.xhr;if(n.wasSuccessCode)try{var a=e.callback_(o,o.getResponseText());Xs(a)?i(a):i()}catch(e){s(e)}else null!==o?((r=xs()).setServerResponseProp(o.getResponseText()),e.errorCallback_?s(e.errorCallback_(o,r)):s(r)):n.canceled?s(r=e.appDelete_?Ps():Rs()):s(r=new Es(ks.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new Xo(!1,null,!0)):this.backoffId_=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e,t,n){var r=1,i=null,s=!1,o=0;function a(){return 2===o}var c=!1;function l(){c||(c=!0,t.apply(null,arguments))}function h(t){i=setTimeout(function(){i=null,e(u,a())},t)}function u(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];c||(e?l.apply(null,arguments):a()||s?l.apply(null,arguments):(r<64&&(r*=2),1===o?(o=2,t=0):t=1e3*(r+Math.random()),h(t)))}var d=!1;function p(e){d||(d=!0,c||(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),setTimeout(function(){s=!0,p(!0)},n),p}(function(t,n){if(n)t(!1,new Xo(!1,null,!0));else{var r=e.pool_.createXhrIo();e.pendingXhr_=r,null!==e.progressCallback_&&r.addUploadProgressListener(i),r.send(e.url_,e.method_,e.body_,e.headers_).then(function(n){null!==e.progressCallback_&&n.removeUploadProgressListener(i),e.pendingXhr_=null;var r=(n=n).getErrorCode()===Us.NO_ERROR,s=n.getStatus();if(r&&!e.isRetryStatusCode_(s)){var o=Po(e.successCodes_,s);t(!0,new Xo(o,n))}else{var a=n.getErrorCode()===Us.ABORT;t(!1,new Xo(!1,null,a))}})}function i(t){var n=t.loaded,r=t.lengthComputable?t.total:-1;null!==e.progressCallback_&&e.progressCallback_(n,r)}},t,this.timeout_)},e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},e.prototype.isRetryStatusCode_=function(e){var t=e>=500&&e<600,n=Po([408,429],e),r=Po(this.additionalRetryCodes_,e);return t||n||r},e}(),Xo=function(){return function(e,t,n){this.wasSuccessCode=e,this.xhr=t,this.canceled=!!n}}();function Jo(e,t,n){var r=uo(e.urlParams),i=e.url+r,s=Qs(e.headers);return function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(s,t),function(e){var t=void 0!==_s.a?_s.a.SDK_VERSION:"AppManager";e["X-Firebase-Storage-Version"]="webjs/"+t}(s),new Yo(i,e.method,s,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,n)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ea,ta,na,ra=function(){function e(e,t,n){if(this.bucket_=null,this.authWrapper_=new Zo(e,function(e,t){return new Ko(e,t)},Jo,this,t),this.app_=e,null!=n)this.bucket_=co.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new co(r,""))}this.internals_=new ia(this)}return e.prototype.ref=function(e){if(wo("ref",[Co(function(e){if(/^[A-Za-z]+:\/\//.test(e))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var t=new Ko(this.authWrapper_,this.bucket_);return null!=e?t.child(e):t},e.prototype.refFromURL=function(e){return wo("refFromURL",[Co(function(e){if(!/^[A-Za-z]+:\/\//.test(e))throw"Expected full URL but got a child path, use ref instead.";try{co.makeFromUrl(e)}catch(e){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new Ko(this.authWrapper_,e)},Object.defineProperty(e.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),e.prototype.setMaxUploadRetryTime=function(e){wo("setMaxUploadRetryTime",[To()],arguments),this.authWrapper_.setMaxUploadRetryTime(e)},e.prototype.setMaxOperationRetryTime=function(e){wo("setMaxOperationRetryTime",[To()],arguments),this.authWrapper_.setMaxOperationRetryTime(e)},Object.defineProperty(e.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),e}(),ia=function(){function e(e){this.service_=e}return e.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Zs(void 0)},e}(),sa="storage";function oa(e,t,n){return new ra(e,new oo,n)}ea=_s.a,ta={TaskState:qs,TaskEvent:Hs,StringFormat:Ds,Storage:ra,Reference:Ko},ea.INTERNAL.registerService(sa,oa,ta,void 0,!0);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class aa extends yt{constructor(e,t,n,r){super("firebase"),this.databaseURL=`${e}.${t}`,this.domain=t,this.projectId=e,this.apiKey=n,this.location=r}toString(){return`${this.protocol}://${this.databaseURL}:${this.apiKey}/${this.location}`}childWithComponent(e){return new aa(this.projectId,this.domain,this.apiKey,`${this.location}/${e}`)}static fromString(e){const t=e.match(/^firebase:\/\/([^.]+)\.([^:]+):([^\/]+)\/(.*)$/);if(!t)throw new Error(`Not a valid FirebaseStorageKey: ${e}.`);const[n,r,i,s,o]=t;return new aa(r,i,s,o)}}class ca{constructor(e){this.appCache=e.getCacheService().getOrCreateCache("firebase-driver")}getApp(e){const t=e.toString();return this.appCache.has(t)||this.appCache.set(t,vs.initializeApp(e)),this.appCache.get(t)}async stopAllApps(){await Promise.all([...this.appCache.values()].map(e=>e.delete())),this.appCache.clear()}static async stop(){await new ca(rs.getRuntime()).stopAllApps()}}class la extends ut{constructor(){super(...arguments),this.appCache=new ca(rs.getRuntime()),this.seenVersion=0,this.seenTag=0,this.nextTag=null,this.pendingModel=null}async init(){const e=this.appCache.getApp(this.storageKey).database().ref(this.storageKey.location),t=await e.once("value");if(this.exists===tt.ShouldCreate&&t.exists())throw new Error(`requested creation of memory location ${this.storageKey} can't proceed as location already exists`);if(this.exists===tt.ShouldExist&&!t.exists())throw new Error(`requested connection to memory location ${this.storageKey} can't proceed as location doesn't exist`);t.exists()?(this.pendingModel=t.val().model||null,this.pendingVersion=t.val().version):await e.transaction(e=>{if(null===e)return{version:0,tag:0}}),this.reference=e}registerReceiver(e){this.receiver=e,null!==this.pendingModel&&(d()(this.pendingModel),e(this.pendingModel,this.pendingVersion),this.pendingModel=null,this.seenVersion=this.pendingVersion),this.reference.on("value",e=>this.remoteStateChanged(e))}async send(e,t){this.nextTag=Math.random();const n=this.nextTag,r=this.seenTag;return(await this.reference.transaction(i=>{if(i){if(i.version!==t-1)return;if(i.tag!==r)return}return{version:t,model:e,tag:n}},(e,t)=>{t&&(this.seenTag=n)},!1)).committed}remoteStateChanged(e){const{model:t,version:n,tag:r}=e.val();n>this.seenVersion&&(this.seenVersion=n,this.seenTag=r,r!==this.nextTag&&this.receiver(t,n))}async write(e,t){throw new Error("Method not implemented.")}async read(e){throw new Error("Method not implemented.")}}class ha{willSupport(e){return"firebase"===e.protocol}async driver(e,t){if(!this.willSupport(e))throw new Error(`This provider does not support storageKey ${e.toString()}`);const n=new la(e,t);return await n.init(),n}static register(){dt.register(new ha)}}ha.register();
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class ua extends yt{constructor(e){super("ramdisk"),this.unique=e}toString(){return`${this.protocol}://${this.unique}`}childWithComponent(e){return new ua(`${this.unique}/${e}`)}static fromString(e){const t=e.match(/^ramdisk:\/\/(.*)$/);if(!t)throw new Error(`Not a valid RamDiskStorageKey: ${e}.`);const n=t[1];return new ua(n)}}class da{willSupport(e){return"ramdisk"===e.protocol}async driver(e,t){if(!this.willSupport(e))throw new Error(`This provider does not support storageKey ${e.toString()}`);const n=rs.getRuntime().getRamDiskMemory();return new Si(e,t,n)}static register(){dt.register(new da)}}da.register();class pa{static getDefaultParsers(){return new Map([["volatile",bi.fromString],["firebase",aa.fromString],["ramdisk",ua.fromString]])}static parse(e){const t=e.match(/^(\w+):\/\/(.*)$/);if(!t)throw new Error("Failed to parse storage key: "+e);const n=t[1],r=this.parsers.get(n);if(!r)throw new Error(`Unknown storage key protocol ${n} in key ${e}.`);return r(e)}static reset(){this.parsers=this.getDefaultParsers()}static addParser(e,t){if(this.parsers.has(e))throw new Error(`Parser for storage key protocol ${e} already exists.`);this.parsers.set(e,t)}}pa.parsers=pa.getDefaultParsers(),function(e){e.Error="error",e.Warning="warning"}(na||(na={}));class fa extends Error{constructor(e,t){super(t),this.severity=na.Error,this.location=e}}class ma extends fa{constructor(e,t){super(e,t),this.severity=na.Warning}}class ya{traverse(e){if(["string","number","boolean"].includes(typeof e)||null===e)return;if(e instanceof Array){for(const t of e)this.traverse(t);return}d()(e.location,"expected manifest node to have `location`"),d()(e.kind,"expected manifest node to have `kind`");let t=!1;const n=()=>{if(!t){t=!0;for(const t of Object.keys(e))["location","kind","model"].includes(t)||this.traverse(e[t])}};this.visit(e,n),n()}visit(e,t){}}const ga=new Set;class _a{constructor({id:e}){if(this._recipes=[],this._imports=[],this._particles={},this._schemas={},this._stores=[],this._interfaces=[],this.storeTags=new Map,this._fileName=null,this._idGenerator=Ye.newSession(),this._storageProviderFactory=void 0,this._meta=new Gn,this._resources={},this.storeManifestUrls=new Map,this.errors=[],d()(e instanceof Xe||"string"==typeof e),e instanceof Xe)this._id=e;else{const t=e.split(":");this._id=Xe._newIdInternal(t[0],t.slice(1))}}get id(){return this._meta.name?Xe.fromString(this._meta.name):this._id}get storageProviderFactory(){if(an.useNewStorageStack)throw new Error("Not present in the new storage stack.");return null==this._storageProviderFactory&&(this._storageProviderFactory=new gs(this.id)),this._storageProviderFactory}get recipes(){return this._recipes}get allRecipes(){return[...new Set(this._findAll(e=>e._recipes))]}get activeRecipe(){return this._recipes.find(e=>"active"===e.annotation)}get particles(){return Object.values(this._particles)}get allParticles(){return[...new Set(this._findAll(e=>Object.values(e._particles)))]}get imports(){return this._imports}get schemas(){return this._schemas}get allSchemas(){return[...new Set(this._findAll(e=>Object.values(e._schemas)))]}get fileName(){return this._fileName}get stores(){return this._stores}get allStores(){return[...this._findAll(e=>e._stores)]}get interfaces(){return this._interfaces}get meta(){return this._meta}get resources(){return this._resources}applyMeta(e){void 0!==this._storageProviderFactory&&d()(e.name===this._meta.name||null==e.name,"can't change manifest ID after storage is constructed"),this._meta.apply(e)}_addStore(e,t){return this._stores.push(e),this.storeTags.set(e,t||[]),e}newStore(e){let t;if(e.source&&this.storeManifestUrls.set(e.id,this.fileName),an.useNewStorageStack){let n=e.storageKey;"string"==typeof n&&(n=pa.parse(n)),t=new Rt({...e,storageKey:n,exists:tt.ShouldCreate})}else{if(e.storageKey instanceof yt)throw new Error("Can't use new-style storage keys with the old storage stack.");t=new ci(e.type,e.id,e.name,e.storageKey,this.storageProviderFactory,e.originalId,e.claims,e.description,e.version,e.source,e.origin,e.referenceMode,e.model)}return this._addStore(t,e.tags)}_find(e){let t=e(this);if(!t)for(const n of this._imports)if(t=n._find(e))break;return t}*_findAll(e){yield*e(this);for(const t of this._imports)yield*t._findAll(e)}findSchemaByName(e){return this._find(t=>t._schemas[e])}findTypeByName(e){const t=this.findSchemaByName(e);if(t)return new Ft(t);const n=this.findInterfaceByName(e);return n?new Ht(n):void 0}findParticleByName(e){return this._find(t=>t._particles[e])}findParticlesByVerb(e){return[...this._findAll(t=>Object.values(t._particles).filter(t=>t.primaryVerb===e))]}findStoreByName(e){return this._find(t=>t._stores.find(t=>t.name===e))}findStoreById(e){return this._find(t=>t._stores.find(t=>t.id===e))}findStoreTags(e){return new Set(this._find(t=>t.storeTags.get(e)))}findManifestUrlForHandleId(e){return this._find(t=>t.storeManifestUrls.get(e))}findStoresByType(e,t={tags:[],subtype:!1}){const n=t.tags||[],r=t.subtype||!1;return[...this._findAll(t=>t._stores.filter(i=>(function(t){const n=e.resolvedType();if(!n.isResolved())return e instanceof $t==t.type instanceof $t&&e instanceof Bt==t.type instanceof Bt;if(r){const[e,r]=jt.unwrapPair(t.type,n);return e instanceof Ft&&r instanceof Ft&&e.entitySchema.isMoreSpecificThan(r.entitySchema)}return Kt.compareTypes({type:t.type},{type:e})})(i)&&function(e,t){return 0===n.filter(n=>!e.storeTags.get(t).includes(n)).length}(t,i)))].filter(t=>!!pr.effectiveType(e,[{type:t.type,direction:t.type instanceof Ht?"host":"inout"}]))}findInterfaceByName(e){return this._find(t=>t._interfaces.find(t=>t.name===e))}findRecipesByVerb(e){return[...this._findAll(t=>t._recipes.filter(t=>t.verbs.includes(e)))]}generateID(e){return this._idGenerator.newChildId(this.id,e)}static async load(e,t,n={}){let{registry:r}=n;return(r=r||{})&&r[e]?await r[e]:(r[e]=(async()=>{const n=await t.loadResource(e);return d()(void 0!==n,`${e} unable to be loaded by Manifest parser`),await _a.parse(n,{fileName:e,loader:t,registry:r})})(),await r[e])}static getErrors(e){return e.errors}static async parse(e,t={}){let{fileName:n,loader:r,registry:i,context:s}=t;i=i||{};const o=`manifest:${n}:`;function a(e){for(const t of e.errors){if(t.key){if(ga.has(t.key))continue;ga.add(t.key)}console.warn(c(t).message)}}function c(t,r){return t instanceof fa||t.location?function(t,r){const i=e.split("\n")[t.location.start.line-1];let s=t.message||"";if(i){let e=1;e=t.location.end.line===t.location.start.line?t.location.end.column-t.location.start.column:i.length-t.location.start.column,e=Math.max(1,e);let o,a="";for(let e=0;e<t.location.start.column-1;e++)a+=" ";for(let t=0;t<e;t++)a+="^";const c=t.severity||na.Error;s=`${o=r?`Parse ${c} in`:`Post-parse processing ${c} caused by`} '${n}' line ${t.location.start.line}.\n${t.message}\n  ${i}\n  ${a}`}const o=new fa(t.location,s);r||(o.stack=t.stack);return o}(t,r):t}let l=[];try{l=Wn(e)}catch(e){throw c(e,!0)}const h=new _a({id:o});h._fileName=n,s&&h._imports.push(s);try{await Promise.all(l.map(async e=>{if("import"===e.kind){if(!r)throw new Error("loader required to parse import statements");const t=r.path(h.fileName),n=r.join(t,e.path);try{h._imports.push(await _a.load(n,r,{registry:i}))}catch(t){h.errors.push(t),h.errors.push(new fa(e.location,`Error importing '${n}'`))}}}));const e=async(e,t)=>{for(const n of l)n.kind===e&&(_a._augmentAstWithTypes(h,n),await t(n))};await e("meta",e=>h.applyMeta(e.items)),await e("resource",e=>this._processResource(h,e)),await e("schema",e=>this._processSchema(h,e)),await e("interface",e=>this._processInterface(h,e)),await e("particle",e=>this._processParticle(h,e,r)),await e("store",e=>this._processStore(h,e,r)),await e("recipe",e=>this._processRecipe(h,e))}catch(e){throw a(h),c(e,!1)}if(a(h),t.throwImportErrors&&h.errors.length>0)throw h.errors[0];return h}static _augmentAstWithTypes(e,t){(new class extends ya{constructor(){super()}visit(t,n){switch(n(),t.kind){case"schema-inline":{const n=[],r=[],i=[];for(const s of t.names){const t=e.resolveTypeName(s);t&&t.schema&&t.schema.isAlias?r.push(t.schema):i.push(s),t&&t.schema&&n.push(t.schema)}const s={};for(let{name:e,type:r}of t.fields){for(const i of n)if(r){const n=i.fields[e];if(n&&!ze.typesEqual(n,r))throw new fa(t.location,`Type of '${e}' does not match schema (${r} vs ${n})`)}else r=i.fields[e];if(!r)throw new fa(t.location,`Could not infer type of '${e}' field`);s[e]=r}let o=new ze(i,s);for(const e of r)if(!(o=ze.union(e,o)))throw new fa(t.location,"Could not merge schema aliases");return void(t.model=new Ft(o))}case"variable-type":{const e=t.constraint&&t.constraint.model;return void(t.model=Lt.make(t.name,e,null))}case"slot-type":{const e={};for(const n of Object.keys(t.fields)){const r=t.fields[n];e[r.name]=r.value}return void(t.model=zt.make(e.formFactor,e.handle))}case"type-name":{const n=e.resolveTypeName(t.name);if(!n)throw new fa(t.location,`Could not resolve type reference to type name '${t.name}'`);if(n.schema)t.model=new Ft(n.schema);else{if(!n.iface)throw new fa(t.location,"Expected {iface} or {schema}");t.model=new Ht(n.iface)}return}case"collection-type":return void(t.model=new $t(t.type.model));case"big-collection-type":return void(t.model=new Bt(t.type.model));case"reference-type":return void(t.model=new qt(t.type.model));default:return}}}).traverse(t)}static _processSchema(e,t){let n;const r={};let i=[...t.names];for(const e of t.items)switch(e.kind){case"schema-field":{const t=e;if(r[t.name])throw new fa(t.location,`Duplicate definition of field '${t.name}'`);r[t.name]=t.type;break}case"description":if(n)throw new fa(e.location,"Duplicate schema description");n=e;break;default:throw new fa(e.location,`unknown parser artifact ${e.kind} while processing schema`)}for(const n of t.parents){const s=e.findSchemaByName(n);if(!s)throw new fa(t.location,`Could not find parent schema '${n}'`);for(const[e,i]of Object.entries(s.fields))if(r[e]&&!ze.typesEqual(r[e],i))throw new fa(t.location,`'${n}' defines incompatible type for field '${e}'`);Object.assign(r,s.fields),i.push(...s.names)}i=[...new Set(i)];const s=t.alias||i[0];if(!s)throw new fa(t.location,"Schema defined without name or alias");const o=new ze(i,r,n);t.alias&&(o.isAlias=!0),e._schemas[s]=o}static _processResource(e,t){e._resources[t.name]=t.data}static _processParticle(e,t,n){if(d()(null==t.implFile||null!==t.args,"no valid body defined for this particle"),t.args||(t.args=[]),t.hasParticleArgument){const n=new ma(t.location,"Particle uses deprecated argument body");n.key="hasParticleArgument",e.errors.push(n)}t.implFile&&n&&(t.implFile=n.join(e.fileName,t.implFile));const r=t=>{for(const n of t){if(n.type&&"type-name"===n.type.kind&&n.type.model&&"Entity"===n.type.model.tag){const t=new ma(n.location,"Particle uses deprecated external schema");t.key="externalSchemas",e.errors.push(t)}n.type=n.type.model,r(n.dependentConnections)}};r(t.args),e._particles[t.name]=new fn(t)}static _processInterface(e,t){const n=[];for(const e of t.args){const t={name:void 0,type:void 0,direction:e.direction};"*"!==e.name&&(t.name=e.name),e.type&&(t.type=e.type.model),n.push(t)}const r=[];for(const e of t.slots)r.push({direction:e.direction,name:e.name,isRequired:e.isRequired,isSet:e.isSet});const i=new Se(t.name,n,r);e._interfaces.push(i)}static _processRecipe(e,t){const n=e._newRecipe(t.name);t.annotation&&(n.annotation=t.annotation),t.triggers&&(n.triggers=t.triggers),t.verbs&&(n.verbs=t.verbs),this._buildRecipe(e,n,t.items)}static _buildRecipe(e,t,n){const r={require:n.filter(e=>"require"===e.kind),handles:n.filter(e=>"handle"===e.kind),byHandle:new Map,requireHandles:n.filter(e=>"requireHandle"===e.kind),particles:n.filter(e=>"particle"===e.kind),byParticle:new Map,slots:n.filter(e=>"slot"===e.kind),bySlot:new Map,byName:new Map,connections:n.filter(e=>"connection"===e.kind),search:n.find(e=>"search"===e.kind),description:n.find(e=>"description"===e.kind)};d()(!(r.handles.length>0&&r.requireHandles.length>0),"Inconsistent handle definitions");const i=r.handles.length>0?r.handles:r.requireHandles;for(const n of i){const i=t.newHandle(),s=n.ref;if(s.id){i.id=s.id;const t=e.findStoreById(i.id);t&&i.mapToStorage(t)}else if(s.name){const t=e.findStoreByName(s.name);d()(t,`Could not find handle ${s.name}`),i.mapToStorage(t)}i.tags=s.tags,n.name&&(d()(!r.byName.has(n.name),`duplicate handle name: ${n.name}`),i.localName=n.name,r.byName.set(n.name,{item:n,handle:i})),i.fate="handle"===n.kind&&n.fate?n.fate:null,r.byHandle.set(i,n)}const s=(t,n)=>{switch(n.targetType){case"particle":{const r=e.findParticleByName(n.particle);if(!r)throw new fa(t.location,`could not find particle '${n.particle}'`);if(null!==n.param&&!r.handleConnectionMap.has(n.param))throw new fa(t.location,`param '${n.param}' is not defined by '${n.particle}'`);return new Yn(r,n.param)}case"localName":if(!r.byName.has(n.name))throw new fa(t.location,`local name '${n.name}' does not exist in recipe`);if(null==n.param&&0===n.tags.length&&r.byName.get(n.name).handle)return new Jn(r.byName.get(n.name).handle);throw new fa(t.location,"references to particles by local name not yet supported");case"tag":return new er(n.tags);default:throw new fa(t.location,`endpoint ${n.targetType} not supported`)}};for(const e of r.connections){const n=s(e,e.from),r=s(e,e.to);t.newConnectionConstraint(n,r,e.direction)}r.search&&(t.search=new cr(r.search.phrase,r.search.tokens));for(const e of r.slots){const n=t.newSlot(void 0);e.ref.id&&(n.id=e.ref.id),e.ref.tags&&(n.tags=e.ref.tags),e.name&&(d()(!r.byName.has(e.name),`Duplicate slot local name ${e.name}`),n.localName=e.name,r.byName.set(e.name,n)),r.bySlot.set(n,e)}for(const n of r.particles){const i=t.newParticle(n.ref.name);if(i.verbs=n.ref.verbs,!(t instanceof hr)&&n.ref.name){const t=e.findParticleByName(n.ref.name);if(!t)throw new fa(n.location,`could not find particle ${n.ref.name}`);i.spec=t.clone()}n.name&&(d()(!r.byName.has(n.name)),i.localName=n.name,r.byName.set(n.name,{item:n,particle:i})),r.byParticle.set(i,n);for(const e of n.slotConnections){if("provide"===e.direction)throw new fa(n.location,"invalid slot connection: provide slot must be dependent");let s=i.getSlotConnectionByName(e.param);if(!s){if(void 0!==i.spec){if(!i.spec.slotConnections.has(e.param))throw new fa(e.location,`Consumed slot '${e.param}' is not defined by '${i.name}'`);e.dependentSlotConnections.forEach(e=>{if(!i.getSlotSpecByName(e.param))throw new fa(e.location,`Provided slot '${e.param}' is not defined by '${i.name}'`)})}s=i.addSlotConnection(e.param)}s.tags=e.tags||[],e.dependentSlotConnections.forEach(e=>{if("consume"===e.direction)throw new fa(n.location,"invalid slot connection: consume slot must not be dependent");if(0!==e.dependentSlotConnections.length)throw new fa(n.location,"invalid slot connection: provide slot must not have dependencies");if(t instanceof hr){const n=t.parent.slots.find(t=>t.localName===e.name);void 0!==n&&(s.providedSlots[e.param]=n,n.sourceConnection=s,n.name=e.param)}let i=s.providedSlots[e.param];if(i){if(e.name)if(r.byName.has(e.name)){const n=r.byName.get(e.name);d()(n!==i),d()(!n.name&&i),d()(!n.sourceConnection&&i.sourceConnection),i.id=n.id,i.tags=n.tags,r.byName.set(e.name,i),t.removeSlot(n)}else r.byName.set(e.name,i);r.bySlot.set(i,e)}else i=r.byName.get(e.name);i||((i=t.newSlot(e.param)).localName=e.name,i.sourceConnection=s,e.name&&(d()(!r.byName.has(e.name)),r.byName.set(e.name,i)),r.bySlot.set(i,e)),s.providedSlots[e.param]||(s.providedSlots[e.param]=i),i.localName=e.name})}}const o=(n,i)=>{let s;"*"===i.param?s=n.addUnnamedConnection():(s=n.connections[i.param])||(s=n.addConnectionName(i.param)),s.tags=i.target?i.target.tags:[];const a=i.dir;if(!nr(a,s.direction))throw new fa(i.location,`'${a}' not compatible with '${s.direction}' param of '${n.name}'`);if("any"===s.direction){if("*"!==i.param&&void 0!==n.spec)throw new fa(i.location,`param '${i.param}' is not defined by '${n.name}'`);s.direction=a}let c,l;if(i.target&&i.target.name){let e=r.byName.get(i.target.name);if(e){if(!e.item)throw new fa(i.location,`did not expect '${e}' expected handle or particle`)}else{const n=t.newHandle();n.tags=[],n.localName=i.target.name,"`consume"===s.direction||"`provide"===s.direction?n.fate="`slot":n.fate="create",n.item={kind:"handle"},e={item:n.item,handle:n},r.byName.set(n.localName,e),r.byHandle.set(n,n.item)}if("handle"===e.item.kind||"requireHandle"===e.item.kind)c=e.handle;else{if("particle"!==e.item.kind)throw new fa(i.location,`did not expect ${e.item.kind}`);l=e.particle}}if(i.target&&i.target.particle){const t=e.findParticleByName(i.target.particle);if(!t)throw new fa(i.target.location,`Could not find hosted particle '${i.target.particle}'`);if(!(c=sr.constructImmediateValueHandle(s,t,e.generateID())))throw new fa(i.target.location,`Hosted particle '${t.name}' does not match interface '${s.name}'`)}if(l){let e;i.target.name?(e=l.connections[i.target.name])||(e=l.addConnectionName(i.target.name)):e=l.addUnnamedConnection(),(c=e.handle)||(c=t.newHandle(),e.connectToHandle(c))}c&&s.connectToHandle(c),i.dependentConnections.forEach(e=>o(n,e))};for(const[e,n]of r.byParticle){for(const t of n.connections)o(e,t);for(const i of n.slotConnections){let n=r.byName.get(i.name);n?(d()(r.bySlot.has(n)),n.name||(n.name=i.param),d()(n===r.byName.get(i.name),`Target slot ${n.name} doesn't match slot connection ${i.param}`)):i.name&&(t instanceof hr&&void 0!==(n=t.parent.slots.find(e=>e.localName===i.name))&&(r.bySlot.set(n,i),i.name&&r.byName.set(i.name,n)),null==n&&((n=t.newSlot(i.param)).localName=i.name,r.byName.set(i.name,n),r.bySlot.set(n,i))),n&&e.getSlotConnectionByName(i.param).connectToSlot(n)}}if(r.description&&r.description.description&&(t.description=r.description.description),r.require)for(const n of r.require){const r=t.newRequireSection();this._buildRecipe(e,r,n.items)}}resolveTypeName(e){const t=this.findSchemaByName(e);if(t)return{schema:t};const n=this.findInterfaceByName(e);return n?{iface:n}:null}createLocalDataStorageKey(){return an.useNewStorageStack?new ua(this.generateID("local-data").toString()):this.storageProviderFactory._storageForKey("volatile").constructKey("volatile")}static async _processStore(e,t,n){const r=t.name;let i=t.id;const s=t.originalId,o=t.type.model;null==i&&(i=`${e._id}store${e._stores.length}`);let a=t.tags;null==a&&(a=[]);const c=[];if(t.claim&&t.claim.tags.forEach(e=>c.push(new rn(!1,e))),"storage"===t.origin)return e.newStore({type:o,name:r,id:i,storageKey:t.source,tags:a,originalId:s,claims:c,description:t.description,version:t.version,origin:t.origin});let l,h,u;if("file"===t.origin){if(!n)throw new fa(t.location,"No loader available for file");t.source=n.join(e.fileName,t.source),l=await n.loadResource(t.source)}else if("resource"===t.origin&&(h=t.source,null==(l=e.resources[h])))throw new fa(t.location,`Resource '${h}' referenced by store '${i}' is not defined in this manifest`);try{u=JSON.parse(l)}catch(e){throw new fa(t.location,`Error parsing JSON from '${h}' (${e.message})'`)}let d,p=null,f=!0;if(o instanceof $t?p=o.collectionType:o instanceof Bt?p=o.bigCollectionType:0===u.length?f=!1:(u=u.slice(u.length-1),p=o),p&&p instanceof Ft){let n=!1;if(u=u.map(t=>{if(null==t)return null;n=n||t.$id;const r=t.$id||e.generateID().toString();return delete t.$id,{id:r,rawData:t}}),!t.id&&!n){i=`${i}:${await Qn(JSON.stringify(u.map(e=>e.rawData)))}`}}if(u.length>0&&u[0].rawData&&u[0].rawData.storageKey){let t=u[0].rawData.storageKey;t=e.findStoreByName(t).storageKey,u=u.map(({id:e,rawData:n})=>({id:e,storageKey:t}))}else u.length>0&&(f=!1);d=o instanceof $t?u.map(e=>({id:e.id,value:e,keys:new Set([e.id])})):o instanceof Bt?u.map(e=>{const t=e.rawData.$index;return delete e.rawData.$index,{id:e.id,index:t,value:e,keys:new Set([e.id])}}):u.map(e=>({id:e.id,value:e}));const m=t.version||0;return e.newStore({type:o,name:r,id:i,storageKey:e.createLocalDataStorageKey(),tags:a,originalId:s,claims:c,description:t.description,version:m,source:t.source,origin:t.origin,referenceMode:f,model:d})}_newRecipe(e){const t=new lr(e);return this._recipes.push(t),t}toString(e={}){const t=[];return this._imports.forEach(n=>{if(e.recursive){t.push(`// import '${n.fileName}'`);n.toString(e);t.push(`${n.toString(e)}`)}else t.push(`import '${n.fileName}'`)}),Object.values(this._schemas).forEach(e=>{t.push(e.toManifestString())}),Object.values(this._particles).forEach(e=>{t.push(e.toString())}),this._recipes.forEach(n=>{t.push(n.toString(e))}),[...this.stores].sort(Tt).forEach(e=>{t.push(e.toManifestString({handleTags:this.storeTags.get(e)}))}),t.join("\n")}get idGeneratorForTesting(){return this._idGenerator}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const va=i()(process.argv.slice(2),{string:["output"],boolean:["verbose","help"],alias:{o:"output",v:"verbose"},default:{output:"bundle.zip",verbose:!1}});(va.help||0===va._.length)&&(console.log("Usage\n  $ bundle [-options] [file ...]\n\nDescription\n  Creates a zip bundle containing all transitive dependencies of an Arcs manifest.\n\nOptions\n  --output, -o   name of the created bundle, bundle.zip by default\n  --verbose, -v  list bundled files\n  --help         usage info\n\nExamples\n  $ bundle Feature.arcs\n  $ bundle -v -o mybundle.zip recipes/Feature.arcs recipes/ExtraStuff.arcs"),process.exit()),Array.isArray(va.output)&&(console.error("Only one output path can be specified"),process.exit(1)),async function(e,t,n){const r=await async function(...e){e=e.map(e=>c.a.isAbsolute(e)?e:c.a.resolve(process.cwd(),e).split(c.a.sep).join("/"));const t=new Un,n=await Promise.all(e.map(e=>_a.load(e,t))),r=new Set;n.forEach(e=>(function e(t,n){if(!t.fileName)throw new Error("Missing filename");n.add(t.fileName);for(const e of t.particles)n.add(e.implFile);for(const e of t.stores)e.source&&n.add(e.source);for(const r of t.imports)e(r,n)})(e,r));const i=[...r].sort(),s=function(e){const t=e[0],n=e[e.length-1];let r=0;for(let e=0;e<Math.min(t.length,n.length)&&t[e]===n[e];e++)"/"===t[e]&&(r=e+1);return r}(i),o=n.map(e=>e.fileName);return i.map(e=>({filePath:e,bundlePath:e.substr(s),entryPoint:o.includes(e)}))}(...e);if(r.some(e=>"__bundle_entry.arcs"===e.bundlePath))throw new Error("Error: Top-level '__bundle_entry.arcs' file found. Please remove it.");return n&&(console.log("Bundled files:"),r.forEach(e=>console.log(e.filePath))),new Promise(e=>{const n=c.a.dirname(t);o.a.existsSync(n)||o.a.mkdirSync(n,{recursive:!0});const i=new h.a;for(const e of r)i.file(e.bundlePath,o.a.readFileSync(e.filePath),{createFolders:!1});i.file("__bundle_entry.arcs",r.filter(e=>e.entryPoint).map(e=>`import '${e.bundlePath}'\n`).join("")),i.generateNodeStream().pipe(o.a.createWriteStream(t)).on("finish",()=>e())})}(va._,va.output,va.verbose).catch(e=>{console.error(e.message),process.exit(1)})}]);