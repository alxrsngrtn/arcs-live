!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=145)}([function(e,t,n){"use strict";var i=n(39),r=n.n(i);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";var i=n(23),r=n(8),s=n(24),o=n(25),a=n(0);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(e,t,n){this.name=e,this._canWriteSuperset=t,this._canReadSubset=n,this._resolution=null}maybeMergeConstraints(e){return!!this.maybeMergeCanReadSubset(e.canReadSubset)&&this.maybeMergeCanWriteSuperset(e.canWriteSuperset)}maybeMergeCanReadSubset(e){if(null==e)return!0;if(null==this.canReadSubset)return this.canReadSubset=e,!0;if(this.canReadSubset instanceof g&&e instanceof g)return!0;if(this.canReadSubset instanceof u&&e instanceof u){const t=r.a.intersect(this.canReadSubset.entitySchema,e.entitySchema);return!!t&&(this.canReadSubset=new u(t),!0)}return!1}maybeMergeCanWriteSuperset(e){if(null==e)return!0;if(null==this.canWriteSuperset)return this.canWriteSuperset=e,!0;if(this.canWriteSuperset instanceof g&&e instanceof g)return!0;if(this.canWriteSuperset instanceof u&&e instanceof u){const t=r.a.union(this.canWriteSuperset.entitySchema,e.entitySchema);return!!t&&(this.canWriteSuperset=new u(t),!0)}return!1}isSatisfiedBy(e){const t=this._canWriteSuperset;if(!t)return!0;if(!(t instanceof u&&e instanceof u))throw new Error(`constraint checking not implemented for ${this} and ${e}`);return e.getEntitySchema().isMoreSpecificThan(t.getEntitySchema())}get resolution(){return this._resolution?this._resolution.resolvedType():null}isValidResolutionCandidate(e){const t=e.resolvedType().getContainedType();return t instanceof h&&t.variable===this?{result:!1,detail:"variable cannot resolve to collection of itself"}:{result:!0}}set resolution(e){Object(a.a)(!this._resolution);const t=this.isValidResolutionCandidate(e);Object(a.a)(t.result,t.detail);let n=e;for(;n&&n instanceof h;){if(n.variable===this)return;n=n.variable.resolution}this._resolution=e,this._canWriteSuperset=null,this._canReadSubset=null}get canWriteSuperset(){return this._resolution?(Object(a.a)(!this._canWriteSuperset),this._resolution instanceof h?this._resolution.variable.canWriteSuperset:null):this._canWriteSuperset}set canWriteSuperset(e){Object(a.a)(!this._resolution),this._canWriteSuperset=e}get canReadSubset(){return this._resolution?(Object(a.a)(!this._canReadSubset),this._resolution instanceof h?this._resolution.variable.canReadSubset:null):this._canReadSubset}set canReadSubset(e){Object(a.a)(!this._resolution),this._canReadSubset=e}get hasConstraint(){return null!==this._canReadSubset||null!==this._canWriteSuperset}canEnsureResolved(){return this._resolution?this._resolution.canEnsureResolved():!(!this._canWriteSuperset&&!this._canReadSubset)}maybeEnsureResolved(){return this._resolution?this._resolution.maybeEnsureResolved():this._canWriteSuperset?(this.resolution=this._canWriteSuperset,!0):!!this._canReadSubset&&(this.resolution=this._canReadSubset,!0)}toLiteral(){return Object(a.a)(null==this.resolution),this.toLiteralIgnoringResolutions()}toLiteralIgnoringResolutions(){return{name:this.name,canWriteSuperset:this._canWriteSuperset&&this._canWriteSuperset.toLiteral(),canReadSubset:this._canReadSubset&&this._canReadSubset.toLiteral()}}static fromLiteral(e){return new c(e.name,e.canWriteSuperset?l.fromLiteral(e.canWriteSuperset):null,e.canReadSubset?l.fromLiteral(e.canReadSubset):null)}isResolved(){return this._resolution&&this._resolution.isResolved()}}n.d(t,"j",function(){return l}),n.d(t,"d",function(){return u}),n.d(t,"k",function(){return h}),n.d(t,"c",function(){return d}),n.d(t,"b",function(){return p}),n.d(t,"h",function(){return f}),n.d(t,"f",function(){return m}),n.d(t,"i",function(){return g}),n.d(t,"g",function(){return y}),n.d(t,"a",function(){return v}),n.d(t,"e",function(){return b});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class l{constructor(e){this.tag=e}static fromLiteral(e){switch(e.tag){case"Entity":return new u(r.a.fromLiteral(e.data));case"TypeVariable":return new h(c.fromLiteral(e.data));case"Collection":return new d(l.fromLiteral(e.data));case"BigCollection":return new p(l.fromLiteral(e.data));case"Relation":return new f(e.data.map(e=>l.fromLiteral(e)));case"Interface":return new m(i.a.fromLiteral(e.data));case"Slot":return new g(s.a.fromLiteral(e.data));case"Reference":return new y(l.fromLiteral(e.data));case"Arc":return new v;case"Handle":return new b;default:throw new Error(`fromLiteral: unknown type ${e}`)}}static unwrapPair(e,t){if(e.tag===t.tag){const n=e.getContainedType();if(null!==n)return l.unwrapPair(n,t.getContainedType())}return[e,t]}static canMergeConstraints(e,t){return l._canMergeCanReadSubset(e,t)&&l._canMergeCanWriteSuperset(e,t)}static _canMergeCanReadSubset(e,t){if(e.canReadSubset&&t.canReadSubset){if(e.canReadSubset.tag!==t.canReadSubset.tag)return!1;if(e.canReadSubset instanceof u)return null!==r.a.intersect(e.canReadSubset.entitySchema,t.canReadSubset.entitySchema);throw new Error(`_canMergeCanReadSubset not implemented for types tagged with ${e.canReadSubset.tag}`)}return!0}static _canMergeCanWriteSuperset(e,t){if(e.canWriteSuperset&&t.canWriteSuperset){if(e.canWriteSuperset.tag!==t.canWriteSuperset.tag)return!1;if(e.canWriteSuperset instanceof u)return null!==r.a.union(e.canWriteSuperset.entitySchema,t.canWriteSuperset.entitySchema)}return!0}isSlot(){return this instanceof g}isCollectionType(){return this instanceof d}isBigCollectionType(){return this instanceof p}isResolved(){return!this.hasUnresolvedVariable}mergeTypeVariablesByName(e){return this}_applyExistenceTypeTest(e){return e(this)}get hasVariable(){return this._applyExistenceTypeTest(e=>e instanceof h)}get hasUnresolvedVariable(){return this._applyExistenceTypeTest(e=>e instanceof h&&!e.variable.isResolved())}getContainedType(){return null}isTypeContainer(){return!1}collectionOf(){return new d(this)}bigCollectionOf(){return new p(this)}resolvedType(){return this}canEnsureResolved(){return this.isResolved()||this._canEnsureResolved()}_canEnsureResolved(){return!0}maybeEnsureResolved(){return!0}get canWriteSuperset(){throw new Error(`canWriteSuperset not implemented for ${this}`)}get canReadSubset(){throw new Error(`canReadSubset not implemented for ${this}`)}isMoreSpecificThan(e){return this.tag===e.tag&&this._isMoreSpecificThan(e)}_isMoreSpecificThan(e){throw new Error(`isMoreSpecificThan not implemented for ${this}`)}clone(e){return this.resolvedType()._clone(e)}_clone(e){return l.fromLiteral(this.toLiteral())}_cloneWithResolutions(e){return l.fromLiteral(this.toLiteral())}hasProperty(e){return e(this)||this._hasProperty(e)}_hasProperty(e){return!1}toString(e){return this.tag}getEntitySchema(){return null}toPrettyString(){return null}}class u extends l{constructor(e){super("Entity"),this.entitySchema=e}static make(e,t,n){return new u(new r.a(e,t,n))}get isEntity(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return this.entitySchema.isMoreSpecificThan(e.entitySchema)}toLiteral(){return{tag:this.tag,data:this.entitySchema.toLiteral()}}toString(e){return this.entitySchema.toInlineSchemaString(e)}getEntitySchema(){return this.entitySchema}_cloneWithResolutions(e){if(e.has(this.entitySchema))return e.get(this.entitySchema);const t=new u(this.entitySchema);return e.set(this.entitySchema,t),t}toPrettyString(){return this.entitySchema.description.pattern?this.entitySchema.description.pattern:this.entitySchema.name?this.entitySchema.name.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim():JSON.stringify(this.entitySchema.toLiteral())}}class h extends l{constructor(e){super("TypeVariable"),this.variable=e}static make(e,t,n){return new h(new c(e,t,n))}get isVariable(){return!0}mergeTypeVariablesByName(e){const t=this.variable.name;let n=e.get(t);if(n){if(n instanceof h&&(n.variable.hasConstraint||this.variable.hasConstraint)){if(!n.variable.maybeMergeConstraints(this.variable))throw new Error("could not merge type variables")}}else n=this,e.set(t,this);return n}resolvedType(){return this.variable.resolution||this}_canEnsureResolved(){return this.variable.canEnsureResolved()}maybeEnsureResolved(){return this.variable.maybeEnsureResolved()}get canWriteSuperset(){return this.variable.canWriteSuperset}get canReadSubset(){return this.variable.canReadSubset}_clone(e){const t=this.variable.name;if(e.has(t))return new h(e.get(t));{const n=c.fromLiteral(this.variable.toLiteral());return e.set(t,n),new h(n)}}_cloneWithResolutions(e){if(e.has(this.variable))return new h(e.get(this.variable));{const t=c.fromLiteral(this.variable.toLiteralIgnoringResolutions());return this.variable.resolution&&(t._resolution=this.variable._resolution._cloneWithResolutions(e)),this.variable._canReadSubset&&(t.canReadSubset=this.variable.canReadSubset._cloneWithResolutions(e)),this.variable._canWriteSuperset&&(t.canWriteSuperset=this.variable.canWriteSuperset._cloneWithResolutions(e)),e.set(this.variable,t),new h(t)}}toLiteral(){return this.variable.resolution?this.variable.resolution.toLiteral():{tag:this.tag,data:this.variable.toLiteral()}}toString(e){return`~${this.variable.name}`}getEntitySchema(){return this.variable.isResolved()?this.resolvedType().getEntitySchema():null}toPrettyString(){return this.variable.isResolved()?this.resolvedType().toPrettyString():`[~${this.variable.name}]`}}class d extends l{constructor(e){super("Collection"),this.collectionType=e}get isCollection(){return!0}mergeTypeVariablesByName(e){const t=this.collectionType,n=t.mergeTypeVariablesByName(e);return n===t?this:n.collectionOf()}_applyExistenceTypeTest(e){return this.collectionType._applyExistenceTypeTest(e)}getContainedType(){return this.collectionType}isTypeContainer(){return!0}resolvedType(){const e=this.collectionType,t=e.resolvedType();return e!==t?t.collectionOf():this}_canEnsureResolved(){return this.collectionType.canEnsureResolved()}maybeEnsureResolved(){return this.collectionType.maybeEnsureResolved()}get canWriteSuperset(){return m.make(this.tag,[],[])}get canReadSubset(){return m.make(this.tag,[],[])}_clone(e){const t=this.collectionType.clone(e).toLiteral();return l.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new d(this.collectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.collectionType.toLiteral()}}_hasProperty(e){return this.collectionType.hasProperty(e)}toString(e){return`[${this.collectionType.toString(e)}]`}getEntitySchema(){return this.collectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`${this.collectionType.toPrettyString()} List`}}class p extends l{constructor(e){super("BigCollection"),this.bigCollectionType=e}get isBigCollection(){return!0}mergeTypeVariablesByName(e){const t=this.bigCollectionType,n=t.mergeTypeVariablesByName(e);return n===t?this:n.bigCollectionOf()}_applyExistenceTypeTest(e){return this.bigCollectionType._applyExistenceTypeTest(e)}getContainedType(){return this.bigCollectionType}isTypeContainer(){return!0}resolvedType(){const e=this.bigCollectionType,t=e.resolvedType();return e!==t?t.bigCollectionOf():this}_canEnsureResolved(){return this.bigCollectionType.canEnsureResolved()}maybeEnsureResolved(){return this.bigCollectionType.maybeEnsureResolved()}get canWriteSuperset(){return m.make(this.tag,[],[])}get canReadSubset(){return m.make(this.tag,[],[])}_clone(e){const t=this.bigCollectionType.clone(e).toLiteral();return l.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new p(this.bigCollectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.bigCollectionType.toLiteral()}}_hasProperty(e){return this.bigCollectionType.hasProperty(e)}toString(e){return`BigCollection<${this.bigCollectionType.toString(e)}>`}getEntitySchema(){return this.bigCollectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`Collection of ${this.bigCollectionType.toPrettyString()}`}}class f extends l{constructor(e){super("Relation"),this.relationEntities=e}get isRelation(){return!0}toLiteral(){return{tag:this.tag,data:this.relationEntities.map(e=>e.toLiteral())}}toPrettyString(){return JSON.stringify(this.relationEntities)}}class m extends l{constructor(e){super("Interface"),this.interfaceInfo=e}static make(e,t,n){return new m(new i.a(e,t,n))}get isInterface(){return!0}mergeTypeVariablesByName(e){const t=this.interfaceInfo.clone(new Map);return t.mergeTypeVariablesByName(e),new m(t)}_applyExistenceTypeTest(e){return this.interfaceInfo._applyExistenceTypeTest(e)}resolvedType(){return new m(this.interfaceInfo.resolvedType())}_canEnsureResolved(){return this.interfaceInfo.canEnsureResolved()}maybeEnsureResolved(){return this.interfaceInfo.maybeEnsureResolved()}get canWriteSuperset(){return new m(this.interfaceInfo.canWriteSuperset)}get canReadSubset(){return new m(this.interfaceInfo.canReadSubset)}_isMoreSpecificThan(e){return this.interfaceInfo.isMoreSpecificThan(e.interfaceInfo)}_clone(e){const t=this.interfaceInfo.clone(e).toLiteral();return l.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new m(this.interfaceInfo._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.interfaceInfo.toLiteral()}}toString(e){return this.interfaceInfo.name}toPrettyString(){return this.interfaceInfo.toPrettyString()}}class g extends l{constructor(e){super("Slot"),this.slot=e}static make(e,t){return new g(new s.a(e,t))}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return!0}toLiteral(){return{tag:this.tag,data:this.slot.toLiteral()}}toString(e){const t=[];for(const e of Object.keys(this.slot))void 0!==this.slot[e]&&t.push(`${e}:${this.slot[e]}`);let n="";return 0!==t.length&&(n=` {${t.join(", ")}}`),`Slot${n}`}toPrettyString(){const e=[];for(const t of Object.keys(this.slot))void 0!==this.slot[t]&&e.push(`${t}:${this.slot[t]}`);let t="";return 0!==e.length&&(t=` {${e.join(", ")}}`),`Slot${t}`}}class y extends l{constructor(e){super("Reference"),this.referredType=e}get isReference(){return!0}getContainedType(){return this.referredType}isTypeContainer(){return!0}resolvedType(){const e=this.referredType,t=e.resolvedType();return e!==t?new y(t):this}_canEnsureResolved(){return this.referredType.canEnsureResolved()}maybeEnsureResolved(){return this.referredType.maybeEnsureResolved()}get canWriteSuperset(){return this.referredType.canWriteSuperset}get canReadSubset(){return this.referredType.canReadSubset}_clone(e){const t=this.referredType.clone(e).toLiteral();return l.fromLiteral({tag:this.tag,data:t})}_cloneWithResolutions(e){return new y(this.referredType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.referredType.toLiteral()}}toString(e){return"Reference<"+this.referredType.toString()+">"}}class v extends l{constructor(){super("Arc")}get isArc(){return!0}newInstance(e,t){return new o.b(e,t)}toLiteral(){return{tag:this.tag}}}class b extends l{constructor(){super("Handle")}get isHandle(){return!0}toLiteral(){return{tag:this.tag}}}},function(e,t,n){"use strict";n.d(t,"d",function(){return s}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return c});var i=n(0);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function r(e,t){return e===t?0:null===e?-1:1}function s(e,t){return null==e||null==t?r(e,t):e.localeCompare(t)}function o(e,t){return null==e||null==t?r(e,t):e-t}function a(e,t,n){if(Object(i.a)(null!=e),Object(i.a)(null!=t),e.length!==t.length)return o(e.length,t.length);for(let i=0;i<e.length;i++){let r;if(0!==(r=n(e[i],t[i])))return r}return 0}function c(e,t){return null==e||null==t?r(e,t):e._compareTo(t)}},function(e,t,n){"use strict";n.d(t,"b",function(){return p}),n.d(t,"c",function(){return f}),n.d(t,"a",function(){return g}),n.d(t,"d",function(){return y});var i=n(0),r=n(11),s=n(9),o=n(13),a=n(1),c=n(4),l=n(6),u=n(15);function h(e,t){Object(i.a)(t,"Handles need entity classes for deserialization");const{id:n,rawData:r}=e,s=new t(r);return e.id&&c.a.identify(s,e.id),s}class d{constructor(e,t,n,r,s,o){Object(i.a)(!(e instanceof d)),this.storage=e,this.idGenerator=t,this.name=n||this.storage.name,this.canRead=s,this.canWrite=o,this._particleId=r,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1}}reportUserExceptionInHost(e,t,n){this.storage.reportExceptionInHost(new r.c(e,n,this._particleId,t.spec.name))}reportSystemExceptionInHost(e,t){this.storage.reportExceptionInHost(new r.b(e,t,this._particleId))}configure(e){Object(i.a)(this.canRead,"configure can only be called on readable Handles");try{const t=Object.keys(this.options),n=Object.keys(e).filter(e=>!t.includes(e));if(n.length>0)throw new Error(`Invalid option in Handle.configure(): ${n}`);Object.assign(this.options,e)}catch(e){throw this.reportSystemExceptionInHost(e,"Handle::configure"),e}}_serialize(e){return Object(i.a)(e,"can't serialize a null entity"),e instanceof c.a&&(c.a.isIdentified(e)||c.a.createIdentity(e,l.b.fromString(this._id),this.idGenerator)),e[u.a].serialize()}get type(){return this.storage.type}get _id(){return this.storage.id}toManifestString(){return`'${this._id}'`}generateKey(){return this.idGenerator.newChildId(l.b.fromString(this._id),"key").toString()}}class p extends d{async _notify(e,t,n){switch(Object(i.a)(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void await t.callOnHandleSync(this,this._restore(n),e=>this.reportUserExceptionInHost(e,t,"onHandleSync"));case"update":{const e={};return"add"in n&&(e.added=this._restore(n.add)),"remove"in n&&(e.removed=this._restore(n.remove)),e.originator=n.originatorId===this._particleId,void await t.callOnHandleUpdate(this,e,e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"))}case"desync":return void await t.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"));default:throw new Error("unsupported")}}async get(e){if(!this.canRead)throw new Error("Handle not readable");return this._restore([await this.storage.get(e)])[0]}async toList(){if(!this.canRead)throw new Error("Handle not readable");return this._restore(await this.storage.toList())}_restore(e){return null!==e?e.map(e=>h(e,this.entityClass)):null}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),n=[this.generateKey()];return this.storage.store(t,n,this._particleId)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");if(this.storage.clear)return this.storage.clear(this._particleId);throw new Error("clear not implemented by storage")}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);await this.storage.remove(t.id,[],this._particleId)}}class f extends d{async _notify(e,t,n){switch(Object(i.a)(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void await t.callOnHandleSync(this,this._restore(n),e=>this.reportUserExceptionInHost(e,t,"onHandleSync"));case"update":{const e=this._restore(n.data),i=this._restore(n.oldData);return void await t.callOnHandleUpdate(this,{data:e,oldData:i},e=>this.reportUserExceptionInHost(e,t,"onHandleUpdate"))}case"desync":return void await t.callOnHandleDesync(this,e=>this.reportUserExceptionInHost(e,t,"onHandleDesync"));default:throw new Error("unsupported")}}async get(){if(!this.canRead)throw new Error("Handle not readable");const e=await this.storage.get();return this._restore(e)}_restore(e){if(null==e)return null;if(this.type instanceof a.d)return h(e,this.entityClass);if(this.type instanceof a.f)return s.a.fromLiteral(e);if(this.type instanceof a.g)return new o.b(e,this.type,this.storage.pec);throw new Error(`Don't know how to deliver handle data of type ${this.type}`)}async set(e){try{if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);return this.storage.set(t,this._particleId)}catch(e){throw this.reportSystemExceptionInHost(e,"Handle::set"),e}}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this.storage.clear(this._particleId)}}class m{constructor(e,t){this._parent=e,this._cursorId=t}async next(){const e=await this._parent.storage.cursorNext(this._cursorId);return e.done||(e.value=e.value.map(e=>h(e,this._parent.entityClass))),e}close(){this._parent.storage.cursorClose(this._cursorId)}}class g extends d{configure(e){throw new Error("BigCollections do not support sync/update configuration")}async _notify(e,t,n){Object(i.a)(this.canRead,"_notify should not be called for non-readable handles"),Object(i.a)("sync"===e,"BigCollection._notify only supports sync events"),await t.callOnHandleSync(this,[],e=>this.reportUserExceptionInHost(e,t,"onHandleSync"))}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),n=[this.generateKey()];return this.storage.store(t,n,this._particleId)}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);await this.storage.remove(t.id,[],this._particleId)}async stream({pageSize:e,forward:t=!0}){if(!this.canRead)throw new Error("Handle not readable");if(isNaN(e)||e<1)throw new Error("Streamed reads require a positive pageSize");const n=await this.storage.stream(e,t);return new m(this,n)}}function y(e,t,n=null,i="",r=!0,s=!0){let o;o=e.type instanceof a.c?new p(e,t,n,i,r,s):e.type instanceof a.b?new g(e,t,n,i,r,s):new f(e,t,n,i,r,s);const c=e.type.getContainedType()||e.type;return c instanceof a.d&&(o.entityClass=c.entitySchema.entityClass(e.pec)),o}},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(0),r=n(1),s=n(13),o=n(5),a=n(15);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(e,t,n,i,r){this.mutable=!0,this.entity=e,this.entityClass=t,this.schema=n,this.context=i,this.userIDComponent=r}getId(){return Object(i.a)(this.isIdentified(),"getId() called on unidentified entity"),this.id}getEntityClass(){return this.entityClass}isIdentified(){return void 0!==this.id}identify(e){Object(i.a)(!this.isIdentified(),"identify() called on already identified entity"),this.id=e;const t=e.split(":"),n=t.lastIndexOf("uid");this.userIDComponent=n>0?t.slice(n+1).join(":"):""}createIdentity(e,t){let n;Object(i.a)(!this.isIdentified(),"createIdentity() called on already identified entity"),n=this.userIDComponent?`${e.toString()}:uid:${this.userIDComponent}`:t.newChildId(e).toString(),this.id=n}isMutable(){return this.mutable}makeImmutable(){this.mutable=!1}mutate(e){if(!this.mutable)throw new Error("Entity is immutable.");let t;"function"==typeof e?e(t=this.dataClone()):t=e,h(this.entity,t,this.schema,this.context)}toLiteral(){return JSON.parse(JSON.stringify(this.entity))}dataClone(){const e={},t=this.schema.fields;for(const n of Object.keys(t))void 0!==this.entity[n]&&(t[n]&&"schema-reference"===t[n].kind?this.entity[n]&&(e[n]=this.entity[n].dataClone()):t[n]&&"schema-collection"===t[n].kind?this.entity[n]&&(e[n]=[...this.entity[n]].map(e=>e.dataClone())):e[n]=this.entity[n]);return e}serialize(){return{id:this.id,rawData:this.dataClone()}}}class l{toString(){return this.constructor.name+JSON.stringify(this)}get id(){throw new Error("entity.id is no longer valid; use Entity.id() or Particle.idFor()")}get rawData(){throw new Error("entity.rawData is no longer valid; use plain .field access or spread notation")}get dataClone(){throw new Error("entity.dataClone() is no longer valid; use use Entity.dataClone() or Particle.dataClone()")}static createEntityClass(e,t){const n=class extends l{constructor(r,s){return super(),Object(i.a)(r,"can't construct entity with null data"),Object(i.a)(!s||-1===s.indexOf(":"),"user IDs must not contain the ':' character"),Object.defineProperty(this,a.a,{value:new c(this,n,e,t,s),enumerable:!1}),h(this,r,e,t),new Proxy(this,{set:(e,t,n)=>{throw new Error(`Tried to modify entity field '${t}'. Use the mutate method instead.`)}})}static get type(){return new r.d(e)}static get key(){return{tag:"entity",schema:e}}static get schema(){return e}};return Object.defineProperty(n,"name",{value:e.name}),n}static id(e){return u(e).getId()}static entityClass(e){return u(e).getEntityClass()}static isIdentified(e){return u(e).isIdentified()}static identify(e,t){u(e).identify(t)}static createIdentity(e,t,n){u(e).createIdentity(t,n)}static isMutable(e){return u(e).isMutable()}static makeImmutable(e){u(e).makeImmutable()}static mutate(e,t){u(e).mutate(t)}static toLiteral(e){return u(e).toLiteral()}static dataClone(e){return u(e).dataClone()}static serialize(e){return u(e).serialize()}}function u(e){const t=e[a.a];return Object(i.a)(void 0!==t,"SYMBOL_INTERNALS lookup on non-entity"),t}function h(e,t,n,i){for(const[r,s]of Object.entries(t)){const t=f(n.fields[r],s,r,i);p(r,t,n),e[r]=t}}function d(e,t){switch(e.type){case"Text":case"URL":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Bytes":return"Uint8Array";case"Object":return"object";default:throw new Error(`Unknown field type ${e.type} in schema ${t}`)}}function p(e,t,n,i){if(void 0===(i=i||n.fields[e]))throw new Error(`Can't set field ${e}; not in schema ${n.name}`);if(null!=t)switch(i.kind){case"schema-primitive":if(("Uint8Array"===t.constructor.name?"Uint8Array":typeof t)!==d(i,n.name))throw new TypeError(`Type mismatch setting field ${e} (type ${i.type}); `+`value '${t}' is type ${typeof t}`);break;case"schema-union":for(const e of i.types)if(typeof t===d(e,n.name))return;throw new TypeError(`Type mismatch setting field ${e} (union [${i.types}]); `+`value '${t}' is type ${typeof t}`);case"schema-tuple":if(!Array.isArray(t))throw new TypeError(`Cannot set tuple ${e} with non-array value '${t}'`);if(t.length!==i.types.length)throw new TypeError(`Length mismatch setting tuple ${e} `+`[${i.types}] with value '${t}'`);i.types.map((r,s)=>{if(void 0!==t[s]&&null!==t[s]&&typeof t[s]!==d(r,n.name))throw new TypeError(`Type mismatch setting field ${e} (tuple [${i.types}]); `+`value '${t}' has type ${typeof t[s]} at index ${s}`)});break;case"schema-reference":if(!(t instanceof s.b))throw new TypeError(`Cannot set reference ${e} with non-reference '${t}'`);if(!o.a.compareTypes({type:t.type},{type:new r.g(i.schema.model)}))throw new TypeError(`Cannot set reference ${e} with value '${t}' of mismatched type`);break;case"schema-collection":if("Set"!==t.constructor.name)throw new TypeError(`Cannot set collection ${e} with non-Set '${t}'`);for(const r of t)p(e,r,n,i.schema);break;default:throw new Error(`Unknown kind '${i.kind}' for field ${e} in schema ${n.name}`)}}function f(e,t,n,i){if(!e)return t;if("schema-reference"===e.kind&&t){if(t instanceof s.b)return t;if(t.id&&t.storageKey)return new s.b(t,new r.g(e.schema.model),i);throw new TypeError(`Cannot set reference ${n} with non-reference '${t}'`)}if("schema-collection"===e.kind&&t){if("Set"===t.constructor.name)return t;if(t.length&&t instanceof Object)return new Set(t.map(t=>f(e.schema,t,n,i)));throw new TypeError(`Cannot set collection ${n} with non-collection '${t}'`)}return t}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(1);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class r{static processTypeList(e,t){const n=i.k.make("",null,null);e&&(n.variable.resolution=e),e=n;const s=[];for(const n of t)if(n.type.resolvedType().hasVariable){if(null==(e=r._tryMergeTypeVariable(e,n.type)))return null}else s.push(n);for(const t of s)if(!r._tryMergeConstraints(e,t))return null;const o=e=>e instanceof i.k?null==e.canReadSubset||null==e.canWriteSuperset?e:e.canReadSubset.isMoreSpecificThan(e.canWriteSuperset)?(e.canWriteSuperset.isMoreSpecificThan(e.canReadSubset)&&(e.variable.resolution=e.canReadSubset),e):null:e,a=e.resolvedType();if(a.isCollectionType()){const e=o(a.collectionType);return null!==e?e.collectionOf():null}if(a.isBigCollectionType()){const e=o(a.bigCollectionType);return null!==e?e.bigCollectionOf():null}return o(a)}static _tryMergeTypeVariable(e,t){const[n,r]=i.j.unwrapPair(e.resolvedType(),t.resolvedType());if(n instanceof i.k){if(r instanceof i.k){if(!1===n.variable.maybeMergeConstraints(r.variable))return null;r.variable.resolution=n}else{if(!n.variable.isValidResolutionCandidate(r).result)return null;n.variable.resolution=r}return e}if(r instanceof i.k)return r.variable.isValidResolutionCandidate(n).result?(r.variable.resolution=n,t):null;if(n instanceof i.f&&r instanceof i.f){const e=n.interfaceInfo.tryMergeTypeVariablesWith(r.interfaceInfo);return null==e?null:new i.f(e)}if(n.isTypeContainer()&&n.hasVariable||r.isTypeContainer()&&r.hasVariable)return null;throw new Error("tryMergeTypeVariable shouldn't be called on two types without any type variables")}static _tryMergeConstraints(e,{type:t,direction:n}){let[s,o]=i.j.unwrapPair(e.resolvedType(),t.resolvedType());if(s instanceof i.k){for(;o.isTypeContainer();){if(null!=s.variable.resolution||null!=s.variable.canReadSubset||null!=s.variable.canWriteSuperset)return!1;const e=i.k.make("a",null,null);o instanceof i.c?s.variable.resolution=new i.c(e):o instanceof i.b?s.variable.resolution=new i.b(e):s.variable.resolution=new i.g(e);const t=i.j.unwrapPair(s.resolvedType(),o);if([s,o]=t,!(s instanceof i.k))throw new TypeError("unwrapping a wrapped TypeVariable somehow didn't become a TypeVariable")}if(("out"===n||"inout"===n||"`provide"===n)&&!s.variable.maybeMergeCanReadSubset(o.canWriteSuperset))return!1;if(("in"===n||"inout"===n||"`consume"===n)&&!s.variable.maybeMergeCanWriteSuperset(o.canReadSubset))return!1}else{if(o.tag!==s.tag)return!1;if(("out"===n||"inout"===n)&&!r._writeConstraintsApply(s,o))return!1;if(("in"===n||"inout"===n)&&!r._readConstraintsApply(s,o))return!1}return!0}static _writeConstraintsApply(e,t){const n=t.canWriteSuperset;return null==n||null==e.canReadSubset||!!n.isMoreSpecificThan(e.canReadSubset)}static _readConstraintsApply(e,t){const n=t.canReadSubset;return null==n||null==e.canWriteSuperset||!!e.canWriteSuperset.isMoreSpecificThan(n)}static compareTypes(e,t){const n=e.type.resolvedType(),r=t.type.resolvedType(),[s,o]=i.j.unwrapPair(n,r);if(s instanceof i.k&&o.isTypeContainer())return!(s.variable.canReadSubset||s.variable.canWriteSuperset);if(o instanceof i.k&&s.isTypeContainer())return!(o.variable.canReadSubset||o.variable.canWriteSuperset);if(s instanceof i.k||o instanceof i.k)return i.j.canMergeConstraints(s,o);if(void 0===s!=(void 0===o))return!1;if(s===o)return!0;if(s.tag!==o.tag)return!1;if(s instanceof i.i)return!0;if(s instanceof i.f&&o instanceof i.f&&s.interfaceInfo.equals(o.interfaceInfo))return!0;if(!(s instanceof i.d&&o instanceof i.d))return!1;const a=s.entitySchema.isMoreSpecificThan(o.entitySchema),c=o.entitySchema.isMoreSpecificThan(s.entitySchema);if(c&&a)return!0;if(!c&&!a)return!1;const[l,u]=c?[e,t]:[t,e],h=l.direction||(l.connection?l.connection.direction:"inout"),d=u.direction||(u.connection?u.connection.direction:"inout");return"in"===h||"out"===d}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{}const r=new class extends i{next(){return Math.random()}};class s{static next(){return r.next()}}n.d(t,"c",function(){return o}),n.d(t,"b",function(){return a}),n.d(t,"a",function(){return c});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o{constructor(e){this._nextComponentId=0,this._currentSessionId=e}static newSession(){const e=Math.floor(s.next()*Math.pow(2,50))+"";return new o(e)}static createWithSessionIdForTesting(e){return new o(e)}newArcId(e){return c._newArcIdInternal(this._currentSessionId,e)}newChildId(e,t=""){return t+=this._nextComponentId++,a._newIdInternal(this._currentSessionId,[...e.idTree,t])}get currentSessionIdForTesting(){return this._currentSessionId}}class a{constructor(e,t=[]){this.idTree=[],this.root=e,this.idTree=t}static _newIdInternal(e,t=[]){return new a(e,t)}static fromString(e){const t=e.split(":");if(t[0].startsWith("!")){const e=t[0].slice(1),n=t.slice(1).filter(e=>e.length>0);return new a(e,n)}return new a("",t)}toString(){return`!${this.root}:${this.idTree.join(":")}`}idTreeAsString(){return this.idTree.join(":")}equal(e){if(e.root!==this.root||e.idTree.length!==this.idTree.length)return!1;for(let t=0;t<e.idTree.length;t++)if(e.idTree[t]!==this.idTree[t])return!1;return!0}}class c extends a{static _newArcIdInternal(e,t){return new c(e,[t])}static newForTest(e){return o.newSession().newArcId(e)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return a}),n.d(t,"c",function(){return c});var i,r=n(0),s=n(2);!function(e){e.change="Change"}(i||(i={}));class o{constructor(e){this.arcId=e,this._debug=!1,Object(r.a)(void 0!==e,"Arcs with storage must have ids")}set debug(e){this._debug=e}async shutdown(){}}class a{constructor(e){Object.assign(this,e)}}class c{constructor(e,t,n,i){this.referenceMode=!1,Object(r.a)(n,"id must be provided when constructing StorageProviders"),Object(r.a)(!e.hasUnresolvedVariable,"Storage types must be concrete"),this._type=e,this.listeners=new Map,this.name=t,this.version=0,this.id=n,this.source=null,this._storageKey=i,this.nextLocalID=0}enableReferenceMode(){this.referenceMode=!0}get storageKey(){return this._storageKey}get type(){return this._type}reportExceptionInHost(e){throw e}on(e,t,n){Object(r.a)(void 0!==n,"must provide a target to register a storage event handler");const s=i[e],o=this.listeners.get(s)||new Map;o.set(t,{target:n}),this.listeners.set(s,o)}off(e,t){const n=i[e],r=this.listeners.get(n);r&&r.delete(t)}async _fire(e,t){const n=i[e],r=this.listeners.get(n);if(!r||0===r.size)return;const s=[];for(const[e]of r.entries())s.push(e);await 0;for(const e of s)e(t)}_compareTo(e){let t;return 0!==(t=Object(s.d)(this.name,e.name))?t:0!==(t=Object(s.c)(this.version,e.version))?t:0!==(t=Object(s.d)(this.source,e.source))?t:0!==(t=Object(s.d)(this.id,e.id))?t:0}toString(e){const t=[],n=[];return n.push("store"),this.name&&n.push(`${this.name}`),n.push(`of ${this.type.toString()}`),this.id&&n.push(`'${this.id}'`),e&&e.length&&n.push(`${e.join(" ")}`),this.source&&n.push(`in '${this.source}'`),t.push(n.join(" ")),this.description&&t.push(`  description \`${this.description}\``),t.join("\n")}get apiChannelMappingId(){return this.id}dispose(){}async modelForSynchronization(){return this.toLiteral()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(4),r=n(1);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(e,t,n){this.description={},this.names=e,this.fields={};for(const[e,n]of Object.entries(t))this.fields[e]="string"==typeof n?{kind:"schema-primitive",type:n}:n;n&&n.description.forEach(e=>this.description[e.name]=e.pattern||e.patterns[0])}toLiteral(){const e={},t=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:t.model.toLiteral()}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:t(e.schema)}:e};for(const n of Object.keys(this.fields))e[n]=t(this.fields[n]);return{names:this.names,fields:e,description:this.description}}static fromLiteral(e={fields:{},names:[],description:{}}){const t={},n=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:r.j.fromLiteral(t.model)}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:n(e.schema)}:e};for(const i of Object.keys(e.fields))t[i]=n(e.fields[i]);const i=new s(e.names,t);return i.description=e.description||{},i}get name(){return this.names[0]}static typesEqual(e,t){return s._typeString(e)===s._typeString(t)}static _typeString(e){switch(e.kind){case"schema-primitive":return e.type;case"schema-union":return`(${e.types.map(e=>e.type).join(" or ")})`;case"schema-tuple":return`(${e.types.map(e=>e.type).join(", ")})`;case"schema-reference":return`Reference<${s._typeString(e.schema)}>`;case"type-name":case"schema-inline":return e.model.entitySchema.toInlineSchemaString();case"schema-collection":return`[${s._typeString(e.schema)}]`;default:throw new Error(`Unknown type kind ${e.kind} in schema ${this.name}`)}}static union(e,t){const n=[...new Set([...e.names,...t.names])],i={};for(const[n,r]of[...Object.entries(e.fields),...Object.entries(t.fields)])if(i[n]){if(!s.typesEqual(i[n],r))return null}else i[n]=r;return new s(n,i)}static intersect(e,t){const n=[...e.names].filter(e=>t.names.includes(e)),i={};for(const[n,r]of Object.entries(e.fields)){const e=t.fields[n];e&&s.typesEqual(r,e)&&(i[n]=r)}return new s(n,i)}equals(e){return this===e||this.name===e.name&&this.isMoreSpecificThan(e)&&e.isMoreSpecificThan(this)}isMoreSpecificThan(e){const t=new Set(this.names);for(const n of e.names)if(!t.has(n))return!1;const n={};for(const[e,t]of Object.entries(this.fields))n[e]=t;for(const[t,i]of Object.entries(e.fields)){if(null==n[t])return!1;if(!s.typesEqual(n[t],i))return!1}return!0}get type(){return new r.d(this)}entityClass(e=null){return i.a.createEntityClass(this,e)}toInlineSchemaString(e){const t=this.names.join(" ")||"*",n=Object.entries(this.fields).map(([e,t])=>`${s._typeString(t)} ${e}`).join(", ");return`${t} {${n.length>0&&e&&e.hideFields?"...":n}}`}toManifestString(){const e=[];if(e.push(`schema ${this.names.join(" ")}`),e.push(...Object.entries(this.fields).map(([e,t])=>`  ${s._typeString(t)} ${e}`)),Object.keys(this.description).length>0){e.push(`  description \`${this.description.pattern}\``);for(const t of Object.keys(this.description))"pattern"!==t&&e.push(`    ${t} \`${this.description[t]}\``)}return e.join("\n")}}},function(e,t,n){"use strict";var i,r,s=n(0),o=n(18),a=n(5),c=n(1);!function(e){e.HasTag="has-tag",e.IsFromHandle="is-from-handle"}(i||(i={}));class l{constructor(e,t){this.handle=e,this.conditions=t}toManifestString(){return`check ${this.handle.name} ${this.conditions.map(e=>e.toManifestString()).join(" or ")}`}}class u{constructor(e){this.tag=e,this.type=i.HasTag}static fromASTNode(e){return new u(e.tag)}toManifestString(){return`is ${this.tag}`}}class h{constructor(e){this.parentHandle=e,this.type=i.IsFromHandle}static fromASTNode(e,t){const n=t.get(e.parentHandle);if(!n)throw new Error(`Unknown "check is from handle" handle name: ${n}.`);return new h(n)}toManifestString(){return`is from handle ${this.parentHandle}`}}!function(e){e.IsTag="is-tag",e.DerivesFrom="derives-from"}(r||(r={}));class d{constructor(e,t){this.handle=e,this.tag=t,this.type=r.IsTag}static fromASTNode(e,t){return new d(e,t.tag)}toManifestString(){return`claim ${this.handle.name} is ${this.tag}`}}class p{constructor(e,t){this.handle=e,this.parentHandles=t,this.type=r.DerivesFrom}static fromASTNode(e,t,n){const i=t.parentHandles.map(e=>{const t=n.get(e);if(!t)throw new Error(`Unknown "derives from" handle name: ${t}.`);return t});return new p(e,i)}toManifestString(){return`claim ${this.handle.name} derives from ${this.parentHandles.map(e=>e.name).join(" and ")}`}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function f(e){return e instanceof c.j?e:c.j.fromLiteral(e)}function m(e){return e instanceof c.j?e.toLiteral():e}n.d(t,"b",function(){return v}),n.d(t,"a",function(){return b});class g{constructor(e,t){this.parentConnection=null,this.rawData=e,this.direction=e.direction,this.name=e.name,this.type=f(e.type).mergeTypeVariablesByName(t),this.isOptional=e.isOptional,this.tags=e.tags||[],this.dependentConnections=[]}instantiateDependentConnections(e,t){for(const n of this.rawData.dependentConnections){const i=e.createConnection(n,t);i.parentConnection=this,this.dependentConnections.push(i)}}get isInput(){return"in"===this.direction||"inout"===this.direction||"host"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}isCompatibleType(e){return a.a.compareTypes({type:e},{type:this.type,direction:this.direction})}}class y{constructor(e){this.name=e.name,this.isRequired=e.isRequired||!1,this.isSet=e.isSet||!1,this.tags=e.tags||[],this.formFactor=e.formFactor,this.handles=e.handles||[],this.provideSlotConnections=[],e.provideSlotConnections&&e.provideSlotConnections.forEach(e=>{this.provideSlotConnections.push(new v(e))})}get isOptional(){return!this.isRequired}get direction(){return"`consume"}get type(){return c.i.make(this.formFactor,null)}get dependentConnections(){return this.provideSlotConnections}}class v extends y{}class b{constructor(e){this.model=e,this.name=e.name,this.verbs=e.verbs;const t=new Map;this.handleConnectionMap=new Map,e.args.forEach(e=>this.createConnection(e,t)),e.description=e.description||{},this.validateDescription(e.description),this.pattern=e.description.pattern,this.handleConnectionMap.forEach((t,n)=>{t.pattern=e.description[n]}),this.implFile=e.implFile,this.implBlobUrl=e.implBlobUrl,this.modality=o.a.create(e.modality||[]),this.slotConnections=new Map,e.slotConnections&&e.slotConnections.forEach(e=>this.slotConnections.set(e.name,new y(e))),this.slotConnections.forEach(e=>{e.provideSlotConnections.forEach(e=>{e.handles.forEach(e=>Object(s.a)(this.handleConnectionMap.has(e),"Cannot provide slot for nonexistent handle constraint "+e))})}),this.trustClaims=this.validateTrustClaims(e.trustClaims),this.trustChecks=this.validateTrustChecks(e.trustChecks)}createConnection(e,t){const n=new g(e,t);return this.handleConnectionMap.set(n.name,n),n.instantiateDependentConnections(this,t),n}get handleConnections(){return this.connections}get connections(){return[...this.handleConnectionMap.values()]}get inputs(){return this.connections.filter(e=>e.isInput)}get outputs(){return this.connections.filter(e=>e.isOutput)}isInput(e){const t=this.handleConnectionMap.get(e);return t&&t.isInput}isOutput(e){const t=this.handleConnectionMap.get(e);return t&&t.isOutput}getConnectionByName(e){return this.handleConnectionMap.get(e)}getSlotSpec(e){return this.slotConnections.get(e)}get slotConnectionNames(){return[...this.slotConnections.keys()]}get primaryVerb(){return this.verbs.length>0?this.verbs[0]:void 0}isCompatible(e){return 0===this.slotConnections.size||this.modality.intersection(e).isResolved()}setImplBlobUrl(e){this.model.implBlobUrl=this.implBlobUrl=e}toLiteral(){const{args:e,name:t,verbs:n,description:i,implFile:r,implBlobUrl:s,modality:o,slotConnections:a,trustClaims:c,trustChecks:l}=this.model,u=({type:e,direction:t,name:n,isOptional:i,dependentConnections:r})=>({type:m(e),direction:t,name:n,isOptional:i,dependentConnections:r.map(u)});return{args:e.map(e=>u(e)),name:t,verbs:n,description:i,implFile:r,implBlobUrl:s,modality:o,slotConnections:a,trustClaims:c,trustChecks:l}}static fromLiteral(e){let{args:t,name:n,verbs:i,description:r,implFile:s,implBlobUrl:o,modality:a,slotConnections:c,trustClaims:l,trustChecks:u}=e;const h=({type:e,direction:t,name:n,isOptional:i,dependentConnections:r})=>({type:f(e),direction:t,name:n,isOptional:i,dependentConnections:r?r.map(h):[]});return t=t.map(h),new b({args:t,name:n,verbs:i||[],description:r,implFile:s,implBlobUrl:o,modality:a,slotConnections:c,trustClaims:l,trustChecks:u})}clone(){return b.fromLiteral(this.toLiteral())}cloneWithResolutions(e){const t=this.clone();return this.handleConnectionMap.forEach((n,i)=>{t.handleConnectionMap.get(i).type=n.type._cloneWithResolutions(e)}),t}equals(e){return JSON.stringify(this.toLiteral())===JSON.stringify(e.toLiteral())}validateDescription(e){Object.keys(e||[]).forEach(e=>{Object(s.a)(["kind","location","pattern"].includes(e)||this.handleConnectionMap.has(e),`Unexpected description for ${e}`)})}toInterface(){Object(s.a)(!this.slotConnections.size,"please implement slots toInterface");const e=this.model.args.map(({type:e,name:t,direction:n})=>({type:f(e),name:t,direction:n}));return c.f.make(this.name,e,[])}toString(){const e=[];let t="";this.verbs.length>0&&(t=" "+this.verbs.map(e=>`&${e}`).join(" ")),e.push(`particle ${this.name}${t} in '${this.implFile}'`.trim());const n=(t,i)=>{const r=t.tags.map(e=>` #${e}`).join("");e.push(`${i}${t.direction}${t.isOptional?"?":""} ${t.type.toString()} ${t.name}${r}`);for(const e of t.dependentConnections)n(e,i+"  ")};for(const e of this.handleConnections)e.parentConnection||n(e,"  ");this.modality.names.forEach(t=>e.push(`  modality ${t}`));const i=(t,n,r)=>{const s=[];t.isRequired&&s.push("must"),s.push(n),t.isSet&&s.push("set of"),s.push(t.name),t.tags.length>0&&s.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`${r}${s.join(" ")}`),t.formFactor&&e.push(`${r}  formFactor ${t.formFactor}`);for(const n of t.handles)e.push(`${r}  handle ${n}`);t.provideSlotConnections&&t.provideSlotConnections.forEach(e=>i(e,"provide",r+"  "))};return this.slotConnections.forEach(e=>i(e,"consume","  ")),this.pattern&&(e.push(`  description \`${this.pattern}\``),this.handleConnectionMap.forEach(t=>{t.pattern&&e.push(`    ${t.name} \`${t.pattern}\``)})),e.join("\n")}toManifestString(){return this.toString()}validateTrustClaims(e){const t=new Map;return e&&e.forEach(e=>{const n=this.handleConnectionMap.get(e.handle);if(!n)throw new Error(`Can't make a claim on unknown handle ${e.handle}.`);if(!n.isOutput)throw new Error(`Can't make a claim on handle ${e.handle} (not an output handle).`);if(n.claim)throw new Error(`Can't make multiple claims on the same output (${e.handle}).`);n.claim=function(e,t,n){switch(t.claimType){case r.IsTag:return d.fromASTNode(e,t);case r.DerivesFrom:return p.fromASTNode(e,t,n);default:throw new Error("Unknown claim type.")}}(n,e,this.handleConnectionMap),t.set(e.handle,n.claim)}),t}validateTrustChecks(e){const t=new Map;return e&&e.forEach(e=>{const n=this.handleConnectionMap.get(e.handle);if(!n)throw new Error(`Can't make a check on unknown handle ${e.handle}.`);if(!n.isInput)throw new Error(`Can't make a check on handle ${e.handle} (not an input handle).`);if(n.check)throw new Error(`Can't make multiple checks on the same input (${e.handle}).`);n.check=function(e,t,n){const r=t.conditions.map(e=>{switch(e.checkType){case i.HasTag:return u.fromASTNode(e);case i.IsFromHandle:return h.fromASTNode(e,n);default:throw new Error("Unknown check type.")}});return new l(e,r)}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(n,e,this.handleConnectionMap),t.set(e.handle,n.check)}),t}}},,function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return s}),n.d(t,"d",function(){return a});class i extends Error{constructor(e,t,n,i){super(),this.cause=e,this.method=t,this.particleId=n,this.particleName=i,this.stack+=`\nCaused by: ${this.cause.stack}`}toLiteral(){return{exceptionType:this.constructor.name,cause:{name:this.cause.name,message:this.cause.message,stack:this.cause.stack},method:this.method,particleId:this.particleId,particleName:this.particleName,stack:this.stack}}static fromLiteral(e){const t=e.cause;let n;switch(e.exceptionType){case r.name:n=new r(t,e.method,e.particleId,e.particleName);break;case s.name:n=new s(t,e.method,e.particleId,e.particleName);break;default:throw new Error(`Unknown exception type: ${e.exceptionType}`)}return n.stack=e.stack,n}}class r extends i{get message(){const e=this.particleName?this.particleName:this.particleId;return`SystemException: exception ${this.cause.name} raised when invoking system function ${this.method} on behalf of particle ${e}: ${this.cause.message}`}}class s extends i{get message(){const e=this.particleName?this.particleName:this.particleId;return`UserException: exception ${this.cause.name} raised when invoking function ${this.method} on particle ${e}: ${this.cause.message}`}}const o=[];function a(e){for(const t of o)t(e)}var c;c=(e=>{throw console.log(e.method,e.particleName),e}),o.includes(c)||o.push(c)},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return u});var i,r=n(0),s=n(3),o=n(1),a=n(4),c=n(15);!function(e){e[e.Unstored=0]="Unstored",e[e.Stored=1]="Stored"}(i||(i={}));class l{constructor(e,t,n){this.entity=null,this.storageProxy=null,this.handle=null,this.id=e.id,this.storageKey=e.storageKey,this.context=n,this.type=t,this[c.a]={serialize:()=>({id:this.id,rawData:this.dataClone()})}}async ensureStorageProxy(){null==this.storageProxy&&(this.storageProxy=await this.context.getStorageProxy(this.storageKey,this.type.referredType),this.handle=Object(s.d)(this.storageProxy,this.context.idGenerator),this.storageKey?Object(r.a)(this.storageKey===this.storageProxy.storageKey):this.storageKey=this.storageProxy.storageKey)}async dereference(){return Object(r.a)(this.context,"Must have context to dereference"),this.entity?this.entity:(await this.ensureStorageProxy(),this.entity=await this.handle.get(this.id),this.entity)}dataClone(){return{storageKey:this.storageKey,id:this.id}}}class u extends l{constructor(e,t){super({id:a.a.id(e),storageKey:null},new o.g(a.a.entityClass(e).type),t),this.mode=i.Unstored,this.entity=e,this.stored=new Promise(async(t,n)=>{await this.storeReference(e),t()})}async storeReference(e){await this.ensureStorageProxy(),await this.handle.store(e),this.mode=i.Stored}async dereference(){return this.mode===i.Unstored?null:super.dereference()}isIdentified(){return a.a.isIdentified(this.entity)}static newClientReference(e){return class extends u{constructor(t){super(t,e)}}}}},function(e,t,n){"use strict";var i=n(0),r=n(12),s=n(30),o=n(16),a=n(43),c=n(20);const l=Symbol("buffer"),u=Symbol("type");class h{constructor(){this[u]="";const e=arguments[0],t=arguments[1],n=[];if(e){const t=e,i=Number(t.length);for(let e=0;e<i;e++){const i=t[e];let r;r=i instanceof Buffer?i:ArrayBuffer.isView(i)?Buffer.from(i.buffer,i.byteOffset,i.byteLength):i instanceof ArrayBuffer?Buffer.from(i):i instanceof h?i[l]:Buffer.from("string"==typeof i?i:String(i)),n.push(r)}}this[l]=Buffer.concat(n);let i=t&&void 0!==t.type&&String(t.type).toLowerCase();i&&!/[^\u0020-\u007E]/.test(i)&&(this[u]=i)}get size(){return this[l].length}get type(){return this[u]}slice(){const e=this.size,t=arguments[0],n=arguments[1];let i,r;i=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),r=void 0===n?e:n<0?Math.max(e+n,0):Math.min(n,e);const s=Math.max(r-i,0),o=this[l].slice(i,i+s),a=new h([],{type:arguments[2]});return a[l]=o,a}}function d(e,t,n){Error.call(this,e),this.message=e,this.type=t,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let p;Object.defineProperties(h.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(h.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,d.prototype.name="FetchError";try{p=require("encoding").convert}catch(e){}const f=Symbol("Body internals"),m=r.PassThrough;function g(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.size;let s=void 0===i?0:i;var o=n.timeout;let a=void 0===o?0:o;null==e?e=null:"string"==typeof e||v(e)||e instanceof h||Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)||e instanceof r||(e=String(e)),this[f]={body:e,disturbed:!1,error:null},this.size=s,this.timeout=a,e instanceof r&&e.on("error",function(e){const n="AbortError"===e.name?e:new d(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[f].error=n})}function y(){var e=this;if(this[f].disturbed)return g.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[f].disturbed=!0,this[f].error)return g.Promise.reject(this[f].error);if(null===this.body)return g.Promise.resolve(Buffer.alloc(0));if("string"==typeof this.body)return g.Promise.resolve(Buffer.from(this.body));if(this.body instanceof h)return g.Promise.resolve(this.body[l]);if(Buffer.isBuffer(this.body))return g.Promise.resolve(this.body);if("[object ArrayBuffer]"===Object.prototype.toString.call(this.body))return g.Promise.resolve(Buffer.from(this.body));if(ArrayBuffer.isView(this.body))return g.Promise.resolve(Buffer.from(this.body.buffer,this.body.byteOffset,this.body.byteLength));if(!(this.body instanceof r))return g.Promise.resolve(Buffer.alloc(0));let t=[],n=0,i=!1;return new g.Promise(function(r,s){let o;e.timeout&&(o=setTimeout(function(){i=!0,s(new d(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))},e.timeout)),e.body.on("error",function(t){"AbortError"===t.name?(i=!0,s(t)):s(new d(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))}),e.body.on("data",function(r){if(!i&&null!==r){if(e.size&&n+r.length>e.size)return i=!0,void s(new d(`content size at ${e.url} over limit: ${e.size}`,"max-size"));n+=r.length,t.push(r)}}),e.body.on("end",function(){if(!i){clearTimeout(o);try{r(Buffer.concat(t))}catch(t){s(new d(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}})})}function v(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function b(e){let t,n,i=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof r&&"function"!=typeof i.getBoundary&&(t=new m,n=new m,i.pipe(t),i.pipe(n),e[f].body=t,i=n),i}function _(e){const t=e.body;return null===t?0:"string"==typeof t?Buffer.byteLength(t):v(t)?Buffer.byteLength(String(t)):t instanceof h?t.size:Buffer.isBuffer(t)?t.length:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?t.byteLength:ArrayBuffer.isView(t)?t.byteLength:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}g.prototype={get body(){return this[f].body},get bodyUsed(){return this[f].disturbed},arrayBuffer(){return y.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob(){let e=this.headers&&this.headers.get("content-type")||"";return y.call(this).then(function(t){return Object.assign(new h([],{type:e.toLowerCase()}),{[l]:t})})},json(){var e=this;return y.call(this).then(function(t){try{return JSON.parse(t.toString())}catch(t){return g.Promise.reject(new d(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}})},text(){return y.call(this).then(function(e){return e.toString()})},buffer(){return y.call(this)},textConverted(){var e=this;return y.call(this).then(function(t){return function(e,t){if("function"!=typeof p)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=t.get("content-type");let i,r,s="utf-8";n&&(i=/charset=([^;]*)/i.exec(n));r=e.slice(0,1024).toString(),!i&&r&&(i=/<meta.+?charset=(['"])(.+?)\1/i.exec(r));!i&&r&&(i=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(r))&&(i=/charset=(.*)/i.exec(i.pop()));!i&&r&&(i=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(r));i&&("gb2312"!==(s=i.pop())&&"gbk"!==s||(s="gb18030"));return p(e,"UTF-8",s).toString()}(t,e.headers)})}},Object.defineProperties(g.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),g.mixIn=function(e){for(const t of Object.getOwnPropertyNames(g.prototype))if(!(t in e)){const n=Object.getOwnPropertyDescriptor(g.prototype,t);Object.defineProperty(e,t,n)}},g.Promise=global.Promise;const w=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,S=/[^\t\x20-\x7e\x80-\xff]/;function C(e){if(e=`${e}`,w.test(e))throw new TypeError(`${e} is not a legal HTTP header name`)}function T(e){if(e=`${e}`,S.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}function k(e,t){t=t.toLowerCase();for(const n in e)if(n.toLowerCase()===t)return n}const R=Symbol("map");class x{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[R]=Object.create(null),e instanceof x){const t=e.raw(),n=Object.keys(t);for(const e of n)for(const n of t[e])this.append(e,n)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const n=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(t))}for(const e of n){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const n=e[t];this.append(t,n)}}}}get(e){C(e=`${e}`);const t=k(this[R],e);return void 0===t?null:this[R][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=E(this),i=0;for(;i<n.length;){var r=n[i];const s=r[0],o=r[1];e.call(t,o,s,this),n=E(this),i++}}set(e,t){t=`${t}`,C(e=`${e}`),T(t);const n=k(this[R],e);this[R][void 0!==n?n:e]=[t]}append(e,t){t=`${t}`,C(e=`${e}`),T(t);const n=k(this[R],e);void 0!==n?this[R][n].push(t):this[R][e]=[t]}has(e){return C(e=`${e}`),void 0!==k(this[R],e)}delete(e){C(e=`${e}`);const t=k(this[R],e);void 0!==t&&delete this[R][t]}raw(){return this[R]}keys(){return j(this,"key")}values(){return j(this,"value")}[Symbol.iterator](){return j(this,"key+value")}}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(e[R]).sort().map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[R][t].join(", ")}:function(t){return[t.toLowerCase(),e[R][t].join(", ")]})}x.prototype.entries=x.prototype[Symbol.iterator],Object.defineProperty(x.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(x.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const O=Symbol("internal");function j(e,t){const n=Object.create(M);return n[O]={target:e,kind:t,index:0},n}const M=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==M)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[O];const t=e.target,n=e.kind,i=e.index,r=E(t,n);return i>=r.length?{value:void 0,done:!0}:(this[O].index=i+1,{value:r[i],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function $(e){const t=Object.assign({__proto__:null},e[R]),n=k(e[R],"Host");return void 0!==n&&(t[n]=t[n][0]),t}Object.defineProperty(M,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const P=Symbol("Response internals"),N=s.STATUS_CODES;class I{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g.call(this,e,t);const n=t.status||200;this[P]={url:t.url,status:n,statusText:t.statusText||N[n],headers:new x(t.headers)}}get url(){return this[P].url}get status(){return this[P].status}get ok(){return this[P].status>=200&&this[P].status<300}get statusText(){return this[P].statusText}get headers(){return this[P].headers}clone(){return new I(b(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok})}}g.mixIn(I.prototype),Object.defineProperties(I.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(I.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const D=Symbol("Request internals"),A=o.parse,q=o.format,F="destroy"in r.Readable.prototype;function H(e){return"object"==typeof e&&"object"==typeof e[D]}class L{constructor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};H(e)?t=A(e.url):(t=e&&e.href?A(e.href):A(`${e}`),e={});let i=n.method||e.method||"GET";if(i=i.toUpperCase(),(null!=n.body||H(e)&&null!==e.body)&&("GET"===i||"HEAD"===i))throw new TypeError("Request with GET/HEAD method cannot have body");let r=null!=n.body?n.body:H(e)&&null!==e.body?b(e):null;g.call(this,r,{timeout:n.timeout||e.timeout||0,size:n.size||e.size||0});const s=new x(n.headers||e.headers||{});if(null!=n.body){const e=function(e){const t=e.body;return null===t?null:"string"==typeof t?"text/plain;charset=UTF-8":v(t)?"application/x-www-form-urlencoded;charset=UTF-8":t instanceof h?t.type||null:Buffer.isBuffer(t)?null:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?null:ArrayBuffer.isView(t)?null:"function"==typeof t.getBoundary?`multipart/form-data;boundary=${t.getBoundary()}`:null}(this);null===e||s.has("Content-Type")||s.append("Content-Type",e)}let o=H(e)?e.signal:null;if("signal"in n&&(o=n.signal),null!=o&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(o))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[D]={method:i,redirect:n.redirect||e.redirect||"follow",headers:s,parsedURL:t,signal:o},this.follow=void 0!==n.follow?n.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===e.compress||e.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent}get method(){return this[D].method}get url(){return q(this[D].parsedURL)}get headers(){return this[D].headers}get redirect(){return this[D].redirect}get signal(){return this[D].signal}clone(){return new L(this)}}function B(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}g.mixIn(L.prototype),Object.defineProperty(L.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(L.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),B.prototype=Object.create(Error.prototype),B.prototype.constructor=B,B.prototype.name="AbortError";const z=r.PassThrough,W=o.resolve;function U(e,t){if(!U.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return g.Promise=U.Promise,new U.Promise(function(n,i){const o=new L(e,t),u=function(e){const t=e[D].parsedURL,n=new x(e[D].headers);if(n.has("Accept")||n.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof r.Readable&&!F)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let i=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(i="0"),null!=e.body){const t=_(e);"number"==typeof t&&(i=String(t))}return i&&n.set("Content-Length",i),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate"),n.has("Connection")||e.agent||n.set("Connection","close"),Object.assign({},t,{method:e.method,headers:$(n),agent:e.agent})}(o),p=("https:"===u.protocol?a:s).request,f=o.signal;let m=null;const g=function(){let e=new B("The user aborted a request.");i(e),o.body&&o.body instanceof r.Readable&&o.body.destroy(e),m&&m.body&&m.body.emit("error",e)};if(f&&f.aborted)return void g();const y=function(){g(),T()},b=p(u);let C;function T(){b.abort(),f&&f.removeEventListener("abort",y),clearTimeout(C)}f&&f.addEventListener("abort",y),o.timeout&&b.once("socket",function(e){C=setTimeout(function(){i(new d(`network timeout at: ${o.url}`,"request-timeout")),T()},o.timeout)}),b.on("error",function(e){i(new d(`request to ${o.url} failed, reason: ${e.message}`,"system",e)),T()}),b.on("response",function(e){clearTimeout(C);const t=function(e){const t=new x;for(const n of Object.keys(e))if(!w.test(n))if(Array.isArray(e[n]))for(const i of e[n])S.test(i)||(void 0===t[R][n]?t[R][n]=[i]:t[R][n].push(i));else S.test(e[n])||(t[R][n]=[e[n]]);return t}(e.headers);if(U.isRedirect(e.statusCode)){const r=t.get("Location"),s=null===r?null:W(o.url,r);switch(o.redirect){case"error":return i(new d(`redirect mode is set to error: ${o.url}`,"no-redirect")),void T();case"manual":if(null!==s)try{t.set("Location",s)}catch(e){i(e)}break;case"follow":if(null===s)break;if(o.counter>=o.follow)return i(new d(`maximum redirect reached at: ${o.url}`,"max-redirect")),void T();const r={headers:new x(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:o.body,signal:o.signal};return 303!==e.statusCode&&o.body&&null===_(o)?(i(new d("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void T()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==o.method)||(r.method="GET",r.body=void 0,r.headers.delete("content-length")),n(U(new L(s,r))),void T())}}e.once("end",function(){f&&f.removeEventListener("abort",y)});let r=e.pipe(new z);const s={url:o.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:o.size,timeout:o.timeout},a=t.get("Content-Encoding");if(!o.compress||"HEAD"===o.method||null===a||204===e.statusCode||304===e.statusCode)return m=new I(r,s),void n(m);const l={flush:c.Z_SYNC_FLUSH,finishFlush:c.Z_SYNC_FLUSH};if("gzip"==a||"x-gzip"==a)return r=r.pipe(c.createGunzip(l)),m=new I(r,s),void n(m);if("deflate"!=a&&"x-deflate"!=a)m=new I(r,s),n(m);else{e.pipe(new z).once("data",function(e){r=8==(15&e[0])?r.pipe(c.createInflate()):r.pipe(c.createInflateRaw()),m=new I(r,s),n(m)})}}),function(e,t){const n=t.body;null===n?e.end():"string"==typeof n?(e.write(n),e.end()):v(n)?(e.write(Buffer.from(String(n))),e.end()):n instanceof h?(e.write(n[l]),e.end()):Buffer.isBuffer(n)?(e.write(n),e.end()):"[object ArrayBuffer]"===Object.prototype.toString.call(n)?(e.write(Buffer.from(n)),e.end()):ArrayBuffer.isView(n)?(e.write(Buffer.from(n.buffer,n.byteOffset,n.byteLength)),e.end()):n.pipe(e)}(b,o)})}U.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},U.Promise=global.Promise;var V=U,K=n(17),J=n.n(K),G=n(40),Z=n.n(G);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const Q=["Text","URL","Number","Boolean"];class Y{static convert(e,t){const n=JSON.parse(e),i={},r={};n["@graph"]||(n["@graph"]=[n]);for(const e of n["@graph"])"rdf:Property"===e["@type"]?r[e["@id"]]=e:"rdfs:Class"===e["@type"]&&(i[e["@id"]]=e,e.subclasses=[],e.superclass=null);for(const e of Object.values(i))if(void 0!==e["rdfs:subClassOf"]){null==e["rdfs:subClassOf"].length&&(e["rdfs:subClassOf"]=[e["rdfs:subClassOf"]]);for(const t of e["rdfs:subClassOf"]){const n=t["@id"];null==e.superclass&&(e.superclass=[]),i[n]?(i[n].subclasses.push(e),e.superclass.push(i[n])):e.superclass.push({"@id":n})}}for(const e of Object.values(i))0===e.subclasses.length&&null==t&&(t=e);const s=[];for(const e of Object.values(r)){let n=e["schema:domainIncludes"];if(n||(n={"@id":t["@id"]}),n.length||(n=[n]),(n=n.map(e=>e["@id"])).includes(t["@id"])){const t=e["@id"].split(":")[1];let n=e["schema:rangeIncludes"];n||console.log(e),n.length||(n=[n]),(n=(n=n.map(e=>e["@id"].split(":")[1])).filter(e=>Q.includes(e))).length>0&&s.push({name:t,type:n})}}const o=t["@id"].split(":")[1],a=t&&t.superclass?t.superclass.map(e=>e["@id"].split(":")[1]):[];let c="";for(const e of a)c+=`import 'https://schema.org/${e}'\n\n`;if(c+=`schema ${o}`,a.length>0&&(c+=` extends ${a.join(", ")}`),s.length>0)for(const e of s){let t;c+=`\n  ${t=e.type.length>1?"("+e.type.join(" or ")+")":e.type[0]} ${e.name}`}return c+="\n"}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const X=()=>Object.create(null),ee=e=>(class extends e{constructor(){super(),this._pendingProps=X(),this._props=this._getInitialProps()||X(),this._lastProps=X(),this._state=this._getInitialState()||X(),this._lastState=X()}_getInitialProps(){}_getInitialState(){}_getProperty(e){return this._pendingProps[e]||this._props[e]}_setProperty(e,t){(this._validator||this._wouldChangeProp(e,t))&&(this._pendingProps[e]=t,this._invalidateProps())}_wouldChangeValue(e,t,n){return e[t]!==n}_wouldChangeProp(e,t){return this._wouldChangeValue(this._props,e,t)}_wouldChangeState(e,t){return this._wouldChangeValue(this._state,e,t)}_setProps(e){Object.assign(this._pendingProps,e),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}_setState(e){let t=!1;const n=this._state;for(const i in e){const r=e[i];this._wouldChangeState(i,r)&&(t=!0,n[i]=r)}if(t)return this._invalidate(),!0}_async(e){return Promise.resolve().then(e.bind(this))}_invalidate(){this._validator||(this._validator=this._async(this._validate))}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const e=this._getStateArgs();try{Object.assign(this._props,this._pendingProps),this._propsInvalid&&(this._willReceiveProps(...e),this._propsInvalid=!1),this._shouldUpdate(...e)&&(this._ensureMount(),this._doUpdate(...e))}catch(e){console.error(e)}this._validator=null,this._lastProps=Object.assign(X(),this._props),this._lastState=Object.assign(X(),this._state)}_doUpdate(...e){this._update(...e),this._didUpdate(...e)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(e,t,n){e=`_debounce_${e}`,this._state[e]=((e,t,n)=>{if(e&&clearTimeout(e),t&&n)return setTimeout(t,n)})(this._state[e],t,null!=n?n:16)}});var te=n(3),ne=n(19);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class ie extends ne.a{get template(){return""}getTemplate(e){return this.template}getTemplateName(e){return"default"}shouldRender(e){return!0}render(e){return{}}renderSlot(e,t){const n=this._getStateArgs(),i=this.getSlot(e);if(i){if(this.currentSlotName=e,t.forEach(e=>i.requestedContentTypes.add(e)),this.shouldRender(...n)){const e={};if(i.requestedContentTypes.has("template")&&(e.template=this.getTemplate(i.slotName)),i.requestedContentTypes.has("model")&&(e.model=this.render(...n)),e.templateName=this.getTemplateName(i.slotName),i.providedSlots.size>0&&(e.template&&("string"==typeof e.template?e.template=this.slotNamesToModelReferences(i,e.template):e.template=Object.entries(e.template).reduce((e,[t,n])=>(e[t]=this.slotNamesToModelReferences(i,n),e),{})),e.model)){const t={};i.providedSlots.forEach((e,n)=>t[`$${n}`]=e),e.model=this.enhanceModelWithSlotIDs(e.model,t)}i.render(e)}else i.isRendered&&i.render({});this.currentSlotName=void 0}}slotNamesToModelReferences(e,t){return e.providedSlots.forEach((e,n)=>{t=t.replace(new RegExp(`slotid="${n}"`,"gi"),`slotname="${n}" slotid$="{{$${n}}}"`)}),t}enhanceModelWithSlotIDs(e,t,n=!0){n&&(e={...t,...e}),e.hasOwnProperty("$template")&&e.hasOwnProperty("models")&&Array.isArray(e.models)&&(e.models=e.models.map(e=>this.enhanceModelWithSlotIDs(e,t)));for(const[n,i]of Object.entries(e))i&&"object"==typeof i&&(e[n]=this.enhanceModelWithSlotIDs(i,t,!1));return e}_getStateArgs(){return[]}forceRenderTemplate(e=""){this.slotProxiesByName.forEach((t,n)=>{e&&n!==e||t.requestedContentTypes.add("template")})}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n})}async setParticleDescription(e){if("string"==typeof e)return super.setParticleDescription(e);if(e.template&&e.model)return await super.setDescriptionPattern("_template_",e.template),void await super.setDescriptionPattern("_model_",JSON.stringify(e.model));throw new Error("Description pattern must either be string or have template and model")}async clearHandle(e){const t=this.handles.get(e);if(!(t instanceof te.c||t instanceof te.b))throw new Error("Singleton/Collection required");await t.clear()}async mergeEntitiesToHandle(e,t){const n={},i=this.handles.get(e);if(!(i instanceof te.b))throw new Error("Collection required");(await i.toList()).forEach(e=>n[e.id]=e);for(const e of t)n[this.idFor(e)]||await i.store(e)}async appendEntitiesToHandle(e,t){const n=this.handles.get(e);if(n){if(!(n instanceof te.b||n instanceof te.a))throw new Error("Collection required");await Promise.all(t.map(e=>n.store(e)))}}async appendRawDataToHandle(e,t){const n=this.handles.get(e);if(n&&n.entityClass){if(!(n instanceof te.b||n instanceof te.a))throw new Error("Collection required");{const e=n.entityClass;await Promise.all(t.map(t=>n.store(new e(t))))}}}async updateSingleton(e,t){const n=this.handles.get(e);if(n&&n.entityClass){if(n instanceof te.c){const e=new(0,n.entityClass)(t);return await n.set(e),e}throw new Error("Singleton required")}}async updateCollection(e,t){const n=this.handles.get(e);if(n){if(!(n instanceof te.b||n instanceof te.a))throw new Error("Collection required");await n.remove(t),await n.store(t)}}async derefShares(e){let t=[];this.startBusy();try{const n=e.map(async e=>e.ref.dereference());t=await Promise.all(n)}finally{this.doneBusy()}return t}async boxQuery(e,t){if(e){const n=e.filter(e=>t===e.fromKey);return await this.derefShares(n)}return[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class re extends(ee(ie)){willReceiveProps(...e){}update(...e){}shouldRender(...e){return!0}render(...e){return{}}setState(e){return this._setState(e)}get state(){return this._state}set state(e){this.setState(e)}get props(){return this._props}get config(){return{handleNames:this.spec.inputs.map(e=>e.name),slotNames:[...this.spec.slotConnections.values()].map(e=>e.name)}}_willReceiveProps(...e){this.willReceiveProps(...e)}_update(...e){this.update(...e),this.shouldRender(...e)&&(this.relevance=1),this.config.slotNames.forEach(e=>this.renderSlot(e,["model"]))}_async(e){this.startBusy();return setTimeout(()=>{try{e.call(this)}finally{this.doneBusy()}},10)}async setHandles(e){this.configureHandles(e),this.handles=e,this._invalidate()}configureHandles(e){}async onHandleSync(e,t){this._setProperty(e.name,t)}async onHandleUpdate({name:e},{data:t,added:n,removed:i}){if(void 0!==t&&this._setProps({[e]:t}),n){const t=(this.props[e]||[]).concat(n);this._props[e]=t,this._setProps({[e]:t})}if(i){const t=this.props[e];Array.isArray(t)&&(i.forEach(e=>{const n=t.findIndex(t=>this.idFor(t)===this.idFor(e));n>=0?t.splice(n,1):console.warn("dom-particle::onHandleUpdate: couldn't find item to remove")}),this._setProps({[e]:t}))}}fireEvent(e,{handler:t,data:n}){this[t]&&this[t]({data:n},this._state)}debounce(e,t,n){const i=`_debounce_${e}`,r=this.state;r[i]||(r[i]=!0,this.startBusy());super._debounce(e,()=>{this.doneBusy(),t(),r[i]=null},n)}}var se=n(9),oe=n(4);class ae extends re{getTemplate(e){return this._state.template}getTemplateName(e){return this._state.templateName}render(e,t){return t.renderModel}shouldRender(e,t){return Boolean((t.template||t.templateName)&&t.renderModel)}renderHostedSlot(e,t,n){this.combineHostedTemplate(e,t,n),this.combineHostedModel(e,t,n)}combineHostedTemplate(e,t,n){}combineHostedModel(e,t,n){}static propsToItems(e){return e?e.map(e=>({subId:oe.a.id(e),...e})):[]}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ce extends ae{constructor(){super(...arguments),this._itemSubIdByHostedSlotId=new Map,this._connByHostedConn=new Map}async _mapParticleConnections(e,t,n,i,r){const s=[],o=[];let a=2;const c=[e,t];for(const[e,t]of i){if(c.includes(e))continue;const i=t.storage;s.push(`use '${await r.mapHandle(i)}' as v${a}`);const l=n.handleConnections.find(e=>e.isCompatibleType(t.type));l&&(o.push(`${l.name} = v${a++}`),this._connByHostedConn.set(l.name,e))}return[s,o]}async setHandles(e){this.handleIds={};const t=await this.constructInnerArc(),n=e.get("hostedParticle");let i=null,r=[],s=[];n&&(i=await n.get())&&([r,s]=await this._mapParticleConnections("list","hostedParticle",i,e,t)),this.setState({arc:t,type:e.get("list").type,hostedParticle:i,otherMappedHandles:r,otherConnections:s}),await super.setHandles(e)}async update({list:e},{arc:t,type:n,hostedParticle:i,otherMappedHandles:r,otherConnections:s},o,a){if(e&&t&&(o.list!==e||a.arc!==t)){e.length>0&&(this.relevance=.1);for(const[o,a]of this.getListEntries(e)){let e=i;const c=oe.a.id(a);if(this.handleIds[c]){(await this.handleIds[c]).set(a);continue}const l=t.createHandle(n.getContainedType(),`item${o}`);this.handleIds[c]=l;const u=await l;if(!e){if(!a.renderParticleSpec)continue;e=se.a.fromLiteral(JSON.parse(a.renderParticleSpec));const n="list",i="renderParticle";[r,s]=await this._mapParticleConnections(n,i,e,this.handles,t)}const h=[...e.slotConnections.keys()][0],d=[...this.spec.slotConnections.values()][0].name,p=await t.createSlot(this,d,u._id);if(p){this._itemSubIdByHostedSlotId.set(p,c);try{const n=this.constructInnerRecipe(e,a,u,{name:h,id:p},{connections:s,handles:r});await t.loadRecipe(n),u.set(a)}catch(e){console.log(e)}}}}}combineHostedModel(e,t,n){const i=this._itemSubIdByHostedSlotId.get(t);if(!i)return;const r=this._state.renderModel?this._state.renderModel.items:[],s=r.findIndex(e=>e.subId===i),o={...n.model,subId:i};s>=0&&s<r.length?r[s]=o:r.push(o),this.setState({renderModel:{items:r}})}combineHostedTemplate(e,t,n){const r=this._itemSubIdByHostedSlotId.get(t);if(!r)return;Object(i.a)(n.templateName,`Template name is missing for slot '${e}' (hosted slot ID: '${t}')`);const s={...this._state.templateName,[r]:`${n.templateName}`};if(this.setState({templateName:s}),n.template){let e=n.template;e=e.replace(new RegExp('slotid="[a-z]+"',"gi"),'$& subid$="{{subId}}"'),this._connByHostedConn.forEach((t,n)=>{e=e.replace(new RegExp(`{{${n}.description}}`,"g"),`{{${t}.description}}`)}),this.setState({template:{...this._state.template,[n.templateName]:e}}),this.forceRenderTemplate()}}getListEntries(e){return e.entries()}}var le=n(13);n.d(t,"a",function(){return he});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const ue=(e,...t)=>(e[0]+t.map((t,n)=>t+e[n+1]).join("")).trim();class he{path(e){return e.replace(/[\/][^\/]+$/,"/")}join(e,t){return/^https?:\/\//.test(t)?t:"/"===t[0]||":"===t[1]?t:(e=this.path(e),t=this.normalizeDots(`${e}${t}`))}normalizeDots(e){const t=e=>e.replace(/(?:^|\/)[^.\/]*\/\.\./g,"");for(let n=t(e=(e=e.replace(/\\/g,"/")).replace(/\/\.\//g,"/"));n!==e;n=t(e=n));return e=e.replace(/([^:])(\/\/)/g,"$1/")}async loadResource(e){return/^https?:\/\//.test(e)?this._loadURL(e):this._loadFile(e,"utf-8")}async loadBinary(e){return/^https?:\/\//.test(e)?V(e).then(e=>e.arrayBuffer()):this._loadFile(e,null)}async _loadFile(e,t){return new Promise((n,i)=>{J.a.readFile(e,{encoding:t},(e,r)=>{e?i(e):n(t?r:r.buffer)})})}async _loadURL(e){return/\/\/schema.org\//.test(e)?e.endsWith("/Thing")?V("https://schema.org/Product.jsonld").then(e=>e.text()).then(e=>Y.convert(e,{"@id":"schema:Thing"})):V(e+".jsonld").then(e=>e.text()).then(e=>Y.convert(e)):V(e).then(e=>e.text())}async loadParticleClass(e){const t=await this.requireParticle(e.implFile);return t.spec=e,t}async requireParticle(e){null===e&&(e="");const t=await this.loadResource(e),n=new Z.a.Script(t,{filename:e,displayErrors:!0}),r=[],s={defineParticle(e){r.push(e)},console:console,fetch:V,setTimeout:setTimeout,importScripts:e=>null};return n.runInNewContext(s,{filename:e,displayErrors:!0}),Object(i.a)(r.length>0&&"function"==typeof r[0],`Error while instantiating particle implementation from ${e}`),this.unwrapParticle(r[0])}setParticleExecutionContext(e){this.pec=e}unwrapParticle(e){return Object(i.a)(this.pec),e({Particle:ne.a,DomParticle:re,TransformationDomParticle:ae,MultiplexerDomParticle:ce,Reference:le.a.newClientReference(this.pec),html:ue})}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const i=Symbol("internals")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i,r=n(0);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.Dom="dom",e.DomTouch="dom-touch",e.Vr="vr",e.Voice="voice"}(i||(i={}));class s{constructor(e){this.names=e}static create(e){return Object(r.a)(e.every(e=>s.all.names.includes(e)),`Unsupported modality in: ${e}`),new s(e)}intersection(e){return new s(this.names.filter(t=>e.names.includes(t)))}isResolved(){return this.names.length>0}isCompatible(e){return this.intersection(s.create(e)).isResolved()}static get Name(){return i}}s.all=new s([s.Name.Dom,s.Name.DomTouch,s.Name.Vr,s.Name.Voice]),s.dom=new s([s.Name.Dom]),s.domTouch=new s([s.Name.DomTouch]),s.voice=new s([s.Name.Voice]),s.vr=new s([s.Name.Vr])},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(3),r=n(4);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(){this.relevances=[],this._idle=Promise.resolve(),this._busy=0,this.slotProxiesByName=new Map,this.spec=this.constructor.spec,0===this.spec.inputs.length&&(this.extraData=!0)}setCapabilities(e){if(this.capabilities)throw new Error("capabilities should only be set once");this.capabilities=e||{}}async invokeSafely(e,t){try{this.startBusy(),await e(this)}catch(e){t(e)}finally{this.doneBusy()}}async callSetHandles(e,t){await this.invokeSafely(async t=>t.setHandles(e),t)}async setHandles(e){}async callOnHandleSync(e,t,n){await this.invokeSafely(async n=>n.onHandleSync(e,t),n)}async onHandleSync(e,t){}async callOnHandleUpdate(e,t,n){await this.invokeSafely(async n=>n.onHandleUpdate(e,t),n)}async onHandleUpdate(e,t){}async callOnHandleDesync(e,t){await this.invokeSafely(async t=>t.onHandleDesync(e),t)}async onHandleDesync(e){}async constructInnerArc(){if(!this.capabilities.constructInnerArc)throw new Error("This particle is not allowed to construct inner arcs");return this.capabilities.constructInnerArc(this)}get busy(){return this._busy>0}get idle(){return this._idle}set relevance(e){this.relevances.push(e)}startBusy(){0===this._busy&&(this._idle=new Promise(e=>this._idleResolver=(()=>e()))),this._busy++}doneBusy(){this._busy--,0===this._busy&&this._idleResolver()}inputs(){return this.spec.inputs}outputs(){return this.spec.outputs}hasSlotProxy(e){return this.slotProxiesByName.has(e)}addSlotProxy(e){this.slotProxiesByName.set(e.slotName,e)}removeSlotProxy(e){this.slotProxiesByName.delete(e)}async service(e){return this.capabilities.serviceRequest?new Promise(t=>{this.capabilities.serviceRequest(this,e,e=>t(e))}):(console.warn(`${this.spec.name} has no service support.`),null)}getSlot(e){return this.slotProxiesByName.get(e)}static buildManifest(e,...t){const n=[];for(let i=0;i<t.length;i++){const r=e[i],s=/ *$/.exec(r)[0];let o;o=(o="string"==typeof t[i]?t[i]:t[i].toManifestString()).replace(/(\n)/g,"$1"+s),n.push(r),n.push(o)}return e.length>t.length&&n.push(e[e.length-1]),n.join("")}async setParticleDescription(e){return this.setDescriptionPattern("pattern",e)}async setDescriptionPattern(e,t){const n=this.handles.get("descriptions");if(n){const r=n.entityClass;return(n instanceof i.b||n instanceof i.a)&&await n.store(new r({key:e,value:t},this.spec.name+"-"+e)),!0}throw new Error("A particle needs a description handle to set a decription pattern")}idFor(e){return r.a.id(e)}dataClone(e){return r.a.dataClone(e)}mutate(e,t){r.a.mutate(e,t)}renderSlot(e,t){}renderHostedSlot(e,t,n){}fireEvent(e,t){}}},function(e,t){e.exports=require("zlib")},,function(e,t){e.exports=require("path")},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var i=n(0),r=n(5),s=n(1);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function o(e){return s.j.fromLiteral(e)}function a(e){return"object"==typeof e?o(e):e}function c({type:e,name:t,direction:n}){return{type:e?o(e):void 0,name:t?a(t):void 0,direction:n}}function l({name:e,direction:t,isRequired:n,isSet:i}){return{name:e?a(e):void 0,direction:t,isRequired:n,isSet:i}}function u(e){return e instanceof s.k?e.toLiteral():e}function h({type:e,name:t,direction:n}){return{type:e?e.toLiteral():void 0,name:t?u(t):void 0,direction:n}}function d({name:e,direction:t,isRequired:n,isSet:i}){return{name:e?u(e):void 0,direction:t,isRequired:n,isSet:i}}const p=["type","name","direction"],f=["name","direction","isRequired","isSet"];class m{constructor(e,t,n){Object(i.a)(e),Object(i.a)(void 0!==t),Object(i.a)(void 0!==n),this.name=e,this.handles=t,this.slots=n,this.typeVars=[];for(const e of t)for(const t of p)m.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t});for(const e of n)for(const t of f)m.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t})}toPrettyString(){return"InterfaceInfo"}mergeTypeVariablesByName(e){this.typeVars.map(({object:t,field:n})=>t[n]=t[n].mergeTypeVariablesByName(e))}get canReadSubset(){return this._cloneAndUpdate(e=>e.canReadSubset)}get canWriteSuperset(){return this._cloneAndUpdate(e=>e.canWriteSuperset)}isMoreSpecificThan(e){if(this.handles.length!==e.handles.length||this.slots.length!==e.slots.length)return!1;for(let t=0;t<this.typeVars.length;t++){const n=this.typeVars[t],i=e.typeVars[t];if(!n.object[n.field].isMoreSpecificThan(i.object[i.field]))return!1}return!0}_applyExistenceTypeTest(e){for(const t of this.typeVars)if(e(t.object[t.field]))return!0;return!1}_handlesToManifestString(){return this.handles.map(e=>`  ${e.direction?e.direction+" ":""}${e.type.toString()} ${e.name?e.name:"*"}`).join("\n")}_slotsToManifestString(){return this.slots.map(e=>`  ${e.direction} ${e.isSet?"set of ":""}${e.name?e.name+" ":""}`).join("\n")}toString(){return`interface ${this.name}\n${this._handlesToManifestString()}\n${this._slotsToManifestString()}`}static fromLiteral(e){const t=e.handles.map(c),n=e.slots.map(l);return new m(e.name,t,n)}toLiteral(){const e=this.handles.map(h),t=this.slots.map(d);return{name:this.name,handles:e,slots:t}}clone(e){const t=this.handles.map(({name:t,direction:n,type:i})=>({name:t,direction:n,type:i?i.clone(e):void 0})),n=this.slots.map(({name:e,direction:t,isRequired:n,isSet:i})=>({name:e,direction:t,isRequired:n,isSet:i}));return new m(this.name,t,n)}cloneWithResolutions(e){return this._cloneWithResolutions(e)}_cloneWithResolutions(e){const t=this.handles.map(({name:t,direction:n,type:i})=>({name:t,direction:n,type:i?i._cloneWithResolutions(e):void 0})),n=this.slots.map(({name:e,direction:t,isRequired:n,isSet:i})=>({name:e,direction:t,isRequired:n,isSet:i}));return new m(this.name,t,n)}canEnsureResolved(){for(const e of this.typeVars)if(!e.object[e.field].canEnsureResolved())return!1;return!0}maybeEnsureResolved(){for(const e of this.typeVars){let t=e.object[e.field];if(!(t=t.clone(new Map)).maybeEnsureResolved())return!1}for(const e of this.typeVars)e.object[e.field].maybeEnsureResolved();return!0}tryMergeTypeVariablesWith(e){if(!this._equalItems(e.slots,this.slots,this._equalSlot))return null;if(e.handles.length!==this.handles.length)return null;const t=new Set(this.handles),n=new Set(e.handles),i=new Map;let s=t.size;for(;t.size>0;){const e=[...t.values()].map(e=>({handle:e,match:[...n.values()].filter(t=>this._equalHandle(e,t))}));for(const r of e){if(0===r.match.length)return null;1===r.match.length&&(i.set(r.handle,r.match[0]),n.delete(r.match[0]),t.delete(r.handle))}if(t.size===s)return null;s=t.size}const o=[];for(const e of this.handles){const t=i.get(e);let n;if(e.type.hasVariable||t.type.hasVariable){if(!(n=r.a._tryMergeTypeVariable(e.type,t.type)))return null}else n=e.type||t.type;o.push({name:e.name||t.name,direction:e.direction||t.direction,type:n})}const a=this.slots.map(({name:e,direction:t,isRequired:n,isSet:i})=>({name:e,direction:t,isRequired:n,isSet:i}));return new m(this.name,o,a)}resolvedType(){return this._cloneAndUpdate(e=>e.resolvedType())}equals(e){return this.handles.length===e.handles.length&&(!!this._equalItems(e.handles,this.handles,this._equalHandle)&&!!this._equalItems(e.slots,this.slots,this._equalSlot))}_equalHandle(e,t){return e.name===t.name&&e.direction===t.direction&&r.a.compareTypes({type:e.type},{type:t.type})}_equalSlot(e,t){return e.name===t.name&&e.direction===t.direction&&e.isRequired===t.isRequired&&e.isSet===t.isSet}_equalItems(e,t,n){for(const i of e){let e=!1;for(const r of t)if(n(r,i)){e=!0;break}if(!e)return!1}return!0}_cloneAndUpdate(e){const t=this.clone(new Map);return t.typeVars.forEach(t=>m._updateTypeVar(t,e)),t}static _updateTypeVar(e,t){e.object[e.field]=t(e.object[e.field])}static isTypeVar(e){return e instanceof s.k||e instanceof s.j&&e.hasVariable}static mustMatch(e){return!(null==e||m.isTypeVar(e))}static handlesMatch(e,t){if(m.mustMatch(e.name)&&e.name!==t.name)return!1;if(m.mustMatch(e.direction)&&e.direction!==t.direction)return!1;if(null==e.type)return!0;const[n,i]=s.j.unwrapPair(e.type,t.type);return n instanceof s.k?[{var:n,value:i,direction:e.direction}]:r.a.compareTypes({type:n},{type:i})}static slotsMatch(e,t){return(!m.mustMatch(e.name)||e.name===t.name)&&((!m.mustMatch(e.direction)||e.direction===t.direction)&&((!m.mustMatch(e.isRequired)||e.isRequired===t.isRequired)&&(!m.mustMatch(e.isSet)||e.isSet===t.isSet)))}particleMatches(e){return!1!==this.cloneWithResolutions(new Map).restrictType(e)}restrictType(e){return this._restrictThis(e)}_restrictThis(e){const t=this.handles.map(t=>e.handleConnections.map(e=>({match:e,result:m.handlesMatch(t,e)})).filter(e=>!1!==e.result)),n=[];e.slotConnections.forEach(e=>{n.push({name:e.name,direction:"consume",isRequired:e.isRequired,isSet:e.isSet}),e.provideSlotConnections.forEach(e=>{n.push({name:e.name,direction:"provide",isRequired:!1,isSet:e.isSet})})});const i=this.slots.map(e=>n.filter(t=>m.slotsMatch(e,t))).map(e=>e.map(e=>({match:e,result:!0})));function o(e,t){if(0===e.length)return[];const n=e.pop();for(const i of n){if(t.includes(i.match))continue;const n=t.slice();n.push(i.match);const r=o(e,n);if(!1!==r)return"boolean"==typeof i.result?r:r.concat(i.result)}return!1}const a=o(t,[]),c=o(i,[]);if(!1===a||!1===c)return!1;for(const e of a)if(e.var.variable.resolution){if(e.var.variable.resolution instanceof s.k){if(!r.a.processTypeList(e.var,[{type:e.value,direction:e.direction}]))return!1}else if(!r.a.compareTypes({type:e.var.variable.resolution},{type:e.value}))return!1}else e.var.variable.resolution=e.value;return!0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class i{constructor(e,t){this.formFactor=e,this.handle=t}toLiteral(){return this}static fromLiteral({formFactor:e,handle:t}){return new i(e,t)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return r});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class i{constructor(e,t){this.id=e.toString(),this.serialization=t.replace(/\bimport .*\n/g,"")}static extractSerialization(e){return e.serialization.replace(/\bimport .*\n/g,"")}}class r{constructor(e,t,n,i){this.id=e,this.storageKey=t,this.type=n,this.tags=i}}},,,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});var o=n(42),a=n(125);t.RequestType=a.RequestType,t.RequestType0=a.RequestType0,t.RequestType1=a.RequestType1,t.RequestType2=a.RequestType2,t.RequestType3=a.RequestType3,t.RequestType4=a.RequestType4,t.RequestType5=a.RequestType5,t.RequestType6=a.RequestType6,t.RequestType7=a.RequestType7,t.RequestType8=a.RequestType8,t.RequestType9=a.RequestType9,t.ResponseError=a.ResponseError,t.ErrorCodes=a.ErrorCodes,t.NotificationType=a.NotificationType,t.NotificationType0=a.NotificationType0,t.NotificationType1=a.NotificationType1,t.NotificationType2=a.NotificationType2,t.NotificationType3=a.NotificationType3,t.NotificationType4=a.NotificationType4,t.NotificationType5=a.NotificationType5,t.NotificationType6=a.NotificationType6,t.NotificationType7=a.NotificationType7,t.NotificationType8=a.NotificationType8,t.NotificationType9=a.NotificationType9;var c=n(58);t.MessageReader=c.MessageReader,t.StreamMessageReader=c.StreamMessageReader,t.IPCMessageReader=c.IPCMessageReader,t.SocketMessageReader=c.SocketMessageReader;var l=n(59);t.MessageWriter=l.MessageWriter,t.StreamMessageWriter=l.StreamMessageWriter,t.IPCMessageWriter=l.IPCMessageWriter,t.SocketMessageWriter=l.SocketMessageWriter;var u=n(51);t.Disposable=u.Disposable,t.Event=u.Event,t.Emitter=u.Emitter;var h=n(126);t.CancellationTokenSource=h.CancellationTokenSource,t.CancellationToken=h.CancellationToken;var d,p,f,m,g,y=n(127);s(n(128)),s(n(129)),function(e){e.type=new a.NotificationType("$/cancelRequest")}(d||(d={})),t.NullLogger=Object.freeze({error:function(){},warn:function(){},info:function(){},log:function(){}}),function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Verbose=2]="Verbose"}(p=t.Trace||(t.Trace={})),function(e){e.fromString=function(t){switch(t=t.toLowerCase()){case"off":return e.Off;case"messages":return e.Messages;case"verbose":return e.Verbose;default:return e.Off}},e.toString=function(t){switch(t){case e.Off:return"off";case e.Messages:return"messages";case e.Verbose:return"verbose";default:return"off"}}}(p=t.Trace||(t.Trace={})),function(e){e.type=new a.NotificationType("$/setTraceNotification")}(f=t.SetTraceNotification||(t.SetTraceNotification={})),function(e){e.type=new a.NotificationType("$/logTraceNotification")}(m=t.LogTraceNotification||(t.LogTraceNotification={})),function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"}(g=t.ConnectionErrors||(t.ConnectionErrors={}));var v,b=function(e){function t(n,i){var r=e.call(this,i)||this;return r.code=n,Object.setPrototypeOf(r,t.prototype),r}return r(t,e),t}(Error);function _(e,t,n,i){var r,s,c=0,l=0,_=0,w="2.0",S=void 0,C=Object.create(null),T=void 0,k=Object.create(null),R=new y.LinkedMap,x=Object.create(null),E=Object.create(null),O=p.Off,j=v.New,M=new u.Emitter,$=new u.Emitter,P=new u.Emitter,N=new u.Emitter;function I(e){return"req-"+e.toString()}function D(e,t){var n;a.isRequestMessage(t)?e.set(I(t.id),t):a.isResponseMessage(t)?e.set(null===(n=t.id)?"res-unknown-"+(++_).toString():"res-"+n.toString(),t):e.set("not-"+(++l).toString(),t)}function A(e){}function q(){return j===v.Listening}function F(){return j===v.Closed}function H(){return j===v.Disposed}function L(){j!==v.New&&j!==v.Listening||(j=v.Closed,$.fire(void 0))}function B(){r||0===R.size||(r=setImmediate(function(){r=void 0,function(){if(0===R.size)return;var e=R.shift();try{a.isRequestMessage(e)?function(e){if(H())return;function n(n,i,r){var s={jsonrpc:w,id:e.id};n instanceof a.ResponseError?s.error=n.toJson():s.result=void 0===n?null:n,W(s,i,r),t.write(s)}function i(n,i,r){var s={jsonrpc:w,id:e.id,error:n.toJson()};W(s,i,r),t.write(s)}!function(e){if(O===p.Off||!s)return;var t=void 0;O===p.Verbose&&e.params&&(t="Params: "+JSON.stringify(e.params,null,4)+"\n\n");s.log("Received request '"+e.method+" - ("+e.id+")'.",t)}(e);var r,c,l=C[e.method];l&&(r=l.type,c=l.handler);var u=Date.now();if(c||S){var d=new h.CancellationTokenSource,f=String(e.id);E[f]=d;try{var m=void 0,g=m=void 0===e.params||void 0!==r&&0===r.numberOfParams?c?c(d.token):S(e.method,d.token):o.array(e.params)&&(void 0===r||r.numberOfParams>1)?c?c.apply(void 0,e.params.concat([d.token])):S.apply(void 0,[e.method].concat(e.params,[d.token])):c?c(e.params,d.token):S(e.method,e.params,d.token);m?g.then?g.then(function(t){delete E[f],n(t,e.method,u)},function(t){delete E[f],t instanceof a.ResponseError?i(t,e.method,u):t&&o.string(t.message)?i(new a.ResponseError(a.ErrorCodes.InternalError,"Request "+e.method+" failed with message: "+t.message),e.method,u):i(new a.ResponseError(a.ErrorCodes.InternalError,"Request "+e.method+" failed unexpectedly without providing any details."),e.method,u)}):(delete E[f],n(m,e.method,u)):(delete E[f],function(n,i,r){void 0===n&&(n=null);var s={jsonrpc:w,id:e.id,result:n};W(s,i,r),t.write(s)}(m,e.method,u))}catch(t){delete E[f],t instanceof a.ResponseError?n(t,e.method,u):t&&o.string(t.message)?i(new a.ResponseError(a.ErrorCodes.InternalError,"Request "+e.method+" failed with message: "+t.message),e.method,u):i(new a.ResponseError(a.ErrorCodes.InternalError,"Request "+e.method+" failed unexpectedly without providing any details."),e.method,u)}}else i(new a.ResponseError(a.ErrorCodes.MethodNotFound,"Unhandled method "+e.method),e.method,u)}(e):a.isNotificationMessage(e)?function(e){if(H())return;var t,i=void 0;if(e.method===d.type.method)t=function(e){var t=e.id,n=E[String(t)];n&&n.cancel()};else{var r=k[e.method];r&&(t=r.handler,i=r.type)}if(t||T)try{!function(e){if(O===p.Off||!s||e.method===m.type.method)return;var t=void 0;O===p.Verbose&&(t=e.params?"Params: "+JSON.stringify(e.params,null,4)+"\n\n":"No parameters provided.\n\n");s.log("Received notification '"+e.method+"'.",t)}(e),void 0===e.params||void 0!==i&&0===i.numberOfParams?t?t():T(e.method):o.array(e.params)&&(void 0===i||i.numberOfParams>1)?t?t.apply(void 0,e.params):T.apply(void 0,[e.method].concat(e.params)):t?t(e.params):T(e.method,e.params)}catch(t){t.message?n.error("Notification handler '"+e.method+"' failed with message: "+t.message):n.error("Notification handler '"+e.method+"' failed unexpectedly.")}else P.fire(e)}(e):a.isResponseMessage(e)?function(e){if(H())return;if(null===e.id)e.error?n.error("Received response message without id: Error is: \n"+JSON.stringify(e.error,void 0,4)):n.error("Received response message without id. No further error information provided.");else{var t=String(e.id),i=x[t];if(function(e,t){if(O===p.Off||!s)return;var n=void 0;O===p.Verbose&&(e.error&&e.error.data?n="Error data: "+JSON.stringify(e.error.data,null,4)+"\n\n":e.result?n="Result: "+JSON.stringify(e.result,null,4)+"\n\n":void 0===e.error&&(n="No result returned.\n\n"));if(t){var i=e.error?" Request failed: "+e.error.message+" ("+e.error.code+").":"";s.log("Received response '"+t.method+" - ("+e.id+")' in "+(Date.now()-t.timerStart)+"ms."+i,n)}else s.log("Received response "+e.id+" without active response promise.",n)}(e,i),i){delete x[t];try{if(e.error){var r=e.error;i.reject(new a.ResponseError(r.code,r.message,r.data))}else{if(void 0===e.result)throw new Error("Should never happen.");i.resolve(e.result)}}catch(r){r.message?n.error("Response handler '"+i.method+"' failed with message: "+r.message):n.error("Response handler '"+i.method+"' failed unexpectedly.")}}}}(e):function(e){if(!e)return void n.error("Received empty message.");n.error("Received message which is neither a response nor a notification message:\n"+JSON.stringify(e,null,4));var t=e;if(o.string(t.id)||o.number(t.id)){var i=String(t.id),r=x[i];r&&r.reject(new Error("The received response has neither a result nor an error property."))}}(e)}finally{B()}}()}))}e.onClose(L),e.onError(function(e){M.fire([e,void 0,void 0])}),t.onClose(L),t.onError(function(e){M.fire(e)});var z=function(e){try{if(a.isNotificationMessage(e)&&e.method===d.type.method){var n=I(e.params.id),r=R.get(n);if(a.isRequestMessage(r)){var s=i&&i.cancelUndispatched?i.cancelUndispatched(r,A):void 0;if(s&&(void 0!==s.error||void 0!==s.result))return R.delete(n),s.id=r.id,W(s,e.method,Date.now()),void t.write(s)}}D(R,e)}finally{B()}};function W(e,t,n){if(O!==p.Off&&s){var i=void 0;O===p.Verbose&&(e.error&&e.error.data?i="Error data: "+JSON.stringify(e.error.data,null,4)+"\n\n":e.result?i="Result: "+JSON.stringify(e.result,null,4)+"\n\n":void 0===e.error&&(i="No result returned.\n\n")),s.log("Sending response '"+t+" - ("+e.id+")'. Processing request took "+(Date.now()-n)+"ms",i)}}function U(){if(F())throw new b(g.Closed,"Connection is closed.");if(H())throw new b(g.Disposed,"Connection is disposed.")}function V(e){return void 0===e?null:e}function K(e,t){var n,i=e.numberOfParams;switch(i){case 0:n=null;break;case 1:n=V(t[0]);break;default:n=[];for(var r=0;r<t.length&&r<i;r++)n.push(V(t[r]));if(t.length<i)for(r=t.length;r<i;r++)n.push(null)}return n}var J={sendNotification:function(e){for(var n,i,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];if(U(),o.string(e))switch(n=e,r.length){case 0:i=null;break;case 1:i=r[0];break;default:i=r}else n=e.method,i=K(e,r);var c={jsonrpc:w,method:n,params:i};!function(e){if(O!==p.Off&&s){var t=void 0;O===p.Verbose&&(t=e.params?"Params: "+JSON.stringify(e.params,null,4)+"\n\n":"No parameters provided.\n\n"),s.log("Sending notification '"+e.method+"'.",t)}}(c),t.write(c)},onNotification:function(e,t){U(),o.func(e)?T=e:t&&(o.string(e)?k[e]={type:void 0,handler:t}:k[e.method]={type:e,handler:t})},sendRequest:function(e){for(var n,i,r=[],l=1;l<arguments.length;l++)r[l-1]=arguments[l];U(),function(){if(!q())throw new Error("Call listen() first.")}();var u=void 0;if(o.string(e))switch(n=e,r.length){case 0:i=null;break;case 1:h.CancellationToken.is(r[0])?(i=null,u=r[0]):i=V(r[0]);break;default:var f=r.length-1;h.CancellationToken.is(r[f])?(u=r[f],i=2===r.length?V(r[0]):r.slice(0,f).map(function(e){return V(e)})):i=r.map(function(e){return V(e)})}else{n=e.method,i=K(e,r);var m=e.numberOfParams;u=h.CancellationToken.is(r[m])?r[m]:void 0}var g=c++,y=new Promise(function(e,r){var o={jsonrpc:w,id:g,method:n,params:i},c={method:n,timerStart:Date.now(),resolve:e,reject:r};!function(e){if(O!==p.Off&&s){var t=void 0;O===p.Verbose&&e.params&&(t="Params: "+JSON.stringify(e.params,null,4)+"\n\n"),s.log("Sending request '"+e.method+" - ("+e.id+")'.",t)}}(o);try{t.write(o)}catch(e){c.reject(new a.ResponseError(a.ErrorCodes.MessageWriteError,e.message?e.message:"Unknown reason")),c=null}c&&(x[String(g)]=c)});return u&&u.onCancellationRequested(function(){J.sendNotification(d.type,{id:g})}),y},onRequest:function(e,t){U(),o.func(e)?S=e:t&&(o.string(e)?C[e]={type:void 0,handler:t}:C[e.method]={type:e,handler:t})},trace:function(e,t,n){void 0===n&&(n=!1),s=(O=e)===p.Off?void 0:t,!n||F()||H()||J.sendNotification(f.type,{value:p.toString(e)})},onError:M.event,onClose:$.event,onUnhandledNotification:P.event,onDispose:N.event,dispose:function(){if(!H()){j=v.Disposed,N.fire(void 0);var n=new Error("Connection got disposed.");Object.keys(x).forEach(function(e){x[e].reject(n)}),x=Object.create(null),E=Object.create(null),R=new y.LinkedMap,o.func(t.dispose)&&t.dispose(),o.func(e.dispose)&&e.dispose()}},listen:function(){U(),function(){if(q())throw new b(g.AlreadyListening,"Connection is already listening")}(),j=v.Listening,e.listen(z)},inspect:function(){console.log("inspect")}};return J.onNotification(m.type,function(e){O!==p.Off&&s&&s.log(e.message,O===p.Verbose?e.verbose:void 0)}),J}t.ConnectionError=b,function(e){e.is=function(e){var t=e;return t&&o.func(t.cancelUndispatched)}}(t.ConnectionStrategy||(t.ConnectionStrategy={})),function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"}(v||(v={})),t.createMessageConnection=function(e,n,i,r){var s;return i||(i=t.NullLogger),_(void 0!==(s=e).listen&&void 0===s.read?e:new c.StreamMessageReader(e),function(e){return void 0!==e.write&&void 0===e.end}(n)?n:new l.StreamMessageWriter(n),i,r)}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("http")},,,function(e,t){e.exports=require("net")},function(e,t,n){"use strict";class i extends Error{static buildMessage(e,t){function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,e=>"\\x0"+n(e)).replace(/[\x10-\x1F\x7F-\x9F]/g,e=>"\\x"+n(e))}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,e=>"\\x0"+n(e)).replace(/[\x10-\x1F\x7F-\x9F]/g,e=>"\\x"+n(e))}function s(e){switch(e.type){case"literal":return'"'+i(e.text)+'"';case"class":const t=e.parts.map(e=>Array.isArray(e)?r(e[0])+"-"+r(e[1]):r(e));return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){const t=e.map(s);let n,i;if(t.sort(),t.length>0){for(n=1,i=1;n<t.length;n++)t[n-1]!==t[n]&&(t[i]=t[n],i++);t.length=i}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+((o=t)?'"'+i(o)+'"':"end of input")+" found.";var o}constructor(e,t,n,r){super(),this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,i)}}const r=function(e,t){t=void 0!==t?t:{};const n={},r={Manifest:Rs};let s=Rs;const o=function(e){const t=e.map(e=>{const t=e[2];return t.annotation=$o(e[0],e=>e[1],null),t});return function e(t){if(!["string","number","boolean"].includes(typeof t)&&null!==t)if(void 0===t&&vs("result was undefined"),Array.isArray(t))for(const n of t)e(n);else{t.model&&vs(`unexpected 'model' in ${JSON.stringify(t)}`),t.location||vs(`no 'location' in ${JSON.stringify(t)}`),t.kind||vs(`no 'kind' in ${JSON.stringify(t)}`);for(const n of Object.keys(t))["location","kind"].includes(n)||e(t[n])}}(t),t},a=ws("an annotation (e.g. @foo)"),c="@",l=bs("@",!1),u=function(e){return e},h="resource",d=bs("resource",!1),p=function(e,t){return{kind:"resource",name:e,data:t,location:gs()}},f="start",m=bs("start",!1),g=function(){Eo=xo},y=function(e){return e.map(e=>e[0].substring(Eo.length)+e[1]).join("")},v=/^[^\n]/,b=_s(["\n"],!0,!1),_=function(){return ms()},w="store",S=bs("store",!1),C="of",T=bs("of",!1),k="!!",R=bs("!!",!1),x=function(e,t,n,i,r,s,o,a){return a=$o(a,Mo,[]),{kind:"store",location:gs(),name:e,type:t,id:$o(n,e=>e[1],null),originalId:$o(i,e=>e[1],null),version:$o(r,e=>e[1],null),tags:$o(s,e=>e[1],null),source:o.source,origin:o.origin,description:a.length>0?a[0][2]:null}},E="in",O=bs("in",!1),j=function(e){return{origin:"file",source:e}},M=function(e){return{origin:"resource",source:e}},$="at",P=bs("at",!1),N=function(e){return{origin:"storage",source:e}},I="description",D=bs("description",!1),A="import",q=bs("import",!1),F=function(e){return{kind:"import",location:gs(),path:e}},H=ws("an interface"),L="interface",B=bs("interface",!1),z="<",W=bs("<",!1),U=">",V=bs(">",!1),K=function(e,t,n){return{kind:"interface",location:gs(),name:e,args:$o(n,Mo,[]).filter(e=>"interface-argument"===e.kind),slots:$o(n,Mo,[]).filter(e=>"interface-slot"===e.kind)}},J="*",G=bs("*",!1),Z=function(e,t,n){return"host"===(e=$o(e,e=>e[0],null))&&vs("Interface cannot have arguments with a 'host' direction."),{kind:"interface-argument",location:gs(),direction:e,type:$o(t,e=>e[0],null),name:n}},Q="must",Y=bs("must",!1),X="consume",ee=bs("consume",!1),te="provide",ne=bs("provide",!1),ie="set of",re=bs("set of",!1),se=function(e,t,n,i){return{kind:"interface-slot",location:gs(),name:$o(i,e=>i[1],null),isRequired:$o(e,e=>"must"===e[0],!1),direction:t,isSet:!!n}},oe="meta",ae=bs("meta",!1),ce=function(e){return{kind:"meta",items:e=e?Mo(e):[],location:gs()}},le="name",ue=bs("name",!1),he=":",de=bs(":",!1),pe=function(e){return{key:"name",value:e,location:gs(),kind:"name"}},fe="storageKey",me=bs("storageKey",!1),ge=function(e){return{key:"storageKey",value:e,location:gs(),kind:"storageKey"}},ye="particle",ve=bs("particle",!1),be=function(e,t,n,i){let r=[];const s=[],o=[],a=[],c=[];let l=null,u=!1;return t=$o(t,e=>e[1],[]),(i=$o(i,Mo,[])).forEach(n=>{"particle-interface"===n.kind?(/[A-Z]/.test(n.verb[0])&&n.verb!==e&&vs(`Verb ${n.verb} must start with a lower case character or be same as particle name.`),t.push(n.verb),r=n.args,u=!0):"particle-argument"===n.kind?r.push(n):"particle-slot"===n.kind?o.push(n):"description"===n.kind?(l={kind:"description",location:gs()},n.description.forEach(e=>l[e.name]=e.pattern||e.patterns[0])):"particle-trust-claim-is-tag"===n.kind||"particle-trust-claim-derives-from"===n.kind?a.push(n):"particle-trust-check"===n.kind?c.push(n):n.modality?s.push(n.modality):vs(`Particle ${e} contains an unknown element: ${n.name}`)}),0===s.length&&s.push("dom"),{kind:"particle",location:gs(),name:e,implFile:$o(n,e=>e[3],null),verbs:t,args:r,modality:s,slotConnections:o,description:l,hasParticleArgument:u,trustClaims:a,trustChecks:c}},_e=ws("a particle item"),we="claim",Se=bs("claim",!1),Ce="is",Te=bs("is",!1),ke=function(e,t){return{kind:"particle-trust-claim-is-tag",claimType:"is-tag",location:gs(),handle:e,tag:t}},Re="derives from",xe=bs("derives from",!1),Ee="and",Oe=bs("and",!1),je=function(e,t,n){const i=[t,...n.map(e=>e[3])];return{kind:"particle-trust-claim-derives-from",claimType:"derives-from",location:gs(),handle:e,parentHandles:i}},Me="check",$e=bs("check",!1),Pe="or",Ne=bs("or",!1),Ie=function(e,t,n){const i=[t,...n.map(e=>e[3])];return{kind:"particle-trust-check",location:gs(),handle:e,conditions:i}},De=function(e){return{kind:"particle-trust-check-has-tag",checkType:"has-tag",location:gs(),tag:e}},Ae="is from handle",qe=bs("is from handle",!1),Fe=function(e){return{kind:"particle-trust-check-is-from-handle",checkType:"is-from-handle",location:gs(),parentHandle:e}},He=function(e,t){return e.dependentConnections=$o(t,Mo,[]),e},Le="?",Be=bs("?",!1),ze=function(e,t,n,i){return{kind:"particle-argument",location:gs(),direction:e,type:n,isOptional:!!t,dependentConnections:[],name:i.name,tags:i.tags}},We=ws("a direction (e.g. inout, in, out, host, `consume, `provide)"),Ue="inout",Ve=bs("inout",!1),Ke="out",Je=bs("out",!1),Ge="host",Ze=bs("host",!1),Qe="`consume",Ye=bs("`consume",!1),Xe="`provide",et=bs("`provide",!1),tt=function(){return ms()},nt="[",it=bs("[",!1),rt="]",st=bs("]",!1),ot=function(e){return{kind:"collection-type",location:gs(),type:e}},at="BigCollection<",ct=bs("BigCollection<",!1),lt=function(e){return{kind:"big-collection-type",location:gs(),type:e}},ut="Reference<",ht=bs("Reference<",!1),dt=function(e){return{kind:"reference-type",location:gs(),type:e}},pt=ws("a type variable (e.g. ~foo)"),ft="~",mt=bs("~",!1),gt="with",yt=bs("with",!1),vt=function(e,t){return{kind:"variable-type",location:gs(),name:e,constraint:$o(t,e=>e[3],null)}},bt="Slot",_t=bs("Slot",!1),wt=/^[^a-z0-9_]/i,St=_s([["a","z"],["0","9"],"_"],!0,!0),Ct="{",Tt=bs("{",!1),kt=",",Rt=bs(",",!1),xt="}",Et=bs("}",!1),Ot=function(e){return e=$o(e,e=>{const t=e[2];return[t[0]].concat(t[1].map(e=>e[2]))},[]),{kind:"slot-type",location:gs(),fields:e}},jt=function(e,t){return{kind:"slot-field",location:gs(),name:e,value:t}},Mt=function(e){return{kind:"type-name",location:gs(),name:e}},$t=function(e,t){return[e,...t.map(e=>e[2])]},Pt="modality",Nt=bs("modality",!1),It=function(e){return{kind:"particle-modality",location:gs(),modality:e}},Dt="dom-touch",At=bs("dom-touch",!1),qt="dom",Ft=bs("dom",!1),Ht="vr",Lt=bs("vr",!1),Bt="voice",zt=bs("voice",!1),Wt="mock-dom-touch",Ut=bs("mock-dom-touch",!1),Vt="mock-dom",Kt=bs("mock-dom",!1),Jt="mock-vr",Gt=bs("mock-vr",!1),Zt="mock-voice",Qt=bs("mock-voice",!1),Yt=function(e,t,n,i,r){let s=null;const o=[];return(r=$o(r,Mo,[])).forEach(e=>{"provided-slot"===e.kind?o.push(e):"form-factor"===e.kind?(s&&vs("duplicate form factor for a slot"),s=e.formFactor):vs("Unsupported particle slot item ",e)}),{kind:"particle-slot",location:gs(),name:n,tags:$o(i,e=>e[1],[]),isRequired:$o(e,e=>"must"===e[0],!1),isSet:!!t,formFactor:s,provideSlotConnections:o}},Xt="formFactor",en=bs("formFactor",!1),tn="fullscreen",nn=bs("fullscreen",!1),rn="big",sn=bs("big",!1),on="medium",an=bs("medium",!1),cn="small",ln=bs("small",!1),un=function(e){return{kind:"form-factor",location:gs(),formFactor:e}},hn=function(e,t,n,i,r){let s=null;const o=[];return(r=r?Mo(r):[]).forEach(e=>{"form-factor"===e.kind?(s&&vs("duplicate form factor for a slot"),s=e.formFactor):o.push(e.handle)}),{kind:"provided-slot",location:gs(),name:n,tags:$o(i,e=>e[1],[]),isRequired:$o(e,e=>"must"===e[0],!1),isSet:!!t,formFactor:s,handles:o}},dn="handle",pn=bs("handle",!1),fn=function(e){return{kind:"particle-provided-slot-handle",location:gs(),handle:e}},mn=function(e,t){t=$o(t,Mo,[]);const n=[];return e&&n.push(e),t.filter(e=>"pattern"===e.name).forEach(e=>n.push(e)),t=t.filter(e=>"pattern"!==e.name),{kind:"description",location:gs(),description:[{kind:"default-description?",location:gs(),name:"pattern",patterns:n},...t]}},gn=function(e,t){return{kind:"handle-description",location:gs(),name:e,pattern:t}},yn="recipe",vn=bs("recipe",!1),bn=function(e,t,n){return t=$o(t,e=>e[1],[]),{kind:"recipe",location:gs(),name:$o(e,e=>e[1],null),verbs:t,items:$o(n,Mo,[])}},_n="as",wn=bs("as",!1),Sn=/^[a-zA-Z0-9]/,Cn=_s([["a","z"],["A","Z"],["0","9"]],!1,!1),Tn=function(){ys("lower identifier")},kn=function(e){return e},Rn=function(e,t,n){const i=[],r=[];if(n){n=Mo(n);for(const e of n)"handle-connection"===e.kind?i.push(e):r.push(e)}return{kind:"particle",location:gs(),name:$o(t,e=>e[1],null),ref:e,connections:i,slotConnections:r}},xn=function(e,t,n,i){return{kind:"handle-connection",location:gs(),param:e,dir:t,target:$o(n,e=>e[1],null),dependentConnections:$o(i,Mo,[])}},En=function(e,t){let n=null,i=null;return(e=$o(e,e=>e,null))&&(e[0].toUpperCase()===e[0]?i=e:n=e),{kind:"handle-connection-components",location:gs(),name:n,particle:i,tags:$o(t,e=>e,[])}},On=function(e,t,n,i){return{kind:"slot-connection",location:gs(),direction:e,param:t.param,tags:t.tags,name:$o(n,e=>e[1],null),dependentSlotConnections:$o(i,Mo,[])}},jn=function(e,t){return{kind:"slot-connection-ref",location:gs(),param:e,tags:t}},Mn=function(e,t,n){return{kind:"connection",location:gs(),direction:t,from:e,to:n}},$n="search",Pn=bs("search",!1),Nn="tokens",In=bs("tokens",!1),Dn=function(e,t){return{kind:"search",location:gs(),phrase:e,tokens:$o(t,e=>e[1][2].map(e=>e[1]),null)}},An="<-",qn=bs("<-",!1),Fn="->",Hn=bs("->",!1),Ln="=",Bn=bs("=",!1),zn=function(e,t){const{param:n,tags:i}=$o(t,e=>e,{param:null,tags:[]});return{kind:"connection-target",location:gs(),targetType:"verb",verbs:e,param:n,tags:i}},Wn=function(e){return{kind:"connection-target",location:gs(),targetType:"tag",tags:e}},Un=function(e,t){const{param:n,tags:i}=$o(t,e=>e,{param:null,tags:[]});return{kind:"connection-target",targetType:"localName",location:gs(),name:e,param:n,tags:i}},Vn=function(e,t){const{param:n,tags:i}=$o(t,e=>e,{param:null,tags:[]});return{kind:"connection-target",targetType:"particle",location:gs(),particle:e,param:n,tags:i}},Kn=".",Jn=bs(".",!1),Gn=function(e,t){return{param:$o(e,e=>e,null),tags:$o(t,e=>e[1],[])}},Zn="use",Qn=bs("use",!1),Yn="map",Xn=bs("map",!1),ei="create",ti=bs("create",!1),ni="copy",ii=bs("copy",!1),ri="`slot",si=bs("`slot",!1),oi=function(e,t,n){return{kind:"handle",location:gs(),name:$o(n,e=>e[1],null),ref:$o(t,e=>e[1],jo()),fate:e}},ai="require",ci=bs("require",!1),li=function(e){return{kind:"require",location:gs(),items:Mo(e)}},ui=function(e,t){return{kind:"requireHandle",location:gs(),name:$o(e,e=>e[1],null),ref:$o(t,e=>e[1],jo())}},hi="#",di=bs("#",!1),pi=/^[a-zA-Z]/,fi=_s([["a","z"],["A","Z"]],!1,!1),mi=/^[a-zA-Z0-9_]/,gi=_s([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),yi=function(){return ms().substring(1)},vi=function(e,t){return[e,...t&&t[1]||[]]},bi=ws("a verb (e.g. &Verb)"),_i="&",wi=bs("&",!1),Si=function(e){return e},Ci=function(e,t){return{location:gs(),name:e,tags:t=$o(t,e=>e[1],[])}},Ti=function(e){return{location:gs(),name:e,tags:[]}},ki=function(e){return{location:gs(),name:e[0],tags:e}},Ri=function(e){return{kind:"particle-ref",location:gs(),name:e,verbs:[],tags:[]}},xi=function(e){return{kind:"particle-ref",location:gs(),verbs:[e],tags:[]}},Ei=function(e,t){return{kind:"handle-ref",location:gs(),id:e,tags:t||[]}},Oi=function(e,t){return{kind:"handle-ref",location:gs(),name:e,tags:t||[]}},ji=function(e){return{kind:"handle-ref",location:gs(),tags:e}},Mi="slot",$i=bs("slot",!1),Pi=function(e,t){return{kind:"slot",location:gs(),ref:$o(e,e=>e[1],jo()),name:$o(t,e=>e[1],"")}},Ni=function(e,t){return{kind:"schema-inline",location:gs(),names:$o(e,e=>e.map(e=>e[0]).filter(e=>"*"!==e),[]),fields:$o(t,e=>[e[0],...e[1].map(e=>e[2])],[])}},Ii=function(e,t){return{kind:"schema-inline-field",location:gs(),name:t,type:$o(e,e=>e[0],null)}},Di="schema",Ai=bs("schema",!1),qi=function(e,t){return{names:e.map(e=>e[1]).filter(e=>"*"!==e),parents:$o(t,e=>e,[])}},Fi="alias",Hi=bs("alias",!1),Li=function(e,t,n){return{kind:"schema",location:gs(),items:$o(n,Mo,[]),alias:t,...e}},Bi=function(e,t){return{kind:"schema",location:gs(),items:$o(t,Mo,[]),...e}},zi="extends",Wi=bs("extends",!1),Ui=function(e,t){return[e,...t.map(e=>e[3])]},Vi=function(e,t){return{kind:"schema-field",location:gs(),type:e,name:t}},Ki=function(e){return{kind:"schema-collection",location:gs(),schema:e}},Ji=function(e){return{kind:"schema-reference",location:gs(),schema:e}},Gi="Text",Zi=bs("Text",!1),Qi="URL",Yi=bs("URL",!1),Xi="Number",er=bs("Number",!1),tr="Boolean",nr=bs("Boolean",!1),ir="Bytes",rr=bs("Bytes",!1),sr="Object",or=bs("Object",!1),ar=function(e){return{kind:"schema-primitive",location:gs(),type:e}},cr="(",lr=bs("(",!1),ur=")",hr=bs(")",!1),dr=function(e,t){const n=[e];for(const e of t)n.push(e[3]);return{kind:"schema-union",location:gs(),types:n}},pr=function(e,t){const n=[e];for(const e of t)n.push(e[3]);return{kind:"schema-tuple",location:gs(),types:n}},fr=ws("a version number (e.g. @012)"),mr=/^[0-9]/,gr=_s([["0","9"]],!1,!1),yr=function(e){return Number(e.join(""))},vr=ws("indentation"),br=" ",_r=bs(" ",!1),wr=function(e){return(e=e.join("")).length>xo.length&&(Oo.push(xo),xo=e,!0)},Sr=ws("same indentation"),Cr=function(e){return(e=e.join("")).length===xo.length||e.length<xo.length&&(xo=Oo.pop(),!1)},Tr=ws("same or more indentation"),kr=function(e){return(e=e.join("")).length>=xo.length||(e.length<xo.length?(xo=Oo.pop(),!1):void 0)},Rr=/^[^a-zA-Z0-9_]/,xr=_s([["a","z"],["A","Z"],["0","9"],"_"],!0,!1),Er={type:"any"},Or=function(e){ys("identifier")},jr=ws("a `backquoted string`"),Mr="`",$r=bs("`",!1),Pr=/^[^`]/,Nr=_s(["`"],!0,!1),Ir=function(e){return e.join("")},Dr=ws("an identifier (e.g. 'id')"),Ar="'",qr=bs("'",!1),Fr=/^[^']/,Hr=_s(["'"],!0,!1),Lr=function(e){return e.join("")},Br=ws("an uppercase identifier (e.g. Foo)"),zr=/^[A-Z]/,Wr=_s([["A","Z"]],!1,!1),Ur=/^[a-z0-9_]/i,Vr=_s([["a","z"],["0","9"],"_"],!1,!0),Kr=ws("a lowercase identifier (e.g. foo)"),Jr=/^[a-z]/,Gr=_s([["a","z"]],!1,!1),Zr=ws("a field name (e.g. foo9)"),Qr=ws("one or more whitespace characters"),Yr=ws("a group of new lines (and optionally comments)"),Xr=/^[ ]/,es=_s([" "],!1,!1),ts="//",ns=bs("//",!1),is=ws("a new line"),rs="\r",ss=bs("\r",!1),os="\n",as=bs("\n",!1);let cs=0,ls=0;const us=[{line:1,column:1}];let hs,ds=0,ps=[],fs=0;if(void 0!==t.startRule){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');s=r[t.startRule]}function ms(){return e.substring(ls,cs)}function gs(){return Cs(ls,cs)}function ys(t,n){throw n=void 0!==n?n:Cs(ls,cs),ks([ws(t)],e.substring(ls,cs),n)}function vs(e,t){throw function(e,t){return new i(e,[],"",t)}(e,t=void 0!==t?t:Cs(ls,cs))}function bs(e,t){return{type:"literal",text:e,ignoreCase:t}}function _s(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function ws(e){return{type:"other",description:e}}function Ss(t){let n,i=us[t];if(i)return i;for(n=t-1;!us[n];)n--;for(i={line:(i=us[n]).line,column:i.column};n<t;)10===e.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return us[t]=i,i}function Cs(e,t){const n=Ss(e),i=Ss(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:i.line,column:i.column}}}function Ts(e){cs<ds||(cs>ds&&(ds=cs,ps=[]),ps.push(e))}function ks(e,t,n){return new i(i.buildMessage(e,t),e,t,n)}function Rs(){let e,t,i,r,s,a,c,l,u;if(e=cs,(t=ko())===n&&(t=null),t!==n)if((i=go())===n&&(i=null),i!==n){for(r=[],s=cs,a=cs,(c=yo())!==n&&(l=Es())!==n&&(u=ko())!==n?a=c=[c,l,u]:(cs=a,a=n),a===n&&(a=null),a!==n&&(c=yo())!==n&&(l=xs())!==n?s=a=[a,c,l]:(cs=s,s=n);s!==n;)r.push(s),s=cs,a=cs,(c=yo())!==n&&(l=Es())!==n&&(u=ko())!==n?a=c=[c,l,u]:(cs=a,a=n),a===n&&(a=null),a!==n&&(c=yo())!==n&&(l=xs())!==n?s=a=[a,c,l]:(cs=s,s=n);r!==n?(ls=e,e=t=o(r)):(cs=e,e=n)}else cs=e,e=n;else cs=e,e=n;return e}function xs(){let t;return(t=function(){let t,i,r,s,o,a,c,l,u,h,d;if(t=cs,e.substr(cs,6)===yn?(i=yn,cs+=6):(i=n,0===fs&&Ts(vn)),i!==n)if(r=cs,(s=To())!==n&&(o=wo())!==n?r=s=[s,o]:(cs=r,r=n),r===n&&(r=null),r!==n)if(s=cs,(o=To())!==n&&(a=ro())!==n?s=o=[o,a]:(cs=s,s=n),s===n&&(s=null),s!==n)if((o=ko())!==n){if(a=cs,(c=go())!==n){for(l=[],u=cs,(h=yo())!==n&&(d=Ks())!==n?u=h=[h,d]:(cs=u,u=n);u!==n;)l.push(u),u=cs,(h=yo())!==n&&(d=Ks())!==n?u=h=[h,d]:(cs=u,u=n);l!==n?a=c=[c,l]:(cs=a,a=n)}else cs=a,a=n;a===n&&(a=null),a!==n?(ls=t,i=bn(r,s,a),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p,f;if(t=cs,e.substr(cs,8)===ye?(i=ye,cs+=8):(i=n,0===fs&&Ts(ve)),i!==n)if((r=To())!==n)if((s=wo())!==n)if(o=cs,(a=To())!==n&&(c=ro())!==n?o=a=[a,c]:(cs=o,o=n),o===n&&(o=null),o!==n)if(a=cs,(c=To())!==n?(e.substr(cs,2)===E?(l=E,cs+=2):(l=n,0===fs&&Ts(O)),l!==n&&(u=To())!==n&&(h=_o())!==n?a=c=[c,l,u,h]:(cs=a,a=n)):(cs=a,a=n),a===n&&(a=null),a!==n)if((c=ko())!==n){if(l=cs,(u=go())!==n){for(h=[],d=cs,(p=yo())!==n&&(f=Ps())!==n?d=p=[p,f]:(cs=d,d=n);d!==n;)h.push(d),d=cs,(p=yo())!==n&&(f=Ps())!==n?d=p=[p,f]:(cs=d,d=n);h!==n?l=u=[u,h]:(cs=l,l=n)}else cs=l,l=n;l===n&&(l=null),l!==n?((u=ko())===n&&(u=null),u!==n?(ls=t,i=be(s,o,a,l),t=i):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=function(){let t,i,r,s,o;return t=cs,e.substr(cs,6)===A?(i=A,cs+=6):(i=n,0===fs&&Ts(q)),i!==n&&(r=To())!==n&&(s=_o())!==n&&(o=ko())!==n?(ls=t,i=F(s),t=i):(cs=t,t=n),t}())===n&&(t=function(){let e,t,i,r,s,o,a,c,l;if(e=cs,(t=uo())!==n)if((i=ko())!==n){if(r=cs,(s=go())!==n){for(o=[],a=cs,(c=yo())!==n&&(l=ho())!==n?a=c=[c,l]:(cs=a,a=n);a!==n;)o.push(a),a=cs,(c=yo())!==n&&(l=ho())!==n?a=c=[c,l]:(cs=a,a=n);o!==n?r=s=[s,o]:(cs=r,r=n)}else cs=r,r=n;r===n&&(r=null),r!==n?(ls=e,t=Bi(t,r),e=t):(cs=e,e=n)}else cs=e,e=n;else cs=e,e=n;return e}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p,f;if(t=cs,e.substr(cs,5)===Fi?(i=Fi,cs+=5):(i=n,0===fs&&Ts(Hi)),i!==n)if((r=To())!==n)if((s=uo())!==n)if((o=To())!==n)if((a=function(){let t,i,r,s;return t=cs,e.substr(cs,2)===_n?(i=_n,cs+=2):(i=n,0===fs&&Ts(wn)),i!==n&&(r=To())!==n&&(s=wo())!==n?(ls=t,i=kn(s),t=i):(cs=t,t=n),t}())!==n)if((c=ko())!==n){if(l=cs,(u=go())!==n){for(h=[],d=cs,(p=yo())!==n&&(f=ho())!==n?d=p=[p,f]:(cs=d,d=n);d!==n;)h.push(d),d=cs,(p=yo())!==n&&(f=ho())!==n?d=p=[p,f]:(cs=d,d=n);h!==n?l=u=[u,h]:(cs=l,l=n)}else cs=l,l=n;l===n&&(l=null),l!==n?(ls=t,i=Li(s,a,l),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=function(){let t,i,r,s,o,a,u,h,d,p,f,m,g,y,v,b,_,I,D,A,q;if(t=cs,e.substr(cs,5)===w?(i=w,cs+=5):(i=n,0===fs&&Ts(S)),i!==n)if((r=To())!==n)if((s=wo())!==n)if((o=To())!==n)if(e.substr(cs,2)===C?(a=C,cs+=2):(a=n,0===fs&&Ts(T)),a!==n)if((u=To())!==n)if((h=function(){let e;return(e=co())===n&&(e=As())===n&&(e=qs())===n&&(e=Ls()),e}())!==n)if(d=cs,(p=To())!==n&&(f=_o())!==n?d=p=[p,f]:(cs=d,d=n),d===n&&(d=null),d!==n)if(p=cs,e.substr(cs,2)===k?(f=k,cs+=2):(f=n,0===fs&&Ts(R)),f!==n&&(m=_o())!==n?p=f=[f,m]:(cs=p,p=n),p===n&&(p=null),p!==n)if(f=cs,(m=To())!==n&&(g=function(){let t,i,r,s;if(fs++,t=cs,64===e.charCodeAt(cs)?(i=c,cs++):(i=n,0===fs&&Ts(l)),i!==n){if(r=[],mr.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(gr)),s!==n)for(;s!==n;)r.push(s),mr.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(gr));else r=n;r!==n?(ls=t,i=yr(r),t=i):(cs=t,t=n)}else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(fr)),t}())!==n?f=m=[m,g]:(cs=f,f=n),f===n&&(f=null),f!==n)if(m=cs,(g=To())!==n&&(y=no())!==n?m=g=[g,y]:(cs=m,m=n),m===n&&(m=null),m!==n)if((g=To())!==n)if((y=function(){let t;return(t=function(){let t,i,r,s;return t=cs,e.substr(cs,2)===E?(i=E,cs+=2):(i=n,0===fs&&Ts(O)),i!==n&&(r=To())!==n&&(s=_o())!==n?(ls=t,i=j(s),t=i):(cs=t,t=n),t}())===n&&(t=function(){let t,i,r,s;return t=cs,e.substr(cs,2)===E?(i=E,cs+=2):(i=n,0===fs&&Ts(O)),i!==n&&(r=To())!==n&&(s=wo())!==n?(ls=t,i=M(s),t=i):(cs=t,t=n),t}())===n&&(t=function(){let t,i,r,s;return t=cs,e.substr(cs,2)===$?(i=$,cs+=2):(i=n,0===fs&&Ts(P)),i!==n&&(r=To())!==n&&(s=_o())!==n?(ls=t,i=N(s),t=i):(cs=t,t=n),t}()),t}())!==n)if((v=ko())!==n){if(b=cs,(_=go())!==n){if(I=[],D=cs,(A=yo())!==n&&(q=js())!==n?D=A=[A,q]:(cs=D,D=n),D!==n)for(;D!==n;)I.push(D),D=cs,(A=yo())!==n&&(q=js())!==n?D=A=[A,q]:(cs=D,D=n);else I=n;I!==n?b=_=[_,I]:(cs=b,b=n)}else cs=b,b=n;b===n&&(b=null),b!==n?(ls=t,i=x(s,h,d,p,f,m,y,b),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p;if(fs++,t=cs,e.substr(cs,9)===L?(i=L,cs+=9):(i=n,0===fs&&Ts(B)),i!==n)if((r=To())!==n)if((s=wo())!==n)if(o=cs,(a=To())===n&&(a=null),a!==n?(60===e.charCodeAt(cs)?(c=z,cs++):(c=n,0===fs&&Ts(W)),c!==n?((l=To())===n&&(l=null),l!==n&&(u=function(){let t,i,r,s,o,a,c;if(t=cs,(i=Fs())!==n){for(r=[],s=cs,44===e.charCodeAt(cs)?(o=kt,cs++):(o=n,0===fs&&Ts(Rt)),o!==n&&(a=To())!==n&&(c=Fs())!==n?s=o=[o,a,c]:(cs=s,s=n);s!==n;)r.push(s),s=cs,44===e.charCodeAt(cs)?(o=kt,cs++):(o=n,0===fs&&Ts(Rt)),o!==n&&(a=To())!==n&&(c=Fs())!==n?s=o=[o,a,c]:(cs=s,s=n);r!==n?(ls=t,i=$t(i,r),t=i):(cs=t,t=n)}else cs=t,t=n;return t}())!==n?((h=To())===n&&(h=null),h!==n?(62===e.charCodeAt(cs)?(d=U,cs++):(d=n,0===fs&&Ts(V)),d!==n?o=a=[a,c,l,u,h,d]:(cs=o,o=n)):(cs=o,o=n)):(cs=o,o=n)):(cs=o,o=n)):(cs=o,o=n),o===n&&(o=null),o!==n)if((a=ko())!==n){if(c=cs,(l=go())!==n){for(u=[],h=cs,(d=yo())!==n&&(p=Ms())!==n?h=d=[d,p]:(cs=h,h=n);h!==n;)u.push(h),h=cs,(d=yo())!==n&&(p=Ms())!==n?h=d=[d,p]:(cs=h,h=n);u!==n?c=l=[l,u]:(cs=c,c=n)}else cs=c,c=n;c===n&&(c=null),c!==n?((l=ko())===n&&(l=null),l!==n?(ls=t,i=K(s,o,c),t=i):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(H)),t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u;if(t=cs,e.substr(cs,4)===oe?(i=oe,cs+=4):(i=n,0===fs&&Ts(ae)),i!==n)if((r=ko())!==n){if(s=cs,(o=go())!==n){for(a=[],c=cs,(l=yo())!==n&&(u=$s())!==n?c=l=[l,u]:(cs=c,c=n);c!==n;)a.push(c),c=cs,(l=yo())!==n&&(u=$s())!==n?c=l=[l,u]:(cs=c,c=n);a!==n?s=o=[o,a]:(cs=s,s=n)}else cs=s,s=n;s===n&&(s=null),s!==n?((o=ko())===n&&(o=null),o!==n?(ls=t,i=ce(s),t=i):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,v;return t=cs,e.substr(cs,8)===h?(i=h,cs+=8):(i=n,0===fs&&Ts(d)),i!==n&&(r=To())!==n&&(s=wo())!==n&&(o=ko())!==n&&(a=go())!==n&&(c=yo())!==n&&(l=function(){let t,i,r;return t=cs,e.substr(cs,5)===f?(i=f,cs+=5):(i=n,0===fs&&Ts(m)),i!==n&&(r=Ro())!==n?(ls=t,i=g(),t=i):(cs=t,t=n),t}())!==n&&(u=function(){let e,t,i,r,s;if(e=cs,t=[],i=cs,(r=vo())!==n&&(s=Os())!==n?i=r=[r,s]:(cs=i,i=n),i!==n)for(;i!==n;)t.push(i),i=cs,(r=vo())!==n&&(s=Os())!==n?i=r=[r,s]:(cs=i,i=n);else t=n;return t!==n&&(ls=e,t=y(t)),e=t}())!==n?((v=ko())===n&&(v=null),v!==n?(ls=t,i=p(s,u),t=i):(cs=t,t=n)):(cs=t,t=n),t}()),t}function Es(){let t,i,r;return fs++,t=cs,64===e.charCodeAt(cs)?(i=c,cs++):(i=n,0===fs&&Ts(l)),i!==n&&(r=So())!==n?(ls=t,t=i=u(r)):(cs=t,t=n),fs--,t===n&&(i=n,0===fs&&Ts(a)),t}function Os(){let t,i,r;for(t=cs,i=[],v.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(b));r!==n;)i.push(r),v.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(b));return i!==n&&(r=Ro())!==n?(ls=t,t=i=_()):(cs=t,t=n),t}function js(){let t,i,r,s,o;return t=cs,e.substr(cs,11)===I?(i=I,cs+=11):(i=n,0===fs&&Ts(D)),i!==n&&(r=To())!==n&&(s=bo())!==n&&(o=ko())!==n?t=i=[i,r,s,o]:(cs=t,t=n),t}function Ms(){let t;return(t=function(){let t,i,r,s,o,a,c;return t=cs,i=cs,e.substr(cs,4)===Q?(r=Q,cs+=4):(r=n,0===fs&&Ts(Y)),r!==n&&(s=To())!==n?i=r=[r,s]:(cs=i,i=n),i===n&&(i=null),i!==n?(e.substr(cs,7)===X?(r=X,cs+=7):(r=n,0===fs&&Ts(ee)),r===n&&(e.substr(cs,7)===te?(r=te,cs+=7):(r=n,0===fs&&Ts(ne))),r!==n?(s=cs,(o=To())!==n?(e.substr(cs,6)===ie?(a=ie,cs+=6):(a=n,0===fs&&Ts(re)),a!==n?s=o=[o,a]:(cs=s,s=n)):(cs=s,s=n),s===n&&(s=null),s!==n?(o=cs,(a=To())!==n&&(c=So())!==n?o=a=[a,c]:(cs=o,o=n),o===n&&(o=null),o!==n&&(a=ko())!==n?(ls=t,i=se(i,r,s,o),t=i):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),t}())===n&&(t=function(){let t,i,r,s,o;return t=cs,i=cs,(r=Is())!==n&&(s=To())!==n?i=r=[r,s]:(cs=i,i=n),i===n&&(i=null),i!==n?(r=cs,(s=Ds())!==n&&(o=To())!==n?r=s=[s,o]:(cs=r,r=n),r===n&&(r=null),r!==n?((s=So())===n&&(42===e.charCodeAt(cs)?(s=J,cs++):(s=n,0===fs&&Ts(G))),s!==n&&(o=ko())!==n?(ls=t,i=Z(i,r,s),t=i):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),t}()),t}function $s(){let t;return(t=function(){let t,i,r,s,o,a,c;return t=cs,e.substr(cs,10)===fe?(i=fe,cs+=10):(i=n,0===fs&&Ts(me)),i!==n?((r=To())===n&&(r=null),r!==n?(58===e.charCodeAt(cs)?(s=he,cs++):(s=n,0===fs&&Ts(de)),s!==n?((o=To())===n&&(o=null),o!==n&&(a=_o())!==n&&(c=ko())!==n?(ls=t,i=ge(a),t=i):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),t}())===n&&(t=function(){let t,i,r,s,o,a,c;return t=cs,e.substr(cs,4)===le?(i=le,cs+=4):(i=n,0===fs&&Ts(ue)),i!==n?((r=To())===n&&(r=null),r!==n?(58===e.charCodeAt(cs)?(s=he,cs++):(s=n,0===fs&&Ts(de)),s!==n?((o=To())===n&&(o=null),o!==n&&(a=_o())!==n&&(c=ko())!==n?(ls=t,i=pe(a),t=i):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),t}()),t}function Ps(){let t,i;return fs++,(t=function(){let t,i,r,s,o;return t=cs,e.substr(cs,8)===Pt?(i=Pt,cs+=8):(i=n,0===fs&&Ts(Nt)),i!==n&&(r=To())!==n&&(s=function(){let t;return e.substr(cs,9)===Dt?(t=Dt,cs+=9):(t=n,0===fs&&Ts(At)),t===n&&(e.substr(cs,3)===qt?(t=qt,cs+=3):(t=n,0===fs&&Ts(Ft)),t===n&&(e.substr(cs,2)===Ht?(t=Ht,cs+=2):(t=n,0===fs&&Ts(Lt)),t===n&&(e.substr(cs,5)===Bt?(t=Bt,cs+=5):(t=n,0===fs&&Ts(zt)),t===n&&(e.substr(cs,14)===Wt?(t=Wt,cs+=14):(t=n,0===fs&&Ts(Ut)),t===n&&(e.substr(cs,8)===Vt?(t=Vt,cs+=8):(t=n,0===fs&&Ts(Kt)),t===n&&(e.substr(cs,7)===Jt?(t=Jt,cs+=7):(t=n,0===fs&&Ts(Gt)),t===n&&(e.substr(cs,10)===Zt?(t=Zt,cs+=10):(t=n,0===fs&&Ts(Qt))))))))),t}())!==n&&(o=ko())!==n?(ls=t,i=It(s),t=i):(cs=t,t=n),t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p,f,m;if(t=cs,i=cs,e.substr(cs,4)===Q?(r=Q,cs+=4):(r=n,0===fs&&Ts(Y)),r!==n&&(s=To())!==n?i=r=[r,s]:(cs=i,i=n),i===n&&(i=null),i!==n)if(e.substr(cs,7)===X?(r=X,cs+=7):(r=n,0===fs&&Ts(ee)),r!==n)if((s=To())!==n)if(o=cs,e.substr(cs,6)===ie?(a=ie,cs+=6):(a=n,0===fs&&Ts(re)),a!==n&&(c=To())!==n?o=a=[a,c]:(cs=o,o=n),o===n&&(o=null),o!==n)if((a=So())!==n)if(c=cs,(l=To())!==n&&(u=no())!==n?c=l=[l,u]:(cs=c,c=n),c===n&&(c=null),c!==n)if((l=ko())!==n){if(u=cs,(h=go())!==n){for(d=[],p=cs,(f=yo())!==n&&(m=Bs())!==n?p=f=[f,m]:(cs=p,p=n);p!==n;)d.push(p),p=cs,(f=yo())!==n&&(m=Bs())!==n?p=f=[f,m]:(cs=p,p=n);d!==n?u=h=[h,d]:(cs=u,u=n)}else cs=u,u=n;u===n&&(u=null),u!==n?(ls=t,i=Yt(i,o,a,c,u),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=Us())===n&&(t=function t(){let i,r,s,o,a,c,l,u,h;if(i=cs,(r=function(){let t,i,r,s,o,a,c;return t=cs,(i=Is())!==n?(63===e.charCodeAt(cs)?(r=Le,cs++):(r=n,0===fs&&Ts(Be)),r===n&&(r=null),r!==n&&(s=To())!==n&&(o=Ds())!==n&&(a=To())!==n&&(c=function(){let e,t,i,r,s;return e=cs,(t=So())!==n?(i=cs,(r=To())!==n&&(s=no())!==n?i=r=[r,s]:(cs=i,i=n),i===n&&(i=null),i!==n?(ls=e,t=Ci(t,i),e=t):(cs=e,e=n)):(cs=e,e=n),e===n&&(e=cs,(t=To())!==n&&(i=So())!==n?(ls=e,t=Ti(i),e=t):(cs=e,e=n),e===n&&(e=cs,(t=To())!==n&&(i=no())!==n?(ls=e,t=ki(i),e=t):(cs=e,e=n))),e}())!==n?(ls=t,i=ze(i,r,o,c),t=i):(cs=t,t=n)):(cs=t,t=n),t}())!==n)if((s=ko())!==n){if(o=cs,(a=go())!==n){for(c=[],l=cs,(u=yo())!==n&&(h=t())!==n?l=u=[u,h]:(cs=l,l=n);l!==n;)c.push(l),l=cs,(u=yo())!==n&&(h=t())!==n?l=u=[u,h]:(cs=l,l=n);c!==n?o=a=[a,c]:(cs=o,o=n)}else cs=o,o=n;o===n&&(o=null),o!==n?(ls=i,r=He(r,o),i=r):(cs=i,i=n)}else cs=i,i=n;else cs=i,i=n;return i}())===n&&(t=function(){let t;return(t=function(){let t,i,r,s,o,a,c,l,u;return t=cs,e.substr(cs,5)===we?(i=we,cs+=5):(i=n,0===fs&&Ts(Se)),i!==n&&(r=To())!==n&&(s=So())!==n&&(o=To())!==n?(e.substr(cs,2)===Ce?(a=Ce,cs+=2):(a=n,0===fs&&Ts(Te)),a!==n&&(c=To())!==n&&(l=So())!==n&&(u=ko())!==n?(ls=t,i=ke(s,l),t=i):(cs=t,t=n)):(cs=t,t=n),t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p,f,m;if(t=cs,e.substr(cs,5)===we?(i=we,cs+=5):(i=n,0===fs&&Ts(Se)),i!==n)if((r=To())!==n)if((s=So())!==n)if((o=To())!==n)if(e.substr(cs,12)===Re?(a=Re,cs+=12):(a=n,0===fs&&Ts(xe)),a!==n)if((c=To())!==n)if((l=So())!==n){for(u=[],h=cs,(d=To())!==n?(e.substr(cs,3)===Ee?(p=Ee,cs+=3):(p=n,0===fs&&Ts(Oe)),p!==n&&(f=To())!==n&&(m=So())!==n?h=d=[d,p,f,m]:(cs=h,h=n)):(cs=h,h=n);h!==n;)u.push(h),h=cs,(d=To())!==n?(e.substr(cs,3)===Ee?(p=Ee,cs+=3):(p=n,0===fs&&Ts(Oe)),p!==n&&(f=To())!==n&&(m=So())!==n?h=d=[d,p,f,m]:(cs=h,h=n)):(cs=h,h=n);u!==n&&(h=ko())!==n?(ls=t,i=je(s,l,u),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}()),t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p;if(t=cs,e.substr(cs,5)===Me?(i=Me,cs+=5):(i=n,0===fs&&Ts($e)),i!==n)if((r=To())!==n)if((s=So())!==n)if((o=To())!==n)if((a=Ns())!==n){for(c=[],l=cs,(u=To())!==n?(e.substr(cs,2)===Pe?(h=Pe,cs+=2):(h=n,0===fs&&Ts(Ne)),h!==n&&(d=To())!==n&&(p=Ns())!==n?l=u=[u,h,d,p]:(cs=l,l=n)):(cs=l,l=n);l!==n;)c.push(l),l=cs,(u=To())!==n?(e.substr(cs,2)===Pe?(h=Pe,cs+=2):(h=n,0===fs&&Ts(Ne)),h!==n&&(d=To())!==n&&(p=Ns())!==n?l=u=[u,h,d,p]:(cs=l,l=n)):(cs=l,l=n);c!==n&&(l=ko())!==n?(ls=t,i=Ie(s,a,c),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}()),fs--,t===n&&(i=n,0===fs&&Ts(_e)),t}function Ns(){let t;return(t=function(){let t,i,r,s;return t=cs,e.substr(cs,14)===Ae?(i=Ae,cs+=14):(i=n,0===fs&&Ts(qe)),i!==n&&(r=To())!==n&&(s=So())!==n?(ls=t,i=Fe(s),t=i):(cs=t,t=n),t}())===n&&(t=function(){let t,i,r,s;return t=cs,e.substr(cs,2)===Ce?(i=Ce,cs+=2):(i=n,0===fs&&Ts(Te)),i!==n&&(r=To())!==n&&(s=So())!==n?(ls=t,i=De(s),t=i):(cs=t,t=n),t}()),t}function Is(){let t,i;return fs++,e.substr(cs,5)===Ue?(t=Ue,cs+=5):(t=n,0===fs&&Ts(Ve)),t===n&&(e.substr(cs,2)===E?(t=E,cs+=2):(t=n,0===fs&&Ts(O)),t===n&&(e.substr(cs,3)===Ke?(t=Ke,cs+=3):(t=n,0===fs&&Ts(Je)),t===n&&(e.substr(cs,4)===Ge?(t=Ge,cs+=4):(t=n,0===fs&&Ts(Ze)),t===n&&(e.substr(cs,8)===Qe?(t=Qe,cs+=8):(t=n,0===fs&&Ts(Ye)),t===n&&(t=cs,e.substr(cs,8)===Xe?(i=Xe,cs+=8):(i=n,0===fs&&Ts(et)),i!==n&&(ls=t,i=tt()),t=i))))),fs--,t===n&&(i=n,0===fs&&Ts(We)),t}function Ds(){let t;return(t=Fs())===n&&(t=As())===n&&(t=qs())===n&&(t=function(){let t,i,r,s;return t=cs,e.substr(cs,10)===ut?(i=ut,cs+=10):(i=n,0===fs&&Ts(ht)),i!==n&&(r=Ds())!==n?(62===e.charCodeAt(cs)?(s=U,cs++):(s=n,0===fs&&Ts(V)),s!==n?(ls=t,i=dt(r),t=i):(cs=t,t=n)):(cs=t,t=n),t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p,f;if(t=cs,e.substr(cs,4)===bt?(i=bt,cs+=4):(i=n,0===fs&&Ts(_t)),i!==n)if(r=cs,fs++,wt.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(St)),fs--,s!==n?(cs=r,r=void 0):r=n,r!==n){if(s=cs,(o=To())===n&&(o=null),o!==n)if(123===e.charCodeAt(cs)?(a=Ct,cs++):(a=n,0===fs&&Ts(Tt)),a!==n){if(c=cs,(l=Hs())!==n){for(u=[],h=cs,44===e.charCodeAt(cs)?(d=kt,cs++):(d=n,0===fs&&Ts(Rt)),d!==n&&(p=To())!==n&&(f=Hs())!==n?h=d=[d,p,f]:(cs=h,h=n);h!==n;)u.push(h),h=cs,44===e.charCodeAt(cs)?(d=kt,cs++):(d=n,0===fs&&Ts(Rt)),d!==n&&(p=To())!==n&&(f=Hs())!==n?h=d=[d,p,f]:(cs=h,h=n);u!==n?c=l=[l,u]:(cs=c,c=n)}else cs=c,c=n;c===n&&(c=null),c!==n?(125===e.charCodeAt(cs)?(l=xt,cs++):(l=n,0===fs&&Ts(Et)),l!==n?s=o=[o,a,c,l]:(cs=s,s=n)):(cs=s,s=n)}else cs=s,s=n;else cs=s,s=n;s===n&&(s=null),s!==n?(ls=t,i=Ot(s),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=co())===n&&(t=Ls()),t}function As(){let t,i,r,s;return t=cs,91===e.charCodeAt(cs)?(i=nt,cs++):(i=n,0===fs&&Ts(it)),i!==n&&(r=Ds())!==n?(93===e.charCodeAt(cs)?(s=rt,cs++):(s=n,0===fs&&Ts(st)),s!==n?(ls=t,t=i=ot(r)):(cs=t,t=n)):(cs=t,t=n),t}function qs(){let t,i,r,s;return t=cs,e.substr(cs,14)===at?(i=at,cs+=14):(i=n,0===fs&&Ts(ct)),i!==n&&(r=Ds())!==n?(62===e.charCodeAt(cs)?(s=U,cs++):(s=n,0===fs&&Ts(V)),s!==n?(ls=t,t=i=lt(r)):(cs=t,t=n)):(cs=t,t=n),t}function Fs(){let t,i,r,s,o,a,c,l;return fs++,t=cs,126===e.charCodeAt(cs)?(i=ft,cs++):(i=n,0===fs&&Ts(mt)),i!==n&&(r=So())!==n?(s=cs,(o=To())!==n?(e.substr(cs,4)===gt?(a=gt,cs+=4):(a=n,0===fs&&Ts(yt)),a!==n&&(c=To())!==n&&(l=Ds())!==n?s=o=[o,a,c,l]:(cs=s,s=n)):(cs=s,s=n),s===n&&(s=null),s!==n?(ls=t,t=i=vt(r,s)):(cs=t,t=n)):(cs=t,t=n),fs--,t===n&&(i=n,0===fs&&Ts(pt)),t}function Hs(){let t,i,r,s,o,a;return t=cs,(i=Co())!==n?((r=To())===n&&(r=null),r!==n?(58===e.charCodeAt(cs)?(s=he,cs++):(s=n,0===fs&&Ts(de)),s!==n?((o=To())===n&&(o=null),o!==n&&(a=So())!==n?(ls=t,t=i=jt(i,a)):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),t}function Ls(){let e,t;return e=cs,(t=wo())!==n&&(ls=e,t=Mt(t)),e=t}function Bs(){let t;return(t=zs())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p,f,m;if(t=cs,i=cs,e.substr(cs,4)===Q?(r=Q,cs+=4):(r=n,0===fs&&Ts(Y)),r!==n&&(s=To())!==n?i=r=[r,s]:(cs=i,i=n),i===n&&(i=null),i!==n)if(e.substr(cs,7)===te?(r=te,cs+=7):(r=n,0===fs&&Ts(ne)),r!==n)if((s=To())!==n)if(o=cs,e.substr(cs,6)===ie?(a=ie,cs+=6):(a=n,0===fs&&Ts(re)),a!==n&&(c=To())!==n?o=a=[a,c]:(cs=o,o=n),o===n&&(o=null),o!==n)if((a=So())!==n)if(c=cs,(l=To())!==n&&(u=no())!==n?c=l=[l,u]:(cs=c,c=n),c===n&&(c=null),c!==n)if((l=ko())!==n){if(u=cs,(h=go())!==n){for(d=[],p=cs,(f=yo())!==n&&(m=Ws())!==n?p=f=[f,m]:(cs=p,p=n);p!==n;)d.push(p),p=cs,(f=yo())!==n&&(m=Ws())!==n?p=f=[f,m]:(cs=p,p=n);d!==n?u=h=[h,d]:(cs=u,u=n)}else cs=u,u=n;u===n&&(u=null),u!==n?(ls=t,i=hn(i,o,a,c,u),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}()),t}function zs(){let t,i,r,s,o;return t=cs,e.substr(cs,10)===Xt?(i=Xt,cs+=10):(i=n,0===fs&&Ts(en)),i!==n&&(r=To())!==n?(e.substr(cs,10)===tn?(s=tn,cs+=10):(s=n,0===fs&&Ts(nn)),s===n&&(e.substr(cs,3)===rn?(s=rn,cs+=3):(s=n,0===fs&&Ts(sn)),s===n&&(e.substr(cs,6)===on?(s=on,cs+=6):(s=n,0===fs&&Ts(an)),s===n&&(e.substr(cs,5)===cn?(s=cn,cs+=5):(s=n,0===fs&&Ts(ln))))),s!==n&&(o=ko())!==n?(ls=t,t=i=un(s)):(cs=t,t=n)):(cs=t,t=n),t}function Ws(){let t;return(t=zs())===n&&(t=function(){let t,i,r,s,o;return t=cs,e.substr(cs,6)===dn?(i=dn,cs+=6):(i=n,0===fs&&Ts(pn)),i!==n&&(r=To())!==n&&(s=So())!==n&&(o=ko())!==n?(ls=t,i=fn(s),t=i):(cs=t,t=n),t}()),t}function Us(){let t,i,r,s,o,a,c,l,u,h,d;if(t=cs,e.substr(cs,11)===I?(i=I,cs+=11):(i=n,0===fs&&Ts(D)),i!==n)if((r=To())!==n)if((s=bo())!==n)if((o=ko())!==n){if(a=cs,(c=go())!==n){if(l=[],u=cs,(h=yo())!==n&&(d=Vs())!==n?u=h=[h,d]:(cs=u,u=n),u!==n)for(;u!==n;)l.push(u),u=cs,(h=yo())!==n&&(d=Vs())!==n?u=h=[h,d]:(cs=u,u=n);else l=n;l!==n?a=c=[c,l]:(cs=a,a=n)}else cs=a,a=n;a===n&&(a=null),a!==n?(ls=t,t=i=mn(s,a)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}function Vs(){let e,t,i,r,s;return e=cs,(t=So())!==n&&(i=To())!==n&&(r=bo())!==n&&(s=ko())!==n?(ls=e,e=t=gn(t,r)):(cs=e,e=n),e}function Ks(){let t;return(t=Gs())===n&&(t=function(){let e,t,i,r,s,o;return e=cs,(t=eo())!==n?(i=cs,(r=To())!==n&&(s=oo())!==n?i=r=[r,s]:(cs=i,i=n),i===n&&(i=null),i!==n?(r=cs,(s=To())!==n&&(o=Js())!==n?r=s=[s,o]:(cs=r,r=n),r===n&&(r=null),r!==n&&(s=ko())!==n?(ls=e,t=oi(t,i,r),e=t):(cs=e,e=n)):(cs=e,e=n)):(cs=e,e=n),e}())===n&&(t=to())===n&&(t=function(){let t,i,r,s,o,a,c,l,u;if(t=cs,e.substr(cs,7)===ai?(i=ai,cs+=7):(i=n,0===fs&&Ts(ci)),i!==n)if((r=ko())!==n){if(s=cs,(o=go())!==n){for(a=[],c=cs,(l=yo())!==n?((u=Gs())===n&&(u=to())===n&&(u=ao()),u!==n?c=l=[l,u]:(cs=c,c=n)):(cs=c,c=n);c!==n;)a.push(c),c=cs,(l=yo())!==n?((u=Gs())===n&&(u=to())===n&&(u=ao()),u!==n?c=l=[l,u]:(cs=c,c=n)):(cs=c,c=n);a!==n?s=o=[o,a]:(cs=s,s=n)}else cs=s,s=n;s===n&&(s=null),s!==n?(ls=t,i=li(s),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=ao())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h,d,p,f,m;if(t=cs,e.substr(cs,6)===$n?(i=$n,cs+=6):(i=n,0===fs&&Ts(Pn)),i!==n)if((r=To())!==n)if((s=bo())!==n)if((o=ko())!==n){if(a=cs,(c=go())!==n){if(l=cs,(u=yo())!==n)if(e.substr(cs,6)===Nn?(h=Nn,cs+=6):(h=n,0===fs&&Ts(In)),h!==n){if(d=[],p=cs,(f=To())!==n&&(m=bo())!==n?p=f=[f,m]:(cs=p,p=n),p!==n)for(;p!==n;)d.push(p),p=cs,(f=To())!==n&&(m=bo())!==n?p=f=[f,m]:(cs=p,p=n);else d=n;d!==n&&(p=ko())!==n?l=u=[u,h,d,p]:(cs=l,l=n)}else cs=l,l=n;else cs=l,l=n;l!==n?a=c=[c,l]:(cs=a,a=n)}else cs=a,a=n;a===n&&(a=null),a!==n?(ls=t,i=Dn(s,a),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=function(){let e,t,i,r,s,o,a;return e=cs,(t=Ys())!==n&&(i=To())!==n&&(r=Qs())!==n&&(s=To())!==n&&(o=Ys())!==n&&(a=ko())!==n?(ls=e,t=Mn(t,r,o),e=t):(cs=e,e=n),e}())===n&&(t=Us()),t}function Js(){let t,i,r,s,o,a;if(t=cs,e.substr(cs,2)===_n?(i=_n,cs+=2):(i=n,0===fs&&Ts(wn)),i!==n)if((r=To())!==n){if((s=So())===n){for(s=cs,o=[],Sn.test(e.charAt(cs))?(a=e.charAt(cs),cs++):(a=n,0===fs&&Ts(Cn));a!==n;)o.push(a),Sn.test(e.charAt(cs))?(a=e.charAt(cs),cs++):(a=n,0===fs&&Ts(Cn));o!==n&&(ls=s,o=Tn()),s=o}s!==n?(ls=t,t=i=kn(s)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;return t}function Gs(){let t,i,r,s,o,a,c,l,u,h;if(t=cs,(i=function(){let e,t;return e=cs,(t=wo())!==n&&(ls=e,t=Ri(t)),(e=t)===n&&(e=cs,(t=io())!==n&&(ls=e,t=xi(t)),e=t),e}())===n&&(42===e.charCodeAt(cs)?(i=J,cs++):(i=n,0===fs&&Ts(G))),i!==n)if(r=cs,(s=To())!==n&&(o=Js())!==n?r=s=[s,o]:(cs=r,r=n),r===n&&(r=null),r!==n)if((s=ko())!==n){if(o=cs,(a=go())!==n){for(c=[],l=cs,(u=yo())!==n&&(h=Zs())!==n?l=u=[u,h]:(cs=l,l=n);l!==n;)c.push(l),l=cs,(u=yo())!==n&&(h=Zs())!==n?l=u=[u,h]:(cs=l,l=n);c!==n?o=a=[a,c]:(cs=o,o=n)}else cs=o,o=n;o===n&&(o=null),o!==n?(ls=t,t=i=Rn(i,r,o)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}function Zs(){let t;return(t=function t(){let i,r,s,o,a,c,l,u,h,d,p,f;if(i=cs,(r=function(){let t;return e.substr(cs,7)===te?(t=te,cs+=7):(t=n,0===fs&&Ts(ne)),t===n&&(e.substr(cs,7)===X?(t=X,cs+=7):(t=n,0===fs&&Ts(ee))),t}())!==n)if((s=To())!==n)if((o=function(){let e,t,i;return e=cs,(t=So())!==n?((i=so())===n&&(i=null),i!==n?(ls=e,t=jn(t,i),e=t):(cs=e,e=n)):(cs=e,e=n),e}())!==n)if(a=cs,(c=To())!==n&&(l=Js())!==n?a=c=[c,l]:(cs=a,a=n),a===n&&(a=null),a!==n)if((c=ko())!==n){if(l=cs,(u=go())!==n){for(h=[],d=cs,(p=yo())!==n&&(f=t())!==n?d=p=[p,f]:(cs=d,d=n);d!==n;)h.push(d),d=cs,(p=yo())!==n&&(f=t())!==n?d=p=[p,f]:(cs=d,d=n);h!==n?l=u=[u,h]:(cs=l,l=n)}else cs=l,l=n;l===n&&(l=null),l!==n?(ls=i,r=On(r,o,a,l),i=r):(cs=i,i=n)}else cs=i,i=n;else cs=i,i=n;else cs=i,i=n;else cs=i,i=n;else cs=i,i=n;return i}())===n&&(t=function t(){let i,r,s,o,a,c,l,u,h,d,p,f;if(i=cs,(r=So())===n&&(42===e.charCodeAt(cs)?(r=J,cs++):(r=n,0===fs&&Ts(G))),r!==n)if((s=To())!==n)if((o=Qs())!==n)if(a=cs,(c=To())!==n&&(l=function(){let e,t,i,r;return e=cs,(t=wo())===n&&(t=So()),t===n&&(t=null),t!==n?((i=To())===n&&(i=null),i!==n?((r=no())===n&&(r=null),r!==n?(ls=e,t=En(t,r),e=t):(cs=e,e=n)):(cs=e,e=n)):(cs=e,e=n),e}())!==n?a=c=[c,l]:(cs=a,a=n),a===n&&(a=null),a!==n)if((c=ko())!==n){if(l=cs,(u=go())!==n){for(h=[],d=cs,(p=yo())!==n&&(f=t())!==n?d=p=[p,f]:(cs=d,d=n);d!==n;)h.push(d),d=cs,(p=yo())!==n&&(f=t())!==n?d=p=[p,f]:(cs=d,d=n);h!==n?l=u=[u,h]:(cs=l,l=n)}else cs=l,l=n;l===n&&(l=null),l!==n?(ls=i,r=xn(r,o,a,l),i=r):(cs=i,i=n)}else cs=i,i=n;else cs=i,i=n;else cs=i,i=n;else cs=i,i=n;else cs=i,i=n;return i}()),t}function Qs(){let t;return e.substr(cs,2)===An?(t=An,cs+=2):(t=n,0===fs&&Ts(qn)),t===n&&(e.substr(cs,2)===Fn?(t=Fn,cs+=2):(t=n,0===fs&&Ts(Hn)),t===n&&(61===e.charCodeAt(cs)?(t=Ln,cs++):(t=n,0===fs&&Ts(Bn)),t===n&&(e.substr(cs,7)===X?(t=X,cs+=7):(t=n,0===fs&&Ts(ee)),t===n&&(e.substr(cs,7)===te?(t=te,cs+=7):(t=n,0===fs&&Ts(ne)))))),t}function Ys(){let e;return(e=function(){let e,t,i;return e=cs,(t=ro())!==n?((i=Xs())===n&&(i=null),i!==n?(ls=e,t=zn(t,i),e=t):(cs=e,e=n)):(cs=e,e=n),e}())===n&&(e=function(){let e,t;return e=cs,(t=no())!==n&&(ls=e,t=Wn(t)),e=t}())===n&&(e=function(){let e,t,i;return e=cs,(t=wo())!==n?((i=Xs())===n&&(i=null),i!==n?(ls=e,t=Vn(t,i),e=t):(cs=e,e=n)):(cs=e,e=n),e}())===n&&(e=function(){let e,t,i;return e=cs,(t=So())!==n?((i=Xs())===n&&(i=null),i!==n?(ls=e,t=Un(t,i),e=t):(cs=e,e=n)):(cs=e,e=n),e}()),e}function Xs(){let t,i,r,s,o,a;return t=cs,46===e.charCodeAt(cs)?(i=Kn,cs++):(i=n,0===fs&&Ts(Jn)),i!==n?((r=So())===n&&(r=null),r!==n?(s=cs,(o=To())===n&&(o=null),o!==n&&(a=no())!==n?s=o=[o,a]:(cs=s,s=n),s===n&&(s=null),s!==n?(ls=t,t=i=Gn(r,s)):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),t}function eo(){let t;return 63===e.charCodeAt(cs)?(t=Le,cs++):(t=n,0===fs&&Ts(Be)),t===n&&(e.substr(cs,3)===Zn?(t=Zn,cs+=3):(t=n,0===fs&&Ts(Qn)),t===n&&(e.substr(cs,3)===Yn?(t=Yn,cs+=3):(t=n,0===fs&&Ts(Xn)),t===n&&(e.substr(cs,6)===ei?(t=ei,cs+=6):(t=n,0===fs&&Ts(ti)),t===n&&(e.substr(cs,4)===ni?(t=ni,cs+=4):(t=n,0===fs&&Ts(ii)),t===n&&(e.substr(cs,5)===ri?(t=ri,cs+=5):(t=n,0===fs&&Ts(si))))))),t}function to(){let t,i,r,s,o,a;return t=cs,e.substr(cs,6)===dn?(i=dn,cs+=6):(i=n,0===fs&&Ts(pn)),i!==n?(r=cs,(s=To())!==n&&(o=Js())!==n?r=s=[s,o]:(cs=r,r=n),r===n&&(r=null),r!==n?(s=cs,(o=To())!==n&&(a=oo())!==n?s=o=[o,a]:(cs=s,s=n),s===n&&(s=null),s!==n&&(o=ko())!==n?(ls=t,t=i=ui(r,s)):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),t}function no(){let t,i,r,s,o;return t=cs,(i=function(){let t,i,r,s,o;if(t=cs,35===e.charCodeAt(cs)?(i=hi,cs++):(i=n,0===fs&&Ts(di)),i!==n)if(pi.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(fi)),r!==n){for(s=[],mi.test(e.charAt(cs))?(o=e.charAt(cs),cs++):(o=n,0===fs&&Ts(gi));o!==n;)s.push(o),mi.test(e.charAt(cs))?(o=e.charAt(cs),cs++):(o=n,0===fs&&Ts(gi));s!==n?(ls=t,t=i=yi()):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;return t}())!==n?(r=cs,(s=To())!==n&&(o=no())!==n?r=s=[s,o]:(cs=r,r=n),r===n&&(r=null),r!==n?(ls=t,t=i=vi(i,r)):(cs=t,t=n)):(cs=t,t=n),t}function io(){let t,i,r,s,o;if(fs++,t=cs,38===e.charCodeAt(cs)?(i=_i,cs++):(i=n,0===fs&&Ts(wi)),i!==n)if(pi.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(fi)),r!==n){for(s=[],mi.test(e.charAt(cs))?(o=e.charAt(cs),cs++):(o=n,0===fs&&Ts(gi));o!==n;)s.push(o),mi.test(e.charAt(cs))?(o=e.charAt(cs),cs++):(o=n,0===fs&&Ts(gi));s!==n?(ls=t,t=i=yi()):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(bi)),t}function ro(){let e,t,i,r,s;return e=cs,(t=io())!==n?(i=cs,(r=To())!==n&&(s=ro())!==n?i=r=[r,s]:(cs=i,i=n),i===n&&(i=null),i!==n?(ls=e,e=t=vi(t,i)):(cs=e,e=n)):(cs=e,e=n),e}function so(){let e,t,i;return e=cs,(t=To())!==n&&(i=no())!==n?(ls=e,e=t=Si(i)):(cs=e,e=n),e}function oo(){let e,t,i;return e=cs,(t=_o())!==n?((i=so())===n&&(i=null),i!==n?(ls=e,e=t=Ei(t,i)):(cs=e,e=n)):(cs=e,e=n),e===n&&(e=cs,(t=wo())!==n?((i=so())===n&&(i=null),i!==n?(ls=e,e=t=Oi(t,i)):(cs=e,e=n)):(cs=e,e=n),e===n&&(e=cs,(t=no())!==n&&(ls=e,t=ji(t)),e=t)),e}function ao(){let t,i,r,s,o,a;return t=cs,e.substr(cs,4)===Mi?(i=Mi,cs+=4):(i=n,0===fs&&Ts($i)),i!==n?(r=cs,(s=To())!==n&&(o=oo())!==n?r=s=[s,o]:(cs=r,r=n),r===n&&(r=null),r!==n?(s=cs,(o=To())!==n&&(a=Js())!==n?s=o=[o,a]:(cs=s,s=n),s===n&&(s=null),s!==n&&(o=ko())!==n?(ls=t,t=i=Pi(r,s)):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),t}function co(){let t,i,r,s,o,a,c,l,u,h;if(t=cs,i=[],r=cs,(s=wo())===n&&(42===e.charCodeAt(cs)?(s=J,cs++):(s=n,0===fs&&Ts(G))),s!==n&&(o=To())!==n?r=s=[s,o]:(cs=r,r=n),r!==n)for(;r!==n;)i.push(r),r=cs,(s=wo())===n&&(42===e.charCodeAt(cs)?(s=J,cs++):(s=n,0===fs&&Ts(G))),s!==n&&(o=To())!==n?r=s=[s,o]:(cs=r,r=n);else i=n;if(i!==n)if(123===e.charCodeAt(cs)?(r=Ct,cs++):(r=n,0===fs&&Ts(Tt)),r!==n){if(s=cs,(o=lo())!==n){for(a=[],c=cs,44===e.charCodeAt(cs)?(l=kt,cs++):(l=n,0===fs&&Ts(Rt)),l!==n&&(u=To())!==n&&(h=lo())!==n?c=l=[l,u,h]:(cs=c,c=n);c!==n;)a.push(c),c=cs,44===e.charCodeAt(cs)?(l=kt,cs++):(l=n,0===fs&&Ts(Rt)),l!==n&&(u=To())!==n&&(h=lo())!==n?c=l=[l,u,h]:(cs=c,c=n);a!==n?s=o=[o,a]:(cs=s,s=n)}else cs=s,s=n;s===n&&(s=null),s!==n?(125===e.charCodeAt(cs)?(o=xt,cs++):(o=n,0===fs&&Ts(Et)),o!==n?(ls=t,t=i=Ni(i,s)):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;return t}function lo(){let e,t,i,r;return e=cs,t=cs,(i=po())!==n&&(r=To())!==n?t=i=[i,r]:(cs=t,t=n),t===n&&(t=null),t!==n&&(i=Co())!==n?(ls=e,e=t=Ii(t,i)):(cs=e,e=n),e}function uo(){let t,i,r,s,o,a;if(t=cs,e.substr(cs,6)===Di?(i=Di,cs+=6):(i=n,0===fs&&Ts(Ai)),i!==n){if(r=[],s=cs,(o=To())!==n?(42===e.charCodeAt(cs)?(a=J,cs++):(a=n,0===fs&&Ts(G)),a===n&&(a=wo()),a!==n?s=o=[o,a]:(cs=s,s=n)):(cs=s,s=n),s!==n)for(;s!==n;)r.push(s),s=cs,(o=To())!==n?(42===e.charCodeAt(cs)?(a=J,cs++):(a=n,0===fs&&Ts(G)),a===n&&(a=wo()),a!==n?s=o=[o,a]:(cs=s,s=n)):(cs=s,s=n);else r=n;r!==n?((s=function(){let t,i,r,s,o,a,c,l,u,h,d;if(t=cs,(i=To())!==n)if(e.substr(cs,7)===zi?(r=zi,cs+=7):(r=n,0===fs&&Ts(Wi)),r!==n)if((s=To())!==n)if((o=wo())!==n){for(a=[],c=cs,(l=To())===n&&(l=null),l!==n?(44===e.charCodeAt(cs)?(u=kt,cs++):(u=n,0===fs&&Ts(Rt)),u!==n&&(h=To())!==n&&(d=wo())!==n?c=l=[l,u,h,d]:(cs=c,c=n)):(cs=c,c=n);c!==n;)a.push(c),c=cs,(l=To())===n&&(l=null),l!==n?(44===e.charCodeAt(cs)?(u=kt,cs++):(u=n,0===fs&&Ts(Rt)),u!==n&&(h=To())!==n&&(d=wo())!==n?c=l=[l,u,h,d]:(cs=c,c=n)):(cs=c,c=n);a!==n?(ls=t,i=Ui(o,a),t=i):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}())===n&&(s=null),s!==n?(ls=t,t=i=qi(r,s)):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;return t}function ho(){let e;return(e=function(){let e,t,i,r,s;return e=cs,(t=po())!==n&&(i=To())!==n&&(r=Co())!==n&&(s=ko())!==n?(ls=e,t=Vi(t,r),e=t):(cs=e,e=n),e}())===n&&(e=Us()),e}function po(){let t;return(t=fo())===n&&(t=function(){let t,i,r,s,o,a;if(t=cs,91===e.charCodeAt(cs)?(i=nt,cs++):(i=n,0===fs&&Ts(it)),i!==n){for(r=[],s=To();s!==n;)r.push(s),s=To();if(r!==n)if((s=fo())!==n){for(o=[],a=To();a!==n;)o.push(a),a=To();o!==n?(93===e.charCodeAt(cs)?(a=rt,cs++):(a=n,0===fs&&Ts(st)),a!==n?(ls=t,i=Ki(s),t=i):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n}else cs=t,t=n;return t}())===n&&(t=mo())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h;if(t=cs,40===e.charCodeAt(cs)?(i=cr,cs++):(i=n,0===fs&&Ts(lr)),i!==n)if((r=To())===n&&(r=null),r!==n)if((s=mo())!==n){if(o=[],a=cs,(c=To())!==n?(e.substr(cs,2)===Pe?(l=Pe,cs+=2):(l=n,0===fs&&Ts(Ne)),l!==n&&(u=To())!==n&&(h=mo())!==n?a=c=[c,l,u,h]:(cs=a,a=n)):(cs=a,a=n),a!==n)for(;a!==n;)o.push(a),a=cs,(c=To())!==n?(e.substr(cs,2)===Pe?(l=Pe,cs+=2):(l=n,0===fs&&Ts(Ne)),l!==n&&(u=To())!==n&&(h=mo())!==n?a=c=[c,l,u,h]:(cs=a,a=n)):(cs=a,a=n);else o=n;o!==n?((a=To())===n&&(a=null),a!==n?(41===e.charCodeAt(cs)?(c=ur,cs++):(c=n,0===fs&&Ts(hr)),c!==n?(ls=t,i=dr(s,o),t=i):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}())===n&&(t=function(){let t,i,r,s,o,a,c,l,u,h;if(t=cs,40===e.charCodeAt(cs)?(i=cr,cs++):(i=n,0===fs&&Ts(lr)),i!==n)if((r=To())===n&&(r=null),r!==n)if((s=mo())!==n){for(o=[],a=cs,(c=To())===n&&(c=null),c!==n?(44===e.charCodeAt(cs)?(l=kt,cs++):(l=n,0===fs&&Ts(Rt)),l!==n?((u=To())===n&&(u=null),u!==n&&(h=mo())!==n?a=c=[c,l,u,h]:(cs=a,a=n)):(cs=a,a=n)):(cs=a,a=n);a!==n;)o.push(a),a=cs,(c=To())===n&&(c=null),c!==n?(44===e.charCodeAt(cs)?(l=kt,cs++):(l=n,0===fs&&Ts(Rt)),l!==n?((u=To())===n&&(u=null),u!==n&&(h=mo())!==n?a=c=[c,l,u,h]:(cs=a,a=n)):(cs=a,a=n)):(cs=a,a=n);o!==n?((a=To())===n&&(a=null),a!==n?(41===e.charCodeAt(cs)?(c=ur,cs++):(c=n,0===fs&&Ts(hr)),c!==n?(ls=t,i=pr(s,o),t=i):(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;else cs=t,t=n;return t}()),t}function fo(){let t,i,r,s,o,a;if(t=cs,e.substr(cs,10)===ut?(i=ut,cs+=10):(i=n,0===fs&&Ts(ht)),i!==n){for(r=[],s=To();s!==n;)r.push(s),s=To();if(r!==n)if((s=co())===n&&(s=Ls()),s!==n){for(o=[],a=To();a!==n;)o.push(a),a=To();o!==n?(62===e.charCodeAt(cs)?(a=U,cs++):(a=n,0===fs&&Ts(V)),a!==n?(ls=t,t=i=Ji(s)):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n}else cs=t,t=n;return t}function mo(){let t,i;return t=cs,e.substr(cs,4)===Gi?(i=Gi,cs+=4):(i=n,0===fs&&Ts(Zi)),i===n&&(e.substr(cs,3)===Qi?(i=Qi,cs+=3):(i=n,0===fs&&Ts(Yi)),i===n&&(e.substr(cs,6)===Xi?(i=Xi,cs+=6):(i=n,0===fs&&Ts(er)),i===n&&(e.substr(cs,7)===tr?(i=tr,cs+=7):(i=n,0===fs&&Ts(nr)),i===n&&(e.substr(cs,5)===ir?(i=ir,cs+=5):(i=n,0===fs&&Ts(rr)),i===n&&(e.substr(cs,6)===sr?(i=sr,cs+=6):(i=n,0===fs&&Ts(or))))))),i!==n&&(ls=t,i=ar(i)),t=i}function go(){let t,i,r,s;if(fs++,t=cs,fs++,i=cs,r=[],32===e.charCodeAt(cs)?(s=br,cs++):(s=n,0===fs&&Ts(_r)),s!==n)for(;s!==n;)r.push(s),32===e.charCodeAt(cs)?(s=br,cs++):(s=n,0===fs&&Ts(_r));else r=n;return r!==n?(ls=cs,(s=(s=wr(r))?void 0:n)!==n?i=r=[r,s]:(cs=i,i=n)):(cs=i,i=n),fs--,i!==n?(cs=t,t=void 0):t=n,fs--,t===n&&(i=n,0===fs&&Ts(vr)),t}function yo(){let t,i,r,s,o;for(fs++,t=cs,i=cs,fs++,r=cs,s=[],32===e.charCodeAt(cs)?(o=br,cs++):(o=n,0===fs&&Ts(_r));o!==n;)s.push(o),32===e.charCodeAt(cs)?(o=br,cs++):(o=n,0===fs&&Ts(_r));if(s!==n?(ls=cs,(o=(o=Cr(s))?void 0:n)!==n?r=s=[s,o]:(cs=r,r=n)):(cs=r,r=n),fs--,r!==n?(cs=i,i=void 0):i=n,i!==n){for(r=[],32===e.charCodeAt(cs)?(s=br,cs++):(s=n,0===fs&&Ts(_r));s!==n;)r.push(s),32===e.charCodeAt(cs)?(s=br,cs++):(s=n,0===fs&&Ts(_r));r!==n?t=i=[i,r]:(cs=t,t=n)}else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(Sr)),t}function vo(){let t,i,r,s,o;for(fs++,t=cs,i=cs,fs++,r=cs,s=[],32===e.charCodeAt(cs)?(o=br,cs++):(o=n,0===fs&&Ts(_r));o!==n;)s.push(o),32===e.charCodeAt(cs)?(o=br,cs++):(o=n,0===fs&&Ts(_r));if(s!==n?(ls=cs,(o=(o=kr(s))?void 0:n)!==n?r=s=[s,o]:(cs=r,r=n)):(cs=r,r=n),fs--,r!==n?(cs=i,i=void 0):i=n,i!==n){for(r=[],32===e.charCodeAt(cs)?(s=br,cs++):(s=n,0===fs&&Ts(_r));s!==n;)r.push(s),32===e.charCodeAt(cs)?(s=br,cs++):(s=n,0===fs&&Ts(_r));r!==n?(ls=t,t=i=_()):(cs=t,t=n)}else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(Tr)),t}function bo(){let t,i,r,s;if(fs++,t=cs,96===e.charCodeAt(cs)?(i=Mr,cs++):(i=n,0===fs&&Ts($r)),i!==n){if(r=[],Pr.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Nr)),s!==n)for(;s!==n;)r.push(s),Pr.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Nr));else r=n;r!==n?(96===e.charCodeAt(cs)?(s=Mr,cs++):(s=n,0===fs&&Ts($r)),s!==n?(ls=t,t=i=Ir(r)):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(jr)),t}function _o(){let t,i,r,s;if(fs++,t=cs,39===e.charCodeAt(cs)?(i=Ar,cs++):(i=n,0===fs&&Ts(qr)),i!==n){if(r=[],Fr.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Hr)),s!==n)for(;s!==n;)r.push(s),Fr.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Hr));else r=n;r!==n?(39===e.charCodeAt(cs)?(s=Ar,cs++):(s=n,0===fs&&Ts(qr)),s!==n?(ls=t,t=i=Lr(r)):(cs=t,t=n)):(cs=t,t=n)}else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(Dr)),t}function wo(){let t,i,r,s;if(fs++,t=cs,zr.test(e.charAt(cs))?(i=e.charAt(cs),cs++):(i=n,0===fs&&Ts(Wr)),i!==n){for(r=[],Ur.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Vr));s!==n;)r.push(s),Ur.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Vr));r!==n?(ls=t,t=i=_()):(cs=t,t=n)}else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(Br)),t}function So(){let t,i,r,s,o;if(fs++,t=cs,i=cs,fs++,r=function(){let t,i,r,s;return t=cs,(i=Qs())===n&&(i=Is())===n&&(i=eo())===n&&(e.substr(cs,8)===ye?(i=ye,cs+=8):(i=n,0===fs&&Ts(ve)),i===n&&(e.substr(cs,6)===yn?(i=yn,cs+=6):(i=n,0===fs&&Ts(vn)),i===n&&(e.substr(cs,6)===A?(i=A,cs+=6):(i=n,0===fs&&Ts(q)),i===n&&(e.substr(cs,9)===L?(i=L,cs+=9):(i=n,0===fs&&Ts(B)),i===n&&(e.substr(cs,6)===Di?(i=Di,cs+=6):(i=n,0===fs&&Ts(Ai)),i===n&&(e.substr(cs,7)===ai?(i=ai,cs+=7):(i=n,0===fs&&Ts(ci)),i===n&&(e.substr(cs,6)===dn?(i=dn,cs+=6):(i=n,0===fs&&Ts(pn))))))))),i!==n?(Rr.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(xr)),r===n&&(r=cs,fs++,e.length>cs?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Er)),fs--,s===n?r=void 0:(cs=r,r=n)),r!==n?(ls=t,t=i=Or(i)):(cs=t,t=n)):(cs=t,t=n),t}(),fs--,r===n?i=void 0:(cs=i,i=n),i!==n)if(Jr.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(Gr)),r!==n){for(s=[],Ur.test(e.charAt(cs))?(o=e.charAt(cs),cs++):(o=n,0===fs&&Ts(Vr));o!==n;)s.push(o),Ur.test(e.charAt(cs))?(o=e.charAt(cs),cs++):(o=n,0===fs&&Ts(Vr));s!==n?(ls=t,t=i=_()):(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(Kr)),t}function Co(){let t,i,r,s;if(fs++,t=cs,Jr.test(e.charAt(cs))?(i=e.charAt(cs),cs++):(i=n,0===fs&&Ts(Gr)),i!==n){for(r=[],Ur.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Vr));s!==n;)r.push(s),Ur.test(e.charAt(cs))?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Vr));r!==n?(ls=t,t=i=_()):(cs=t,t=n)}else cs=t,t=n;return fs--,t===n&&(i=n,0===fs&&Ts(Zr)),t}function To(){let t,i;if(fs++,t=[],32===e.charCodeAt(cs)?(i=br,cs++):(i=n,0===fs&&Ts(_r)),i!==n)for(;i!==n;)t.push(i),32===e.charCodeAt(cs)?(i=br,cs++):(i=n,0===fs&&Ts(_r));else t=n;return fs--,t===n&&(i=n,0===fs&&Ts(Qr)),t}function ko(){let t,i,r,s,o;for(fs++,t=cs,i=[],Xr.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(es));r!==n;)i.push(r),Xr.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(es));if(i!==n?(r=cs,fs++,e.length>cs?(s=e.charAt(cs),cs++):(s=n,0===fs&&Ts(Er)),fs--,s===n?r=void 0:(cs=r,r=n),r!==n?t=i=[i,r]:(cs=t,t=n)):(cs=t,t=n),t===n){for(t=cs,i=[],Xr.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(es));r!==n;)i.push(r),Xr.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(es));if(i!==n)if(e.substr(cs,2)===ts?(r=ts,cs+=2):(r=n,0===fs&&Ts(ns)),r!==n){for(s=[],v.test(e.charAt(cs))?(o=e.charAt(cs),cs++):(o=n,0===fs&&Ts(b));o!==n;)s.push(o),v.test(e.charAt(cs))?(o=e.charAt(cs),cs++):(o=n,0===fs&&Ts(b));s!==n&&(o=ko())!==n?t=i=[i,r,s,o]:(cs=t,t=n)}else cs=t,t=n;else cs=t,t=n;if(t===n){for(t=cs,i=[],Xr.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(es));r!==n;)i.push(r),Xr.test(e.charAt(cs))?(r=e.charAt(cs),cs++):(r=n,0===fs&&Ts(es));i!==n&&(r=Ro())!==n?((s=ko())===n&&(s=null),s!==n?t=i=[i,r,s]:(cs=t,t=n)):(cs=t,t=n)}}return fs--,t===n&&(i=n,0===fs&&Ts(Yr)),t}function Ro(){let t,i,r,s;return fs++,t=cs,13===e.charCodeAt(cs)?(i=rs,cs++):(i=n,0===fs&&Ts(ss)),i===n&&(i=null),i!==n?(10===e.charCodeAt(cs)?(r=os,cs++):(r=n,0===fs&&Ts(as)),r!==n?(13===e.charCodeAt(cs)?(s=rs,cs++):(s=n,0===fs&&Ts(ss)),s===n&&(s=null),s!==n?t=i=[i,r,s]:(cs=t,t=n)):(cs=t,t=n)):(cs=t,t=n),fs--,t===n&&(i=n,0===fs&&Ts(is)),t}let xo="",Eo="";const Oo=[],jo=()=>({kind:"handle-ref",id:null,name:null,tags:[],location:gs()});function Mo(e){return e[1].map(e=>e[1])}function $o(e,t,n){if(null!==e){const n=t(e);if(null!==n)return n}return null===n?null:n}if((hs=s())!==n&&cs===e.length)return hs;throw hs!==n&&cs<e.length&&Ts({type:"end"}),ks(ps,ds<e.length?e.charAt(ds):null,ds<e.length?Cs(ds,ds+1):Cs(ds,ds))};var s=n(0),o=n(29),a=n.n(o);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
async function c(e){const t=a.a.createHash("sha1");return t.update(e),Promise.resolve().then(()=>t.digest("hex"))}var l=n(6),u=n(23);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class h{constructor(){this.storageKey=null,this.name=null}apply(e){e.forEach(e=>{this[e.key]=e.value})}}var d=n(9),p=n(2);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class f{}class m extends f{constructor(e,t){super(),this.particle=e,this.connection=t}_clone(e){return new m(this.particle,this.connection)}_compareTo(e){let t;return 0!==(t=Object(p.d)(this.particle.name,e.particle.name))?t:0!==(t=Object(p.d)(this.connection,e.connection))?t:0}toString(e){return this.connection?`${this.particle.name}.${this.connection}`:`${this.particle.name}`}}class g extends f{constructor(e,t){super(),Object(s.a)(e),this.instance=e,this.connection=t}_clone(e){return new g(e.get(this.instance),this.connection)}_compareTo(e){let t;return 0!==(t=Object(p.b)(this.instance,e.instance))?t:0!==(t=Object(p.d)(this.connection,e.connection))?t:0}toString(e){return this.connection?`${e.get(this.instance)}.${this.connection}`:`${e.get(this.instance)}`}}class y extends f{constructor(e){super(),this.handle=e}_clone(e){return new y(this.handle)}_compareTo(e){let t;return 0!==(t=Object(p.d)(this.handle.localName,e.handle.localName))?t:0}toString(e){return`${this.handle.localName}`}}class v extends f{constructor(e){super(),this.tags=e}_clone(e){return new v(this.tags)}_compareTo(e){let t;return 0!==(t=Object(p.a)(this.tags,e.tags,p.d))?t:0}toString(e){return this.tags.map(e=>`#${e}`).join(" ")}}class b{constructor(e,t,n,i){Object(s.a)(n),Object(s.a)(i),this.from=e,this.to=t,this.direction=n,this.type=i,Object.freeze(this)}_copyInto(e,t){if("constraint"===this.type){if(!(this.from instanceof g||this.to instanceof g))return e.newConnectionConstraint(this.from._clone(),this.to._clone(),this.direction);Object(s.a)(!1)}return e.newObligation(this.from._clone(t),this.to._clone(t),this.direction)}_compareTo(e){let t;return 0!==(t=this.from._compareTo(e.from))?t:0!==(t=this.to._compareTo(e.to))?t:0!==(t=Object(p.d)(this.direction,e.direction))?t:0}toString(e,t){let n="";return t&&!0===t.showUnresolved&&"obligation"===this.type&&(n=" // unresolved obligation"),`${this.from.toString(e)} ${this.direction} ${this.to.toString(e)}${n}`}}var _=n(1),w=n(24),S=n(5);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class C{constructor(e){this._id=null,this._localName=void 0,this._tags=[],this._type=void 0,this._fate=null,this._originalFate=null,this._originalId=null,this._connections=[],this._mappedType=void 0,this._storageKey=void 0,this._pattern=void 0,this._immediateValue=void 0,Object(s.a)(e),this._recipe=e}_copyInto(e,t,n){let i=void 0;return null!==this._id&&["map","use","copy"].includes(this.fate)&&(i=e.findHandle(this._id)),null==i&&((i=e.newHandle())._id=this._id,i._tags=[...this._tags],i._type=this._type?this._type._cloneWithResolutions(n):void 0,i._fate=this._fate,i._originalFate=this._originalFate,i._originalId=this._originalId,i._mappedType=this._mappedType,i._storageKey=this._storageKey,i._immediateValue=this._immediateValue,i._connections=[],i._pattern=this._pattern),i}mergeInto(e){for(Object(s.a)(this.recipe===e.recipe,"Cannot merge handles from different recipes.");this.connections.length>0;){const[t]=this.connections;t.disconnectHandle(),t.connectToHandle(e)}e._immediateValue=this._immediateValue,e.tags=e.tags.concat(this.tags),e.recipe.removeHandle(this),e.fate=this._mergedFate([this.fate,e.fate])}_mergedFate(e){return Object(s.a)(e.length>0,"Cannot merge empty fates list"),Object(s.a)(!e.includes("map")&&!e.includes("copy"),"Merging map/copy not supported yet"),e.every(e=>"use"===e)?"use":"create"}_startNormalize(){this._localName=null,this._tags.sort();const e=this.type.resolvedType();e.canWriteSuperset&&"Slot"===e.canWriteSuperset.tag&&(this._fate="?"===this._fate?"`slot":this._fate),e.canReadSubset&&"Slot"===e.canReadSubset.tag&&(this._fate="?"===this._fate?"`slot":this._fate);const t=e&&e.isCollectionType()&&e.collectionType;t&&t.canWriteSuperset&&"Slot"===t.canWriteSuperset.tag&&(this._fate="?"===this._fate?"`slot":this._fate),t&&t.canReadSubset&&"Slot"===t.canReadSubset.tag&&(this._fate="?"===this._fate?"`slot":this._fate)}_finishNormalize(){for(const e of this._connections)Object(s.a)(Object.isFrozen(e),`Handle connection '${e.name}' is not frozen.`);this._connections.sort(p.b),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Object(p.d)(this._id,e._id))?t:0!==(t=Object(p.d)(this._localName,e._localName))?t:0!==(t=Object(p.a)(this._tags,e._tags,p.d))?t:0!==(t=Object(p.d)(this.fate,e.fate))?t:0!==(t=Object(p.d)(this._immediateValue&&this._immediateValue.toString()||"",e._immediateValue&&e._immediateValue.toString()||""))?t:0}get fate(){return this._fate||"?"}set fate(e){null==this._originalFate&&(this._originalFate=this._fate),this._fate=e}get originalFate(){return this._originalFate||"?"}get originalId(){return this._originalId}get recipe(){return this._recipe}get tags(){return this._tags}set tags(e){this._tags=e}get type(){return this._type}get id(){return this._id}set id(e){this._originalId||(this._originalId=this._id),this._id=e}mapToStorage(e){if(!e)throw new Error("Cannot map to undefined storage");this._id=e.id,this._originalId=e.originalId,this._type=void 0,this._mappedType=e.type,this._storageKey=e.storageKey}get localName(){return this._localName}set localName(e){this._localName=e}get connections(){return this._connections}get storageKey(){return this._storageKey}set storageKey(e){this._storageKey=e}get pattern(){return this._pattern}set pattern(e){this._pattern=e}get mappedType(){return this._mappedType}set mappedType(e){this._mappedType=e}get immediateValue(){return this._immediateValue}set immediateValue(e){this._immediateValue=e}static effectiveType(e,t){const n=new Map,i=t.filter(e=>null!=e.type).map(e=>({type:e.type._cloneWithResolutions(n),direction:e.direction}));return S.a.processTypeList(e?e._cloneWithResolutions(n):null,i)}static resolveEffectiveType(e,t){const n=t.filter(e=>null!=e.type).map(e=>({type:e.type,direction:e.direction}));return S.a.processTypeList(e,n)}_isValid(e){const t=new Set;for(const n of this._connections){if("map"===this.fate&&["out","inout"].includes(n.direction))return e&&e.errors&&e.errors.set(this,`Invalid fate '${this.fate}' for handle '${this}'; it is used for '${n.direction}' ${n.getQualifiedName()} connection`),!1;n.tags.forEach(e=>t.add(e))}this.mappedType||"`slot"!==this.fate||(this._mappedType=new _.i(new w.a(void 0,void 0)));const n=C.resolveEffectiveType(this._mappedType,this._connections);return n?(this._type=n,this._tags.forEach(e=>t.add(e)),this._tags=[...t],!0):(e&&e.errors&&e.errors.set(this,`Type validations failed for handle '${this}' with type ${this._mappedType} and fate ${this.fate}`),!1)}isResolved(e){Object(s.a)(Object.isFrozen(this));let t=!0;if(this.type){let n=!0;"create"!==this.fate&&"`slot"!==this.fate||(n=!1),(n&&!this.type.isResolved()||!this.type.canEnsureResolved())&&(e&&e.details.push("unresolved type"),t=!1)}else e&&e.details.push("missing type"),t=!1;switch(this.fate){case"?":e&&e.details.push("missing fate"),t=!1;break;case"copy":case"map":case"use":e&&null===this.id&&e.details.push("missing id"),t=t&&null!==this.id;break;case"`slot":case"create":break;default:throw e&&e.details.push(`invalid fate ${this.fate}`),new Error(`Unexpected fate: ${this.fate}`)}return t}toString(e,t){if(this._immediateValue)return;t=t||{};const n=[];if(n.push(this.fate),this.id&&n.push(`'${this.id}'`),n.push(...this.tags.map(e=>`#${e}`)),(e&&e.get(this)||this.localName)&&n.push(`as ${e&&e.get(this)||this.localName}`),this.type)if(n.push("//"),this.type.isResolved())n.push(this.type.resolvedType().toString({hideFields:null==t.hideFields||t.hideFields}));else if(n.push(this.type.toString()),t.showUnresolved&&this.type.canEnsureResolved()){const e=_.j.fromLiteral(this.type.toLiteral());e.maybeEnsureResolved(),n.push("//"),n.push(e.resolvedType().toString({hideFields:null==t.hideFields||t.hideFields}))}if(t.showUnresolved){const e={details:[]};this.isResolved(e)||n.push(` // unresolved handle: ${e.details.join(", ")}`)}return n.join(" ")}findConnectionByDirection(e){return this._connections.find(t=>t.direction===e)}}var T=n(18);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class k{constructor(e,t){this._tags=[],this.resolvedType=void 0,this._direction=void 0,this._handle=void 0,Object(s.a)(t),Object(s.a)(t.recipe),this._recipe=t.recipe,this._name=e,this._particle=t}_clone(e,t){if(t.has(this))return t.get(this);const n=new k(this._name,e);return n._tags=[...this._tags],n.resolvedType=this.resolvedType,n._direction=this._direction,null!=this._handle&&(n._handle=t.get(this._handle),Object(s.a)(void 0!==n._handle),n._handle.connections.push(n)),t.set(this,n),n}cloneTypeWithResolutions(e){this.resolvedType&&(this.resolvedType=this.resolvedType._cloneWithResolutions(e))}_normalize(){this._tags.sort(),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Object(p.b)(this._particle,e._particle))?t:0!==(t=Object(p.d)(this._name,e._name))?t:0!==(t=Object(p.a)(this._tags,e._tags,p.d))?t:0!==(t=Object(p.b)(this._handle,e._handle))?t:0!==(t=Object(p.d)(this._direction,e._direction))?t:0}get recipe(){return this._recipe}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get tags(){return this._tags}get type(){if(this.resolvedType)return this.resolvedType;const e=this.spec;return e?e.type:null}get direction(){if(this._direction)return this._direction;const e=this.spec;return e?e.direction:null}get isInput(){return"in"===this.direction||"inout"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}get handle(){return this._handle}get particle(){return this._particle}set tags(e){this._tags=e}set type(e){this.resolvedType=e,this._resetHandleType()}set direction(e){this._direction=e,this._resetHandleType()}get spec(){return null==this.particle.spec?null:this.particle.spec.handleConnectionMap.get(this.name)}get isOptional(){return null!=this.spec&&this.spec.isOptional}_isValid(e){if(this.direction&&!["in","out","inout","host","`consume","`provide"].includes(this.direction))return e&&e.errors&&e.errors.set(this,`Invalid direction '${this.direction}' for handle connection '${this.getQualifiedName()}'`),!1;if(this.particle.spec&&this.name){const t=this.spec;if(!t)return e&&e.errors&&e.errors.set(this,`Connection ${this.name} is not defined by ${this.particle.name}.`),!1;if(this.direction!==t.direction&&(!["in","out"].includes(this.direction)||"inout"!==t.direction))return e&&e.errors&&e.errors.set(this,`Direction '${this.direction}' for handle connection '${this.getQualifiedName()}' doesn't match particle spec's direction '${t.direction}'`),!1;if(this.resolvedType){if(!t.isCompatibleType(this.resolvedType))return e&&e.errors&&e.errors.set(this,`Type '${this.resolvedType.toString()} for handle connection '${this.getQualifiedName()}' doesn't match particle spec's type '${t.type.toString()}'`),!1}else this.resolvedType=t.type}return!0}isResolved(e){let t;return Object(s.a)(Object.isFrozen(this)),!this.spec||!this.spec.parentConnection||(t=this.particle.connections[this.spec.parentConnection.name])&&t.handle?this.handle?this.direction?!!this.type||(e&&(e.details="missing type"),!1):(e&&(e.details="missing direction"),!1):!!this.isOptional||(e&&(e.details="missing handle"),!1):(e&&(e.details="parent connection missing handle"),!1)}_resetHandleType(){this._handle&&(this._handle._type=void 0)}connectToHandle(e){Object(s.a)(e.recipe===this.recipe),this._handle=e,this._resetHandleType(),this._handle.connections.push(this)}disconnectHandle(){const e=this._handle.connections.indexOf(this);Object(s.a)(e>=0),this._handle.connections.splice(e,1),this._handle=void 0}toString(e,t){const n=[];return n.push(this.name||"*"),n.push({in:"<-",out:"->",inout:"=",host:"=","`consume":"<-","`provide":"->"}[this.direction]||this.direction||"="),this.handle&&(this.handle.immediateValue?n.push(this.handle.immediateValue.name):n.push(`${e&&e.get(this.handle)||this.handle.localName}`)),n.push(...this.tags.map(e=>`#${e}`)),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved handle-connection: ${t.details}`)),n.join(" ")}findSpecsForUnnamedHandles(){return this.particle.spec.handleConnections.filter(e=>!e.isOptional&&S.a.compareTypes({type:this.handle.type},{type:e.type})&&!this.particle.getConnectionByName(e.name))}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class R{constructor(e,t){this._targetSlot=void 0,this._providedSlots={},this._tags=[],Object(s.a)(t),Object(s.a)(t.recipe),Object(s.a)(e),this._recipe=t.recipe,this._particle=t,this._name=e}remove(){this._particle.removeSlotConnection(this)}get recipe(){return this._recipe}get particle(){return this._particle}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get targetSlot(){return this._targetSlot}set targetSlot(e){this._targetSlot=e}get providedSlots(){return this._providedSlots}get tags(){return this._tags}set tags(e){this._tags=e}getSlotSpec(){return this.particle.spec&&this.particle.spec.getSlotSpec(this.name)}connectToSlot(e){Object(s.a)(e),Object(s.a)(!this.targetSlot),Object(s.a)(this.recipe instanceof M||this.recipe===e.recipe,"Cannot connect to slot from different recipe"),this._targetSlot=e,e.consumeConnections.push(this)}disconnectFromSlot(){this._targetSlot&&(this._targetSlot.removeConsumeConnection(this),this._targetSlot=void 0)}_clone(e,t){if(t.has(this))return t.get(this);const n=e.addSlotConnectionAsCopy(this.name);return n.tags=this.tags,t.set(this,n),n}_normalize(){const e={};for(const t of Object.keys(this._providedSlots).sort())e[t]=this._providedSlots[t];this._providedSlots=e,Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Object(p.d)(this.name,e.name))?t:0!==(t=Object(p.b)(this._targetSlot,e._targetSlot))?t:0!==(t=Object(p.b)(this._particle,e._particle))?t:0}_isValid(e){return!this._targetSlot||!this._targetSlot.sourceConnection||this._targetSlot===this._targetSlot.sourceConnection.providedSlots[this._targetSlot.name]||(e&&e.errors&&e.errors.set(this,`Invalid target slot '${this._targetSlot.name}' for slot connection '${this.name}' of particle ${this.particle.name}`),!1)}isResolved(e){return Object(s.a)(Object.isFrozen(this),`slot connection ${this.name} must be frozen before it is resolved`),this.name?this.particle?null!=this.getSlotSpec()&&!this.getSlotSpec().isRequired||this.targetSlot&&(this.targetSlot.id||this.targetSlot.sourceConnection.isConnected())?!this.targetSlot||(null==this.getSlotSpec()||this.getSlotSpec().provideSlotConnections.every(t=>!t.isRequired||0!==this.providedSlots[t.name].consumeConnections.length||(e&&(e.details="missing consuming slot"),!1))):(e&&(e.details="missing target-slot"),!1):(e&&(e.details="missing particle"),!1):(e&&(e.details="missing name"),!1)}isConnectedToInternalSlot(){return this.targetSlot&&!!this.targetSlot.sourceConnection}isConnectedToRemoteSlot(){return this.targetSlot&&!!this.targetSlot.id}isConnected(){return this.isConnectedToInternalSlot()||this.isConnectedToRemoteSlot()}toString(e,t){const n=[];n.push("consume"),n.push(`${this.name}`),this.targetSlot&&n.push(`as ${e&&e.get(this.targetSlot)||this.targetSlot.localName}`),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved slot-connection: ${t.details}`));const i=[];return i.push(n.join(" ")),Object.keys(this.providedSlots).forEach(t=>{const n=this.providedSlots[t],r=[];if(r.push("  provide"),this.getSlotSpec()){const e=this.particle.getSlotSpecByName(t);Object(s.a)(e,`Cannot find providedSlotSpec for ${t}`)}r.push(`${t} as ${e&&e.get(n)||n}`),i.push(r.join(" "))}),i.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class x{constructor(e,t){this._id=void 0,this._localName=void 0,this.spec=void 0,this._verbs=[],this._tags=[],this._connections={},this._unnamedConnections=[],this._consumedSlotConnections={},Object(s.a)(e),this._recipe=e,this._name=t}_copyInto(e,t,n){const i=e.newParticle(this._name);i._id=this._id,i._verbs=[...this._verbs],i._tags=[...this._tags],i.spec=this.spec?this.spec.cloneWithResolutions(n):void 0,Object.keys(this._connections).forEach(e=>{i._connections[e]=this._connections[e]._clone(i,t)}),i._unnamedConnections=this._unnamedConnections.map(e=>e._clone(i,t)),i._cloneConnectionRawTypes(n);for(const[n,r]of Object.entries(this.consumedSlotConnections)){i._consumedSlotConnections[n]=r._clone(i,t),t.has(r.targetSlot)&&(Object(s.a)(e instanceof M),i.consumedSlotConnections[n].connectToSlot(t.get(r.targetSlot)),-1===i.recipe.slots.indexOf(t.get(r.targetSlot))&&i.recipe.slots.push(t.get(r.targetSlot)));for(const[o,a]of Object.entries(r.providedSlots))if(t.has(a)){Object(s.a)(e instanceof M);const r=t.get(a);r.sourceConnection=i.consumedSlotConnections[n],i.consumedSlotConnections[n].providedSlots[o]=r,-1===i.recipe.slots.indexOf(r)&&i.recipe.slots.push(r)}}return i}_cloneConnectionRawTypes(e){for(const t of Object.values(this._connections))t.cloneTypeWithResolutions(e);for(const t of this._unnamedConnections)t.cloneTypeWithResolutions(e)}_startNormalize(){this._localName=null,this._verbs.sort(),this._tags.sort();const e={};for(const t of Object.keys(this._connections).sort())e[t]=this._connections[t];this._connections=e;const t={};for(const e of Object.keys(this.consumedSlotConnections).sort())t[e]=this.consumedSlotConnections[e];this._consumedSlotConnections=t}_finishNormalize(){this._unnamedConnections.sort(p.b),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Object(p.d)(this._id?this._id.toString():"",e._id?e._id.toString():""))?t:0!==(t=Object(p.d)(this._name,e._name))?t:0!==(t=Object(p.d)(this._localName,e._localName))?t:0!==(t=Object(p.a)(this._verbs,e._verbs,p.d))?t:0!==(t=Object(p.a)(this._tags,e._tags,p.d))?t:0}matches(e){if(this.name&&e.name&&this.name!==e.name)return!1;for(const[t,n]of Object.entries(this.consumedSlotConnections)){if(null==e.consumedSlotConnections[t]||null==e.consumedSlotConnections[t].targetSlot)return!1;if(n.targetSlot&&n.targetSlot.id&&n.targetSlot.id!==e.consumedSlotConnections[t].targetSlot.id)return!1;for(const i of Object.keys(n.providedSlots)){const r=n.providedSlots[i],s=e.consumedSlotConnections[t].providedSlots[i];if(null==s||r.id&&s.id&&r.id!==s.id)return!1}}return!0}_isValid(e){return!this.spec||(!(!this.name&&!this.primaryVerb)||(e&&e.errors&&e.errors.set(this,"Particle has no name and no verb"),!1))}isResolved(e){if(Object(s.a)(Object.isFrozen(this)),!this.spec)return e&&e.showUnresolved&&(e.details="missing spec"),!1;if(0===Object.values(this.connections).filter(e=>e.type.isSlot()||e.type.isCollectionType()&&e.type.getContainedType().isSlot()).length&&this.spec.slotConnections.size>0){if(0===Object.values(this.consumedSlotConnections).filter(e=>void 0!==e.targetSlot).length)return e&&e.showUnresolved&&(e.details="unfullfilled slot connections"),!1}if(!this.spec)return e&&e.showUnresolved&&(e.details="missing spec"),!1;const t=this.getUnboundConnections().filter(e=>{let t=e.parentConnection;for(;null!==t;){if(!this.connections[t.name])return!1;t=t.parentConnection}return!0});return t.length>0?(e&&e.showUnresolved&&(e.details=`unresolved connections: ${t.map(e=>e.name).join(", ")}`),!1):0===this.unnamedConnections.length||(e&&e.showUnresolved&&(e.details=`${this.unnamedConnections.length} unnamed connections`),!1)}get recipe(){return this._recipe}get localName(){return this._localName}set localName(e){this._localName=e}get id(){return this._id}set id(e){Object(s.a)(!this._id,"Particle ID can only be set once."),this._id=e}get name(){return this._name}set name(e){this._name=e}get connections(){return this._connections}get unnamedConnections(){return this._unnamedConnections}get consumedSlotConnections(){return this._consumedSlotConnections}get primaryVerb(){return this._verbs.length>0?this._verbs[0]:void 0}set verbs(e){this._verbs=e}set tags(e){this._tags=e}addUnnamedConnection(){const e=new k(void 0,this);return this._unnamedConnections.push(e),e}addConnectionName(e){return Object(s.a)(e,"Cannot create connection with no name"),Object(s.a)(null==this._connections[e]),this._connections[e]=new k(e,this),this._connections[e]}allConnections(){return Object.values(this._connections).concat(this._unnamedConnections)}ensureConnectionName(e){return this._connections[e]||this.addConnectionName(e)}getConnectionByName(e){return this._connections[e]}nameConnection(e,t){Object(s.a)(!this._connections[t],`Connection "${t}" already has a handle`);const n=this._unnamedConnections.indexOf(e);Object(s.a)(n>=0,`Cannot name '${t}' nonexistent unnamed connection.`),e._name=t;const i=this.spec.getConnectionByName(t);e.type=i.type,e.direction!==i.direction&&(Object(s.a)("inout"===e.direction,`Unnamed connection cannot adjust direction ${e.direction} to ${t}'s direction ${i.direction}`),e.direction=i.direction),this._connections[t]=e,this._unnamedConnections.splice(n,1)}getUnboundConnections(e){return this.spec.handleConnections.filter(t=>!t.isOptional&&!this.getConnectionByName(t.name)&&(!e||S.a.compareTypes({type:e},{type:t.type})))}addSlotConnection(e){Object(s.a)(!(e in this.consumedSlotConnections),"slot connection already exists"),Object(s.a)(!this.spec||this.spec.slotConnections.has(e),"slot connection not in particle spec");const t=this.addSlotConnectionAsCopy(e),n=this.getSlotSpecByName(e);return n&&n.provideSlotConnections.forEach(e=>{const n=this.recipe.newSlot(e.name);n.sourceConnection=t,t.providedSlots[e.name]=n}),t}addSlotConnectionAsCopy(e){const t=new R(e,this);return this._consumedSlotConnections[e]=t,t}removeSlotConnection(e){this._consumedSlotConnections[e.name]=null,e.disconnectFromSlot()}remove(){this.recipe.removeParticle(this)}getSlotConnectionBySpec(e){return Object.values(this.consumedSlotConnections).find(t=>t.getSlotSpec()===e)}getSlotConnections(){return Object.values(this.consumedSlotConnections)}getSlotSpecByName(e){if(!this.spec)return;const t=this.spec.slotConnections.get(e);if(t)return t;for(const t of this.spec.slotConnections.values())for(const n of t.provideSlotConnections)if(n.name===e)return n}getSlotConnectionByName(e){return this.consumedSlotConnections[e]}getProvidedSlotByName(e,t){return this.consumedSlotConnections[e]&&this.consumedSlotConnections[e].providedSlots[t]}getSlotSpecs(){return this.spec?this.spec.slotConnections:new Map}toString(e,t){let n=[];this.name?(n.push(this.name),n.push(`as ${e&&e.get(this)||this.localName}`),this.primaryVerb&&this.primaryVerb!==this.name&&n.push(`// verb=${this.primaryVerb}`)):n.push(`&${this.primaryVerb}`),t&&t.showUnresolved&&(this.isResolved(t)||n.push(`// unresolved particle: ${t.details}`)),n=[n.join(" ")];for(const i of this.unnamedConnections)n.push(i.toString(e,t).replace(/^|(\n)/g,"$1  "));for(const i of Object.values(this.connections))n.push(i.toString(e,t).replace(/^|(\n)/g,"$1  "));for(const i of Object.values(this.consumedSlotConnections))n.push(i.toString(e,t).replace(/^|(\n)/g,"$1  "));return n.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class E{constructor(e,t){Object(s.a)(e),this._phrase=e;const n=this.phrase.toLowerCase().split(/[^a-z0-9]/g);this._unresolvedTokens=[],(t||n).forEach(e=>this._unresolvedTokens.push(e)),this._resolvedTokens=n.slice();for(const e of this.unresolvedTokens){const t=this._resolvedTokens.indexOf(e);t>=0&&this._resolvedTokens.splice(t,1)}Object(s.a)(n.length===this.unresolvedTokens.length+this.resolvedTokens.length)}_append(e,t,n){this._phrase.length>0&&(this._phrase=this.phrase.concat(" ")),this._phrase=this._phrase.concat(e),n.forEach(e=>this._resolvedTokens.push(e)),t.forEach(e=>this._unresolvedTokens.push(e))}get phrase(){return this._phrase}get unresolvedTokens(){return this._unresolvedTokens}get resolvedTokens(){return this._resolvedTokens}resolveToken(e){const t=this.unresolvedTokens.indexOf(e.toLowerCase());Object(s.a)(t>=0,`Cannot resolved nonexistent token ${e}`),this._unresolvedTokens.splice(t,1),this._resolvedTokens.push(e.toLowerCase())}isValid(){return this._unresolvedTokens.length>0||this._resolvedTokens.length>0}isResolved(){return Object(s.a)(Object.isFrozen(this)),this._resolvedTokens.length>0}_normalize(){this._unresolvedTokens.sort(),this._resolvedTokens.sort(),Object.freeze(this)}_copyInto(e){return e.search?e.search._append(this.phrase,this.unresolvedTokens,this.resolvedTokens):(e.search=new E(this.phrase,this.unresolvedTokens),Object(s.a)(e.search.resolvedTokens.length===this.resolvedTokens.length,`${e.search.resolvedTokens} is not same as ${this.resolvedTokens}`)),Object(s.a)(this.resolvedTokens.every(t=>e.search.resolvedTokens.indexOf(t)>=0)&&this.unresolvedTokens.every(t=>e.search.unresolvedTokens.indexOf(t)>=0)),e.search}toString(e){const t=[];t.push(`search \`${this.phrase}\``);const n=[];return n.push("  tokens"),this.unresolvedTokens.length>0&&n.push(this.unresolvedTokens.map(e=>`\`${e}\``).join(" ")),this.resolvedTokens.length>0&&n.push(`// ${this.resolvedTokens.map(e=>`\`${e}\``).join(" ")}`),e&&e.showUnresolved&&this.unresolvedTokens.length>0&&n.push("// unresolved search tokens"),t.push(n.join(" ")),t.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class O{constructor(e,t){this._id=void 0,this._localName=void 0,this._tags=[],this._sourceConnection=void 0,this._formFactor=void 0,this._consumeConnections=[],Object(s.a)(e),this._recipe=e,this._name=t}get recipe(){return this._recipe}get id(){return this._id}set id(e){this._id=e}get localName(){return this._localName}set localName(e){this._localName=e}get name(){return this._name}set name(e){this._name=e}get tags(){return this._tags}set tags(e){this._tags=e}get formFactor(){return this._formFactor}set formFactor(e){this._formFactor=e}get sourceConnection(){return this._sourceConnection}set sourceConnection(e){this._sourceConnection=e}get consumeConnections(){return this._consumeConnections}get spec(){return this.sourceConnection&&this.sourceConnection.getSlotSpec()?this.sourceConnection.particle.getSlotSpecByName(this.name):{isSet:!1,tags:[]}}get handles(){const e=[];if(this.sourceConnection&&this.sourceConnection.getSlotSpec())for(const t of this.sourceConnection.particle.getSlotSpecByName(this.name).handles){const n=this.sourceConnection.particle.connections[t];(n||n.handle)&&e.push(n.handle)}return e}_copyInto(e,t){let n=void 0;return t.has(this)?t.get(this):(!this.sourceConnection&&this.id&&(n=e.findSlot(this.id)),null==n&&((n=e.newSlot(this.name))._id=this.id,n._formFactor=this.formFactor,n._localName=this._localName,n._tags=[...this._tags],n._sourceConnection=t.get(this._sourceConnection),n.sourceConnection&&(n.sourceConnection._providedSlots[n.name]=n)),this._consumeConnections.forEach(e=>{t.get(e)&&null==t.get(e).targetSlot&&t.get(e).connectToSlot(n)}),n)}_startNormalize(){this.localName=null,this._tags.sort()}_finishNormalize(){this._consumeConnections.forEach(e=>Object(s.a)(Object.isFrozen(e))),this._consumeConnections.sort(p.b),Object.freeze(this)}_compareTo(e){let t;return 0!==(t=Object(p.d)(this.id,e.id))?t:0!==(t=Object(p.d)(this.localName,e.localName))?t:0!==(t=Object(p.d)(this.formFactor,e.formFactor))?t:0!==(t=Object(p.a)(this._tags,e._tags,p.d))?t:0}findHandleByID(e){return this.handles.find(t=>t.id===e)}removeConsumeConnection(e){const t=this._consumeConnections.indexOf(e);Object(s.a)(t>-1),this._consumeConnections.splice(t,1),0===this._consumeConnections.length&&this.remove()}remove(){this._recipe.removeSlot(this)}isResolved(e){return Object(s.a)(Object.isFrozen(this)),e&&e.showUnresolved&&(e.details=[],this._sourceConnection||e.details.push("missing source-connection"),this.id||e.details.push("missing id"),e.details=e.details.join("; ")),Boolean(this._sourceConnection||this.id)}_isValid(e){return!0}toString(e,t){const n=[];n.push("slot"),this.id&&n.push(`'${this.id}'`),this.tags.length>0&&n.push(this.tags.map(e=>`#${e}`).join(" ")),n.push(`as ${e&&e.get(this)||this.localName}`);const i=t&&t.showUnresolved&&!this.isResolved(t);return i&&n.push(`// unresolved slot: ${t.details}`),this.id||i?n.join(" "):""}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class j{constructor(e){this._requires=[],this._particles=[],this._handles=[],this._slots=[],this._localName=void 0,this.annotation=void 0,this._connectionConstraints=[],this._obligations=[],this._verbs=[],this._search=null,this._patterns=[],this._name=e}newConnectionConstraint(e,t,n){const i=new b(e,t,n,"constraint");return this._connectionConstraints.push(i),i}newObligation(e,t,n){const i=new b(e,t,n,"obligation");return this._obligations.push(i),i}removeObligation(e){const t=this._obligations.indexOf(e);Object(s.a)(t>-1),this._obligations.splice(t,1)}removeConstraint(e){const t=this._connectionConstraints.indexOf(e);Object(s.a)(t>=0),this._connectionConstraints.splice(t,1)}clearConnectionConstraints(){this._connectionConstraints.length=0}newRequireSection(){const e=new M(this);return this._requires.push(e),e}newParticle(e){const t=new x(this,e);return this._particles.push(t),t}removeParticle(e){const t=this._particles.indexOf(e);Object(s.a)(t>-1),this._particles.splice(t,1);for(const t of Object.values(e._consumedSlotConnections))t.remove()}newHandle(){const e=new C(this);return this._handles.push(e),e}removeHandle(e){Object(s.a)(0===e.connections.length);const t=this._handles.indexOf(e);Object(s.a)(t>-1),this._handles.splice(t,1)}newSlot(e){const t=new O(this,e);return this._slots.push(t),t}addSlot(e){-1===this.slots.indexOf(e)&&this.slots.push(e)}removeSlot(e){Object(s.a)(0===e.consumeConnections.length);let t=this._slots.indexOf(e);Object(s.a)(t>-1),this._slots.splice(t,1);for(const n of this.requires)-1!==(t=n.slots.indexOf(e))&&n.slots.splice(t,1)}isResolved(e){Object(s.a)(Object.isFrozen(this),"Recipe must be normalized to be resolved.");const t=(t,n)=>(!t&&e&&e.errors&&e.errors.set(this.name,n),t);return t(0===this._obligations.length,"unresolved obligations")&&t(0===this._connectionConstraints.length,"unresolved constraints")&&t(this.requires.every(e=>e.isEmpty()),"unresolved require")&&t(null===this._search||this._search.isResolved(),"unresolved search")&&t(this._handles.every(e=>e.isResolved()),"unresolved handles")&&t(this._particles.every(t=>t.isResolved(e)),"unresolved particles")&&t(this.modality.isResolved(),"unresolved modality")&&t(this.allRequiredSlotsPresent(e),"unresolved required slot")&&t(this._slots.every(e=>e.isResolved()),"unresolved slots")&&t(this.handleConnections.every(e=>e.isResolved()),"unresolved handle connections")&&t(this.slotConnections.every(e=>e.isResolved()),"unresolved slot connections")}isCompatible(e){return this.particles.every(t=>!t.spec||t.spec.isCompatible(e))}get modality(){return this.particles.filter(e=>Boolean(e.spec&&e.spec.slotConnections.size>0)).map(e=>e.spec.modality).reduce((e,t)=>e.intersection(t),T.a.all)}allRequiredSlotsPresent(e){for(const t of this.particles){if(0===t.spec.slotConnections.size)continue;let n=!1,i=!1;for(const e of Object.values(t.spec.connections))(e.type.isSlot()||e.type.isCollectionType()&&e.type.collectionType.isSlot())&&(i=!0);for(const[i,r]of t.spec.slotConnections){if(r.isRequired&&!t.consumedSlotConnections[i])return e&&e.errors&&e.errors.set(i,`required slot ${i} has no matching connection`),!1;if(t.consumedSlotConnections[i]){n=!0;for(const n of r.provideSlotConnections)if(n.isRequired&&!t.getProvidedSlotByName(i,n.name))return e&&e.errors&&e.errors.set(i,`required provided slot ${n.name} has no matching connection`),!1}}if(!i&&!n)return e&&e.errors&&e.errors.set("?","no slot connections"),!1}return!0}_findDuplicate(e,t){const n=new Set,i=e.find(e=>{if(e.id){if(n.has(e.id))return e;n.add(e.id)}});return i&&t&&t.errors&&t.errors.set(i,`Has Duplicate ${i instanceof C?"Handle":"Slot"} '${i.id}'`),i}_isValid(e){return!this._findDuplicate(this._handles,e)&&!this._findDuplicate(this._slots,e)&&this._handles.every(t=>t._isValid(e))&&this._particles.every(t=>t._isValid(e))&&this._slots.every(t=>t._isValid(e))&&this.handleConnections.every(t=>t._isValid(e))&&this.slotConnections.every(t=>t._isValid(e))&&(!this.search||this.search.isValid())}get requires(){return this._requires}get name(){return this._name}set name(e){this._name=e}get localName(){return this._localName}set localName(e){this._localName=e}get particles(){return this._particles}set particles(e){this._particles=e}get handles(){return this._handles}set handles(e){this._handles=e}get slots(){return this._slots}set slots(e){this._slots=e}get connectionConstraints(){return this._connectionConstraints}get obligations(){return this._obligations}get verbs(){return this._verbs}set verbs(e){this._verbs=e}get search(){return this._search}set search(e){this._search=e}setSearchPhrase(e){Object(s.a)(!this._search,"Cannot override search phrase"),e&&(this._search=new E(e))}get slotConnections(){const e=[];return this._particles.forEach(t=>{e.push(...Object.values(t.consumedSlotConnections))}),e}get handleConnections(){const e=[];return this._particles.forEach(t=>{e.push(...Object.values(t.connections)),e.push(...t._unnamedConnections)}),e}isEmpty(){return 0===this.particles.length&&0===this.handles.length&&0===this.slots.length&&0===this._connectionConstraints.length}findHandle(e){for(const t of this.handles)if(t.id===e)return t;return null}findSlot(e){for(const t of this.slots)if(t.id===e)return t;return null}get patterns(){return this._patterns}set patterns(e){this._patterns=e}set description(e){const t=e.find(e=>"pattern"===e.name);t&&t.patterns.forEach(e=>this._patterns.push(e)),e.forEach(e=>{if("pattern"!==e.name){const t=this.handles.find(t=>t.localName===e.name);Object(s.a)(t,`Cannot set description pattern for nonexistent handle ${e.name}.`),t.pattern=e.pattern}})}async digest(){return c(this.toString())}normalize(e){if(Object.isFrozen(this))return e&&e.errors&&e.errors.set(this,"already normalized"),!1;if(!this._isValid()){this._findDuplicate(this._handles,e),this._findDuplicate(this._slots,e);const t=t=>t.forEach(t=>!t._isValid(e));return t(this._handles),t(this._particles),t(this._slots),t(this.handleConnections),t(this.slotConnections),!1}for(const e of this._particles)e._startNormalize();for(const e of this._handles)e._startNormalize();for(const e of this._slots)e._startNormalize();const t=this.handleConnections;for(const e of t)e._normalize();t.sort(p.b);const n=this.slotConnections;for(const e of n)e._normalize();n.sort(p.b),this.search&&this.search._normalize();for(const e of this.requires)e.normalize();for(const e of this._particles)e._finishNormalize();for(const e of this._handles)e._finishNormalize();for(const e of this._slots)e._finishNormalize();const i=new Set,r=new Set,s=new Set,o=[],a=[],c=[];let l=t.filter(e=>!(e.type&&e.type instanceof _.f));l=l.concat(t.filter(e=>!!e.type&&!!(e.type instanceof _.f)));for(const e of l)r.has(e.particle)||(o.push(e.particle),r.add(e.particle)),e.handle&&!i.has(e.handle)&&(a.push(e.handle),i.add(e.handle));for(const e of n)e.targetSlot&&!s.has(e.targetSlot)&&(c.push(e.targetSlot),s.add(e.targetSlot)),Object.values(e.providedSlots).forEach(e=>{s.has(e)||(c.push(e),s.add(e))});const u=this._handles.filter(e=>!i.has(e));u.sort(p.b),a.push(...u);const h=this._particles.filter(e=>!r.has(e));h.sort(p.b),o.push(...h);const d=this._slots.filter(e=>!s.has(e));return d.sort(p.b),c.push(...d),this._particles=o,this._handles=a,this._slots=c,this._connectionConstraints.sort(p.b),this._verbs.sort(),this._patterns.sort(),Object.freeze(this._particles),Object.freeze(this._handles),Object.freeze(this._slots),Object.freeze(this._connectionConstraints),Object.freeze(this),!0}clone(e){const t=new j(this.name);return null==e&&(e=new Map),this._copyInto(t,e),t._cloneMap=e,t}mergeInto(e){const t=new Map,n=e._handles.length,i=e._particles.length,r=e._slots.length;return this._copyInto(e,t),{handles:e._handles.slice(n),particles:e._particles.slice(i),slots:e._slots.slice(r),cloneMap:t}}_copyInto(e,t){const n=new Map;function i(i){const r=i._copyInto(e,t,n);t.set(i,r)}e._name=this.name,e._verbs=e._verbs.concat(...this._verbs),this._handles.forEach(i),this._particles.forEach(i),this._slots.forEach(i),this._connectionConstraints.forEach(i),this._obligations.forEach(i),e.verbs=e.verbs.slice(),this.search&&this.search._copyInto(e);for(const n of this.requires){const i=e.newRequireSection();n._copyInto(i,t),i._cloneMap=t}e.patterns=e.patterns.concat(this.patterns)}updateToClone(e){const t={};return Object.keys(e).forEach(n=>t[n]=this._cloneMap.get(e[n])),t}_makeLocalNameMap(){const e=new Set;for(const t of this.particles)e.add(t.localName);for(const t of this.handles)e.add(t.localName);for(const t of this.slots)e.add(t.localName);const t=new Map;let n=0;for(const i of this.particles){let r=i.localName;if(!r)do{r=`particle${n++}`}while(e.has(r));t.set(i,r)}n=0;for(const i of this.handles){let r=i.localName;if(!r)do{r=`handle${n++}`}while(e.has(r));t.set(i,r)}n=0;for(const i of this.slots){let r=i.localName;if(!r)do{r=`slot${n++}`}while(e.has(r));t.set(i,r)}return t}toString(e){const t=this._makeLocalNameMap(),n=[],i=this.verbs.length>0?` ${this.verbs.map(e=>`&${e}`).join(" ")}`:"";n.push(`recipe${this.name?` ${this.name}`:""}${i}`),e&&e.showUnresolved&&this.search&&n.push(this.search.toString(e).replace(/^|(\n)/g,"$1  "));for(const t of this._connectionConstraints){let i=t.toString().replace(/^|(\n)/g,"$1  ");e&&e.showUnresolved&&(i=i.concat(" // unresolved connection-constraint")),n.push(i)}n.push(...this.handles.map(n=>n.toString(t,e)).filter(e=>e).map(e=>e.replace(/^|(\n)/g,"$1  ")));for(const i of this.slots){const r=i.toString(t,e);r&&n.push(r.replace(/^|(\n)/g,"$1  "))}for(const i of this.requires)i.isEmpty()||n.push(i.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const i of this.particles)n.push(i.toString(t,e).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(e=>void 0!==e.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let e=1;e<this.patterns.length;++e)n.push(`    pattern \`${this.patterns[e]}\``);this.handles.forEach(e=>{e.pattern&&n.push(`    ${e.localName} \`${e.pattern}\``)})}if(this._obligations.length>0){n.push("  obligations");for(const i of this._obligations){const r=i.toString(t,e).replace(/^|(\n)/g,"$1    ");n.push(r)}}return n.join("\n")}getFreeHandles(){return this.handles.filter(e=>0===e.connections.length)}get allSpecifiedConnections(){return[].concat(...this.particles.filter(e=>e.spec&&e.spec.connections).map(e=>e.spec.connections.map(t=>({particle:e,connSpec:t}))))}getFreeConnections(e){return this.allSpecifiedConnections.filter(({particle:t,connSpec:n})=>!n.isOptional&&"descriptions"!==n.name&&"host"!==n.direction&&!t.connections[n.name]&&(!e||S.a.compareTypes({type:e},{type:n.type})))}findHandleByID(e){return this.handles.find(t=>t.id===e)}getUnnamedUntypedConnections(){return this.handleConnections.find(e=>!e.type||!e.name||e.isOptional)}getParticlesByImplFile(e){return this.particles.filter(t=>t.spec&&e.has(t.spec.implFile))}findSlotByID(e){let t=this.slots.find(t=>t.id===e);if(null==t)if(this instanceof M)t=this.parent.slots.find(t=>t.id===e);else for(const n of this.requires)if(void 0!==(t=n.slots.find(t=>t.id===e)))break;return t}}class M extends j{constructor(e,t){super(t),this.parent=e}toString(e,t){null==e&&(e=this._makeLocalNameMap());const n=[];n.push("require"),t&&t.showUnresolved&&this.search&&n.push(this.search.toString(t).replace(/^|(\n)/g,"$1  "));for(const e of this.connectionConstraints){let i=e.toString().replace(/^|(\n)/g,"$1  ");t&&t.showUnresolved&&(i=i.concat(" // unresolved connection-constraint")),n.push(i)}n.push(...this.handles.map(n=>n.toString(e,t)).filter(e=>e).map(e=>e.replace(/^|(\n)/g,"$1  ")));for(const i of this.slots){const r=i.toString(e,t);r&&n.push(r.replace(/^|(\n)/g,"$1  "))}for(const i of this.particles)n.push(i.toString(e,t).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(e=>void 0!==e.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let e=1;e<this.patterns.length;++e)n.push(`    pattern \`${this.patterns[e]}\``);this.handles.forEach(e=>{e.pattern&&n.push(`    ${e.localName} \`${e.pattern}\``)})}if(this.obligations.length>0){n.push("  obligations");for(const i of this.obligations){const r=i.toString(e,t).replace(/^|(\n)/g,"$1    ");n.push(r)}}return n.join("\n")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ${constructor(e,t,n,i){this.recipe=e,this.particles=t,this.handles=n,this.reverse=new Map;for(const e of Object.keys(t))this.reverse.set(t[e],e);for(const e of n.keys())this.reverse.set(n.get(e),e);for(const e of Object.keys(i))this.reverse.set(i[e],e)}}class P{static makeShape(e,t,n,i){i=i||new j;const r={},s=new Map,o={};return e.forEach(e=>r[e]=i.newParticle(e)),t.forEach(e=>s.set(e,i.newHandle())),Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(t=>{const i=n[e][t];let a="=";i.direction&&(a={"->":"out","<-":"in","=":"="}[i.direction]);const c=i.tags||[];i.localName&&(s.get(i.handle).localName=i.localName);const l=r[e].addConnectionName(t);l.direction=a,s.get(i.handle).tags=c,l.connectToHandle(s.get(i.handle)),o[e+":"+t]=r[e].connections[t]})}),new $(i,r,s,o)}static recipeToShape(e){const t={};let n=0;e.particles.forEach(e=>t[e.name]=e);const i=new Map;e.handles.forEach(e=>i.set("h"+n++,e));const r={};return e.handleConnections.forEach(e=>r[e.particle.name+":"+e.name]=e),new $(e,t,i,r)}static find(e,t){function n(e,t,n,r){const{forward:o,reverse:a,score:c}=n;let l=!1;for(const n of e.particles)if(n.spec)for(const e of n.spec.handleConnections){if(a.has(e))continue;if(n.name!==t.particle.name)continue;if(t.name&&t.name!==e.name)continue;const i={in:["in","inout"],out:["out","inout"],"=":["in","out","inout"],inout:["inout"],host:["host"],"`consume":["consume"],"`provide":["provide"]};if(e.direction&&(Object(s.a)(Object.keys(i).includes(t.direction),`${t.direction} not in ${Object.keys(i)}`),!i[t.direction].includes(e.direction)))continue;const u=n.connections[e.name];if(t.handle&&u&&u.handle&&t.handle.localName&&t.handle.localName!==u.handle.localName)continue;if(a.has(n)){if(a.get(n)!==t.particle)continue}else if(o.has(t.particle))continue;if(t.handle&&u&&u.handle){if(a.has(u.handle)){if(a.get(u.handle)!==t.handle)continue}else if(o.has(t.handle)&&null!==o.get(t.handle))continue;if("create"!==t.handle.fate||"create"!==u.handle.fate&&"create"!==u.handle.originalFate){if(Boolean(t.handle.immediateValue)!==Boolean(u.handle.immediateValue))continue;if(u.handle.immediateValue){if(!u.handle.immediateValue.equals(t.handle.immediateValue))continue}else if(t.handle.id!==u.handle.id&&t.handle.id!==u.handle.originalId)continue}}const h={forward:new Map(o),reverse:new Map(a),score:c};Object(s.a)(!h.reverse.has(n)||h.reverse.get(n)===t.particle),Object(s.a)(!h.forward.has(t.particle)||h.forward.get(t.particle)===n),h.forward.set(t.particle,n),h.reverse.set(n,t.particle),t.handle&&(u&&u.handle?(h.forward.set(t.handle,u.handle),h.reverse.set(u.handle,t.handle)):h.forward.has(t.handle)||(h.forward.set(t.handle,null),h.score-=2)),h.forward.set(t,e),h.reverse.set(e,t),r.push(h),l=!0}if(!1===l){if(n.forward.get(t.particle))return;const s=[];i(e,t.particle,n,s),s.forEach(e=>{t.handle&&!e.forward.has(t.handle)&&(e.forward.set(t.handle,null),e.score-=2),e.forward.set(t,null),e.score-=1,r.push(e)})}}function i(e,t,n,i){const{forward:r,reverse:o,score:a}=n;let c=!1;for(const n of e.particles){if(o.has(n))continue;if(n.name!==t.name)continue;let e=!0;for(const i of Object.keys(n.connections)){const r=n.connections[i];if(!r.handle)continue;const s=t.connections[i];if(s&&s.handle&&s.handle.localName&&s.handle.localName!==r.handle.localName){e=!1;break}}if(!e)continue;const l={forward:new Map(r),reverse:new Map(o),score:a};Object(s.a)(!l.forward.has(t)||l.forward.get(t)===n),Object(s.a)(!l.reverse.has(n)||l.reverse.get(n)===t),l.forward.set(t,n),l.reverse.set(n,t),i.push(l),c=!0}if(!1===c){const e={forward:new Map,reverse:new Map,score:0};r.forEach((t,n)=>{Object(s.a)(!e.forward.has(n)||e.forward.get(n)===t),e.forward.set(n,t)}),o.forEach((t,n)=>{Object(s.a)(!e.reverse.has(n)||e.reverse.get(n)===t),e.reverse.set(n,t)}),e.forward.has(t)||(e.forward.set(t,null),e.score=n.score-1),i.push(e)}}function r(e,n,i){if(1===n.length){const t=[],{forward:r,reverse:s,score:o}=e;for(const e of i){let i=!0;for(const t of e.tags)if(!n[0].tags.includes(t)){i=!1;break}if(!i)continue;const a={forward:new Map(r),reverse:new Map(s),score:o+1};a.forward.set(e,n[0]),a.reverse.set(n[0],e),t.push(a)}return t}const s=n.pop(),o=r(e,n,i);let a=[];for(const e of o){const n=[...t.handles.values()].filter(t=>null===e.forward.get(t));n.length>0?a=a.concat(r(e,[s],n)):a.concat(e)}return a}let o=[{forward:new Map,reverse:new Map,score:0}];for(const i of t.recipe.handleConnections){const t=[];for(const r of o)n(e,i,r,t);o=t}for(const n of t.recipe.particles){if(Object.keys(n.connections).length>0)continue;if(n.unnamedConnections.length>0)continue;const t=[];for(const r of o)i(e,n,r,t);o=t}const a=e.handles.filter(e=>0===e.connections.length);if(a.length>0){let e=[];for(const n of o){const i=[...t.handles.values()].filter(e=>null===n.forward.get(e));e=i.length>0?e.concat(r(n,a,i)):e.concat(n)}o=e}return o.map(({forward:e,score:n})=>{const i={};return e.forEach((e,n)=>i[t.reverse.get(n)]=e),{match:i,score:n}})}static constructImmediateValueHandle(e,t,n){if(Object(s.a)(e.type instanceof _.f),!(e.type instanceof _.f&&e.type.interfaceInfo.restrictType(t)))return null;const i=e.type.clone(new Map);i.maybeEnsureResolved();const r=e.recipe.newHandle();return r.id=n.toString(),r.mappedType=i,r.fate="copy",r.immediateValue=t,r}static directionCounts(e){const t={in:0,out:0,inout:0,unknown:0};for(const n of e.connections){let e=n.direction;void 0===t[e]&&(e="unknown"),t[e]++}return t.in+=t.inout,t.out+=t.inout,t}static matchesRecipe(e,t){const n=P.recipeToShape(t);return P.find(e,n).some(e=>0===e.score)}}var N=n(8);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class I{constructor(e){if(this.items=new Map,e)for(let{id:t,value:n,keys:i}of e)i||(i=[]),this.items.set(t,{value:n,keys:new Set(i)})}add(e,t,n){Object(s.a)(n.length>0&&"object"==typeof n,"add requires a list of keys");let i=this.items.get(e),r=!1;if(i){let e=!1;for(const t of n)i.keys.has(t)||(e=!0),i.keys.add(t);this._equals(i.value,t)||(Object(s.a)(e,"cannot add without new keys. incoming="+n.join(",")+" existing="+[...i.keys].join(",")),i.value=t,r=!0)}else i={value:t,keys:new Set(n)},this.items.set(e,i),r=!0;return r}_equals(e,t){if(Boolean(e)!==Boolean(t))return!1;if(!e)return!0;const n=typeof e;if(n!==typeof t)return!1;if("object"===n){const n=Object.keys(e);return n.length===Object.keys(t).length&&n.every(n=>this._equals(e[n],t[n]))}return JSON.stringify(e)===JSON.stringify(t)}remove(e,t){const n=this.items.get(e);if(!n)return!1;for(const e of t)n.keys.delete(e);const i=0===n.keys.size;return i&&this.items.delete(e),i}toLiteral(){const e=[];for(const[t,{value:n,keys:i}]of this.items.entries())e.push({id:t,value:n,keys:[...i]});return e}toList(){return[...this.items.values()].map(e=>e.value)}has(e){return this.items.has(e)}getKeys(e){const t=this.items.get(e);return t?[...t.keys]:[]}getValue(e){const t=this.items.get(e);return t?t.value:null}get size(){return this.items.size}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class D{}var A=n(7);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class q{constructor(e=[],t={}){this.particleDescriptions=e,this.storeDescById=t,this.seenHandles=new Set,this.seenParticles=new Set,this.excludeValues=!1}getDescription(e){if(e.patterns.length>0){let t=[];for(const n of e.patterns)t.push(this.patternToSuggestion(n,{_recipe:e}));if((t=t.filter(e=>Boolean(e))).length>0)return this._capitalizeAndPunctuate(this._joinDescriptions(t))}const t=new Set(e.particles);let n=this.particleDescriptions.filter(e=>t.has(e._particle)&&this._isSelectedDescription(e));if(n.find(e=>e._particle.spec.slotConnections.size>0)&&(n=n.filter(e=>e._particle.spec.slotConnections.size>0)),(n=n.sort(q.sort)).length>0)return this._combineSelectedDescriptions(n)}_isSelectedDescription(e){return!!e.pattern}getHandleDescription(e){const t=this._selectHandleConnection(e)||e.connections[0];return this._formatDescription(t)}_combineSelectedDescriptions(e,t={}){const n=[];e.map(e=>{this.seenParticles.has(e._particle)||n.push(this.patternToSuggestion(e.pattern,e))});const i=this._joinDescriptions(n);if(i)return t.skipFormatting?i:this._capitalizeAndPunctuate(i)}_joinDescriptions(e){const t=e.filter(e=>e),n=t.length;if(n>0){const e=["",""," and ",", and "][Math.min(3,n)],i=t.pop();return`${t.join(", ")}${e}${i}`}}_joinTokens(e){return e.join("")}_capitalizeAndPunctuate(e){Object(s.a)(e);const t=e.length-1;return`${e[0].toUpperCase()}${e.slice(1,t)}${e[t]}${e[t].match(/[a-z0-9()' >\]]/i)?".":""}`}patternToSuggestion(e,t){const n=this._initTokens(e,t).map(e=>this.tokenToString(e));if(0===n.filter(e=>null==e).length)return this._joinTokens(n)}_initTokens(e,t){e=e.replace(/</g,"&lt;");let n=[];for(;e.length>0;){const i=e.match(/\${[a-zA-Z0-9.]+}(?:\.[_a-zA-Z]+)?/g);let r,o;i?(r=i[0],o=e.indexOf(r)):(r="",o=e.length),Object(s.a)(o>=0);const a=e.substring(0,o);a.length>0&&n.push({text:a}),r.length>0&&(n=n.concat(this._initSubTokens(r,t))),e=e.substring(o+r.length)}return n}_initSubTokens(e,t){const n=e.match(/\${([a-zA-Z0-9.]+)}(?:\.([_a-zA-Z]+))?/),i=n[1].split("."),r=3===n.length?n[2]:void 0;if(!t._particle){const e=i.shift();if(e[0]!==e[0].toUpperCase())return console.warn(`Invalid particle name '${e}' - must start with a capital letter.`),[];const n=this.particleDescriptions.filter(n=>n._particle.name===e&&t._recipe.particles.find(e=>e===n._particle));if(0===n.length)return console.warn(`Cannot find particles with name ${e}.`),[];t=n[n.length-1]}const o=t._particle;if(0===i.length)return[{particleName:o.spec.name,particleDescription:t}];const a=o.connections[i[0]];if(a)return Object(s.a)(a.handle,"Missing handle???"),[{fullName:n[0],handleName:a.name,storeId:a.handle.id,properties:i.splice(1),extra:r,_handleConn:a,value:t._connections[a.name].value}];if(2!==i.length)return 1===i.length?console.warn(`Unknown handle connection name '${i[0]}'`):console.warn(`Slot connections tokens must have exactly 2 names, found ${i.length} in '${i.join(".")}'`),[];const c=o.consumedSlotConnections[i[0]].providedSlots[i[1]];return Object(s.a)(c,`Could not find handle ${i.join(".")}`),[{fullName:n[0],consumeSlotName:i[0],provideSlotName:i[1],extra:r,_providedSlotConn:c}]}tokenToString(e){if(e.text)return e.text;if(e.particleName)return this._particleTokenToString(e);if(e.handleName)return this._handleTokenToString(e);if(e.consumeSlotName&&e.provideSlotName)return this._slotTokenToString(e);throw new Error("no handle or slot name")}_particleTokenToString(e){return this._combineSelectedDescriptions([e.particleDescription],{skipFormatting:!0})}_handleTokenToString(e){switch(e.extra){case"_type_":return e._handleConn.type.toPrettyString().toLowerCase();case"_values_":return this._formatStoreValue(e.handleName,e.value);case"_name_":return this._formatDescription(e._handleConn);default:{if(Object(s.a)(!e.extra,`Unrecognized extra ${e.extra}`),e._handleConn.type instanceof _.f){if(!e.value)return;return Object(s.a)(e.value.interfaceValue,`Missing interface type value for '${e._handleConn.type}'.`),d.a.fromLiteral(e.value.interfaceValue).pattern}if(e.properties&&e.properties.length>0)return this._propertyTokenToString(e.handleName,e.value,e.properties);let t=this._formatDescriptionPattern(e._handleConn)||this._formatStoreDescription(e._handleConn);const n=this._formatStoreValue(e.handleName,e.value);if(!t){const t=e._handleConn.type;if(n&&!this.excludeValues&&!(t instanceof _.c)&&!(t instanceof _.b))return n}return t=t||this._formatHandleType(e._handleConn),!n||this.excludeValues||this.seenHandles.has(e.storeId)?t:(this.seenHandles.add(e.storeId),this._combineDescriptionAndValue(e,t,n))}}}_combineDescriptionAndValue(e,t,n){return t===n?t:`${t} (${n})`}_slotTokenToString(e){switch(e.extra){case"_empty_":return 0===e._providedSlotConn.consumeConnections.length;default:Object(s.a)(!e.extra,`Unrecognized slot extra ${e.extra}`)}const t=e._providedSlotConn.consumeConnections.map(e=>{const t=e.particle,n=this.particleDescriptions.find(e=>e._particle===t);return this.seenParticles.add(t),this.patternToSuggestion(t.spec.pattern,n)});return this._joinDescriptions(t)}_propertyTokenToString(e,t,n){if(!t)return"";Object(s.a)(t.entityValue,`Cannot return property ${n.join(",")} for non EntityType.`);t.entityValue;if(t.entityValue){let i=t.entityValue;for(const e of n)i&&(i=i[e]);if(i)return this._formatEntityProperty(e,n,i)}}_formatEntityProperty(e,t,n){return n}_formatStoreValue(e,t){if(t){if(t.collectionValues)return this._formatCollection(e,t.collectionValues);if(t.bigCollectionValues)return this._formatBigCollection(e,t.bigCollectionValues);if(t.entityValue)return this._formatSingleton(e,t);throw new Error(`invalid store type for handle ${e}`)}}_formatCollection(e,t){return t[0].rawData.name?t.length>2?`${t[0].rawData.name} plus ${t.length-1} other items`:t.map(e=>e.rawData.name).join(", "):`${t.length} items`}_formatBigCollection(e,t){return`collection of items like ${t.rawData.name}`}_formatSingleton(e,t){const n=t.entityValue;if(t.valueDescription){let e,i=t.valueDescription;for(;e=i.match(/\${([a-zA-Z0-9.]+)}/);)i=i.replace(e[0],n[e[1]]);return i}if(n.name)return n.name}_formatDescription(e){return this._formatDescriptionPattern(e)||this._formatStoreDescription(e)||this._formatHandleType(e)}_formatDescriptionPattern(e){let t=e;if(!t.spec.isOutput){const n=this._selectHandleConnection(e.handle);n&&(t=n)}const n=this.particleDescriptions.find(e=>e._particle===t.particle),i=n?n._connections[t.name]:null;if(i&&i.pattern)return this.patternToSuggestion(i.pattern,n)}_formatStoreDescription(e){if(e.handle){if(!e.handle.id)return;const t=this.storeDescById[e.handle.id],n=this._formatHandleType(e);if(t&&t!==n)return t}}_formatHandleType(e){return(e.handle&&e.handle.type.isResolved()?e.handle.type:e.type).toPrettyString().toLowerCase()}_selectHandleConnection(e){const t=e.connections.filter(e=>{const t=e.spec,n=this.particleDescriptions.find(t=>t._particle===e.particle);return!!t.pattern||!!n._connections[e.name].pattern});if(t.sort((e,t)=>{const n=e.spec.isOutput;if(n!==t.spec.isOutput)return n?-1:1;const i=this.particleDescriptions.find(t=>t._particle===e.particle);return this.particleDescriptions.find(e=>e._particle===t.particle)._rank-i._rank}),t.length>0)return t[0]}static sort(e,t){const n=e=>"root"===e.name||e.tags.includes("root"),i=Boolean([...e._particle.spec.slotConnections.values()].find(e=>n(e)));if(i!==Boolean([...t._particle.spec.slotConnections.values()].find(e=>n(e))))return i?-1:1;if(e._rank!==t._rank)return t._rank-e._rank;let r=0,s=0;return e._particle.spec.slotConnections.forEach(e=>{e.isSet||++r}),t._particle.spec.slotConnections.forEach(e=>{e.isSet||++s}),s-r}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class F{constructor(e={},t,n=[]){this.storeDescById=e,this.arcRecipes=t,this.particleDescriptions=n}static async createForPlan(e){const t=await F.initDescriptionHandles(e.particles);return new F({},[{patterns:e.patterns,particles:e.particles}],t)}static async create(e,t){const n=[].concat(...e.allDescendingArcs.map(e=>e.activeRecipe.particles)),i=await F.initDescriptionHandles(n,e,t),r={};for(const{id:t}of e.activeRecipe.handles){const n=e.findStoreById(t);n&&n instanceof A.c&&(r[t]=e.getStoreDescription(n))}return new F(r,e.recipeDeltas,i)}getArcDescription(e=q){const t=[].concat(...this.arcRecipes.map(e=>e.patterns)),n=[].concat(...this.arcRecipes.map(e=>e.particles)),i=new e(this.particleDescriptions,this.storeDescById).getDescription({patterns:t,particles:n});if(i)return i}getRecipeSuggestion(e=q){return new e(this.particleDescriptions,this.storeDescById).getDescription(this.arcRecipes[this.arcRecipes.length-1])}getHandleDescription(e){Object(s.a)(e.connections.length>0,"handle has no connections?");const t=new q(this.particleDescriptions,this.storeDescById);return t.excludeValues=!0,t.getHandleDescription(e)}static async initDescriptionHandles(e,t,n){return await Promise.all(e.map(e=>F._createParticleDescription(e,t,n)))}static async _createParticleDescription(e,t,n){let i={_particle:e,_connections:{}};n&&(i._rank=n.calcParticleRelevance(e));const r=await F._getPatternByNameFromDescriptionHandle(e,t);(i={...i,...r}).pattern=i.pattern||e.spec.pattern;for(const n of Object.values(e.connections)){const s=e.spec.handleConnectionMap.get(n.name),o=r[n.name]||s.pattern,a=t?t.findStoreById(n.handle.id):null;i._connections[n.name]={pattern:o,_handleConn:n,value:await F._prepareStoreValue(a)}}return i}static async _getPatternByNameFromDescriptionHandle(e,t){const n=e.connections.descriptions;if(n&&n.handle&&n.handle.id){const e=t.findStoreById(n.handle.id);if(e){const t={};for(const n of await e.toList())t[n.rawData.key]=n.rawData.value;return t}}return{}}static async _prepareStoreValue(e){if(e)if(e.type instanceof _.c){const t=e,n=await t.toList();if(n&&n.length>0)return{collectionValues:n}}else if(e.type instanceof _.b){const t=e,n=await t.stream(1),{value:i,done:r}=await t.cursorNext(n);if(t.cursorClose(n),!r&&i[0].rawData.name)return{bigCollectionValues:i[0]}}else if(e.type instanceof _.d){const t=e,n=await t.get();if(n&&n.rawData)return{entityValue:n.rawData,valueDescription:e.type.entitySchema.description.value}}else if(e.type instanceof _.f){const t=e,n=await t.get();if(n)return{interfaceValue:n}}}}var H=n(14);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class L{constructor(e,t,n){this._channel=e,this._id=t,this._other=n,this._onmessage=void 0}async postMessage(e){await this._channel._post(this._other,e)}set onmessage(e){this._onmessage=e}close(){this.postMessage=(async()=>{})}}class B{constructor(e){this.data=e}}class z{constructor(){this.port1=new L(this,0,1),this.port2=new L(this,1,0),this._ports=[this.port1,this.port2]}async _post(e,t){if(t=JSON.parse(JSON.stringify(t)),this._ports[e]._onmessage)try{await 0,await this._ports[e]._onmessage(new B(t))}catch(e){console.error("Exception in particle code\n",e)}}}var W=n(11);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
var U,V=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},K=function(e,t){return function(n,i){t(n,i,e)}};!function(e){e[e.Mapped=0]="Mapped",e[e.LocalMapped=1]="LocalMapped",e[e.RemoteMapped=2]="RemoteMapped",e[e.Direct=3]="Direct",e[e.ObjectMap=4]="ObjectMap",e[e.List=5]="List",e[e.ByLiteral=6]="ByLiteral"}(U||(U={}));const J=new Map;function G(e,t){let n=J.get(e);null==n&&(n=new Map,J.set(e,n));let i=n.get(t);return null==i&&(i=[],n.set(t,i)),i}function Z(e,t,n){const i=J.get(e);if(i){const e=i.get(t);if(e){const t=e[n];if(t)return t}}throw new Error(`the target ${e}, propertyKey ${t} and parameterIndex ${n} provided did not exist`)}function Q(e,t,n,i){G(e,t)[n]=i}function Y(e,t,n){Q(e.constructor,t,n,{type:U.Direct})}function X(e,t,n){Q(e.constructor,t,n,{type:U.Mapped})}function ee(e){return(t,n,i)=>{const r={type:U.ByLiteral,converter:e};Q(t.constructor,n,i,r)}}function te(e,t){return(n,i,r)=>{const s={type:U.ObjectMap,key:{type:e},value:{type:t}};Q(n.constructor,i,r,s)}}function ne(e,t,n){Q(e.constructor,t,n,{type:U.LocalMapped})}function ie(e,t,n){Q(e.constructor,t,n,{type:U.RemoteMapped})}function re(e,t){G(e.constructor,t)}function se(e,t,n){Q(e.constructor,t,n,{type:U.Direct,initializer:!0})}function oe(e,t,n){Z(e.constructor,t,n).identifier=!0}function ae(e,t,n){Z(e.constructor,t,n).ignore=!0}class ce{constructor(e){this._prefix=e,this._nextIdentifier=0,this._idMap=new Map,this._reverseIdMap=new Map}_newIdentifier(){return this._prefix+this._nextIdentifier++}createMappingForThing(e,t){let n;return Object(s.a)(!this._reverseIdMap.has(e)),n=t||(e.apiChannelMappingId?e.apiChannelMappingId:this._newIdentifier()),Object(s.a)(!this._idMap.has(n),`${t?"requestedId":e.apiChannelMappingId?"apiChannelMappingId":"newIdentifier()"} ${n} already in use`),this.establishThingMapping(n,e),n}maybeCreateMappingForThing(e){return this.hasMappingForThing(e)?this.identifierForThing(e):this.createMappingForThing(e)}async establishThingMapping(e,t){let n;Array.isArray(t)&&([t,n]=t),this._idMap.set(e,t),t instanceof Promise?(Object(s.a)(null==n),await this.establishThingMapping(e,await t)):(this._reverseIdMap.set(t,e),n&&await n())}hasMappingForThing(e){return this._reverseIdMap.has(e)}identifierForThing(e){return Object(s.a)(this._reverseIdMap.has(e),`Missing thing [${e}]`),this._reverseIdMap.get(e)}thingForIdentifier(e){return Object(s.a)(this._idMap.has(e),`Missing id: ${e}`),this._idMap.get(e)}}class le{constructor(e,t){this._port=e,this._mapper=new ce(t),this._port.onmessage=(async e=>this._processMessage(e)),this.inspector=null,this.attachStack=!1,this.messageCount=0,this._testingHook()}_testingHook(){}close(){this._port.close()}async _processMessage(e){Object(s.a)(void 0!==this["before"+e.data.messageType]);const t=this.messageCount++;this.inspector&&this.inspector.pecMessage("on"+e.data.messageType,e.data.messageBody,t,e.data.stack),this["before"+e.data.messageType](e.data.messageBody)}send(e,t){const n={messageType:e,messageBody:t,stack:this.attachStack?(new Error).stack:void 0},i=this.messageCount++;this.inspector&&this.inspector.pecMessage(e,t,i,(new Error).stack||""),this._port.postMessage(n)}}function ue(e){return e.toString().match(/.*?\(([^)]*)\)/)[1].split(",").map(e=>e.replace(/\/\*.*\*\//,"").trim()).filter(e=>e)}function he(e,t,n){if(void 0!==e)switch(e.type){case U.Mapped:return n.identifierForThing(t);case U.LocalMapped:return n.maybeCreateMappingForThing(t);case U.RemoteMapped:case U.Direct:return t;case U.ObjectMap:{const i={};return t.forEach((t,r)=>i[he(e.key,r,n)]=he(e.value,t,n)),i}case U.List:return t.map(t=>he(e.value,t,n));case U.ByLiteral:return t.toLiteral();default:throw new Error(`Can't yet send MappingType ${e.type}`)}}function de(e,t,n){if(void 0!==e)switch(e.type){case U.Mapped:return n.thingForIdentifier(t);case U.LocalMapped:return t;case U.RemoteMapped:return n.thingForIdentifier(t);case U.Direct:return t;case U.ObjectMap:{const i=new Map;for(const r of Object.keys(t))i.set(de(e.key,r,n),de(e.value,t[r],n));return i}case U.List:return t.map(t=>de(e.value,t,n));case U.ByLiteral:if(!e.converter)throw new Error(`Expected ${e.type} to have a converter but it doesn't`);return e.converter.fromLiteral(t);default:throw new Error(`Can't yet recieve MappingType ${e.type}`)}}class pe extends le{constructor(e,t){super(e,"o"),this.inspector=t.inspector,this.inspector&&this.inspector.onceActive.then(()=>this.DevToolsConnected(),e=>console.error(e))}Stop(){}DefineHandle(e,t,n){}InstantiateParticle(e,t,n,i){}UIEvent(e,t,n){}SimpleCallback(e,t){}AwaitIdle(e){}StartRender(e,t,n,i){}StopRender(e,t){}GetBackingStoreCallback(e,t,n,i,r,s){}ConstructArcCallback(e,t){}CreateHandleCallback(e,t,n,i,r){}MapHandleCallback(e,t,n){}CreateSlotCallback(e,t,n){}InnerArcRender(e,t,n,i){}DevToolsConnected(){}}var fe;V([re],pe.prototype,"Stop",null),V([K(0,function(e,t,n){Q(e.constructor,t,n,{type:U.Direct,initializer:!0,redundant:!0})}),K(1,ee(_.j)),K(2,Y)],pe.prototype,"DefineHandle",null),V([K(0,se),K(1,oe),K(1,Y),K(2,ee(d.a)),K(3,te(U.Direct,U.Mapped))],pe.prototype,"InstantiateParticle",null),V([K(0,X),K(1,Y),K(2,Y)],pe.prototype,"UIEvent",null),V([K(0,ie),K(1,Y)],pe.prototype,"SimpleCallback",null),V([K(0,Y)],pe.prototype,"AwaitIdle",null),V([K(0,X),K(1,Y),K(2,te(U.Direct,U.Direct)),K(3,(fe=U.Direct,(e,t,n)=>{const i={type:U.List,value:{type:fe}};Q(e.constructor,t,n,i)}))],pe.prototype,"StartRender",null),V([K(0,X),K(1,Y)],pe.prototype,"StopRender",null),V([K(0,se),K(1,ie),K(2,ee(_.j)),K(3,Y),K(4,oe),K(4,Y),K(5,Y)],pe.prototype,"GetBackingStoreCallback",null),V([K(0,ie),K(1,ne)],pe.prototype,"ConstructArcCallback",null),V([K(0,se),K(1,ie),K(2,ee(_.j)),K(3,Y),K(4,oe),K(4,Y)],pe.prototype,"CreateHandleCallback",null),V([K(0,ae),K(0,se),K(1,ie),K(2,Y)],pe.prototype,"MapHandleCallback",null),V([K(0,ae),K(0,se),K(1,ie),K(2,Y)],pe.prototype,"CreateSlotCallback",null),V([K(0,X),K(1,Y),K(2,Y),K(3,Y)],pe.prototype,"InnerArcRender",null),V([re],pe.prototype,"DevToolsConnected",null);let me=class extends le{constructor(e){super(e,"i")}Render(e,t,n){}InitializeProxy(e,t){}SynchronizeProxy(e,t){}HandleGet(e,t){}HandleToList(e,t){}HandleSet(e,t,n,i){}HandleClear(e,t,n){}HandleStore(e,t,n,i){}HandleRemove(e,t,n,i){}HandleRemoveMultiple(e,t,n,i){}HandleStream(e,t,n,i){}StreamCursorNext(e,t,n){}StreamCursorClose(e,t){}Idle(e,t){}GetBackingStore(e,t,n){}ConstructInnerArc(e,t){}ArcCreateHandle(e,t,n,i){}ArcMapHandle(e,t,n){}ServiceRequest(e,t,n){}ArcCreateSlot(e,t,n,i,r){}ArcLoadRecipe(e,t,n){}ReportExceptionInHost(e){}onDevToolsConnected(){this.attachStack=!0}};var ge;V([K(0,X),K(1,Y),K(2,Y)],me.prototype,"Render",null),V([K(0,X),K(1,ne)],me.prototype,"InitializeProxy",null),V([K(0,X),K(1,ne)],me.prototype,"SynchronizeProxy",null),V([K(0,X),K(1,ne)],me.prototype,"HandleGet",null),V([K(0,X),K(1,ne)],me.prototype,"HandleToList",null),V([K(0,X),K(1,Y),K(2,Y),K(3,Y)],me.prototype,"HandleSet",null),V([K(0,X),K(1,Y),K(2,Y)],me.prototype,"HandleClear",null),V([K(0,X),K(1,ne),K(2,Y),K(3,Y)],me.prototype,"HandleStore",null),V([K(0,X),K(1,ne),K(2,Y),K(3,Y)],me.prototype,"HandleRemove",null),V([K(0,X),K(1,ne),K(2,Y),K(3,Y)],me.prototype,"HandleRemoveMultiple",null),V([K(0,X),K(1,ne),K(2,Y),K(3,Y)],me.prototype,"HandleStream",null),V([K(0,X),K(1,ne),K(2,Y)],me.prototype,"StreamCursorNext",null),V([K(0,X),K(1,Y)],me.prototype,"StreamCursorClose",null),V([K(0,Y),K(1,te(U.Mapped,U.Direct))],me.prototype,"Idle",null),V([K(0,ne),K(1,Y),K(2,ee(_.j))],me.prototype,"GetBackingStore",null),V([K(0,ne),K(1,X)],me.prototype,"ConstructInnerArc",null),V([K(0,ne),K(1,ie),K(2,ee(_.j)),K(3,Y)],me.prototype,"ArcCreateHandle",null),V([K(0,ne),K(1,ie),K(2,X)],me.prototype,"ArcMapHandle",null),V([K(0,X),K(1,Y),K(2,ne)],me.prototype,"ServiceRequest",null),V([K(0,ne),K(1,ie),K(2,X),K(3,Y),K(4,Y)],me.prototype,"ArcCreateSlot",null),V([K(0,ie),K(1,Y),K(2,ne)],me.prototype,"ArcLoadRecipe",null),V([K(0,ee(W.a))],me.prototype,"ReportExceptionInHost",null),me=V([(ge=pe,e=>{const t=(e,t)=>{const n=J.get(e)||new Map;for(const i of n.keys()){const r=ue(e.prototype[i]),o=n.get(i)||[],a=o.findIndex(e=>e.initializer||!1),c=o.findIndex(e=>e.identifier||!1),l=function(...e){const t={};for(let n=0;n<o.length;n++)n!==a&&(t[r[n]]=he(o[n],e[n],this._mapper));-1!==a&&(o[a].redundant?(Object(s.a)(-1===c),t.identifier=this._mapper.maybeCreateMappingForThing(e[a])):t.identifier=this._mapper.createMappingForThing(e[a],e[c])),this.send(i,t)},u=async function(e){const t=[],n=[];for(let i=0;i<o.length;i++){if(i===a&&(-1!==c||o[i].ignore))continue;const s=i===a?"identifier":r[i],l=de(o[i],e[s],this._mapper);l instanceof Promise?(n.push({promise:l,position:t.length}),t.push(()=>de(o[i],e[s],this._mapper))):t.push(l)}n.length>0&&(await Promise.all(n.map(async e=>e.promise)),n.forEach(e=>{t[e.position]=t[e.position]()}));const l=this["on"+i](...t);a>-1&&(Object(s.a)(e.identifier),await this._mapper.establishThingMapping(e.identifier,l))};Object.defineProperty(e.prototype,i,{get:()=>l}),Object.defineProperty(t.prototype,"before"+i,{get:()=>u})}};t(e,ge),t(ge,e)})],me);var ye=n(3);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class ve{constructor(e,t,n,i){this.handlers=new Map,this.requestedContentTypes=new Set,this._isRendered=!1,this.apiPort=e,this.slotName=n,this.particle=t,this.providedSlots=i}get isRendered(){return this._isRendered}render(e){this.apiPort.Render(this.particle,this.slotName,e),Object.keys(e).forEach(e=>{this.requestedContentTypes.delete(e)}),this._isRendered=0===this.requestedContentTypes.size&&Object.keys(e).length>0}registerEventHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}clearEventHandlers(e){this.handlers.set(e,[])}fireEvent(e){for(const t of this.handlers.get(e.handler)||[])t(e)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const be=(e,t)=>t([e]);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var _e;!function(e){e[e.none=0]="none",e[e.pending=1]="pending",e[e.full=2]="full"}(_e||(_e={}));class we{constructor(e,t,n,i,r,s){this.version=void 0,this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=_e.none,this.observers=[],this.updates=[],this.barrier=null,this.id=e,this.type=t,this.port=n,this.scheduler=r,this.name=s,this.updates=[],this.pec=i}static newProxy(e,t,n,i,r,s){return t instanceof _.c?new Se(e,t,n,i,r,s):t instanceof _.b?new Te(e,t,n,i,r,s):new Ce(e,t,n,i,r,s)}reportExceptionInHost(e){be?be(e.cause.stack,t=>{e.cause.stack=t,this.port.ReportExceptionInHost(e)}):this.port.ReportExceptionInHost(e)}register(e,t){if(t.canRead&&(this.observers.push({particle:e,handle:t}),this.listenerAttached||(this.port.InitializeProxy(this,e=>this._onUpdate(e)),this.listenerAttached=!0),t.options.keepSynced&&(this.keepSynced||(this.port.SynchronizeProxy(this,e=>this._onSynchronize(e)),this.keepSynced=!0),t.options.notifySync&&this.synchronized===_e.full))){const n=this._getModelForSync();this.scheduler.enqueue(e,t,["sync",e,n])}}_onSynchronize({version:e,model:t}){if(void 0!==this.version&&e<=this.version)return void console.warn(`StorageProxy '${this.id}' received stale model version ${e}; `+`current is ${this.version}`);if(!this._synchronizeModel(e,t))return;for(this.synchronized=_e.full;this.updates.length>0&&this.updates[0].version<=e;)this.updates.shift();const n=this._getModelForSync();this._notify("sync",n,e=>e.keepSynced&&e.notifySync),this._processUpdates()}_onUpdate(e){if(this.observers.find(({handle:e})=>!e.options.keepSynced&&e.options.notifyUpdate)){const t=this._processUpdate(e,!1);this._notify("update",t,e=>!e.keepSynced&&e.notifyUpdate)}this.keepSynced&&(e.version<=this.version?console.warn(`StorageProxy '${this.id}' received stale update version ${e.version}; `+`current is ${this.version}`):(this.updates.push(e),this.updates.sort((e,t)=>e.version-t.version),this._processUpdates()))}_notify(e,t,n=(e=>!0)){for(const{handle:i,particle:r}of this.observers)n(i.options)&&this.scheduler.enqueue(r,i,[e,r,t])}_processUpdates(){const e=e=>e.version===this.version+1||!(!this.barrier||e.barrier!==this.barrier);for(;this.updates.length>0&&e(this.updates[0]);){const e=this.updates.shift(),t=this._processUpdate(e);this.version=e.version,t&&this._notify("update",t,e=>e.keepSynced&&e.notifyUpdate)}if(this.updates.length>0){if(this.synchronized!==_e.none){this.synchronized=_e.none,this.port.SynchronizeProxy(this,e=>this._onSynchronize(e));for(const{handle:e,particle:t}of this.observers)e.options.notifyDesync&&this.scheduler.enqueue(t,e,["desync",t,{}])}}else this.synchronized!==_e.full&&(this.synchronized=_e.full)}generateBarrier(){return this.pec.idGenerator.newChildId(l.b.fromString(this.id),"barrier").toString()}}class Se extends we{constructor(){super(...arguments),this.model=new I}_getModelForSync(){return this.model.toList()}_synchronizeModel(e,t){return this.version=e,this.model=new I(t),!0}_processUpdate(e,t=!0){if(this.synchronized===_e.full)for(const{handle:t}of this.observers)if(e.originatorId===t._particleId)return null;const n=[],i=[];if("add"in e)for(const{value:i,keys:r,effective:s}of e.add)(t&&this.model.add(i.id,i,r)||!t&&s)&&n.push(i);else{if(!("remove"in e))throw new Error(`StorageProxy received invalid update event: ${JSON.stringify(e)}`);for(const{value:n,keys:r,effective:s}of e.remove){const e=this.model.getValue(n.id);(t&&this.model.remove(n.id,r)||!t&&s)&&i.push(e)}}if(n.length||i.length){const t={originatorId:e.originatorId};return n.length&&(t.add=n),i.length&&(t.remove=i),t}return null}async toList(){return this.synchronized===_e.full?Promise.resolve(this.model.toList()):new Promise(e=>this.port.HandleToList(this,e))}async get(e){return this.synchronized===_e.full?Promise.resolve(this.model.getValue(e)):new Promise((t,n)=>this.port.HandleToList(this,n=>t(n.find(t=>t.id===e))))}async store(e,t,n){const i=e.id,r={value:e,keys:t};if(this.port.HandleStore(this,()=>{},r,n),this.synchronized!==_e.full)return Promise.resolve();if(!this.model.add(i,e,t))return Promise.resolve();const s={originatorId:n,add:[e]};return this._notify("update",s,e=>e.notifyUpdate),Promise.resolve()}async clear(e){this.synchronized!==_e.full&&this.port.HandleRemoveMultiple(this,()=>{},[],e);let t=this.model.toList().map(e=>({id:e.id,keys:this.model.getKeys(e.id)}));return this.port.HandleRemoveMultiple(this,()=>{},t,e),(t=(t=t.map(({id:e,keys:t})=>({rawData:this.model.getValue(e).rawData,id:e,keys:t}))).filter(e=>this.model.remove(e.id,e.keys))).length>0&&this._notify("update",{originatorId:e,remove:t},e=>e.notifyUpdate),Promise.resolve()}async remove(e,t,n){if(this.synchronized!==_e.full){const t={id:e,keys:[]};return this.port.HandleRemove(this,()=>{},t,n),Promise.resolve()}const i=this.model.getValue(e);if(!i)return Promise.resolve();0===t.length&&(t=this.model.getKeys(e));const r={id:e,keys:t};if(this.port.HandleRemove(this,()=>{},r,n),!this.model.remove(e,t))return Promise.resolve();const s={originatorId:n,remove:[i]};return this._notify("update",s,e=>e.notifyUpdate),Promise.resolve()}}class Ce extends we{constructor(){super(...arguments),this.model=null}_getModelForSync(){return this.model}_synchronizeModel(e,t){return null==this.barrier&&(this.version=e,this.model=0===t.length?null:t[0].value,Object(s.a)(void 0!==this.model),!0)}_processUpdate(e,t=!0){if(Object(s.a)("data"in e),!t)return e;if(null!=this.barrier){if(e.barrier===this.barrier&&(this.barrier=null,this.synchronized!==_e.full)){this.synchronized=_e.full;const e=this._getModelForSync();this._notify("sync",e,e=>e.keepSynced&&e.notifySync)}return null}const n=this.model;return this.model=e.data,{...e,oldData:n}}async get(){return this.synchronized===_e.full?Promise.resolve(this.model):new Promise(e=>this.port.HandleGet(this,e))}async set(e,t){if(Object(s.a)(void 0!==e),JSON.stringify(this.model)===JSON.stringify(e))return Promise.resolve();let n;n=this.listenerAttached?this.generateBarrier():null;const i=this.model;this.model=JSON.parse(JSON.stringify(e)),this.barrier=n,this.port.HandleSet(this,e,t,n);const r={originatorId:t,data:e,oldData:i};return this._notify("update",r,e=>e.notifyUpdate),Promise.resolve()}async clear(e){if(null==this.model)return Promise.resolve();const t=this.generateBarrier(),n=this.model;this.model=null,this.barrier=t,this.port.HandleClear(this,e,t);const i={originatorId:e,data:null,oldData:n};return this._notify("update",i,e=>e.notifyUpdate),Promise.resolve()}}class Te extends we{register(e,t){t.canRead&&this.scheduler.enqueue(e,t,["sync",e,{}])}_getModelForSync(){throw new Error("_getModelForSync not implemented for BigCollectionProxy")}_processUpdate(){throw new Error("_processUpdate not implemented for BigCollectionProxy")}_synchronizeModel(){throw new Error("_synchronizeModel not implemented for BigCollectionProxy")}async get(e){throw new Error("unimplemented")}async store(e,t,n){return new Promise(i=>this.port.HandleStore(this,i,{value:e,keys:t},n))}async remove(e,t,n){return new Promise(t=>this.port.HandleRemove(this,t,{id:e,keys:[]},n))}async stream(e,t){return new Promise(n=>this.port.HandleStream(this,n,e,t))}async cursorNext(e){return new Promise(t=>this.port.StreamCursorNext(this,t,e))}async cursorClose(e){return this.port.StreamCursorClose(this,e),Promise.resolve()}}class ke{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(e,t,n){this._queues.has(e)||this._queues.set(e,new Map);const i=this._queues.get(e);i.has(t)||i.set(t,[]),i.get(t).push(n),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(e=>this._idleResolver=e)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const e=[...this._queues.keys()][0],t=this._queues.get(e);this._queues.delete(e);for(const[e,n]of t.entries())for(const t of n)try{e._notify(...t)}catch(t){console.error("Error dispatching to particle",t),e.storage.reportExceptionInHost(new W.b(t,e._particleId,"StorageProxyScheduler::_dispatch"))}}this._updateIdle()}}var Re,xe=n(4),Ee=n(19);
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Oe{constructor(e){this.encoder=new je,this.decoder=new Me,Object(s.a)(e.names.length>0,"At least one schema name is required for entity packaging"),this.schema=e}encodeSingleton(e){return this.encoder.encodeSingleton(this.schema,e)}encodeCollection(e){return this.encoder.encodeCollection(this.schema,e)}decodeSingleton(e){const{id:t,data:n}=this.decoder.decodeSingleton(e),i=new(this.schema.entityClass())(n);return xe.a.identify(i,t),i}}class je{encodeSingleton(e,t){const n=xe.a.id(t);let i=n.length+":"+n+"|";for(const[n,r]of Object.entries(t))i+=this.encodeField(e.fields[n],n,r);return i}encodeCollection(e,t){let n=t.length+":";for(const i of t){const t=this.encodeSingleton(e,i);n+=t.length+":"+t}return n}encodeField(e,t,n){switch(e.kind){case"schema-primitive":return t+":"+e.type.substr(0,1)+this.encodeValue(e.type,n)+"|";case"schema-collection":case"schema-union":case"schema-tuple":case"schema-reference":throw new Error(`'${e.kind}' not yet supported for entity packaging`);default:throw new Error(`Unknown field kind '${e.kind}' in schema`)}}encodeValue(e,t){switch(e){case"Text":case"URL":return t.length+":"+t;case"Number":return t+":";case"Boolean":return t?"1":"0";case"Bytes":case"Object":throw new Error(`'${e}' not yet supported for entity packaging`);default:throw new Error(`Unknown primitive value type '${e}' in schema`)}}}class Me{decodeSingleton(e){this.str=e;const t=Number(this.upTo(":")),n=this.chomp(t);this.validate("|");const i={};for(;this.str.length>0;){const e=this.upTo(":"),t=this.chomp(1);i[e]=this.decodeValue(t),this.validate("|")}return{id:n,data:i}}upTo(e){const t=this.str.indexOf(e);if(t<0)throw new Error(`Packaged entity decoding fail: expected '${e}' separator in '${this.str}'`);const n=this.str.slice(0,t);return this.str=this.str.slice(t+1),n}chomp(e){if(e>this.str.length)throw new Error(`Packaged entity decoding fail: expected '${e}' chars to remain in '${this.str}'`);const t=this.str.slice(0,e);return this.str=this.str.slice(e),t}validate(e){if(this.chomp(e.length)!==e)throw new Error(`Packaged entity decoding fail: expected '${e}' at start of '${this.str}'`)}decodeValue(e){switch(e){case"T":case"U":{const e=Number(this.upTo(":"));return this.chomp(e)}case"N":return Number(this.upTo(":"));case"B":return Boolean("1"===this.chomp(1));default:throw new Error(`Packaged entity decoding fail: unknown or unsupported primitive value type '${e}'`)}}}class $e{constructor(e){const t=new Uint8Array(e),n=[];let i=0;for(;i<t.byteLength;){let e=0,r=0;for(;;){const n=t[i++];if(e|=(127&n)<<r,!(128&n))break;r+=7}n.push(e)}if(10!==n.length)throw new Error("emscripten metadata section should have 10 values; "+`got ${n.length}`);if(0!==n[0]||1!==n[1])throw new Error("emscripten metadata version should be 0.1; "+`got ${n[0]}.${n[1]}`);if(0!==n[2]||3!==n[3])throw new Error("emscripten ABI version should be 0.3; "+`got ${n[2]}.${n[3]}`);this.cfg={memSize:n[4],tableSize:n[5],globalBase:n[6],dynamicBase:n[7],dynamictopPtr:n[8]}}configureEnvironment(e,t,n){t.memory=new WebAssembly.Memory({initial:this.cfg.memSize,maximum:this.cfg.memSize}),t.heapU8=new Uint8Array(t.memory.buffer),t.heap32=new Int32Array(t.memory.buffer),t.heap32[this.cfg.dynamictopPtr>>2]=this.cfg.dynamicBase,Object.assign(n,{memory:t.memory,__memory_base:this.cfg.globalBase,table:new WebAssembly.Table({initial:this.cfg.tableSize,maximum:this.cfg.tableSize,element:"anyfunc"}),__table_base:0,DYNAMICTOP_PTR:this.cfg.dynamictopPtr,_emscripten_get_heap_size:()=>t.heapU8.length,_emscripten_resize_heap:e=>!1,_emscripten_memcpy_big:(e,n,i)=>t.heapU8.set(t.heapU8.subarray(n,n+i),e),_systemError:e=>{throw new Error(t.read(e))},abortOnCannotGrowMemory:e=>{throw new Error(`abortOnCannotGrowMemory(${e})`)},_setLogInfo:(e,n)=>t.logInfo=[t.read(e),n],___syscall146:(e,n)=>t.sysWritev(e,n)})}initializeInstance(e,t){}}class Pe{configureEnvironment(e,t,n){Object.assign(n,{Konan_js_arg_size:e=>1,Konan_js_fetch_arg:(e,t)=>"dummyArg",Konan_js_allocateArena:e=>{},Konan_js_freeArena:e=>{},write:e=>console.log(t.read(e)),flush:()=>{},Konan_notify_memory_grow:()=>t.heapU8=new Uint8Array(t.exports.memory.buffer),Konan_abort:e=>{throw new Error("Konan_abort("+t.read(e)+")")},Konan_exit:e=>{},Konan_date_now:e=>{const n=Date.now(),i=Math.floor(n/4294967295),r=Math.floor(n%4294967295);t.heap32[e]=r,t.heap32[e+1]=i}})}initializeInstance(e,t){e.memory=e.exports.memory,e.heapU8=new Uint8Array(e.memory.buffer),e.heap32=new Int32Array(e.memory.buffer),t.exports.Konan_js_main(1,0)}}class Ne extends Ee.a{constructor(){super(...arguments),this.handleMap=new Map,this.revHandleMap=new Map,this.converters=new Map,this.logInfo=null}driverForModule(e){const t=WebAssembly.Module.customSections(e,"emscripten_metadata");return 1===t.length?new $e(t[0]):new Pe}async initialize(e){Object(s.a)(this.spec.name.length>0);const t=await WebAssembly.compile(e),n=this.driverForModule(t),i={abort:()=>{throw new Error("Abort!")},_singletonSet:async(e,t)=>this.singletonSet(e,t),_singletonClear:async e=>this.singletonClear(e),_collectionStore:async(e,t)=>this.collectionStore(e,t),_collectionRemove:async(e,t)=>this.collectionRemove(e,t),_collectionClear:async e=>this.collectionClear(e),_render:(e,t)=>this.renderImpl(e,t)};n.configureEnvironment(t,this,i);const r={NaN:NaN,Infinity:1/0};this.wasm=await WebAssembly.instantiate(t,{env:i,global:r}),this.exports=this.wasm.exports,n.initializeInstance(this,this.wasm),this.innerParticle=this.exports[`_new${this.spec.name}`]()}async setHandles(e){for(const[t,n]of e){const e=this.store(t),i=this.exports._connectHandle(this.innerParticle,e,n.canRead);if(this.exports._free(e),0===i)throw new Error(`Wasm particle failed to connect handle '${t}'`);this.handleMap.set(n,i),this.revHandleMap.set(i,n),this.converters.set(n,new Oe(n.entityClass.schema))}}async onHandleSync(e,t){const n=this.handleMap.get(e);if(!t)return void this.exports._syncHandle(this.innerParticle,n,0);const i=this.converters.get(e);if(!i)throw new Error("cannot find handle "+e.name);let r;r=e instanceof ye.c?i.encodeSingleton(t):i.encodeCollection(t);const s=this.store(r);this.exports._syncHandle(this.innerParticle,n,s),this.exports._free(s)}async onHandleUpdate(e,t){if(t.originator)return;const n=this.handleMap.get(e),i=this.converters.get(e);if(!i)throw new Error("cannot find handle "+e.name);let r=0,s=0;e instanceof ye.c?t.data&&(r=this.store(i.encodeSingleton(t.data))):(r=this.store(i.encodeCollection(t.added||[])),s=this.store(i.encodeCollection(t.removed||[]))),this.exports._updateHandle(this.innerParticle,n,r,s),r&&this.exports._free(r),s&&this.exports._free(s)}async onHandleDesync(e){}async singletonSet(e,t){const n=this.getHandle(e);await n.set(this.decodeEntity(n,t))}async singletonClear(e){const t=this.getHandle(e);await t.clear()}async collectionStore(e,t){const n=this.getHandle(e);await n.store(this.decodeEntity(n,t))}async collectionRemove(e,t){const n=this.getHandle(e);await n.remove(this.decodeEntity(n,t))}async collectionClear(e){const t=this.getHandle(e);await t.clear()}getHandle(e){const t=this.revHandleMap.get(e);if(!t)throw new Error(`wasm particle '${this.spec.name}' attempted to write to unconnected handle`);return t}decodeEntity(e,t){return this.converters.get(e).decodeSingleton(this.read(t))}renderSlot(e,t){const n=this.store(e);this.exports._requestRender(this.innerParticle,n),this.exports._free(n)}renderHostedSlot(e,t,n){}renderImpl(e,t){const n=this.slotProxiesByName.get(this.read(e));n&&(["template","model"].forEach(e=>n.requestedContentTypes.add(e)),n.render({template:this.read(t),model:{},templateName:"default"}))}fireEvent(e,t){const n=this.store(e),i=this.store(t.handler);this.exports._fireEvent(this.innerParticle,n,i),this.exports._free(n),this.exports._free(i)}store(e){const t=this.exports._malloc(e.length+1);for(let n=0;n<e.length;n++)this.heapU8[t+n]=e.charCodeAt(n);return this.heapU8[t+e.length]=0,t}read(e){let t="";for(;e<this.heapU8.length&&0!==this.heapU8[e];)t+=String.fromCharCode(this.heapU8[e++]);return t}sysWritev(e,t){const n=()=>(t+=4,this.heap32[t-4>>2]),i=1===n()?console.log:console.error,r=n(),s=n();let o=this.logInfo?`[${this.spec.name}|${this.logInfo[0]}:${this.logInfo[1]}] `:"",a=0;for(let e=0;e<s;e++){const t=this.heap32[r+8*e>>2],n=this.heap32[r+(8*e+4)>>2];for(let e=0;e<n;e++){const n=this.heapU8[t+e];0===n||10===n?(i(o),o=""):o+=String.fromCharCode(n)}a+=n}return this.logInfo=null,a}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ie{constructor(e,t,n,i){this.particles=[],this.pendingLoads=[],this.scheduler=new ke,this.keyedProxies={};const r=this;this.apiPort=new class extends me{onDefineHandle(e,t,n){return we.newProxy(e,t,this,r,r.scheduler,n)}onGetBackingStoreCallback(e,t,n,i,s){const o=we.newProxy(i,t,this,r,r.scheduler,n);return o.storageKey=s,[o,()=>e(o,s)]}onCreateHandleCallback(e,t,n,i){const s=we.newProxy(i,t,this,r,r.scheduler,n);return[s,()=>e(s)]}onMapHandleCallback(e,t){return[t,()=>e(t)]}onCreateSlotCallback(e,t){return[t,()=>e(t)]}onInnerArcRender(e,t,n,i){e.renderHostedSlot(t,n,i)}onStop(){global.close&&global.close()}async onInstantiateParticle(e,t,n){return r.instantiateParticle(e,t,n)}onSimpleCallback(e,t){e(t)}onConstructArcCallback(e,t){e(t)}onAwaitIdle(e){r.idle.then(t=>{setTimeout(()=>this.Idle(e,r.relevance),0)})}onUIEvent(e,t,n){e.fireEvent(t,n)}onStartRender(e,t,n,i){e.addSlotProxy(new ve(this,e,t,n)),e.renderSlot(t,i)}onStopRender(e,t){Object(s.a)(e.hasSlotProxy(t),`Stop render called for particle ${e.spec.name} slot ${t} without start render being called.`),e.removeSlotProxy(t)}}(e),this.pecId=t,this.idGenerator=n,this.loader=i,i.setParticleExecutionContext(this)}generateID(){return this.idGenerator.newChildId(this.pecId).toString()}innerArcHandle(e,t){const n=this;return{createHandle:async(i,r,s)=>new Promise((o,a)=>n.apiPort.ArcCreateHandle(e=>{const i=Object(ye.d)(e,n.idGenerator,r,t);o(i),s&&e.register(s,i)},e,i,r)),mapHandle:async t=>new Promise((i,r)=>n.apiPort.ArcMapHandle(e=>{i(e)},e,t)),createSlot:async(t,i,r)=>new Promise((s,o)=>n.apiPort.ArcCreateSlot(e=>s(e),e,t,i,r)),loadRecipe:async t=>new Promise((i,r)=>n.apiPort.ArcLoadRecipe(e,t,e=>{e.error?r(e.error):i(e)}))}}getStorageProxy(e,t){return this.keyedProxies[e]||(this.keyedProxies[e]=new Promise((n,i)=>{this.apiPort.GetBackingStore((e,t)=>{this.keyedProxies[t]=e,n(e)},e,t)})),this.keyedProxies[e]}defaultCapabilitySet(){return{constructInnerArc:async e=>new Promise((t,n)=>this.apiPort.ConstructInnerArc(n=>t(this.innerArcHandle(n,e.id)),e)),serviceRequest:(e,t,n)=>{this.apiPort.ServiceRequest(e,t,n)}}}async instantiateParticle(e,t,n){let i;const r=new Promise(e=>i=e);let s;if(this.pendingLoads.push(r),t.implFile&&t.implFile.endsWith(".wasm"))(s=await this.loadWasmParticle(t)).setCapabilities({});else{const e=await this.loader.loadParticleClass(t);(s=new e).setCapabilities(this.defaultCapabilitySet())}this.particles.push(s);const o=new Map,a=[];return n.forEach((n,i)=>{const r=t.handleConnectionMap.get(i),c=Object(ye.d)(n,this.idGenerator,i,e,r.isInput,r.isOutput);o.set(i,c),a.push({proxy:n,particle:s,handle:c})}),[s,async()=>{await s.callSetHandles(o,n=>{const i=new W.c(n,"setHandles",e,t.name);this.apiPort.ReportExceptionInHost(i)}),a.forEach(({proxy:e,particle:t,handle:n})=>e.register(t,n));const n=this.pendingLoads.indexOf(r);this.pendingLoads.splice(n,1),i()}]}async loadWasmParticle(e){const t=await this.loader.loadBinary(e.implFile);Object(s.a)(t&&t.byteLength>0),Ne.spec=e;const n=new Ne;return await n.initialize(t),Ne.spec=null,n}get relevance(){const e=new Map;return this.particles.forEach(t=>{0!==t.relevances.length&&(e.set(t,t.relevances),t.relevances.length=0)}),e}get busy(){return!!(this.pendingLoads.length>0||this.scheduler.busy)||this.particles.filter(e=>e.busy).length>0}get idle(){if(!this.busy)return Promise.resolve();const e=this.particles.filter(async e=>e.busy).map(async e=>e.idle);return Promise.all([this.scheduler.idle,...this.pendingLoads,...e]).then(()=>this.idle)}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class De extends H.a{constructor(e){super(),this._fileMap=e,e.hasOwnProperty("*")&&(this._cannedResponse=e["*"])}loadResource(e){return this._fileMap.hasOwnProperty(e)?this._fileMap[e]:this._cannedResponse||super.loadResource(e)}path(e){return this._fileMap.hasOwnProperty(e)||this._cannedResponse?e:super.path(e)}join(e,t){return this._fileMap.hasOwnProperty(e)||this._cannedResponse?t:super.join(e,t)}clone(){return new De(this._fileMap)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e.Permuted="permuted",e.Independent="independent"}(Re||(Re={}));class Ae{constructor(e,t){this._arc=e,this._args=t}get arc(){return this._arc}getResults(e){return e.generated}async generate(e){return[]}}class qe{constructor(e){this.descendants=[],Object(s.a)(e),this.tactic=e}onAction(e){this.currentAction=e}onResult(e){this.currentResult=e,this.updateList=[]}onResultDone(){this.runUpdateList(this.currentResult.result,this.updateList),this.currentResult=void 0,this.updateList=void 0}onActionDone(){this.currentAction=void 0}static walk(e,t,n){return t.onAction(n),e.forEach(e=>{t.onResult(e),t.onResultDone()}),t.onActionDone(),t.descendants}visit(e,...t){const n=e(this.currentResult.result,...t);this.isEmptyResult(n)||this.updateList.push({continuation:n,context:t})}runUpdateList(e,t){const n=[];if(t.length)switch(this.tactic){case Re.Permuted:{let i=[[]];t.forEach(({continuation:e,context:t})=>{const n=[];"function"==typeof e&&(e=[e]),e.forEach(e=>{i.forEach(i=>{const r=i.slice();r.push({continuation:e,context:t}),n.push(r)})}),i=n});for(let t of i){const i=new Map,r=e.clone(i);let s=0;0!==(t=t.filter(e=>null!==e.continuation)).length&&(t.forEach(({continuation:e,context:t})=>{s=e(r,...t.map(e=>i.get(e)||e))}),n.push({result:r,score:s}))}break}case Re.Independent:t.forEach(({continuation:t,context:i})=>{"function"==typeof t&&(t=[t]);let r=0;t.forEach(t=>{null==t&&(t=(()=>0));const s=new Map,o=e.clone(s);r=t(o,...i.map(e=>s.get(e)||e)),n.push({result:o,score:r})})});break;default:throw new Error(`${this.tactic} not supported`)}for(const e of n)this.createDescendant(e.result,e.score)}createWalkerDescendant(e,t,n,i){Object(s.a)(this.currentResult,"no current result"),Object(s.a)(this.currentAction,"no current action"),this.currentResult.score&&(t+=this.currentResult.score),this.descendants.push({result:e,score:t,derivation:[{parent:this.currentResult,strategy:this.currentAction}],hash:n,valid:i})}isEmptyResult(e){return!e||(e.constructor===Array&&e.length<=0||(Object(s.a)("function"==typeof e||e.length),!1))}}qe.Permuted=Re.Permuted,qe.Independent=Re.Independent;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Fe extends qe{onResult(e){super.onResult(e);const t=e.result;if(this.onRecipe&&this.visit(this.onRecipe.bind(this)),this.onParticle)for(const e of t.particles)this.visit(this.onParticle.bind(this),e);if(this.onPotentialHandleConnection)for(const e of t.particles)if(e.spec)for(const t of e.spec.handleConnectionMap.values())e.connections[t.name]||this.visit(this.onPotentialHandleConnection.bind(this),e,t);if(this.onHandleConnection)for(const e of t.handleConnections)this.visit(this.onHandleConnection.bind(this),e);if(this.onHandle)for(const e of t.handles)this.visit(this.onHandle.bind(this),e);if(this.onPotentialSlotConnection)for(const e of t.particles)for(const[t,n]of e.getSlotSpecs())e.getSlotConnectionByName(t)||this.visit(this.onPotentialSlotConnection.bind(this),e,n);if(this.onSlotConnection)for(const e of t.slotConnections)this.visit(this.onSlotConnection.bind(this),e);if(this.onSlot)for(const e of t.slots)this.visit(this.onSlot.bind(this),e);if(this.onObligation)for(const e of t.obligations)this.visit(this.onObligation.bind(this),e);if(this.onRequiredParticle)for(const e of t.requires)for(const t of e.particles)this.visit(this.onRequiredParticle.bind(this),t)}createDescendant(e,t){const n=e.normalize(),i=n?e.digest():null;super.createWalkerDescendant(e,t,i,n)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class He{static getClonedSlot(e,t){let n=e.updateToClone({selectedSlot:t}).selectedSlot;return n||(t.id&&(n=e.findSlotByID(t.id)),null==n&&((n=e instanceof M?e.parent.newSlot(t.name):e.newSlot(t.name)).id=t.id)),n}static connectSlotConnection(e,t){const n=e.recipe;if(!e.targetSlot){const i=He.getClonedSlot(n,t);e.connectToSlot(i)}Object(s.a)(!t.id||!e.targetSlot.id||t.id===e.targetSlot.id,`Cannot override slot id '${e.targetSlot.id}' with '${t.id}'`),e.targetSlot.id=t.id||e.targetSlot.id,e.targetSlot.tags=[...t.tags]}static findAllSlotCandidates(e,t,n){const i=e.getSlotConnectionByName(t.name);return{local:i&&i.targetSlot?[]:He._findSlotCandidates(e,t,e.recipe.slots),remote:He._findSlotCandidates(e,t,n.pec.slotComposer.getAvailableContexts())}}static _findSlotCandidates(e,t,n){const i=n.filter(n=>this.slotMatches(e,t,n));return i.sort((e,t)=>e.name<t.name),i}static slotMatches(e,t,n){if(!He.specMatch(t,n.spec))return!1;const i=e.getSlotConnectionBySpec(t);return!!He.tagsOrNameMatch(t,n.spec,i,n)&&!!He.handlesMatch(e,n)}static specMatch(e,t){return e&&t&&e.isSet===t.isSet}static handlesMatch(e,t){return 0===t.handles.length||!!Object.values(e.connections).find(e=>t.handles.includes(e.handle)||e.handle&&e.handle.id&&t.handles.map(e=>e.id).includes(e.handle.id))}static tagsOrNameMatch(e,t,n,i){const r=[].concat(e.tags||[],n?n.tags:[],n&&n.targetSlot?n.targetSlot.tags:[]),s=[].concat(t.tags||[],i?i.tags:[],i?i.name:t.name?t.name:[]);return!!(r.length>0&&r.some(e=>s.includes(e)))||e.name===(i?i.name:t.name)}static replaceOldSlot(e,t,n){if(t&&(!t.id||t.id!==n.id)){if(void 0!==t.sourceConnection){if(void 0===n.sourceConnection)return!1;const e=He.getClonedSlot(t.sourceConnection.recipe,n);t.sourceConnection.providedSlots[t.name]=e}for(;t.consumeConnections.length>0;){const e=t.consumeConnections[0];e.disconnectFromSlot(),He.connectSlotConnection(e,n)}}return!0}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Le extends Fe{constructor(e,t){super(e),this.arc=t}onHandle(e,t){const n=this.arc;if(0===t.connections.length||t.id&&t.storageKey||!t.type||!t.fate)return;let i;if(t.id){if(!t.storageKey){let e;switch(t.fate){case"use":e=n.findStoreById(t.id);break;case"map":case"copy":e=n.context.findStoreById(t.id);break;case"create":case"`slot":case"?":break;default:throw new Error(`unexpected fate ${t.fate}`)}i=e?[e]:[]}}else{P.directionCounts(t);switch(t.fate){case"use":i=n.findStoresByType(t.type,{tags:t.tags});break;case"map":case"copy":i=n.context.findStoresByType(t.type,{tags:t.tags,subtype:!0});break;case"create":case"`slot":case"?":i=[];break;default:throw new Error(`unexpected fate ${t.fate}`)}}return 1===(i=i.filter(n=>{for(const i of e.handles)if(n.id===i.id&&i!==t)return!1;return!0})).length?(e,t)=>(t.mapToStorage(i[0]),0):void 0}onSlotConnection(e,t){const n=this.arc;if(t.isConnected())return;const i=t.getSlotSpec(),r=t.particle,{local:s,remote:o}=He.findAllSlotCandidates(r,i,n),a=[...s,...o];if(1!==a.length)return;const c=a[0];return(e,t)=>(He.connectSlotConnection(t,c),1)}onPotentialSlotConnection(e,t,n){const i=this.arc,{local:r,remote:s}=He.findAllSlotCandidates(t,n,i),o=[...r,...s];if(1!==o.length)return;const a=o[0];return(e,t,n)=>{const i=t.addSlotConnection(n.name);return He.connectSlotConnection(i,a),1}}onObligation(e,t){const n=t.from.instance,i=t.to.instance;for(const e of Object.values(n.connections))for(const t of Object.values(i.connections))if(e.handle&&e.handle===t.handle)return(e,t)=>(e.removeObligation(t),1)}}class Be extends Ae{async generate(e){return Le.walk(this.getResults(e),new Le(Le.Permuted,this.arc),this)}}class ze{constructor(e){this.resolver=new Be(e)}async resolve(e){e=e.clone();const t={errors:new Map};if(!e.normalize(t))return console.warn(`could not normalize a recipe: ${[...t.errors.values()].join("\n")}.\n${e.toString()}`),null;const n=await this.resolver.generate({generated:[{result:e,score:1}],terminal:[]});return 0===n.length?null:n[0].result}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class We{static register(e,t){We.registry[e]=t}static async request(e){let{service:t,invoke:n,call:i}=e;i&&([t,n]=i.split("."));const r=We.registry[t];return r&&r[n]?await r[n](e):null}}We.registry={},Object.freeze(We),We.register("test",{classify:async e=>({data:"it's a pig, that don't fly straight"})});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ue{constructor(e,t,n){this.nextIdentifier=0,this.idleVersion=0,this.close=(()=>{e.close(),this._apiPort.close()}),this.arc=n,this.slotComposer=t;const i=this;this._apiPort=new class extends pe{onRender(e,t,n){i.slotComposer&&i.slotComposer.renderSlot(e,t,n)}onInitializeProxy(e,t){e.on("change",e=>this.SimpleCallback(t,e),{})}async onSynchronizeProxy(e,t){const n=await e.modelForSynchronization();this.SimpleCallback(t,n)}async onHandleGet(e,t){const n=await e.get();this.SimpleCallback(t,n)}async onHandleToList(e,t){const n=await e.toList();this.SimpleCallback(t,n)}onHandleSet(e,t,n,i){e.set(t,n,i)}onHandleClear(e,t,n){e.clear(t,n)}async onHandleStore(e,t,n,i){await e.store(n.value,n.keys,i),this.SimpleCallback(t,{})}async onHandleRemove(e,t,n,i){await e.remove(n.id,n.keys,i),this.SimpleCallback(t,{})}async onHandleRemoveMultiple(e,t,n,i){await e.removeMultiple(n,i),this.SimpleCallback(t,{})}async onHandleStream(e,t,n,i){this.SimpleCallback(t,await e.stream(n,i))}async onStreamCursorNext(e,t,n){this.SimpleCallback(t,await e.cursorNext(n))}onStreamCursorClose(e,t){e.cursorClose(t)}onIdle(e,t){e===i.idleVersion&&(i.idlePromise=void 0,i.idleResolve(t))}async onGetBackingStore(e,t,n){t||(t=i.arc.storageProviderFactory.baseStorageKey(n,i.arc.storageKey||"volatile"));const r=await i.arc.storageProviderFactory.baseStorageFor(n,t);this.GetBackingStoreCallback(r,e,n.collectionOf(),n.toString(),`${r.id}:${"String(Math.random())".slice(2,9)}`,t)}onConstructInnerArc(e,t){const n=i.arc.createInnerArc(t);this.ConstructArcCallback(e,n)}async onArcCreateHandle(e,t,n,i){const r=await t.createStore(n,i,null,[],"volatile");this.CreateHandleCallback(r,e,n,i,r.id)}onArcMapHandle(e,t,n){Object(s.a)(i.arc.findStoreById(n.id),`Cannot map nonexistent handle ${n.id}`),this.MapHandleCallback({},e,n.id)}onArcCreateSlot(e,t,n,r,s){let o;i.slotComposer&&(o=i.slotComposer.createHostedSlot(t,n,r,s)),this.CreateSlotCallback({},e,o)}async onArcLoadRecipe(e,t,n){const r=await Qt.parse(t,{loader:e.loader,fileName:""}),s={providedSlotIds:{}};let o=void 0,a=r.recipes[0];if(a){for(const t of a.slots)if(t.id=t.id||`slotid-${e.generateID()}`,t.sourceConnection){const e=t.sourceConnection.particle.localName;e&&(s.providedSlotIds[`${e}.${t.name}`]=t.id)}const t=[];for(const e of a.handles){const n=i.arc.findStoreById(e.id)||r.findStoreById(e.id);n?e.mapToStorage(n):t.push(e)}if(t.length>0){let n=a;for(const t of[new ze(e),new ze(i.arc)])n=await t.resolve(n)||n;n===a?o=`Recipe couldn't load due to missing handles [recipe=${a}, missingHandles=${t.join("\n")}].`:a=n}if(!o){const n={errors:new Map};t.length>0||a.normalize(n)?a.isResolved()?(r.stores.forEach(async e=>{e instanceof Jt?i.arc._registerStore(await e.inflate(),[]):i.arc._registerStore(e,[])}),e.instantiate(a)):o=`Recipe is not resolvable:\n${a.toString({showUnresolved:!0})}`:o=`Recipe ${a} could not be normalized:\n${[...n.errors.values()].join("\n")}`}}else o="No recipe defined";this.SimpleCallback(n,o?{error:o}:s)}onReportExceptionInHost(e){e.particleName||(e.particleName=i.arc.loadedParticleInfo.get(e.particleId).spec.name),Object(W.d)(e)}async onServiceRequest(e,t,n){const i=await We.request(t);this.SimpleCallback(n,i)}}(e,n)}stop(){this._apiPort.Stop()}get idle(){return null==this.idlePromise&&(this.idlePromise=new Promise((e,t)=>{this.idleResolve=e})),this.idleVersion=this.nextIdentifier,this._apiPort.AwaitIdle(this.nextIdentifier++),this.idlePromise}get messageCount(){return this._apiPort.messageCount}sendEvent(e,t,n){this._apiPort.UIEvent(e,t,n)}instantiate(e,t){t.forEach((e,t)=>{this._apiPort.DefineHandle(e,e.type.resolvedType(),t)}),this._apiPort.InstantiateParticle(e,e.id.toString(),e.spec,t)}startRender({particle:e,slotName:t,providedSlots:n,contentTypes:i}){this._apiPort.StartRender(e,t,n,i)}stopRender({particle:e,slotName:t}){this._apiPort.StopRender(e,t)}innerArcRender(e,t,n,i){this._apiPort.InnerArcRender(e,t,n,i)}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ve{constructor(){this.next=Promise.resolve(),this.depth=0}get locked(){return 0!==this.depth}async acquire(){let e;const t=this.next.then(()=>(this.depth++,()=>{e(),this.depth--}));return this.next=new Promise(t=>{e=t}),t}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Ke{constructor({id:e,context:t,pecFactory:n,slotComposer:i,loader:r,storageKey:s,storageProviderFactory:o,speculative:a,innerArc:c,stub:u,inspectorFactory:h}){this._activeRecipe=new j,this._recipeDeltas=[],this.dataChangeCallbacks=new Map,this.storesById=new Map,this.storageKeys={},this.storeTags=new Map,this.storeDescriptions=new Map,this.innerArcsByParticle=new Map,this.instantiateMutex=new Ve,this.idGenerator=l.c.newSession(),this.loadedParticleInfo=new Map,this._context=t||new Qt({id:e}),this.pecFactory=n||function(e){return(t,n)=>{const i=new z,r=e instanceof De?e.clone():new H.a;return new Ie(i.port1,t,n,r),i.port2}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(r).bind(null),"string"==typeof e?(console.error(`Arc created with string ID ${e}!!! This should be an object of type Id instead. This warning will turn into an `+"exception soon (end of April 2019)."),this.id=l.a.fromString(e)):this.id=e,this.isSpeculative=!!a,this.isInnerArc=!!c,this.isStub=!!u,this._loader=r,this.inspectorFactory=h,this.inspector=h&&h.create(this),this.storageKey=s;const d=this.generateID(),p=this.pecFactory(d,this.idGenerator);this.pec=new Ue(p,i,this),this.storageProviderFactory=o||new Vt(this.id)}get loader(){return this._loader}get modality(){return this.pec.slotComposer&&this.pec.slotComposer.modality?this.pec.slotComposer.modality:this.activeRecipe.modality}dispose(){for(const e of this.innerArcs)e.dispose();if(this.pec.stop(),this.pec.close(),!this.isInnerArc&&this.pec.slotComposer){const e=this.allDescendingArcs;this.pec.slotComposer.consumers.forEach(t=>Object(s.a)(e.includes(t.arc))),this.pec.slotComposer.dispose()}}async _waitForIdle(){for(;;){const e=this.pec.messageCount,t=this.innerArcs;if(await Promise.all([this.pec.idle,...t.map(async e=>e.idle)]),this.innerArcs.length===t.length&&this.pec.messageCount===e+2)break}}get idle(){if(this.waitForIdlePromise)return this.waitForIdlePromise;const e=this._waitForIdle().then(()=>this.waitForIdlePromise=null);return this.waitForIdlePromise=e,e}findInnerArcs(e){return this.innerArcsByParticle.get(e)||[]}get innerArcs(){return[].concat(...this.innerArcsByParticle.values())}get allDescendingArcs(){return[this].concat(...this.innerArcs.map(e=>e.allDescendingArcs))}createInnerArc(e){const t=this.generateID("inner"),n=new Ke({id:t,pecFactory:this.pecFactory,slotComposer:this.pec.slotComposer,loader:this._loader,context:this.context,innerArc:!0,speculative:this.isSpeculative,inspectorFactory:this.inspectorFactory});let i=this.innerArcsByParticle.get(e);return i||(i=[],this.innerArcsByParticle.set(e,i)),i.push(n),n}async _serializeHandle(e,t,n){const i=e.type.getContainedType()||e.type;i instanceof _.f&&(t.interfaces+=i.interfaceInfo.toString()+"\n");const r=this.storageProviderFactory.parseStringAsKey(e.storageKey),s=[...this.storeTags.get(e)||new Set].map(e=>`#${e}`).join(" "),o=this.activeRecipe.findHandle(e.id),a=o?o.originalId:null;let c=`'${e.id}'`;switch(a&&(c+=`!!'${a}'`),r.protocol){case"firebase":case"pouchdb":t.handles+=`store ${n} of ${e.type.toString()} ${c} @${null===e.version?0:e.version} ${s} at '${e.storageKey}'\n`;break;case"volatile":{let i=[];if(s.includes("volatile")||(i=(await e.toLiteral()).model.map(e=>{const{id:t,value:n}=e,i=e.index;if(null==n)return null;let r;if(n.rawData){r={$id:t};for(const e of Object.keys(n.rawData))r[e]=n.rawData[e]}else r=n;return void 0!==i&&(r.$index=i),r})),e.referenceMode&&i.length>0){const r=i[0].storageKey;if(!t.dataResources.has(r)){const i=`${n}_Data`;t.dataResources.set(r,i),e instanceof A.c&&(await e.ensureBackingStore(),await this._serializeHandle(e.backingStore,t,i))}const s=t.dataResources.get(r);i.forEach(e=>{e.storageKey=s})}t.resources+=`resource ${n}Resource\n`;const r="  ";t.resources+=r+"start\n";const o=JSON.stringify(i);t.resources+=o.split("\n").map(e=>r+e).join("\n"),t.resources+="\n",t.handles+=`store ${n} of ${e.type.toString()} ${c} @${e.version||0} ${s} in ${n}Resource\n`;break}default:throw new Error(`unknown storageKey protocol ${r.protocol}`)}}async _serializeHandles(){const e={handles:"",resources:"",interfaces:"",dataResources:new Map};let t=0;const n=new Set,i=new Set,r=new Set(this.context.stores.map(e=>e.id));for(const e of this._activeRecipe.handles)if("map"===e.fate)n.add(this.context.findManifestUrlForHandleId(e.id));else{if(e.immediateValue)continue;i.add(e.id)}for(const t of n.values())e.resources+=`import '${t}'\n`;for(const n of this._stores)i.has(n.id)&&!r.has(n.id)&&await this._serializeHandle(n,e,`Store${t++}`);return e.resources+e.interfaces+e.handles}_serializeParticles(){const e=[];e.push(...this._activeRecipe.particles.map(e=>e.spec)),e.push(...this._activeRecipe.handles.filter(e=>e.immediateValue).map(e=>e.immediateValue));const t=[];return e.forEach(e=>{for(const n of e.handleConnections)n.type instanceof _.f&&t.push(n.type.interfaceInfo.toString());t.push(e.toString())}),t.join("\n")}_serializeStorageKey(){return this.storageKey?`storageKey: '${this.storageKey}'\n`:""}async serialize(){return await this.idle,`\nmeta\n  name: '${this.id}'\n  ${this._serializeStorageKey()}\n\n${await this._serializeHandles()}\n\n${this._serializeParticles()}\n\n@active\n${this.activeRecipe.toString()}`}async persistSerialization(e){const t=this.storageProviderFactory,n=t.parseStringAsKey(this.storageKey).childKeyForArcInfo(),i=new _.a,r=await t.connectOrConstruct("store",i,n.toString());r.referenceMode=!1,await r.set(i.newInstance(this.id,e))}static async deserialize({serialization:e,pecFactory:t,slotComposer:n,loader:i,fileName:r,context:o,inspectorFactory:a}){const c=await Qt.parse(e,{loader:i,fileName:r,context:o}),u=new Ke({id:l.b.fromString(c.meta.name),storageKey:c.meta.storageKey,slotComposer:n,pecFactory:t,loader:i,storageProviderFactory:c.storageProviderFactory,context:o,inspectorFactory:a});await Promise.all(c.stores.map(async e=>{const t=c.storeTags.get(e);e instanceof Jt&&(e=await e.inflate()),u._registerStore(e,t)}));const h=c.activeRecipe.clone(),d={errors:new Map};return Object(s.a)(h.normalize(d),`Couldn't normalize recipe ${h.toString()}:\n${[...d.errors.values()].join("\n")}`),await u.instantiate(h),u}get context(){return this._context}get activeRecipe(){return this._activeRecipe}get allRecipes(){return[this.activeRecipe].concat(this.context.allRecipes)}get recipes(){return[this.activeRecipe]}get recipeDeltas(){return this._recipeDeltas}loadedParticleSpecs(){return[...this.loadedParticleInfo.values()].map(({spec:e})=>e)}async _instantiateParticle(e){e.id=this.generateID("particle");const t={spec:e.spec,stores:new Map};this.loadedParticleInfo.set(e.id.toString(),t),await this._provisionSpecUrl(e.spec);for(const[n,i]of Object.entries(e.connections))if("`slot"!==i.handle.fate){const e=this.findStoreById(i.handle.id);Object(s.a)(e,`can't find store of id ${i.handle.id}`),Object(s.a)(void 0!==t.spec.handleConnectionMap.get(n),"can't connect handle to a connection that doesn't exist"),t.stores.set(n,e)}this.pec.instantiate(e,t.stores)}async _provisionSpecUrl(e){e.implBlobUrl||this.loader&&this.loader.provisionObjectUrl&&e.setImplBlobUrl(await this.loader.provisionObjectUrl(e.implFile))}generateID(e=""){return this.idGenerator.newChildId(this.id,e)}get _stores(){return[...this.storesById.values()]}async cloneForSpeculativeExecution(){const e=new Ke({id:this.generateID(),pecFactory:this.pecFactory,context:this.context,loader:this._loader,speculative:!0,innerArc:this.isInnerArc,inspectorFactory:this.inspectorFactory}),t=new Map;for(const n of this._stores){const i=await e.storageProviderFactory.construct(n.id,n.type,"volatile");await i.cloneFrom(n),t.set(n,i),this.storeDescriptions.has(n)&&e.storeDescriptions.set(i,this.storeDescriptions.get(n))}this.loadedParticleInfo.forEach((n,i)=>{const r=new Map;n.stores.forEach((e,n)=>r.set(n,t.get(e))),e.loadedParticleInfo.set(i,{spec:n.spec,stores:r})});const{cloneMap:n}=this._activeRecipe.mergeInto(e._activeRecipe);this._recipeDeltas.forEach(t=>e._recipeDeltas.push({particles:t.particles.map(e=>n.get(e)),handles:t.handles.map(e=>n.get(e)),slots:t.slots.map(e=>n.get(e)),patterns:t.patterns}));for(const[t,i]of this.innerArcsByParticle.entries())e.innerArcsByParticle.set(n.get(t),await Promise.all(i.map(async e=>e.cloneForSpeculativeExecution())));for(const n of t.values())e._registerStore(n,[]);return e}async instantiate(e){Object(s.a)(e.isResolved(),`Cannot instantiate an unresolved recipe: ${e.toString({showUnresolved:!0})}`),Object(s.a)(e.isCompatible(this.modality),`Cannot instantiate recipe ${e.toString()} with [${e.modality.names}] modalities in '${this.modality.names}' arc`);const t=await this.instantiateMutex.acquire();try{await this._doInstantiate(e)}finally{t()}}async _doInstantiate(e){const{handles:t,particles:n,slots:i}=e.mergeInto(this._activeRecipe);this._recipeDeltas.push({particles:n,handles:t,slots:i,patterns:e.patterns}),i.forEach(e=>e.id=e.id||`slotid-${this.generateID().toString()}`);for(const e of t)if(["copy","create"].includes(e.fate)){let t=e.type;"create"===e.fate&&Object(s.a)(t.maybeEnsureResolved(),`Can't assign resolved type to ${t}`),t=t.resolvedType(),Object(s.a)(t.isResolved(),`Can't create handle for unresolved type ${t}`);const n=await this.createStore(t,null,this.generateID().toString(),e.tags,e.immediateValue?"volatile":null);if(e.immediateValue){const t=e.immediateValue,i=e.type;Object(s.a)(i instanceof _.f&&i.interfaceInfo.particleMatches(t));const r=t.clone().toLiteral();r.id=n.id,await n.set(r)}else if("copy"===e.fate){const t=this.findStoreById(e.id);let i;i=t instanceof Jt?await t.inflate():t,Object(s.a)(i,`Cannot find store ${e.id}`),Object(s.a)(null!==i.version,`Copied store ${e.id} doesn't have version.`),await n.cloneFrom(i),this._tagStore(n,this.findStoreTags(i));const r=this.getStoreDescription(i);r&&this.storeDescriptions.set(n,r)}e.id=n.id,e.fate="use",e.storageKey=n.storageKey}else if(!this.storesById.has(e.id)&&"`slot"!==e.fate){let t=e.storageKey;t||(t=this.keyForId(e.id)),Object(s.a)(t,`couldn't find storage key for handle '${e}'`);const n=e.type.resolvedType();Object(s.a)(n.isResolved(),`couldn't resolve type ${n.toString()}`);const i=await this.storageProviderFactory.connect(e.id,n,t);Object(s.a)(i,`store '${e.id}' was not found`),this._registerStore(i,e.tags)}await Promise.all(n.map(e=>this._instantiateParticle(e))),this.pec.slotComposer&&await this.pec.slotComposer.initializeRecipe(this,n),this.inspector&&this.inspector.recipeInstantiated(n,this.activeRecipe.toString())}async createStore(e,t,n,i,r){Object(s.a)(e instanceof _.j,`can't createStore with type ${e} that isn't a Type`),e instanceof _.h&&(e=new _.c(e)),null==n&&(n=this.generateID().toString()),null==r&&this.storageKey&&(r=this.storageProviderFactory.parseStringAsKey(this.storageKey).childKeyForHandle(n).toString());(null==r||(e=>e&&e.includes("volatile"))(i))&&(r="volatile");const o=await this.storageProviderFactory.construct(n,e,r);return Object(s.a)(o,`failed to create store with id [${n}]`),o.name=t,this._registerStore(o,i),o}_registerStore(e,t){Object(s.a)(!this.storesById.has(e.id),`Store already registered '${e.id}'`),t=t||[],t=Array.isArray(t)?t:[t],this.storesById.set(e.id,e),this.storeTags.set(e,new Set(t)),this.storageKeys[e.id]=e.storageKey,e.on("change",()=>this._onDataChange(),this)}_tagStore(e,t){Object(s.a)(this.storesById.has(e.id)&&this.storeTags.has(e),`Store not registered '${e.id}'`);const n=this.storeTags.get(e);(t=t||new Set).forEach(e=>n.add(e))}_onDataChange(){for(const e of this.dataChangeCallbacks.values())e()}onDataChange(e,t){this.dataChangeCallbacks.set(t,e)}clearDataChange(e){this.dataChangeCallbacks.delete(e)}static _typeToKey(e){const t=e.getContainedType();if(t){const e=this._typeToKey(t);if(e)return`list:${e}`}else{if(e instanceof _.d)return e.entitySchema.name;if(e instanceof _.f)return e.interfaceInfo;if(e instanceof _.k&&e.isResolved())return Ke._typeToKey(e.resolvedType())}return null}findStoresByType(e,t){const n=Ke._typeToKey(e);let i=[...this.storesById.values()].filter(t=>{if(n){const e=Ke._typeToKey(t.type);if(n===e)return!0}else{if(e instanceof _.k&&!e.isResolved()&&t.type instanceof _.d)return!0;const n=e.getContainedType();if(n&&n instanceof _.k&&!n.isResolved()&&e.tag===t.type.tag)return!0}return!1});return t&&t.tags&&t.tags.length>0&&(i=i.filter(e=>0===t.tags.filter(t=>!this.storeTags.get(e).has(t)).length)),i.filter(t=>!!C.effectiveType(e,[{type:t.type,direction:t.type instanceof _.f?"host":"inout"}]))}findStoreById(e){const t=this.storesById.get(e);return null==t?this._context.findStoreById(e):t}findStoreTags(e){return this.storeTags.has(e)?this.storeTags.get(e):new Set(this._context.findStoreTags(e))}getStoreDescription(e){return Object(s.a)(e,"Cannot fetch description for nonexistent store"),this.storeDescriptions.get(e)||e.description}getVersionByStore({includeArc:e=!0,includeContext:t=!1}){const n={};return e&&this.storesById.forEach((e,t)=>n[t]=e.version),t&&this._context.allStores.forEach(e=>n[e.id]=e.version),n}keyForId(e){return this.storageKeys[e]}toContextString(){const e=[];return[...this.storesById.values()].sort(p.b).forEach(t=>{e.push(t.toString([...this.storeTags.get(t)]))}),this._activeRecipe.isEmpty()||e.push(this._activeRecipe.toString()),e.join("\n")}get apiChannelMappingId(){return this.id.toString()}get idGeneratorForTesting(){return this.idGenerator}}
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Je{constructor(){this.map=new Map,this.nextID=0}getOrCreateCache(e){return this.map.has(e)||this.map.set(e,new Map),this.map.get(e)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright 2019 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var Ge='\n  icon {\n    font-family: "Material Icons";\n    font-size: 24px;\n    font-style: normal;\n    -webkit-font-feature-settings: "liga";\n    -webkit-font-smoothing: antialiased;\n    cursor: pointer;\n    user-select: none;\n    flex-shrink: 0;\n    /* partial FOUC prevention */\n    display: inline-block;\n    width: 24px;\n    height: 24px;\n    overflow: hidden;\n  }\n  icon[hidden] {\n    /* required because of display rule above,\n    display rule required for overflow: hidden */\n    display: none;\n  }\n';
/**
 * @license
 * Copyright (c) 2016 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Ze=function(e,t,n){n=n||[];for(const i in t){const r=t[i];if(r){const t=e.childNodes[i];n[r.key]=t.nodeType===Node.TEXT_NODE?t.parentElement:t,r.sub&&Ze(t,r.sub,n)}}return n},Qe=function(e,t,n){if(Xe(e,t,n,"textContent",e.textContent))return e.textContent="",!0},Ye=function(e,t,n){if(e.hasAttributes()){let i=!1;for(let r,s=e.attributes,o=s.length-1;o>=0&&(r=s[o]);o--)(et(e,t,n,r.name,r.value)||Xe(e,t,n,r.name,r.value)||tt(e,t,n,r.name,r.value))&&(e.removeAttribute(r.name),i=!0);return i}},Xe=function(e,t,n,i,r){if("{{"===r.slice(0,2)){"class"===i&&(i="className");let e=r.slice(2,-2);const s=e.split(":");return 2===s.length&&(i=s[0],e=s[1]),nt(n,t,"mustaches",i,e),"$"===e[0]&&nt(n,"xlate",e,!0),!0}},et=function(e,t,n,i,r){if("on-"===i.slice(0,3))return"{{"===r.slice(0,2)&&(r=r.slice(2,-2),console.warn(`Xen: event handler for '${i}' expressed as a mustache, which is not supported. Using literal value '${r}' instead.`)),nt(n,t,"events",i.slice(3),r),!0},tt=function(e,t,n,i,r){if("xen:forward"===i)return nt(n,t,"events","xen:forward",r),!0},nt=function(e,t,n,i,r){const s=e[t]||(e[t]=Object.create(null));(s[n]||(s[n]={}))[i]=r},it=new class{constructor(e){this.cb=e}annotate(e,t,n){return this.notes=t,this.opts=n||0,this.key=this.opts.key||0,t.locator=this._annotateSubtree(e),t}_annotateSubtree(e){let t;for(let n,i=0,r=e.firstChild,s=null;r;i++){const o=this._annotateNode(r);o&&((t=t||{})[i]=o),(n=s?s.nextSibling:e.firstChild)===r?(s=r,r=r.nextSibling):(r=n,i--)}return t}_annotateNode(e){const t=this.key++,n=this.cb(e,t,this.notes,this.opts),i=this._annotateSubtree(e);if(n||i){const e=Object.create(null);return e.key=t,i&&(e.sub=i),e}}}(function(e,t,n,i){if(i.annotator&&i.annotator(e,t,n,i))return!0;switch(e.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:return;case Node.ELEMENT_NODE:return Ye(e,t,n);case Node.TEXT_NODE:return Qe(e,t,n)}}),rt=function(e,t,n){for(const i in e){const r=t[i],s=e[i]&&e[i].events;if(r&&s)for(const e in s)n(r,e,s[e])}},st=function(e,t,n,i){const r=t.slice(-1);if("style%"===t||"style"===t||"xen:style"===t)"string"==typeof n?e.style.cssText=n:Object.assign(e.style,n);else if("$"==r){const i=t.slice(0,-1);"boolean"==typeof n||void 0===n?ot(e,i,Boolean(n)):e.setAttribute(i,n)}else"textContent"===t?n&&(n.$template||n.template)?at(e,n,i):e.textContent=n||"":"unsafe-html"===t?e.innerHTML=n||"":"value"===t?e.value!==n&&(e.value=n):e[t]=n},ot=function(e,t,n){e[(void 0===n?!e.hasAttribute(t):n)?"setAttribute":"removeAttribute"](t,"")},at=function(e,t,n){let{template:i,models:r}=t;if(i)i=ht(i);else{i=e.getRootNode().querySelector(`template[${t.$template}]`)}ct(e,n,i,r)},ct=function(e,t,n,i){let r,s=e.firstElementChild;for(n&&i&&i&&i.forEach((i,o)=>{if(r=s&&s.nextElementSibling,!s){const i=lt(n).events(t);(s=i.root.firstElementChild)&&(s._subtreeDom=i,e.appendChild(s),!n._shapeWarning&&i.root.firstElementChild&&(n._shapeWarning=!0,console.warn("xen-template: subtemplate has multiple root nodes: only the first is used.",n)))}s&&(s._subtreeDom.set(i),s=r)});s;)r=s.nextElementSibling,s.remove(),s=r},lt=function(e,t){const n=function(e,t,n){return e._notes||(e._notes=it.annotate(e.content,{},t,n))}(e=ht(e),t),i=document.importNode(e.content,!0),r=i.firstElementChild,s=Ze(i,n.locator);return{root:i,notes:n,map:s,firstElement:r,$(e){return this.root.querySelector(e)},set:function(e){return e&&function(e,t,n,i){if(n)for(const r in e){const s=t[r];if(s){s.scope=n;const t=e[r].mustaches;for(const e in t){const r=t[e];r in n&&st(s,e,n[r],i)}}}}(n,s,e,this.controller),this},events:function(e){return e&&"function"!=typeof e&&(e=function(e,t,n,i){t.addEventListener(n,function(t){if(e[i])return e[i](t,t.detail)})}.bind(this,e)),this.controller=e,e&&rt(n,s,e),this},forward:function(){return rt(n,s,(e,t,n)=>{e.addEventListener(t,i=>{const r={eventName:t,handlerName:n,detail:i.detail,target:i.target};ut(e,"xen:forward",r,{bubbles:!0})})}),this},appendTo:function(e){return this.root?e.appendChild(this.root):console.warn("Xen: cannot appendTo, template stamped no DOM"),this.root=e,this}}},ut=(e,t,n,i)=>{const r=i||{};r.detail=n;const s=new CustomEvent(t,r);return e.dispatchEvent(s),s.detail},ht=e=>"string"==typeof e?dt(e):e,dt=e=>Object.assign(document.createElement("template"),{innerHTML:e}),pt={createTemplate:dt,setBoolAttribute:ot,stamp:lt};
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class ft{constructor(e,t=null){this.slotConsumers=[],this.id=e,this.sourceSlotConsumer=t}addSlotConsumer(e){this.slotConsumers.push(e),e.slotContext=this}clearSlotConsumers(){this.slotConsumers.forEach(e=>e.slotContext=null),this.slotConsumers.length=0}}class mt extends ft{constructor(e,t,n){super(e,t),this._containerAvailable=!1,Object(s.a)(t),this.storeId=n,t.addHostedSlotContexts(this)}onRenderSlot(e,t,n){this.sourceSlotConsumer.arc.pec.innerArcRender(this.sourceSlotConsumer.consumeConn.particle,this.sourceSlotConsumer.consumeConn.name,this.id,e.formatHostedContent(t))}addSlotConsumer(e){super.addSlotConsumer(e),this.containerAvailable&&e.startRender()}get containerAvailable(){return this._containerAvailable}set containerAvailable(e){if(this._containerAvailable!==e){this._containerAvailable=e;for(const t of this.slotConsumers)e?t.startRender():t.stopRender()}}}class gt extends ft{constructor(e,t,n,i,r,o=null){super(e,o),this.tags=[],Object(s.a)(Boolean(i)!==Boolean(r),"Exactly one of either container or slotSpec may be set"),Object(s.a)(Boolean(r)==Boolean(r),"Spec and source slot can only be set together"),this.name=t,this.tags=n||[],this._container=i,this.spec=r||new d.b({name:t}),this.sourceSlotConsumer&&this.sourceSlotConsumer.directlyProvidedSlotContexts.push(this),this.handles=this.spec&&this.sourceSlotConsumer?this.spec.handles.map(e=>this.sourceSlotConsumer.consumeConn.particle.connections[e].handle).filter(e=>void 0!==e):[]}onRenderSlot(e,t,n){e.setContent(t,n)}get container(){return this._container}get containerAvailable(){return Boolean(this._container)}static createContextForContainer(e,t,n,i){return new gt(e,t,i,n,null)}isSameContainer(e){return this.spec.isSet?Boolean(this.container)===Boolean(e)&&(!this.container||Object.keys(this.container).length===Object.keys(e).length&&Object.keys(this.container).every(t=>Object.keys(e).some(e=>e===t))&&Object.values(this.container).every(t=>Object.values(e).some(e=>e===t))):!e&&!this.container||this.container===e}set container(e){if(this.isSameContainer(e))return;const t=this.container;this._container=e,this.slotConsumers.forEach(e=>e.onContainerUpdate(this.container,t))}addSlotConsumer(e){super.addSlotConsumer(e),this.container&&e.onContainerUpdate(this.container,null)}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class yt{constructor(e,t,n){this.directlyProvidedSlotContexts=[],this.hostedSlotContexts=[],this._renderingBySubId=new Map,this.innerContainerBySlotId={},this.arc=e,this.consumeConn=t,this.containerKind=n}getRendering(e){return this._renderingBySubId.get(e)}get renderings(){return[...this._renderingBySubId.entries()]}addRenderingBySubId(e,t){this._renderingBySubId.set(e,t)}addHostedSlotContexts(e){e.containerAvailable=Boolean(this.slotContext.containerAvailable),this.hostedSlotContexts.push(e)}get allProvidedSlotContexts(){return[...this.generateProvidedContexts()]}findProvidedContext(e){return this.generateProvidedContexts(e).next().value}*generateProvidedContexts(e=(e=>!0)){for(const t of this.directlyProvidedSlotContexts)e(t)&&(yield t);for(const t of this.hostedSlotContexts)for(const n of t.slotConsumers)yield*n.generateProvidedContexts(e)}onContainerUpdate(e,t){Object(s.a)(this.slotContext instanceof gt,"Container can only be updated in non-hosted context");const n=this.slotContext;if(Boolean(e)!==Boolean(t)&&(e?this.startRender():this.stopRender()),this.hostedSlotContexts.forEach(t=>t.containerAvailable=Boolean(e)),e!==t){const e=new Map;n&&n.spec.isSet?Object.keys(n.container||{}).forEach(t=>e.set(t,n.container[t])):e.set(void 0,n.container);for(const[t,n]of e){this._renderingBySubId.has(t)||this._renderingBySubId.set(t,{});const e=this.getRendering(t);e.container&&this.isSameContainer(e.container,n)||(e.container&&this.clearContainer(e),e.container=this.createNewContainer(n,t))}for(const[t,n]of this.renderings)e.has(t)||(this.deleteContainer(n.container),this._renderingBySubId.delete(t))}}createProvidedContexts(){return this.consumeConn.getSlotSpec().provideSlotConnections.map(e=>new gt(this.consumeConn.providedSlots[e.name].id,e.name,[],null,e,this))}updateProvidedContexts(){this.allProvidedSlotContexts.forEach(e=>{e.container=e.sourceSlotConsumer.getInnerContainer(e.id)})}startRender(){if(this.consumeConn&&this.startRenderCallback){const e=new Map(this.allProvidedSlotContexts.map(e=>[e.name,e.id]));this.startRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name,providedSlots:e,contentTypes:this.constructRenderRequest()})}}stopRender(){this.consumeConn&&this.stopRenderCallback&&this.stopRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name})}setContent(e,t){e&&Object.keys(e).length>0&&this.description&&(e.descriptions=this._populateHandleDescriptions()),this.eventHandler=t;for(const[t,n]of this.renderings)this.setContainerContent(n,this.formatContent(e,t),t)}_populateHandleDescriptions(){if(!this.consumeConn)return null;const e=new Map;return Object.values(this.consumeConn.particle.connections).map(t=>{t.handle&&(e[`${t.name}.description`]=this.description.getHandleDescription(t.handle).toString())}),e}getInnerContainer(e){return this.innerContainerBySlotId[e]}_initInnerSlotContainer(e,t,n){t?(this.innerContainerBySlotId[e]||(this.innerContainerBySlotId[e]={}),Object(s.a)(!this.innerContainerBySlotId[e][t],`Multiple ${e}:${t} inner slots cannot be provided`),this.innerContainerBySlotId[e][t]=n):this.innerContainerBySlotId[e]=n}_clearInnerSlotContainers(e){e.forEach(e=>{e?Object.values(this.innerContainerBySlotId).forEach(t=>delete t[e]):this.innerContainerBySlotId={}})}isSameContainer(e,t){return!e&&!t||e===t}constructRenderRequest(){return[]}dispose(){}createNewContainer(e,t){return null}deleteContainer(e){}clearContainer(e){}setContainerContent(e,t,n){}formatContent(e,t){return null}formatHostedContent(e){return null}static clear(e){}static findRootContainers(e){return{}}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const vt=()=>Mt.getRuntime().getCacheService().getOrCreateCache("templateByName");let bt;class _t extends yt{constructor(e,t,n){super(e,t,n),this._observer=this._initMutationObserver()}constructRenderRequest(){const e=["model"],t=[this.templatePrefix];return _t.hasTemplate(t.join("::"))||e.push("template"),e}static hasTemplate(e){return[...vt().keys()].find(t=>t.startsWith(e))}isSameContainer(e,t){return e.parentNode===t}createNewContainer(e,t){Object(s.a)(e,"contextContainer cannot be null");const n=document.createElement(this.containerKind||"div");return this.consumeConn&&n.setAttribute("particle-host",this.consumeConn.getQualifiedName()),e.appendChild(n),n.attachShadow({mode:"open"}),n.shadowRoot}deleteContainer(e){(e=e.host||e).parentNode&&e.parentNode.removeChild(e)}formatContent(e,t){Object(s.a)(this.slotContext instanceof gt,"Content formatting can only be done for provided SlotContext");const n=this.slotContext.spec,i={};if(Object.keys(e).indexOf("model")>=0)if(e.model){let r;if(!(r=n.isSet&&this.consumeConn.getSlotSpec().isSet?this._modelForSetSlotConsumedAsSetSlot(e.model,t):n.isSet&&!this.consumeConn.getSlotSpec().isSet?this._modelForSetSlotConsumedAsSingletonSlot(e.model,t):this._modelForSingletonSlot(e.model,t)))return;i.model={...r,...e.descriptions}}else i.model=void 0;return e.templateName&&(i.templateName="string"==typeof e.templateName?e.templateName:e.templateName[t],e.template&&(i.template="string"==typeof e.template?e.template:e.template[i.templateName])),i}_modelForSingletonSlot(e,t){return Object(s.a)(!t,"subId should be absent for a Singleton Slot"),e}_modelForSetSlotConsumedAsSetSlot(e,t){return Object(s.a)(e.items&&e.items.every(e=>e.subId),"model for a Set Slot consumed as a Set Slot needs to have items array, with every element having subId"),e.items.find(e=>e.subId===t)}_modelForSetSlotConsumedAsSingletonSlot(e,t){return Object(s.a)(e.subId,"model for a Set Slot consumed as a Singleton Slot needs to have subId"),t===e.subId?e:null}setContainerContent(e,t,n){if(e.container){if(!t||0===Object.keys(t).length)return this.clearContainer(e),void(e.model=null);this._setTemplate(e,this.templatePrefix,t.templateName,t.template),e.model=t.model,this._onUpdate(e)}}clearContainer(e){e.liveDom&&(e.liveDom.root.textContent=""),e.liveDom=null}dispose(){this._observer&&this._observer.disconnect(),this.renderings.forEach(([e,{container:t}])=>this.deleteContainer(t))}static clear(e){e.textContent=""}static clearCache(){vt().clear()}static findRootContainers(e){const t={};return Array.from(e.querySelectorAll("[slotid]")).forEach(e=>{const n=e.getAttribute("slotid");Object(s.a)(!t[n],`Duplicate root slot ${n}`),t[n]=e}),t}createTemplateElement(e){return Object.assign(document.createElement("template"),{innerHTML:e})}get templatePrefix(){return this.consumeConn.getQualifiedName()}_setTemplate(e,t,n,i){n&&(e.templateName=[t,n].filter(e=>e).join("::"),i&&(vt().has(e.templateName)&&this.clearContainer(e),vt().set(e.templateName,this.createTemplateElement(i))))}_onUpdate(e){if(this._observe(e.container),e.templateName){const t=vt().get(e.templateName);Object(s.a)(t,`No template for ${e.templateName}`),this._stampTemplate(e,t)}this._updateModel(e)}_observe(e){Object(s.a)(e,"Cannot observe without a container"),this._observer&&this._observer.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["subid"]})}_stampTemplate(e,t){if(!e.liveDom){bt||(bt=pt.createTemplate(`<style>${Ge}</style>`)),pt.stamp(bt).appendTo(e.container);const n=this._eventMapper.bind(this,this.eventHandler);e.liveDom=pt.stamp(t).events(n).appendTo(e.container)}}_eventMapper(e,t,n,i){t.addEventListener(n,r=>{r.stopPropagation(),"xen:forward"===n&&(t=r.detail.target,i=r.detail.handlerName);const{altKey:s,ctrlKey:o,metaKey:a,shiftKey:c,code:l,key:u,repeat:h}=r,d={key:t.key,value:t.value,keys:{altKey:s,ctrlKey:o,metaKey:a,shiftKey:c,code:l,key:u,repeat:h}};e({detail:d,handler:i,data:d})})}_updateModel(e){e.liveDom&&e.liveDom.set(e.model)}initInnerContainers(e){Array.from(e.querySelectorAll("[slotid]")).forEach(t=>{if(!this.isDirectInnerSlot(e,t))return;const n=this.getNodeValue(t,"slotid"),i=this.findProvidedContext(e=>e.id===n);if(!i)return void console.warn(`Slot ${this.consumeConn.getSlotSpec().name} has unexpected inner slot ${n}`);const r=this.getNodeValue(t,"subid");Object(s.a)(Boolean(r)===i.spec.isSet,`Sub-id ${r} for slot ${i.name} doesn't match set spec: ${i.spec.isSet}`),i.sourceSlotConsumer._initInnerSlotContainer(n,r,t)})}getNodeValue(e,t){return e[t]||e.getAttribute(t)}isDirectInnerSlot(e,t){if(t===e)return!0;const n=e=>e.parentNode;let i=n(t);for(;i;){if(i===e)return!0;if(i.getAttribute&&i.getAttribute("slotid"))return!1;i=n(i)}return!1}_initMutationObserver(){return this.consumeConn?new MutationObserver(async e=>{this._observer.disconnect();const t=new Map;for(const[n,{container:i}]of this.renderings)e.some(e=>this.isDirectInnerSlot(i,e.target))&&t.set(n,i);const n=[...t.values()];n.length>0&&(this._clearInnerSlotContainers([...t.keys()]),n.forEach(e=>this.initInnerContainers(e)),this.updateProvidedContexts(),n.forEach(e=>this._observe(e)))}):null}formatHostedContent(e){if(e.templateName){if("string"!=typeof e.templateName)throw new Error("TODO: Implement this!");e.templateName=`${this.consumeConn.getQualifiedName()}::${e.templateName}`}return e}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class wt extends _t{constructor(e,t){super(e,t),this._content={},this.contentAvailable=new Promise(e=>this._contentAvailableResolve=e)}setContent(e,t){super.setContent(e,t),e?(this._content.templateName=e.templateName,e.template&&(this._content.template=e.template),this._content.model=e.model,this._contentAvailableResolve()):this._content={}}createNewContainer(e,t){return e}isSameContainer(e,t){return e===t}getInnerContainer(e){const t=Array.from(this.renderings,([e,{model:t}])=>t)[0],n=this.findProvidedContext(t=>t.id===e);if(n){if(n.spec.isSet&&t&&t.items&&t.items.models){const e={};for(const n of t.items.models)Object(s.a)(n.id),e[n.id]=n.id;return e}return e}console.warn(`Cannot find provided spec for ${e} in ${this.consumeConn.getQualifiedName()}`)}createTemplateElement(e){return e}static findRootContainers(e){return e}static clear(e){}_onUpdate(e){}_stampTemplate(e){}_initMutationObserver(){return null}_observe(){}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class St{constructor(e,t){this.slotConsumerClass=e,this.descriptionFormatter=t}static createHeadlessHandler(){return new St(wt)}}St.headlessHandler=new St(wt),St.domHandler=new St(_t,class extends q{constructor(){super(...arguments),this.nextID=0}_isSelectedDescription(e){return super._isSelectedDescription(e)||!!e.template&&!!e.model}_combineSelectedDescriptions(e,t){const n=new Map;for(const i of e){if(this.seenParticles.has(i._particle))continue;let{template:e,model:r}=this._retrieveTemplateAndModel(i,n.size,t||{});Object.keys(r).map(t=>this._initSubTokens(r[t],i).map(n=>{const i=this.tokenToString(n);if(null==i)return!1;if(i&&i.template&&i.model)e=e.replace(`{{${t}}}`,i.template),delete r[t],r={...r,...i.model};else{const n=`${t}${++this.nextID}`;e=e.replace(`{{${t}}}`,`{{${n}}}`),delete r[t],r[n]=i}return!0}).every(e=>!!e)).every(e=>!!e)&&n.set(i,{template:e,model:r})}const i=[];if(e.forEach(e=>{n.has(e)&&i.push(n.get(e))}),i.length>0){const e=this._joinDescriptions(i);return t&&t.skipFormatting||(e.template+="."),e}}_retrieveTemplateAndModel(e,t,n){if(e._template_&&e._model_)return{template:e._template_,model:JSON.parse(e._model_)};Object(s.a)(e.pattern,"Description must contain template and model, or pattern");let i="";const r={};return this._initTokens(e.pattern,e).forEach((e,s)=>{if(e.text)i=i.concat(`${0!==t||0!==s||n.skipFormatting?e.text:e.text[0].toUpperCase()+e.text.slice(1)}`);else{const t=e.fullName.replace(/[.{}_$]/g,"");let o="";0!==s||n.skipFormatting||(i=i.concat("<style>\n            [firstletter]::first-letter { text-transform: capitalize; }\n            [firstletter] {display: inline-block}\n            </style>"),o=" firstletter"),i=i.concat(`<span${o}>{{${t}}}</span>`),r[t]=e.fullName}}),{template:i,model:r}}_capitalizeAndPunctuate(e){if("string"==typeof e)return{template:super._capitalizeAndPunctuate(e),model:{}};const t=e.template.match(/<[a-zA-Z0-9]+>{{([a-zA-Z0-9]*)}}<\/[a-zA-Z0-9]+>/);if(t&&t.length>1&&e.model[t[1]]){const n=e.model[t[1]];n.length>0&&(e.model[t[1]]=`${n[0].toUpperCase()}${n.substr(1)}`)}return e.template+=".",e}_joinDescriptions(e){if(e.every(e=>"string"==typeof e))return super._joinDescriptions(e);const t={template:"",model:{}},n=e.length;return e.forEach((e,i)=>{let r;"string"==typeof e&&(e={template:e,model:{}}),t.template+=e.template,t.model={...t.model,...e.model},i<n-2?r=", ":i===n-2&&(r=["",""," and ",", and "][Math.min(3,n)]),r&&(t.template+=r)}),t}_joinTokens(e){if(e.every(e=>"string"==typeof e))return super._joinTokens(e);const t=(e=e.map(e=>"object"!=typeof e?{template:`<span>{{text${++this.nextID}}}</span>`,model:{[`text${this.nextID}`]:e}}:e)).filter(e=>e&&!!e.template&&!!e.model);return{template:t.map(e=>e.template).join(""),model:t.map(e=>e.model).reduce((e,t)=>({...e,...t}),{})}}_combineDescriptionAndValue(e,t,n){if(t.template&&t.model)return{template:`${t.template} (${n.template})`,model:{...t.model,...n.model}};const i=`${e.handleName}Description${++this.nextID}`;return{template:`<span>{{${i}}}</span> (${n.template})`,model:{[i]:t,...n.model}}}_formatEntityProperty(e,t,n){const i=`${e}${t.join("")}Value${++this.nextID}`;return{template:`<b>{{${i}}}</b>`,model:{[`${i}`]:n}}}_formatCollection(e,t){const n=`${e}${++this.nextID}`;return t[0].rawData.name?t.length>2?{template:`<b>{{${n}FirstName}}</b> plus <b>{{${n}OtherCount}}</b> other items`,model:{[`${n}FirstName`]:t[0].rawData.name,[`${n}OtherCount`]:t.length-1}}:{template:t.map((e,t)=>`<b>{{${n}${t}}}</b>`).join(", "),model:Object.assign({},...t.map((e,t)=>({[`${n}${t}`]:e.rawData.name})))}:{template:`<b>{{${n}Length}}</b> items`,model:{[`${n}Length`]:t.length}}}_formatBigCollection(e,t){return{template:`collection of items like {{${e}FirstName}}`,model:{[`${e}FirstName`]:t.rawData.name}}}_formatSingleton(e,t){const n=super._formatSingleton(e,t);if(n)return{template:`<b>{{${e}Var}}</b>`,model:{[`${e}Var`]:n}}}});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ct{constructor(e){if(this._consumers=[],this._contexts=[],Object(s.a)(e.modalityHandler,`Missing or invalid modality handler: ${e.modalityHandler}`),e.rootContainer=e.rootContainer||e.rootContext||(e.containers||Object).root,Object(s.a)(void 0!==e.rootContainer!=(!0===e.noRoot),"Root container is mandatory unless it is explicitly skipped"),this._containerKind=e.containerKind,e.modalityName&&(this.modality=T.a.create([e.modalityName])),this.modalityHandler=e.modalityHandler,e.noRoot)return;const t=e.containers||this.modalityHandler.slotConsumerClass.findRootContainers(e.rootContainer)||{};0===Object.keys(t).length&&(t.root=e.rootContainer),Object.keys(t).forEach(e=>{this._contexts.push(gt.createContextForContainer(`rootslotid-${e}`,e,t[e],[`${e}`]))})}get consumers(){return this._consumers}get containerKind(){return this._containerKind}getSlotConsumer(e,t){return this.consumers.find(n=>n.consumeConn.particle===e&&n.consumeConn.name===t)}findContainerByName(e){const t=this.findContextsByName(e);if(0===t.length)console.warn(`No containers for '${e}'`);else if(1===t.length)return t[0].container;console.warn(`Ambiguous containers for '${e}'`)}findContextsByName(e){return this._contexts.filter(e=>e instanceof gt).filter(t=>t.name===e)}findContextById(e){return this._contexts.find(({id:t})=>t===e)}createHostedSlot(e,t,n,i){const r=this.getSlotConsumer(t,n);Object(s.a)(r,`Transformation particle ${t.name} with consumed ${n} not found`);const o=e.generateID().toString();return this._contexts.push(new mt(o,r,i)),o}_addSlotConsumer(e){e.startRenderCallback=e.arc.pec.startRender.bind(e.arc.pec),e.stopRenderCallback=e.arc.pec.stopRender.bind(e.arc.pec),this._consumers.push(e)}async initializeRecipe(e,t){const n=[];t.forEach(t=>{Object.values(t.consumedSlotConnections).forEach(i=>{if(!i.targetSlot)return void Object(s.a)(!i.getSlotSpec().isRequired,`No target slot for particle's ${t.name} required consumed slot: ${i.name}.`);const r=new this.modalityHandler.slotConsumerClass(e,i,this._containerKind),o=r.createProvidedContexts();this._contexts=this._contexts.concat(o),n.push(r)})}),n.forEach(e=>{this._addSlotConsumer(e);const t=this.findContextById(e.consumeConn.targetSlot.id);Object(s.a)(t,`No context found for ${e.consumeConn.getQualifiedName()}`),t.addSlotConsumer(e)});const i=this.consumers.map(e=>e.arc),r=[...new Set(i).values()],o=await Promise.all(r.map(e=>F.create(e))),a=new Map(o.map((e,t)=>[r[t],e]));for(const e of this.consumers)e.description=a.get(e.arc)}renderSlot(e,t,n){const i=this.getSlotConsumer(e,t);Object(s.a)(i,`Cannot find slot (or hosted slot) ${t} for particle ${e.name}`),i.slotContext.onRenderSlot(i,n,async n=>{if(i.arc.pec.sendEvent(e,t,n),n.data&&n.data.key)for(const e of i.hostedSlotContexts)if(e.storeId)for(const t of e.slotConsumers){const i=t.arc.findStoreById(e.storeId);Object(s.a)(i),i.get().then(e=>{e&&e.id===n.data.key&&t.arc.pec.sendEvent(t.consumeConn.particle,t.consumeConn.name,n)})}})}getAvailableContexts(){return this._contexts}dispose(){this.consumers.forEach(e=>e.dispose()),this._contexts.forEach(e=>{e.clearSlotConsumers(),e instanceof gt&&e.container&&this.modalityHandler.slotConsumerClass.clear(e.container)}),this._contexts=this._contexts.filter(e=>!e.sourceSlotConsumer),this._consumers.length=0}}
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Tt extends Ct{constructor(e={}){void 0===e.modalityHandler&&(e.modalityHandler=St.createHeadlessHandler()),super({rootContainer:{root:"root-context"},...e})}renderSlot(e,t,n){super.renderSlot(e,t,n);const i=this.getSlotConsumer(e,t);i&&i.updateProvidedContexts()}get contexts(){return this._contexts}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var kt;!function(e){e[e.ShouldExist=0]="ShouldExist",e[e.ShouldCreate=1]="ShouldCreate",e[e.MayExist=2]="MayExist"}(kt||(kt={}));class Rt{constructor(e,t){this.storageKey=e,this.exists=t}}class xt{static clearRegistrationsForTesting(){this.providers=[]}static async driverInstance(e,t){for(const n of this.providers)if(n.willSupport(e))return n.driver(e,t);return null}static register(e){this.providers.push(e)}static willSupport(e){for(const t of this.providers)if(t.willSupport(e))return!0;return!1}}xt.providers=[];class Et{constructor(){this.entries=new Map}}class Ot extends Rt{constructor(e,t){super(e,t),this.pendingVersion=0,this.pendingModel=null;const n=e.toString();switch(this.memory=Mt.getRuntime().getVolatileMemory(),t){case kt.ShouldCreate:if(this.memory.entries.has(n))throw new Error(`requested creation of memory location ${e} can't proceed as location already exists`);this.data={data:null,version:0,drivers:[]},this.memory.entries.set(n,this.data);break;case kt.ShouldExist:if(!this.memory.entries.has(n))throw new Error(`requested connection to memory location ${e} can't proceed as location doesn't exist`);case kt.MayExist:{const e=this.memory.entries.get(n);e?(this.data=e,this.pendingModel=e.data,this.pendingVersion=e.version):(this.data={data:null,version:0,drivers:[]},this.memory.entries.set(n,this.data));break}default:throw new Error(`unknown Exists code ${t}`)}this.data.drivers.push(this)}registerReceiver(e){this.receiver=e,this.pendingModel&&(e(this.pendingModel,this.pendingVersion),this.pendingModel=null)}async send(e,t){return this.data.version===t-1&&(this.data.data=e,this.data.version+=1,this.data.drivers.forEach(t=>{t!==this&&t.receiver(e,this.data.version)}),!0)}async write(e,t){throw new Error("Method not implemented.")}async read(e){throw new Error("Method not implemented.")}}class jt{willSupport(e){return"volatile"===e.protocol}async driver(e,t){if(!this.willSupport(e))throw new Error(`This provider does not support storageKey ${e.toString()}`);return new Ot(e,t)}static register(){xt.register(new jt)}}jt.register();
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Mt{static getRuntime(){return null==$t&&($t=new Mt),$t}static clearRuntimeForTesting(){null!==$t&&($t.destroy(),$t=null)}static newForNodeTesting(e){return new Mt(new H.a,Tt,e)}constructor(e,t,n){this.cacheService=new Je,this.loader=e,this.composerClass=t,this.context=n||new Qt({id:"manifest:default"}),this.volatileMemory=new Et,$t=this}getCacheService(){return this.cacheService}getVolatileMemory(){return this.volatileMemory}destroy(){}newArc(e,t,n){const i=l.c.newSession().newArcId(e),r=t+i.toString();return new Ke({id:i,storageKey:r,loader:this.loader,slotComposer:new this.composerClass,context:this.context,...n})}static async getArcDescription(e){return(await F.create(e)).getArcDescription()}static async parseManifest(e,t){return Qt.parse(e,t)}static async loadManifest(e,t,n){return Qt.load(e,t,n)}}let $t=null;
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Pt extends D{constructor(e){super();let t=e.split("://");this.protocol=t[0],Object(s.a)("volatile"===this.protocol,`can't construct volatile key for protocol ${this.protocol} (input key ${e})`),t=t[1]?t.slice(1).join("://").split("^^"):[],this.arcId=t[0],this.location=t[1],Object(s.a)(this.toString()===e,`Expected ${e}, but got ${this.toString()} volatile key base.`)}base(){return"volatile"}get arcId(){return this._arcId}set arcId(e){this._arcId=e}childKeyForHandle(e){return new Pt("volatile")}childKeyForArcInfo(){return new Pt(`${this.protocol}://${this.arcId}^^arc-info`)}childKeyForSuggestions(e,t){return new Pt(`${this.protocol}://${this.arcId}^^${e}/suggestions/${t}`)}childKeyForSearch(e){return new Pt(`${this.protocol}://${this.arcId}^^${e}/search`)}toString(){return void 0!==this.location&&void 0!==this.arcId?`${this.protocol}://${this.arcId}^^${this.location}`:void 0!==this.arcId?`${this.protocol}://${this.arcId}`:`${this.protocol}`}}const Nt=()=>Mt.getRuntime().getCacheService().getOrCreateCache("volatileStorageCache");class It extends A.c{constructor(){super(...arguments),this.backingStore=null,this.pendingBackingStore=null}static newProvider(e,t,n,i,r){return e instanceof _.c?new Dt(e,t,n,i,r):e instanceof _.b?new Ft(e,t,n,i,r):new At(e,t,n,i,r)}async ensureBackingStore(){if(this.backingStore)return this.backingStore;if(!this.pendingBackingStore){const e=this.storageEngine.baseStorageKey(this.backingType());this.pendingBackingStore=this.storageEngine.baseStorageFor(this.backingType(),e),await this.pendingBackingStore.then(e=>this.backingStore=e)}return this.pendingBackingStore}}class Dt extends It{constructor(e,t,n,i,r){super(e,n,i,r),this._model=new I,this.storageEngine=t,Object(s.a)(null!==this.version)}backingType(){return this.type.getContainedType()}async clone(){const e=new Dt(this.type,this.storageEngine,this.name,this.id,null);return await e.cloneFrom(this),e}async cloneFrom(e){this.referenceMode=e.referenceMode;const t=await e.toLiteral();if(this.referenceMode&&t.model.length>0){await Promise.all([this.ensureBackingStore(),e.ensureBackingStore()]),t.model=t.model.map(({id:e,value:t})=>({id:e,value:{id:t.id,storageKey:this.backingStore.storageKey}}));const n=await e.backingStore.getMultiple(t.model.map(({id:e})=>e));await this.backingStore.storeMultiple(n,[this.storageKey])}this.fromLiteral(t)}async modelForSynchronization(){const e=await this._toList();return{version:this.version,model:e}}async toLiteral(){return{version:this.version,model:this._model.toLiteral()}}fromLiteral({version:e,model:t}){this.version=e,this._model=new I(t)}async _toList(){if(this.referenceMode){const e=(await this.toLiteral()).model;if(0===e.length)return[];const t=new Set;e.forEach(e=>t.add(e.value.storageKey)),Object(s.a)(1===t.size,"multiple storageKeys in reference set of collection not yet supported.");t.values().next().value;await this.ensureBackingStore();const n=e.map(e=>e.value.id),i=await this.backingStore.getMultiple(n),r=[];for(let t=0;t<i.length;t++)r.push({id:n[t],value:i[t],keys:e[t].keys});return r}return(await this.toLiteral()).model}async toList(){return(await this._toList()).map(e=>e.value)}async getMultiple(e){return Object(s.a)(!this.referenceMode,"getMultiple not implemented for referenceMode stores"),e.map(e=>this._model.getValue(e))}async storeMultiple(e,t,n=null){Object(s.a)(!this.referenceMode,"storeMultiple not implemented for referenceMode stores"),e.map(e=>this._model.add(e.id,e,t)),this.version++}async get(e){if(this.referenceMode){const t=this._model.getValue(e);return null==t?null:(await this.ensureBackingStore(),await this.backingStore.get(t.id))}return this._model.getValue(e)}traceInfo(){return{items:this._model.size}}async store(e,t,n=null){Object(s.a)(null!=t&&t.length>0,"keys required");const i={value:e,keys:t,effective:void 0};if(this.referenceMode){const n=this.type.getContainedType(),r=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(n);i.effective=this._model.add(e.id,{id:e.id,storageKey:r},t),await this.ensureBackingStore(),await this.backingStore.store(e,t)}else i.effective=this._model.add(e.id,e,t);this.version++,await this._fire("change",new A.a({add:[i],version:this.version,originatorId:n}))}async removeMultiple(e,t=null){0===e.length&&(e=this._model.toList().map(e=>({id:e.id,keys:[]}))),e.forEach(e=>{0===e.keys.length&&(e.keys=this._model.getKeys(e.id)),e.value=this._model.getValue(e.id),null!==e.value&&(e.effective=this._model.remove(e.id,e.keys))}),this.version++,await this._fire("change",new A.a({remove:e,version:this.version,originatorId:t}))}async remove(e,t=[],n=null){0===t.length&&(t=this._model.getKeys(e));const i=this._model.getValue(e);if(null!==i){const r=this._model.remove(e,t);this.version++,await this._fire("change",new A.a({remove:[{value:i,keys:t,effective:r}],version:this.version,originatorId:n}))}}clearItemsForTesting(){this._model=new I}}class At extends It{constructor(e,t,n,i,r){super(e,n,i,r),this.localKeyId=0,this.storageEngine=t,this._stored=null,this.backingStore=null}backingType(){return this.type}async clone(){const e=new At(this.type,this.storageEngine,this.name,this.id,null);return await e.cloneFrom(this),e}async cloneFrom(e){this.referenceMode=e.referenceMode,e.referenceMode&&e.localModified&&await e._persistChanges();const t=await e.toLiteral();if(this.referenceMode&&t.model.length>0){await Promise.all([this.ensureBackingStore(),e.ensureBackingStore()]),t.model=t.model.map(({id:e,value:t})=>({id:e,value:{id:t.id,storageKey:this.backingStore.storageKey}}));const n=await e.backingStore.getMultiple(t.model.map(({id:e})=>e));await this.backingStore.storeMultiple(n,[this.storageKey])}await this.fromLiteral(t)}async modelForSynchronization(){if(this.referenceMode&&null!==this._stored){const e=this._stored;await this.ensureBackingStore();const t=await this.backingStore.get(e.id);return{version:this.version,model:[{id:e.id,value:t}]}}return super.modelForSynchronization()}async toLiteral(){const e=this._stored,t=null!=e?[{id:e.id,value:e,keys:[]}]:[];return{version:this.version,model:t}}fromLiteral({version:e,model:t}){const n=0===t.length?null:t[0].value;this.referenceMode&&n&&n.rawData&&Object(s.a)(!1,`shouldn't have rawData ${JSON.stringify(n.rawData)} here`),Object(s.a)(void 0!==n),this._stored=n,this.version=e}traceInfo(){return{stored:null!==this._stored}}async get(){if(this.referenceMode&&this._stored){const e=this._stored;return await this.ensureBackingStore(),await this.backingStore.get(e.id)}return this._stored}async set(e,t=null,n=null){if(Object(s.a)(void 0!==e),this.referenceMode&&e){const t=this.type,n=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(t);this._stored={id:e.id,storageKey:n},await this.ensureBackingStore(),await this.backingStore.store(e,[this.storageKey+this.localKeyId++])}else{if(JSON.stringify(this._stored)===JSON.stringify(e)&&null==n)return;this._stored=e}this.version++;const i=this.referenceMode?e:this._stored;await this._fire("change",new A.a({data:i,version:this.version,originatorId:t,barrier:n}))}async clear(e=null,t=null){await this.set(null,e,t)}}class qt{constructor(e,t,n,i){this.version=e,this.pageSize=n;const r=[...t];r.sort((e,t)=>e.index-t.index),this.data=r.map(e=>e.value),i||this.data.reverse()}async next(){return 0===this.data.length?{done:!0}:{value:this.data.splice(0,this.pageSize),done:!1}}close(){this.data=[]}}class Ft extends It{constructor(e,t,n,i,r){super(e,n,i,r),this.items=new Map,this.cursors=new Map,this.cursorIndex=0}enableReferenceMode(){Object(s.a)(!1,"referenceMode is not supported for BigCollection")}backingType(){return this.type.getContainedType()}async get(e){const t=this.items.get(e);return void 0!==t?t.value:null}async store(e,t,n){Object(s.a)(null!=t&&t.length>0,"keys required"),this.version++,this.items.has(e.id)||this.items.set(e.id,{index:null,value:null,keys:{}});const i=this.items.get(e.id);i.index=this.version,i.value=e,t.forEach(e=>i.keys[e]=this.version)}async remove(e,t,n){this.version++,this.items.delete(e)}async stream(e,t=!0){Object(s.a)(!isNaN(e)&&e>0),this.cursorIndex++;const n=new qt(this.version,this.items.values(),e,t);return this.cursors.set(this.cursorIndex,n),this.cursorIndex}async cursorNext(e){const t=this.cursors.get(e);if(!t)return{done:!0};const n=await t.next();return n.done&&this.cursors.delete(e),n}async cursorClose(e){const t=this.cursors.get(e);t&&(this.cursors.delete(e),t.close())}cursorVersion(e){const t=this.cursors.get(e);return t?t.version:null}async cloneFrom(e){e.items&&this.fromLiteral(e.toLiteral())}async toLiteral(){const e=[];for(const[t,{index:n,value:i,keys:r}]of this.items.entries())e.push({id:t,index:n,value:i,keys:Object.keys(r)});return{version:this.version,model:e}}fromLiteral({version:e,model:t}){this.version=e,this.items.clear();for(const{id:e,index:n,value:i,keys:r}of t){const t={};for(const e of r)t[e]=n;this.items.set(e,{index:n,value:i,keys:t})}}clearItemsForTesting(){this.items.clear()}}var Ht,Lt,Bt=n(25);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */!function(e){e[e.arc=1]="arc"}(Ht||(Ht={})),function(e){e[e.handles=1]="handles"}(Lt||(Lt={}));class zt extends D{constructor(e,t){super();const n=e.match(/^synthetic:\/\/([^\/]+)\/([^\/]+)\/(.+)$/);if(null===n||4!==n.length)throw new Error(`invalid synthetic key: ${e}`);if(this.scope=Ht[n[1]],this.category=Lt[n[2]],this.scope!==Ht.arc)throw new Error(`invalid scope '${n[1]}' for synthetic key: ${e}`);{this.targetType=new _.a;const e=t.parseStringAsKey(n[3]).childKeyForArcInfo();this.targetKey=e.toString()}if(this.category!==Lt.handles)throw new Error(`invalid category '${n[2]}' for synthetic key: ${e}`);this.syntheticType=new _.e}get protocol(){return"synthetic"}base(){return Object(s.a)(!1,"base not supported for synthetic keys"),null}get arcId(){return Object(s.a)(!1,"arcId not supported for synthetic keys"),null}childKeyForHandle(e){return Object(s.a)(!1,"childKeyForHandle not supported for synthetic keys"),null}childKeyForArcInfo(){return Object(s.a)(!1,"childKeyForArcInfo not supported for synthetic keys"),null}childKeyForSuggestions(e,t){return Object(s.a)(!1,"childKeyForSuggestions not supported for synthetic keys"),null}childKeyForSearch(e){return Object(s.a)(!1,"childKeyForSearch not supported for synthetic keys"),null}toString(){return`${this.protocol}://${Ht[this.scope]}/${Lt[this.category]}/${this.targetKey}`}}class Wt extends A.c{constructor(e,t,n,i,r){super(e,void 0,t,n),this.model=[],this.backingStore=void 0,this.targetStore=i,this.storageFactory=r,this.initialized=(async()=>{const e=await i.get();await this.process(e,!1),i.on("change",e=>this.process(e.data,!0),this)})()}async process(e,t){let n;try{if(e){const t=await Qt.parse(Bt.b.extractSerialization(e),{});n=t.activeRecipe&&t.activeRecipe.handles}}catch(e){console.warn(`Error parsing manifest at ${this.storageKey}:\n${e.message}`)}const i=this.model;this.model=[];for(const e of n||[])this.storageFactory.isPersistent(e.storageKey)&&this.model.push(new Bt.a(e.id,e.storageKey,e.mappedType,e.tags));if(t){const e=function(e,t,n){const i={add:[],remove:[]},r=new Map,o=new Map,a=new Map;for(const t of e){const e=n(t);r.set(e,t),o.set(e,t)}for(const e of t){const t=n(e);r.set(t,e),a.set(t,e)}for(const[e,t]of r)if(o.has(e)){if(a.has(e))continue;i.remove.push(t)}else Object(s.a)(a.has(e)),i.add.push(t);return i}(i,this.model,JSON.stringify),t=e.add.map(e=>({value:e})),n=e.remove.map(e=>({value:e}));await this._fire("change",new A.a({add:t,remove:n}))}}async toList(){return await this.initialized,this.model}async toLiteral(){throw new Error("unimplemented")}async cloneFrom(){throw new Error("cloneFrom should never be called on SyntheticCollection!")}async ensureBackingStore(){throw new Error("ensureBackingStore should never be called on SyntheticCollection!")}async getMultiple(e){throw new Error("unimplemented")}async storeMultiple(e,t,n){throw new Error("unimplemented")}async removeMultiple(e,t){throw new Error("unimplemented")}async get(e){throw new Error("unimplemented")}remove(e,t,n){throw new Error("unimplemented")}store(e,t,n){throw new Error("unimplemented")}}
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Ut={volatile:{storage:class extends A.b{constructor(e){super(e),this._memoryMap={},this._typeMap={},this.localIDBase=0,this.typePromiseMap={},Nt().set(this.arcId.toString(),this)}async construct(e,t,n){const i=await this._construct(e,t,n);return t instanceof _.g||t instanceof _.b?i:t.isTypeContainer()&&t.getContainedType()instanceof _.g?i:(i.enableReferenceMode(),i)}async _construct(e,t,n){const i=new Pt(n);void 0===i.arcId&&(i.arcId=this.arcId.toString()),void 0===i.location&&(i.location="volatile-"+this.localIDBase++);const r=It.newProvider(t,this,void 0,e,i.toString());return void 0!==this._memoryMap[i.toString()]?null:(this._memoryMap[i.toString()]=r,r)}async connect(e,t,n){const i=new Pt(n);return i.arcId!==this.arcId.toString()?null==Nt().get(i.arcId)?null:Nt().get(i.arcId).connect(e,t,n):void 0===this._memoryMap[n]?null:this._memoryMap[n]}baseStorageKey(e){const t=new Pt("volatile");return t.arcId=this.arcId.toString(),t.location="volatile-"+e.toString(),t.toString()}async baseStorageFor(e,t){if(this._typeMap[t])return this._typeMap[t];if(this.typePromiseMap[t])return this.typePromiseMap[t];const n=this._construct(e.toString(),e.collectionOf(),t);this.typePromiseMap[t]=n;const i=await n;return Object(s.a)(i,`could not construct baseStorage for key ${t}`),this._typeMap[t]=i,i}parseStringAsKey(e){const t=new Pt(e);return void 0===t.arcId&&(t.arcId=this.arcId.toString()),t}},isPersistent:!1},synthetic:{storage:class extends A.b{constructor(e,t){super(e),this.storageFactory=t}async construct(e,t,n){throw new Error("cannot construct SyntheticStorage providers; use connect")}async connect(e,t,n){Object(s.a)(null===t,"SyntheticStorage does not accept a type parameter");const i=new zt(n,this.storageFactory),r=await this.storageFactory.connect(e,i.targetType,i.targetKey);return null===r?null:new Wt(i.syntheticType,e,n,r,this.storageFactory)}async baseStorageFor(e,t){throw new Error("baseStorageFor not implemented for SyntheticStorage")}baseStorageKey(e,t){throw new Error("baseStorageKey not implemented for SyntheticStorage")}parseStringAsKey(e){return new zt(e,this.storageFactory)}},isPersistent:!1}};class Vt{constructor(e){this.arcId=e,this._storageInstances={},Object.keys(Ut).forEach(t=>{const{storage:n,isPersistent:i}=Ut[t];this._storageInstances[t]={storage:new n(e,this),isPersistent:i}})}static register(e,t){Ut[e]=t}getInstance(e){const t=this._storageInstances[e.split(":")[0]];if(!t)throw new Error(`unknown storage protocol: ${e}`);return t}_storageForKey(e){if(!e)throw new Error("key is required");return this.getInstance(e).storage}isPersistent(e){return e&&this.getInstance(e).isPersistent}async construct(e,t,n){return await this._storageForKey(n).construct(e,t,n)}async connect(e,t,n){return await this._storageForKey(n).connect(e,t,n)}async connectOrConstruct(e,t,n){const i=this._storageForKey(n);let r=await i.connect(e,t,n);return null==r&&(r=await i.construct(e,t,n)),r}async baseStorageFor(e,t){return await this._storageForKey(t).baseStorageFor(e,t)}baseStorageKey(e,t){return this._storageForKey(t).baseStorageKey(e,t)}parseStringAsKey(e){return this._storageForKey(e).parseStringAsKey(e)}newKey(e,t){}async shutdown(){for(const e of Object.values(this._storageInstances))await e.storage.shutdown()}}n.d(t,"b",function(){return Jt}),n.d(t,"a",function(){return Qt});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Kt extends Error{constructor(e,t){super(t),this.location=e}}class Jt{constructor(e,t,n,i,r,s){this.referenceMode=!1,this.type=e,this.id=t,this.name=n,this.storageKey=i,this.storageProviderFactory=r,this.originalId=s}get version(){}get description(){}async inflate(){const e=await this.storageProviderFactory.connect(this.id,this.type,this.storageKey);return Object(s.a)(null!=e,"inflating missing storageKey "+this.storageKey),e.originalId=this.originalId,e}toLiteral(){}toString(e){const t=[],n=[];return n.push("store"),this.name&&n.push(`${this.name}`),n.push(`of ${this.type.toString()}`),this.id&&n.push(`'${this.id}'`),e&&e.length&&n.push(`${e.join(" ")}`),t.push(n.join(" ")),this.description&&t.push(`  description \`${this.description}\``),t.join("\n")}_compareTo(e){let t;return 0!==(t=Object(p.d)(this.name,e.name))?t:0!==(t=Object(p.d)(this.id,e.id))?t:0}}class Gt{traverse(e){if(["string","number","boolean"].includes(typeof e)||null===e)return;if(e instanceof Array){for(const t of e)this.traverse(t);return}Object(s.a)(e.location,"expected manifest node to have `location`"),Object(s.a)(e.kind,"expected manifest node to have `kind`");let t=!1;const n=()=>{if(!t){t=!0;for(const t of Object.keys(e))["location","kind","model"].includes(t)||this.traverse(e[t])}};this.visit(e,n),n()}visit(e,t){}}const Zt=new Set;class Qt{constructor({id:e}){if(this._recipes=[],this._imports=[],this._particles={},this._schemas={},this._stores=[],this._interfaces=[],this.storeTags=new Map,this._fileName=null,this._idGenerator=l.c.newSession(),this._storageProviderFactory=void 0,this._meta=new h,this._resources={},this.storeManifestUrls=new Map,this.errors=[],Object(s.a)(e instanceof l.b||"string"==typeof e),e instanceof l.b)this._id=e;else{const t=e.split(":");this._id=l.b._newIdInternal(t[0],t.slice(1))}}get id(){return this._meta.name?l.b.fromString(this._meta.name):this._id}get storageProviderFactory(){return null==this._storageProviderFactory&&(this._storageProviderFactory=new Vt(this.id)),this._storageProviderFactory}get recipes(){return this._recipes}get allRecipes(){return[...new Set(this._findAll(e=>e._recipes))]}get activeRecipe(){return this._recipes.find(e=>"active"===e.annotation)}get particles(){return Object.values(this._particles)}get allParticles(){return[...new Set(this._findAll(e=>Object.values(e._particles)))]}get imports(){return this._imports}get schemas(){return this._schemas}get fileName(){return this._fileName}get stores(){return this._stores}get allStores(){return[...this._findAll(e=>e._stores)]}get interfaces(){return this._interfaces}get meta(){return this._meta}get resources(){return this._resources}applyMeta(e){void 0!==this._storageProviderFactory&&Object(s.a)(e.name===this._meta.name||null==e.name,"can't change manifest ID after storage is constructed"),this._meta.apply(e)}async createStore(e,t,n,i,r){const o=await this.storageProviderFactory.construct(n,e,r||`volatile://${this.id}`);return Object(s.a)(null!==o.version),o.name=t,this.storeManifestUrls.set(o.id,this.fileName),this._addStore(o,i)}_addStore(e,t){return this._stores.push(e),this.storeTags.set(e,t||[]),e}newStorageStub(e,t,n,i,r,s){return this._addStore(new Jt(e,n,t,i,this.storageProviderFactory,s),r)}_find(e){let t=e(this);if(!t)for(const n of this._imports)if(t=n._find(e))break;return t}*_findAll(e){yield*e(this);for(const t of this._imports)yield*t._findAll(e)}findSchemaByName(e){return this._find(t=>t._schemas[e])}findTypeByName(e){const t=this.findSchemaByName(e);if(t)return new _.d(t);const n=this.findInterfaceByName(e);return n?new _.f(n):void 0}findParticleByName(e){return this._find(t=>t._particles[e])}findParticlesByVerb(e){return[...this._findAll(t=>Object.values(t._particles).filter(t=>t.primaryVerb===e))]}findStoreByName(e){return this._find(t=>t._stores.find(t=>t.name===e))}findStoreById(e){return this._find(t=>t._stores.find(t=>t.id===e))}findStoreTags(e){return this._find(t=>t.storeTags.get(e))}findManifestUrlForHandleId(e){return this._find(t=>t.storeManifestUrls.get(e))}findStoresByType(e,t={tags:[],subtype:!1}){const n=t.tags||[],i=t.subtype||!1;return[...this._findAll(t=>t._stores.filter(r=>(function(t){const n=e.resolvedType();if(!n.isResolved())return e instanceof _.c==t.type instanceof _.c&&e instanceof _.b==t.type instanceof _.b;if(i){const[e,i]=_.j.unwrapPair(t.type,n);return e instanceof _.d&&i instanceof _.d&&e.entitySchema.isMoreSpecificThan(i.entitySchema)}return S.a.compareTypes({type:t.type},{type:e})})(r)&&function(e,t){return 0===n.filter(n=>!e.storeTags.get(t).includes(n)).length}(t,r)))].filter(t=>!!C.effectiveType(e,[{type:t.type,direction:t.type instanceof _.f?"host":"inout"}]))}findInterfaceByName(e){return this._find(t=>t._interfaces.find(t=>t.name===e))}findRecipesByVerb(e){return[...this._findAll(t=>t._recipes.filter(t=>t.verbs.includes(e)))]}generateID(){return this._idGenerator.newChildId(this.id)}static async load(e,t,n){n=n||{};let{registry:i,id:r}=n;return(i=i||{})&&i[e]?await i[e]:(i[e]=(async()=>{const n=await t.loadResource(e);return Object(s.a)(void 0!==n,`${e} unable to be loaded by Manifest parser`),await Qt.parse(n,{id:r,fileName:e,loader:t,registry:i})})(),await i[e])}static getErrors(e){return e.errors}static async parse(e,t){t=t||{};let{session_id:n,fileName:i,loader:s,registry:o,context:a,throwImportErrors:c}=t;o=o||{};const l=`manifest:${i}:`;function u(e){for(const t of e.errors){if(t.key){if(Zt.has(t.key))continue;Zt.add(t.key)}console.warn(h(t).message)}}function h(t,n){return t instanceof Kt||t.location?function(t,n){const r=e.split("\n")[t.location.start.line-1];let s=t.message||"";if(r){let e=1;e=t.location.end.line===t.location.start.line?t.location.end.column-t.location.start.column:r.length-t.location.start.column,e=Math.max(1,e);let o,a="";for(let e=0;e<t.location.start.column-1;e++)a+=" ";for(let t=0;t<e;t++)a+="^";s=`${o=n?"Parse error in":"Post-parse processing error caused by"} '${i}' line ${t.location.start.line}.\n${t.message}\n  ${r}\n  ${a}`}const o=new Kt(t.location,s);n||(o.stack=t.stack);return o}(t,n):t}let d=[];try{d=r(e)}catch(e){throw h(e,!0)}const p=new Qt({id:l});p._fileName=i,a&&p._imports.push(a);try{await Promise.all(d.map(async e=>{if("import"===e.kind){const t=s.path(p.fileName),n=s.join(t,e.path);try{p._imports.push(await Qt.load(n,s,{registry:o}))}catch(t){p.errors.push(t),p.errors.push(new Kt(e.location,`Error importing '${n}'`))}}}));const e=async(e,t)=>{for(const n of d)n.kind===e&&(Qt._augmentAstWithTypes(p,n),await t(n))};await e("meta",e=>p.applyMeta(e.items)),await e("resource",e=>this._processResource(p,e)),await e("schema",e=>this._processSchema(p,e)),await e("interface",e=>this._processInterface(p,e)),await e("particle",e=>this._processParticle(p,e,s)),await e("store",e=>this._processStore(p,e,s)),await e("recipe",e=>this._processRecipe(p,e,s))}catch(e){throw u(p),h(e,!1)}if(u(p),t.throwImportErrors&&p.errors.length>0)throw p.errors[0];return p}static _augmentAstWithTypes(e,t){(new class extends Gt{constructor(){super()}visit(t,n){switch(n(),t.kind){case"schema-inline":{const n=[],i=[],r=[];for(const s of t.names){const t=e.resolveTypeName(s);t&&t.schema&&t.schema.isAlias?i.push(t.schema):r.push(s),t&&t.schema&&n.push(t.schema)}const s={};for(let{name:e,type:i}of t.fields){for(const r of n)if(i){const n=r.fields[e];if(n&&!N.a.typesEqual(n,i))throw new Kt(t.location,`Type of '${e}' does not match schema (${i} vs ${n})`)}else i=r.fields[e];if(!i)throw new Kt(t.location,`Could not infer type of '${e}' field`);s[e]=i}let o=new N.a(r,s);for(const e of i)if(!(o=N.a.union(e,o)))throw new Kt(t.location,"Could not merge schema aliases");return void(t.model=new _.d(o))}case"variable-type":{const e=t.constraint&&t.constraint.model;return void(t.model=_.k.make(t.name,e,null))}case"slot-type":{const e={};for(const n of Object.keys(t.fields)){const i=t.fields[n];e[i.name]=i.value}return void(t.model=_.i.make(e.formFactor,e.handle))}case"type-name":{const n=e.resolveTypeName(t.name);if(!n)throw new Kt(t.location,`Could not resolve type reference to type name '${t.name}'`);if(n.schema)t.model=new _.d(n.schema);else{if(!n.iface)throw new Kt(t.location,"Expected {iface} or {schema}");t.model=new _.f(n.iface)}return}case"collection-type":return void(t.model=new _.c(t.type.model));case"big-collection-type":return void(t.model=new _.b(t.type.model));case"reference-type":return void(t.model=new _.g(t.type.model));default:return}}}).traverse(t)}static _processSchema(e,t){let n;const i={};let r=[...t.names];for(const e of t.items)switch(e.kind){case"schema-field":{const t=e;if(i[t.name])throw new Kt(t.location,`Duplicate definition of field '${t.name}'`);i[t.name]=t.type;break}case"description":if(n)throw new Kt(e.location,"Duplicate schema description");n=e;break;default:throw new Kt(e.location,`unknown parser artifact ${e.kind} while processing schema`)}for(const n of t.parents){const s=e.findSchemaByName(n);if(!s)throw new Kt(t.location,`Could not find parent schema '${n}'`);for(const[e,r]of Object.entries(s.fields))if(i[e]&&!N.a.typesEqual(i[e],r))throw new Kt(t.location,`'${n}' defines incompatible type for field '${e}'`);Object.assign(i,s.fields),r.push(...s.names)}r=[r[0],...r.filter(e=>e!==r[0])];const s=t.alias||r[0];if(!s)throw new Kt(t.location,"Schema defined without name or alias");const o=new N.a(r,i,n);t.alias&&(o.isAlias=!0),e._schemas[s]=o}static _processResource(e,t){e._resources[t.name]=t.data}static _processParticle(e,t,n){if(Object(s.a)(null==t.implFile||null!==t.args,"no valid body defined for this particle"),t.args||(t.args=[]),t.hasParticleArgument){const n=new Kt(t.location,"Particle uses deprecated argument body");n.key="hasParticleArgument",e._warnings.push(n)}t.implFile&&n&&(t.implFile=n.join(e.fileName,t.implFile));const i=e=>{for(const t of e)t.type=t.type.model,i(t.dependentConnections)};i(t.args),e._particles[t.name]=new d.a(t)}static _processInterface(e,t){const n=[];for(const e of t.args){const t={name:void 0,type:void 0,direction:e.direction};"*"!==e.name&&(t.name=e.name),e.type&&(t.type=e.type.model),n.push(t)}const i=[];for(const e of t.slots)i.push({direction:e.direction,name:e.name,isRequired:e.isRequired,isSet:e.isSet});const r=new u.a(t.name,n,i);e._interfaces.push(r)}static _processRecipe(e,t,n){const i=e._newRecipe(t.name);t.annotation&&(i.annotation=t.annotation),t.verbs&&(i.verbs=t.verbs),this._buildRecipe(e,i,t.items)}static _buildRecipe(e,t,n){const i={require:n.filter(e=>"require"===e.kind),handles:n.filter(e=>"handle"===e.kind),byHandle:new Map,requireHandles:n.filter(e=>"requireHandle"===e.kind),byRequireHandle:new Map,particles:n.filter(e=>"particle"===e.kind),byParticle:new Map,slots:n.filter(e=>"slot"===e.kind),bySlot:new Map,byName:new Map,connections:n.filter(e=>"connection"===e.kind),search:n.find(e=>"search"===e.kind),description:n.find(e=>"description"===e.kind)};Object(s.a)(!(i.handles.length>0&&i.requireHandles.length>0),"Inconsistent handle definitions");const r=i.handles.length>0?i.handles:i.requireHandles;for(const n of r){const r=t.newHandle(),o=n.ref;if(o.id){r.id=o.id;const t=e.findStoreById(r.id);t&&r.mapToStorage(t)}else if(o.name){const t=e.findStoreByName(o.name);Object(s.a)(t,`Could not find handle ${o.name}`),r.mapToStorage(t)}r.tags=o.tags,n.name&&(Object(s.a)(!i.byName.has(n.name),`duplicate handle name: ${n.name}`),r.localName=n.name,i.byName.set(n.name,{item:n,handle:r})),r.fate=n.fate?n.fate:null,i.byHandle.set(r,n)}const o=(t,n)=>{switch(n.targetType){case"particle":{const i=e.findParticleByName(n.particle);if(!i)throw new Kt(t.location,`could not find particle '${n.particle}'`);if(null!==n.param&&!i.handleConnectionMap.has(n.param))throw new Kt(t.location,`param '${n.param}' is not defined by '${n.particle}'`);return new m(i,n.param)}case"localName":if(!i.byName.has(n.name))throw new Kt(t.location,`local name '${n.name}' does not exist in recipe`);if(null==n.param&&0===n.tags.length&&i.byName.get(n.name).handle)return new y(i.byName.get(n.name).handle);throw new Kt(t.location,"references to particles by local name not yet supported");case"tag":return new v(n.tags);default:throw new Kt(t.location,`endpoint ${n.targetType} not supported`)}};for(const e of i.connections){const n=o(e,e.from),i=o(e,e.to);t.newConnectionConstraint(n,i,e.direction)}i.search&&(t.search=new E(i.search.phrase,i.search.tokens));for(const e of i.slots){const n=t.newSlot(void 0);e.ref.id&&(n.id=e.ref.id),e.ref.tags&&(n.tags=e.ref.tags),e.name&&(Object(s.a)(!i.byName.has(e.name),`Duplicate slot local name ${e.name}`),n.localName=e.name,i.byName.set(e.name,n)),i.bySlot.set(n,e)}for(const n of i.particles){const r=t.newParticle(n.ref.name);if(r.verbs=n.ref.verbs,!(t instanceof M)&&n.ref.name){const t=e.findParticleByName(n.ref.name);if(!t)throw new Kt(n.location,`could not find particle ${n.ref.name}`);r.spec=t.clone()}n.name&&(Object(s.a)(!i.byName.has(n.name)),r.localName=n.name,i.byName.set(n.name,{item:n,particle:r})),i.byParticle.set(r,n);for(const e of n.slotConnections){if("provide"===e.direction)throw new Kt(n.location,"invalid slot connection: provide slot must be dependent");let o=r.consumedSlotConnections[e.param];if(!o){if(void 0!==r.spec){if(!r.spec.slotConnections.has(e.param))throw new Kt(e.location,`Consumed slot '${e.param}' is not defined by '${r.name}'`);e.dependentSlotConnections.forEach(e=>{if(!r.getSlotSpecByName(e.param))throw new Kt(e.location,`Provided slot '${e.param}' is not defined by '${r.name}'`)})}o=r.addSlotConnection(e.param)}o.tags=e.tags||[],e.dependentSlotConnections.forEach(e=>{if("consume"===e.direction)throw new Kt(n.location,"invalid slot connection: consume slot must not be dependent");if(0!==e.dependentSlotConnections.length)throw new Kt(n.location,"invalid slot connection: provide slot must not have dependencies");if(t instanceof M){const n=t.parent.slots.find(t=>t.localName===e.name);void 0!==n&&(o.providedSlots[e.param]=n,n.sourceConnection=o,n.name=e.param)}let r=o.providedSlots[e.param];if(r){if(e.name)if(i.byName.has(e.name)){const n=i.byName.get(e.name);Object(s.a)(n!==r),Object(s.a)(!n.name&&r),Object(s.a)(!n.sourceConnection&&r.sourceConnection),r.id=n.id,r.tags=n.tags,i.byName.set(e.name,r),t.removeSlot(n)}else i.byName.set(e.name,r);i.bySlot.set(r,e)}else r=i.byName.get(e.name);r||((r=t.newSlot(e.param)).localName=e.name,r.sourceConnection=o,e.name&&(Object(s.a)(!i.byName.has(e.name)),i.byName.set(e.name,r)),i.bySlot.set(r,e)),o.providedSlots[e.param]||(o.providedSlots[e.param]=r),r.localName=e.name})}}for(const[n,r]of i.byParticle){for(const s of r.connections){let r;"*"===s.param?r=n.addUnnamedConnection():(r=n.connections[s.param])||(r=n.addConnectionName(s.param)),r.tags=s.target?s.target.tags:[];const o={"->":"out","<-":"in","=":"inout",consume:"`consume",provide:"`provide"}[s.dir];if(r.direction){if(!(r.direction===o||"inout"===o||"host"===r.direction&&"in"===o||"`consume"===r.direction&&"in"===o||"`provide"===r.direction&&"out"===o))throw new Kt(s.location,`'${s.dir}' not compatible with '${r.direction}' param of '${n.name}'`)}else{if("*"!==s.param&&void 0!==n.spec)throw new Kt(s.location,`param '${s.param}' is not defined by '${n.name}'`);r.direction=o}let a,c;if(s.target&&s.target.name){let e=i.byName.get(s.target.name);if(e){if(!e.item)throw new Kt(s.location,`did not expect '${e}' expected handle or particle`)}else{const n=t.newHandle();n.tags=[],n.localName=s.target.name,n.fate="create",n.item={kind:"handle"},e={item:n.item,handle:n},i.byName.set(n.localName,e),i.byHandle.set(n,n.item)}if("handle"===e.item.kind||"requireHandle"===e.item.kind)a=e.handle;else{if("particle"!==e.item.kind)throw new Kt(s.location,`did not expect ${e.item.kind}`);c=e.particle}}if(s.target&&s.target.particle){const t=e.findParticleByName(s.target.particle);if(!t)throw new Kt(s.target.location,`Could not find hosted particle '${s.target.particle}'`);if(!(a=P.constructImmediateValueHandle(r,t,e.generateID())))throw new Kt(s.target.location,`Hosted particle '${t.name}' does not match interface '${r.name}'`)}if(c){let e;s.target.param?(e=c.connections[s.target.param])||(e=c.addConnectionName(s.target.param)):e=c.addUnnamedConnection(),(a=e.handle)||(a=t.newHandle(),e.connectToHandle(a))}a&&r.connectToHandle(a)}for(const e of r.slotConnections){let r=i.byName.get(e.name);r?(Object(s.a)(i.bySlot.has(r)),r.name||(r.name=e.param),Object(s.a)(r===i.byName.get(e.name),`Target slot ${r.name} doesn't match slot connection ${e.param}`)):e.name&&(t instanceof M&&void 0!==(r=t.parent.slots.find(t=>t.localName===e.name))&&(i.bySlot.set(r,e),e.name&&i.byName.set(e.name,r)),null==r&&((r=t.newSlot(e.param)).localName=e.name,i.byName.set(e.name,r),i.bySlot.set(r,e))),r&&n.consumedSlotConnections[e.param].connectToSlot(r)}}if(i.description&&i.description.description&&(t.description=i.description.description),i.require)for(const n of i.require){const i=t.newRequireSection();this._buildRecipe(e,i,n.items)}}resolveTypeName(e){const t=this.findSchemaByName(e);if(t)return{schema:t};const n=this.findInterfaceByName(e);return n?{iface:n}:null}static async _processStore(e,t,n){const i=t.name;let r=t.id;const s=t.originalId,o=t.type.model;null==r&&(r=`${e._id}store${e._stores.length}`);let a,l,u,h,d=t.tags;if(null==d&&(d=[]),"storage"===t.origin)return void e.newStorageStub(o,i,r,t.source,d,s);if("file"===t.origin)t.source=n.join(e.fileName,t.source),a=await n.loadResource(t.source);else if("resource"===t.origin&&(l=t.source,null==(a=e.resources[l])))throw new Kt(t.location,`Resource '${l}' referenced by store '${r}' is not defined in this manifest`);try{u=JSON.parse(a)}catch(e){throw new Kt(t.location,`Error parsing JSON from '${l}' (${e.message})'`)}if(o instanceof _.c)h=o.collectionType;else if(o instanceof _.b)h=o.bigCollectionType;else{if(0===u.length)return void await Qt._createStore(e,o,i,r,d,t,s);u=u.slice(u.length-1),h=o}if(h instanceof _.d){let n=!1;if(u=u.map(t=>{if(null==t)return null;n=n||t.$id;const i=t.$id||e.generateID().toString();return delete t.$id,{id:i,rawData:t}}),!t.id&&!n){r=`${r}:${await c(JSON.stringify(u.map(e=>e.rawData)))}`}}const p=t.version||0,f=await Qt._createStore(e,o,i,r,d,t,s);if(u.length>0&&u[0].rawData&&u[0].rawData.storageKey){let t=u[0].rawData.storageKey;t=e.findStoreByName(t).storageKey,u=u.map(({id:e,rawData:n})=>({id:e,storageKey:t}))}else u.length>0&&(f.referenceMode=!1);let m;m=o instanceof _.c?u.map(e=>({id:e.id,value:e,keys:new Set([e.id])})):o instanceof _.b?u.map(e=>{const t=e.rawData.$index;return delete e.rawData.$index,{id:e.id,index:t,value:e,keys:new Set([e.id])}}):u.map(e=>({id:e.id,value:e})),await f.fromLiteral({version:p,model:m})}static async _createStore(e,t,n,i,r,s,o){const a=await e.createStore(t,n,i,r);return a.source=s.source,a.description=s.description,a.originalId=o,a}_newRecipe(e){const t=new j(e);return this._recipes.push(t),t}toString(e){e=e||{};const t=[];return this._imports.forEach(n=>{if(e.recursive){t.push(`// import '${n.fileName}'`);n.toString(e);t.push(`${n.toString(e)}`)}else t.push(`import '${n.fileName}'`)}),Object.values(this._schemas).forEach(e=>{t.push(e.toManifestString())}),Object.values(this._particles).forEach(e=>{t.push(e.toString())}),this._recipes.forEach(n=>{t.push(n.toString(e))}),[...this.stores].sort(p.b).forEach(e=>{t.push(e.toString(this.storeTags.get(e).map(e=>`#${e}`)))}),t.join("\n")}get idGeneratorForTesting(){return this._idGenerator}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(41);var r;!function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.serverErrorStart=-32099,e.serverErrorEnd=-32e3,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.RequestCancelled=-32800,e.MessageWriteError=1,e.MessageReadError=2}(r=t.ErrorCodes||(t.ErrorCodes={}));class s extends Error{constructor(e,t,n){super(t),this.code=i.number(e)?e:r.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,s.prototype)}toJson(){return{code:this.code,message:this.message,data:this.data}}}t.ResponseError=s;class o{constructor(e,t){this._method=e,this._numberOfParams=t}get method(){return this._method}get numberOfParams(){return this._numberOfParams}}t.AbstractMessageType=o;t.RequestType0=class extends o{constructor(e){super(e,0),this._=void 0}};t.RequestType=class extends o{constructor(e){super(e,1),this._=void 0}};t.RequestType1=class extends o{constructor(e){super(e,1),this._=void 0}};t.RequestType2=class extends o{constructor(e){super(e,2),this._=void 0}};t.RequestType3=class extends o{constructor(e){super(e,3),this._=void 0}};t.RequestType4=class extends o{constructor(e){super(e,4),this._=void 0}};t.RequestType5=class extends o{constructor(e){super(e,5),this._=void 0}};t.RequestType6=class extends o{constructor(e){super(e,6),this._=void 0}};t.RequestType7=class extends o{constructor(e){super(e,7),this._=void 0}};t.RequestType8=class extends o{constructor(e){super(e,8),this._=void 0}};t.RequestType9=class extends o{constructor(e){super(e,9),this._=void 0}};t.NotificationType=class extends o{constructor(e){super(e,1),this._=void 0}};t.NotificationType0=class extends o{constructor(e){super(e,0),this._=void 0}};t.NotificationType1=class extends o{constructor(e){super(e,1),this._=void 0}};t.NotificationType2=class extends o{constructor(e){super(e,2),this._=void 0}};t.NotificationType3=class extends o{constructor(e){super(e,3),this._=void 0}};t.NotificationType4=class extends o{constructor(e){super(e,4),this._=void 0}};t.NotificationType5=class extends o{constructor(e){super(e,5),this._=void 0}};t.NotificationType6=class extends o{constructor(e){super(e,6),this._=void 0}};t.NotificationType7=class extends o{constructor(e){super(e,7),this._=void 0}};t.NotificationType8=class extends o{constructor(e){super(e,8),this._=void 0}};t.NotificationType9=class extends o{constructor(e){super(e,9),this._=void 0}},t.isRequestMessage=function(e){let t=e;return t&&i.string(t.method)&&(i.string(t.id)||i.number(t.id))},t.isNotificationMessage=function(e){let t=e;return t&&i.string(t.method)&&void 0===e.id},t.isResponseMessage=function(e){let t=e;return t&&(void 0!==t.result||!!t.error)&&(i.string(t.id)||i.number(t.id)||null===t.id)}},,,,function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("vm")},function(e,t,n){"use strict";function i(e){return"string"==typeof e||e instanceof String}function r(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.boolean=function(e){return!0===e||!1===e},t.string=i,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=function(e){return"function"==typeof e},t.array=r,t.stringArray=function(e){return r(e)&&e.every(e=>i(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.prototype.toString;function r(e){return"[object String]"===i.call(e)}function s(e){return Array.isArray(e)}t.boolean=function(e){return!0===e||!1===e},t.string=r,t.number=function(e){return"[object Number]"===i.call(e)},t.error=function(e){return"[object Error]"===i.call(e)},t.func=function(e){return"[object Function]"===i.call(e)},t.array=s,t.stringArray=function(e){return s(e)&&e.every(function(e){return r(e)})}},function(e,t){e.exports=require("https")},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});const r=n(41),s=n(35);t.RequestType=s.RequestType,t.RequestType0=s.RequestType0,t.RequestType1=s.RequestType1,t.RequestType2=s.RequestType2,t.RequestType3=s.RequestType3,t.RequestType4=s.RequestType4,t.RequestType5=s.RequestType5,t.RequestType6=s.RequestType6,t.RequestType7=s.RequestType7,t.RequestType8=s.RequestType8,t.RequestType9=s.RequestType9,t.ResponseError=s.ResponseError,t.ErrorCodes=s.ErrorCodes,t.NotificationType=s.NotificationType,t.NotificationType0=s.NotificationType0,t.NotificationType1=s.NotificationType1,t.NotificationType2=s.NotificationType2,t.NotificationType3=s.NotificationType3,t.NotificationType4=s.NotificationType4,t.NotificationType5=s.NotificationType5,t.NotificationType6=s.NotificationType6,t.NotificationType7=s.NotificationType7,t.NotificationType8=s.NotificationType8,t.NotificationType9=s.NotificationType9;const o=n(56);t.MessageReader=o.MessageReader,t.StreamMessageReader=o.StreamMessageReader,t.IPCMessageReader=o.IPCMessageReader,t.SocketMessageReader=o.SocketMessageReader;const a=n(57);t.MessageWriter=a.MessageWriter,t.StreamMessageWriter=a.StreamMessageWriter,t.IPCMessageWriter=a.IPCMessageWriter,t.SocketMessageWriter=a.SocketMessageWriter;const c=n(49);t.Disposable=c.Disposable,t.Event=c.Event,t.Emitter=c.Emitter;const l=n(121);t.CancellationTokenSource=l.CancellationTokenSource,t.CancellationToken=l.CancellationToken;const u=n(122);var h,d,p,f,m,g,y;i(n(123)),i(n(124)),function(e){e.type=new s.NotificationType("$/cancelRequest")}(h||(h={})),t.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}}),function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Verbose=2]="Verbose"}(d=t.Trace||(t.Trace={})),function(e){e.fromString=function(t){switch(t=t.toLowerCase()){case"off":return e.Off;case"messages":return e.Messages;case"verbose":return e.Verbose;default:return e.Off}},e.toString=function(t){switch(t){case e.Off:return"off";case e.Messages:return"messages";case e.Verbose:return"verbose";default:return"off"}}}(d=t.Trace||(t.Trace={})),function(e){e.Text="text",e.JSON="json"}(p=t.TraceFormat||(t.TraceFormat={})),function(e){e.fromString=function(t){return"json"===(t=t.toLowerCase())?e.JSON:e.Text}}(p=t.TraceFormat||(t.TraceFormat={})),function(e){e.type=new s.NotificationType("$/setTraceNotification")}(f=t.SetTraceNotification||(t.SetTraceNotification={})),function(e){e.type=new s.NotificationType("$/logTraceNotification")}(m=t.LogTraceNotification||(t.LogTraceNotification={})),function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"}(g=t.ConnectionErrors||(t.ConnectionErrors={}));class v extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,v.prototype)}}function b(e,t,n,i){let o=0,a=0,b=0;const _="2.0";let w,S,C=void 0,T=Object.create(null),k=void 0,R=Object.create(null),x=new u.LinkedMap,E=Object.create(null),O=Object.create(null),j=d.Off,M=p.Text,$=y.New,P=new c.Emitter,N=new c.Emitter,I=new c.Emitter,D=new c.Emitter;function A(e){return"req-"+e.toString()}function q(e,t){var n;s.isRequestMessage(t)?e.set(A(t.id),t):s.isResponseMessage(t)?e.set(null===(n=t.id)?"res-unknown-"+(++b).toString():"res-"+n.toString(),t):e.set("not-"+(++a).toString(),t)}function F(e){}function H(){return $===y.Listening}function L(){return $===y.Closed}function B(){return $===y.Disposed}function z(){$!==y.New&&$!==y.Listening||($=y.Closed,N.fire(void 0))}function W(){w||0===x.size||(w=setImmediate(()=>{w=void 0,function(){if(0===x.size)return;let e=x.shift();try{s.isRequestMessage(e)?function(e){if(B())return;function n(n,i,r){let o={jsonrpc:_,id:e.id};n instanceof s.ResponseError?o.error=n.toJson():o.result=void 0===n?null:n,V(o,i,r),t.write(o)}function i(n,i,r){let s={jsonrpc:_,id:e.id,error:n.toJson()};V(s,i,r),t.write(s)}!function(e){if(j===d.Off||!S)return;if(M===p.Text){let t=void 0;j===d.Verbose&&e.params&&(t=`Params: ${JSON.stringify(e.params,null,4)}\n\n`),S.log(`Received request '${e.method} - (${e.id})'.`,t)}else K("receive-request",e)}(e);let o,a,c=T[e.method];c&&(o=c.type,a=c.handler);let u=Date.now();if(a||C){let c=new l.CancellationTokenSource,h=String(e.id);O[h]=c;try{let l,d=l=void 0===e.params||void 0!==o&&0===o.numberOfParams?a?a(c.token):C(e.method,c.token):r.array(e.params)&&(void 0===o||o.numberOfParams>1)?a?a(...e.params,c.token):C(e.method,...e.params,c.token):a?a(e.params,c.token):C(e.method,e.params,c.token);l?d.then?d.then(t=>{delete O[h],n(t,e.method,u)},t=>{delete O[h],t instanceof s.ResponseError?i(t,e.method,u):t&&r.string(t.message)?i(new s.ResponseError(s.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,u):i(new s.ResponseError(s.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,u)}):(delete O[h],n(l,e.method,u)):(delete O[h],function(n,i,r){void 0===n&&(n=null);let s={jsonrpc:_,id:e.id,result:n};V(s,i,r),t.write(s)}(l,e.method,u))}catch(t){delete O[h],t instanceof s.ResponseError?n(t,e.method,u):t&&r.string(t.message)?i(new s.ResponseError(s.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,u):i(new s.ResponseError(s.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,u)}}else i(new s.ResponseError(s.ErrorCodes.MethodNotFound,`Unhandled method ${e.method}`),e.method,u)}(e):s.isNotificationMessage(e)?function(e){if(B())return;let t,i=void 0;if(e.method===h.type.method)t=(e=>{let t=e.id,n=O[String(t)];n&&n.cancel()});else{let n=R[e.method];n&&(t=n.handler,i=n.type)}if(t||k)try{!function(e){if(j===d.Off||!S||e.method===m.type.method)return;if(M===p.Text){let t=void 0;j===d.Verbose&&(t=e.params?`Params: ${JSON.stringify(e.params,null,4)}\n\n`:"No parameters provided.\n\n"),S.log(`Received notification '${e.method}'.`,t)}else K("receive-notification",e)}(e),void 0===e.params||void 0!==i&&0===i.numberOfParams?t?t():k(e.method):r.array(e.params)&&(void 0===i||i.numberOfParams>1)?t?t(...e.params):k(e.method,...e.params):t?t(e.params):k(e.method,e.params)}catch(t){t.message?n.error(`Notification handler '${e.method}' failed with message: ${t.message}`):n.error(`Notification handler '${e.method}' failed unexpectedly.`)}else I.fire(e)}(e):s.isResponseMessage(e)?function(e){if(B())return;if(null===e.id)e.error?n.error(`Received response message without id: Error is: \n${JSON.stringify(e.error,void 0,4)}`):n.error("Received response message without id. No further error information provided.");else{let t=String(e.id),i=E[t];if(function(e,t){if(j===d.Off||!S)return;if(M===p.Text){let n=void 0;if(j===d.Verbose&&(e.error&&e.error.data?n=`Error data: ${JSON.stringify(e.error.data,null,4)}\n\n`:e.result?n=`Result: ${JSON.stringify(e.result,null,4)}\n\n`:void 0===e.error&&(n="No result returned.\n\n")),t){let i=e.error?` Request failed: ${e.error.message} (${e.error.code}).`:"";S.log(`Received response '${t.method} - (${e.id})' in ${Date.now()-t.timerStart}ms.${i}`,n)}else S.log(`Received response ${e.id} without active response promise.`,n)}else K("receive-response",e)}(e,i),i){delete E[t];try{if(e.error){let t=e.error;i.reject(new s.ResponseError(t.code,t.message,t.data))}else{if(void 0===e.result)throw new Error("Should never happen.");i.resolve(e.result)}}catch(e){e.message?n.error(`Response handler '${i.method}' failed with message: ${e.message}`):n.error(`Response handler '${i.method}' failed unexpectedly.`)}}}}(e):function(e){if(!e)return void n.error("Received empty message.");n.error(`Received message which is neither a response nor a notification message:\n${JSON.stringify(e,null,4)}`);let t=e;if(r.string(t.id)||r.number(t.id)){let e=String(t.id),n=E[e];n&&n.reject(new Error("The received response has neither a result nor an error property."))}}(e)}finally{W()}}()}))}e.onClose(z),e.onError(function(e){P.fire([e,void 0,void 0])}),t.onClose(z),t.onError(function(e){P.fire(e)});let U=e=>{try{if(s.isNotificationMessage(e)&&e.method===h.type.method){let n=A(e.params.id),r=x.get(n);if(s.isRequestMessage(r)){let s=i&&i.cancelUndispatched?i.cancelUndispatched(r,F):void 0;if(s&&(void 0!==s.error||void 0!==s.result))return x.delete(n),s.id=r.id,V(s,e.method,Date.now()),void t.write(s)}}q(x,e)}finally{W()}};function V(e,t,n){if(j!==d.Off&&S)if(M===p.Text){let i=void 0;j===d.Verbose&&(e.error&&e.error.data?i=`Error data: ${JSON.stringify(e.error.data,null,4)}\n\n`:e.result?i=`Result: ${JSON.stringify(e.result,null,4)}\n\n`:void 0===e.error&&(i="No result returned.\n\n")),S.log(`Sending response '${t} - (${e.id})'. Processing request took ${Date.now()-n}ms`,i)}else K("send-response",e)}function K(e,t){if(!S||j===d.Off)return;const n={isLSPMessage:!0,type:e,message:t,timestamp:Date.now()};S.log(n)}function J(){if(L())throw new v(g.Closed,"Connection is closed.");if(B())throw new v(g.Disposed,"Connection is disposed.")}function G(e){return void 0===e?null:e}function Z(e,t){let n,i=e.numberOfParams;switch(i){case 0:n=null;break;case 1:n=G(t[0]);break;default:n=[];for(let e=0;e<t.length&&e<i;e++)n.push(G(t[e]));if(t.length<i)for(let e=t.length;e<i;e++)n.push(null)}return n}let Q={sendNotification:(e,...n)=>{let i,s;if(J(),r.string(e))switch(i=e,n.length){case 0:s=null;break;case 1:s=n[0];break;default:s=n}else i=e.method,s=Z(e,n);let o={jsonrpc:_,method:i,params:s};!function(e){if(j!==d.Off&&S)if(M===p.Text){let t=void 0;j===d.Verbose&&(t=e.params?`Params: ${JSON.stringify(e.params,null,4)}\n\n`:"No parameters provided.\n\n"),S.log(`Sending notification '${e.method}'.`,t)}else K("send-notification",e)}(o),t.write(o)},onNotification:(e,t)=>{J(),r.func(e)?k=e:t&&(r.string(e)?R[e]={type:void 0,handler:t}:R[e.method]={type:e,handler:t})},sendRequest:(e,...n)=>{let i,a;J(),function(){if(!H())throw new Error("Call listen() first.")}();let c=void 0;if(r.string(e))switch(i=e,n.length){case 0:a=null;break;case 1:l.CancellationToken.is(n[0])?(a=null,c=n[0]):a=G(n[0]);break;default:const t=n.length-1;l.CancellationToken.is(n[t])?(c=n[t],a=2===n.length?G(n[0]):n.slice(0,t).map(e=>G(e))):a=n.map(e=>G(e))}else{i=e.method,a=Z(e,n);let t=e.numberOfParams;c=l.CancellationToken.is(n[t])?n[t]:void 0}let u=o++,f=new Promise((e,n)=>{let r={jsonrpc:_,id:u,method:i,params:a},o={method:i,timerStart:Date.now(),resolve:e,reject:n};!function(e){if(j!==d.Off&&S)if(M===p.Text){let t=void 0;j===d.Verbose&&e.params&&(t=`Params: ${JSON.stringify(e.params,null,4)}\n\n`),S.log(`Sending request '${e.method} - (${e.id})'.`,t)}else K("send-request",e)}(r);try{t.write(r)}catch(e){o.reject(new s.ResponseError(s.ErrorCodes.MessageWriteError,e.message?e.message:"Unknown reason")),o=null}o&&(E[String(u)]=o)});return c&&c.onCancellationRequested(()=>{Q.sendNotification(h.type,{id:u})}),f},onRequest:(e,t)=>{J(),r.func(e)?C=e:t&&(r.string(e)?T[e]={type:void 0,handler:t}:T[e.method]={type:e,handler:t})},trace:(e,t,n)=>{let i=!1,s=p.Text;void 0!==n&&(r.boolean(n)?i=n:(i=n.sendNotification||!1,s=n.traceFormat||p.Text)),M=s,S=(j=e)===d.Off?void 0:t,!i||L()||B()||Q.sendNotification(f.type,{value:d.toString(e)})},onError:P.event,onClose:N.event,onUnhandledNotification:I.event,onDispose:D.event,dispose:()=>{if(B())return;$=y.Disposed,D.fire(void 0);let n=new Error("Connection got disposed.");Object.keys(E).forEach(e=>{E[e].reject(n)}),E=Object.create(null),O=Object.create(null),x=new u.LinkedMap,r.func(t.dispose)&&t.dispose(),r.func(e.dispose)&&e.dispose()},listen:()=>{J(),function(){if(H())throw new v(g.AlreadyListening,"Connection is already listening")}(),$=y.Listening,e.listen(U)},inspect:()=>{console.log("inspect")}};return Q.onNotification(m.type,e=>{j!==d.Off&&S&&S.log(e.message,j===d.Verbose?e.verbose:void 0)}),Q}t.ConnectionError=v,function(e){e.is=function(e){let t=e;return t&&r.func(t.cancelUndispatched)}}(t.ConnectionStrategy||(t.ConnectionStrategy={})),function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"}(y||(y={})),t.createMessageConnection=function(e,n,i,r){var s;return i||(i=t.NullLogger),b(void 0!==(s=e).listen&&void 0===s.read?e:new o.StreamMessageReader(e),function(e){return void 0!==e.write&&void 0===e.end}(n)?n:new a.StreamMessageWriter(n),i,r)}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(e){return{dispose:e}}}(t.Disposable||(t.Disposable={})),function(e){const t={dispose(){}};e.None=function(){return t}}(t.Event||(t.Event={}));class i{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(this._callbacks){for(var n=!1,i=0,r=this._callbacks.length;i<r;i++)if(this._callbacks[i]===e){if(this._contexts[i]===t)return this._callbacks.splice(i,1),void this._contexts.splice(i,1);n=!0}if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}}invoke(...e){if(!this._callbacks)return[];for(var t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0),r=0,s=n.length;r<s;r++)try{t.push(n[r].apply(i[r],e))}catch(e){console.error(e)}return t}isEmpty(){return!this._callbacks||0===this._callbacks.length}dispose(){this._callbacks=void 0,this._contexts=void 0}}class r{constructor(e){this._options=e}get event(){return this._event||(this._event=((e,t,n)=>{let s;return this._callbacks||(this._callbacks=new i),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t),s={dispose:()=>{this._callbacks.remove(e,t),s.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this)}},Array.isArray(n)&&n.push(s),s})),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}r._noop=function(){},t.Emitter=r},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});const r=n(28);t.ErrorCodes=r.ErrorCodes,t.ResponseError=r.ResponseError,t.CancellationToken=r.CancellationToken,t.CancellationTokenSource=r.CancellationTokenSource,t.Disposable=r.Disposable,t.Event=r.Event,t.Emitter=r.Emitter,t.Trace=r.Trace,t.SetTraceNotification=r.SetTraceNotification,t.LogTraceNotification=r.LogTraceNotification,t.RequestType=r.RequestType,t.RequestType0=r.RequestType0,t.NotificationType=r.NotificationType,t.NotificationType0=r.NotificationType0,t.MessageReader=r.MessageReader,t.MessageWriter=r.MessageWriter,t.ConnectionStrategy=r.ConnectionStrategy,t.StreamMessageReader=r.StreamMessageReader,t.StreamMessageWriter=r.StreamMessageWriter,t.IPCMessageReader=r.IPCMessageReader,t.IPCMessageWriter=r.IPCMessageWriter,t.createClientPipeTransport=r.createClientPipeTransport,t.createServerPipeTransport=r.createServerPipeTransport,t.generateRandomPipeName=r.generateRandomPipeName,t.createClientSocketTransport=r.createClientSocketTransport,t.createServerSocketTransport=r.createServerSocketTransport,i(n(130)),i(n(131)),t.createProtocolConnection=function(e,t,n,i){return r.createMessageConnection(e,t,n,i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(e){return{dispose:e}}}(t.Disposable||(t.Disposable={})),function(e){var t={dispose:function(){}};e.None=function(){return t}}(t.Event||(t.Event={}));var i=function(){function e(){}return e.prototype.add=function(e,t,n){var i=this;void 0===t&&(t=null),this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:function(){return i.remove(e,t)}})},e.prototype.remove=function(e,t){if(void 0===t&&(t=null),this._callbacks){for(var n=!1,i=0,r=this._callbacks.length;i<r;i++)if(this._callbacks[i]===e){if(this._contexts[i]===t)return this._callbacks.splice(i,1),void this._contexts.splice(i,1);n=!0}if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}},e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!this._callbacks)return[];for(var n=[],i=this._callbacks.slice(0),r=this._contexts.slice(0),s=0,o=i.length;s<o;s++)try{n.push(i[s].apply(r[s],e))}catch(e){console.error(e)}return n},e.prototype.isEmpty=function(){return!this._callbacks||0===this._callbacks.length},e.prototype.dispose=function(){this._callbacks=void 0,this._contexts=void 0},e}(),r=function(){function e(e){this._options=e}return Object.defineProperty(e.prototype,"event",{get:function(){var t=this;return this._event||(this._event=function(n,r,s){var o;return t._callbacks||(t._callbacks=new i),t._options&&t._options.onFirstListenerAdd&&t._callbacks.isEmpty()&&t._options.onFirstListenerAdd(t),t._callbacks.add(n,r),o={dispose:function(){t._callbacks.remove(n,r),o.dispose=e._noop,t._options&&t._options.onLastListenerRemove&&t._callbacks.isEmpty()&&t._options.onLastListenerRemove(t)}},Array.isArray(s)&&s.push(o),o}),this._event},enumerable:!0,configurable:!0}),e.prototype.fire=function(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)},e.prototype.dispose=function(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)},e._noop=function(){},e}();t.Emitter=r},function(e,t){function n(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}e.exports=function(e,t){t||(t={});var i={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(i.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?i.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(e){i.bools[e]=!0});var r={};Object.keys(t.alias||{}).forEach(function(e){r[e]=[].concat(t.alias[e]),r[e].forEach(function(t){r[t]=[e].concat(r[e].filter(function(e){return t!==e}))})}),[].concat(t.string).filter(Boolean).forEach(function(e){i.strings[e]=!0,r[e]&&(i.strings[r[e]]=!0)});var s=t.default||{},o={_:[]};Object.keys(i.bools).forEach(function(e){c(e,void 0!==s[e]&&s[e])});var a=[];function c(e,t,s){if(!s||!i.unknownFn||function(e,t){return i.allBools&&/^--[^=]+$/.test(t)||i.strings[e]||i.bools[e]||r[e]}(e,s)||!1!==i.unknownFn(s)){var a=!i.strings[e]&&n(t)?Number(t):t;l(o,e.split("."),a),(r[e]||[]).forEach(function(e){l(o,e.split("."),a)})}}function l(e,t,n){var r=e;t.slice(0,-1).forEach(function(e){void 0===r[e]&&(r[e]={}),r=r[e]});var s=t[t.length-1];void 0===r[s]||i.bools[s]||"boolean"==typeof r[s]?r[s]=n:Array.isArray(r[s])?r[s].push(n):r[s]=[r[s],n]}function u(e){return r[e].some(function(e){return i.bools[e]})}-1!==e.indexOf("--")&&(a=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var h=0;h<e.length;h++){var d=e[h];if(/^--.+=/.test(d)){var p=d.match(/^--([^=]+)=([\s\S]*)$/),f=p[1],m=p[2];i.bools[f]&&(m="false"!==m),c(f,m,d)}else if(/^--no-.+/.test(d)){c(f=d.match(/^--no-(.+)/)[1],!1,d)}else if(/^--.+/.test(d)){f=d.match(/^--(.+)/)[1];void 0===(b=e[h+1])||/^-/.test(b)||i.bools[f]||i.allBools||r[f]&&u(f)?/^(true|false)$/.test(b)?(c(f,"true"===b,d),h++):c(f,!i.strings[f]||"",d):(c(f,b,d),h++)}else if(/^-[^-]+/.test(d)){for(var g=d.slice(1,-1).split(""),y=!1,v=0;v<g.length;v++){var b;if("-"!==(b=d.slice(v+2))){if(/[A-Za-z]/.test(g[v])&&/=/.test(b)){c(g[v],b.split("=")[1],d),y=!0;break}if(/[A-Za-z]/.test(g[v])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(b)){c(g[v],b,d),y=!0;break}if(g[v+1]&&g[v+1].match(/\W/)){c(g[v],d.slice(v+2),d),y=!0;break}c(g[v],!i.strings[g[v]]||"",d)}else c(g[v],b,d)}f=d.slice(-1)[0];y||"-"===f||(!e[h+1]||/^(-|--)[^-]/.test(e[h+1])||i.bools[f]||r[f]&&u(f)?e[h+1]&&/true|false/.test(e[h+1])?(c(f,"true"===e[h+1],d),h++):c(f,!i.strings[f]||"",d):(c(f,e[h+1],d),h++))}else if(i.unknownFn&&!1===i.unknownFn(d)||o._.push(i.strings._||!n(d)?d:Number(d)),t.stopEarly){o._.push.apply(o._,e.slice(h+1));break}}return Object.keys(s).forEach(function(e){var t,n,i;t=o,n=e.split("."),i=t,n.slice(0,-1).forEach(function(e){i=i[e]||{}}),n[n.length-1]in i||(l(o,e.split("."),s[e]),(r[e]||[]).forEach(function(t){l(o,t.split("."),s[e])}))}),t["--"]?(o["--"]=new Array,a.forEach(function(e){o["--"].push(e)})):a.forEach(function(e){o._.push(e)}),o}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(49),r=n(41);let s=8192,o=Buffer.from("\r","ascii")[0],a=Buffer.from("\n","ascii")[0],c="\r\n";class l{constructor(e="utf8"){this.encoding=e,this.index=0,this.buffer=Buffer.allocUnsafe(s)}append(e){var t=e;if("string"==typeof e){var n=e,i=Buffer.byteLength(n,this.encoding);(t=Buffer.allocUnsafe(i)).write(n,0,i,this.encoding)}if(this.buffer.length-this.index>=t.length)t.copy(this.buffer,this.index,0,t.length);else{var r=(Math.ceil((this.index+t.length)/s)+1)*s;0===this.index?(this.buffer=Buffer.allocUnsafe(r),t.copy(this.buffer,0,0,t.length)):this.buffer=Buffer.concat([this.buffer.slice(0,this.index),t],r)}this.index+=t.length}tryReadHeaders(){let e=void 0,t=0;for(;t+3<this.index&&(this.buffer[t]!==o||this.buffer[t+1]!==a||this.buffer[t+2]!==o||this.buffer[t+3]!==a);)t++;if(t+3>=this.index)return e;e=Object.create(null),this.buffer.toString("ascii",0,t).split(c).forEach(t=>{let n=t.indexOf(":");if(-1===n)throw new Error("Message header must separate key and value using :");let i=t.substr(0,n),r=t.substr(n+1).trim();e[i]=r});let n=t+4;return this.buffer=this.buffer.slice(n),this.index=this.index-n,e}tryReadContent(e){if(this.index<e)return null;let t=this.buffer.toString(this.encoding,0,e),n=e;return this.buffer.copy(this.buffer,0,n),this.index=this.index-n,t}get numberOfBytes(){return this.index}}!function(e){e.is=function(e){let t=e;return t&&r.func(t.listen)&&r.func(t.dispose)&&r.func(t.onError)&&r.func(t.onClose)&&r.func(t.onPartialMessage)}}(t.MessageReader||(t.MessageReader={}));class u{constructor(){this.errorEmitter=new i.Emitter,this.closeEmitter=new i.Emitter,this.partialMessageEmitter=new i.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader recevied error. Reason: ${r.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageReader=u;class h extends u{constructor(e,t="utf8"){super(),this.readable=e,this.buffer=new l(t),this._partialMessageTimeout=1e4}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e,this.readable.on("data",e=>{this.onData(e)}),this.readable.on("error",e=>this.fireError(e)),this.readable.on("close",()=>this.fireClose())}onData(e){for(this.buffer.append(e);;){if(-1===this.nextMessageLength){let e=this.buffer.tryReadHeaders();if(!e)return;let t=e["Content-Length"];if(!t)throw new Error("Header must provide a Content-Length property.");let n=parseInt(t);if(isNaN(n))throw new Error("Content-Length value must be a number.");this.nextMessageLength=n}var t=this.buffer.tryReadContent(this.nextMessageLength);if(null===t)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.messageToken++;var n=JSON.parse(t);this.callback(n)}}clearPartialMessageTimer(){this.partialMessageTimer&&(clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}t.StreamMessageReader=h;t.IPCMessageReader=class extends u{constructor(e){super(),this.process=e;let t=this.process;t.on("error",e=>this.fireError(e)),t.on("close",()=>this.fireClose())}listen(e){this.process.on("message",e)}};t.SocketMessageReader=class extends h{constructor(e,t="utf-8"){super(e,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(49),r=n(41);let s="Content-Length: ",o="\r\n";!function(e){e.is=function(e){let t=e;return t&&r.func(t.dispose)&&r.func(t.onClose)&&r.func(t.onError)&&r.func(t.write)}}(t.MessageWriter||(t.MessageWriter={}));class a{constructor(){this.errorEmitter=new i.Emitter,this.closeEmitter=new i.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer recevied error. Reason: ${r.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageWriter=a;t.StreamMessageWriter=class extends a{constructor(e,t="utf8"){super(),this.writable=e,this.encoding=t,this.errorCount=0,this.writable.on("error",e=>this.fireError(e)),this.writable.on("close",()=>this.fireClose())}write(e){let t=JSON.stringify(e),n=Buffer.byteLength(t,this.encoding),i=[s,n.toString(),o,o];try{this.writable.write(i.join(""),"ascii"),this.writable.write(t,this.encoding),this.errorCount=0}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}}};t.IPCMessageWriter=class extends a{constructor(e){super(),this.process=e,this.errorCount=0,this.queue=[],this.sending=!1;let t=this.process;t.on("error",e=>this.fireError(e)),t.on("close",()=>this.fireClose)}write(e){this.sending||0!==this.queue.length?this.queue.push(e):this.doWriteMessage(e)}doWriteMessage(e){try{this.process.send&&(this.sending=!0,this.process.send(e,void 0,void 0,t=>{this.sending=!1,t?(this.errorCount++,this.fireError(t,e,this.errorCount)):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())}))}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}}};t.SocketMessageWriter=class extends a{constructor(e,t="utf8"){super(),this.socket=e,this.queue=[],this.sending=!1,this.encoding=t,this.errorCount=0,this.socket.on("error",e=>this.fireError(e)),this.socket.on("close",()=>this.fireClose())}write(e){this.sending||0!==this.queue.length?this.queue.push(e):this.doWriteMessage(e)}doWriteMessage(e){let t=JSON.stringify(e),n=Buffer.byteLength(t,this.encoding),i=[s,n.toString(),o,o];try{this.sending=!0,this.socket.write(i.join(""),"ascii",n=>{n&&this.handleError(n,e);try{this.socket.write(t,this.encoding,t=>{this.sending=!1,t?this.handleError(t,e):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())})}catch(n){this.handleError(n,e)}})}catch(t){this.handleError(t,e)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(51),o=n(42),a=8192,c=new Buffer("\r","ascii")[0],l=new Buffer("\n","ascii")[0],u=function(){function e(e){void 0===e&&(e="utf8"),this.encoding=e,this.index=0,this.buffer=new Buffer(a)}return e.prototype.append=function(e){var t=e;if("string"==typeof e){var n=e,i=Buffer.byteLength(n,this.encoding);(t=new Buffer(i)).write(n,0,i,this.encoding)}if(this.buffer.length-this.index>=t.length)t.copy(this.buffer,this.index,0,t.length);else{var r=(Math.ceil((this.index+t.length)/a)+1)*a;0===this.index?(this.buffer=new Buffer(r),t.copy(this.buffer,0,0,t.length)):this.buffer=Buffer.concat([this.buffer.slice(0,this.index),t],r)}this.index+=t.length},e.prototype.tryReadHeaders=function(){for(var e=void 0,t=0;t+3<this.index&&(this.buffer[t]!==c||this.buffer[t+1]!==l||this.buffer[t+2]!==c||this.buffer[t+3]!==l);)t++;if(t+3>=this.index)return e;e=Object.create(null),this.buffer.toString("ascii",0,t).split("\r\n").forEach(function(t){var n=t.indexOf(":");if(-1===n)throw new Error("Message header must separate key and value using :");var i=t.substr(0,n),r=t.substr(n+1).trim();e[i]=r});var n=t+4;return this.buffer=this.buffer.slice(n),this.index=this.index-n,e},e.prototype.tryReadContent=function(e){if(this.index<e)return null;var t=this.buffer.toString(this.encoding,0,e),n=e;return this.buffer.copy(this.buffer,0,n),this.index=this.index-n,t},Object.defineProperty(e.prototype,"numberOfBytes",{get:function(){return this.index},enumerable:!0,configurable:!0}),e}();!function(e){e.is=function(e){var t=e;return t&&o.func(t.listen)&&o.func(t.dispose)&&o.func(t.onError)&&o.func(t.onClose)&&o.func(t.onPartialMessage)}}(t.MessageReader||(t.MessageReader={}));var h=function(){function e(){this.errorEmitter=new s.Emitter,this.closeEmitter=new s.Emitter,this.partialMessageEmitter=new s.Emitter}return e.prototype.dispose=function(){this.errorEmitter.dispose(),this.closeEmitter.dispose()},Object.defineProperty(e.prototype,"onError",{get:function(){return this.errorEmitter.event},enumerable:!0,configurable:!0}),e.prototype.fireError=function(e){this.errorEmitter.fire(this.asError(e))},Object.defineProperty(e.prototype,"onClose",{get:function(){return this.closeEmitter.event},enumerable:!0,configurable:!0}),e.prototype.fireClose=function(){this.closeEmitter.fire(void 0)},Object.defineProperty(e.prototype,"onPartialMessage",{get:function(){return this.partialMessageEmitter.event},enumerable:!0,configurable:!0}),e.prototype.firePartialMessage=function(e){this.partialMessageEmitter.fire(e)},e.prototype.asError=function(e){return e instanceof Error?e:new Error("Reader recevied error. Reason: "+(o.string(e.message)?e.message:"unknown"))},e}();t.AbstractMessageReader=h;var d=function(e){function t(t,n){void 0===n&&(n="utf8");var i=e.call(this)||this;return i.readable=t,i.buffer=new u(n),i._partialMessageTimeout=1e4,i}return r(t,e),Object.defineProperty(t.prototype,"partialMessageTimeout",{get:function(){return this._partialMessageTimeout},set:function(e){this._partialMessageTimeout=e},enumerable:!0,configurable:!0}),t.prototype.listen=function(e){var t=this;this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e,this.readable.on("data",function(e){t.onData(e)}),this.readable.on("error",function(e){return t.fireError(e)}),this.readable.on("close",function(){return t.fireClose()})},t.prototype.onData=function(e){for(this.buffer.append(e);;){if(-1===this.nextMessageLength){var t=this.buffer.tryReadHeaders();if(!t)return;var n=t["Content-Length"];if(!n)throw new Error("Header must provide a Content-Length property.");var i=parseInt(n);if(isNaN(i))throw new Error("Content-Length value must be a number.");this.nextMessageLength=i}var r=this.buffer.tryReadContent(this.nextMessageLength);if(null===r)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.messageToken++;var s=JSON.parse(r);this.callback(s)}},t.prototype.clearPartialMessageTimer=function(){this.partialMessageTimer&&(clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)},t.prototype.setPartialMessageTimer=function(){var e=this;this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=setTimeout(function(t,n){e.partialMessageTimer=void 0,t===e.messageToken&&(e.firePartialMessage({messageToken:t,waitingTime:n}),e.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))},t}(h);t.StreamMessageReader=d;var p=function(e){function t(t){var n=e.call(this)||this;n.process=t;var i=n.process;return i.on("error",function(e){return n.fireError(e)}),i.on("close",function(){return n.fireClose()}),n}return r(t,e),t.prototype.listen=function(e){this.process.on("message",e)},t}(h);t.IPCMessageReader=p;var f=function(e){function t(t,n){return void 0===n&&(n="utf-8"),e.call(this,t,n)||this}return r(t,e),t}(d);t.SocketMessageReader=f},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(51),o=n(42);!function(e){e.is=function(e){var t=e;return t&&o.func(t.dispose)&&o.func(t.onClose)&&o.func(t.onError)&&o.func(t.write)}}(t.MessageWriter||(t.MessageWriter={}));var a=function(){function e(){this.errorEmitter=new s.Emitter,this.closeEmitter=new s.Emitter}return e.prototype.dispose=function(){this.errorEmitter.dispose(),this.closeEmitter.dispose()},Object.defineProperty(e.prototype,"onError",{get:function(){return this.errorEmitter.event},enumerable:!0,configurable:!0}),e.prototype.fireError=function(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])},Object.defineProperty(e.prototype,"onClose",{get:function(){return this.closeEmitter.event},enumerable:!0,configurable:!0}),e.prototype.fireClose=function(){this.closeEmitter.fire(void 0)},e.prototype.asError=function(e){return e instanceof Error?e:new Error("Writer recevied error. Reason: "+(o.string(e.message)?e.message:"unknown"))},e}();t.AbstractMessageWriter=a;var c=function(e){function t(t,n){void 0===n&&(n="utf8");var i=e.call(this)||this;return i.writable=t,i.encoding=n,i.errorCount=0,i.writable.on("error",function(e){return i.fireError(e)}),i.writable.on("close",function(){return i.fireClose()}),i}return r(t,e),t.prototype.write=function(e){var t=JSON.stringify(e),n=["Content-Length: ",Buffer.byteLength(t,this.encoding).toString(),"\r\n","\r\n"];try{this.writable.write(n.join(""),"ascii"),this.writable.write(t,this.encoding),this.errorCount=0}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}},t}(a);t.StreamMessageWriter=c;var l=function(e){function t(t){var n=e.call(this)||this;n.process=t,n.errorCount=0,n.queue=[],n.sending=!1;var i=n.process;return i.on("error",function(e){return n.fireError(e)}),i.on("close",function(){return n.fireClose}),n}return r(t,e),t.prototype.write=function(e){this.sending||0!==this.queue.length?this.queue.push(e):this.doWriteMessage(e)},t.prototype.doWriteMessage=function(e){var t=this;try{this.process.send&&(this.sending=!0,this.process.send(e,void 0,void 0,function(n){t.sending=!1,n?(t.errorCount++,t.fireError(n,e,t.errorCount)):t.errorCount=0,t.queue.length>0&&t.doWriteMessage(t.queue.shift())}))}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}},t}(a);t.IPCMessageWriter=l;var u=function(e){function t(t,n){void 0===n&&(n="utf8");var i=e.call(this)||this;return i.socket=t,i.queue=[],i.sending=!1,i.encoding=n,i.errorCount=0,i.socket.on("error",function(e){return i.fireError(e)}),i.socket.on("close",function(){return i.fireClose()}),i}return r(t,e),t.prototype.write=function(e){this.sending||0!==this.queue.length?this.queue.push(e):this.doWriteMessage(e)},t.prototype.doWriteMessage=function(e){var t=this,n=JSON.stringify(e),i=["Content-Length: ",Buffer.byteLength(n,this.encoding).toString(),"\r\n","\r\n"];try{this.sending=!0,this.socket.write(i.join(""),"ascii",function(i){i&&t.handleError(i,e);try{t.socket.write(n,t.encoding,function(n){t.sending=!1,n?t.handleError(n,e):t.errorCount=0,t.queue.length>0&&t.doWriteMessage(t.queue.shift())})}catch(i){t.handleError(i,e)}})}catch(t){this.handleError(t,e)}},t.prototype.handleError=function(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)},t}(a);t.SocketMessageWriter=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(50);t.Event=i.Event;const r=n(139),s=n(140),o=n(86),a=n(141);!function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(50));const c=n(142);!function(e){e.uriToFilePath=c.uriToFilePath,e.resolveGlobalNodePath=c.resolveGlobalNodePath,e.resolveGlobalYarnPath=c.resolveGlobalYarnPath,e.resolve=c.resolve,e.resolveModule=c.resolveModule,e.resolveModule2=c.resolveModule2,e.resolveModulePath=c.resolveModulePath}(t.Files||(t.Files={}));let l=!1,u=void 0;function h(e){if(null!==e)return e}!function(){function e(e){try{let t=parseInt(e);isNaN(t)||(u=setInterval(()=>{try{process.kill(t,0)}catch(e){process.exit(l?0:1)}},3e3))}catch(e){}}for(let t=2;t<process.argv.length;t++){let n=process.argv[t];if("--clientProcessId"===n&&t+1<process.argv.length)return void e(process.argv[t+1]);{let t=n.split("=");"--clientProcessId"===t[0]&&e(t[1])}}}();t.TextDocuments=class{constructor(){this._documents=Object.create(null),this._onDidChangeContent=new i.Emitter,this._onDidOpen=new i.Emitter,this._onDidClose=new i.Emitter,this._onDidSave=new i.Emitter,this._onWillSave=new i.Emitter}get syncKind(){return i.TextDocumentSyncKind.Full}get onDidChangeContent(){return this._onDidChangeContent.event}get onDidOpen(){return this._onDidOpen.event}get onWillSave(){return this._onWillSave.event}onWillSaveWaitUntil(e){this._willSaveWaitUntil=e}get onDidSave(){return this._onDidSave.event}get onDidClose(){return this._onDidClose.event}get(e){return this._documents[e]}all(){return Object.keys(this._documents).map(e=>this._documents[e])}keys(){return Object.keys(this._documents)}listen(e){e.__textDocumentSync=i.TextDocumentSyncKind.Full,e.onDidOpenTextDocument(e=>{let t=e.textDocument,n=i.TextDocument.create(t.uri,t.languageId,t.version,t.text);this._documents[t.uri]=n;let r=Object.freeze({document:n});this._onDidOpen.fire(r),this._onDidChangeContent.fire(r)}),e.onDidChangeTextDocument(e=>{let t=e.textDocument,n=e.contentChanges,i=n.length>0?n[n.length-1]:void 0;if(i){let e=this._documents[t.uri];if(e&&function(e){return o.func(e.update)}(e)){if(null===t.version||void 0===t.version)throw new Error(`Recevied document change event for ${t.uri} without valid version identifier`);e.update(i,t.version),this._onDidChangeContent.fire(Object.freeze({document:e}))}}}),e.onDidCloseTextDocument(e=>{let t=this._documents[e.textDocument.uri];t&&(delete this._documents[e.textDocument.uri],this._onDidClose.fire(Object.freeze({document:t})))}),e.onWillSaveTextDocument(e=>{let t=this._documents[e.textDocument.uri];t&&this._onWillSave.fire(Object.freeze({document:t,reason:e.reason}))}),e.onWillSaveTextDocumentWaitUntil((e,t)=>{let n=this._documents[e.textDocument.uri];return n&&this._willSaveWaitUntil?this._willSaveWaitUntil(Object.freeze({document:n,reason:e.reason}),t):[]}),e.onDidSaveTextDocument(e=>{let t=this._documents[e.textDocument.uri];t&&this._onDidSave.fire(Object.freeze({document:t}))})}};t.ErrorMessageTracker=class{constructor(){this._messages=Object.create(null)}add(e){let t=this._messages[e];t||(t=0),t++,this._messages[e]=t}sendErrors(e){Object.keys(this._messages).forEach(t=>{e.window.showErrorMessage(t)})}},function(e){e.create=function(){return new d}}(t.BulkRegistration||(t.BulkRegistration={}));class d{constructor(){this._registrations=[],this._registered=new Set}add(e,t){const n=o.string(e)?e:e.method;if(this._registered.has(n))throw new Error(`${n} is already added to this registration`);const i=a.generateUuid();this._registrations.push({id:i,method:n,registerOptions:t||{}}),this._registered.add(n)}asRegistrationParams(){return{registrations:this._registrations}}}!function(e){e.create=function(){return new p(void 0,[])}}(t.BulkUnregistration||(t.BulkUnregistration={}));class p{constructor(e,t){this._connection=e,this._unregistrations=new Map,t.forEach(e=>{this._unregistrations.set(e.method,e)})}get isAttached(){return!!this._connection}attach(e){this._connection=e}add(e){this._unregistrations.set(e.method,e)}dispose(){let e=[];for(let t of this._unregistrations.values())e.push(t);let t={unregisterations:e};this._connection.sendRequest(i.UnregistrationRequest.type,t).then(void 0,e=>{this._connection.console.info("Bulk unregistration failed.")})}disposeSingle(e){const t=o.string(e)?e:e.method,n=this._unregistrations.get(t);if(!n)return!1;let r={unregisterations:[n]};return this._connection.sendRequest(i.UnregistrationRequest.type,r).then(()=>{this._unregistrations.delete(t)},e=>{this._connection.console.info(`Unregistering request handler for ${n.id} failed.`)}),!0}}class f{constructor(){}rawAttach(e){this._rawConnection=e}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}fillServerCapabilities(e){}initialize(e){}error(e){this.send(i.MessageType.Error,e)}warn(e){this.send(i.MessageType.Warning,e)}info(e){this.send(i.MessageType.Info,e)}log(e){this.send(i.MessageType.Log,e)}send(e,t){this._rawConnection&&this._rawConnection.sendNotification(i.LogMessageNotification.type,{type:e,message:t})}}class m{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}showErrorMessage(e,...t){let n={type:i.MessageType.Error,message:e,actions:t};return this._connection.sendRequest(i.ShowMessageRequest.type,n).then(h)}showWarningMessage(e,...t){let n={type:i.MessageType.Warning,message:e,actions:t};return this._connection.sendRequest(i.ShowMessageRequest.type,n).then(h)}showInformationMessage(e,...t){let n={type:i.MessageType.Info,message:e,actions:t};return this._connection.sendRequest(i.ShowMessageRequest.type,n).then(h)}}class g{attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}register(e,t,n){return e instanceof d?this.registerMany(e):e instanceof p?this.registerSingle1(e,t,n):this.registerSingle2(e,t)}registerSingle1(e,t,n){const r=o.string(t)?t:t.method,s=a.generateUuid();let c={registrations:[{id:s,method:r,registerOptions:n||{}}]};return e.isAttached||e.attach(this._connection),this._connection.sendRequest(i.RegistrationRequest.type,c).then(t=>(e.add({id:s,method:r}),e),e=>(this.connection.console.info(`Registering request handler for ${r} failed.`),Promise.reject(e)))}registerSingle2(e,t){const n=o.string(e)?e:e.method,r=a.generateUuid();let s={registrations:[{id:r,method:n,registerOptions:t||{}}]};return this._connection.sendRequest(i.RegistrationRequest.type,s).then(e=>i.Disposable.create(()=>{this.unregisterSingle(r,n)}),e=>(this.connection.console.info(`Registering request handler for ${n} failed.`),Promise.reject(e)))}unregisterSingle(e,t){let n={unregisterations:[{id:e,method:t}]};return this._connection.sendRequest(i.UnregistrationRequest.type,n).then(void 0,t=>{this.connection.console.info(`Unregistering request handler for ${e} failed.`)})}registerMany(e){let t=e.asRegistrationParams();return this._connection.sendRequest(i.RegistrationRequest.type,t).then(()=>new p(this._connection,t.registrations.map(e=>({id:e.id,method:e.method}))),e=>(this.connection.console.info("Bulk registration failed."),Promise.reject(e)))}}const y=s.WorkspaceFoldersFeature(r.ConfigurationFeature(class{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}applyEdit(e){let t=(n=e)&&n.edit?e:{edit:e};var n;return this._connection.sendRequest(i.ApplyWorkspaceEditRequest.type,t)}}));class v{constructor(){this._trace=i.Trace.Off}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}set trace(e){this._trace=e}log(e,t){this._trace!==i.Trace.Off&&this._connection.sendNotification(i.LogTraceNotification.type,{message:e,verbose:this._trace===i.Trace.Verbose?t:void 0})}}class b{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}logEvent(e){this._connection.sendNotification(i.TelemetryEventNotification.type,e)}}function _(e,t){return function(n){return t(e(n))}}function w(e,t){return function(n){return t(e(n))}}function S(e,t){return function(n){return t(e(n))}}function C(e,t){return function(n){return t(e(n))}}function T(e,t){return function(n){return t(e(n))}}function k(e,t){return function(n){return t(e(n))}}t.combineConsoleFeatures=_,t.combineTelemetryFeatures=w,t.combineTracerFeatures=S,t.combineClientFeatures=C,t.combineWindowFeatures=T,t.combineWorkspaceFeatures=k,t.combineFeatures=function(e,t){function n(e,t,n){return e&&t?n(e,t):e||t}return{__brand:"features",console:n(e.console,t.console,_),tracer:n(e.tracer,t.tracer,S),telemetry:n(e.telemetry,t.telemetry,w),client:n(e.client,t.client,C),window:n(e.window,t.window,T),workspace:n(e.workspace,t.workspace,k)}},t.createConnection=function(e,t,n,r){let s,a,c,h;return void 0!==e&&"features"===e.__brand&&(s=e,e=t,t=n,n=r),i.ConnectionStrategy.is(e)?h=e:(a=e,c=t,h=n),function(e,t,n,r){if(!e&&!t&&process.argv.length>2){let n=void 0,r=void 0,o=process.argv.slice(2);for(let a=0;a<o.length;a++){let c=o[a];if("--node-ipc"===c){e=new i.IPCMessageReader(process),t=new i.IPCMessageWriter(process);break}if("--stdio"===c){e=process.stdin,t=process.stdout;break}if("--socket"===c){n=parseInt(o[a+1]);break}if("--pipe"===c){r=o[a+1];break}var s=c.split("=");if("--socket"===s[0]){n=parseInt(s[1]);break}if("--pipe"===s[0]){r=s[1];break}}if(n){let r=i.createServerSocketTransport(n);e=r[0],t=r[1]}else if(r){let n=i.createServerPipeTransport(r);e=n[0],t=n[1]}}var a="Use arguments of createConnection or set command line parameters: '--node-ipc', '--stdio' or '--socket={number}'";if(!e)throw new Error("Connection input stream is not set. "+a);if(!t)throw new Error("Connection output stream is not set. "+a);if(o.func(e.read)&&o.func(e.on)){let t=e;t.on("end",()=>{process.exit(l?0:1)}),t.on("close",()=>{process.exit(l?0:1)})}const c=r&&r.console?new(r.console(f)):new f,h=i.createProtocolConnection(e,t,c,n);c.rawAttach(h);const d=r&&r.tracer?new(r.tracer(v)):new v,p=r&&r.telemetry?new(r.telemetry(b)):new b,_=r&&r.client?new(r.client(g)):new g,w=r&&r.window?new(r.window(m)):new m,S=r&&r.workspace?new(r.workspace(y)):new y,C=[c,d,p,_,w,S];let T=void 0,k=void 0,R=void 0,x={listen:()=>h.listen(),sendRequest:(e,...t)=>h.sendRequest(o.string(e)?e:e.method,...t),onRequest:(e,t)=>h.onRequest(e,t),sendNotification:(e,t)=>{const n=o.string(e)?e:e.method;1===arguments.length?h.sendNotification(n):h.sendNotification(n,t)},onNotification:(e,t)=>h.onNotification(e,t),onInitialize:e=>k=e,onInitialized:e=>h.onNotification(i.InitializedNotification.type,e),onShutdown:e=>T=e,onExit:e=>R=e,get console(){return c},get telemetry(){return p},get tracer(){return d},get client(){return _},get window(){return w},get workspace(){return S},onDidChangeConfiguration:e=>h.onNotification(i.DidChangeConfigurationNotification.type,e),onDidChangeWatchedFiles:e=>h.onNotification(i.DidChangeWatchedFilesNotification.type,e),__textDocumentSync:void 0,onDidOpenTextDocument:e=>h.onNotification(i.DidOpenTextDocumentNotification.type,e),onDidChangeTextDocument:e=>h.onNotification(i.DidChangeTextDocumentNotification.type,e),onDidCloseTextDocument:e=>h.onNotification(i.DidCloseTextDocumentNotification.type,e),onWillSaveTextDocument:e=>h.onNotification(i.WillSaveTextDocumentNotification.type,e),onWillSaveTextDocumentWaitUntil:e=>h.onRequest(i.WillSaveTextDocumentWaitUntilRequest.type,e),onDidSaveTextDocument:e=>h.onNotification(i.DidSaveTextDocumentNotification.type,e),sendDiagnostics:e=>h.sendNotification(i.PublishDiagnosticsNotification.type,e),onHover:e=>h.onRequest(i.HoverRequest.type,e),onCompletion:e=>h.onRequest(i.CompletionRequest.type,e),onCompletionResolve:e=>h.onRequest(i.CompletionResolveRequest.type,e),onSignatureHelp:e=>h.onRequest(i.SignatureHelpRequest.type,e),onDefinition:e=>h.onRequest(i.DefinitionRequest.type,e),onTypeDefinition:e=>h.onRequest(i.TypeDefinitionRequest.type,e),onImplementation:e=>h.onRequest(i.ImplementationRequest.type,e),onReferences:e=>h.onRequest(i.ReferencesRequest.type,e),onDocumentHighlight:e=>h.onRequest(i.DocumentHighlightRequest.type,e),onDocumentSymbol:e=>h.onRequest(i.DocumentSymbolRequest.type,e),onWorkspaceSymbol:e=>h.onRequest(i.WorkspaceSymbolRequest.type,e),onCodeAction:e=>h.onRequest(i.CodeActionRequest.type,e),onCodeLens:e=>h.onRequest(i.CodeLensRequest.type,e),onCodeLensResolve:e=>h.onRequest(i.CodeLensResolveRequest.type,e),onDocumentFormatting:e=>h.onRequest(i.DocumentFormattingRequest.type,e),onDocumentRangeFormatting:e=>h.onRequest(i.DocumentRangeFormattingRequest.type,e),onDocumentOnTypeFormatting:e=>h.onRequest(i.DocumentOnTypeFormattingRequest.type,e),onRenameRequest:e=>h.onRequest(i.RenameRequest.type,e),onDocumentLinks:e=>h.onRequest(i.DocumentLinkRequest.type,e),onDocumentLinkResolve:e=>h.onRequest(i.DocumentLinkResolveRequest.type,e),onDocumentColor:e=>h.onRequest(i.DocumentColorRequest.type,e),onColorPresentation:e=>h.onRequest(i.ColorPresentationRequest.type,e),onFoldingRanges:e=>h.onRequest(i.FoldingRangeRequest.type,e),onExecuteCommand:e=>h.onRequest(i.ExecuteCommandRequest.type,e),dispose:()=>h.dispose()};for(let e of C)e.attach(x);return h.onRequest(i.InitializeRequest.type,e=>{o.number(e.processId)&&void 0===u&&setInterval(()=>{try{process.kill(e.processId,0)}catch(e){process.exit(l?0:1)}},3e3),o.string(e.trace)&&(d.trace=i.Trace.fromString(e.trace));for(let t of C)t.initialize(e.capabilities);if(k)return function(e){return o.thenable(e)?e:Promise.resolve(e)}(k(e,(new i.CancellationTokenSource).token)).then(e=>{if(e instanceof i.ResponseError)return e;let t=e;t||(t={capabilities:{}});let n=t.capabilities;n||(n={},t.capabilities=n),n.textDocumentSync?o.number(n.textDocumentSync)||o.number(n.textDocumentSync.change)||(n.textDocumentSync.change=o.number(x.__textDocumentSync)?x.__textDocumentSync:i.TextDocumentSyncKind.None):n.textDocumentSync=o.number(x.__textDocumentSync)?x.__textDocumentSync:i.TextDocumentSyncKind.None;for(let e of C)e.fillServerCapabilities(n);return t});{let e={capabilities:{textDocumentSync:i.TextDocumentSyncKind.None}};for(let t of C)t.fillServerCapabilities(e.capabilities);return e}}),h.onRequest(i.ShutdownRequest.type,()=>(l=!0,T?T((new i.CancellationTokenSource).token):void 0)),h.onNotification(i.ExitNotification.type,()=>{try{R&&R()}finally{l?process.exit(0):process.exit(1)}}),h.onNotification(i.SetTraceNotification.type,e=>{d.trace=i.Trace.fromString(e.value)}),x}(a,c,h,s)},function(e){e.all={__brand:"features"}}(t.ProposedFeatures||(t.ProposedFeatures={}))},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports=require("os")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=Object.prototype.toString;function r(e){return"[object String]"===i.call(e)}function s(e){return"[object Function]"===i.call(e)}function o(e){return Array.isArray(e)}t.defined=function(e){return void 0!==e},t.undefined=function(e){return void 0===e},t.nil=function(e){return null===e},t.boolean=function(e){return!0===e||!1===e},t.string=r,t.number=function(e){return"[object Number]"===i.call(e)},t.error=function(e){return"[object Error]"===i.call(e)},t.func=s,t.array=o,t.stringArray=function(e){return o(e)&&e.every(e=>r(e))},t.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)},t.thenable=function(e){return e&&s(e.then)}},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=87},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(49),r=n(41);var s;!function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:i.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:i.Event.None}),e.is=function(t){let n=t;return n&&(n===e.None||n===e.Cancelled||r.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}}(s=t.CancellationToken||(t.CancellationToken={}));const o=Object.freeze(function(e,t){let n=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(n)}}});class a{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this._emitter=void 0))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?o:(this._emitter||(this._emitter=new i.Emitter),this._emitter.event)}}t.CancellationTokenSource=class{get token(){return this._token||(this._token=new a),this._token}cancel(){this._token?this._token.cancel():this._token=s.Cancelled}dispose(){this.cancel()}}},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.None=0,e.First=1,e.Last=2}(i=t.Touch||(t.Touch={}));t.LinkedMap=class{constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}has(e){return this._map.has(e)}get(e){const t=this._map.get(e);if(t)return t.value}set(e,t,n=i.None){let r=this._map.get(e);if(r)r.value=t,n!==i.None&&this.touch(r,n);else{switch(r={key:e,value:t,next:void 0,previous:void 0},n){case i.None:this.addItemLast(r);break;case i.First:this.addItemFirst(r);break;case i.Last:default:this.addItemLast(r)}this._map.set(e,r),this._size++}}delete(e){const t=this._map.get(e);return!!t&&(this._map.delete(e),this.removeItem(t),this._size--,!0)}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._head;for(;n;)t?e.bind(t)(n.value,n.key,this):e(n.value,n.key,this),n=n.next}forEachReverse(e,t){let n=this._tail;for(;n;)t?e.bind(t)(n.value,n.key,this):e(n.value,n.key,this),n=n.previous}values(){let e=[],t=this._head;for(;t;)e.push(t.value),t=t.next;return e}keys(){let e=[],t=this._head;for(;t;)e.push(t.key),t=t.next;return e}addItemFirst(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e}addItemLast(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head)this._head=e.next;else if(e===this._tail)this._tail=e.previous;else{const t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(t===i.First||t===i.Last)if(t===i.First){if(e===this._head)return;const t=e.next,n=e.previous;e===this._tail?(n.next=void 0,this._tail=n):(t.previous=n,n.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e}else if(t===i.Last){if(e===this._tail)return;const t=e.next,n=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=n,n.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(22),r=n(85),s=n(29),o=n(33),a=n(56),c=n(57);t.generateRandomPipeName=function(){const e=s.randomBytes(21).toString("hex");return"win32"===process.platform?`\\\\.\\pipe\\vscode-jsonrpc-${e}-sock`:i.join(r.tmpdir(),`vscode-${e}.sock`)},t.createClientPipeTransport=function(e,t="utf-8"){let n,i=new Promise((e,t)=>{n=e});return new Promise((r,s)=>{let l=o.createServer(e=>{l.close(),n([new a.SocketMessageReader(e,t),new c.SocketMessageWriter(e,t)])});l.on("error",s),l.listen(e,()=>{l.removeListener("error",s),r({onConnected:()=>i})})})},t.createServerPipeTransport=function(e,t="utf-8"){const n=o.createConnection(e);return[new a.SocketMessageReader(n,t),new c.SocketMessageWriter(n,t)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(33),r=n(56),s=n(57);t.createClientSocketTransport=function(e,t="utf-8"){let n,o=new Promise((e,t)=>{n=e});return new Promise((a,c)=>{let l=i.createServer(e=>{l.close(),n([new r.SocketMessageReader(e,t),new s.SocketMessageWriter(e,t)])});l.on("error",c),l.listen(e,"127.0.0.1",()=>{l.removeListener("error",c),a({onConnected:()=>o})})})},t.createServerSocketTransport=function(e,t="utf-8"){const n=i.createConnection(e,"127.0.0.1");return[new r.SocketMessageReader(n,t),new s.SocketMessageWriter(n,t)]}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s,o=n(42);!function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.serverErrorStart=-32099,e.serverErrorEnd=-32e3,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.RequestCancelled=-32800,e.MessageWriteError=1,e.MessageReadError=2}(s=t.ErrorCodes||(t.ErrorCodes={}));var a=function(e){function t(n,i,r){var a=e.call(this,i)||this;return a.code=o.number(n)?n:s.UnknownErrorCode,a.data=r,Object.setPrototypeOf(a,t.prototype),a}return r(t,e),t.prototype.toJson=function(){return{code:this.code,message:this.message,data:this.data}},t}(Error);t.ResponseError=a;var c=function(){function e(e,t){this._method=e,this._numberOfParams=t}return Object.defineProperty(e.prototype,"method",{get:function(){return this._method},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfParams",{get:function(){return this._numberOfParams},enumerable:!0,configurable:!0}),e}();t.AbstractMessageType=c;var l=function(e){function t(t){var n=e.call(this,t,0)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType0=l;var u=function(e){function t(t){var n=e.call(this,t,1)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType=u;var h=function(e){function t(t){var n=e.call(this,t,1)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType1=h;var d=function(e){function t(t){var n=e.call(this,t,2)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType2=d;var p=function(e){function t(t){var n=e.call(this,t,3)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType3=p;var f=function(e){function t(t){var n=e.call(this,t,4)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType4=f;var m=function(e){function t(t){var n=e.call(this,t,5)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType5=m;var g=function(e){function t(t){var n=e.call(this,t,6)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType6=g;var y=function(e){function t(t){var n=e.call(this,t,7)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType7=y;var v=function(e){function t(t){var n=e.call(this,t,8)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType8=v;var b=function(e){function t(t){var n=e.call(this,t,9)||this;return n._=void 0,n}return r(t,e),t}(c);t.RequestType9=b;var _=function(e){function t(t){var n=e.call(this,t,1)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType=_;var w=function(e){function t(t){var n=e.call(this,t,0)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType0=w;var S=function(e){function t(t){var n=e.call(this,t,1)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType1=S;var C=function(e){function t(t){var n=e.call(this,t,2)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType2=C;var T=function(e){function t(t){var n=e.call(this,t,3)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType3=T;var k=function(e){function t(t){var n=e.call(this,t,4)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType4=k;var R=function(e){function t(t){var n=e.call(this,t,5)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType5=R;var x=function(e){function t(t){var n=e.call(this,t,6)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType6=x;var E=function(e){function t(t){var n=e.call(this,t,7)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType7=E;var O=function(e){function t(t){var n=e.call(this,t,8)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType8=O;var j=function(e){function t(t){var n=e.call(this,t,9)||this;return n._=void 0,n}return r(t,e),t}(c);t.NotificationType9=j,t.isRequestMessage=function(e){var t=e;return t&&o.string(t.method)&&(o.string(t.id)||o.number(t.id))},t.isNotificationMessage=function(e){var t=e;return t&&o.string(t.method)&&void 0===e.id},t.isResponseMessage=function(e){var t=e;return t&&(void 0!==t.result||!!t.error)&&(o.string(t.id)||o.number(t.id)||null===t.id)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(51),s=n(42);!function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:r.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:r.Event.None}),e.is=function(t){var n=t;return n&&(n===e.None||n===e.Cancelled||s.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}}(i=t.CancellationToken||(t.CancellationToken={}));var o=Object.freeze(function(e,t){var n=setTimeout(e.bind(t),0);return{dispose:function(){clearTimeout(n)}}}),a=function(){function e(){this._isCancelled=!1}return e.prototype.cancel=function(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this._emitter=void 0))},Object.defineProperty(e.prototype,"isCancellationRequested",{get:function(){return this._isCancelled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onCancellationRequested",{get:function(){return this._isCancelled?o:(this._emitter||(this._emitter=new r.Emitter),this._emitter.event)},enumerable:!0,configurable:!0}),e}(),c=function(){function e(){}return Object.defineProperty(e.prototype,"token",{get:function(){return this._token||(this._token=new a),this._token},enumerable:!0,configurable:!0}),e.prototype.cancel=function(){this._token?this._token.cancel():this._token=i.Cancelled},e.prototype.dispose=function(){this.cancel()},e}();t.CancellationTokenSource=c},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.None=0,e.First=1,e.Last=2}(i=t.Touch||(t.Touch={}));var r=function(){function e(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0}return e.prototype.clear=function(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0},e.prototype.isEmpty=function(){return!this._head&&!this._tail},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.get=function(e){var t=this._map.get(e);if(t)return t.value},e.prototype.set=function(e,t,n){void 0===n&&(n=i.None);var r=this._map.get(e);if(r)r.value=t,n!==i.None&&this.touch(r,n);else{switch(r={key:e,value:t,next:void 0,previous:void 0},n){case i.None:this.addItemLast(r);break;case i.First:this.addItemFirst(r);break;case i.Last:default:this.addItemLast(r)}this._map.set(e,r),this._size++}},e.prototype.delete=function(e){var t=this._map.get(e);return!!t&&(this._map.delete(e),this.removeItem(t),this._size--,!0)},e.prototype.shift=function(){if(this._head||this._tail){if(!this._head||!this._tail)throw new Error("Invalid list");var e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}},e.prototype.forEach=function(e,t){for(var n=this._head;n;)t?e.bind(t)(n.value,n.key,this):e(n.value,n.key,this),n=n.next},e.prototype.forEachReverse=function(e,t){for(var n=this._tail;n;)t?e.bind(t)(n.value,n.key,this):e(n.value,n.key,this),n=n.previous},e.prototype.values=function(){for(var e=[],t=this._head;t;)e.push(t.value),t=t.next;return e},e.prototype.keys=function(){for(var e=[],t=this._head;t;)e.push(t.key),t=t.next;return e},e.prototype.addItemFirst=function(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e},e.prototype.addItemLast=function(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e},e.prototype.removeItem=function(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head)this._head=e.next;else if(e===this._tail)this._tail=e.previous;else{var t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}},e.prototype.touch=function(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(t===i.First||t===i.Last)if(t===i.First){if(e===this._head)return;var n=e.next,r=e.previous;e===this._tail?(r.next=void 0,this._tail=r):(n.previous=r,r.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e}else if(t===i.Last){if(e===this._tail)return;n=e.next,r=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=r,r.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e}},e}();t.LinkedMap=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),r=n(85),s=n(29),o=n(33),a=n(58),c=n(59);t.generateRandomPipeName=function(){var e=s.randomBytes(21).toString("hex");return"win32"===process.platform?"\\\\.\\pipe\\vscode-jsonrpc-"+e+"-sock":i.join(r.tmpdir(),"vscode-"+e+".sock")},t.createClientPipeTransport=function(e,t){var n;void 0===t&&(t="utf-8");var i=new Promise(function(e,t){n=e});return new Promise(function(r,s){var l=o.createServer(function(e){l.close(),n([new a.SocketMessageReader(e,t),new c.SocketMessageWriter(e,t)])});l.on("error",s),l.listen(e,function(){l.removeListener("error",s),r({onConnected:function(){return i}})})})},t.createServerPipeTransport=function(e,t){void 0===t&&(t="utf-8");var n=o.createConnection(e);return[new a.SocketMessageReader(n,t),new c.SocketMessageWriter(n,t)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),r=n(58),s=n(59);t.createClientSocketTransport=function(e,t){var n;void 0===t&&(t="utf-8");var o=new Promise(function(e,t){n=e});return new Promise(function(a,c){var l=i.createServer(function(e){l.close(),n([new r.SocketMessageReader(e,t),new s.SocketMessageWriter(e,t)])});l.on("error",c),l.listen(e,"127.0.0.1",function(){l.removeListener("error",c),a({onConnected:function(){return o}})})})},t.createServerSocketTransport=function(e,t){void 0===t&&(t="utf-8");var n=i.createConnection(e,"127.0.0.1");return[new r.SocketMessageReader(n,t),new s.SocketMessageWriter(n,t)]}},function(e,t,n){"use strict";var i,r,s,o,a,c,l,u,h,d,p,f,m,g,y;n.r(t),n.d(t,"Position",function(){return i}),n.d(t,"Range",function(){return r}),n.d(t,"Location",function(){return s}),n.d(t,"Color",function(){return o}),n.d(t,"ColorInformation",function(){return a}),n.d(t,"ColorPresentation",function(){return c}),n.d(t,"FoldingRangeKind",function(){return l}),n.d(t,"FoldingRange",function(){return u}),n.d(t,"DiagnosticRelatedInformation",function(){return h}),n.d(t,"DiagnosticSeverity",function(){return d}),n.d(t,"Diagnostic",function(){return p}),n.d(t,"Command",function(){return f}),n.d(t,"TextEdit",function(){return m}),n.d(t,"TextDocumentEdit",function(){return g}),n.d(t,"WorkspaceEdit",function(){return y}),n.d(t,"WorkspaceChange",function(){return D}),n.d(t,"TextDocumentIdentifier",function(){return v}),n.d(t,"VersionedTextDocumentIdentifier",function(){return b}),n.d(t,"TextDocumentItem",function(){return _}),n.d(t,"MarkupKind",function(){return w}),n.d(t,"MarkupContent",function(){return S}),n.d(t,"CompletionItemKind",function(){return C}),n.d(t,"InsertTextFormat",function(){return T}),n.d(t,"CompletionItem",function(){return k}),n.d(t,"CompletionList",function(){return R}),n.d(t,"MarkedString",function(){return x}),n.d(t,"Hover",function(){return E}),n.d(t,"ParameterInformation",function(){return O}),n.d(t,"SignatureInformation",function(){return j}),n.d(t,"DocumentHighlightKind",function(){return M}),n.d(t,"DocumentHighlight",function(){return $}),n.d(t,"SymbolKind",function(){return P}),n.d(t,"SymbolInformation",function(){return N}),n.d(t,"DocumentSymbol",function(){return B}),n.d(t,"CodeActionKind",function(){return A}),n.d(t,"CodeActionContext",function(){return q}),n.d(t,"CodeAction",function(){return F}),n.d(t,"CodeLens",function(){return H}),n.d(t,"FormattingOptions",function(){return L}),n.d(t,"DocumentLink",function(){return z}),n.d(t,"EOL",function(){return V}),n.d(t,"TextDocument",function(){return W}),n.d(t,"TextDocumentSaveReason",function(){return U}),function(e){e.create=function(e,t){return{line:e,character:t}},e.is=function(e){var t=e;return K.objectLiteral(t)&&K.number(t.line)&&K.number(t.character)}}(i||(i={})),function(e){e.create=function(e,t,n,r){if(K.number(e)&&K.number(t)&&K.number(n)&&K.number(r))return{start:i.create(e,t),end:i.create(n,r)};if(i.is(e)&&i.is(t))return{start:e,end:t};throw new Error("Range#create called with invalid arguments["+e+", "+t+", "+n+", "+r+"]")},e.is=function(e){var t=e;return K.objectLiteral(t)&&i.is(t.start)&&i.is(t.end)}}(r||(r={})),function(e){e.create=function(e,t){return{uri:e,range:t}},e.is=function(e){var t=e;return K.defined(t)&&r.is(t.range)&&(K.string(t.uri)||K.undefined(t.uri))}}(s||(s={})),function(e){e.create=function(e,t,n,i){return{red:e,green:t,blue:n,alpha:i}},e.is=function(e){var t=e;return K.number(t.red)&&K.number(t.green)&&K.number(t.blue)&&K.number(t.alpha)}}(o||(o={})),function(e){e.create=function(e,t){return{range:e,color:t}},e.is=function(e){var t=e;return r.is(t.range)&&o.is(t.color)}}(a||(a={})),function(e){e.create=function(e,t,n){return{label:e,textEdit:t,additionalTextEdits:n}},e.is=function(e){var t=e;return K.string(t.label)&&(K.undefined(t.textEdit)||m.is(t))&&(K.undefined(t.additionalTextEdits)||K.typedArray(t.additionalTextEdits,m.is))}}(c||(c={})),function(e){e.Comment="comment",e.Imports="imports",e.Region="region"}(l||(l={})),function(e){e.create=function(e,t,n,i,r){var s={startLine:e,endLine:t};return K.defined(n)&&(s.startCharacter=n),K.defined(i)&&(s.endCharacter=i),K.defined(r)&&(s.kind=r),s},e.is=function(e){var t=e;return K.number(t.startLine)&&K.number(t.startLine)&&(K.undefined(t.startCharacter)||K.number(t.startCharacter))&&(K.undefined(t.endCharacter)||K.number(t.endCharacter))&&(K.undefined(t.kind)||K.string(t.kind))}}(u||(u={})),function(e){e.create=function(e,t){return{location:e,message:t}},e.is=function(e){var t=e;return K.defined(t)&&s.is(t.location)&&K.string(t.message)}}(h||(h={})),function(e){e.Error=1,e.Warning=2,e.Information=3,e.Hint=4}(d||(d={})),function(e){e.create=function(e,t,n,i,r,s){var o={range:e,message:t};return K.defined(n)&&(o.severity=n),K.defined(i)&&(o.code=i),K.defined(r)&&(o.source=r),K.defined(s)&&(o.relatedInformation=s),o},e.is=function(e){var t=e;return K.defined(t)&&r.is(t.range)&&K.string(t.message)&&(K.number(t.severity)||K.undefined(t.severity))&&(K.number(t.code)||K.string(t.code)||K.undefined(t.code))&&(K.string(t.source)||K.undefined(t.source))&&(K.undefined(t.relatedInformation)||K.typedArray(t.relatedInformation,h.is))}}(p||(p={})),function(e){e.create=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r={title:e,command:t};return K.defined(n)&&n.length>0&&(r.arguments=n),r},e.is=function(e){var t=e;return K.defined(t)&&K.string(t.title)&&K.string(t.command)}}(f||(f={})),function(e){e.replace=function(e,t){return{range:e,newText:t}},e.insert=function(e,t){return{range:{start:e,end:e},newText:t}},e.del=function(e){return{range:e,newText:""}},e.is=function(e){var t=e;return K.objectLiteral(t)&&K.string(t.newText)&&r.is(t.range)}}(m||(m={})),function(e){e.create=function(e,t){return{textDocument:e,edits:t}},e.is=function(e){var t=e;return K.defined(t)&&b.is(t.textDocument)&&Array.isArray(t.edits)}}(g||(g={})),function(e){e.is=function(e){var t=e;return t&&(void 0!==t.changes||void 0!==t.documentChanges)&&(void 0===t.documentChanges||K.typedArray(t.documentChanges,g.is))}}(y||(y={}));var v,b,_,w,S,C,T,k,R,x,E,O,j,M,$,P,N,I=function(){function e(e){this.edits=e}return e.prototype.insert=function(e,t){this.edits.push(m.insert(e,t))},e.prototype.replace=function(e,t){this.edits.push(m.replace(e,t))},e.prototype.delete=function(e){this.edits.push(m.del(e))},e.prototype.add=function(e){this.edits.push(e)},e.prototype.all=function(){return this.edits},e.prototype.clear=function(){this.edits.splice(0,this.edits.length)},e}(),D=function(){function e(e){var t=this;this._textEditChanges=Object.create(null),e&&(this._workspaceEdit=e,e.documentChanges?e.documentChanges.forEach(function(e){var n=new I(e.edits);t._textEditChanges[e.textDocument.uri]=n}):e.changes&&Object.keys(e.changes).forEach(function(n){var i=new I(e.changes[n]);t._textEditChanges[n]=i}))}return Object.defineProperty(e.prototype,"edit",{get:function(){return this._workspaceEdit},enumerable:!0,configurable:!0}),e.prototype.getTextEditChange=function(e){if(b.is(e)){if(this._workspaceEdit||(this._workspaceEdit={documentChanges:[]}),!this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for versioned document changes.");var t=e;if(!(i=this._textEditChanges[t.uri])){var n={textDocument:t,edits:r=[]};this._workspaceEdit.documentChanges.push(n),i=new I(r),this._textEditChanges[t.uri]=i}return i}if(this._workspaceEdit||(this._workspaceEdit={changes:Object.create(null)}),!this._workspaceEdit.changes)throw new Error("Workspace edit is not configured for normal text edit changes.");var i;if(!(i=this._textEditChanges[e])){var r=[];this._workspaceEdit.changes[e]=r,i=new I(r),this._textEditChanges[e]=i}return i},e}();!function(e){e.create=function(e){return{uri:e}},e.is=function(e){var t=e;return K.defined(t)&&K.string(t.uri)}}(v||(v={})),function(e){e.create=function(e,t){return{uri:e,version:t}},e.is=function(e){var t=e;return K.defined(t)&&K.string(t.uri)&&K.number(t.version)}}(b||(b={})),function(e){e.create=function(e,t,n,i){return{uri:e,languageId:t,version:n,text:i}},e.is=function(e){var t=e;return K.defined(t)&&K.string(t.uri)&&K.string(t.languageId)&&K.number(t.version)&&K.string(t.text)}}(_||(_={})),function(e){e.PlainText="plaintext",e.Markdown="markdown"}(w||(w={})),function(e){e.is=function(t){var n=t;return n===e.PlainText||n===e.Markdown}}(w||(w={})),function(e){e.is=function(e){var t=e;return K.objectLiteral(e)&&w.is(t.kind)&&K.string(t.value)}}(S||(S={})),function(e){e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25}(C||(C={})),function(e){e.PlainText=1,e.Snippet=2}(T||(T={})),function(e){e.create=function(e){return{label:e}}}(k||(k={})),function(e){e.create=function(e,t){return{items:e||[],isIncomplete:!!t}}}(R||(R={})),function(e){e.fromPlainText=function(e){return e.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")},e.is=function(e){var t=e;return K.string(t)||K.objectLiteral(t)&&K.string(t.language)&&K.string(t.value)}}(x||(x={})),function(e){e.is=function(e){var t=e;return K.objectLiteral(t)&&(S.is(t.contents)||x.is(t.contents)||K.typedArray(t.contents,x.is))&&(void 0===e.range||r.is(e.range))}}(E||(E={})),function(e){e.create=function(e,t){return t?{label:e,documentation:t}:{label:e}}}(O||(O={})),function(e){e.create=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r={label:e};return K.defined(t)&&(r.documentation=t),K.defined(n)?r.parameters=n:r.parameters=[],r}}(j||(j={})),function(e){e.Text=1,e.Read=2,e.Write=3}(M||(M={})),function(e){e.create=function(e,t){var n={range:e};return K.number(t)&&(n.kind=t),n}}($||($={})),function(e){e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26}(P||(P={})),function(e){e.create=function(e,t,n,i,r){var s={name:e,kind:t,location:{uri:i,range:n}};return r&&(s.containerName=r),s}}(N||(N={}));var A,q,F,H,L,B=function(){return function(){}}();!function(e){e.create=function(e,t,n,i,r,s){var o={name:e,detail:t,kind:n,range:i,selectionRange:r};return void 0!==s&&(o.children=s),o},e.is=function(e){var t=e;return t&&K.string(t.name)&&K.number(t.kind)&&r.is(t.range)&&r.is(t.selectionRange)&&(void 0===t.detail||K.string(t.detail))&&(void 0===t.deprecated||K.boolean(t.deprecated))&&(void 0===t.children||Array.isArray(t.children))}}(B||(B={})),function(e){e.QuickFix="quickfix",e.Refactor="refactor",e.RefactorExtract="refactor.extract",e.RefactorInline="refactor.inline",e.RefactorRewrite="refactor.rewrite",e.Source="source",e.SourceOrganizeImports="source.organizeImports"}(A||(A={})),function(e){e.create=function(e,t){var n={diagnostics:e};return null!=t&&(n.only=t),n},e.is=function(e){var t=e;return K.defined(t)&&K.typedArray(t.diagnostics,p.is)&&(void 0===t.only||K.typedArray(t.only,K.string))}}(q||(q={})),function(e){e.create=function(e,t,n){var i={title:e};return f.is(t)?i.command=t:i.edit=t,void 0!==n&&(i.kind=n),i},e.is=function(e){var t=e;return t&&K.string(t.title)&&(void 0===t.diagnostics||K.typedArray(t.diagnostics,p.is))&&(void 0===t.kind||K.string(t.kind))&&(void 0!==t.edit||void 0!==t.command)&&(void 0===t.command||f.is(t.command))&&(void 0===t.edit||y.is(t.edit))}}(F||(F={})),function(e){e.create=function(e,t){var n={range:e};return K.defined(t)&&(n.data=t),n},e.is=function(e){var t=e;return K.defined(t)&&r.is(t.range)&&(K.undefined(t.command)||f.is(t.command))}}(H||(H={})),function(e){e.create=function(e,t){return{tabSize:e,insertSpaces:t}},e.is=function(e){var t=e;return K.defined(t)&&K.number(t.tabSize)&&K.boolean(t.insertSpaces)}}(L||(L={}));var z=function(){return function(){}}();!function(e){e.create=function(e,t,n){return{range:e,target:t,data:n}},e.is=function(e){var t=e;return K.defined(t)&&r.is(t.range)&&(K.undefined(t.target)||K.string(t.target))}}(z||(z={}));var W,U,V=["\n","\r\n","\r"];!function(e){e.create=function(e,t,n,i){return new J(e,t,n,i)},e.is=function(e){var t=e;return!!(K.defined(t)&&K.string(t.uri)&&(K.undefined(t.languageId)||K.string(t.languageId))&&K.number(t.lineCount)&&K.func(t.getText)&&K.func(t.positionAt)&&K.func(t.offsetAt))},e.applyEdits=function(e,t){for(var n=e.getText(),i=function e(t,n){if(t.length<=1)return t;var i=t.length/2|0,r=t.slice(0,i),s=t.slice(i);e(r,n),e(s,n);for(var o=0,a=0,c=0;o<r.length&&a<s.length;){var l=n(r[o],s[a]);t[c++]=l<=0?r[o++]:s[a++]}for(;o<r.length;)t[c++]=r[o++];for(;a<s.length;)t[c++]=s[a++];return t}(t,function(e,t){var n=e.range.start.line-t.range.start.line;return 0===n?e.range.start.character-t.range.start.character:n}),r=n.length,s=i.length-1;s>=0;s--){var o=i[s],a=e.offsetAt(o.range.start),c=e.offsetAt(o.range.end);if(!(c<=r))throw new Error("Ovelapping edit");n=n.substring(0,a)+o.newText+n.substring(c,n.length),r=a}return n}}(W||(W={})),function(e){e.Manual=1,e.AfterDelay=2,e.FocusOut=3}(U||(U={}));var K,J=function(){function e(e,t,n,i){this._uri=e,this._languageId=t,this._version=n,this._content=i,this._lineOffsets=null}return Object.defineProperty(e.prototype,"uri",{get:function(){return this._uri},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"languageId",{get:function(){return this._languageId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!0}),e.prototype.getText=function(e){if(e){var t=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(t,n)}return this._content},e.prototype.update=function(e,t){this._content=e.text,this._version=t,this._lineOffsets=null},e.prototype.getLineOffsets=function(){if(null===this._lineOffsets){for(var e=[],t=this._content,n=!0,i=0;i<t.length;i++){n&&(e.push(i),n=!1);var r=t.charAt(i);n="\r"===r||"\n"===r,"\r"===r&&i+1<t.length&&"\n"===t.charAt(i+1)&&i++}n&&t.length>0&&e.push(t.length),this._lineOffsets=e}return this._lineOffsets},e.prototype.positionAt=function(e){e=Math.max(Math.min(e,this._content.length),0);var t=this.getLineOffsets(),n=0,r=t.length;if(0===r)return i.create(0,e);for(;n<r;){var s=Math.floor((n+r)/2);t[s]>e?r=s:n=s+1}var o=n-1;return i.create(o,e-t[o])},e.prototype.offsetAt=function(e){var t=this.getLineOffsets();if(e.line>=t.length)return this._content.length;if(e.line<0)return 0;var n=t[e.line],i=e.line+1<t.length?t[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)},Object.defineProperty(e.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!0,configurable:!0}),e}();!function(e){var t=Object.prototype.toString;e.defined=function(e){return void 0!==e},e.undefined=function(e){return void 0===e},e.boolean=function(e){return!0===e||!1===e},e.string=function(e){return"[object String]"===t.call(e)},e.number=function(e){return"[object Number]"===t.call(e)},e.func=function(e){return"[object Function]"===t.call(e)},e.objectLiteral=function(e){return null!==e&&"object"==typeof e},e.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)}}(K||(K={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(132),r=n(28),s=n(133);t.ImplementationRequest=s.ImplementationRequest;const o=n(134);t.TypeDefinitionRequest=o.TypeDefinitionRequest;const a=n(135);t.WorkspaceFoldersRequest=a.WorkspaceFoldersRequest,t.DidChangeWorkspaceFoldersNotification=a.DidChangeWorkspaceFoldersNotification;const c=n(136);t.ConfigurationRequest=c.ConfigurationRequest;const l=n(137);t.DocumentColorRequest=l.DocumentColorRequest,t.ColorPresentationRequest=l.ColorPresentationRequest;const u=n(138);t.FoldingRangeRequest=u.FoldingRangeRequest,function(e){e.is=function(e){let t=e;return i.string(t.language)||i.string(t.scheme)||i.string(t.pattern)}}(t.DocumentFilter||(t.DocumentFilter={})),function(e){e.type=new r.RequestType("client/registerCapability")}(t.RegistrationRequest||(t.RegistrationRequest={})),function(e){e.type=new r.RequestType("client/unregisterCapability")}(t.UnregistrationRequest||(t.UnregistrationRequest={})),function(e){e.None=0,e.Full=1,e.Incremental=2}(t.TextDocumentSyncKind||(t.TextDocumentSyncKind={})),function(e){e.type=new r.RequestType("initialize")}(t.InitializeRequest||(t.InitializeRequest={})),function(e){e.unknownProtocolVersion=1}(t.InitializeError||(t.InitializeError={})),function(e){e.type=new r.NotificationType("initialized")}(t.InitializedNotification||(t.InitializedNotification={})),function(e){e.type=new r.RequestType0("shutdown")}(t.ShutdownRequest||(t.ShutdownRequest={})),function(e){e.type=new r.NotificationType0("exit")}(t.ExitNotification||(t.ExitNotification={})),function(e){e.type=new r.NotificationType("workspace/didChangeConfiguration")}(t.DidChangeConfigurationNotification||(t.DidChangeConfigurationNotification={})),function(e){e.Error=1,e.Warning=2,e.Info=3,e.Log=4}(t.MessageType||(t.MessageType={})),function(e){e.type=new r.NotificationType("window/showMessage")}(t.ShowMessageNotification||(t.ShowMessageNotification={})),function(e){e.type=new r.RequestType("window/showMessageRequest")}(t.ShowMessageRequest||(t.ShowMessageRequest={})),function(e){e.type=new r.NotificationType("window/logMessage")}(t.LogMessageNotification||(t.LogMessageNotification={})),function(e){e.type=new r.NotificationType("telemetry/event")}(t.TelemetryEventNotification||(t.TelemetryEventNotification={})),function(e){e.type=new r.NotificationType("textDocument/didOpen")}(t.DidOpenTextDocumentNotification||(t.DidOpenTextDocumentNotification={})),function(e){e.type=new r.NotificationType("textDocument/didChange")}(t.DidChangeTextDocumentNotification||(t.DidChangeTextDocumentNotification={})),function(e){e.type=new r.NotificationType("textDocument/didClose")}(t.DidCloseTextDocumentNotification||(t.DidCloseTextDocumentNotification={})),function(e){e.type=new r.NotificationType("textDocument/didSave")}(t.DidSaveTextDocumentNotification||(t.DidSaveTextDocumentNotification={})),function(e){e.type=new r.NotificationType("textDocument/willSave")}(t.WillSaveTextDocumentNotification||(t.WillSaveTextDocumentNotification={})),function(e){e.type=new r.RequestType("textDocument/willSaveWaitUntil")}(t.WillSaveTextDocumentWaitUntilRequest||(t.WillSaveTextDocumentWaitUntilRequest={})),function(e){e.type=new r.NotificationType("workspace/didChangeWatchedFiles")}(t.DidChangeWatchedFilesNotification||(t.DidChangeWatchedFilesNotification={})),function(e){e.Created=1,e.Changed=2,e.Deleted=3}(t.FileChangeType||(t.FileChangeType={})),function(e){e.Create=1,e.Change=2,e.Delete=4}(t.WatchKind||(t.WatchKind={})),function(e){e.type=new r.NotificationType("textDocument/publishDiagnostics")}(t.PublishDiagnosticsNotification||(t.PublishDiagnosticsNotification={})),function(e){e.Invoked=1,e.TriggerCharacter=2,e.TriggerForIncompleteCompletions=3}(t.CompletionTriggerKind||(t.CompletionTriggerKind={})),function(e){e.type=new r.RequestType("textDocument/completion")}(t.CompletionRequest||(t.CompletionRequest={})),function(e){e.type=new r.RequestType("completionItem/resolve")}(t.CompletionResolveRequest||(t.CompletionResolveRequest={})),function(e){e.type=new r.RequestType("textDocument/hover")}(t.HoverRequest||(t.HoverRequest={})),function(e){e.type=new r.RequestType("textDocument/signatureHelp")}(t.SignatureHelpRequest||(t.SignatureHelpRequest={})),function(e){e.type=new r.RequestType("textDocument/definition")}(t.DefinitionRequest||(t.DefinitionRequest={})),function(e){e.type=new r.RequestType("textDocument/references")}(t.ReferencesRequest||(t.ReferencesRequest={})),function(e){e.type=new r.RequestType("textDocument/documentHighlight")}(t.DocumentHighlightRequest||(t.DocumentHighlightRequest={})),function(e){e.type=new r.RequestType("textDocument/documentSymbol")}(t.DocumentSymbolRequest||(t.DocumentSymbolRequest={})),function(e){e.type=new r.RequestType("workspace/symbol")}(t.WorkspaceSymbolRequest||(t.WorkspaceSymbolRequest={})),function(e){e.type=new r.RequestType("textDocument/codeAction")}(t.CodeActionRequest||(t.CodeActionRequest={})),function(e){e.type=new r.RequestType("textDocument/codeLens")}(t.CodeLensRequest||(t.CodeLensRequest={})),function(e){e.type=new r.RequestType("codeLens/resolve")}(t.CodeLensResolveRequest||(t.CodeLensResolveRequest={})),function(e){e.type=new r.RequestType("textDocument/formatting")}(t.DocumentFormattingRequest||(t.DocumentFormattingRequest={})),function(e){e.type=new r.RequestType("textDocument/rangeFormatting")}(t.DocumentRangeFormattingRequest||(t.DocumentRangeFormattingRequest={})),function(e){e.type=new r.RequestType("textDocument/onTypeFormatting")}(t.DocumentOnTypeFormattingRequest||(t.DocumentOnTypeFormattingRequest={})),function(e){e.type=new r.RequestType("textDocument/rename")}(t.RenameRequest||(t.RenameRequest={})),function(e){e.type=new r.RequestType("textDocument/prepareRename")}(t.PrepareRenameRequest||(t.PrepareRenameRequest={})),function(e){e.type=new r.RequestType("textDocument/documentLink")}(t.DocumentLinkRequest||(t.DocumentLinkRequest={})),function(e){e.type=new r.RequestType("documentLink/resolve")}(t.DocumentLinkResolveRequest||(t.DocumentLinkResolveRequest={})),function(e){e.type=new r.RequestType("workspace/executeCommand")}(t.ExecuteCommandRequest||(t.ExecuteCommandRequest={})),function(e){e.type=new r.RequestType("workspace/applyEdit")}(t.ApplyWorkspaceEditRequest||(t.ApplyWorkspaceEditRequest={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=Object.prototype.toString;function r(e){return"[object String]"===i.call(e)}function s(e){return"[object Function]"===i.call(e)}function o(e){return Array.isArray(e)}t.boolean=function(e){return!0===e||!1===e},t.string=r,t.number=function(e){return"[object Number]"===i.call(e)},t.error=function(e){return"[object Error]"===i.call(e)},t.func=s,t.array=o,t.stringArray=function(e){return o(e)&&e.every(e=>r(e))},t.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)},t.thenable=function(e){return e&&s(e.then)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(28);!function(e){e.type=new i.RequestType("textDocument/implementation")}(t.ImplementationRequest||(t.ImplementationRequest={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(28);!function(e){e.type=new i.RequestType("textDocument/typeDefinition")}(t.TypeDefinitionRequest||(t.TypeDefinitionRequest={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(28);!function(e){e.type=new i.RequestType0("workspace/workspaceFolders")}(t.WorkspaceFoldersRequest||(t.WorkspaceFoldersRequest={})),function(e){e.type=new i.NotificationType("workspace/didChangeWorkspaceFolders")}(t.DidChangeWorkspaceFoldersNotification||(t.DidChangeWorkspaceFoldersNotification={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(28);!function(e){e.type=new i.RequestType("workspace/configuration")}(t.ConfigurationRequest||(t.ConfigurationRequest={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(28);!function(e){e.type=new i.RequestType("textDocument/documentColor")}(t.DocumentColorRequest||(t.DocumentColorRequest={})),function(e){e.type=new i.RequestType("textDocument/colorPresentation")}(t.ColorPresentationRequest||(t.ColorPresentationRequest={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(28);!function(e){e.Comment="comment",e.Imports="imports",e.Region="region"}(t.FoldingRangeKind||(t.FoldingRangeKind={})),function(e){e.type=new i.RequestType("textDocument/foldingRange")}(t.FoldingRangeRequest||(t.FoldingRangeRequest={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(50),r=n(86);t.ConfigurationFeature=(e=>(class extends e{getConfiguration(e){return e?r.string(e)?this._getConfiguration({section:e}):this._getConfiguration(e):this._getConfiguration({})}_getConfiguration(e){let t={items:Array.isArray(e)?e:[e]};return this.connection.sendRequest(i.ConfigurationRequest.type,t).then(t=>Array.isArray(e)?t:t[0])}}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(50);t.WorkspaceFoldersFeature=(e=>(class extends e{initialize(e){let t=e.workspace;t&&t.workspaceFolders&&(this._onDidChangeWorkspaceFolders=new i.Emitter,this.connection.onNotification(i.DidChangeWorkspaceFoldersNotification.type,e=>{this._onDidChangeWorkspaceFolders.fire(e.event)}))}getWorkspaceFolders(){return this.connection.sendRequest(i.WorkspaceFoldersRequest.type)}get onDidChangeWorkspaceFolders(){if(!this._onDidChangeWorkspaceFolders)throw new Error("Client doesn't support sending workspace folder change events.");return this._unregistration||(this._unregistration=this.connection.client.register(i.DidChangeWorkspaceFoldersNotification.type)),this._onDidChangeWorkspaceFolders.event}}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}}class r extends i{constructor(){super([r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-","4",r._randomHex(),r._randomHex(),r._randomHex(),"-",r._oneOf(r._timeHighBits),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex()].join(""))}static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return r._oneOf(r._chars)}}function s(){return new r}r._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"],r._timeHighBits=["8","9","a","b"],t.empty=new i("00000000-0000-0000-0000-000000000000"),t.v4=s;const o=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function a(e){return o.test(e)}t.isUUID=a,t.parse=function(e){if(!a(e))throw new Error("invalid uuid");return new i(e)},t.generateUuid=function(){return s().asHex()}},function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0});const r=n(16),s=n(22),o=n(17),a=n(143);function c(){return"win32"===process.platform}function l(e,t,n,i){const r=["var p = process;","p.on('message',function(m){","if(m.c==='e'){","p.exit(0);","}","else if(m.c==='rs'){","try{","var r=require.resolve(m.a);","p.send({c:'r',s:true,r:r});","}","catch(err){","p.send({c:'r',s:false});","}","}","});"].join("");return new Promise((o,c)=>{let l=process.env,u=Object.create(null);Object.keys(l).forEach(e=>u[e]=l[e]),t&&(u.NODE_PATH?u.NODE_PATH=t+s.delimiter+u.NODE_PATH:u.NODE_PATH=t,i&&i(`NODE_PATH value is: ${u.NODE_PATH}`)),u.ELECTRON_RUN_AS_NODE="1";try{let t=a.fork("",[],{cwd:n,env:u,execArgv:["-e",r]});if(void 0===t.pid)return void c(new Error(`Starting process to resolve node module  ${e} failed`));t.on("error",e=>{c(e)}),t.on("message",n=>{"r"===n.c&&(t.send({c:"e"}),n.s?o(n.r):c(new Error(`Failed to resolve module: ${e}`)))});let i={c:"rs",a:e};t.send(i)}catch(e){c(e)}})}function u(e){let t="npm",n={encoding:"utf8"};c()&&(t="npm.cmd",n.shell=!0);let i=()=>{};try{process.on("SIGPIPE",i);let r=a.spawnSync(t,["config","get","prefix"],n).stdout;if(!r)return void(e&&e("'npm config get prefix' didn't return a value."));let o=r.trim();return e&&e(`'npm config get prefix' value is: ${o}`),o.length>0?c()?s.join(o,"node_modules"):s.join(o,"lib","node_modules"):void 0}catch(e){return}finally{process.removeListener("SIGPIPE",i)}}var h;function d(e,t,n,i){return n?(s.isAbsolute(n)||(n=s.join(e,n)),l(t,n,n,i).then(e=>h.isParent(n,e)?e:Promise.reject(new Error(`Failed to load ${t} from node path location.`))).then(void 0,n=>l(t,u(i),e,i))):l(t,u(i),e,i)}t.uriToFilePath=function(e){let t=r.parse(e);if("file:"!==t.protocol||!t.path)return;let n=t.path.split("/");for(var i=0,o=n.length;i<o;i++)n[i]=decodeURIComponent(n[i]);if("win32"===process.platform&&n.length>1){let e=n[0],t=n[1];0===e.length&&t.length>1&&":"===t[1]&&n.shift()}return s.normalize(n.join("/"))},t.resolveModule=function(t,i){return new Promise((r,o)=>{let l=[];t&&l.push(s.join(t,"node_modules")),a.exec("npm config get prefix",(t,u,h)=>{if(!t){let e=u.replace(/[\s\r\n]+$/,"");e.length>0&&(c()?l.push(s.join(e,"node_modules")):l.push(s.join(e,"lib","node_modules")))}let d=c()?";":":",p=process.env,f=Object.create(null);Object.keys(p).forEach(e=>f[e]=p[e]),f.NODE_PATH?f.NODE_PATH=l.join(d)+d+f.NODE_PATH:f.NODE_PATH=l.join(d),f.ELECTRON_RUN_AS_NODE="1";try{let c=a.fork(s.join(e,"resolve.js"),[],{env:f,execArgv:[]});if(void 0===c.pid)return void o(new Error(`Starting process to resolve node module  ${i} failed`));c.on("message",e=>{if("resolve"===e.command){let t=i;e.success&&(t=e.result),c.send({command:"exit"});try{r(n(87)(t))}catch(e){o(e)}}});let l={command:"resolve",args:i};c.send(l)}catch(t){o(t)}})})},t.resolve=l,t.resolveGlobalNodePath=u,t.resolveGlobalYarnPath=function(e){let t="yarn",n={encoding:"utf8"};c()&&(t="yarn.cmd",n.shell=!0);let i=()=>{};try{process.on("SIGPIPE",i);let r=a.spawnSync(t,["global","dir","--json"],n),o=r.stdout;if(!o)return void(e&&(e("'yarn global dir' didn't return a value."),r.stderr&&e(r.stderr)));let c=o.trim().split(/\r?\n/);for(let e of c)try{let t=JSON.parse(e);if("log"===t.type)return s.join(t.data,"node_modules")}catch(e){}return}catch(e){return}finally{process.removeListener("SIGPIPE",i)}},function(e){let t=void 0;function n(){return void 0!==t?t:t="win32"!==process.platform&&(!o.existsSync(i.toUpperCase())||!o.existsSync(i.toLowerCase()))}e.isCaseSensitive=n,e.isParent=function(e,t){return n()?0===s.normalize(t).indexOf(s.normalize(e)):0==s.normalize(t).toLowerCase().indexOf(s.normalize(e).toLowerCase())}}(h=t.FileSystem||(t.FileSystem={})),t.resolveModulePath=d,t.resolveModule2=function(e,t,i,r){return d(e,t,i,r).then(e=>(r&&r(`Module ${t} got resolved to ${e}`),n(87)(e)))}}).call(this,"/","/index.js")},function(e,t){e.exports=require("child_process")},function(e){e.exports={name:"arcs",version:"0.0.0",private:!0,config:{port:"8786",host:"localhost"},browser:"dist/webmain.js",module:"dist/webmain.js",main:"dist/index.es.js",scripts:{prepare:"cross-env tools/sigh check && cd devtools && npm install","test-with-start":"run-p --print-name --race start test",test:"run-s --print-name --continue-on-error test-no-web test-wdio-shells","test-no-web":"run-s --print-name --continue-on-error test-sigh test-extension","test-shells":"run-p --print-name --race start s-test-shells","test-sigh":"cross-env tools/sigh","test-health":"cross-env tools/sigh health","test-extension":"mocha-chrome extension/test/index.test.html","test:licenses":"jsgl --local . && npm --prefix devtools run test:licenses && npm --prefix server run test:licenses",start:"lws --stack lws-static --hostname localhost -p 8786","test-wdio-shells":"wdio -b http://localhost:8786/ shells/test/wdio.conf.js","build:rollup":"rollup -c --sourcemap","watch:rollup":"rollup -c --sourcemap --watch","build:typedoc":"typedoc --ignoreCompilerErrors --mode file --target ES2017 --downLevelIteration -out dist/apidocs",server:"npm install && ./tools/sigh && npm run build:rollup && npm --prefix server install && npm --prefix server run test","server:start":"npm --prefix server start","s-test-shells":"run-s --print-name --continue-on-error test-wdio-shells","build:tsc":"tsc","watch:tsc":"tsc -w","build:webpack":"webpack","build:webpack-tools":"webpack --config ./src/tools/webpack.config.js","watch:webpack":"webpack --watch",watch:"concurrently npm:watch:*"},devDependencies:{"@types/chai":"^4.1.7","@types/jszip":"^3.1.5","@types/minimist":"^1.2.0","@types/mocha":"^5.2.5","@types/node":"^10.12.24","@types/pouchdb":"^6.3.3","@types/pouchdb-core":"^7.0.1","@typescript-eslint/eslint-plugin":"^1.9.0","@typescript-eslint/parser":"^1.9.0",c8:"^4.1.5",chai:"^4.2.0",chromedriver:"^74.0.0",concurrently:"^4.1.0","cross-env":"^5.2.0",eslint:"^5.16.0","eslint-config-google":"^0.13.0","eslint-plugin-header":"^3.0.0",glob:"^7.1.4",grammkit:"0.7.0","js-green-licenses":"^1.1.0",lws:"^2.0.0","lws-static":"^1.1.2",minimist:"^1.2.0",mocha:"^5.2.0","mocha-chrome":"^2.0.0","node-webcrypto-ossl":"^1.0.39","npm-run-all":"^4.1.5",pegjs:"^0.10.0",request:"^2.88.0",rollup:"^1.1.2","rollup-plugin-commonjs":"^9.2.0","rollup-plugin-ignore":"^1.0.5","rollup-plugin-multi-entry":"^2.1.0","rollup-plugin-node-resolve":"^4.0.0","rollup-plugin-typescript2":"^0.21.1",sloc:"^0.2.1","ts-pegjs":"^0.2.2",tslint:"^5.16.0","type-coverage":"^2.0.1",typedoc:"^0.14.2","vscode-jsonrpc":"^4.0.0","vscode-languageserver":"^5.0.0","vscode-languageserver-types":"^3.0.3","vscode-uri":"^1.0.6","wdio-chromedriver-service":"^5.0.1","wdio-errorshot-reporter":"^0.2.1","wdio-mocha-framework":"^0.6.4","wdio-spec-reporter":"^0.1.5",webdriverio:"^4.14.1",webpack:"^4.32.2","webpack-cli":"^3.2.3"},dependencies:{"@tensorflow/tfjs-node":"^1.1.2",assert:"^1.4.1",esm:"^3.0.84",firebase:"^6.0.4",idb:"^2.1.3",jsrsasign:"^8.0.12","jsrsasign-util":"^1.0.0",jszip:"^3.2.1","node-fetch":"^2.3.0",pouchdb:"^7.0.0","pouchdb-adapter-memory":"^7.0.0","pouchdb-debug":"^7.0.0",protobufjs:"^6.8.8","source-map-support":"^0.5.12","sourcemapped-stacktrace":"^1.1.9",typescript:"^3.4.5",ws:"^4.1.0"},repository:{type:"git",url:"https://github.com/PolymerLabs/arcs.git"},author:"The Polymer Project Authors",license:"BSD-3-Clause",homepage:"https://github.com/PolymerLabs/arcs",bugs:{url:"https://github.com/PolymerLabs/arcs/issues"},engines:{node:">= 10.13.0",npm:">= 6.9.0"}}},function(e,t,n){"use strict";n.r(t);var i=n(33),r=n(44),s=n(35),o=n(60),a=n(34),c=n(17),l=n.n(c),u=n(22),h=n.n(u);
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class d{constructor(e){this.context=e}path(e){return e.replace(/[\/][^\/]+$/,"/")}join(e,t){return/^https?:\/\//.test(t)?t:"/"===t[0]||":"===t[1]?t:h.a.join(h.a.normalize(e),t)}async loadResource(e){return new Promise((t,n)=>{l.a.readFile(e,{encoding:"utf-8"},(i,r)=>{this.context.logger.info(`Finished reading file ${e}`),!i&&r||(this.context.logger.error(`Error reading file ${e}`),n(i)),this.context.logger.info(`Success reading file ${e}`),t(r)})})}}var p=n(16);
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const f="2.0";class m{log(...e){}info(...e){}warn(...e){}error(...e){}}function g(e){if(!e)return;const t=p.parse(e);if("file:"!==t.protocol)throw new Error("Cannot resolve non-file uri to path: "+e);let n=t.pathname||"";return/^\/[a-z]:\//i.test(n)&&(n=n.substr(1).replace(/\//g,"\\")),decodeURIComponent(n)}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const y={initialize:(e,t)=>{return t.rootPath=e.rootPath||g(e.rootUri),{capabilities:{textDocumentSync:o.TextDocumentSyncKind.Full,hoverProvider:!1,signatureHelpProvider:{triggerCharacters:["(",","]},definitionProvider:!1,typeDefinitionProvider:!1,referencesProvider:!1,documentSymbolProvider:!1,workspaceSymbolProvider:!1,xworkspaceReferencesProvider:!1,xdefinitionProvider:!1,xdependenciesProvider:!1,completionProvider:{resolveProvider:!1,triggerCharacters:["."]},codeActionProvider:!1,renameProvider:!1,executeCommandProvider:{commands:[]},xpackagesProvider:!1}}},textDocumentCompletion:async(e,t)=>{const n=e.textDocument.uri;t.logger.info(`Completing for : ${n}...`)},textDocumentDidSave:async(e,t)=>{const n=(e=e).textDocument.uri;return t.logger.info(`Handling save for: ${n}...`),v(n,t)},textDocumentDidChange:async(e,t)=>{const n=(e=e).textDocument.uri;return t.logger.info(`Handling changes for: ${n}...`),v(n,t)},textDocumentDidOpen:async(e,t)=>{const n=(e=e).textDocument.uri;return t.logger.info(`Opened: ${n}...`),v(n,t)}};async function v(e,t){const n=await async function(e,t){const n=g(function(e){const t=p.parse(e);if(!t.pathname)return e;const n=t.pathname.split("/").map(e=>encodeURIComponent(decodeURIComponent(e)));return/^[a-z]%3A$/i.test(n[1])&&(n[1]=decodeURIComponent(n[1])),t.pathname=n.join("/"),p.format(t)}(e)),i=[];try{const e=await a.a.load(n,new d(t));i.push(...a.a.getErrors(e))}catch(e){i.push(e)}const r=i.map(b);return{uri:e,diagnostics:r}}(e,t);return{jsonrpc:f,method:"textDocument/publishDiagnostics",params:n}}function b(e){const t=e=>({character:e.column,line:e.line-1});return{range:{start:t(e.location.start),end:t(e.location.end)},message:(e=>e=(e=e.replace(/^(Parse|Post-parse) [^\n]*line [0-9]*.\n/g,"")).replace(/\n.*/g,""))(e.message),code:e.key,severity:o.DiagnosticSeverity.Error,source:e.location.filename||"aml"}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class _{constructor(e,t,n,i){this.initialized=!1,this.streaming=!1,this.reader=e,this.writer=t,this.context={logger:i,options:n},this.reader.listen(e=>{this.update(e).then(e=>{this.context.logger.info("Response: ",e||"No response."),e&&t.write(e)}).catch(e=>this.context.logger.error(e))}),this.reader.onError(e=>{this.context.logger.error(e)})}async update(e){const t=this.context.logger;if(Object(s.isResponseMessage)(e))return void t.info("Received response message:",e);if(!Object(s.isRequestMessage)(e)&&!Object(s.isNotificationMessage)(e))return void t.error("Received invalid message:",e);t.info("Received valid message:",e);const n=e.method.replace(/\/(.?)/g,(e,t)=>t.toUpperCase());switch(n){case"initialize":this.initialized=!0,this.streaming=e.params.capabilities.streaming;break;case"shutdown":return void(this.initialized=!1);case"exit":return}const i=y[n];return"function"!=typeof i?Object(s.isRequestMessage)(e)?{jsonrpc:f,id:e.id,error:{code:r.ErrorCodes.MethodNotFound,message:`Method ${n} not implemented`}}:void t.warn(`Method ${n} not implemented`):await i(e.params,this.context)}}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function w(e,t,n,i,s){const o=new r.StreamMessageReader(t),a=new r.StreamMessageWriter(n);o.onClose(n=>{t.end(),t.destroy(),i.logger.log(`Connection ${e} closed (exit notification)`)});new _(o,a,i,s)}
/**
 * @license
 * Copyright (c) 2019 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const S=n(52),C={string:["port","log"],boolean:["help","version","stdio"],alias:{v:"version",h:"help",p:"port",l:"log"},default:{port:2089,log:"null"}};!function(){const e=S(process.argv,C);if(e.version||e.help){const t=n(144);if(console.log(`Arcs Manifest Language Server v${t.version}`),e.help){const e=[...C.string,...C.boolean];console.log(`Options:${e.map(e=>` ${e}`)}`)}process.exit(0)}!function(e){let t;switch(e.log){case"console":t=console;break;case"null":t=new m;break;default:throw new Error(`Unknown logger ${e.log}`)}if(e.stdio)return void w(0,process.stdin,process.stdout,e,t);t.log(`Starting server on port ${e.port}!`);let n=1;Object(i.createServer)(i=>{const r=n++;t.log(`Connection ${r} accepted`),w(r,i,i,e,t)}).listen(e.port,()=>{t.info(`Listening for connections on ${e.port}`)})}(e)}()}]);