!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=r(1),i=r(33);
// @license
console.log.bind(console,"%cworker-entry","background: #12005e; color: white; padding: 1px 6px 2px 7px; border-radius: 6px;");self.onmessage=function(e){self.onmessage=null;const{id:t,base:r}=e.data;new n.ParticleExecutionContext(e.ports[0],t,new i.BrowserLoader(r))}},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"ParticleExecutionContext",function(){return o});var n=r(3),i=r(5),s=r(15),a=r(31);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o{constructor(t,r,n){this.particles=[],this._nextLocalID=0,this.pendingLoads=[],this.scheduler=new a.StorageProxyScheduler,this.keyedProxies={},this.apiPort=new s.PECInnerPort(t),this.idBase=r,this.loader=n,n.setParticleExecutionContext(this),this.apiPort.onDefineHandle=(({type:e,identifier:t,name:r})=>a.StorageProxy.newProxy(t,e,this.apiPort,this,this.scheduler,r)),this.apiPort.onGetBackingStoreCallback=(({type:e,id:t,name:r,callback:n,storageKey:i})=>{const s=a.StorageProxy.newProxy(t,e,this.apiPort,this,this.scheduler,r);return s.storageKey=i,[s,()=>n(s,i)]}),this.apiPort.onCreateHandleCallback=(({type:e,id:t,name:r,callback:n})=>{const i=a.StorageProxy.newProxy(t,e,this.apiPort,this,this.scheduler,r);return[i,()=>n(i)]}),this.apiPort.onMapHandleCallback=(({id:e,callback:t})=>[e,()=>t(e)]),this.apiPort.onCreateSlotCallback=(({hostedSlotId:e,callback:t})=>[e,()=>t(e)]),this.apiPort.onInnerArcRender=(({transformationParticle:e,transformationSlotName:t,hostedSlotId:r,content:n})=>{e.renderHostedSlot(t,r,n)}),this.apiPort.onStop=(()=>{e.close&&e.close()}),this.apiPort.onInstantiateParticle=(({id:e,spec:t,handles:r})=>this._instantiateParticle(e,t,r)),this.apiPort.onSimpleCallback=(({callback:e,data:t})=>e(t)),this.apiPort.onConstructArcCallback=(({callback:e,arc:t})=>e(t)),this.apiPort.onAwaitIdle=(({version:e})=>this.idle.then(t=>{setTimeout(()=>{this.apiPort.Idle({version:e,relevance:this.relevance})},0)})),this.apiPort.onUIEvent=(({particle:e,slotName:t,event:r})=>e.fireEvent(t,r)),this.apiPort.onStartRender=(({particle:e,slotName:t,providedSlots:r,contentTypes:n})=>{e._slotByName.set(t,new class{constructor(e,t,r,n){this.handlers=new Map,this.requestedContentTypes=new Set,this._isRendered=!1,this.slotName=r,this.particle=t,this.pec=e,this.providedSlots=n}get isRendered(){return this._isRendered}render(r){r.template&&this.providedSlots.size>0&&("string"==typeof(r=Object.assign({},r)).template?r.template=this.substituteSlotNamesForIds(r.template):r.template=Object.entries(r.template).reduce((e,[t,r])=>(e[t]=this.substituteSlotNamesForIds(r),e),{})),this.pec.apiPort.Render({particle:e,slotName:t,content:r}),Object.keys(r).forEach(e=>{this.requestedContentTypes.delete(e)}),this._isRendered=0===this.requestedContentTypes.size&&Object.keys(r).length>0}substituteSlotNamesForIds(e){return this.providedSlots.forEach((t,r)=>{e=e.replace(new RegExp(`slotid="${r}"`,"gi"),`slotid="${t}"`)}),e}registerEventHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}clearEventHandlers(e){this.handlers.set(e,[])}fireEvent(e){for(const t of this.handlers.get(e.handler)||[])t(e)}}(this,e,t,r)),e.renderSlot(t,n)}),this.apiPort.onStopRender=(({particle:e,slotName:t})=>{Object(i.assert)(e._slotByName.has(t),`Stop render called for particle ${e.name} slot ${t} without start render being called.`),e._slotByName.delete(t)})}generateIDComponents(){return{base:this.idBase,component:()=>this._nextLocalID++}}generateID(){return`${this.idBase}:${this._nextLocalID++}`}innerArcHandle(e,t){const r=this;return{createHandle:(i,s,a)=>new Promise((o,c)=>r.apiPort.ArcCreateHandle({arc:e,type:i,name:s,callback:e=>{const r=Object(n.handleFor)(e,s,t);o(r),a&&e.register(a,r)}})),mapHandle:t=>new Promise((n,i)=>r.apiPort.ArcMapHandle({arc:e,handle:t,callback:e=>{n(e)}})),createSlot:(t,n,i,s,a)=>new Promise((o,c)=>r.apiPort.ArcCreateSlot({arc:e,transformationParticle:t,transformationSlotName:n,hostedParticleName:i,hostedSlotName:s,handleId:a,callback:e=>{o(e)}})),loadRecipe:t=>new Promise((n,i)=>r.apiPort.ArcLoadRecipe({arc:e,recipe:t,callback:e=>{void 0==e?n():i(e)}}))}}getStorageProxy(e,t){return this.keyedProxies[e]||(this.keyedProxies[e]=new Promise((r,n)=>{this.apiPort.GetBackingStore({storageKey:e,type:t,callback:(e,t)=>{this.keyedProxies[t]=e,r(e)}})})),this.keyedProxies[e]}defaultCapabilitySet(){return{constructInnerArc:e=>new Promise((t,r)=>this.apiPort.ConstructInnerArc({callback:r=>{t(this.innerArcHandle(r,e.id))},particle:e}))}}async _instantiateParticle(e,t,r){t.name;let i=null;const s=new Promise(e=>i=e);this.pendingLoads.push(s);const a=await this.loader.loadParticleClass(t),o=this.defaultCapabilitySet(),c=new a;c.id=e,c.capabilities=o,this.particles.push(c);const l=new Map,h=[];return r.forEach((r,i)=>{const s=t.connectionMap.get(i),a=Object(n.handleFor)(r,i,e,s.isInput,s.isOutput);l.set(i,a),h.push({proxy:r,particle:c,handle:a})}),[c,async()=>{await c.setHandles(l),h.forEach(({proxy:e,particle:t,handle:r})=>e.register(t,r));const e=this.pendingLoads.indexOf(s);this.pendingLoads.splice(e,1),i()}]}get relevance(){const e=new Map;return this.particles.forEach(t=>{0!==t.relevances.length&&(e.set(t,t.relevances),t.relevances=[])}),e}get busy(){return!!(this.pendingLoads.length>0||this.scheduler.busy)||this.particles.filter(e=>e.busy).length>0}get idle(){if(!this.busy)return Promise.resolve();const e=this.particles.filter(e=>e.busy).map(e=>e.idle);return Promise.all([this.scheduler.idle,...this.pendingLoads,...e]).then(()=>this.idle)}}}.call(this,r(2))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";r.r(t),r.d(t,"Handle",function(){return l}),r.d(t,"Collection",function(){return h}),r.d(t,"Variable",function(){return u}),r.d(t,"BigCollection",function(){return p}),r.d(t,"handleFor",function(){return f});var n=r(4),i=r(11),s=r(5),a=r(14),o=r(6);function c(e,t){Object(s.assert)(t,"Handles need entity classes for deserialization");const{id:r,rawData:n}=e,i=new t(
/** @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function(e){return e}(n));return e.id&&i.identify(e.id),i}class l{constructor(e,t,r,n,i){Object(s.assert)(!(e instanceof l)),this._proxy=e,this.name=t||this._proxy.name,this.canRead=n,this.canWrite=i,this._particleId=r,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1}}raiseSystemException(e,t){this._proxy.raiseSystemException(e,t,this._particleId)}configure(e){Object(s.assert)(this.canRead,"configure can only be called on readable Handles");try{const t=Object.keys(this.options),r=Object.keys(e).filter(e=>!t.includes(e));if(r.length>0)throw new Error(`Invalid option in Handle.configure(): ${r}`);Object.assign(this.options,e)}catch(e){throw this.raiseSystemException(e,"Handle::configure"),e}}_serialize(e){return Object(s.assert)(e,"can't serialize a null entity"),e.isIdentified()||e.createIdentity(this._proxy.generateIDComponents()),{id:e[i.Symbols.identifier],rawData:e.dataClone()}}get type(){return this._proxy.type}get _id(){return this._proxy.id}toManifestString(){return`'${this._id}'`}}class h extends l{_notify(e,t,r){switch(Object(s.assert)(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void t.onHandleSync(this,this._restore(r));case"update":{const e={};return"add"in r&&(e.added=this._restore(r.add)),"remove"in r&&(e.removed=this._restore(r.remove)),e.originator=r.originatorId===this._particleId,void t.onHandleUpdate(this,e)}case"desync":return void t.onHandleDesync(this);default:throw new Error("unsupported")}}async get(e){if(!this.canRead)throw new Error("Handle not readable");return this._restore([await this._proxy.get(e,this._particleId)])[0]}async toList(){if(!this.canRead)throw new Error("Handle not readable");return this._restore(await this._proxy.toList())}_restore(e){return null!==e?e.map(e=>c(e,this.entityClass)):null}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),r=[this._proxy.generateID()+"key"];return this._proxy.store(t,r,this._particleId)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.clear(this._particleId)}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);this._proxy.remove(t.id,[],this._particleId)}}class u extends l{async _notify(e,t,r){switch(Object(s.assert)(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":try{await t.onHandleSync(this,this._restore(r))}catch(e){this.raiseSystemException(e,`${t.spec.name}::onHandleSync`)}return;case"update":try{await t.onHandleUpdate(this,{data:this._restore(r.data)})}catch(e){this.raiseSystemException(e,`${t.spec.name}::onHandleUpdate`)}return;case"desync":try{await t.onHandleDesync(this)}catch(e){this.raiseSystemException(e,`${t.spec.name}::onHandleDesync`)}return;default:throw new Error("unsupported")}}async get(){if(!this.canRead)throw new Error("Handle not readable");const e=await this._proxy.get();return this._restore(e)}_restore(e){return null===e?null:this.type instanceof o.EntityType?c(e,this.entityClass):this.type instanceof o.InterfaceType?a.ParticleSpec.fromLiteral(e):this.type instanceof o.ReferenceType?new n.Reference(e,this.type,this._proxy.pec):void Object(s.assert)(!1,`Don't know how to deliver handle data of type ${this.type}`)}async set(e){try{if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.set(this._serialize(e),this._particleId)}catch(e){throw this.raiseSystemException(e,"Handle::set"),e}}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.clear(this._particleId)}}class d{constructor(e,t){this._parent=e,this._cursorId=t}async next(){const e=await this._parent._proxy.cursorNext(this._cursorId);return e.done||(e.value=e.value.map(e=>c(e,this._parent.entityClass))),e}close(){this._parent._proxy.cursorClose(this._cursorId)}}class p extends l{configure(e){throw new Error("BigCollections do not support sync/update configuration")}async _notify(e,t,r){Object(s.assert)(this.canRead,"_notify should not be called for non-readable handles"),Object(s.assert)("sync"===e,"BigCollection._notify only supports sync events"),await t.onHandleSync(this,[])}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),r=[this._proxy.generateID()+"key"];return this._proxy.store(t,r,this._particleId)}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);this._proxy.remove(t.id,this._particleId)}async stream({pageSize:e,forward:t=!0}){if(!this.canRead)throw new Error("Handle not readable");if(isNaN(e)||e<1)throw new Error("Streamed reads require a positive pageSize");const r=await this._proxy.stream(e,t);return new d(this,r)}}function f(e,t=null,r=0,n=!0,i=!0){let s;s=e.type instanceof o.CollectionType?new h(e,t,r,n,i):e.type instanceof o.BigCollectionType?new p(e,t,r,n,i):new u(e,t,r,n,i);const a=e.type.getContainedType()||e.type;return a instanceof o.EntityType&&(s.entityClass=a.entitySchema.entityClass(e.pec)),s}},function(e,t,r){"use strict";r.r(t),r.d(t,"Reference",function(){return o});var n,i=r(5),s=r(6),a=r(3);!function(e){e[e.Unstored=0]="Unstored",e[e.Stored=1]="Stored"}(n||(n={}));class o{constructor(e,t,r){this.entity=null,this.storageProxy=null,this.handle=null,this.id=e.id,this.storageKey=e.storageKey,this.context=r,this.type=t}async ensureStorageProxy(){null==this.storageProxy&&(this.storageProxy=await this.context.getStorageProxy(this.storageKey,this.type.referredType),this.handle=Object(a.handleFor)(this.storageProxy),this.storageKey?Object(i.assert)(this.storageKey===this.storageProxy.storageKey):this.storageKey=this.storageProxy.storageKey)}async dereference(){return Object(i.assert)(this.context,"Must have context to dereference"),this.entity?this.entity:(await this.ensureStorageProxy(),this.entity=await this.handle.get(this.id),this.entity)}dataClone(){return{storageKey:this.storageKey,id:this.id}}static newClientReference(e){return class extends o{constructor(t){super({id:t.id,storageKey:null},new s.ReferenceType(t.constructor.type),e),this.mode=n.Unstored,this.entity=t,this.stored=new Promise(async(e,r)=>{await this.storeReference(t),e()})}async storeReference(e){await this.ensureStorageProxy(),await this.handle.store(e),this.mode=n.Stored}async dereference(){return this.mode===n.Unstored?null:super.dereference()}isIdentified(){return this.entity.isIdentified()}}}}},function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error(t)}r.r(t),r.d(t,"assert",function(){return n})},function(e,t,r){"use strict";r.r(t),r.d(t,"Type",function(){return c}),r.d(t,"EntityType",function(){return l}),r.d(t,"VariableType",function(){return h}),r.d(t,"CollectionType",function(){return u}),r.d(t,"BigCollectionType",function(){return d}),r.d(t,"RelationType",function(){return p}),r.d(t,"InterfaceType",function(){return f}),r.d(t,"SlotType",function(){return g}),r.d(t,"ReferenceType",function(){return m}),r.d(t,"ArcInfoType",function(){return y}),r.d(t,"HandleInfoType",function(){return b});var n=r(7),i=r(9),s=r(12),a=r(8),o=r(13);
// @license
class c{constructor(e,t){this.tag=e,this.data=t}static newEntity(e){return new l(e)}static newVariable(e){return new h(e)}static newCollection(e){return new u(e)}static newBigCollection(e){return new d(e)}static newRelation(e){return new p(e)}static newInterface(e){return new f(e)}static newSlot(e){return new g(e)}static newReference(e){return new m(e)}static newArcInfo(){return new y}static newHandleInfo(){return new b}static fromLiteral(e){switch(e.tag){case"Entity":return new l(n.Schema.fromLiteral(e.data));case"Variable":return new h(i.TypeVariable.fromLiteral(e.data));case"Collection":return new u(c.fromLiteral(e.data));case"BigCollection":return new d(c.fromLiteral(e.data));case"Relation":return new p(e.data);case"Interface":return new f(s.Shape.fromLiteral(e.data));case"Slot":return new g(e.data);case"Reference":return new m(c.fromLiteral(e.data));case"ArcInfo":return new y;case"HandleInfo":return new b;default:throw new Error(`fromLiteral: unknown type ${e}`)}}static unwrapPair(e,t){if(e.tag===t.tag){const r=e.getContainedType();if(null!==r)return c.unwrapPair(r,t.getContainedType())}return[e,t]}static canMergeConstraints(e,t){return c._canMergeCanReadSubset(e,t)&&c._canMergeCanWriteSuperset(e,t)}static _canMergeCanReadSubset(e,t){if(e.canReadSubset&&t.canReadSubset){if(e.canReadSubset.tag!==t.canReadSubset.tag)return!1;if(e.canReadSubset instanceof l)return null!==n.Schema.intersect(e.canReadSubset.entitySchema,t.canReadSubset.entitySchema);throw new Error(`_canMergeCanReadSubset not implemented for types tagged with ${e.canReadSubset.tag}`)}return!0}static _canMergeCanWriteSuperset(e,t){if(e.canWriteSuperset&&t.canWriteSuperset){if(e.canWriteSuperset.tag!==t.canWriteSuperset.tag)return!1;if(e.canWriteSuperset instanceof l)return null!==n.Schema.union(e.canWriteSuperset.entitySchema,t.canWriteSuperset.entitySchema)}return!0}equals(e){return a.TypeChecker.compareTypes({type:this},{type:e})}isResolved(){return!this.hasUnresolvedVariable}mergeTypeVariablesByName(e){return this}_applyExistenceTypeTest(e){return e(this)}get hasVariable(){return this._applyExistenceTypeTest(e=>e instanceof h)}get hasUnresolvedVariable(){return this._applyExistenceTypeTest(e=>e instanceof h&&!e.variable.isResolved())}primitiveType(){return null}getContainedType(){return null}isTypeContainer(){return!1}collectionOf(){return new u(this)}bigCollectionOf(){return new d(this)}resolvedType(){return this}canEnsureResolved(){return this.isResolved()||this._canEnsureResolved()}_canEnsureResolved(){return!0}maybeEnsureResolved(){return!0}get canWriteSuperset(){throw new Error(`canWriteSuperset not implemented for ${this}`)}get canReadSubset(){throw new Error(`canReadSubset not implemented for ${this}`)}isMoreSpecificThan(e){return this.tag===e.tag&&this._isMoreSpecificThan(e)}_isMoreSpecificThan(e){throw new Error(`isMoreSpecificThan not implemented for ${this}`)}clone(e){const t=this.resolvedType();if(t instanceof h){if(e.has(t.variable))return new h(e.get(t.variable));{const r=i.TypeVariable.fromLiteral(t.variable.toLiteral());return e.set(t.variable,r),new h(r)}}return t.data.clone?c.fromLiteral({tag:t.tag,data:t.data.clone(e)}):c.fromLiteral(t.toLiteral())}_cloneWithResolutions(e){return c.fromLiteral(this.toLiteral())}toLiteral(){return this}hasProperty(e){return e(this)||this._hasProperty(e)}_hasProperty(e){return!1}toString(e){return this.tag}getEntitySchema(){return null}toPrettyString(){return null}}class l extends c{get entitySchema(){return this.data}constructor(e){super("Entity",e)}get isEntity(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return this.entitySchema.isMoreSpecificThan(e.entitySchema)}toLiteral(){return{tag:this.tag,data:this.entitySchema.toLiteral()}}toString(e){return this.entitySchema.toInlineSchemaString(e)}getEntitySchema(){return this.entitySchema}toPrettyString(){return this.entitySchema.description.pattern?this.entitySchema.description.pattern:this.entitySchema.name?this.entitySchema.name.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim():JSON.stringify(this.entitySchema.toLiteral())}}class h extends c{get variable(){return this.data}constructor(e){super("Variable",e)}get isVariable(){return!0}mergeTypeVariablesByName(e){const t=this.variable.name;let r=e.get(t);if(r){if(r instanceof h&&(r.variable.hasConstraint||this.variable.hasConstraint)){if(!r.variable.maybeMergeConstraints(this.variable))throw new Error("could not merge type variables")}}else r=this,e.set(t,this);return r}resolvedType(){return this.variable.resolution||this}_canEnsureResolved(){return this.variable.canEnsureResolved()}maybeEnsureResolved(){return this.variable.maybeEnsureResolved()}get canWriteSuperset(){return this.variable.canWriteSuperset}get canReadSubset(){return this.variable.canReadSubset}_cloneWithResolutions(e){if(e.has(this.variable))return new h(e.get(this.variable));{const t=i.TypeVariable.fromLiteral(this.variable.toLiteralIgnoringResolutions());return this.variable.resolution&&(t.resolution=this.variable.resolution._cloneWithResolutions(e)),this.variable._canReadSubset&&(t.canReadSubset=this.variable.canReadSubset._cloneWithResolutions(e)),this.variable._canWriteSuperset&&(t.canWriteSuperset=this.variable.canWriteSuperset._cloneWithResolutions(e)),e.set(this.variable,t),new h(t)}}toLiteral(){return this.variable.resolution?this.variable.resolution.toLiteral():{tag:this.tag,data:this.variable.toLiteral()}}toString(e){return`~${this.variable.name}`}getEntitySchema(){return this.variable.isResolved()?this.resolvedType().getEntitySchema():null}toPrettyString(){return this.variable.isResolved()?this.resolvedType().toPrettyString():`[~${this.variable.name}]`}}class u extends c{get collectionType(){return this.data}constructor(e){super("Collection",e)}get isCollection(){return!0}mergeTypeVariablesByName(e){const t=this.collectionType,r=t.mergeTypeVariablesByName(e);return r===t?this:r.collectionOf()}_applyExistenceTypeTest(e){return this.collectionType._applyExistenceTypeTest(e)}primitiveType(){return this.collectionType}getContainedType(){return this.collectionType}isTypeContainer(){return!0}resolvedType(){const e=this.collectionType,t=e.resolvedType();return e!==t?t.collectionOf():this}_canEnsureResolved(){return this.collectionType.canEnsureResolved()}maybeEnsureResolved(){return this.collectionType.maybeEnsureResolved()}_cloneWithResolutions(e){return new u(this.collectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.collectionType.toLiteral()}}_hasProperty(e){return this.collectionType.hasProperty(e)}toString(e){return`[${this.collectionType.toString(e)}]`}getEntitySchema(){return this.collectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`${this.collectionType.toPrettyString()} List`}}class d extends c{get bigCollectionType(){return this.data}constructor(e){super("BigCollection",e)}get isBigCollection(){return!0}mergeTypeVariablesByName(e){const t=this.bigCollectionType,r=t.mergeTypeVariablesByName(e);return r===t?this:r.bigCollectionOf()}_applyExistenceTypeTest(e){return this.bigCollectionType._applyExistenceTypeTest(e)}getContainedType(){return this.bigCollectionType}isTypeContainer(){return!0}resolvedType(){const e=this.bigCollectionType,t=e.resolvedType();return e!==t?t.bigCollectionOf():this}_canEnsureResolved(){return this.bigCollectionType.canEnsureResolved()}maybeEnsureResolved(){return this.bigCollectionType.maybeEnsureResolved()}_cloneWithResolutions(e){return new d(this.bigCollectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.bigCollectionType.toLiteral()}}_hasProperty(e){return this.bigCollectionType.hasProperty(e)}toString(e){return`BigCollection<${this.bigCollectionType.toString(e)}>`}getEntitySchema(){return this.bigCollectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`Collection of ${this.bigCollectionType.toPrettyString()}`}}class p extends c{get relationEntities(){return this.data}constructor(e){super("Relation",e)}get isRelation(){return!0}toPrettyString(){return JSON.stringify(this.relationEntities)}}class f extends c{get interfaceShape(){return this.data}constructor(e){super("Interface",e)}get isInterface(){return!0}mergeTypeVariablesByName(e){const t=this.interfaceShape.clone(new Map);return t.mergeTypeVariablesByName(e),new f(t)}_applyExistenceTypeTest(e){return this.interfaceShape._applyExistenceTypeTest(e)}resolvedType(){return new f(this.interfaceShape.resolvedType())}_canEnsureResolved(){return this.interfaceShape.canEnsureResolved()}maybeEnsureResolved(){return this.interfaceShape.maybeEnsureResolved()}get canWriteSuperset(){return new f(this.interfaceShape.canWriteSuperset)}get canReadSubset(){return new f(this.interfaceShape.canReadSubset)}_isMoreSpecificThan(e){return this.interfaceShape.isMoreSpecificThan(e.interfaceShape)}_cloneWithResolutions(e){return new f(this.interfaceShape._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.interfaceShape.toLiteral()}}toString(e){return this.interfaceShape.name}toPrettyString(){return this.interfaceShape.toPrettyString()}}class g extends c{get slot(){return this.data}constructor(e){super("Slot",e)}get isSlot(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return!0}toString(e){const t=[];for(const e of Object.keys(this.slot))void 0!==this.slot[e]&&t.push(`${e}:${this.slot[e]}`);let r="";return 0!==t.length&&(r=` {${t.join(", ")}}`),`Slot${r}`}toPrettyString(){const e=[];for(const t of Object.keys(this.slot))void 0!==this.slot[t]&&e.push(`${t}:${this.slot[t]}`);let t="";return 0!==e.length&&(t=` {${e.join(", ")}}`),`Slot${t}`}}class m extends c{get referredType(){return this.data}constructor(e){super("Reference",e)}get isReference(){return!0}getContainedType(){return this.referredType}isTypeContainer(){return!0}resolvedType(){const e=this.referredType,t=e.resolvedType();return e!==t?new m(t):this}_canEnsureResolved(){return this.referredType.canEnsureResolved()}maybeEnsureResolved(){return this.referredType.maybeEnsureResolved()}get canReadSubset(){return this.referredType.canReadSubset}_cloneWithResolutions(e){return new m(this.referredType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.referredType.toLiteral()}}toString(e){return"Reference<"+this.referredType.toString()+">"}}class y extends c{constructor(){super("ArcInfo",null)}get isArcInfo(){return!0}newInstance(e,t){return new o.ArcInfo(e,t)}}class b extends c{constructor(){super("HandleInfo",null)}get isHandleInfo(){return!0}}},function(e,t,r){"use strict";r.r(t),r.d(t,"Schema",function(){return c});var n=r(5),i=r(6),s=r(8),a=r(10),o=r(4);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(e){Object(n.assert)(e.fields),this._model=e,this.description={},e.description&&e.description.description.forEach(e=>this.description[e.name]=e.pattern||e.patterns[0])}toLiteral(){const e={},t=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:t.model.toLiteral()}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:t(e.schema)}:e};for(const r of Object.keys(this._model.fields))e[r]=t(this._model.fields[r]);return{names:this._model.names,fields:e,description:this.description}}static fromLiteral(e={fields:{},names:[],description:{}}){const t={},r=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:i.Type.fromLiteral(t.model)}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:r(e.schema)}:e};for(const n of Object.keys(e.fields))t[n]=r(e.fields[n]);const n=new c({names:e.names,fields:t});return n.description=e.description||{},n}get fields(){return this._model.fields}get names(){return this._model.names}get name(){return this.names[0]}static typesEqual(e,t){return c._typeString(e)===c._typeString(t)}static _typeString(e){if("object"!=typeof e)return Object(n.assert)("string"==typeof e),e;switch(e.kind){case"schema-union":return`(${e.types.join(" or ")})`;case"schema-tuple":return`(${e.types.join(", ")})`;case"schema-reference":return`Reference<${c._typeString(e.schema)}>`;case"type-name":case"schema-inline":return e.model.entitySchema.toInlineSchemaString();case"schema-collection":return`[${c._typeString(e.schema)}]`;default:throw new Error(`Unknown type kind ${e.kind} in schema ${this.name}`)}}static union(e,t){const r=[...new Set([...e.names,...t.names])],n={};for(const[r,i]of[...Object.entries(e.fields),...Object.entries(t.fields)])if(n[r]){if(!c.typesEqual(n[r],i))return null}else n[r]=i;return new c({names:r,fields:n})}static intersect(e,t){const r=[...e.names].filter(e=>t.names.includes(e)),n={};for(const[r,i]of Object.entries(e.fields)){const e=t.fields[r];e&&c.typesEqual(i,e)&&(n[r]=i)}return new c({names:r,fields:n})}equals(e){return this===e||this.name===e.name&&this.isMoreSpecificThan(e)&&e.isMoreSpecificThan(this)}isMoreSpecificThan(e){const t=new Set(this.names);for(const r of e.names)if(!t.has(r))return!1;const r={};for(const[e,t]of Object.entries(this.fields))r[e]=t;for(const[t,n]of Object.entries(e.fields)){if(void 0==r[t])return!1;if(!c.typesEqual(r[t],n))return!1}return!0}get type(){return i.Type.newEntity(this)}entityClass(e=null){const t=this,r=this.name,c=["toJSON","prototype","toString","inspect"],l=e=>{switch(e){case"Text":case"URL":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Object":return"object";default:throw new Error(`Unknown field type ${e} in schema ${r}`)}},h=this.fields,u=(e,t,r)=>d(e,t,h[t],r),d=(e,t,n,a)=>{if(void 0===n)throw new Error(`Can't ${e} field ${t}; not in schema ${r}`);if(void 0!==a&&null!==a)if("object"==typeof n)switch(n.kind){case"schema-union":for(const e of n.types)if(typeof a===l(e))return;throw new TypeError(`Type mismatch ${e}ting field ${t} (union [${n.types}]); `+`value '${a}' is type ${typeof a}`);case"schema-tuple":if(!Array.isArray(a))throw new TypeError(`Cannot ${e} tuple ${t} with non-array value '${a}'`);if(a.length!==n.types.length)throw new TypeError(`Length mismatch ${e}ting tuple ${t} `+`[${n.types}] with value '${a}'`);n.types.map((r,i)=>{if(void 0!==a[i]&&null!==a[i]&&typeof a[i]!==l(r))throw new TypeError(`Type mismatch ${e}ting field ${t} (tuple [${n.types}]); `+`value '${a}' has type ${typeof a[i]} at index ${i}`)});break;case"schema-reference":if(!(a instanceof o.Reference))throw new TypeError(`Cannot ${e} reference ${t} with non-reference '${a}'`);if(!s.TypeChecker.compareTypes({type:a.type},{type:i.Type.newReference(n.schema.model)}))throw new TypeError(`Cannot ${e} reference ${t} with value '${a}' of mismatched type`);break;case"schema-collection":if("Set"!==a.constructor.name)throw new TypeError(`Cannot ${e} collection ${t} with non-Set '${a}'`);for(const r of a)d(e,t,n.schema,r);break;default:throw new Error(`Unknown kind ${n.kind} in schema ${r}`)}else if(typeof a!==l(n))throw new TypeError(`Type mismatch ${e}ting field ${t} (type ${n}); `+`value '${a}' is type ${typeof a}`)},p=class extends a.Entity{constructor(e,t){super(t),this.rawData=new Proxy({},{get:(e,t)=>{if(c.includes(t)||t.constructor===Symbol)return;const r=e[t];return u("get",t,r),r},set:(e,t,r)=>(u("set",t,r),e[t]=r,!0)}),Object(n.assert)(e,"can't construct entity with null data");const r=this.sanitizeData(e);for(const[e,t]of Object.entries(r))this.rawData[e]=t}sanitizeData(e){const t={};for(const[r,n]of Object.entries(e))t[r]=this.sanitizeEntry(h[r],n,r);return t}sanitizeEntry(t,r,n){if(!t)return r;if("schema-reference"===t.kind&&r){if(r instanceof o.Reference)return r;if(r.id&&r.storageKey)return new o.Reference(r,i.Type.newReference(t.schema.model),e);throw new TypeError(`Cannot set reference ${n} with non-reference '${r}'`)}if("schema-collection"===t.kind&&r){if("Set"===r.constructor.name)return r;if(r.length&&r instanceof Object)return new Set(r.map(e=>this.sanitizeEntry(t.schema,e,n)));throw new TypeError(`Cannot set collection ${n} with non-collection '${r}'`)}return r}dataClone(){const e={};for(const r of Object.keys(t.fields))void 0!==this.rawData[r]&&(h[r]&&"schema-reference"===h[r].kind?e[r]=this.rawData[r].dataClone():h[r]&&"schema-collection"===h[r].kind?e[r]=[...this.rawData[r]].map(e=>e.dataClone()):e[r]=this.rawData[r]);return e}static get type(){return i.Type.newEntity(this.key.schema)}static get key(){return{tag:"entity",schema:t}}};Object.defineProperty(p,"type",{value:this.type}),Object.defineProperty(p,"name",{value:this.name});for(const e of Object.keys(this.fields))Object.defineProperty(p.prototype,e,{get(){return this.rawData[e]},set(t){this.rawData[e]=t}});return p}toInlineSchemaString(e){const t=this.names.join(" ")||"*",r=Object.entries(this.fields).map(([e,t])=>`${c._typeString(t)} ${e}`).join(", ");return`${t} {${r.length>0&&e&&e.hideFields?"...":r}}`}toManifestString(){const e=[];if(e.push(`schema ${this.names.join(" ")}`),e.push(...Object.entries(this.fields).map(([e,t])=>`  ${c._typeString(t)} ${e}`)),Object.keys(this.description).length>0){e.push(`  description \`${this.description.pattern}\``);for(const t of Object.keys(this.description))"pattern"!==t&&e.push(`    ${t} \`${this.description[t]}\``)}return e.join("\n")}}},function(e,t,r){"use strict";r.r(t),r.d(t,"TypeChecker",function(){return s});var n=r(6),i=r(9);class s{static processTypeList(e,t){const r=new i.TypeVariable("",null,null);e&&(r.resolution=e),e=n.Type.newVariable(r);const a=[];for(const r of t)if(r.type.resolvedType().hasVariable){if(null==(e=s._tryMergeTypeVariable(e,r.type)))return null}else a.push(r);for(const t of a)if(!s._tryMergeConstraints(e,t))return null;const o=e=>e instanceof n.VariableType?null==e.canReadSubset||null==e.canWriteSuperset?e:e.canReadSubset.isMoreSpecificThan(e.canWriteSuperset)?(e.canWriteSuperset.isMoreSpecificThan(e.canReadSubset)&&(e.variable.resolution=e.canReadSubset),e):null:e,c=e.resolvedType();if(c instanceof n.CollectionType){const e=o(c.collectionType);return null!==e?e.collectionOf():null}if(c instanceof n.BigCollectionType){const e=o(c.bigCollectionType);return null!==e?e.bigCollectionOf():null}return o(c)}static _tryMergeTypeVariable(e,t){const[r,i]=n.Type.unwrapPair(e.resolvedType(),t.resolvedType());if(r instanceof n.VariableType){if(i instanceof n.VariableType){if(!1===r.variable.maybeMergeConstraints(i.variable))return null;i.variable.resolution=r}else r.variable.resolution=i;return e}if(i instanceof n.VariableType)return i.variable.resolution=r,t;if(r instanceof n.InterfaceType&&i instanceof n.InterfaceType){const e=r.interfaceShape.tryMergeTypeVariablesWith(i.interfaceShape);return null==e?null:n.Type.newInterface(e)}if(r.isTypeContainer()&&r.hasVariable||i.isTypeContainer()&&i.hasVariable)return null;throw new Error("tryMergeTypeVariable shouldn't be called on two types without any type variables")}static _tryMergeConstraints(e,{type:t,direction:r}){let[a,o]=n.Type.unwrapPair(e.resolvedType(),t.resolvedType());if(a instanceof n.VariableType){for(;o.isTypeContainer();){if(null!=a.variable.resolution||null!=a.variable.canReadSubset||null!=a.variable.canWriteSuperset)return!1;const e=n.Type.newVariable(new i.TypeVariable("a",null,null));o instanceof n.CollectionType?a.variable.resolution=n.Type.newCollection(e):o instanceof n.BigCollectionType?a.variable.resolution=n.Type.newBigCollection(e):a.variable.resolution=n.Type.newReference(e);const t=n.Type.unwrapPair(a.resolvedType(),o);[a,o]=t}if(("out"===r||"inout"===r||"`provide"===r)&&!a.variable.maybeMergeCanReadSubset(o.canWriteSuperset))return!1;if(("in"===r||"inout"===r||"`consume"===r)&&!a.variable.maybeMergeCanWriteSuperset(o.canReadSubset))return!1}else{if(o.tag!==a.tag)return!1;if(("out"===r||"inout"===r)&&!s._writeConstraintsApply(a,o))return!1;if(("in"===r||"inout"===r)&&!s._readConstraintsApply(a,o))return!1}return!0}static _writeConstraintsApply(e,t){const r=t.canWriteSuperset;return null==r||null==e.canReadSubset||!!r.isMoreSpecificThan(e.canReadSubset)}static _readConstraintsApply(e,t){const r=t.canReadSubset;return null==r||null==e.canWriteSuperset||!!e.canWriteSuperset.isMoreSpecificThan(r)}static compareTypes(e,t){const r=e.type.resolvedType(),i=t.type.resolvedType(),[s,a]=n.Type.unwrapPair(r,i);if(s instanceof n.VariableType&&a.isTypeContainer())return!(s.variable.canReadSubset||s.variable.canWriteSuperset);if(a instanceof n.VariableType&&s.isTypeContainer())return!(a.variable.canReadSubset||a.variable.canWriteSuperset);if(s instanceof n.VariableType||a instanceof n.VariableType)return n.Type.canMergeConstraints(s,a);if(void 0===s!=(void 0===a))return!1;if(s===a)return!0;if(s.tag!==a.tag)return!1;if(s instanceof n.SlotType)return!0;if(s instanceof n.InterfaceType&&a instanceof n.InterfaceType&&s.interfaceShape.equals(a.interfaceShape))return!0;if(!(s instanceof n.EntityType&&a instanceof n.EntityType))return!1;const o=s.entitySchema.isMoreSpecificThan(a.entitySchema),c=a.entitySchema.isMoreSpecificThan(s.entitySchema);if(c&&o)return!0;if(!c&&!o)return!1;const[l,h]=c?[e,t]:[t,e],u=l.direction||(l.connection?l.connection.direction:"inout"),d=h.direction||(h.connection?h.connection.direction:"inout");return"in"===u||"out"===d}}},function(e,t,r){"use strict";r.r(t),r.d(t,"TypeVariable",function(){return a});var n=r(6),i=r(5),s=r(7);
// @license
class a{constructor(e,t,r){this.name=e,this._canWriteSuperset=t,this._canReadSubset=r,this._resolution=null}maybeMergeConstraints(e){return!!this.maybeMergeCanReadSubset(e.canReadSubset)&&this.maybeMergeCanWriteSuperset(e.canWriteSuperset)}maybeMergeCanReadSubset(e){if(null==e)return!0;if(null==this.canReadSubset)return this.canReadSubset=e,!0;if(this.canReadSubset instanceof n.SlotType&&e instanceof n.SlotType)return!0;const t=s.Schema.intersect(this.canReadSubset.entitySchema,e.entitySchema);return!!t&&(this.canReadSubset=n.Type.newEntity(t),!0)}maybeMergeCanWriteSuperset(e){if(null==e)return!0;if(null==this.canWriteSuperset)return this.canWriteSuperset=e,!0;if(this.canWriteSuperset instanceof n.SlotType&&e instanceof n.SlotType)return!0;const t=s.Schema.union(this.canWriteSuperset.entitySchema,e.entitySchema);return!!t&&(this.canWriteSuperset=n.Type.newEntity(t),!0)}isSatisfiedBy(e){const t=this._canWriteSuperset;if(!t)return!0;if(!(t instanceof n.EntityType&&e instanceof n.EntityType))throw new Error(`constraint checking not implemented for ${this} and ${e}`);return e.getEntitySchema().isMoreSpecificThan(t.getEntitySchema())}get resolution(){return this._resolution?this._resolution.resolvedType():null}set resolution(e){Object(i.assert)(!this._resolution);const t=e.resolvedType().getContainedType();t instanceof n.VariableType&&Object(i.assert)(t.variable!==this,"variable cannot resolve to collection of itself");let r=e;for(;r&&r instanceof n.VariableType;){if(r.variable===this)return;r=r.variable.resolution}this._resolution=e,this._canWriteSuperset=null,this._canReadSubset=null}get canWriteSuperset(){return this._resolution?(Object(i.assert)(!this._canWriteSuperset),this._resolution instanceof n.VariableType?this._resolution.variable.canWriteSuperset:null):this._canWriteSuperset}set canWriteSuperset(e){Object(i.assert)(!this._resolution),this._canWriteSuperset=e}get canReadSubset(){return this._resolution?(Object(i.assert)(!this._canReadSubset),this._resolution instanceof n.VariableType?this._resolution.variable.canReadSubset:null):this._canReadSubset}set canReadSubset(e){Object(i.assert)(!this._resolution),this._canReadSubset=e}get hasConstraint(){return null!==this._canReadSubset||null!==this._canWriteSuperset}canEnsureResolved(){return this._resolution?this._resolution.canEnsureResolved():!(!this._canWriteSuperset&&!this._canReadSubset)}maybeEnsureResolved(){return this._resolution?this._resolution.maybeEnsureResolved():this._canWriteSuperset?(this.resolution=this._canWriteSuperset,!0):!!this._canReadSubset&&(this.resolution=this._canReadSubset,!0)}toLiteral(){return Object(i.assert)(null==this.resolution),this.toLiteralIgnoringResolutions()}toLiteralIgnoringResolutions(){return{name:this.name,canWriteSuperset:this._canWriteSuperset&&this._canWriteSuperset.toLiteral(),canReadSubset:this._canReadSubset&&this._canReadSubset.toLiteral()}}static fromLiteral(e){return new a(e.name,e.canWriteSuperset?n.Type.fromLiteral(e.canWriteSuperset):null,e.canReadSubset?n.Type.fromLiteral(e.canReadSubset):null)}isResolved(){return this._resolution&&this._resolution.isResolved()}}},function(e,t,r){"use strict";r.r(t),r.d(t,"Entity",function(){return s});var n=r(5),i=r(11);
// @license
class s{constructor(e){Object(n.assert)(!e||-1===e.indexOf(":"),"user IDs must not contain the ':' character"),this[i.Symbols.identifier]=void 0,this.userIDComponent=e}get data(){}getUserID(){return this.userIDComponent}isIdentified(){return void 0!==this[i.Symbols.identifier]}get id(){return Object(n.assert)(!!this.isIdentified()),this[i.Symbols.identifier]}identify(e){Object(n.assert)(!this.isIdentified()),this[i.Symbols.identifier]=e;const t=e.split(":");"uid"===t[t.length-2]&&(this.userIDComponent=t[t.length-1])}createIdentity(e){let t;Object(n.assert)(!this.isIdentified()),t=this.userIDComponent?`${e.base}:uid:${this.userIDComponent}`:`${e.base}:${e.component()}`,this[i.Symbols.identifier]=t}toLiteral(){return this.rawData}}},function(e,t,r){"use strict";r.r(t),r.d(t,"Symbols",function(){return n});
// @license
const n={identifier:Symbol("id")}},function(e,t,r){"use strict";r.r(t),r.d(t,"Shape",function(){return h});var n=r(5),i=r(6),s=r(8);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function a(e){return e&&"object"==typeof e?i.Type.fromLiteral(e):e}function o(e){return e&&e.toLiteral?e.toLiteral():e}const c=["type","name","direction"],l=["name","direction","isRequired","isSet"];class h{constructor(e,t,r){Object(n.assert)(e),Object(n.assert)(void 0!==t),Object(n.assert)(void 0!==r),this.name=e,this.handles=t,this.slots=r,this.typeVars=[];for(const e of t)for(const t of c)h.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t});for(const e of r)for(const t of l)h.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t})}toPrettyString(){return"SHAAAAPE"}mergeTypeVariablesByName(e){this.typeVars.map(({object:t,field:r})=>t[r]=t[r].mergeTypeVariablesByName(e))}get canReadSubset(){return this._cloneAndUpdate(e=>e.canReadSubset)}get canWriteSuperset(){return this._cloneAndUpdate(e=>e.canWriteSuperset)}isMoreSpecificThan(e){if(this.handles.length!==e.handles.length||this.slots.length!==e.slots.length)return!1;for(let t=0;t<this.typeVars.length;t++){const r=this.typeVars[t],n=e.typeVars[t];if(!r.object[r.field].isMoreSpecificThan(n.object[n.field]))return!1}return!0}_applyExistenceTypeTest(e){for(const t of this.typeVars)if(e(t.object[t.field]))return!0;return!1}_handlesToManifestString(){return this.handles.map(e=>{const t=e.type.resolvedType();return`  ${e.direction?e.direction+" ":""}${t.toString()} ${e.name?e.name:"*"}`}).join("\n")}_slotsToManifestString(){return this.slots.map(e=>`  ${e.direction} ${e.isSet?"set of ":""}${e.name?e.name+" ":""}`).join("\n")}toString(){return`shape ${this.name}\n${this._handlesToManifestString()}\n${this._slotsToManifestString()}\n`}static fromLiteral(e){const t=e.handles.map(e=>({type:a(e.type),name:a(e.name),direction:a(e.direction)})),r=e.slots.map(e=>({name:a(e.name),direction:a(e.direction),isRequired:a(e.isRequired),isSet:a(e.isSet)}));return new h(e.name,t,r)}toLiteral(){const e=this.handles.map(e=>({type:o(e.type),name:o(e.name),direction:o(e.direction)})),t=this.slots.map(e=>({name:o(e.name),direction:o(e.direction),isRequired:o(e.isRequired),isSet:o(e.isSet)}));return{name:this.name,handles:e,slots:t}}clone(e){const t=this.handles.map(({name:t,direction:r,type:n})=>({name:t,direction:r,type:n?n.clone(e):void 0})),r=this.slots.map(({name:e,direction:t,isRequired:r,isSet:n})=>({name:e,direction:t,isRequired:r,isSet:n}));return new h(this.name,t,r)}cloneWithResolutions(e){return this._cloneWithResolutions(e)}_cloneWithResolutions(e){const t=this.handles.map(({name:t,direction:r,type:n})=>({name:t,direction:r,type:n?n._cloneWithResolutions(e):void 0})),r=this.slots.map(({name:e,direction:t,isRequired:r,isSet:n})=>({name:e,direction:t,isRequired:r,isSet:n}));return new h(this.name,t,r)}canEnsureResolved(){for(const e of this.typeVars)if(!e.object[e.field].canEnsureResolved())return!1;return!0}maybeEnsureResolved(){for(const e of this.typeVars){let t=e.object[e.field];if(!(t=t.clone(new Map)).maybeEnsureResolved())return!1}for(const e of this.typeVars)e.object[e.field].maybeEnsureResolved();return!0}tryMergeTypeVariablesWith(e){if(!this._equalItems(e.slots,this.slots,this._equalSlot))return null;if(e.handles.length!==this.handles.length)return null;const t=new Set(this.handles),r=new Set(e.handles),n=new Map;let i=t.size;for(;t.size>0;){const e=[...t.values()].map(e=>({handle:e,match:[...r.values()].filter(t=>this._equalHandle(e,t))}));for(const i of e){if(0===i.match.length)return null;1===i.match.length&&(n.set(i.handle,i.match[0]),r.delete(i.match[0]),t.delete(i.handle))}if(t.size===i)return null;i=t.size}const a=[];for(const e of this.handles){const t=n.get(e);let r;if(e.type.hasVariable||t.type.hasVariable){if(!(r=s.TypeChecker._tryMergeTypeVariable(e.type,t.type)))return null}else r=e.type||t.type;a.push({name:e.name||t.name,direction:e.direction||t.direction,type:r})}const o=this.slots.map(({name:e,direction:t,isRequired:r,isSet:n})=>({name:e,direction:t,isRequired:r,isSet:n}));return new h(this.name,a,o)}resolvedType(){return this._cloneAndUpdate(e=>e.resolvedType())}equals(e){return this.handles.length===e.handles.length&&(!!this._equalItems(e.handles,this.handles,this._equalHandle)&&!!this._equalItems(e.slots,this.slots,this._equalSlot))}_equalHandle(e,t){return e.name===t.name&&e.direction===t.direction&&e.type.equals(t.type)}_equalSlot(e,t){return e.name===t.name&&e.direction===t.direction&&e.isRequired===t.isRequired&&e.isSet===t.isSet}_equalItems(e,t,r){for(const n of e){let e=!1;for(const i of t)if(r(i,n)){e=!0;break}if(!e)return!1}return!0}_cloneAndUpdate(e){const t=this.clone(new Map);return t.typeVars.forEach(t=>h._updateTypeVar(t,e)),t}static _updateTypeVar(e,t){e.object[e.field]=t(e.object[e.field])}static isTypeVar(e){return e instanceof i.Type&&e.hasProperty(e=>e instanceof i.VariableType)}static mustMatch(e){return!(void 0==e||h.isTypeVar(e))}static handlesMatch(e,t){if(h.mustMatch(e.name)&&e.name!==t.name)return!1;if(h.mustMatch(e.direction)&&e.direction!==t.direction)return!1;if(void 0==e.type)return!0;const[r,n]=i.Type.unwrapPair(e.type,t.type);return r instanceof i.VariableType?[{var:r,value:n,direction:e.direction}]:r.equals(n)}static slotsMatch(e,t){return(!h.mustMatch(e.name)||e.name===t.name)&&((!h.mustMatch(e.direction)||e.direction===t.direction)&&((!h.mustMatch(e.isRequired)||e.isRequired===t.isRequired)&&(!h.mustMatch(e.isSet)||e.isSet===t.isSet)))}particleMatches(e){return!1!==this.cloneWithResolutions(new Map).restrictType(e)}restrictType(e){return this._restrictThis(e)}_restrictThis(e){const t=this.handles.map(t=>e.connections.map(e=>({match:e,result:h.handlesMatch(t,e)})).filter(e=>!1!==e.result)),r=[];e.slots.forEach(e=>{r.push({name:e.name,direction:"consume",isRequired:e.isRequired,isSet:e.isSet}),e.providedSlots.forEach(e=>{r.push({name:e.name,direction:"provide",isRequired:!1,isSet:e.isSet})})});let n=this.slots.map(e=>r.filter(t=>h.slotsMatch(e,t)));n=n.map(e=>e.map(e=>({match:e,result:!0})));function a(e,t){if(0===e.length)return[];const r=e.pop();for(const n of r){if(t.includes(n.match))continue;const r=t.slice();r.push(n.match);const i=a(e,r);if(!1!==i)return n.result.length?i.concat(n.result):i}return!1}const o=a(t,[]),c=a(n,[]);if(!1===o||!1===c)return!1;for(const e of o)if(e.var.variable.resolution){if(e.var.variable.resolution instanceof i.VariableType){if(!s.TypeChecker.processTypeList(e.var,[{type:e.value,direction:e.direction}]))return!1}else if(!e.var.variable.resolution.equals(e.value))return!1}else e.var.variable.resolution=e.value;return this}}},function(e,t,r){"use strict";r.r(t),r.d(t,"ArcInfo",function(){return n}),r.d(t,"ArcHandle",function(){return i});
// @license
class n{constructor(e,t){this.id=e.toString(),this.serialization=t.replace(/\bimport .*\n/g,"")}static extractSerialization(e){return e.serialization.replace(/\bimport .*\n/g,"")}}class i{constructor(e,t,r){this.storageKey=e,this.type=t,this.tags=r}}},function(e,t,r){"use strict";r.r(t),r.d(t,"ConnectionSpec",function(){return o}),r.d(t,"SlotSpec",function(){return c}),r.d(t,"ProvidedSlotSpec",function(){return l}),r.d(t,"ParticleSpec",function(){return h});var n=r(6),i=r(8),s=r(12),a=r(5);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o{constructor(e,t){this.parentConnection=null,this.rawData=e,this.direction=e.direction,this.name=e.name,this.type=e.type.mergeTypeVariablesByName(t),this.isOptional=e.isOptional,this.tags=e.tags||[],this.dependentConnections=[]}instantiateDependentConnections(e,t){for(const r of this.rawData.dependentConnections){const n=e.createConnection(r,t);n.parentConnection=this,this.dependentConnections.push(n)}}get isInput(){return"in"===this.direction||"inout"===this.direction||"host"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}isCompatibleType(e){return i.TypeChecker.compareTypes({type:e},{type:this.type,direction:this.direction})}}class c{constructor(e){this.name=e.name,this.isRequired=e.isRequired,this.isSet=e.isSet,this.tags=e.tags||[],this.formFactor=e.formFactor,this.providedSlots=[],e.providedSlots&&e.providedSlots.forEach(e=>{this.providedSlots.push(new l(e))})}getProvidedSlotSpec(e){return this.providedSlots.find(t=>t.name===e)}}class l{constructor(e){this.name=e.name,this.isRequired=e.isRequired||!1,this.isSet=e.isSet||!1,this.tags=e.tags||[],this.formFactor=e.formFactor,this.handles=e.handles||[]}}class h{constructor(e){this.model=e,this.name=e.name,this.verbs=e.verbs;const t=new Map;this.connections=[],e.args.forEach(e=>this.createConnection(e,t)),this.connectionMap=new Map,this.connections.forEach(e=>this.connectionMap.set(e.name,e)),this.inputs=this.connections.filter(e=>e.isInput),this.outputs=this.connections.filter(e=>e.isOutput),e.description=e.description||{},this.validateDescription(e.description),this.pattern=e.description.pattern,this.connections.forEach(t=>{t.pattern=e.description[t.name]}),this.implFile=e.implFile,this.modality=e.modality,this.slots=new Map,e.slots&&e.slots.forEach(e=>this.slots.set(e.name,new c(e))),this.slots.forEach(e=>{e.providedSlots.forEach(e=>{e.handles.forEach(e=>Object(a.assert)(this.connectionMap.has(e),"Cannot provide slot for nonexistent handle constraint ",e))})})}createConnection(e,t){const r=new o(e,t);return this.connections.push(r),r.instantiateDependentConnections(this,t),r}isInput(e){for(const t of this.inputs)if(t.name===e)return!0;return!1}isOutput(e){for(const t of this.outputs)if(t.name===e)return!0;return!1}getSlotSpec(e){return this.slots.get(e)}get primaryVerb(){return this.verbs.length>0?this.verbs[0]:void 0}matchModality(e){return this.slots.size<=0||this.modality.includes(e)}toLiteral(){const{args:e,name:t,verbs:r,description:n,implFile:i,modality:s,slots:a}=this.model,o=({type:e,direction:t,name:r,isOptional:n,dependentConnections:i})=>({type:e.toLiteral(),direction:t,name:r,isOptional:n,dependentConnections:i.map(o)});return{args:e.map(e=>o(e)),name:t,verbs:r,description:n,implFile:i,modality:s,slots:a}}static fromLiteral(e){let{args:t,name:r,verbs:i,description:s,implFile:a,modality:o,slots:c}=e;const l=({type:e,direction:t,name:r,isOptional:i,dependentConnections:s})=>({type:n.Type.fromLiteral(e),direction:t,name:r,isOptional:i,dependentConnections:s?s.map(l):[]});return t=t.map(l),new h({args:t,name:r,verbs:i||[],description:s,implFile:a,modality:o,slots:c})}clone(){return h.fromLiteral(this.toLiteral())}equals(e){return JSON.stringify(this.toLiteral())===JSON.stringify(e.toLiteral())}validateDescription(e){Object.keys(e||[]).forEach(e=>{Object(a.assert)(["kind","location","pattern"].includes(e)||this.connectionMap.has(e),`Unexpected description for ${e}`)})}toInterface(){return n.Type.newInterface(this._toShape())}_toShape(){const e=this.model.args;Object(a.assert)(!this.slots.size,"please implement slots toShape");return new s.Shape(this.name,e,[])}toString(){const e=[];let t="";this.verbs.length>0&&(t=" "+this.verbs.map(e=>`&${e}`).join(" ")),e.push(`particle ${this.name}${t} in '${this.implFile}'`.trim());const r=(t,n)=>{const i=t.tags.map(e=>` #${e}`).join("");e.push(`${n}${t.direction}${t.isOptional?"?":""} ${t.type.toString()} ${t.name}${i}`);for(const e of t.dependentConnections)r(e,n+"  ")};for(const e of this.connections)e.parentConnection||r(e,"  ");return this.modality.filter(e=>"mock"!==e).forEach(t=>e.push(`  modality ${t}`)),this.slots.forEach(t=>{const r=[];t.isRequired&&r.push("must"),r.push("consume"),t.isSet&&r.push("set of"),r.push(t.name),t.tags.length>0&&r.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`  ${r.join(" ")}`),t.formFactor&&e.push(`    formFactor ${t.formFactor}`),t.providedSlots.forEach(t=>{const r=[];t.isRequired&&r.push("must"),r.push("provide"),t.isSet&&r.push("set of"),r.push(t.name),t.tags.length>0&&r.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`    ${r.join(" ")}`),t.formFactor&&e.push(`      formFactor ${t.formFactor}`),t.handles.forEach(t=>e.push(`      handle ${t}`))})}),this.pattern&&(e.push(`  description \`${this.pattern}\``),this.connections.forEach(t=>{t.pattern&&e.push(`    ${t.name} \`${t.pattern}\``)})),e.join("\n")}toManifestString(){return this.toString()}}},function(e,t,r){"use strict";r.r(t),r.d(t,"APIPort",function(){return l}),r.d(t,"PECOuterPort",function(){return h}),r.d(t,"PECInnerPort",function(){return u});var n=r(5),i=r(14),s=r(6),a=r(16),o=r(26);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(e){this._prefix=e,this._nextIdentifier=0,this._idMap=new Map,this._reverseIdMap=new Map}_newIdentifier(){return this._prefix+this._nextIdentifier++}createMappingForThing(e,t){let r;return Object(n.assert)(!this._reverseIdMap.has(e)),r=t||(e.apiChannelMappingId?e.apiChannelMappingId:this._newIdentifier()),Object(n.assert)(!this._idMap.has(r),`${t?"requestedId":e.apiChannelMappingId?"apiChannelMappingId":"newIdentifier()"} ${r} already in use`),this.establishThingMapping(r,e),r}maybeCreateMappingForThing(e){return this.hasMappingForThing(e)?this.identifierForThing(e):this.createMappingForThing(e)}async establishThingMapping(e,t){let r;Array.isArray(t)&&([t,r]=t),this._idMap.set(e,t),t instanceof Promise?(Object(n.assert)(null==r),await this.establishThingMapping(e,await t)):(this._reverseIdMap.set(t,e),r&&await r())}hasMappingForThing(e){return this._reverseIdMap.has(e)}identifierForThing(e){return Object(n.assert)(this._reverseIdMap.has(e),`Missing thing [${e}]`),this._reverseIdMap.get(e)}thingForIdentifier(e){return Object(n.assert)(this._idMap.has(e),`Missing id: ${e}`),this._idMap.get(e)}}class l{constructor(e,t){this._port=e,this._mapper=new c(t),this._messageMap=new Map,this._port.onmessage=(async e=>this._processMessage(e)),this._debugAttachment=null,this._attachStack=!1,this.messageCount=0,this.Direct={convert:e=>e,unconvert:e=>e},this.LocalMapped={convert:e=>this._mapper.maybeCreateMappingForThing(e),unconvert:e=>this._mapper.thingForIdentifier(e)},this.Mapped={convert:e=>this._mapper.identifierForThing(e),unconvert:e=>this._mapper.thingForIdentifier(e)},this.Map=function(e,t){return{convert:r=>{const n={};return r.forEach((r,i)=>n[e.convert(i)]=t.convert(r)),n},unconvert:r=>{const n=new Map;for(const i in r)n.set(e.unconvert(i),t.unconvert(r[i]));return n}}},this.List=function(e){return{convert:t=>t.map(t=>e.convert(t)),unconvert:t=>t.map(t=>e.unconvert(t))}},this.ByLiteral=function(e){return{convert:e=>e.toLiteral(),unconvert:t=>e.fromLiteral(t)}},this._testingHook()}_testingHook(){}close(){this._port.close()}async _processMessage(e){Object(n.assert)(this._messageMap.has(e.data.messageType));const t=this.messageCount++,r=this._messageMap.get(e.data.messageType);let i;try{i=this._unprocessArguments(r.args,e.data.messageBody)}catch(t){throw console.error(`Exception during unmarshaling for ${e.data.messageType}`),t}for(const t of Object.values(i))if(t instanceof Promise)return void t.then(()=>this._processMessage(e));const s="on"+e.data.messageType;Object(n.assert)(this[s],`no handler named ${s}`),this._debugAttachment&&this._debugAttachment.handlePecMessage(s,e.data.messageBody,t,e.data.stack);const a=this[s](i);r.isInitializer&&(Object(n.assert)(i.identifier),await this._mapper.establishThingMapping(i.identifier,a))}_processArguments(e,t){const r={};for(const n in e)r[n]=e[n].convert(t[n]);return r}_unprocessArguments(e,t){const r={};for(const n in e)r[n]=e[n].unconvert(t[n]);return r}registerCall(e,t){this[e]=(r=>{const n={messageType:e,messageBody:this._processArguments(t,r)};this._attachStack&&(n.stack=(new Error).stack);const i=this.messageCount++;this._port.postMessage(n),this._debugAttachment&&this._debugAttachment.handlePecMessage(e,n.messageBody,i,(new Error).stack)})}registerHandler(e,t){this._messageMap.set(e,{args:t})}registerInitializerHandler(e,t){t.identifier=this.Direct,this._messageMap.set(e,{isInitializer:!0,args:t})}registerRedundantInitializer(e,t,r){this.registerInitializer(e,t,r,!0)}registerInitializer(e,t,r=null,n=!1){this[e]=((i,s)=>{if(n&&this._mapper.hasMappingForThing(i))return;const a={messageType:e,messageBody:this._processArguments(t,s)};this._attachStack&&(a.stack=(new Error).stack);const o=r&&s[r];a.messageBody.identifier=this._mapper.createMappingForThing(i,o);const c=this.messageCount++;this._port.postMessage(a),this._debugAttachment&&this._debugAttachment.handlePecMessage(e,a.messageBody,c,(new Error).stack)})}}class h extends l{constructor(e,t){super(e,"o"),this.registerCall("Stop",{}),this.registerRedundantInitializer("DefineHandle",{type:this.ByLiteral(s.Type),name:this.Direct}),this.registerInitializer("InstantiateParticle",{id:this.Direct,spec:this.ByLiteral(i.ParticleSpec),handles:this.Map(this.Direct,this.Mapped)},"id"),this.registerCall("UIEvent",{particle:this.Mapped,slotName:this.Direct,event:this.Direct}),this.registerCall("SimpleCallback",{callback:this.Direct,data:this.Direct}),this.registerCall("AwaitIdle",{version:this.Direct}),this.registerCall("StartRender",{particle:this.Mapped,slotName:this.Direct,providedSlots:this.Map(this.Direct,this.Direct),contentTypes:this.List(this.Direct)}),this.registerCall("StopRender",{particle:this.Mapped,slotName:this.Direct}),this.registerHandler("Render",{particle:this.Mapped,slotName:this.Direct,content:this.Direct}),this.registerHandler("InitializeProxy",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("SynchronizeProxy",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleGet",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleToList",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleSet",{handle:this.Mapped,data:this.Direct,particleId:this.Direct,barrier:this.Direct}),this.registerHandler("HandleClear",{handle:this.Mapped,particleId:this.Direct,barrier:this.Direct}),this.registerHandler("HandleStore",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleRemove",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleRemoveMultiple",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleStream",{handle:this.Mapped,callback:this.Direct,pageSize:this.Direct,forward:this.Direct}),this.registerHandler("StreamCursorNext",{handle:this.Mapped,callback:this.Direct,cursorId:this.Direct}),this.registerHandler("StreamCursorClose",{handle:this.Mapped,cursorId:this.Direct}),this.registerHandler("Idle",{version:this.Direct,relevance:this.Map(this.Mapped,this.Direct)}),this.registerHandler("GetBackingStore",{callback:this.Direct,storageKey:this.Direct,type:this.ByLiteral(s.Type)}),this.registerInitializer("GetBackingStoreCallback",{callback:this.Direct,type:this.ByLiteral(s.Type),name:this.Direct,id:this.Direct,storageKey:this.Direct}),this.registerHandler("ConstructInnerArc",{callback:this.Direct,particle:this.Mapped}),this.registerCall("ConstructArcCallback",{callback:this.Direct,arc:this.LocalMapped}),this.registerHandler("ArcCreateHandle",{callback:this.Direct,arc:this.LocalMapped,type:this.ByLiteral(s.Type),name:this.Direct}),this.registerInitializer("CreateHandleCallback",{callback:this.Direct,type:this.ByLiteral(s.Type),name:this.Direct,id:this.Direct}),this.registerHandler("ArcMapHandle",{callback:this.Direct,arc:this.LocalMapped,handle:this.Mapped}),this.registerInitializer("MapHandleCallback",{callback:this.Direct,id:this.Direct}),this.registerHandler("ArcCreateSlot",{callback:this.Direct,arc:this.LocalMapped,transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedParticleName:this.Direct,hostedSlotName:this.Direct,handleId:this.Direct}),this.registerInitializer("CreateSlotCallback",{callback:this.Direct,hostedSlotId:this.Direct}),this.registerCall("InnerArcRender",{transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedSlotId:this.Direct,content:this.Direct}),this.registerHandler("ArcLoadRecipe",{arc:this.LocalMapped,recipe:this.Direct,callback:this.Direct}),this.registerHandler("RaiseSystemException",{exception:this.Direct,methodName:this.Direct,particleId:this.Direct}),this.registerCall("DevToolsConnected",{}),o.DevtoolsConnection.onceConnected.then(e=>{this.DevToolsConnected(),this._debugAttachment=new a.OuterPortAttachment(t,e)})}}class u extends l{constructor(e){super(e,"i"),this.registerHandler("Stop",{}),this.registerInitializerHandler("DefineHandle",{type:this.ByLiteral(s.Type),name:this.Direct}),this.registerInitializerHandler("InstantiateParticle",{id:this.Direct,spec:this.ByLiteral(i.ParticleSpec),handles:this.Map(this.Direct,this.Mapped)}),this.registerHandler("UIEvent",{particle:this.Mapped,slotName:this.Direct,event:this.Direct}),this.registerHandler("SimpleCallback",{callback:this.LocalMapped,data:this.Direct}),this.registerHandler("AwaitIdle",{version:this.Direct}),this.registerHandler("StartRender",{particle:this.Mapped,slotName:this.Direct,providedSlots:this.Map(this.Direct,this.Direct),contentTypes:this.List(this.Direct)}),this.registerHandler("StopRender",{particle:this.Mapped,slotName:this.Direct}),this.registerCall("Render",{particle:this.Mapped,slotName:this.Direct,content:this.Direct}),this.registerCall("InitializeProxy",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("SynchronizeProxy",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleGet",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleToList",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleSet",{handle:this.Mapped,data:this.Direct,particleId:this.Direct,barrier:this.Direct}),this.registerCall("HandleClear",{handle:this.Mapped,particleId:this.Direct,barrier:this.Direct}),this.registerCall("HandleStore",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleRemove",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleRemoveMultiple",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleStream",{handle:this.Mapped,callback:this.LocalMapped,pageSize:this.Direct,forward:this.Direct}),this.registerCall("StreamCursorNext",{handle:this.Mapped,callback:this.LocalMapped,cursorId:this.Direct}),this.registerCall("StreamCursorClose",{handle:this.Mapped,cursorId:this.Direct}),this.registerCall("Idle",{version:this.Direct,relevance:this.Map(this.Mapped,this.Direct)}),this.registerCall("GetBackingStore",{callback:this.LocalMapped,storageKey:this.Direct,type:this.ByLiteral(s.Type)}),this.registerInitializerHandler("GetBackingStoreCallback",{callback:this.LocalMapped,type:this.ByLiteral(s.Type),name:this.Direct,id:this.Direct,storageKey:this.Direct}),this.registerCall("ConstructInnerArc",{callback:this.LocalMapped,particle:this.Mapped}),this.registerHandler("ConstructArcCallback",{callback:this.LocalMapped,arc:this.Direct}),this.registerCall("ArcCreateHandle",{callback:this.LocalMapped,arc:this.Direct,type:this.ByLiteral(s.Type),name:this.Direct}),this.registerInitializerHandler("CreateHandleCallback",{callback:this.LocalMapped,type:this.ByLiteral(s.Type),name:this.Direct,id:this.Direct}),this.registerCall("ArcMapHandle",{callback:this.LocalMapped,arc:this.Direct,handle:this.Mapped}),this.registerInitializerHandler("MapHandleCallback",{callback:this.LocalMapped,id:this.Direct}),this.registerCall("ArcCreateSlot",{callback:this.LocalMapped,arc:this.Direct,transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedParticleName:this.Direct,hostedSlotName:this.Direct,handleId:this.Direct}),this.registerInitializerHandler("CreateSlotCallback",{callback:this.LocalMapped,hostedSlotId:this.Direct}),this.registerHandler("InnerArcRender",{transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedSlotId:this.Direct,content:this.Direct}),this.registerCall("ArcLoadRecipe",{arc:this.Direct,recipe:this.Direct,callback:this.LocalMapped}),this.registerCall("RaiseSystemException",{exception:this.Direct,methodName:this.Direct,particleId:this.Direct}),this.registerHandler("DevToolsConnected",{}),this.onDevToolsConnected=(()=>this._attachStack=!0)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"OuterPortAttachment",function(){return i});var n=r(17);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{constructor(e,t){this._devtoolsChannel=t,this._arcIdString=e.id.toString(),this._speculative=e.isSpeculative}handlePecMessage(e,t,r,n){if(this._arcIdString.endsWith("-pipes")||this._speculative)return;const i=this._extractStackFrames(n);this._devtoolsChannel.send({messageType:"PecLog",messageBody:{name:e,pecMsgBody:t,pecMsgCount:r,timestamp:Date.now(),stack:i}})}_extractStackFrames(e){const t=[];if(!e)return t;if(e.includes("(file:///")){for(const r of e.split("\n    at ").slice(2)){let e=r.match(/^(.*) \((.*)\)$/);null===e&&(e={1:"<unknown>",2:r});let n=e[2].replace(/:[0-9]+$/,"");n.startsWith("file")&&(n=n.replace(/^.*\/arcs[^/]*\//,"")),t.push({method:e[1],location:n,target:null,targetClass:"noLink"})}return t}return Object(n.mapStackTrace)(e,e=>e.slice(1).map(e=>{let r=e.match(/^ {4}at (.*) \((.*)\)$/);null===r&&(r={1:"<unknown>",2:e.replace(/^ *at */,"")});const n={method:r[1]},i=r[2].replace(/:[0-9]+$/,"");i.startsWith("http")?(n.location=i.replace(/^.*\/arcs[^/]*\//,""),n.target=i,n.targetClass="link"):i.startsWith("webpack")?(n.location=i.slice(11),n.target=`webpack:///./${n.location}`,n.targetClass="link"):(n.location=i,n.target=null,n.targetClass="noLink"),t.push(n)}),{sync:!0,cacheGlobally:!0}),t}}},function(e,t,r){"use strict";r.r(t),r.d(t,"mapStackTrace",function(){return n});const n=r(18).mapStackTrace},function(e,t,r){var n,i;n=[r(19)],void 0===(i=function(e){var t={},r=function(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1},n=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},i=function(){return navigator.userAgent.toLowerCase().indexOf("safari")>-1},s=function(){return document.documentMode&&document.documentMode>=11},a=function(){this.count=0,this.pending=[]};a.prototype.incr=function(){this.count++},a.prototype.decr=function(){this.count--,this.flush()},a.prototype.whenReady=function(e){this.pending.push(e),this.flush()},a.prototype.flush=function(){0===this.count&&(this.pending.forEach(function(e){e()}),this.pending=[])};var o=function(e){this.sem=new a,this.sync=e&&e.sync,this.mapForUri=e&&e.cacheGlobally?t:{}};o.prototype.ajax=function(e,t){var r=function(){for(var e=!1,t=0;t<d.length;t++){try{e=d[t]()}catch(e){continue}break}return e}(),n=this;r.onreadystatechange=function(){4==r.readyState&&t.call(n,r,e)},r.open("GET",e,!this.sync),r.send()},o.prototype.fetchScript=function(e){e in this.mapForUri||(this.sem.incr(),this.mapForUri[e]=null,this.ajax(e,this.onScriptLoad))};var c=new RegExp("^(?:[a-z]+:)?//","i");o.prototype.onScriptLoad=function(t,r){if(200===t.status||"file://"===r.slice(0,7)&&0===t.status){var n=t.responseText.match("//# [s]ourceMappingURL=(.*)[\\s]*$","m");if(n&&2===n.length){var i=n[1],s=i.match("data:application/json;(charset=[^;]+;)?base64,(.*)");if(s&&s[2])this.mapForUri[r]=new e.SourceMapConsumer(atob(s[2])),this.sem.decr();else{if(!c.test(i)){var a,o=r.lastIndexOf("/");-1!==o&&(a=r.slice(0,o+1),i=a+i)}this.ajax(i,function(t){(200===t.status||"file://"===i.slice(0,7)&&0===t.status)&&(this.mapForUri[r]=new e.SourceMapConsumer(t.responseText)),this.sem.decr()})}}else this.sem.decr()}else this.sem.decr()};var l=function(e,t,r){for(var n,i=[],s=0;s<e.length;s++){var a=t[s];if(a){var o=a[1],c=parseInt(a[2],10),l=parseInt(a[3],10);if(n=r[o]){var d=n.originalPositionFor({line:c,column:l});i.push(u(d.source,d.line,d.column,d.name||h(e[s])))}else i.push(u(o,c,l,h(e[s])))}else i.push(e[s])}return i};function h(e){var t=String(e).match(r()||s()?/ +at +([^ ]*).*/:/([^@]*)@.*/);return t&&t[1]}var u=function(e,t,r,n){return"    at "+(n||"(unknown)")+" ("+e+":"+t+":"+r+")"},d=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return{mapStackTrace:function(e,t,a){var c,h,u,d,p,f,g,m={},y=new o(a);if(r()||s())f=/^ +at.+\((.*):([0-9]+):([0-9]+)/,p=4,g=1;else{if(!n()&&!i())throw new Error("unknown browser :(");f=/@(.*):([0-9]+):([0-9]+)/,p=4,g=0}c=e.split("\n").slice(g);for(var b=0;b<c.length;b++)h=c[b],a&&a.filter&&!a.filter(h)||(u=h.match(f))&&u.length===p&&(m[b]=u,(d=u[1]).match(/<anonymous>/)||y.fetchScript(d));y.sem.whenReady(function(){var e=l(c,m,y.mapForUri);t(e)})}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n=r(20),i=r(21),s=r(22).ArraySet,a=r(23),o=r(25).quickSort;function c(e){var t=e;return"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,""))),null!=t.sections?new u(t):new l(t)}function l(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=n.getArg(t,"version"),i=n.getArg(t,"sources"),a=n.getArg(t,"names",[]),o=n.getArg(t,"sourceRoot",null),c=n.getArg(t,"sourcesContent",null),l=n.getArg(t,"mappings"),h=n.getArg(t,"file",null);if(r!=this._version)throw new Error("Unsupported version: "+r);i=i.map(String).map(n.normalize).map(function(e){return o&&n.isAbsolute(o)&&n.isAbsolute(e)?n.relative(o,e):e}),this._names=s.fromArray(a.map(String),!0),this._sources=s.fromArray(i,!0),this.sourceRoot=o,this.sourcesContent=c,this._mappings=l,this.file=h}function h(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function u(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=n.getArg(t,"version"),i=n.getArg(t,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);this._sources=new s,this._names=new s;var a={line:-1,column:0};this._sections=i.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=n.getArg(e,"offset"),r=n.getArg(t,"line"),i=n.getArg(t,"column");if(r<a.line||r===a.line&&i<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=t,{generatedOffset:{generatedLine:r+1,generatedColumn:i+1},consumer:new c(n.getArg(e,"map"))}})}c.fromSourceMap=function(e){return l.fromSourceMap(e)},c.prototype._version=3,c.prototype.__generatedMappings=null,Object.defineProperty(c.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),c.prototype.__originalMappings=null,Object.defineProperty(c.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),c.prototype._charIsMappingSeparator=function(e,t){var r=e.charAt(t);return";"===r||","===r},c.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},c.GENERATED_ORDER=1,c.ORIGINAL_ORDER=2,c.GREATEST_LOWER_BOUND=1,c.LEAST_UPPER_BOUND=2,c.prototype.eachMapping=function(e,t,r){var i,s=t||null;switch(r||c.GENERATED_ORDER){case c.GENERATED_ORDER:i=this._generatedMappings;break;case c.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;i.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return null!=t&&null!=a&&(t=n.join(a,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,s)},c.prototype.allGeneratedPositionsFor=function(e){var t=n.getArg(e,"line"),r={source:n.getArg(e,"source"),originalLine:t,originalColumn:n.getArg(e,"column",0)};if(null!=this.sourceRoot&&(r.source=n.relative(this.sourceRoot,r.source)),!this._sources.has(r.source))return[];r.source=this._sources.indexOf(r.source);var s=[],a=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(a>=0){var o=this._originalMappings[a];if(void 0===e.column)for(var c=o.originalLine;o&&o.originalLine===c;)s.push({line:n.getArg(o,"generatedLine",null),column:n.getArg(o,"generatedColumn",null),lastColumn:n.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++a];else for(var l=o.originalColumn;o&&o.originalLine===t&&o.originalColumn==l;)s.push({line:n.getArg(o,"generatedLine",null),column:n.getArg(o,"generatedColumn",null),lastColumn:n.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++a]}return s},t.SourceMapConsumer=c,l.prototype=Object.create(c.prototype),l.prototype.consumer=c,l.fromSourceMap=function(e){var t=Object.create(l.prototype),r=t._names=s.fromArray(e._names.toArray(),!0),i=t._sources=s.fromArray(e._sources.toArray(),!0);t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file;for(var a=e._mappings.toArray().slice(),c=t.__generatedMappings=[],u=t.__originalMappings=[],d=0,p=a.length;d<p;d++){var f=a[d],g=new h;g.generatedLine=f.generatedLine,g.generatedColumn=f.generatedColumn,f.source&&(g.source=i.indexOf(f.source),g.originalLine=f.originalLine,g.originalColumn=f.originalColumn,f.name&&(g.name=r.indexOf(f.name)),u.push(g)),c.push(g)}return o(t.__originalMappings,n.compareByOriginalPositions),t},l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?n.join(this.sourceRoot,e):e},this)}}),l.prototype._parseMappings=function(e,t){for(var r,i,s,c,l,u=1,d=0,p=0,f=0,g=0,m=0,y=e.length,b=0,_={},S={},v=[],w=[];b<y;)if(";"===e.charAt(b))u++,b++,d=0;else if(","===e.charAt(b))b++;else{for((r=new h).generatedLine=u,c=b;c<y&&!this._charIsMappingSeparator(e,c);c++);if(s=_[i=e.slice(b,c)])b+=i.length;else{for(s=[];b<c;)a.decode(e,b,S),l=S.value,b=S.rest,s.push(l);if(2===s.length)throw new Error("Found a source, but no line and column");if(3===s.length)throw new Error("Found a source and line, but no column");_[i]=s}r.generatedColumn=d+s[0],d=r.generatedColumn,s.length>1&&(r.source=g+s[1],g+=s[1],r.originalLine=p+s[2],p=r.originalLine,r.originalLine+=1,r.originalColumn=f+s[3],f=r.originalColumn,s.length>4&&(r.name=m+s[4],m+=s[4])),w.push(r),"number"==typeof r.originalLine&&v.push(r)}o(w,n.compareByGeneratedPositionsDeflated),this.__generatedMappings=w,o(v,n.compareByOriginalPositions),this.__originalMappings=v},l.prototype._findMapping=function(e,t,r,n,s,a){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[n]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[n]);return i.search(e,t,s,a)},l.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},l.prototype.originalPositionFor=function(e){var t={generatedLine:n.getArg(e,"line"),generatedColumn:n.getArg(e,"column")},r=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",n.compareByGeneratedPositionsDeflated,n.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(r>=0){var i=this._generatedMappings[r];if(i.generatedLine===t.generatedLine){var s=n.getArg(i,"source",null);null!==s&&(s=this._sources.at(s),null!=this.sourceRoot&&(s=n.join(this.sourceRoot,s)));var a=n.getArg(i,"name",null);return null!==a&&(a=this._names.at(a)),{source:s,line:n.getArg(i,"originalLine",null),column:n.getArg(i,"originalColumn",null),name:a}}}return{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e}))},l.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=n.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var r;if(null!=this.sourceRoot&&(r=n.urlParse(this.sourceRoot))){var i=e.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(i))return this.sourcesContent[this._sources.indexOf(i)];if((!r.path||"/"==r.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(e){var t=n.getArg(e,"source");if(null!=this.sourceRoot&&(t=n.relative(this.sourceRoot,t)),!this._sources.has(t))return{line:null,column:null,lastColumn:null};var r={source:t=this._sources.indexOf(t),originalLine:n.getArg(e,"line"),originalColumn:n.getArg(e,"column")},i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,n.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(i>=0){var s=this._originalMappings[i];if(s.source===r.source)return{line:n.getArg(s,"generatedLine",null),column:n.getArg(s,"generatedColumn",null),lastColumn:n.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=l,u.prototype=Object.create(c.prototype),u.prototype.constructor=c,u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),u.prototype.originalPositionFor=function(e){var t={generatedLine:n.getArg(e,"line"),generatedColumn:n.getArg(e,"column")},r=i.search(t,this._sections,function(e,t){var r=e.generatedLine-t.generatedOffset.generatedLine;return r||e.generatedColumn-t.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:t.generatedLine-(s.generatedOffset.generatedLine-1),column:t.generatedColumn-(s.generatedOffset.generatedLine===t.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},u.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var n=this._sections[r].consumer.sourceContentFor(e,!0);if(n)return n}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var r=this._sections[t];if(-1!==r.consumer.sources.indexOf(n.getArg(e,"source"))){var i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},u.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var i=this._sections[r],s=i.consumer._generatedMappings,a=0;a<s.length;a++){var c=s[a],l=i.consumer._sources.at(c.source);null!==i.consumer.sourceRoot&&(l=n.join(i.consumer.sourceRoot,l)),this._sources.add(l),l=this._sources.indexOf(l);var h=i.consumer._names.at(c.name);this._names.add(h),h=this._names.indexOf(h);var u={source:l,generatedLine:c.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:c.generatedColumn+(i.generatedOffset.generatedLine===c.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:c.originalLine,originalColumn:c.originalColumn,name:h};this.__generatedMappings.push(u),"number"==typeof u.originalLine&&this.__originalMappings.push(u)}o(this.__generatedMappings,n.compareByGeneratedPositionsDeflated),o(this.__originalMappings,n.compareByOriginalPositions)},t.IndexedSourceMapConsumer=u},function(e,t){t.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};var r=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,n=/^data:.+\,.+$/;function i(e){var t=e.match(r);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function s(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function a(e){var r=e,n=i(e);if(n){if(!n.path)return e;r=n.path}for(var a,o=t.isAbsolute(r),c=r.split(/\/+/),l=0,h=c.length-1;h>=0;h--)"."===(a=c[h])?c.splice(h,1):".."===a?l++:l>0&&(""===a?(c.splice(h+1,l),l=0):(c.splice(h,2),l--));return""===(r=c.join("/"))&&(r=o?"/":"."),n?(n.path=r,s(n)):r}t.urlParse=i,t.urlGenerate=s,t.normalize=a,t.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var r=i(t),o=i(e);if(o&&(e=o.path||"/"),r&&!r.scheme)return o&&(r.scheme=o.scheme),s(r);if(r||t.match(n))return t;if(o&&!o.host&&!o.path)return o.host=t,s(o);var c="/"===t.charAt(0)?t:a(e.replace(/\/+$/,"")+"/"+t);return o?(o.path=c,s(o)):c},t.isAbsolute=function(e){return"/"===e.charAt(0)||!!e.match(r)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var r=0;0!==t.indexOf(e+"/");){var n=e.lastIndexOf("/");if(n<0)return t;if((e=e.slice(0,n)).match(/^([^\/]+:\/)?\/*$/))return t;++r}return Array(r+1).join("../")+t.substr(e.length+1)};var o=!("__proto__"in Object.create(null));function c(e){return e}function l(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function h(e,t){return e===t?0:e>t?1:-1}t.toSetString=o?c:function(e){return l(e)?"$"+e:e},t.fromSetString=o?c:function(e){return l(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,r){var n=e.source-t.source;return 0!==n?n:0!=(n=e.originalLine-t.originalLine)?n:0!=(n=e.originalColumn-t.originalColumn)||r?n:0!=(n=e.generatedColumn-t.generatedColumn)?n:0!=(n=e.generatedLine-t.generatedLine)?n:e.name-t.name},t.compareByGeneratedPositionsDeflated=function(e,t,r){var n=e.generatedLine-t.generatedLine;return 0!==n?n:0!=(n=e.generatedColumn-t.generatedColumn)||r?n:0!=(n=e.source-t.source)?n:0!=(n=e.originalLine-t.originalLine)?n:0!=(n=e.originalColumn-t.originalColumn)?n:e.name-t.name},t.compareByGeneratedPositionsInflated=function(e,t){var r=e.generatedLine-t.generatedLine;return 0!==r?r:0!=(r=e.generatedColumn-t.generatedColumn)?r:0!==(r=h(e.source,t.source))?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)?r:h(e.name,t.name)}},function(e,t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,r,n,i){if(0===r.length)return-1;var s=function e(r,n,i,s,a,o){var c=Math.floor((n-r)/2)+r,l=a(i,s[c],!0);return 0===l?c:l>0?n-c>1?e(c,n,i,s,a,o):o==t.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-r>1?e(r,c,i,s,a,o):o==t.LEAST_UPPER_BOUND?c:r<0?-1:r}(-1,r.length,e,r,n,i||t.GREATEST_LOWER_BOUND);if(s<0)return-1;for(;s-1>=0&&0===n(r[s],r[s-1],!0);)--s;return s}},function(e,t,r){var n=r(20),i=Object.prototype.hasOwnProperty;function s(){this._array=[],this._set=Object.create(null)}s.fromArray=function(e,t){for(var r=new s,n=0,i=e.length;n<i;n++)r.add(e[n],t);return r},s.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},s.prototype.add=function(e,t){var r=n.toSetString(e),s=i.call(this._set,r),a=this._array.length;s&&!t||this._array.push(e),s||(this._set[r]=a)},s.prototype.has=function(e){var t=n.toSetString(e);return i.call(this._set,t)},s.prototype.indexOf=function(e){var t=n.toSetString(e);if(i.call(this._set,t))return this._set[t];throw new Error('"'+e+'" is not in the set.')},s.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},s.prototype.toArray=function(){return this._array.slice()},t.ArraySet=s},function(e,t,r){var n=r(24);t.encode=function(e){var t,r="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&i,(i>>>=5)>0&&(t|=32),r+=n.encode(t)}while(i>0);return r},t.decode=function(e,t,r){var i,s,a=e.length,o=0,c=0;do{if(t>=a)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(s=n.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));i=!!(32&s),o+=(s&=31)<<c,c+=5}while(i);r.value=function(e){var t=e>>1;return 1==(1&e)?-t:t}(o),r.rest=t}},function(e,t){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<r.length)return r[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},function(e,t){function r(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function n(e,t,i,s){if(i<s){var a=i-1;r(e,function(e,t){return Math.round(e+Math.random()*(t-e))}(i,s),s);for(var o=e[s],c=i;c<s;c++)t(e[c],o)<=0&&r(e,a+=1,c);r(e,a+1,c);var l=a+1;n(e,t,i,l-1),n(e,t,l+1,s)}}t.quickSort=function(e,t){n(e,t,0,e.length-1)}},function(e,t,r){"use strict";r.r(t),r.d(t,"DevtoolsConnection",function(){return u}),r.d(t,"DevtoolsForTests",function(){return d});var n=r(5),i=r(27),s=r(29),a=r(30);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
let o=null,c=!1,l=null,h=new Promise(e=>l=e);a.DevtoolsBroker.onceConnected.then(()=>{u.ensure(),l(o),c=!0});class u{static get isConnected(){return c}static get onceConnected(){return h}static get(){return o}static ensure(){o||(o=new i.DevtoolsChannel)}}class d{static get channel(){return o}static ensureStub(){Object(n.assert)(!o),o=new s.DevtoolsChannelStub,l(o),c=!0}static reset(){Object(n.assert)(o),c=!1,l=null,h=new Promise(e=>l=e),o=null}}},function(e,t,r){"use strict";r.r(t),r.d(t,"DevtoolsChannel",function(){return i});var n=r(28);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i extends n.AbstractDevtoolsChannel{constructor(){super(),document.addEventListener("arcs-debug-in",e=>this._handleMessage(e.detail))}_flush(e){document.dispatchEvent(new CustomEvent("arcs-debug-out",{detail:e}))}}},function(e,t,r){"use strict";r.r(t),r.d(t,"AbstractDevtoolsChannel",function(){return i});var n=r(5);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{constructor(){this.debouncedMessages=[],this.debouncing=!1,this.messageListeners=new Map}send(e){this.debouncedMessages.push(e),this.debouncing||(this.debouncing=!0,setTimeout(()=>{this._flush(this.debouncedMessages),this.debouncedMessages=[],this.debouncing=!1},100))}listen(e,t,r){Object(n.assert)(t),Object(n.assert)(e);const i=`${"string"==typeof e?e:e.id.toString()}/${t}`;let s=this.messageListeners.get(i);s||this.messageListeners.set(i,s=[]),s.push(r)}_handleMessage(e){const t=this.messageListeners.get(`${e.arcId}/${e.messageType}`);if(t)for(const r of t)r(e);else console.warn(`No one is listening to ${e.messageType} message`)}_flush(e){throw new Error("Not implemented in an abstract class")}}},function(e,t,r){"use strict";r.r(t),r.d(t,"DevtoolsChannelStub",function(){return n});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class n{constructor(){this._messages=[]}get messages(){return this._messages}send(e){this._messages.push(JSON.parse(JSON.stringify(e)))}listen(e,t,r){}clear(){this._messages.length=0}}},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"DevtoolsBroker",function(){return i});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const n="object"==typeof window?window:e;n._arcDebugPromise||(n._arcDebugPromise=new Promise(e=>{n._arcDebugPromiseResolve=e}));class i{static get onceConnected(){return n._arcDebugPromise}static markConnected(){return n._arcDebugPromiseResolve(),{preExistingArcs:!!n.arc}}}}.call(this,r(2))},function(e,t,r){"use strict";r.r(t),r.d(t,"StorageProxy",function(){return c}),r.d(t,"CollectionProxy",function(){return l}),r.d(t,"VariableProxy",function(){return h}),r.d(t,"BigCollectionProxy",function(){return u}),r.d(t,"StorageProxyScheduler",function(){return d});var n,i=r(5),s=r(32),a=r(6),o=r(17);!function(e){e[e.none=0]="none",e[e.pending=1]="pending",e[e.full=2]="full"}(n||(n={}));class c{constructor(e,t,r,i,s,a){this.localIDComponent=0,this.version=void 0,this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=n.none,this.observers=[],this.updates=[],this.barrier=null,this.id=e,this.type=t,this.port=r,this.scheduler=s,this.name=a,this.baseForNewID=i.generateID(),this.updates=[],this.pec=i}static newProxy(e,t,r,n,i,s){return t instanceof a.CollectionType?new l(e,t,r,n,i,s):t instanceof a.BigCollectionType?new u(e,t,r,n,i,s):new h(e,t,r,n,i,s)}raiseSystemException(e,t,r){Object(o.mapStackTrace)(e.stack,n=>this.port.RaiseSystemException({exception:{message:e.message,stack:n.join("\n"),name:e.name},methodName:t,particleId:r}))}register(e,t){if(t.canRead&&(this.observers.push({particle:e,handle:t}),this.listenerAttached||(this.port.InitializeProxy({handle:this,callback:e=>this._onUpdate(e)}),this.listenerAttached=!0),t.options.keepSynced&&(this.keepSynced||(this.port.SynchronizeProxy({handle:this,callback:e=>this._onSynchronize(e)}),this.keepSynced=!0),t.options.notifySync&&this.synchronized===n.full))){const r=this._getModelForSync();this.scheduler.enqueue(e,t,["sync",e,r])}}_onSynchronize({version:e,model:t}){if(void 0!==this.version&&e<=this.version)return void console.warn(`StorageProxy '${this.id}' received stale model version ${e}; `+`current is ${this.version}`);if(!this._synchronizeModel(e,t))return;for(this.synchronized=n.full;this.updates.length>0&&this.updates[0].version<=e;)this.updates.shift();const r=this._getModelForSync();this._notify("sync",r,e=>e.keepSynced&&e.notifySync),this._processUpdates()}_onUpdate(e){if(this.observers.find(({handle:e})=>!e.options.keepSynced&&e.options.notifyUpdate)){const t=this._processUpdate(e,!1);this._notify("update",t,e=>!e.keepSynced&&e.notifyUpdate)}this.keepSynced&&(e.version<=this.version?console.warn(`StorageProxy '${this.id}' received stale update version ${e.version}; `+`current is ${this.version}`):(this.updates.push(e),this.updates.sort((e,t)=>e.version-t.version),this._processUpdates()))}_notify(e,t,r=(e=>!0)){for(const{handle:n,particle:i}of this.observers)r(n.options)&&this.scheduler.enqueue(i,n,[e,i,t])}_processUpdates(){const e=e=>e.version===this.version+1||!(!this.barrier||e.barrier!==this.barrier);for(;this.updates.length>0&&e(this.updates[0]);){const e=this.updates.shift(),t=this._processUpdate(e);this.version=e.version,t&&this._notify("update",t,e=>e.keepSynced&&e.notifyUpdate)}if(this.updates.length>0){if(this.synchronized!==n.none){this.synchronized=n.none,this.port.SynchronizeProxy({handle:this,callback:e=>this._onSynchronize(e)});for(const{handle:e,particle:t}of this.observers)e.options.notifyDesync&&this.scheduler.enqueue(t,e,["desync",t])}}else this.synchronized!==n.full&&(this.synchronized=n.full)}generateID(){return`${this.baseForNewID}:${this.localIDComponent++}`}generateIDComponents(){return{base:this.baseForNewID,component:()=>this.localIDComponent++}}}class l extends c{constructor(){super(...arguments),this.model=new s.CrdtCollectionModel}_getModelForSync(){return this.model.toList()}_synchronizeModel(e,t){return this.version=e,this.model=new s.CrdtCollectionModel(t),!0}_processUpdate(e,t=!0){if(this.synchronized===n.full)for(const{handle:t}of this.observers)if(e.originatorId===t._particleId)return null;const r=[],i=[];if("add"in e)for(const{value:n,keys:i,effective:s}of e.add)(t&&this.model.add(n.id,n,i)||!t&&s)&&r.push(n);else{if(!("remove"in e))throw new Error(`StorageProxy received invalid update event: ${JSON.stringify(e)}`);for(const{value:r,keys:n,effective:s}of e.remove){const e=this.model.getValue(r.id);(t&&this.model.remove(r.id,n)||!t&&s)&&i.push(e)}}if(r.length||i.length){const t={originatorId:e.originatorId};return r.length&&(t.add=r),i.length&&(t.remove=i),t}return null}toList(){return this.synchronized===n.full?Promise.resolve(this.model.toList()):new Promise(e=>this.port.HandleToList({callback:e,handle:this}))}get(e,t){return this.synchronized===n.full?Promise.resolve(this.model.getValue(e)):new Promise((r,n)=>this.port.HandleToList({callback:t=>r(t.find(t=>t.id===e)),handle:this,particleId:t}))}store(e,t,r){const i=e.id,s={value:e,keys:t};if(this.port.HandleStore({handle:this,callback:()=>{},data:s,particleId:r}),this.synchronized!==n.full)return;if(!this.model.add(i,e,t))return;const a={originatorId:r,add:[e]};this._notify("update",a,e=>e.notifyUpdate)}clear(e){this.synchronized!==n.full&&this.port.HandleRemoveMultiple({handle:this,callback:()=>{},data:[],particleId:e});let t=this.model.toList().map(e=>({id:e.id,keys:this.model.getKeys(e.id)}));this.port.HandleRemoveMultiple({handle:this,callback:()=>{},data:t,particleId:e}),(t=(t=t.map(({id:e,keys:t})=>({rawData:this.model.getValue(e).rawData,id:e,keys:t}))).filter(e=>this.model.remove(e.id,e.keys))).length>0&&this._notify("update",{originatorId:e,remove:t},e=>e.notifyUpdate)}remove(e,t,r){if(this.synchronized!==n.full){const t={id:e,keys:[]};return void this.port.HandleRemove({handle:this,callback:()=>{},data:t,particleId:r})}const i=this.model.getValue(e);if(!i)return;0===t.length&&(t=this.model.getKeys(e));const s={id:e,keys:t};if(this.port.HandleRemove({handle:this,callback:()=>{},data:s,particleId:r}),!this.model.remove(e,t))return;const a={originatorId:r,remove:[i]};this._notify("update",a,e=>e.notifyUpdate)}}class h extends c{constructor(){super(...arguments),this.model=null}_getModelForSync(){return this.model}_synchronizeModel(e,t){return null==this.barrier&&(this.version=e,this.model=0===t.length?null:t[0].value,Object(i.assert)(void 0!==this.model),!0)}_processUpdate(e,t=!0){if(Object(i.assert)("data"in e),!t)return e;if(null!=this.barrier){if(e.barrier===this.barrier&&(this.barrier=null,this.synchronized!==n.full)){this.synchronized=n.full;const e=this._getModelForSync();this._notify("sync",e,e=>e.keepSynced&&e.notifySync)}return null}return this.model=e.data,e}get(){return this.synchronized===n.full?Promise.resolve(this.model):new Promise(e=>this.port.HandleGet({callback:e,handle:this}))}set(e,t){if(Object(i.assert)(void 0!==e),JSON.stringify(this.model)===JSON.stringify(e))return;let r;r=this.listenerAttached?this.generateID():null,this.model=JSON.parse(JSON.stringify(e)),this.barrier=r,this.port.HandleSet({data:e,handle:this,particleId:t,barrier:r});const n={originatorId:t,data:e};this._notify("update",n,e=>e.notifyUpdate)}clear(e){if(null==this.model)return;const t=this.generateID();this.model=null,this.barrier=t,this.port.HandleClear({handle:this,particleId:e,barrier:t});const r={originatorId:e,data:null};this._notify("update",r,e=>e.notifyUpdate)}}class u extends c{register(e,t){t.canRead&&this.scheduler.enqueue(e,t,["sync",e,{}])}_getModelForSync(){throw new Error("_getModelForSync not implemented for BigCollectionProxy")}_processUpdate(){throw new Error("_processUpdate not implemented for BigCollectionProxy")}_synchronizeModel(){throw new Error("_synchronizeModel not implemented for BigCollectionProxy")}async store(e,t,r){return new Promise(n=>this.port.HandleStore({handle:this,callback:n,data:{value:e,keys:t},particleId:r}))}async remove(e,t){return new Promise(r=>this.port.HandleRemove({handle:this,callback:r,data:{id:e,keys:[]},particleId:t}))}async stream(e,t){return new Promise(r=>this.port.HandleStream({handle:this,callback:r,pageSize:e,forward:t}))}async cursorNext(e){return new Promise(t=>this.port.StreamCursorNext({handle:this,callback:t,cursorId:e}))}cursorClose(e){this.port.StreamCursorClose({handle:this,cursorId:e})}}class d{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(e,t,r){this._queues.has(e)||this._queues.set(e,new Map);const n=this._queues.get(e);n.has(t)||n.set(t,[]),n.get(t).push(r),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(e=>this._idleResolver=e)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const e=[...this._queues.keys()][0],t=this._queues.get(e);this._queues.delete(e);for(const[e,r]of t.entries())for(const t of r)try{e._notify(...t)}catch(t){console.error("Error dispatching to particle",t),e._proxy.raiseSystemException(t,"StorageProxyScheduler::_dispatch",e._particleId)}}this._updateIdle()}}},function(e,t,r){"use strict";r.r(t),r.d(t,"CrdtCollectionModel",function(){return i});var n=r(5);
// @license
class i{constructor(e){if(this.items=new Map,e)for(let{id:t,value:r,keys:n}of e)n||(n=[]),this.items.set(t,{value:r,keys:new Set(n)})}add(e,t,r){Object(n.assert)(r.length>0&&"object"==typeof r,"add requires a list of keys");let i=this.items.get(e),s=!1;if(i){let e=!1;for(const t of r)i.keys.has(t)||(e=!0),i.keys.add(t);this._equals(i.value,t)||(Object(n.assert)(e,"cannot add without new keys. incoming="+r.join(",")+" existing="+[...i.keys].join(",")),i.value=t,s=!0)}else i={value:t,keys:new Set(r)},this.items.set(e,i),s=!0;return s}_equals(e,t){if(Boolean(e)!==Boolean(t))return!1;if(!e)return!0;const r=typeof e;if(r!==typeof t)return!1;if("object"===r){const r=Object.keys(e);return r.length===Object.keys(t).length&&r.every(r=>this._equals(e[r],t[r]))}return JSON.stringify(e)===JSON.stringify(t)}remove(e,t){const r=this.items.get(e);if(!r)return!1;for(const e of t)r.keys.delete(e);const n=0===r.keys.size;return n&&this.items.delete(e),n}toLiteral(){const e=[];for(const[t,{value:r,keys:n}]of this.items.entries())e.push({id:t,value:r,keys:[...n]});return e}toList(){return[...this.items.values()].map(e=>e.value)}has(e){return this.items.has(e)}getKeys(e){const t=this.items.get(e);return t?[...t.keys]:[]}getValue(e){const t=this.items.get(e);return t?t.value:null}get size(){return this.items.size}}},function(e,t,r){"use strict";r.r(t),r.d(t,"BrowserLoader",function(){return u});var n=r(34),i=r(38),s=r(39),a=r(42),o=r(43);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const c=(e,t,r="log")=>console[r].bind(console,`%c${e} [Particle]`,`background: ${t}; color: white; padding: 1px 6px 2px 7px; border-radius: 4px;`),l=(e,...t)=>(e[0]+t.map((t,r)=>t+e[r+1]).join("")).trim(),h={};class u extends n.Loader{constructor(e){super(),this._urlMap=e}_loadURL(e){const t=this._resolve(e),r=new URL(t,document.URL).href;return h[r]||(h[r]=super._loadURL(t))}loadResource(e){return this._loadURL(e)}_resolve(e){let t=this._urlMap[e];if(!t&&e){const r=Object.keys(this._urlMap).sort((e,t)=>t.length-e.length).find(t=>e.slice(0,t.length)==t);r&&(t=this._urlMap[r]+e.slice(r.length))}return t=t||e}requireParticle(e){const t=this._resolve(e);this.mapParticleUrl(t);const r=[];self.defineParticle=function(e){r.push(e)},importScripts(t),delete self.defineParticle;const n=c(e.split("/").pop(),"#1faa00");return this.unwrapParticle(r[0],n)}mapParticleUrl(e){const t=e.split("/"),r=t.pop(),n=t.join("/"),i=r.split(".").shift();this._urlMap[i]=n}unwrapParticle(e,t){const r=this._resolve.bind(this),n=u.fetch||fetch;return e({Particle:i.Particle,DomParticle:s.DomParticle,MultiplexerDomParticle:a.MultiplexerDomParticle,SimpleParticle:s.DomParticle,TransformationDomParticle:o.TransformationDomParticle,resolver:r,log:t,html:l,_fetch:n})}}},function(e,t,r){"use strict";r.r(t),r.d(t,"Loader",function(){return f});var n=r(35),i=r(36),s=r(37),a=r(5),o=r(38),c=r(39),l=r(42),h=r(4),u=r(43),d=r(44);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const p=(e,...t)=>(e[0]+t.map((t,r)=>t+e[r+1]).join("")).trim();class f{path(e){return e.replace(/[/][^/]+$/,"/")}join(e,t){return/^https?:\/\//.test(t)?t:"/"===t[0]||":"===t[1]?t:(e=this.path(e),t=this.normalizeDots(`${e}${t}`))}normalizeDots(e){const t=e=>e.replace(/(?:^|\/)[^./]*\/\.\./g,"");for(let r=t(e=(e=e.replace(/\\/g,"/")).replace(/\/\.\//g,"/"));r!==e;r=t(e=r));return e}loadResource(e){return/^https?:\/\//.test(e)?this._loadURL(e):this._loadFile(e)}_loadFile(e){return new Promise((t,r)=>{n.fs.readFile(e,(e,n)=>{e?r(e):t(n.toString("utf-8"))})})}_loadURL(e){return/\/\/schema.org\//.test(e)?e.endsWith("/Thing")?Object(s.fetch)("https://schema.org/Product.jsonld").then(e=>e.text()).then(e=>d.JsonldToManifest.convert(e,{"@id":"schema:Thing"})):Object(s.fetch)(e+".jsonld").then(e=>e.text()).then(e=>d.JsonldToManifest.convert(e)):Object(s.fetch)(e).then(e=>e.text())}async loadParticleClass(e){const t=await this.requireParticle(e.implFile);return t.spec=e,t}async requireParticle(e){null===e&&(e="");const t=await this.loadResource(e),r=new i.vm.Script(t,{filename:e,displayErrors:!0}),n=[],o={defineParticle(e){n.push(e)},console:console,fetch:s.fetch,setTimeout:setTimeout,importScripts:e=>null};return r.runInNewContext(o,{filename:e,displayErrors:!0}),Object(a.assert)(n.length>0&&"function"==typeof n[0],`Error while instantiating particle implementation from ${e}`),this.unwrapParticle(n[0])}setParticleExecutionContext(e){this.pec=e}unwrapParticle(e){return Object(a.assert)(this.pec),e({Particle:o.Particle,DomParticle:c.DomParticle,TransformationDomParticle:u.TransformationDomParticle,MultiplexerDomParticle:l.MultiplexerDomParticle,Reference:h.Reference.newClientReference(this.pec),html:p})}}},function(e,t,r){"use strict";r.r(t),r.d(t,"fs",function(){return n});const n={}},function(e,t,r){"use strict";r.r(t),r.d(t,"vm",function(){return n});const n={}},function(e,t,r){"use strict";r.r(t),r.d(t,"fetch",function(){return n});const n=fetch},function(e,t,r){"use strict";r.r(t),r.d(t,"Particle",function(){return i});var n=r(3);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{constructor(e){this.relevances=[],this._idle=Promise.resolve(),this._busy=0,this._slotByName=new Map,this.spec=this.constructor.spec,0===this.spec.inputs.length&&(this.extraData=!0),this.capabilities=e||{}}setHandles(e){}setViews(e){}onHandleSync(e,t){}onHandleUpdate(e,t){}onHandleDesync(e){}constructInnerArc(){if(!this.capabilities.constructInnerArc)throw new Error("This particle is not allowed to construct inner arcs");return this.capabilities.constructInnerArc(this)}get busy(){return this._busy>0}get idle(){return this._idle}set relevance(e){this.relevances.push(e)}startBusy(){0===this._busy&&(this._idle=new Promise(e=>this._idleResolver=e)),this._busy++}doneBusy(){this._busy--,0===this._busy&&this._idleResolver()}inputs(){return this.spec.inputs}outputs(){return this.spec.outputs}getSlot(e){return this._slotByName.get(e)}static buildManifest(e,...t){const r=[];for(let n=0;n<t.length;n++){const i=e[n],s=/ *$/.exec(i)[0];let a;a=(a="string"==typeof t[n]?t[n]:t[n].toManifestString()).replace(/(\n)/g,"$1"+s),r.push(i),r.push(a)}return e.length>t.length&&r.push(e[e.length-1]),r.join("")}setParticleDescription(e){return this.setDescriptionPattern("pattern",e)}setDescriptionPattern(e,t){const r=this.handles.get("descriptions");if(r){const i=r.entityClass;return(r instanceof n.Collection||r instanceof n.BigCollection)&&r.store(new i({key:e,value:t},this.spec.name+"-"+e)),!0}throw new Error("A particle needs a description handle to set a decription pattern")}}},function(e,t,r){"use strict";r.r(t),r.d(t,"DomParticle",function(){return s});var n=r(40),i=r(41);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s extends(Object(n.XenStateMixin)(i.DomParticleBase)){constructor(){super(),this.state=this._state,this.props=this._props}willReceiveProps(){}update(){}shouldRender(){return!0}render(){return{}}setState(e){return this._setState(e)}setIfDirty(e){return console.warn("DomParticle: `setIfDirty` is deprecated, please use `setState` instead"),this._setState(e)}configureHandles(e){}get config(){return{handleNames:this.spec.inputs.map(e=>e.name),slotNames:[...this.spec.slots.values()].map(e=>e.name)}}_willReceiveProps(...e){this.willReceiveProps(...e)}_update(...e){this.update(...e),this.shouldRender(...e)&&(this.relevance=1),this.config.slotNames.forEach(e=>this.renderSlot(e,["model"]))}get _views(){return console.warn(`Particle ${this.spec.name} uses deprecated _views getter.`),this.handles}async setViews(e){return console.warn(`Particle ${this.spec.name} uses deprecated setViews method.`),this.setHandles(e)}async setHandles(e){this.configureHandles(e),this.handles=e,this._handlesToSync=new Set;for(const t of this.config.handleNames){const r=e.get(t);r&&r.options.keepSynced&&r.options.notifySync&&this._handlesToSync.add(t)}setTimeout(()=>!this._hasProps&&this._invalidate(),200)}async onHandleSync(e,t){this._handlesToSync.delete(e.name),0==this._handlesToSync.size&&await this._handlesToProps()}async onHandleUpdate(e,t){this._debounce("handleUpdateDebounce",()=>{this._handlesToProps()},100)}async _handlesToProps(){const e=this.config,t=await Promise.all(e.handleNames.map(e=>this.handles.get(e)).map(e=>e.toList?e.toList():e.get?e.get():e)),r=Object.create(null);e.handleNames.forEach((e,n)=>{r[e]=t[n]}),this._hasProps=!0,this._setProps(r)}fireEvent(e,{handler:t,data:r}){this[t]&&this[t]({data:r},this._state)}_debounce(e,t,r){const n=`_debounce_${e}`;this._state[n]||this.startBusy();super._debounce(e,()=>{this.doneBusy(),t(),this._state[n]=null},r)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"XenStateMixin",function(){return s}),r.d(t,"nob",function(){return n}),r.d(t,"debounce",function(){return i});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const n=()=>Object.create(null),i=(e,t,r)=>{if(e&&clearTimeout(e),t&&r)return setTimeout(t,r)},s=e=>(class extends e{constructor(){super(),this._pendingProps=n(),this._props=this._getInitialProps()||n(),this._lastProps=n(),this._state=this._getInitialState()||n(),this._lastState=n()}_getInitialProps(){}_getInitialState(){}_getProperty(e){return this._pendingProps[e]||this._props[e]}_setProperty(e,t){(this._validator||this._wouldChangeProp(e,t))&&(this._pendingProps[e]=t,this._invalidateProps())}_wouldChangeValue(e,t,r){return e[t]!==r}_wouldChangeProp(e,t){return this._wouldChangeValue(this._props,e,t)}_wouldChangeState(e,t){return this._wouldChangeValue(this._state,e,t)}_setProps(e){Object.assign(this._pendingProps,e),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}_setImmutableState(e,t){"object"==typeof e&&(console.warn("Xen:: _setImmutableState takes name and value args for a single property, dictionaries not supported."),t=Object.values(e)[0],e=Object.names(e)[0]),"object"==typeof t&&(t=Object.assign(Object.create(null),t)),this._state[e]=t,this._invalidate()}_setState(e){let t=!1;const r=this._state;for(const n in e){const i=e[n];this._wouldChangeState(n,i)&&(t=!0,r[n]=i)}if(t)return this._invalidate(),!0}_setIfDirty(e){return this._setState(e)}_async(e){return Promise.resolve().then(e.bind(this))}_invalidate(){this._validator||(this._validator=this._async(this._validate))}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const e=this._getStateArgs();try{Object.assign(this._props,this._pendingProps),this._propsInvalid&&(this._willReceiveProps(...e),this._propsInvalid=!1),this._shouldUpdate(...e)&&(this._ensureMount(),this._doUpdate(...e))}catch(e){console.error(e)}this._validator=null,this._lastProps=Object.assign(n(),this._props),this._lastState=Object.assign(n(),this._state)}_doUpdate(...e){this._update(...e),this._didUpdate(...e)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(e,t,r){e=`_debounce_${e}`,this._state[e]=i(this._state[e],t,null!=r?r:16)}})},function(e,t,r){"use strict";r.r(t),r.d(t,"DomParticleBase",function(){return a});var n=r(5),i=r(38),s=r(3);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class a extends i.Particle{constructor(){super()}get template(){return""}getTemplate(e){return this.template}getTemplateName(e){return"default"}shouldRender(e){return!0}render(e){return{}}renderSlot(e,t){const r=this._getStateArgs(),n=this.getSlot(e);if(n){if(this.currentSlotName=e,t.forEach(e=>n.requestedContentTypes.add(e)),this.shouldRender(...r)){const e={};n.requestedContentTypes.has("template")&&(e.template=this.getTemplate(n.slotName)),n.requestedContentTypes.has("model")&&(e.model=this.render(...r)),e.templateName=this.getTemplateName(n.slotName),n.render(e)}else n.isRendered&&n.render({});this.currentSlotName=void 0}}_getStateArgs(){return[]}forceRenderTemplate(e){this._slotByName.forEach((t,r)=>{e&&r!==e||t.requestedContentTypes.add("template")})}fireEvent(e,{handler:t,data:r}){this[t]&&this[t]({data:r})}setParticleDescription(e){if("string"==typeof e)return super.setParticleDescription(e);Object(n.assert)(!!e.template&&!!e.model,"Description pattern must either be string or have template and model"),super.setDescriptionPattern("_template_",e.template),super.setDescriptionPattern("_model_",JSON.stringify(e.model))}async clearHandle(e){const t=this.handles.get(e);if(!(t instanceof s.Variable||t instanceof s.Collection))throw new Error("Variable/Collection required");t.clear()}async mergeEntitiesToHandle(e,t){const r={},n=this.handles.get(e);if(!(n instanceof s.Collection))throw new Error("Collection required");(await n.toList()).forEach(e=>r[e.id]=e);for(const e of t)r[e.id]||n.store(e)}async appendEntitiesToHandle(e,t){const r=this.handles.get(e);if(r){if(!(r instanceof s.Collection||r instanceof s.BigCollection))throw new Error("Collection required");Promise.all(t.map(e=>r.store(e)))}}async appendRawDataToHandle(e,t){const r=this.handles.get(e);if(r&&r.entityClass){if(!(r instanceof s.Collection||r instanceof s.BigCollection))throw new Error("Collection required");{const e=r.entityClass;Promise.all(t.map(t=>r.store(new e(t))))}}}updateVariable(e,t){const r=this.handles.get(e);if(r&&r.entityClass){if(r instanceof s.Variable){const e=new(0,r.entityClass)(t);return r.set(e),e}throw new Error("Variable required")}}async updateSet(e,t){const r=this.handles.get(e);if(r){if(!(r instanceof s.Collection||r instanceof s.BigCollection))throw new Error("Collection required");await r.remove(t),await r.store(t)}}boxQuery(e,t){return e.filter(e=>t===e.getUserID().split("|")[0])}}},function(e,t,r){"use strict";r.r(t),r.d(t,"MultiplexerDomParticle",function(){return a});var n=r(5),i=r(14),s=r(43);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class a extends s.TransformationDomParticle{constructor(){super(),this._itemSubIdByHostedSlotId=new Map,this._connByHostedConn=new Map}async _mapParticleConnections(e,t,r,n,i){const s=[],a=[];let o=2;const c=[e,t];for(const[e,t]of n){if(c.includes(e))continue;s.push(`use '${await i.mapHandle(t._proxy)}' as v${o}`);const n=r.connections.find(e=>e.isCompatibleType(t.type));n&&(a.push(`${n.name} = v${o++}`),this._connByHostedConn.set(n.name,e))}return[s,a]}async setHandles(e){this.handleIds={};const t=await this.constructInnerArc(),r=e.get("hostedParticle");let n=null,i=[],s=[];r&&(n=await r.get())&&([i,s]=await this._mapParticleConnections("list","hostedParticle",n,e,t)),this.setState({arc:t,type:e.get("list").type,hostedParticle:n,otherMappedHandles:i,otherConnections:s}),super.setHandles(e)}async willReceiveProps({list:e},{arc:t,type:r,hostedParticle:n,otherMappedHandles:s,otherConnections:a}){e.length>0&&(this.relevance=.1);for(const[o,c]of this.getListEntries(e)){let e=n;if(this.handleIds[c.id]){(await this.handleIds[c.id]).set(c);continue}const l=t.createHandle(r.primitiveType(),"item"+o);this.handleIds[c.id]=l;const h=await l;if(!e){if(!c.renderParticleSpec)continue;e=i.ParticleSpec.fromLiteral(JSON.parse(c.renderParticleSpec));const r="list",n="renderParticle";[s,a]=await this._mapParticleConnections(r,n,e,this.handles,t)}const u=[...e.slots.keys()][0],d=[...this.spec.slots.values()][0].name,p=await t.createSlot(this,d,e.name,u,h._id);if(p){this._itemSubIdByHostedSlotId.set(p,c.id);try{const r=this.constructInnerRecipe(e,c,h,{name:u,id:p},{connections:a,handles:s});await t.loadRecipe(r,this),h.set(c)}catch(e){console.log(e)}}}}combineHostedModel(e,t,r){const n=this._itemSubIdByHostedSlotId.get(t);if(!n)return;const i=this._state.renderModel?this._state.renderModel.items:[],s=i.findIndex(e=>e.subId==n),a=Object.assign({},r.model,{subId:n});s>=0&&s<i.length?i[s]=a:i.push(a),this._setState({renderModel:{items:i}})}combineHostedTemplate(e,t,r){const i=this._itemSubIdByHostedSlotId.get(t);if(i&&(Object(n.assert)(r.templateName,`Template name is missing for slot '${e}' (hosted slot ID: '${t}')`),this._setState({templateName:Object.assign(this._state.templateName||{},{[i]:`${r.templateName}`})}),r.template)){let e=r.template;e=e.replace(new RegExp('slotid="[a-z]+"',"gi"),'$& subid$="{{subId}}"'),this._connByHostedConn.forEach((t,r)=>{e=e.replace(new RegExp(`{{${r}.description}}`,"g"),`{{${t}.description}}`)}),this._setState({template:Object.assign(this._state.template||{},{[r.templateName]:e})}),this.forceRenderTemplate()}}constructInnerRecipe(e,t,r,n,i){}getListEntries(e){return e.entries()}}},function(e,t,r){"use strict";r.r(t),r.d(t,"TransformationDomParticle",function(){return i});var n=r(39);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i extends n.DomParticle{getTemplate(e){return this._state.template}getTemplateName(e){return this._state.templateName}render(e,t){return t.renderModel}shouldRender(e,t){return Boolean((t.template||t.templateName)&&t.renderModel)}renderHostedSlot(e,t,r){this.combineHostedTemplate(e,t,r),this.combineHostedModel(e,t,r)}combineHostedTemplate(e,t,r){}combineHostedModel(e,t,r){}static propsToItems(e){return e?e.map(({rawData:e,id:t})=>Object.assign({},e,{subId:t})):[]}}},function(e,t,r){"use strict";r.r(t),r.d(t,"JsonldToManifest",function(){return i});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const n=["Text","URL","Number","Boolean"];class i{static convert(e,t){const r=JSON.parse(e),i={},s={};r["@graph"]||(r["@graph"]=[r]);for(const e of r["@graph"])"rdf:Property"===e["@type"]?s[e["@id"]]=e:"rdfs:Class"===e["@type"]&&(i[e["@id"]]=e,e.subclasses=[],e.superclass=null);for(const e of Object.values(i))if(void 0!==e["rdfs:subClassOf"]){void 0==e["rdfs:subClassOf"].length&&(e["rdfs:subClassOf"]=[e["rdfs:subClassOf"]]);for(const t of e["rdfs:subClassOf"]){const r=t["@id"];void 0==e.superclass&&(e.superclass=[]),i[r]?(i[r].subclasses.push(e),e.superclass.push(i[r])):e.superclass.push({"@id":r})}}for(const e of Object.values(i))0===e.subclasses.length&&void 0==t&&(t=e);const a=[];for(const e of Object.values(s)){let r=e["schema:domainIncludes"];if(r||(r={"@id":t["@id"]}),r.length||(r=[r]),(r=r.map(e=>e["@id"])).includes(t["@id"])){const t=e["@id"].split(":")[1];let r=e["schema:rangeIncludes"];r||console.log(e),r.length||(r=[r]),(r=(r=r.map(e=>e["@id"].split(":")[1])).filter(e=>n.includes(e))).length>0&&a.push({name:t,type:r})}}const o=t["@id"].split(":")[1],c=t&&t.superclass?t.superclass.map(e=>e["@id"].split(":")[1]):[];let l="";for(const e of c)l+=`import 'https://schema.org/${e}'\n\n`;if(l+=`schema ${o}`,c.length>0&&(l+=` extends ${c.join(", ")}`),a.length>0)for(const e of a){let t;l+=`\n  ${t=e.type.length>1?"("+e.type.join(" or ")+")":e.type[0]} ${e.name}`}return l+="\n"}}}]);
//# sourceMappingURL=worker-entry.js.map